/*! For license information please see asterics-grid.bundle.js.LICENSE.txt */
(()=>{var e,t,n,r,i,o={4069:e=>{"use strict";for(var t=/[\\\"\x00-\x1F]/g,n={},r=0;r<32;++r)n[String.fromCharCode(r)]="\\U"+("0000"+r.toString(16)).slice(-4).toUpperCase();function i(e){return t.lastIndex=0,e.replace(t,(function(e){return n[e]}))}n["\b"]="\\b",n["\t"]="\\t",n["\n"]="\\n",n["\f"]="\\f",n["\r"]="\\r",n['"']='\\"',n["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+i(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var n="[",r="",i=0;i<t.length;++i)r+=n,n=",",r+=e(t[i]);return","!=n?"[]":r+"]"}(t):function(t){var n="{",r="",o=Object.keys(t);o.sort();for(var a=0;a<o.length;++a){var s=o[a];r+=n+'"'+i(s)+'":',n=",",r+=e(t[s])}return","!=n?"{}":r+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},8597:(e,t)=>{"use strict";var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,r=/\\([\u000b\u0020-\u00ff])/g,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function o(e){this.parameters=Object.create(null),this.type=e}t.q=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var a=t.indexOf(";"),s=-1!==a?t.slice(0,a).trim():t.trim();if(!i.test(s))throw new TypeError("invalid media type");var l=new o(s.toLowerCase());if(-1!==a){var c,d,u;for(n.lastIndex=a;d=n.exec(t);){if(d.index!==a)throw new TypeError("invalid parameter format");a+=d[0].length,c=d[1].toLowerCase(),34===(u=d[2]).charCodeAt(0)&&-1!==(u=u.slice(1,-1)).indexOf("\\")&&(u=u.replace(r,"$1")),l.parameters[c]=u}if(a!==t.length)throw new TypeError("invalid parameter format")}return l}},6650:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.btn-accordion[data-v-23ef530e] {\n    background-color: white;\n    border-style: solid;\n    border-color: gray;\n    border-width: 1px;\n    text-align: left;\n    border-left: none;\n    border-right: none;\n    width: 100%;\n    padding-left: 1.0em;\n    position: relative;\n}\n.btn-accordion[data-v-23ef530e]:hover, .btn-accordion[data-v-23ef530e]:focus {\n    outline: 2px solid lightblue;\n}\n.btn-accordion:hover span[data-v-23ef530e] {\n    color: #2d7bb4;\n}\n.arrow[data-v-23ef530e] {\n    position: absolute;\n    top: 25%;\n}\n.accordion-content[data-v-23ef530e] {\n    padding: 1em;\n    outline: 1px solid lightgray;\n}\n",""]);const s=a},7303:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh3[data-v-23d128d4] {\n    margin: 0;\n    padding-bottom: 0.5em;\n}\nli[data-v-23d128d4] {\n    margin-bottom: 0;\n    list-style-type: none;\n    margin-left: 0.5em;\n}\nul[data-v-23d128d4] {\n    margin-bottom: 0.5em;\n}\n.fa-check[data-v-23d128d4] {\n    color: green;\n    margin-right: 1em;\n}\n",""]);const s=a},3567:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nul[data-v-713ffc86] {\n    list-style: none;\n}\nul li[data-v-713ffc86]:first-child {\n    margin-top: 1em !important;\n}\nli[data-v-713ffc86] {\n    margin-bottom: 2em;\n    margin-top: 2em;\n}\n.srow.nomargin[data-v-713ffc86] {\n    margin: 0;\n}\n.input-label[data-v-713ffc86] {\n    font-weight: bold;\n    margin-bottom: 0.7em;\n}\n@media (max-width: 850px) {\nli[data-v-713ffc86] {\n        outline: 1px solid lightgray;\n        padding: 0.5em;\n}\n}\n",""]);const s=a},5553:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.message[data-v-53d27f64] {\r\n    padding: 1em;\r\n    border-radius: 0.5em;\r\n    margin-bottom: 1em;\n}\n.message-own[data-v-53d27f64] {\r\n    background-color: lightgray;\r\n    margin-left: 4em;\r\n    margin-right: 0;\n}\n.message-other[data-v-53d27f64] {\r\n    background-color: lightblue;\r\n    margin-left: 0;\r\n    margin-right: 4em;\n}\r\n",""]);const s=a},2394:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nul[data-v-2218e1ec] {\r\n    flex-wrap: wrap;\r\n    margin-bottom: 0;\n}\nnav li[data-v-2218e1ec] {\r\n    flex: 1 1 content;\r\n    text-align: center;\r\n    background-color: #eaeaea;\r\n    border-radius: 5px 5px 0 0;\r\n    border: 1px solid #c8c8c8;\r\n    line-height: 2em;\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    max-height: 4em;\r\n    padding: 3px 10px 5px 10px;\n}\nnav li a[data-v-2218e1ec] {\r\n    padding-bottom: 3px;\n}\nnav li[data-v-2218e1ec]:hover {\r\n    background-color: lightgray;\n}\nnav li.selected[data-v-2218e1ec], nav li.selected[data-v-2218e1ec]:hover {\r\n    /*text-decoration: underline;\r\n    text-underline-offset: 5px;\r\n    text-decoration-color: #2d7bb4;\r\n    text-decoration-thickness: 4px;*/\r\n    /*background-color: #DBF4FF;*/\r\n    /*background-image: linear-gradient(#DBF4FF, white);*/\r\n    background-color: white;\r\n    border: 3px solid lightblue;\r\n    color: black;\r\n    border-bottom: none;\r\n    font-weight: bold;\n}\nnav li.selected a[data-v-2218e1ec] {\r\n    border-bottom: 4px solid #2d7bb4;\n}\nnav a[data-v-2218e1ec], nav a[data-v-2218e1ec]:focus, nav a[data-v-2218e1ec]:hover {\r\n    text-decoration: none;\r\n    color: black;\r\n    outline: none;\n}\r\n",""]);const s=a},8874:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n#boardGrid[data-v-70e4a517] {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fill, 400px); grid-gap: 1rem; list-style-type: none\n}\n#boardGrid li[data-v-70e4a517] {\r\n    box-shadow: 1px 1px 3px lightgray;\r\n    border-radius: 5px;\r\n    padding: 10px;\r\n    border: 1px solid lightgray;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\n}\n#boardGrid li .preview-content[data-v-70e4a517] {\r\n    max-height: 85%;\n}\n#boardGrid li .preview-buttons[data-v-70e4a517] {\r\n    margin-top: 1em;\r\n    bottom: 0.5em;\n}\n#boardGrid li button[data-v-70e4a517] {\r\n    width: 49%;\n}\n@media (max-width: 500px) {\n#boardGrid[data-v-70e4a517] {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, 100%); grid-gap: 1rem; list-style-type: none\n}\n}\n.row[data-v-70e4a517] {\r\n    margin-top: 1.5em;\n}\n.tag[data-v-70e4a517] {\r\n    flex-shrink: 1;\r\n    margin: 0.3em 0.3em 0.3em 0;\r\n    border-radius: 5px;\r\n    padding: 0px 3px 0px 3px;\n}\r\n",""]);const s=a},2778:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n#notificationBar[data-v-77616307] {\n    position: absolute;\n    bottom: 1vh;\n    right: 1vw;\n    z-index: 100;\n    background: black;\n    opacity: 0.85;\n    border-radius: 10px;\n    color: whitesmoke;\n    width: 40vw;\n    padding: 10px 50px 10px 10px;\n}\n@media (max-width: 850px) {\n#notificationBar[data-v-77616307] {\n        width: 50vw;\n        padding: 10px 35px 10px 10px;\n}\n}\n#notificationBarImg[data-v-77616307] {\n    vertical-align: middle;\n    max-height: 100%;\n    max-width: 80%;\n    height: 4vh;\n    width: auto\n}\n",""]);const s=a},2890:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-050f21d5] {\n    margin-top: 1em;\n}\nul li[data-v-050f21d5] {\n    list-style: none;\n    outline: 1px solid lightgray;\n    padding: 0.5em;\n}\n.webradioList button[data-v-050f21d5] {\n    line-height: unset;\n    margin-bottom: 0;\n    padding: 0 10px;\n}\n.webradioList[data-v-050f21d5], .webradioList li[data-v-050f21d5], .webradioList li div[data-v-050f21d5] {\n    padding: 0;\n    margin: 0;\n}\n.webradioList li[data-v-050f21d5]:hover {\n    background-color: #c4f0fe;\n}\n.webRadioListItem[data-v-050f21d5] {\n    display: flex;\n}\n.webRadioListItem img[data-v-050f21d5] {\n    flex-grow: 0;\n    flex-shrink: 0;\n    vertical-align: middle;\n    height: 28px;\n    width: 28px;\n}\n.webRadioLabel[data-v-050f21d5] {\n    flex-grow: 1;\n    flex-shrink: 1;\n    margin: 0 5px !important;\n}\n.webRadioButtons[data-v-050f21d5] {\n    flex-grow: 0;\n    flex-shrink: 0;\n}\n@media (min-width: 850px) {\n#poweredby[data-v-050f21d5] {\n        margin-top: 1em;\n}\n}\n",""]);const s=a},6684:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.searchContainer .barButtons[data-v-77f08c40] {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n    height: 100%;\n}\n.barButtons button[data-v-77f08c40] {\r\n    height: 100%;\r\n    line-height: initial;\r\n    margin: 0;\r\n    padding: 0 1em;\r\n    box-shadow: none;\r\n    outline: 1px solid lightgray;\r\n    border-radius: 5px;\n}\r\n",""]);const s=a},8903:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.element-container[data-v-a1b1e190] {\r\n    display: flex;\r\n    flex: 1 1 auto;\r\n    overflow: hidden;\r\n    position: relative;\n}\r\n",""]);const s=a},3466:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.grid-layout-element *[data-v-46edb430] {\r\n    /* see https://stackoverflow.com/a/47378072/9219743 */\r\n    -ms-touch-action: none;\r\n    touch-action: none;\n}\r\n",""]);const s=a},1467:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.grid-parent[data-v-2008ad88] {\r\n    width: 100%;\r\n    height: 100%;\r\n    position: relative;\n}\n.grid-layout[data-v-2008ad88] {\r\n    display: grid;\r\n    height: 100%;\r\n    grid-auto-columns: minmax(0, 1fr);\r\n    grid-auto-rows: minmax(0, 1fr);\r\n    margin: 0;\r\n    padding: 0;\r\n    -webkit-user-select: none; /* Safari */\r\n    -ms-user-select: none; /* IE 10 and IE 11 */\r\n    user-select: none; /* Standard syntax */\r\n    -webkit-touch-callout: none;\n}\n.grid-bg-lines[data-v-2008ad88] {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    bottom: 0;\r\n    right: 0;\r\n    overflow-y: hidden;\n}\n.grid-transition-move[data-v-2008ad88]:not(.nomove) {\r\n    transition: transform var(--animation-duration);\n}\r\n",""]);const s=a},6689:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-3ebc3fd6] {\n    margin-top: 1em;\n}\n",""]);const s=a},4932:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nul[data-v-4fd87d9d] {\r\n    list-style-type: none;\n}\n.tag[data-v-4fd87d9d] {\r\n    flex-shrink: 1;\r\n    margin: 0.3em 0.3em 0.3em 0;\r\n    border-radius: 5px;\r\n    padding: 0px 3px 0px 3px;\n}\r\n",""]);const s=a},2803:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-194805e0] {\n    margin-top: 1em;\n}\n.normal-text[data-v-194805e0] {\n    font-weight: normal;\n}\n",""]);const s=a},2351:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-065d04c2] {\n    margin-top: 1em;\n}\n.nomargin[data-v-065d04c2] {\n    margin-top: 0;\n}\n.full-width[data-v-065d04c2] {\n    width: 100%;\n}\n.normal-text[data-v-065d04c2] {\n    font-weight: normal;\n}\n",""]);const s=a},4015:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.normal-text[data-v-05be9182] {\r\n    font-weight: normal;\n}\n.row[data-v-05be9182] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},2671:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.normal-text[data-v-85596514] {\r\n    font-weight: normal;\n}\n.row[data-v-85596514] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},8228:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.normal-text[data-v-535280e2] {\r\n    font-weight: normal;\n}\n.custom-radio[data-v-535280e2] {\r\n    opacity: 0;\r\n    z-index: -1;\r\n    position: absolute;\n}\n.custom-radio:checked ~ label[data-v-535280e2] {\r\n    border-width: 0.2em;\r\n    border-color: #33C3F0;\r\n    background-color: #cceff9;\n}\n.button[data-v-535280e2] {\r\n    display: inline-block;\r\n    padding: 0 5px !important;\r\n    line-height: unset;\r\n    width: unset;\r\n    text-transform: none;\r\n    box-shadow: none;\r\n    background-color: white;\r\n    border: 1px solid #bbbbbb;\r\n    border-radius: 5px;\n}\nbutton[data-v-535280e2] {\r\n    line-height: unset;\n}\n.button[data-v-535280e2]:hover {\r\n    background-color: #cceff9;\r\n    cursor: pointer;\n}\n.row[data-v-535280e2] {\r\n    margin-bottom: 1em;\n}\r\n\r\n",""]);const s=a},1594:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.normal-text[data-v-18164924] {\r\n    font-weight: normal;\n}\n.row[data-v-18164924] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},3341:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.normal-text[data-v-cdcf59d2] {\n    font-weight: normal;\n}\n",""]);const s=a},5587:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.modal-container[data-v-e00d3244] {\r\n    min-height: 50vh;\n}\n.srow[data-v-e00d3244] {\r\n    margin-top: 1em;\n}\r\n",""]);const s=a},1079:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-0c2fec68] {\n    margin-top: 1em;\n}\nul li[data-v-0c2fec68] {\n    list-style: none;\n    outline: 1px solid lightgray;\n    padding: 0.5em;\n}\n.actionbtns button[data-v-0c2fec68] {\n    width: 32%;\n    padding: 0;\n}\n",""]);const s=a},9243:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-0140c82b] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},6634:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-cda7f9de], .srow[data-v-cda7f9de] {\n    margin-top: 1em;\n}\n",""]);const s=a},7721:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,'\n.img-preview > span[data-v-66f7b61c] {\n    border: 1px solid lightgray;\n    padding: 0.3em;\n    width: 150px;\n}\n#imgPreview[data-v-66f7b61c] {\n    width: 150px;\n}\n.img-result[data-v-66f7b61c]:hover {\n    outline: 2px solid black;\n}\n.srow[data-v-66f7b61c] {\n    margin-top: 1em;\n}\n.colorSelector button[aria-selected="true"][data-v-66f7b61c] {\n    outline: 5px dashed darkblue;\n}\n.colorSelector button[data-v-66f7b61c] {\n    margin-right: 0.5em;\n    padding: 0;\n    line-height: 1em;\n    height: 1.5em;\n    width: 3.5em;\n}\n@media (max-width: 850px) {\n#inputSearch[data-v-66f7b61c] {\n        width: 80%;\n}\n}\n',""]);const s=a},2634:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-4eec4ae4] {\r\n    margin-bottom: 1em;\n}\nh2[data-v-4eec4ae4] {\r\n    font-size: 1.2em;\r\n    margin-top: 1.5em;\r\n    margin-bottom: 0.7em;\n}\r\n",""]);const s=a},7580:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-03df22e8] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},6788:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nli[data-v-70d70ab6] {\r\n    border: 1px solid gray;\r\n    margin-bottom: 0;\n}\nli > .row[data-v-70d70ab6] {\r\n    margin: 0;\n}\nbutton[data-v-70d70ab6] {\r\n    margin-bottom: 0;\r\n    flex-grow: 1;\r\n    flex-shrink: 1;\r\n    padding: 0;\n}\n.bg-gray[data-v-70d70ab6] {\r\n    background-color: lightgray;\n}\n.tag[data-v-70d70ab6] {\r\n    background-color: #41b883;\r\n    flex-basis: min-content;\r\n    flex-shrink: 1;\r\n    margin: 0.3em 0.3em 0.3em 0;\r\n    border-radius: 5px;\n}\n.value[data-v-70d70ab6] {\r\n    min-width: 4em;\n}\n.lang-tag[data-v-70d70ab6] {\r\n    background-color: lightblue;\r\n    border-radius: 5px;\n}\n@media (max-width: 575px) {\nli[data-v-70d70ab6] {\r\n        margin-bottom: 0.8em;\n}\n}\r\n",""]);const s=a},7065:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-0e17f0f0] {\r\n    margin-bottom: 1em;\n}\n.modal-container[data-v-0e17f0f0] {\r\n    min-height: 50vh;\n}\r\n",""]);const s=a},9704:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-3c021fc0] {\n    margin-top: 1em;\n}\n",""]);const s=a},6428:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-dfa50f10] {\n    margin-top: 1em;\n}\n",""]);const s=a},3468:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-15799f37] {\n    margin-top: 1em;\n}\nh2[data-v-15799f37] {\n    margin-top: 2em;\n}\n",""]);const s=a},5139:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-9f5001ea] {\n    margin-top: 0.5em;\n}\nul[data-v-9f5001ea] {\n    list-style-type: none;\n}\nh2[data-v-9f5001ea] {\n    font-weight: normal;\n    font-size: 1.1em;\n    margin-top: 1em;\n    margin-bottom: 0.5em;\n}\n",""]);const s=a},1660:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-a50779f2] {\n    margin-top: 1em;\n}\nh2[data-v-a50779f2] {\n    margin-top: 2em;\n}\n",""]);const s=a},6093:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-322ab068] {\r\n    margin-bottom: 1em;\n}\n.modal-container[data-v-322ab068] {\r\n    min-height: 50vh;\n}\r\n",""]);const s=a},532:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.srow[data-v-4a48b089] {\n    margin-top: 1em;\n}\n.btn-accordion[data-v-4a48b089] {\n    background-color: white;\n    border-style: solid;\n    border-color: gray;\n    border-width: 1px;\n    text-align: left;\n    border-left: none;\n    border-right: none;\n}\n.btn-accordion:hover span[data-v-4a48b089] {\n    color: cornflowerblue;\n}\n",""]);const s=a},4248:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.warn[data-v-1a571368] {\n    margin-top: 2em;\n}\n",""]);const s=a},8949:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.warn[data-v-a950d5c8] {\n    margin-top: 2em;\n}\n",""]);const s=a},2599:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.warn[data-v-9517896a] {\n    margin-top: 2em;\n}\n.slidergroup input[data-v-9517896a] {\n    width: 50%;\n}\n",""]);const s=a},6686:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.warn[data-v-09b28fd3] {\n    margin-top: 2em;\n}\n",""]);const s=a},8376:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.area[data-v-64127c7e] {\n    width: 60%;\n    padding-top: 60%;\n    position: relative;\n}\n.area-row[data-v-64127c7e], .area-column[data-v-64127c7e] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.area-element[data-v-64127c7e] {\n    position: absolute;\n}\n.area-element-inner[data-v-64127c7e] {\n    border: 1px solid gray;\n    border-radius: 5px;\n    position: relative;\n    width: 90%;\n    height: 90%;\n    margin: 5%;\n    background-color: lightblue;\n    z-index: 100;\n}\n.active[data-v-64127c7e] {\n    outline: 3px solid red;\n}\n.inactive[data-v-64127c7e] {\n    background-color: whitesmoke !important;\n    animation: none !important;\n}\n.selected[data-v-64127c7e] {\n    -webkit-animation: background-64127c7e 5s cubic-bezier(1,0,0,1) !important;\n    animation: background-64127c7e 5s cubic-bezier(1,0,0,1) !important;\n}\n.mouseentered[data-v-64127c7e] {\n    outline: 3px solid green !important;\n    background-color: lightgreen;\n}\n@-webkit-keyframes background-64127c7e {\n0% { background-color: dodgerblue;\n}\n100% { background-color: lightblue;\n}\n}\n@keyframes background-64127c7e {\n0% { background-color: dodgerblue;\n}\n100% { background-color: lightblue;\n}\n}\n",""]);const s=a},5908:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-02bd3c28] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},1517:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-5e9d9014] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},4924:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.row[data-v-1a4a946f] {\r\n    margin-bottom: 1em;\n}\n.actionBtn[data-v-1a4a946f] {\r\n    margin: 0;\r\n    padding: 0.25em;\r\n    line-height: 1;\n}\r\n",""]);const s=a},4730:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.modal-container[data-v-4f0f7305] {\r\n    min-height: 50vh;\n}\n.row[data-v-4f0f7305] {\r\n    margin-bottom: 1em;\n}\r\n",""]);const s=a},7582:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.biggerFont[data-v-739279ab] {\n    font-size: 1.3em;\n}\n",""]);const s=a},4690:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.modal-container[data-v-7244f760] {\r\n    min-height: 50vh;\n}\ninput[data-v-7244f760], button[data-v-7244f760] {\r\n    border-width: 1px;\n}\r\n",""]);const s=a},6460:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.modal-body[data-v-107717fa] {\r\n    margin-top: 0;\n}\n.srow[data-v-107717fa] {\r\n    margin-top: 1em;\n}\r\n",""]);const s=a},8649:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nlabel[data-v-20bf73f4] {\r\n    margin-bottom: 0;\n}\r\n",""]);const s=a},6234:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.modal-body[data-v-455ee238] {\r\n    margin-top: 0;\n}\r\n",""]);const s=a},9972:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.number-row[data-v-ef27eb6a] {\n    width: 60%;\n    margin: 0 auto;\n}\n.modal-body button[data-v-ef27eb6a] {\n    width: 30%;\n    padding: 3% 0;\n    margin-right: 3%;\n    font-size: 2.5em;\n}\n",""]);const s=a},8201:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.content[data-v-19da73e0] {\n    display: flex;\n    flex-direction: column;\n    flex: 1 0 auto;\n}\nh2[data-v-19da73e0] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-19da73e0] {\n    margin-bottom: 0.5em;\n    margin-top: 1.5em;\n}\n.srow[data-v-19da73e0] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},1772:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.content[data-v-74556b0e] {\n    display: flex;\n    flex-direction: column;\n    flex: 1 0 auto;\n}\n.srow[data-v-74556b0e] {\n    margin-bottom: 1.0em;\n}\n.fa-info-circle[data-v-74556b0e] {\n    color: blue;\n    margin-left: 3px;\n}\n",""]);const s=a},9152:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,'\ninput[data-v-fcc894a4] {\n    margin-bottom: 1em;\n}\n.all-dicts-view li[data-v-fcc894a4] {\n    list-style-type: none;\n}\n.all-dicts-view a[data-v-fcc894a4] {\n    font-size: 1.2em;\n}\n.actionbuttons button[data-v-fcc894a4] {\n    width: 25%;\n    padding: 0 1vh;\n    margin: 0.5vh 0.5vw;\n}\n.all-dicts-view .small-button[data-v-fcc894a4] {\n    padding: 0;\n    margin-left: 0.5em;\n    line-height: normal;\n    width: 25px;\n    height: 25px;\n}\n.all-dicts-view .table-headers[data-v-fcc894a4] {\n    margin-top: 1.0em;\n}\n.edit-container[data-v-fcc894a4] {\n    padding: 1em;\n}\n@media (min-width: 751px) {\n.edit-container[data-v-fcc894a4] {\n        background-color: whitesmoke;\n        margin-right: 1em;\n        padding: 1em;\n}\n}\n\n/* Smaller than tablet */\n@media (max-width: 850px) {\n.all-dicts-view a[data-v-fcc894a4] {\n        font-size: 1.3em;\n        margin-top: 1.5em;\n}\n.all-dicts-view input[type="text"][data-v-fcc894a4] {\n        height: 1.3em;\n        font-size: 1.3em;\n}\n.all-dicts-view .small-button[data-v-fcc894a4] {\n        width: 30px;\n        height: 30px;\n}\n.dict-table-elem[data-v-fcc894a4] {\n        outline: 1px solid lightgray;\n        padding: 0.5em;\n        margin-right: 1em;\n}\n}\n',""]);const s=a},8770:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nheader[data-v-0beb9b93] {\r\n    border: 0;\n}\n.content[data-v-0beb9b93] {\r\n    outline: 2px solid lightgray;\n}\r\n",""]);const s=a},6999:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh2[data-v-6db3f962], h1[data-v-6db3f962] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-6db3f962] {\n    margin-bottom: 0.5em;\n    margin-top: 1.5em;\n}\nli[data-v-6db3f962] {\n    margin-top: 0.5em;\n}\nul[data-v-6db3f962] {\n    list-style-position: outside;\n    padding-left: 2em;\n    margin-top: 1em;\n}\n",""]);const s=a},4205:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.content[data-v-0fa7429a] {\n    display: flex;\n    flex-direction: column;\n    flex: 1 0 auto;\n}\n.srow[data-v-0fa7429a] {\n    margin-bottom: 1.0em;\n}\n.saved-user[data-v-0fa7429a] {\n    outline: 1px solid lightgray;\n    padding: 1.0em;\n}\n.loggedIn .fa-user[data-v-0fa7429a] {\n    color: black;\n}\n.fa-user[data-v-0fa7429a] {\n    color: gray;\n}\n.fa-info-circle[data-v-0fa7429a] {\n    color: blue;\n    margin-left: 3px;\n}\n",""]);const s=a},4266:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh1[data-v-500d6526] {\n    margin-top: 1.5em;\n    margin-bottom: 0.5em;\n}\n.all-grids-view li[data-v-500d6526] {\n    list-style-type: none;\n}\n#globalGridActions button[data-v-500d6526] {\n    width: 30%;\n    padding: 0 1vh;\n    margin: 0.5vh 0.5vw;\n}\n#globalGridActions[data-v-500d6526] {\n    display: flex;\n}\n.all-grids-view a[data-v-500d6526] {\n    font-size: 1.2em;\n}\n.action-buttons button[data-v-500d6526] {\n    width: 13.5%;\n    margin-right: 0.5em;\n    padding: 0 20px;\n}\n\n/* Smaller than tablet */\n@media (max-width: 850px) {\n.all-grids-view a[data-v-500d6526] {\n        font-size: 1.3em;\n        margin-top: 1.5em;\n}\n#globalGridActions button[data-v-500d6526] {\n        display: block;\n        width: 100%;\n        padding: 0 1vh;\n        margin: 0.5vh 0.5vw;\n}\n#globalGridActions[data-v-500d6526] {\n        display: block;\n        padding-right: 1.5em;\n}\n.action-buttons button[data-v-500d6526] {\n        padding: 0;\n        margin-right: 2%;\n}\n}\n",""]);const s=a},6987:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.content[data-v-2f812c7c] {\n    display: flex;\n    flex-direction: column;\n    flex: 1 0 auto;\n}\n.srow[data-v-2f812c7c] {\n    margin-bottom: 1.0em;\n}\n.more-space[data-v-2f812c7c] {\n    margin-bottom: 1.5em !important;\n}\n.fa-info-circle[data-v-2f812c7c] {\n    color: blue;\n    margin-left: 3px;\n}\n@media (min-width: 850px) {\n.inputlabel[data-v-2f812c7c] {\n        text-align: right;\n}\n}\n",""]);const s=a},6752:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.content[data-v-2baa5fd6] {\n    display: flex;\n    flex-direction: column;\n    flex: 1 0 auto;\n}\nh2[data-v-2baa5fd6] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-2baa5fd6] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-2baa5fd6] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},1377:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh2[data-v-0a80ce99] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-0a80ce99] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-0a80ce99] {\n    margin-bottom: 1.5em;\n}\n.settings-area[data-v-0a80ce99] {\n    border-right: 1px solid lightgray;\n}\n@media (max-width: 849px) {\n.settings-area[data-v-0a80ce99] {\n        border-right: 0;\n}\n}\n",""]);const s=a},8138:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.fa-info-circle[data-v-769e9f59] {\n    color: #266697;\n    margin-right: 0.25em;\n}\nh2[data-v-769e9f59] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-769e9f59] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-769e9f59] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},2792:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh2[data-v-699a0ed2] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-699a0ed2] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-699a0ed2] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},4142:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.fa-info-circle[data-v-17d53b07] {\n    color: #266697;\n    margin-right: 0.25em;\n}\nh2[data-v-17d53b07] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-17d53b07] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-17d53b07] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},1620:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\n.fa-info-circle[data-v-57c27e70] {\n    color: #266697;\n    margin-right: 0.25em;\n}\nh2[data-v-57c27e70] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-57c27e70] {\n    margin-bottom: 0.5em;\n}\n.srow[data-v-57c27e70] {\n    margin-bottom: 1.5em;\n}\n",""]);const s=a},9858:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"\nh2[data-v-9f5c7004] {\n    margin-bottom: 0.5em;\n}\nh3[data-v-9f5c7004] {\n    margin-bottom: 0.5em;\n}\nli[data-v-9f5c7004] {\n    margin-bottom: 0;\n    list-style-type: none;\n    margin-left: 0.5em;\n}\nul[data-v-9f5c7004] {\n    margin-bottom: 0.5em;\n}\n.fa-check[data-v-9f5c7004] {\n    color: green;\n    margin-right: 1em;\n}\n.fa-info-circle[data-v-9f5c7004] {\n    color: #266697;\n    margin-right: 0.5em;\n}\n",""]);const s=a},9313:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,'fieldset[disabled] .multiselect{pointer-events:none}.multiselect__spinner{position:absolute;right:1px;top:1px;width:40px;height:38px;background:#fff;display:block}.multiselect__spinner:after,.multiselect__spinner:before{position:absolute;content:"";top:50%;left:50%;margin:-8px 0 0 -8px;width:16px;height:16px;border-radius:100%;border:2px solid transparent;border-top-color:#41b883;-webkit-box-shadow:0 0 0 1px transparent;box-shadow:0 0 0 1px transparent}.multiselect__spinner:before{-webkit-animation:spinning 2.4s cubic-bezier(.41,.26,.2,.62);animation:spinning 2.4s cubic-bezier(.41,.26,.2,.62);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}.multiselect__spinner:after{-webkit-animation:spinning 2.4s cubic-bezier(.51,.09,.21,.8);animation:spinning 2.4s cubic-bezier(.51,.09,.21,.8);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}.multiselect__loading-enter-active,.multiselect__loading-leave-active{-webkit-transition:opacity .4s ease-in-out;transition:opacity .4s ease-in-out;opacity:1}.multiselect__loading-enter,.multiselect__loading-leave-active{opacity:0}.multiselect,.multiselect__input,.multiselect__single{font-family:inherit;font-size:16px;-ms-touch-action:manipulation;touch-action:manipulation}.multiselect{-webkit-box-sizing:content-box;box-sizing:content-box;display:block;position:relative;width:100%;min-height:40px;text-align:left;color:#35495e}.multiselect *{-webkit-box-sizing:border-box;box-sizing:border-box}.multiselect:focus{outline:none}.multiselect--disabled{background:#ededed;pointer-events:none;opacity:.6}.multiselect--active{z-index:50}.multiselect--active:not(.multiselect--above) .multiselect__current,.multiselect--active:not(.multiselect--above) .multiselect__input,.multiselect--active:not(.multiselect--above) .multiselect__tags{border-bottom-left-radius:0;border-bottom-right-radius:0}.multiselect--active .multiselect__select{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.multiselect--above.multiselect--active .multiselect__current,.multiselect--above.multiselect--active .multiselect__input,.multiselect--above.multiselect--active .multiselect__tags{border-top-left-radius:0;border-top-right-radius:0}.multiselect__input,.multiselect__single{position:relative;display:inline-block;min-height:20px;line-height:20px;border:none;border-radius:5px;background:#fff;padding:0 0 0 5px;width:100%;-webkit-transition:border .1s ease;transition:border .1s ease;-webkit-box-sizing:border-box;box-sizing:border-box;margin-bottom:8px;vertical-align:top}.multiselect__input::-webkit-input-placeholder{color:#35495e}.multiselect__input::-moz-placeholder{color:#35495e}.multiselect__input:-ms-input-placeholder{color:#35495e}.multiselect__input::-ms-input-placeholder{color:#35495e}.multiselect__input::placeholder{color:#35495e}.multiselect__tag~.multiselect__input,.multiselect__tag~.multiselect__single{width:auto}.multiselect__input:hover,.multiselect__single:hover{border-color:#cfcfcf}.multiselect__input:focus,.multiselect__single:focus{border-color:#a8a8a8;outline:none}.multiselect__single{padding-left:5px;margin-bottom:8px}.multiselect__tags-wrap{display:inline}.multiselect__tags{min-height:40px;display:block;padding:8px 40px 0 8px;border-radius:5px;border:1px solid #e8e8e8;background:#fff;font-size:14px}.multiselect__tag{position:relative;display:inline-block;padding:4px 26px 4px 10px;border-radius:5px;margin-right:10px;color:#fff;line-height:1;background:#41b883;margin-bottom:5px;white-space:nowrap;overflow:hidden;max-width:100%;text-overflow:ellipsis}.multiselect__tag-icon{cursor:pointer;margin-left:7px;position:absolute;right:0;top:0;bottom:0;font-weight:700;font-style:normal;width:22px;text-align:center;line-height:22px;-webkit-transition:all .2s ease;transition:all .2s ease;border-radius:5px}.multiselect__tag-icon:after{content:"\\D7";color:#266d4d;font-size:14px}.multiselect__tag-icon:focus,.multiselect__tag-icon:hover{background:#369a6e}.multiselect__tag-icon:focus:after,.multiselect__tag-icon:hover:after{color:#fff}.multiselect__current{min-height:40px;overflow:hidden;padding:8px 30px 0 12px;white-space:nowrap;border-radius:5px;border:1px solid #e8e8e8}.multiselect__current,.multiselect__select{line-height:16px;-webkit-box-sizing:border-box;box-sizing:border-box;display:block;margin:0;text-decoration:none;cursor:pointer}.multiselect__select{position:absolute;width:40px;height:38px;right:1px;top:1px;padding:4px 8px;text-align:center;-webkit-transition:-webkit-transform .2s ease;transition:-webkit-transform .2s ease;transition:transform .2s ease;transition:transform .2s ease,-webkit-transform .2s ease}.multiselect__select:before{position:relative;right:0;top:65%;color:#999;margin-top:4px;border-color:#999 transparent transparent;border-style:solid;border-width:5px 5px 0;content:""}.multiselect__placeholder{color:#adadad;display:inline-block;margin-bottom:10px;padding-top:2px}.multiselect--active .multiselect__placeholder{display:none}.multiselect__content-wrapper{position:absolute;display:block;background:#fff;width:100%;max-height:240px;overflow:auto;border:1px solid #e8e8e8;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px;z-index:50;-webkit-overflow-scrolling:touch}.multiselect__content{list-style:none;display:inline-block;padding:0;margin:0;min-width:100%;vertical-align:top}.multiselect--above .multiselect__content-wrapper{bottom:100%;border-bottom-left-radius:0;border-bottom-right-radius:0;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom:none;border-top:1px solid #e8e8e8}.multiselect__content::webkit-scrollbar{display:none}.multiselect__element{display:block}.multiselect__option{display:block;padding:12px;min-height:40px;line-height:16px;text-decoration:none;text-transform:none;vertical-align:middle;position:relative;cursor:pointer;white-space:nowrap}.multiselect__option:after{top:0;right:0;position:absolute;line-height:40px;padding-right:12px;padding-left:20px;font-size:13px}.multiselect__option--highlight{background:#41b883;outline:none;color:#fff}.multiselect__option--highlight:after{content:attr(data-select);background:#41b883;color:#fff}.multiselect__option--selected{background:#f3f3f3;color:#35495e;font-weight:700}.multiselect__option--selected:after{content:attr(data-selected);color:silver;background:inherit}.multiselect__option--selected.multiselect__option--highlight{background:#ff6a6a;color:#fff}.multiselect__option--selected.multiselect__option--highlight:after{background:#ff6a6a;content:attr(data-deselect);color:#fff}.multiselect--disabled .multiselect__current,.multiselect--disabled .multiselect__select{background:#ededed;color:#a6a6a6}.multiselect__option--disabled{background:#ededed!important;color:#a6a6a6!important;cursor:text;pointer-events:none}.multiselect__option--group{background:#ededed;color:#35495e}.multiselect__option--group.multiselect__option--highlight{background:#35495e;color:#fff}.multiselect__option--group.multiselect__option--highlight:after{background:#35495e}.multiselect__option--disabled.multiselect__option--highlight{background:#dedede}.multiselect__option--group-selected.multiselect__option--highlight{background:#ff6a6a;color:#fff}.multiselect__option--group-selected.multiselect__option--highlight:after{background:#ff6a6a;content:attr(data-deselect);color:#fff}.multiselect-enter-active,.multiselect-leave-active{-webkit-transition:all .15s ease;transition:all .15s ease}.multiselect-enter,.multiselect-leave-active{opacity:0}.multiselect__strong{margin-bottom:8px;line-height:20px;display:inline-block;vertical-align:top}[dir=rtl] .multiselect{text-align:right}[dir=rtl] .multiselect__select{right:auto;left:1px}[dir=rtl] .multiselect__tags{padding:8px 8px 0 40px}[dir=rtl] .multiselect__content{text-align:right}[dir=rtl] .multiselect__option:after{right:auto;left:0}[dir=rtl] .multiselect__clear{right:auto;left:12px}[dir=rtl] .multiselect__spinner{right:auto;left:1px}@-webkit-keyframes spinning{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(2turn);transform:rotate(2turn)}}@keyframes spinning{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(2turn);transform:rotate(2turn)}}',""]);const s=a},5335:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,".grid-container {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  bottom: 0;\r\n  right: 0;\r\n  overflow-y: hidden;\r\n}\r\n.grid {\r\n  position: relative;\r\n  height: 97%;\r\n  list-style: none;\r\n  /* Will be modified by the grid jquery lib, depending on the items */\r\n  -webkit-transition: width 0.2s,\r\n  height 0.2s;\r\n  transition: width 0.2s,\r\n  height 0.2s;\r\n  padding: 0;\r\n  margin-top: 10px;\r\n  margin-bottom: 10px;\r\n  -webkit-padding-start: 0;\r\n}\r\n.grid li {\r\n  position: absolute;\r\n  z-index: 1;\r\n  font-weight: bold;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  -webkit-transition: top 0.2s,\r\n  left 0.2s,\r\n  width 0.2s,\r\n  height 0.2s,\r\n  font-size 0.2s,\r\n  line-height 0.2s;\r\n  transition: top 0.2s,\r\n  left 0.2s,\r\n  width 0.2s,\r\n  height 0.2s,\r\n  font-size 0.2s,\r\n  line-height 0.2s;\r\n}\r\n.grid li .grid-item-content, .grid-item-content-placeholder {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  border-radius: 0.5em;\r\n  margin-left: 10px;\r\n  margin-bottom: 10px;\r\n}\r\n.grid-item-content.marked {\r\n  outline: 5px solid green !important;\r\n}\r\n\r\n.grid li.ui-draggable-dragging {\r\n  -webkit-transition: none;\r\n  transition: none;\r\n}\r\n.grid li.position-highlight {\r\n  -webkit-transition: none;\r\n  transition: none;\r\n}\r\n.grid li.position-highlight .grid-item-content-placeholder {\r\n  outline-style: dotted;\r\n  outline-width: 2px;\r\n  outline-color: darkgray;\r\n  background: #e6e6e6;\r\n}",""]);const s=a},4497:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,"/* see https://flexbox.ninja/demos/holy-grail-layout/\r\n*/\r\n\r\n/**\r\n * Make body at least 100% height\r\n * You can also use a combination\r\n * of height: 100% in <html> and\r\n * min-height: 100% in <body>.\r\n */\r\n.holy-grail {\r\n    /*min-height: 100vh;*/\r\n    height: 100%;\r\n    width: 100%;\r\n    position: fixed;\r\n}\r\n\r\n/**\r\n * Let's do a column distribution\r\n * (mobile first)\r\n * flex value is 1 1 auto to make\r\n * body skrinkable and extensible\r\n */\r\n.holy-grail,\r\n.holy-grail-body {\r\n    display: flex;\r\n    flex: 1 1 auto;\r\n    flex-direction: row;\r\n}\r\n\r\n/**\r\n * Content body item is made\r\n * extensible too.\r\n */\r\n.holy-grail-content {\r\n    flex: 1 1 auto;\r\n}\r\n\r\n/**\r\n * Put the first sidebar before content.\r\n * If you need sidebar to be before content\r\n * only in big screen put those 3 next lines\r\n * in @media block.\r\n */\r\n.holy-grail-sidebar-1 {\r\n    order: -1;\r\n    border-right: 2px solid lightgray;\r\n    max-height: 98vh;\r\n    overflow-x: hidden;\r\n    padding-top: 2vh;\r\n    display: flex;\r\n    flex-flow: column;\r\n}\r\n\r\n/**\r\n * Sidebars have a basic 260 width\r\n * and are not really flexible anymore\r\n */\r\n.hg-sidebar {\r\n    flex: 0 0 250px;\r\n    z-index: 3;\r\n}\r\n\r\nnav li:focus {\r\n    outline: none;\r\n}\r\n\r\n@media (max-width: 850px) {\r\n    .hg-sidebar {\r\n        flex: 0 0 50px;\r\n    }\r\n\r\n    #astericsIcon {\r\n        margin-bottom: 1em;\r\n    }\r\n\r\n    nav li button {\r\n        padding-left: 0.5em;\r\n    }\r\n\r\n    .hg-sidebar button {\r\n        padding-left: 0;\r\n        padding-right: 0;\r\n        text-align: center;\r\n    }\r\n}\r\n\r\n@media (max-width: 850px) and (max-height: 500px) {\r\n    .hg-sidebar {\r\n        flex: 0 0 12vh;\r\n    }\r\n\r\n    .hg-sidebar button, #syncVisualization {\r\n        font-size: 3vh;\r\n        line-height: 0;\r\n    }\r\n\r\n    #astericsIcon {\r\n        height: 10vh;\r\n    }\r\n\r\n    header button, header a, header input {\r\n        height: 10vh !important;\r\n        max-height: 40px;\r\n        font-size: 4vh;\r\n        line-height: 0;\r\n    }\r\n}",""]);const s=a},5351:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,'@charset "UTF-8";\r\n/*!\r\n * jQuery contextMenu - Plugin for simple contextMenu handling\r\n *\r\n * Version: v2.7.0\r\n *\r\n * Authors: Björn Brala (SWIS.nl), Rodney Rehm, Addy Osmani (patches for FF)\r\n * Web: http://swisnl.github.io/jQuery-contextMenu/\r\n *\r\n * Copyright (c) 2011-2018 SWIS BV and contributors\r\n *\r\n * Licensed under\r\n *   MIT License http://www.opensource.org/licenses/mit-license\r\n *\r\n * Date: 2018-07-12T09:06:55.859Z\r\n */\r\n@-webkit-keyframes cm-spin {\r\n  0% {\r\n    -webkit-transform: translateY(-50%) rotate(0deg);\r\n            transform: translateY(-50%) rotate(0deg);\r\n  }\r\n  100% {\r\n    -webkit-transform: translateY(-50%) rotate(359deg);\r\n            transform: translateY(-50%) rotate(359deg);\r\n  }\r\n}\r\n@-o-keyframes cm-spin {\r\n  0% {\r\n    -webkit-transform: translateY(-50%) rotate(0deg);\r\n         -o-transform: translateY(-50%) rotate(0deg);\r\n            transform: translateY(-50%) rotate(0deg);\r\n  }\r\n  100% {\r\n    -webkit-transform: translateY(-50%) rotate(359deg);\r\n         -o-transform: translateY(-50%) rotate(359deg);\r\n            transform: translateY(-50%) rotate(359deg);\r\n  }\r\n}\r\n@keyframes cm-spin {\r\n  0% {\r\n    -webkit-transform: translateY(-50%) rotate(0deg);\r\n         -o-transform: translateY(-50%) rotate(0deg);\r\n            transform: translateY(-50%) rotate(0deg);\r\n  }\r\n  100% {\r\n    -webkit-transform: translateY(-50%) rotate(359deg);\r\n         -o-transform: translateY(-50%) rotate(359deg);\r\n            transform: translateY(-50%) rotate(359deg);\r\n  }\r\n}\r\n\r\n.context-menu-icon::before {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 0;\r\n  width: 2em; \r\n  font-family: "context-menu-icons";\r\n  font-size: 1em;\r\n  font-style: normal;\r\n  font-weight: normal;\r\n  line-height: 1;\r\n  color: #2980b9;\r\n  text-align: center;\r\n  -webkit-transform: translateY(-50%);\r\n      -ms-transform: translateY(-50%);\r\n       -o-transform: translateY(-50%);\r\n          transform: translateY(-50%);\r\n\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n}\r\n\r\n.context-menu-icon.context-menu-hover:before {\r\n  color: #fff;\r\n}\r\n\r\n.context-menu-icon.context-menu-disabled::before {\r\n  color: #bbb;\r\n}\r\n\r\n.context-menu-icon.context-menu-icon-loading:before {\r\n  -webkit-animation: cm-spin 2s infinite;\r\n       -o-animation: cm-spin 2s infinite;\r\n          animation: cm-spin 2s infinite;\r\n}\r\n\r\n.context-menu-icon.context-menu-icon--fa {\r\n  display: list-item;\r\n  font-family: inherit;\r\n  line-height: inherit;\r\n}\r\n.context-menu-icon.context-menu-icon--fa::before {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 0;\r\n  width: 2em; \r\n  font-family: FontAwesome;\r\n  font-size: 1em;\r\n  font-style: normal;\r\n  font-weight: normal;\r\n  line-height: 1;\r\n  color: #2980b9;\r\n  text-align: center;\r\n  -webkit-transform: translateY(-50%);\r\n      -ms-transform: translateY(-50%);\r\n       -o-transform: translateY(-50%);\r\n          transform: translateY(-50%);\r\n\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n}\r\n.context-menu-icon.context-menu-icon--fa.context-menu-hover:before {\r\n  color: #fff;\r\n}\r\n.context-menu-icon.context-menu-icon--fa.context-menu-disabled::before {\r\n  color: #bbb;\r\n}\r\n\r\n.context-menu-icon.context-menu-icon--fa5 {\r\n  display: list-item;\r\n  font-family: inherit;\r\n  line-height: inherit;\r\n}\r\n.context-menu-icon.context-menu-icon--fa5 i, .context-menu-icon.context-menu-icon--fa5 svg {\r\n  position: absolute;\r\n  top: .3em; \r\n  left: .5em;\r\n  color: #2980b9;\r\n}\r\n.context-menu-icon.context-menu-icon--fa5.context-menu-hover > i, .context-menu-icon.context-menu-icon--fa5.context-menu-hover svg {\r\n  color: #fff;\r\n}\r\n.context-menu-icon.context-menu-icon--fa5.context-menu-disabled i, .context-menu-icon.context-menu-icon--fa5.context-menu-disabled svg {\r\n  color: #bbb;\r\n}\r\n\r\n.context-menu-list {\r\n  position: absolute; \r\n  display: inline-block;\r\n  min-width: 13em;\r\n  max-width: 26em;\r\n  padding: .25em 0;\r\n  margin: .3em;\r\n  font-family: inherit;\r\n  font-size: inherit;\r\n  list-style-type: none;\r\n  background: #fff;\r\n  border: 1px solid #bebebe;\r\n  border-radius: .2em;\r\n  -webkit-box-shadow: 0 2px 5px rgba(0, 0, 0, .5);\r\n          box-shadow: 0 2px 5px rgba(0, 0, 0, .5);\r\n}\r\n\r\n.context-menu-item {\r\n  position: relative;\r\n  -webkit-box-sizing: content-box;\r\n     -moz-box-sizing: content-box;\r\n          box-sizing: content-box;\r\n  padding: .2em 2em;\r\n  color: #2f2f2f;\r\n  -webkit-user-select: none;\r\n     -moz-user-select: none;\r\n      -ms-user-select: none;\r\n          user-select: none; \r\n  background-color: #fff;\r\n}\r\n\r\n.context-menu-separator {\r\n  padding: 0; \r\n  margin: .35em 0;\r\n  border-bottom: 1px solid #e6e6e6;\r\n}\r\n\r\n.context-menu-item > label > input,\r\n.context-menu-item > label > textarea {\r\n  -webkit-user-select: text;\r\n     -moz-user-select: text;\r\n      -ms-user-select: text;\r\n          user-select: text;\r\n}\r\n\r\n.context-menu-item.context-menu-hover {\r\n  color: #fff;\r\n  cursor: pointer; \r\n  background-color: #2980b9;\r\n}\r\n\r\n.context-menu-item.context-menu-disabled {\r\n  color: #bbb;\r\n  cursor: default; \r\n  background-color: #fff;\r\n}\r\n\r\n.context-menu-input.context-menu-hover {\r\n  color: #2f2f2f; \r\n  cursor: default;\r\n}\r\n\r\n.context-menu-submenu:after {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: .5em;\r\n  z-index: 1; \r\n  width: 0;\r\n  height: 0;\r\n  content: \'\';\r\n  border-color: transparent transparent transparent #2f2f2f;\r\n  border-style: solid;\r\n  border-width: .25em 0 .25em .25em;\r\n  -webkit-transform: translateY(-50%);\r\n      -ms-transform: translateY(-50%);\r\n       -o-transform: translateY(-50%);\r\n          transform: translateY(-50%);\r\n}\r\n\r\n/**\r\n * Inputs\r\n */\r\n.context-menu-item.context-menu-input {\r\n  padding: .3em .6em;\r\n}\r\n\r\n/* vertically align inside labels */\r\n.context-menu-input > label > * {\r\n  vertical-align: top;\r\n}\r\n\r\n/* position checkboxes and radios as icons */\r\n.context-menu-input > label > input[type="checkbox"],\r\n.context-menu-input > label > input[type="radio"] {\r\n  position: relative;\r\n  top: .12em; \r\n  margin-right: .4em;\r\n}\r\n\r\n.context-menu-input > label {\r\n  margin: 0;\r\n}\r\n\r\n.context-menu-input > label,\r\n.context-menu-input > label > input[type="text"],\r\n.context-menu-input > label > textarea,\r\n.context-menu-input > label > select {\r\n  display: block;\r\n  width: 100%; \r\n  -webkit-box-sizing: border-box;\r\n     -moz-box-sizing: border-box;\r\n          box-sizing: border-box;\r\n}\r\n\r\n.context-menu-input > label > textarea {\r\n  height: 7em;\r\n}\r\n\r\n.context-menu-item > .context-menu-list {\r\n  top: .3em; \r\n  /* re-positioned by js */\r\n  right: -.3em;\r\n  display: none;\r\n}\r\n\r\n.context-menu-item.context-menu-visible > .context-menu-list {\r\n  display: block;\r\n}\r\n\r\n.context-menu-accesskey {\r\n  text-decoration: underline;\r\n}\r\n',""]);const s=a},9108:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(1601),i=n.n(r),o=n(6314),a=n.n(o)()(i());a.push([e.id,'.modal h1 {\r\n    font-size: 1.5em;\r\n}\r\n\r\n.modal-mask {\r\n    position: fixed;\r\n    z-index: 9998;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: rgba(0, 0, 0, .5);\r\n    transition: opacity .3s ease;\r\n}\r\n\r\n.modal-wrapper {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 100%;\r\n}\r\n\r\n.modal-container-flex {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.modal-container {\r\n    width: 100%;\r\n    max-width: 920px;\r\n    max-height: 75vh;\r\n    margin: 0px auto;\r\n    padding: 2em 4em;\r\n    background-color: #fff;\r\n    border-radius: 2px;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, .33);\r\n    transition: all .3s ease;\r\n    font-family: Helvetica, Arial, sans-serif;\r\n    overflow-y: auto;\r\n    overflow-x: hidden;\r\n}\r\n\r\n@media (max-width: 850px) {\r\n    .modal-container {\r\n        padding: 2em;\r\n    }\r\n}\r\n\r\n.modal-footer-flex {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: flex-end;\r\n}\r\n\r\n.modal-footer {\r\n    margin-top: 3em;\r\n}\r\n\r\n.modal-header h3 {\r\nmargin-top: 0;\r\ncolor: #42b983;\r\n}\r\n\r\n.modal-body {\r\nmargin-top: 2.5em;\r\n}\r\n\r\n.modal-body img {\r\n    outline: 1px solid lightgray;\r\n}\r\n\r\n.testGrid img {\r\n    outline: 0;\r\n}\r\n\r\n.modal-body label {\r\nfont-weight: bold;\r\n}\r\n\r\n/*\r\n* The following styles are auto-applied to elements with\r\n* transition="modal" when their visibility is toggled\r\n* by Vue.js.\r\n*\r\n* You can easily play with the modal transition by editing\r\n* these styles.\r\n*/\r\n\r\n.modal-enter {\r\n    opacity: 0;\r\n}\r\n\r\n.modal-leave-active {\r\n    opacity: 0;\r\n}\r\n\r\n.modal-enter .modal-container,\r\n.modal-leave-active .modal-container {\r\n    -webkit-transform: scale(1.1);\r\n    transform: scale(1.1);\r\n}\r\n\r\n/* File input custom style */\r\n.file-input input[type="file"] {\r\n    position:absolute;\r\n    top: -1000px;\r\n}\r\n\r\n.close-button, .close-button:focus {\r\n    float: right;\r\n    padding: 0.5em 1em;\r\n    color: black;\r\n}\r\n\r\n.black, .black:focus {\r\n    color: black;\r\n}\r\n\r\n.blue {\r\n    color: #2d7bb4;\r\n}\r\n\r\n.modal h2 {\r\n    font-size: 1.3em;\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n.modal .srow {\r\n    margin-top: 1em;\r\n}\r\n\r\n.modal .warn {\r\n    font-weight: bold;\r\n    color: #c96a00;\r\n}\r\n\r\n.modal .success {\r\n    font-weight: bold;\r\n    color: darkgreen;\r\n}',""]);const s=a},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},1601:e=>{"use strict";e.exports=function(e){return e[1]}},7833:(e,t,n)=>{function r(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=n(9910)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=r,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(r())},9910:(e,t,n)=>{var r;function i(e){function n(){if(n.enabled){var e=n,i=+new Date,o=i-(r||i);e.diff=o,e.prev=r,e.curr=i,r=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;l++;var i=t.formatters[r];if("function"==typeof i){var o=a[l];n=i.call(e,o),a.splice(l,1),l--}return n})),t.formatArgs.call(e,a),(n.log||t.log||console.log.bind(console)).apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(6585),t.names=[],t.skips=[],t.formatters={}},3011:(e,t,n)=>{var r;!function(i){var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=10;function s(){this._events={},this._conf&&l.call(this,this._conf)}function l(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==i?e.maxListeners:a,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=a}function c(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var r=new Error(n);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,process.emitWarning(r)}else console.error(n),console.trace&&console.trace()}function d(e){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,l.call(this,e)}function u(e,t,n,r){if(!n)return[];var i,o,a,s,l,c,d,h=[],p=t.length,v=t[r],m=t[r+1];if(r===p&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,o=n._listeners.length;i<o;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===v||"**"===v||n[v]){if("*"===v){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(h=h.concat(u(e,t,n[a],r+1)));return h}if("**"===v){for(a in(d=r+1===p||r+2===p&&"*"===m)&&n._listeners&&(h=h.concat(u(e,t,n,p))),n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!d&&(h=h.concat(u(e,t,n[a],p))),h=h.concat(u(e,t,n[a],r))):h=a===m?h.concat(u(e,t,n[a],r+2)):h.concat(u(e,t,n[a],r)));return h}h=h.concat(u(e,t,n[v],r+1))}if((s=n["*"])&&u(e,t,s,r+1),l=n["**"])if(r<p)for(a in l._listeners&&u(e,t,l,p),l)"_listeners"!==a&&l.hasOwnProperty(a)&&(a===m?u(e,t,l[a],r+2):a===v?u(e,t,l[a],r+1):((c={})[a]=l[a],u(e,t,{"**":c},r+1)));else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return h}function h(e,t){for(var n=0,r=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;n+1<r;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var o=this.listenerTree,a=e.shift();a!==i;){if(o[a]||(o[a]={}),o=o[a],0===e.length)return o._listeners?("function"==typeof o._listeners&&(o._listeners=[o._listeners]),o._listeners.push(t),!o._listeners.warned&&this._maxListeners>0&&o._listeners.length>this._maxListeners&&(o._listeners.warned=!0,c.call(this,o._listeners.length,a))):o._listeners=t,!0;a=e.shift()}return!0}d.EventEmitter2=d,d.prototype.delimiter=".",d.prototype.setMaxListeners=function(e){e!==i&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},d.prototype.event="",d.prototype.once=function(e,t){return this._once(e,t,!1)},d.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},d.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},d.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},d.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},d.prototype._many=function(e,t,n,r){var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&i.off(e,o),n.apply(this,arguments)}return o._origin=n,this._on(e,o,r),i},d.prototype.emit=function(){this._events||s.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;var t,n,r,i,o,a=arguments.length;if(this._all&&this._all.length){if(o=this._all.slice(),a>3)for(t=new Array(a),i=0;i<a;i++)t[i]=arguments[i];for(r=0,n=o.length;r<n;r++)switch(this.event=e,a){case 1:o[r].call(this,e);break;case 2:o[r].call(this,e,arguments[1]);break;case 3:o[r].call(this,e,arguments[1],arguments[2]);break;default:o[r].apply(this,t)}}if(this.wildcard){o=[];var l="string"==typeof e?e.split(this.delimiter):e.slice();u.call(this,o,l,this.listenerTree,0)}else{if("function"==typeof(o=this._events[e])){switch(this.event=e,a){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];o.apply(this,t)}return!0}o&&(o=o.slice())}if(o&&o.length){if(a>3)for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];for(r=0,n=o.length;r<n;r++)switch(this.event=e,a){case 1:o[r].call(this);break;case 2:o[r].call(this,arguments[1]);break;case 3:o[r].call(this,arguments[1],arguments[2]);break;default:o[r].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},d.prototype.emitAsync=function(){this._events||s.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,r,i,o,a=[],l=arguments.length;if(this._all){if(l>3)for(t=new Array(l),i=1;i<l;i++)t[i]=arguments[i];for(r=0,n=this._all.length;r<n;r++)switch(this.event=e,l){case 1:a.push(this._all[r].call(this,e));break;case 2:a.push(this._all[r].call(this,e,arguments[1]));break;case 3:a.push(this._all[r].call(this,e,arguments[1],arguments[2]));break;default:a.push(this._all[r].apply(this,t))}}if(this.wildcard){o=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();u.call(this,o,c,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o)switch(this.event=e,l){case 1:a.push(o.call(this));break;case 2:a.push(o.call(this,arguments[1]));break;case 3:a.push(o.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];a.push(o.apply(this,t))}else if(o&&o.length){if(o=o.slice(),l>3)for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];for(r=0,n=o.length;r<n;r++)switch(this.event=e,l){case 1:a.push(o[r].call(this));break;case 2:a.push(o[r].call(this,arguments[1]));break;case 3:a.push(o[r].call(this,arguments[1],arguments[2]));break;default:a.push(o[r].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(a)},d.prototype.on=function(e,t){return this._on(e,t,!1)},d.prototype.prependListener=function(e,t){return this._on(e,t,!0)},d.prototype.onAny=function(e){return this._onAny(e,!1)},d.prototype.prependAny=function(e){return this._onAny(e,!0)},d.prototype.addListener=d.prototype.on,d.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},d.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||s.call(this),this.emit("newListener",e,t),this.wildcard?(h.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,c.call(this,this._events[e].length,e))):this._events[e]=t,this)},d.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var a="string"==typeof e?e.split(this.delimiter):e.slice();r=u.call(this,null,a,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var s=0;s<r.length;s++){var l=r[s];if(n=l._listeners,o(n)){for(var c=-1,d=0,h=n.length;d<h;d++)if(n[d]===t||n[d].listener&&n[d].listener===t||n[d]._origin&&n[d]._origin===t){c=d;break}if(c<0)continue;return this.wildcard?l._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e],this.emit("removeListener",e,t))}return function e(t){if(t!==i){var n=Object.keys(t);for(var r in n){var o=n[r],a=t[o];a instanceof Function||"object"!=typeof a||null===a||(Object.keys(a).length>0&&e(t[o]),0===Object.keys(a).length&&delete t[o])}}}(this.listenerTree),this},d.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this.emit("removeListenerAny",e),this}else{for(n=0,r=(t=this._all).length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},d.prototype.removeListener=d.prototype.off,d.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||s.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0),r=0;r<n.length;r++)n[r]._listeners=null;else this._events&&(this._events[e]=null);return this},d.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return u.call(this,t,n,this.listenerTree,0),t}return this._events||s.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},d.prototype.eventNames=function(){return Object.keys(this._events)},d.prototype.listenerCount=function(e){return this.listeners(e).length},d.prototype.listenersAny=function(){return this._all?this._all:[]},(r=function(){return d}.call(t,n,t,e))===i||(e.exports=r)}()},7007:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,a,c;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):v(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,d=v(l,c);for(n=0;n<c;++n)r(d[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},1936:function(e,t,n){var r,i=i||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in r,o=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},d=function(t,d,u){u||(t=c(t));var h,p=this,v="application/octet-stream"===t.type,m=function(){!function(e,t){for(var n=(t=[].concat(t)).length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,e)}catch(e){s(e)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,i)return h=n().createObjectURL(t),void setTimeout((function(){var e,t;r.href=h,r.download=d,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),m(),l(h),p.readyState=p.DONE}));!function(){if((a||v&&o)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,m()},r.readAsDataURL(t),void(p.readyState=p.INIT)}h||(h=n().createObjectURL(t)),v?e.location.href=h:e.open(h,"_blank")||(e.location.href=h),p.readyState=p.DONE,m(),l(h)}()},u=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(e,t,n){return new d(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=i:null!==n.amdD&&null!==n.amdO&&(void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r))},7206:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},3065:function(e,t,n){var r,i;!function(){"use strict";r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var n=this.getLevel(),i=0;i<r.length;i++){var o=r[i];this[o]=i<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function d(r,i,o){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?s:void 0!==console[r]?a(console,r):void 0!==console.log?a(console,"log"):e)}(r)||c.apply(this,arguments)}function u(e,n){var a,s,c,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=encodeURIComponent(h),i=n.indexOf(r+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i+r.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function v(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){return null!=c?c:null!=s?s:a},u.setLevel=function(e,n){return c=v(e),!1!==n&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(c),l.call(u)},u.setDefaultLevel=function(e){s=v(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){c=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),l.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=v(o.getLevel())),l.call(u),o===u)for(var e in i)i[e].rebuild()},a=v(o?o.getLevel():"WARN");var m=p();null!=m&&(c=v(m)),l.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return i},o.default=o,o},void 0===(i=r.call(t,n,t,e))||(e.exports=i)}()},9283:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvents=void 0;var r=n(2670),i=n(8262),o=n(8980),a=n(3361),s=n(3776),l=n(5134),c=n(3449);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"interpreters",new r.NamespacedMap([[o.LEGACY_M_ROOM_MESSAGE,o.parseMRoomMessage],[s.M_MESSAGE,a.parseMMessage],[s.M_EMOTE,a.parseMMessage],[s.M_NOTICE,a.parseMMessage],[l.M_POLL_START,c.parseMPoll],[l.M_POLL_RESPONSE,c.parseMPoll],[l.M_POLL_END,c.parseMPoll]])),h(this,"_unknownInterpretOrder",[s.M_MESSAGE])}var t,n,p;return t=e,p=[{key:"defaultInstance",get:function(){return e._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return e.defaultInstance.unknownInterpretOrder},set:function(t){e.defaultInstance.unknownInterpretOrder=t}},{key:"registerInterpreter",value:function(t,n){e.defaultInstance.registerInterpreter(t,n)}},{key:"parse",value:function(t){return e.defaultInstance.parse(t)}}],(n=[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.unknownInterpretOrder);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.interpreters.has(r)){var o=this.interpreters.get(r)(e);if(o)return o}}}catch(e){n.e(e)}finally{n.f()}return null}catch(e){if(e instanceof i.InvalidEventError)return null;throw e}}}])&&u(t.prototype,n),p&&u(t,p),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvents=p,h(p,"_defaultInstance",new p)},3239:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8262:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return i(e,arguments,s(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},r(e)}function i(e,t,n){return i=o()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i},i.apply(null,arguments)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidEventError=void 0;var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(c,e);var t,r,i,l=(r=c,i=o(),function(){var e,t=s(r);if(i){var o=s(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),l.call(this,e)}return t=c,Object.defineProperty(t,"prototype",{writable:!1}),t}(r(Error));t.InvalidEventError=l},2670:(e,t)=>{"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMap=void 0;var i=function(){function e(t){var r,i,o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,i="internalMap",o=new Map,i in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o,t){var a,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw a}}}}(t);try{for(s.s();!(a=s.n()).done;){var l=a.value;this.set(l[0],l[1])}}catch(e){s.e(e)}finally{s.f()}}}var t,i;return t=e,(i=[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}])&&r(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.NamespacedMap=i},8993:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;var l=function(){function e(t,n){if(o(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return s(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();t.NamespacedValue=l;var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(c,e);var t,a,l=(t=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=i(t);if(a){var o=i(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function c(e,t){var n;if(o(this,c),!(n=l.call(this,e,t)).unstable)throw new Error("Unstable value must be supplied");return n}return s(c,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),c}(l);t.UnstableValue=c},1921:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EmoteEvent=void 0;var i=n(1624),o=n(3776),a=n(6419);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},c.apply(this,arguments)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(m,e);var t,n,i,h,p,v=(h=m,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(h);if(p){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function m(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),v.call(this,e)}return t=m,i=[{key:"from",value:function(e,t){var n;return new m({type:o.M_EMOTE.name,content:(n={},s(n,o.M_TEXT.name,e),s(n,o.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,a.isEventTypeSame)(e,o.M_EMOTE)||c(u(m.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(u(m.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}])&&l(t.prototype,n),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),m}(i.MessageEvent);t.EmoteEvent=h},8474:(e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvent=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wireFormat=t}var t,r;return t=e,(r=[{key:"wireContent",get:function(){return this.wireFormat.content}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvent=r},1624:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEvent=void 0;var i=n(8474),o=n(2666),a=n(8262),s=n(3776),l=n(6419);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(y,e);var t,n,i,c,g,f=(c=y,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(c);if(g){var n=v(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}(this,e)});function y(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),m(p(t=f.call(this,e)),"text",void 0),m(p(t),"html",void 0),m(p(t),"renderings",void 0);var n=s.M_MESSAGE.findIn(t.wireContent),r=s.M_TEXT.findIn(t.wireContent),i=s.M_HTML.findIn(t.wireContent);if((0,o.isProvided)(n)){if(!Array.isArray(n))throw new a.InvalidEventError("m.message contents must be an array");var l=n.find((function(e){return!(0,o.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),c=n.find((function(e){return"text/html"===e.mimetype}));if(!l)throw new a.InvalidEventError("m.message is missing a plain text representation");t.text=l.body,t.html=null==c?void 0:c.body,t.renderings=n}else{if(!(0,o.isOptionalAString)(r))throw new a.InvalidEventError("Missing textual representation for event");t.text=r,t.html=i,t.renderings=[{body:r,mimetype:"text/plain"}],t.html&&t.renderings.push({body:t.html,mimetype:"text/html"})}return t}return t=y,i=[{key:"from",value:function(e,t){var n;return new y({type:s.M_MESSAGE.name,content:(n={},m(n,s.M_TEXT.name,e),m(n,s.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return s.M_EMOTE.matches(this.wireFormat.type)||(0,o.isProvided)(s.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return s.M_NOTICE.matches(this.wireFormat.type)||(0,o.isProvided)(s.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,s.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=m({},s.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;void 0!==t&&"text/plain"!==t||(e=m({},s.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:d(d({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}])&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),y}(i.ExtensibleEvent);t.MessageEvent=g},7985:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeEvent=void 0;var i=n(1624),o=n(3776),a=n(6419);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},c.apply(this,arguments)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(m,e);var t,n,i,h,p,v=(h=m,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(h);if(p){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function m(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),v.call(this,e)}return t=m,i=[{key:"from",value:function(e,t){var n;return new m({type:o.M_NOTICE.name,content:(n={},s(n,o.M_TEXT.name,e),s(n,o.M_HTML.name,t),n)})}}],(n=[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,a.isEventTypeSame)(e,o.M_NOTICE)||c(u(m.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(u(m.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}])&&l(t.prototype,n),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),m}(i.MessageEvent);t.NoticeEvent=h},7055:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollEndEvent=void 0;var i=n(5134),o=n(8262),a=n(6309),s=n(1624),l=n(3776),c=n(6419);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(E,e);var t,n,d,f,y,_=(f=E,y=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(f);if(y){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}(this,e)});function E(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,E),g(v(t=_.call(this,e)),"pollEventId",void 0),g(v(t),"closingMessage",void 0);var n=t.wireContent["m.relates_to"];if(!a.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new o.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.closingMessage=new s.MessageEvent(t.wireFormat),t}return t=E,d=[{key:"from",value:function(e,t){var n;return new E({type:i.M_POLL_END.name,content:(n={"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:e}},g(n,i.M_POLL_END.name,{}),g(n,l.M_TEXT.name,t),n)})}}],(n=[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,i.M_POLL_END)}},{key:"serialize",value:function(){return{type:i.M_POLL_END.name,content:u(g({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:this.pollEventId}},i.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}])&&h(t.prototype,n),d&&h(t,d),Object.defineProperty(t,"prototype",{writable:!1}),E}(n(8474).ExtensibleEvent);t.PollEndEvent=f},8591:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollResponseEvent=void 0;var i=n(8474),o=n(5134),a=n(8262),s=n(6309),l=n(6419);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(f,e);var t,n,i,v,m,g=(v=f,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(v);if(m){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,e)});function f(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),p(u(t=g.call(this,e)),"internalAnswerIds",void 0),p(u(t),"internalSpoiled",void 0),p(u(t),"pollEventId",void 0);var n=t.wireContent["m.relates_to"];if(!s.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new a.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.validateAgainst(null),t}return t=f,i=[{key:"from",value:function(e,t){return new f({type:o.M_POLL_RESPONSE.name,content:p({"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:t}},o.M_POLL_RESPONSE.name,{answers:e})})}}],(n=[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=o.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var n=t.answers;if(n.some((function(e){return"string"!=typeof e}))||0===n.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(n.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);n=n.slice(0,e.maxSelections)}this.internalAnswerIds=n,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,o.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:o.M_POLL_RESPONSE.name,content:p({"m.relates_to":{rel_type:s.REFERENCE_RELATION.name,event_id:this.pollEventId}},o.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}])&&c(t.prototype,n),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),f}(i.ExtensibleEvent);t.PollResponseEvent=v},4560:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollStartEvent=t.PollAnswerSubevent=void 0;var i=n(5134),o=n(1624),a=n(3776),s=n(8262),l=n(8993),c=n(6419),d=n(8474);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=b(e);if(t){var o=b(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return E(e)}(this,n)}}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){f(n,e);var t=_(n);function n(e){var r;v(this,n),S(E(r=t.call(this,e)),"id",void 0);var i=e.content.id;if(!i||"string"!=typeof i)throw new s.InvalidEventError("Answer ID must be a non-empty string");return r.id=i,r}return g(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:p({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new n({type:"org.matrix.sdk.poll.answer",content:S({id:e},a.M_TEXT.name,t)})}}]),n}(o.MessageEvent);t.PollAnswerSubevent=C;var w=function(e){f(n,e);var t=_(n);function n(e){var r;v(this,n),S(E(r=t.call(this,e)),"question",void 0),S(E(r),"kind",void 0),S(E(r),"rawKind",void 0),S(E(r),"maxSelections",void 0),S(E(r),"answers",void 0);var a=i.M_POLL_START.findIn(r.wireContent);if(!a.question)throw new s.InvalidEventError("A question is required");if(r.question=new o.MessageEvent({type:"org.matrix.sdk.poll.question",content:a.question}),r.rawKind=a.kind,i.M_POLL_KIND_DISCLOSED.matches(r.rawKind)?r.kind=i.M_POLL_KIND_DISCLOSED:r.kind=i.M_POLL_KIND_UNDISCLOSED,r.maxSelections=Number.isFinite(a.max_selections)&&a.max_selections>0?a.max_selections:1,!Array.isArray(a.answers))throw new s.InvalidEventError("Poll answers must be an array");var l=a.answers.slice(0,20).map((function(e){return new C({type:"org.matrix.sdk.poll.answer",content:e})}));if(l.length<=0)throw new s.InvalidEventError("No answers available");return r.answers=l,r}return g(n,[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,i.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:i.M_POLL_START.name,content:(e={},S(e,i.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),S(e,a.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,t,r){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new n({type:i.M_POLL_START.name,content:(o={},S(o,a.M_TEXT.name,e),S(o,i.M_POLL_START.name,{question:S({},a.M_TEXT.name,e),kind:r instanceof l.NamespacedValue?r.name:r,max_selections:s,answers:t.map((function(e){return S({id:(t=Array(16),function(e){if(Array.isArray(e))return u(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(){return A.charAt(Math.floor(Math.random()*A.length))})).join("")},a.M_TEXT.name,e);var t}))}),o)})}}]),n}(d.ExtensibleEvent);t.PollStartEvent=w;var A="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"},3776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_TEXT=t.M_NOTICE=t.M_MESSAGE=t.M_HTML=t.M_EMOTE=void 0;var r=n(8993),i=new r.UnstableValue("m.message","org.matrix.msc1767.message");t.M_MESSAGE=i;var o=new r.UnstableValue("m.text","org.matrix.msc1767.text");t.M_TEXT=o;var a=new r.UnstableValue("m.html","org.matrix.msc1767.html");t.M_HTML=a;var s=new r.UnstableValue("m.emote","org.matrix.msc1767.emote");t.M_EMOTE=s;var l=new r.UnstableValue("m.notice","org.matrix.msc1767.notice");t.M_NOTICE=l},5134:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_POLL_START=t.M_POLL_RESPONSE=t.M_POLL_KIND_UNDISCLOSED=t.M_POLL_KIND_DISCLOSED=t.M_POLL_END=void 0;var r=n(8993),i=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");t.M_POLL_KIND_DISCLOSED=i;var o=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");t.M_POLL_KIND_UNDISCLOSED=o;var a=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");t.M_POLL_START=a;var s=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");t.M_POLL_RESPONSE=s;var l=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");t.M_POLL_END=l},6309:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFERENCE_RELATION=void 0;var r=new(n(8993).NamespacedValue)("m.reference");t.REFERENCE_RELATION=r},9787:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9283);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n(3239);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n(8262);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(8993);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=n(2670);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=n(2666);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(5556);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(6419);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=n(8980);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var h=n(3361);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var p=n(3449);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var v=n(6309);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var m=n(8474);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(3776);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(1624);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var y=n(1921);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var _=n(7985);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var E=n(5134);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var b=n(4560);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var S=n(8591);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var C=n(7055);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}))},8980:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LEGACY_M_ROOM_MESSAGE=void 0,t.parseMRoomMessage=function(e){var t,n,a;if(s.M_MESSAGE.findIn(e.content)||s.M_TEXT.findIn(e.content))return new r.MessageEvent(e);var l,u,h,p=null===(t=e.content)||void 0===t?void 0:t.msgtype,v=null===(n=e.content)||void 0===n?void 0:n.body,m="org.matrix.custom.html"===(null===(a=e.content)||void 0===a?void 0:a.format)?e.content.formatted_body:null;return"m.text"===p?new r.MessageEvent(c(c({},e),{},{content:c(c({},e.content),{},(l={},d(l,s.M_TEXT.name,v),d(l,s.M_HTML.name,m),l))})):"m.notice"===p?new i.NoticeEvent(c(c({},e),{},{content:c(c({},e.content),{},(u={},d(u,s.M_TEXT.name,v),d(u,s.M_HTML.name,m),u))})):"m.emote"===p?new o.EmoteEvent(c(c({},e),{},{content:c(c({},e.content),{},(h={},d(h,s.M_TEXT.name,v),d(h,s.M_HTML.name,m),h))})):null};var r=n(1624),i=n(7985),o=n(1921),a=n(8993),s=n(3776);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=new a.NamespacedValue("m.room.message");t.LEGACY_M_ROOM_MESSAGE=u},3361:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMMessage=function(e){return i.M_EMOTE.matches(e.type)?new o.EmoteEvent(e):i.M_NOTICE.matches(e.type)?new a.NoticeEvent(e):new r.MessageEvent(e)};var r=n(1624),i=n(3776),o=n(1921),a=n(7985)},3449:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMPoll=function(e){return r.M_POLL_START.matches(e.type)?new i.PollStartEvent(e):r.M_POLL_RESPONSE.matches(e.type)?new o.PollResponseEvent(e):r.M_POLL_END.matches(e.type)?new a.PollEndEvent(e):null};var r=n(5134),i=n(4560),o=n(8591),a=n(7055)},2666:(e,t)=>{"use strict";function n(e){return null!=e}Object.defineProperty(t,"__esModule",{value:!0}),t.isOptionalAString=function(e){return n(e)&&"string"==typeof e},t.isProvided=n},5556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyMsgType=void 0,t.isEventLike=function(e,t){var n=e.content;return t===r.Text?i.M_MESSAGE.matches(e.type)||"m.room.message"===e.type&&"m.text"===(null==n?void 0:n.msgtype):t===r.Emote?i.M_EMOTE.matches(e.type)||"m.room.message"===e.type&&"m.emote"===(null==n?void 0:n.msgtype):t===r.Notice&&(i.M_NOTICE.matches(e.type)||"m.room.message"===e.type&&"m.notice"===(null==n?void 0:n.msgtype))};var r,i=n(3776);t.LegacyMsgType=r,function(e){e.Text="m.text",e.Notice="m.notice",e.Emote="m.emote"}(r||(t.LegacyMsgType=r={}))},6419:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||n.matches(r.altName)}},2291:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientWidgetApi=void 0;var r=n(7007),i=n(2052),o=n(9134),a=n(8769),s=n(8145),l=n(9323),c=n(3099),d=n(1992),u=n(8300),h=n(27),p=n(1286);function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function y(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(){b=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var o=t&&t.prototype instanceof h?t:h,a=Object.create(o.prototype),s=new I(i||[]);return r(a,"_invoke",{value:C(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function p(){}function m(){}var g={};l(g,o,(function(){return this}));var f=Object.getPrototypeOf,y=f&&f(f(k([])));y&&y!==t&&n.call(y,o)&&(g=y);var _=m.prototype=h.prototype=Object.create(g);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function i(r,o,a,s){var l=d(e[r],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==v(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return i("throw",e,a,s)}))}s(l.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function C(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=d(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),u;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function k(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(_,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},E(S.prototype),l(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(_),l(_,s,"Generator"),l(_,o,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=k,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function S(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){S(o,r,i,a,s,"next",e)}function s(e){S(o,r,i,a,s,"throw",e)}a(void 0)}))}}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function k(e,t,n){return(t=O(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){var t=function(e){if("object"!==v(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===v(t)?t:String(t)}function R(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new x(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function x(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return x=function(e){this.s=e,this.n=e.next},x.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new x(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(K,e);var t,n,r,m,_,E,S,O,x,N,D,L,P,M,U,F,B,G,$,V,j=($=K,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I($);if(V){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}(this,e)});function K(e,t,n){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,K),(r=j.call(this)).widget=e,r.iframe=t,r.driver=n,k(T(r),"transport",void 0),k(T(r),"cachedWidgetVersions",null),k(T(r),"contentLoadedActionSent",!1),k(T(r),"allowedCapabilities",new Set),k(T(r),"allowedEvents",[]),k(T(r),"isStopped",!1),k(T(r),"turnServers",null),k(T(r),"contentLoadedWaitTimer",void 0),k(T(r),"pushRoomStateTasks",new Set),k(T(r),"pushRoomStateResult",new Map),k(T(r),"flushRoomStateTask",null),k(T(r),"viewedRoomId",null),null==t||!t.contentWindow)throw new Error("No iframe supplied");if(!e)throw new Error("Invalid widget");if(!n)throw new Error("Invalid driver");return r.transport=new i.PostmessageTransport(o.WidgetApiDirection.ToWidget,e.id,t.contentWindow,window),r.transport.targetOrigin=e.origin,r.transport.on("message",r.handleMessage.bind(T(r))),t.addEventListener("load",r.onIframeLoad.bind(T(r))),r.transport.start(),r}return t=K,n=[{key:"hasCapability",value:function(e){return this.allowedCapabilities.has(e)}},{key:"canUseRoomTimeline",value:function(e){return this.hasCapability("org.matrix.msc2762.timeline:".concat(h.Symbols.AnyRoom))||this.hasCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"canSendRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(n){return n.matchesAsRoomEvent(c.EventDirection.Send,e,t)}))}},{key:"canSendStateEvent",value:function(e,t){return this.allowedEvents.some((function(n){return n.matchesAsStateEvent(c.EventDirection.Send,e,t)}))}},{key:"canSendToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(c.EventDirection.Send,e)}))}},{key:"canReceiveRoomEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.allowedEvents.some((function(n){return n.matchesAsRoomEvent(c.EventDirection.Receive,e,t)}))}},{key:"canReceiveStateEvent",value:function(e,t){return this.allowedEvents.some((function(n){return n.matchesAsStateEvent(c.EventDirection.Receive,e,t)}))}},{key:"canReceiveToDeviceEvent",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsToDeviceEvent(c.EventDirection.Receive,e)}))}},{key:"canReceiveRoomAccountData",value:function(e){return this.allowedEvents.some((function(t){return t.matchesAsRoomAccountData(c.EventDirection.Receive,e)}))}},{key:"stop",value:function(){this.isStopped=!0,this.transport.stop()}},{key:"getWidgetVersions",value:(G=C(b().mark((function e(){var t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(this.cachedWidgetVersions)){e.next=2;break}return e.abrupt("return",Promise.resolve(this.cachedWidgetVersions));case 2:return e.prev=2,e.next=5,this.transport.send(a.WidgetApiToWidgetAction.SupportedApiVersions,{});case 5:return t=e.sent,this.cachedWidgetVersions=t.supported_versions,e.abrupt("return",t.supported_versions);case 10:return e.prev=10,e.t0=e.catch(2),console.warn("non-fatal error getting supported widget versions: ",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return G.apply(this,arguments)})},{key:"beginCapabilities",value:function(){var e,t=this;this.emit("preparing"),this.transport.send(a.WidgetApiToWidgetAction.Capabilities,{}).then((function(n){return e=n.capabilities,t.driver.validateCapabilities(new Set(n.capabilities))})).then((function(n){t.allowCapabilities(y(n),e),t.emit("ready")})).catch((function(e){t.emit("error:preparing",e)}))}},{key:"allowCapabilities",value:function(e,t){var n,r=this;console.log("Widget ".concat(this.widget.id," is allowed capabilities:"),e);var i,o=f(e);try{for(o.s();!(i=o.n()).done;){var l=i.value;this.allowedCapabilities.add(l)}}catch(e){o.e(e)}finally{o.f()}var d=c.WidgetEventCapability.findEventCapabilities(e);(n=this.allowedEvents).push.apply(n,y(d)),this.transport.send(a.WidgetApiToWidgetAction.NotifyCapabilities,{requested:t,approved:Array.from(this.allowedCapabilities)}).catch((function(e){console.warn("non-fatal error notifying widget of approved capabilities:",e)})).then((function(){r.emit("capabilitiesNotified")}));var u,p=f(e);try{for(p.s();!(u=p.n()).done;){var v=u.value;if((0,s.isTimelineCapability)(v)){var m=(0,s.getTimelineRoomIDFromCapability)(v);if(m===h.Symbols.AnyRoom){var g,_=f(this.driver.getKnownRooms());try{for(_.s();!(g=_.n()).done;){var E=g.value;this.pushRoomState(E)}}catch(e){_.e(e)}finally{_.f()}}else this.pushRoomState(m)}}}catch(e){p.e(e)}finally{p.f()}d.length>0&&null!==this.viewedRoomId&&!this.canUseRoomTimeline(this.viewedRoomId)&&this.pushRoomState(this.viewedRoomId)}},{key:"onIframeLoad",value:function(e){this.widget.waitForIframeLoad?this.beginCapabilities():(console.log("waitForIframeLoad is false: waiting for widget to send contentLoaded"),this.contentLoadedWaitTimer=setTimeout((function(){console.error("Widget specified waitForIframeLoad=false but timed out waiting for contentLoaded event!")}),1e4),this.contentLoadedActionSent=!1)}},{key:"handleContentLoadedAction",value:function(e){if(void 0!==this.contentLoadedWaitTimer&&(clearTimeout(this.contentLoadedWaitTimer),this.contentLoadedWaitTimer=void 0),this.contentLoadedActionSent)throw new Error("Improper sequence: ContentLoaded Action can only be sent once after the widget loaded and should only be used if waitForIframeLoad is false (default=true)");this.widget.waitForIframeLoad?this.transport.reply(e,{error:{message:"Improper sequence: not expecting ContentLoaded event if waitForIframeLoad is true (default=true)"}}):(this.transport.reply(e,{}),this.beginCapabilities()),this.contentLoadedActionSent=!0}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:l.CurrentApiVersions})}},{key:"supportsUpdateState",value:(B=C(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWidgetVersions();case 2:return e.abrupt("return",e.sent.includes(l.UnstableApiVersion.MSC2762_UPDATE_STATE));case 3:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"handleCapabilitiesRenegotiate",value:function(e){var t,n=this;this.transport.reply(e,{});var r=(null===(t=e.data)||void 0===t?void 0:t.capabilities)||[],i=new Set(r.filter((function(e){return!n.hasCapability(e)})));0===i.size&&this.allowCapabilities([],[]),this.driver.validateCapabilities(i).then((function(e){return n.allowCapabilities(y(e),y(i))}))}},{key:"handleNavigate",value:function(e){var t,n,r=this;if(!this.hasCapability(s.MatrixCapabilities.MSC2931Navigate))return this.transport.reply(e,{error:{message:"Missing capability"}});if(null===(t=e.data)||void 0===t||!t.uri||null===(n=e.data)||void 0===n||!n.uri.toString().startsWith("https://matrix.to/#"))return this.transport.reply(e,{error:{message:"Invalid matrix.to URI"}});var i=function(t){console.error("[ClientWidgetApi] Failed to handle navigation: ",t),r.handleDriverError(t,e,"Error handling navigation")};try{this.driver.navigate(e.data.uri.toString()).catch((function(e){return i(e)})).then((function(){return r.transport.reply(e,{})}))}catch(e){return i(e)}}},{key:"handleOIDC",value:function(e){var t=this,n=1,r=function(r,i){return i=i||{},n>1?t.transport.send(a.WidgetApiToWidgetAction.OpenIDCredentials,g({state:r,original_request_id:e.requestId},i)):t.transport.reply(e,g({state:r},i))},i=function(i){return console.error("[ClientWidgetApi] Failed to handle OIDC: ",i),n>1?r(d.OpenIDRequestState.Blocked):t.transport.reply(e,{error:{message:i}})},o=new u.SimpleObservable((function(e){return e.state===d.OpenIDRequestState.PendingUserConfirmation&&n>1?(o.close(),i("client provided out-of-phase response to OIDC flow")):e.state===d.OpenIDRequestState.PendingUserConfirmation?(r(e.state),void n++):e.state!==d.OpenIDRequestState.Allowed||e.token?(e.state===d.OpenIDRequestState.Blocked&&(e.token=void 0),o.close(),r(e.state,e.token)):i("client provided invalid OIDC token for an allowed request")}));this.driver.askOpenID(o)}},{key:"handleReadRoomAccountData",value:function(e){var t=this,n=Promise.resolve([]);return n=this.driver.readRoomAccountData(e.data.type),this.canReceiveRoomAccountData(e.data.type)?n.then((function(n){t.transport.reply(e,{events:n})})):this.transport.reply(e,{error:{message:"Cannot read room account data of this type"}})}},{key:"handleReadEvents",value:(F=C(b().mark((function e(t){var n,r,i,o,a,s,l,c,d,u,p=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.type){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - missing event type"}}));case 2:if(void 0===t.data.limit||t.data.limit&&!(t.data.limit<0)){e.next=4;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - limit out of range"}}));case 4:if(void 0!==t.data.room_ids){e.next=8;break}n=null===this.viewedRoomId?[]:[this.viewedRoomId],e.next=30;break;case 8:if(t.data.room_ids!==h.Symbols.AnyRoom){e.next=12;break}n=this.driver.getKnownRooms().filter((function(e){return p.canUseRoomTimeline(e)})),e.next=30;break;case 12:n=t.data.room_ids,r=f(n),e.prev=14,r.s();case 16:if((i=r.n()).done){e.next=22;break}if(o=i.value,this.canUseRoomTimeline(o)){e.next=20;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Unable to access room timeline: ".concat(o)}}));case 20:e.next=16;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(14),r.e(e.t0);case 27:return e.prev=27,r.f(),e.finish(27);case 30:if(a=t.data.limit||0,s=t.data.since,l=void 0,c=void 0,void 0===t.data.state_key){e.next=40;break}if(l=!0===t.data.state_key?void 0:t.data.state_key.toString(),this.canReceiveStateEvent(t.data.type,null!==(d=l)&&void 0!==d?d:null)){e.next=38;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read state events of this type"}}));case 38:e.next=43;break;case 40:if(c=t.data.msgtype,this.canReceiveRoomEvent(t.data.type,c)){e.next=43;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Cannot read room events of this type"}}));case 43:if(void 0!==t.data.room_ids||0!==n.length){e.next=50;break}return console.warn("The widgetDriver uses deprecated behaviour:\n It does not set the viewedRoomId using `setViewedRoomId`"),e.next=47,void 0===t.data.state_key?this.driver.readRoomEvents(t.data.type,c,a,null,s):this.driver.readStateEvents(t.data.type,l,a,null);case 47:u=e.sent,e.next=68;break;case 50:return e.next=52,this.supportsUpdateState();case 52:if(!e.sent){e.next=58;break}return e.next=55,Promise.all(n.map((function(e){return p.driver.readRoomTimeline(e,t.data.type,c,l,a,s)})));case 55:u=e.sent.flat(1),e.next=68;break;case 58:if(void 0!==t.data.state_key){e.next=64;break}return e.next=61,Promise.all(n.map((function(e){return p.driver.readRoomTimeline(e,t.data.type,c,l,a,s)})));case 61:e.t1=e.sent,e.next=67;break;case 64:return e.next=66,Promise.all(n.map((function(e){return p.driver.readRoomState(e,t.data.type,l)})));case 66:e.t1=e.sent;case 67:u=e.t1.flat(1);case 68:this.transport.reply(t,{events:u});case 69:case"end":return e.stop()}}),e,this,[[14,24,27,30]])}))),function(e){return F.apply(this,arguments)})},{key:"handleSendEvent",value:function(e){var t=this;if(!e.data.type)return this.transport.reply(e,{error:{message:"Invalid request - missing event type"}});if(e.data.room_id&&!this.canUseRoomTimeline(e.data.room_id))return this.transport.reply(e,{error:{message:"Unable to access room timeline: ".concat(e.data.room_id)}});var n,r=void 0!==e.data.delay||void 0!==e.data.parent_delay_id;if(r&&!this.hasCapability(s.MatrixCapabilities.MSC4157SendDelayedEvent))return this.transport.reply(e,{error:{message:"Missing capability"}});if(void 0!==e.data.state_key){if(!this.canSendStateEvent(e.data.type,e.data.state_key))return this.transport.reply(e,{error:{message:"Cannot send state events of this type"}});var i,o;n=r?this.driver.sendDelayedEvent(null!==(i=e.data.delay)&&void 0!==i?i:null,null!==(o=e.data.parent_delay_id)&&void 0!==o?o:null,e.data.type,e.data.content||{},e.data.state_key,e.data.room_id):this.driver.sendEvent(e.data.type,e.data.content||{},e.data.state_key,e.data.room_id)}else{var a,l,c=e.data.content||{},d=c.msgtype;if(!this.canSendRoomEvent(e.data.type,d))return this.transport.reply(e,{error:{message:"Cannot send room events of this type"}});n=r?this.driver.sendDelayedEvent(null!==(a=e.data.delay)&&void 0!==a?a:null,null!==(l=e.data.parent_delay_id)&&void 0!==l?l:null,e.data.type,c,null,e.data.room_id):this.driver.sendEvent(e.data.type,c,null,e.data.room_id)}n.then((function(n){return t.transport.reply(e,g({room_id:n.roomId},"eventId"in n?{event_id:n.eventId}:{delay_id:n.delayId}))})).catch((function(n){console.error("error sending event: ",n),t.handleDriverError(n,e,"Error sending event")}))}},{key:"handleUpdateDelayedEvent",value:function(e){var t=this;if(!e.data.delay_id)return this.transport.reply(e,{error:{message:"Invalid request - missing delay_id"}});if(!this.hasCapability(s.MatrixCapabilities.MSC4157UpdateDelayedEvent))return this.transport.reply(e,{error:{message:"Missing capability"}});switch(e.data.action){case p.UpdateDelayedEventAction.Cancel:case p.UpdateDelayedEventAction.Restart:case p.UpdateDelayedEventAction.Send:this.driver.updateDelayedEvent(e.data.delay_id,e.data.action).then((function(){return t.transport.reply(e,{})})).catch((function(n){console.error("error updating delayed event: ",n),t.handleDriverError(n,e,"Error updating delayed event")}));break;default:return this.transport.reply(e,{error:{message:"Invalid request - unsupported action"}})}}},{key:"handleSendToDevice",value:(U=C(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.type){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Invalid request - missing event type"}});case 3:e.next=31;break;case 5:if(t.data.messages){e.next=10;break}return e.next=8,this.transport.reply(t,{error:{message:"Invalid request - missing event contents"}});case 8:e.next=31;break;case 10:if("boolean"==typeof t.data.encrypted){e.next=15;break}return e.next=13,this.transport.reply(t,{error:{message:"Invalid request - missing encryption flag"}});case 13:e.next=31;break;case 15:if(this.canSendToDeviceEvent(t.data.type)){e.next=20;break}return e.next=18,this.transport.reply(t,{error:{message:"Cannot send to-device events of this type"}});case 18:e.next=31;break;case 20:return e.prev=20,e.next=23,this.driver.sendToDevice(t.data.type,t.data.encrypted,t.data.messages);case 23:return e.next=25,this.transport.reply(t,{});case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(20),console.error("error sending to-device event",e.t0),this.handleDriverError(e.t0,t,"Error sending event");case 31:case"end":return e.stop()}}),e,this,[[20,27]])}))),function(e){return U.apply(this,arguments)})},{key:"pollTurnServers",value:(M=C(b().mark((function e(t,n){var r,i,o,s,l,c;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.transport.send(a.WidgetApiToWidgetAction.UpdateTurnServers,n);case 3:r=!1,i=!1,e.prev=5,s=R(t);case 7:return e.next=9,s.next();case 9:if(!(r=!(l=e.sent).done)){e.next=16;break}return c=l.value,e.next=13,this.transport.send(a.WidgetApiToWidgetAction.UpdateTurnServers,c);case 13:r=!1,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),i=!0,o=e.t0;case 22:if(e.prev=22,e.prev=23,!r||null==s.return){e.next=27;break}return e.next=27,s.return();case 27:if(e.prev=27,!i){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(22);case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),console.error("error polling for TURN servers",e.t1);case 37:case"end":return e.stop()}}),e,this,[[0,34],[5,18,22,32],[23,,27,31]])}))),function(e,t){return M.apply(this,arguments)})},{key:"handleWatchTurnServers",value:(P=C(b().mark((function e(t){var n,r,i,o;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=30;break;case 5:if(!this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.prev=10,n=this.driver.getTurnServers(),e.next=14,n.next();case 14:if(r=e.sent,i=r.done,o=r.value,!i){e.next=19;break}throw new Error("Client refuses to provide any TURN servers");case 19:return e.next=21,this.transport.reply(t,{});case 21:this.pollTurnServers(n,o),this.turnServers=n,e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(10),console.error("error getting first TURN server results",e.t0),e.next=30,this.transport.reply(t,{error:{message:"TURN servers not available"}});case 30:case"end":return e.stop()}}),e,this,[[10,25]])}))),function(e){return P.apply(this,arguments)})},{key:"handleUnwatchTurnServers",value:(L=C(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC3846TurnServers)){e.next=5;break}return e.next=3,this.transport.reply(t,{error:{message:"Missing capability"}});case 3:case 8:e.next=15;break;case 5:if(this.turnServers){e.next=10;break}return e.next=8,this.transport.reply(t,{});case 10:return e.next=12,this.turnServers.return(void 0);case 12:return this.turnServers=null,e.next=15,this.transport.reply(t,{});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"handleReadRelations",value:(D=C(b().mark((function e(t){var n,r,i=this;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.event_id){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - missing event ID"}}));case 2:if(!(void 0!==t.data.limit&&t.data.limit<0)){e.next=4;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - limit out of range"}}));case 4:if(void 0===t.data.room_id||this.canUseRoomTimeline(t.data.room_id)){e.next=6;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Unable to access room timeline: ".concat(t.data.room_id)}}));case 6:return e.prev=6,e.next=9,this.driver.readEventRelations(t.data.event_id,t.data.room_id,t.data.rel_type,t.data.event_type,t.data.from,t.data.to,t.data.limit,t.data.direction);case 9:return n=e.sent,r=n.chunk.filter((function(e){return void 0!==e.state_key?i.canReceiveStateEvent(e.type,e.state_key):i.canReceiveRoomEvent(e.type,e.content.msgtype)})),e.abrupt("return",this.transport.reply(t,{chunk:r,prev_batch:n.prevBatch,next_batch:n.nextBatch}));case 14:e.prev=14,e.t0=e.catch(6),console.error("error getting the relations",e.t0),this.handleDriverError(e.t0,t,"Unexpected error while reading relations");case 18:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e){return D.apply(this,arguments)})},{key:"handleUserDirectorySearch",value:(N=C(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC3973UserDirectorySearch)){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Missing capability"}}));case 2:if("string"==typeof t.data.search_term){e.next=4;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - missing search term"}}));case 4:if(!(void 0!==t.data.limit&&t.data.limit<0)){e.next=6;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Invalid request - limit out of range"}}));case 6:return e.prev=6,e.next=9,this.driver.searchUserDirectory(t.data.search_term,t.data.limit);case 9:return n=e.sent,e.abrupt("return",this.transport.reply(t,{limited:n.limited,results:n.results.map((function(e){return{user_id:e.userId,display_name:e.displayName,avatar_url:e.avatarUrl}}))}));case 13:e.prev=13,e.t0=e.catch(6),console.error("error searching in the user directory",e.t0),this.handleDriverError(e.t0,t,"Unexpected error while searching in the user directory");case 17:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(e){return N.apply(this,arguments)})},{key:"handleGetMediaConfig",value:(x=C(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC4039UploadFile)){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Missing capability"}}));case 2:return e.prev=2,e.next=5,this.driver.getMediaConfig();case 5:return n=e.sent,e.abrupt("return",this.transport.reply(t,n));case 9:e.prev=9,e.t0=e.catch(2),console.error("error while getting the media configuration",e.t0),this.handleDriverError(e.t0,t,"Unexpected error while getting the media configuration");case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return x.apply(this,arguments)})},{key:"handleUploadFile",value:(O=C(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC4039UploadFile)){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Missing capability"}}));case 2:return e.prev=2,e.next=5,this.driver.uploadFile(t.data.file);case 5:return n=e.sent,e.abrupt("return",this.transport.reply(t,{content_uri:n.contentUri}));case 9:e.prev=9,e.t0=e.catch(2),console.error("error while uploading a file",e.t0),this.handleDriverError(e.t0,t,"Unexpected error while uploading a file");case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return O.apply(this,arguments)})},{key:"handleDownloadFile",value:(S=C(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasCapability(s.MatrixCapabilities.MSC4039DownloadFile)){e.next=2;break}return e.abrupt("return",this.transport.reply(t,{error:{message:"Missing capability"}}));case 2:return e.prev=2,e.next=5,this.driver.downloadFile(t.data.content_uri);case 5:return n=e.sent,e.abrupt("return",this.transport.reply(t,{file:n.file}));case 9:e.prev=9,e.t0=e.catch(2),console.error("error while downloading a file",e.t0),this.handleDriverError(e.t0,t,"Unexpected error while downloading a file");case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return S.apply(this,arguments)})},{key:"handleDriverError",value:function(e,t,n){var r=this.driver.processError(e);this.transport.reply(t,{error:g({message:n},r)})}},{key:"handleMessage",value:function(e){if(!this.isStopped){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case a.WidgetApiFromWidgetAction.ContentLoaded:return this.handleContentLoadedAction(e.detail);case a.WidgetApiFromWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case a.WidgetApiFromWidgetAction.SendEvent:return this.handleSendEvent(e.detail);case a.WidgetApiFromWidgetAction.SendToDevice:return this.handleSendToDevice(e.detail);case a.WidgetApiFromWidgetAction.GetOpenIDCredentials:return this.handleOIDC(e.detail);case a.WidgetApiFromWidgetAction.MSC2931Navigate:return this.handleNavigate(e.detail);case a.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities:return this.handleCapabilitiesRenegotiate(e.detail);case a.WidgetApiFromWidgetAction.MSC2876ReadEvents:return this.handleReadEvents(e.detail);case a.WidgetApiFromWidgetAction.WatchTurnServers:return this.handleWatchTurnServers(e.detail);case a.WidgetApiFromWidgetAction.UnwatchTurnServers:return this.handleUnwatchTurnServers(e.detail);case a.WidgetApiFromWidgetAction.MSC3869ReadRelations:return this.handleReadRelations(e.detail);case a.WidgetApiFromWidgetAction.MSC3973UserDirectorySearch:return this.handleUserDirectorySearch(e.detail);case a.WidgetApiFromWidgetAction.BeeperReadRoomAccountData:return this.handleReadRoomAccountData(e.detail);case a.WidgetApiFromWidgetAction.MSC4039GetMediaConfigAction:return this.handleGetMediaConfig(e.detail);case a.WidgetApiFromWidgetAction.MSC4039UploadFileAction:return this.handleUploadFile(e.detail);case a.WidgetApiFromWidgetAction.MSC4039DownloadFileAction:return this.handleDownloadFile(e.detail);case a.WidgetApiFromWidgetAction.MSC4157UpdateDelayedEvent:return this.handleUpdateDelayedEvent(e.detail);default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}}},{key:"updateTheme",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.ThemeChange,e)}},{key:"updateLanguage",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.LanguageChange,{lang:e})}},{key:"takeScreenshot",value:function(){return this.transport.send(a.WidgetApiToWidgetAction.TakeScreenshot,{})}},{key:"updateVisibility",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.UpdateVisibility,{visible:e})}},{key:"sendWidgetConfig",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.WidgetConfig,e).then()}},{key:"notifyModalWidgetButtonClicked",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.ButtonClicked,{id:e}).then()}},{key:"notifyModalWidgetClose",value:function(e){return this.transport.send(a.WidgetApiToWidgetAction.CloseModalWidget,e).then()}},{key:"feedEvent",value:(E=C(b().mark((function e(t,n){var r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&this.setViewedRoomId(n),t.room_id===this.viewedRoomId||this.canUseRoomTimeline(t.room_id)){e.next=3;break}return e.abrupt("return");case 3:if(void 0===t.state_key||null===t.state_key){e.next=8;break}if(this.canReceiveStateEvent(t.type,t.state_key)){e.next=6;break}return e.abrupt("return");case 6:e.next=10;break;case 8:if(this.canReceiveRoomEvent(t.type,null===(r=t.content)||void 0===r?void 0:r.msgtype)){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,this.transport.send(a.WidgetApiToWidgetAction.SendEvent,t);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"feedToDevice",value:(_=C(b().mark((function e(t,n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.canReceiveToDeviceEvent(t.type)){e.next=3;break}return e.next=3,this.transport.send(a.WidgetApiToWidgetAction.SendToDevice,g(g({},t),{},{encrypted:n}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"setViewedRoomId",value:function(e){this.viewedRoomId=e,null===e||this.canUseRoomTimeline(e)||this.pushRoomState(e)}},{key:"flushRoomState",value:(m=C(b().mark((function e(){var t,n,r,i,o,s,c;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0;case 1:return e.next=3,Promise.all(y(this.pushRoomStateTasks));case 3:if(this.pushRoomStateTasks.size>0){e.next=1;break}case 4:t=[],n=f(this.pushRoomStateResult.values());try{for(n.s();!(r=n.n()).done;){i=r.value,o=f(i.values());try{for(o.s();!(s=o.n()).done;)c=s.value,t.push.apply(t,y(c.values()))}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}return e.next=9,this.getWidgetVersions();case 9:if(!e.sent.includes(l.UnstableApiVersion.MSC2762_UPDATE_STATE)){e.next=12;break}return e.next=12,this.transport.send(a.WidgetApiToWidgetAction.UpdateState,{state:t});case 12:return e.prev=12,this.flushRoomStateTask=null,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,,12,15]])}))),function(){return m.apply(this,arguments)})},{key:"pushRoomState",value:function(e){var t,n=this,r=f(this.allowedEvents);try{var i=function(){var r=t.value;if(r.kind===c.EventKind.State&&r.direction===c.EventDirection.Receive){var i,o,a=n.driver.readRoomState(e,r.eventType,null!==(i=r.keyStr)&&void 0!==i?i:void 0).then((function(t){var i,o=f(t);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=n.pushRoomStateResult.get(e);void 0===s&&(s=new Map,n.pushRoomStateResult.set(e,s));var l=s.get(r.eventType);void 0===l&&(l=new Map,s.set(r.eventType,l)),l.has(a.state_key)||l.set(a.state_key,a)}}catch(e){o.e(e)}finally{o.f()}}),(function(t){return console.error("Failed to read room state for ".concat(e," (").concat(r.eventType,", ").concat(r.keyStr,")"),t)})).then((function(){n.pushRoomStateTasks.delete(a)}));n.pushRoomStateTasks.add(a),null!==(o=n.flushRoomStateTask)&&void 0!==o||(n.flushRoomStateTask=n.flushRoomState()),n.flushRoomStateTask.catch((function(e){return console.error("Failed to push room state",e)}))}};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}},{key:"feedStateUpdate",value:(r=C(b().mark((function e(t){var n,r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.state_key){e.next=2;break}throw new Error("Not a state event");case 2:if(t.room_id!==this.viewedRoomId&&!this.canUseRoomTimeline(t.room_id)||!this.canReceiveStateEvent(t.type,t.state_key)){e.next=21;break}if(0!==this.pushRoomStateTasks.size){e.next=11;break}return e.next=6,this.getWidgetVersions();case 6:if(!e.sent.includes(l.UnstableApiVersion.MSC2762_UPDATE_STATE)){e.next=9;break}return e.next=9,this.transport.send(a.WidgetApiToWidgetAction.UpdateState,{state:[t]});case 9:e.next=21;break;case 11:void 0===(n=this.pushRoomStateResult.get(t.room_id))&&(n=new Map,this.pushRoomStateResult.set(t.room_id,n)),void 0===(r=n.get(t.type))&&(r=new Map,n.set(t.type,r)),r.has(t.type)||r.set(t.state_key,t);case 16:return e.next=18,Promise.all(y(this.pushRoomStateTasks));case 18:if(this.pushRoomStateTasks.size>0){e.next=16;break}case 19:return e.next=21,this.flushRoomStateTask;case 21:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}],n&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),K}(r.EventEmitter);t.ClientWidgetApi=N},27:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Symbols=void 0;var n=function(e){return e.AnyRoom="*",e}({});t.Symbols=n},5094:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetApiResponseError=t.WidgetApi=void 0;var i=n(7007),o=n(9134),a=n(9323),s=n(2052),l=n(8769),c=n(1992),d=n(2091),u=n(8839),h=n(3099),p=n(27);function v(){v=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:C(e,n,s)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var h={};function p(){}function m(){}function g(){}var f={};c(f,a,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(k([])));_&&_!==t&&n.call(_,a)&&(f=_);var E=g.prototype=p.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function o(i,a,s,l){var c=u(e[i],e,a);if("throw"!==c.type){var d=c.arg,h=d.value;return h&&"object"==r(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){o("next",e,s,l)}),(function(e){o("throw",e,s,l)})):t.resolve(h).then((function(e){d.value=e,s(d)}),(function(e){return o("throw",e,s,l)}))}l(c.arg)}var a;i(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){o(e,n,t,r)}))}return a=a?a.then(r,r):r()}})}function C(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=u(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function k(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return m.prototype=g,i(E,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:m,configurable:!0}),m.displayName=c(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},b(S.prototype),c(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(d(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(E),c(E,l,"Generator"),c(E,a,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=k,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function m(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){m(o,r,i,a,s,"next",e)}function s(e){m(o,r,i,a,s,"throw",e)}a(void 0)}))}}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return(t=S(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,S(r.key),r)}}function b(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e){var t=function(e){if("object"!==r(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===r(t)?t:String(t)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function A(e){var t=O();return function(){var n,i=x(e);if(t){var o=x(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}(this,n)}}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){var t="function"==typeof Map?new Map:void 0;return I=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,x(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),R(r,e)},I(e)}function k(e,t,n){return k=O()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&R(i,n.prototype),i},k.apply(null,arguments)}function O(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function N(e){return new L(e,0)}function D(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof L;Promise.resolve(s?a.v:a).then((function(n){if(s){var l="return"===t?"return":"next";if(!a.k||n.done)return r(l,n);n=e[l](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function L(e,t){this.v=e,this.k=t}D.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},D.prototype.next=function(e){return this._invoke("next",e)},D.prototype.throw=function(e){return this._invoke("throw",e)},D.prototype.return=function(e){return this._invoke("return",e)};var P=function(e){w(n,e);var t=A(n);function n(e,r){var i;return C(this,n),(i=t.call(this,e)).data=r,i}return b(n)}(I(Error));t.WidgetApiResponseError=P,P.prototype.name=P.name;var M=function(e){w(E,e);var t,n,r,i,m,f=A(E);function E(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(C(this,E),(e=f.call(this)).clientOrigin=n,_(T(e),"transport",void 0),_(T(e),"capabilitiesFinished",!1),_(T(e),"supportsMSC2974Renegotiate",!1),_(T(e),"requestedCapabilities",[]),_(T(e),"approvedCapabilities",void 0),_(T(e),"cachedClientVersions",void 0),_(T(e),"turnServerWatchers",0),!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");return e.transport=new s.PostmessageTransport(o.WidgetApiDirection.FromWidget,t,window.parent,window),e.transport.targetOrigin=n,e.transport.on("message",e.handleMessage.bind(T(e))),e}return b(E,[{key:"hasCapability",value:function(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}},{key:"requestCapability",value:function(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}},{key:"requestCapabilities",value:function(e){var t=this;e.forEach((function(e){return t.requestCapability(e)}))}},{key:"requestCapabilityForRoomTimeline",value:function(e){this.requestCapability("org.matrix.msc2762.timeline:".concat(e))}},{key:"requestCapabilityToSendState",value:function(e,t){this.requestCapability(h.WidgetEventCapability.forStateEvent(h.EventDirection.Send,e,t).raw)}},{key:"requestCapabilityToReceiveState",value:function(e,t){this.requestCapability(h.WidgetEventCapability.forStateEvent(h.EventDirection.Receive,e,t).raw)}},{key:"requestCapabilityToSendToDevice",value:function(e){this.requestCapability(h.WidgetEventCapability.forToDeviceEvent(h.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveToDevice",value:function(e){this.requestCapability(h.WidgetEventCapability.forToDeviceEvent(h.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendEvent",value:function(e){this.requestCapability(h.WidgetEventCapability.forRoomEvent(h.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveEvent",value:function(e){this.requestCapability(h.WidgetEventCapability.forRoomEvent(h.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToSendMessage",value:function(e){this.requestCapability(h.WidgetEventCapability.forRoomMessageEvent(h.EventDirection.Send,e).raw)}},{key:"requestCapabilityToReceiveMessage",value:function(e){this.requestCapability(h.WidgetEventCapability.forRoomMessageEvent(h.EventDirection.Receive,e).raw)}},{key:"requestCapabilityToReceiveRoomAccountData",value:function(e){this.requestCapability(h.WidgetEventCapability.forRoomAccountData(h.EventDirection.Receive,e).raw)}},{key:"requestOpenIDConnectToken",value:function(){var e=this;return new Promise((function(t,n){e.transport.sendComplete(l.WidgetApiFromWidgetAction.GetOpenIDCredentials,{}).then((function(r){var i=r.response;i.state===c.OpenIDRequestState.Allowed?t(i):i.state===c.OpenIDRequestState.Blocked?n(new Error("User declined to verify their identity")):i.state===c.OpenIDRequestState.PendingUserConfirmation?e.on("action:".concat(l.WidgetApiToWidgetAction.OpenIDCredentials),(function o(a){a.preventDefault();var s=a.detail;s.data.original_request_id===r.requestId&&(s.data.state===c.OpenIDRequestState.Allowed?(t(s.data),e.transport.reply(s,{})):s.data.state===c.OpenIDRequestState.Blocked?(n(new Error("User declined to verify their identity")),e.transport.reply(s,{})):(n(new Error("Invalid state on reply: "+i.state)),e.transport.reply(s,{error:{message:"Invalid state"}})),e.off("action:".concat(l.WidgetApiToWidgetAction.OpenIDCredentials),o))})):n(new Error("Invalid state: "+i.state))})).catch(n)}))}},{key:"updateRequestedCapabilities",value:function(){return this.transport.send(l.WidgetApiFromWidgetAction.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}},{key:"sendContentLoaded",value:function(){return this.transport.send(l.WidgetApiFromWidgetAction.ContentLoaded,{}).then()}},{key:"sendSticker",value:function(e){return this.transport.send(l.WidgetApiFromWidgetAction.SendSticker,e).then()}},{key:"setAlwaysOnScreen",value:function(e){return this.transport.send(l.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,{value:e}).then((function(e){return e.success}))}},{key:"openModalWidget",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:d.MatrixWidgetType.Custom;return this.transport.send(l.WidgetApiFromWidgetAction.OpenModalWidget,{type:i,url:e,name:t,buttons:n,data:r}).then()}},{key:"closeModalWidget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.transport.send(l.WidgetApiFromWidgetAction.CloseModalWidget,e).then()}},{key:"sendRoomEvent",value:function(e,t,n,r,i){return this.sendEvent(e,void 0,t,n,r,i)}},{key:"sendStateEvent",value:function(e,t,n,r,i,o){return this.sendEvent(e,t,n,r,i,o)}},{key:"sendEvent",value:function(e,t,n,r,i,o){return this.transport.send(l.WidgetApiFromWidgetAction.SendEvent,y(y(y(y({type:e,content:n},void 0!==t&&{state_key:t}),void 0!==r&&{room_id:r}),void 0!==i&&{delay:i}),void 0!==o&&{parent_delay_id:o}))}},{key:"updateDelayedEvent",value:function(e,t){return this.transport.send(l.WidgetApiFromWidgetAction.MSC4157UpdateDelayedEvent,{delay_id:e,action:t})}},{key:"sendToDevice",value:function(e,t,n){return this.transport.send(l.WidgetApiFromWidgetAction.SendToDevice,{type:e,encrypted:t,messages:n})}},{key:"readRoomAccountData",value:function(e,t){var n={type:e};return t&&(t.includes(p.Symbols.AnyRoom)?n.room_ids=p.Symbols.AnyRoom:n.room_ids=t),this.transport.send(l.WidgetApiFromWidgetAction.BeeperReadRoomAccountData,n).then((function(e){return e.events}))}},{key:"readRoomEvents",value:function(e,t,n,r,i){var o={type:e,msgtype:n};return void 0!==t&&(o.limit=t),r&&(r.includes(p.Symbols.AnyRoom)?o.room_ids=p.Symbols.AnyRoom:o.room_ids=r),i&&(o.since=i),this.transport.send(l.WidgetApiFromWidgetAction.MSC2876ReadEvents,o).then((function(e){return e.events}))}},{key:"readEventRelations",value:(m=g(v().mark((function e(t,n,r,i,o,s,c,d){var u;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC3869)){e.next=5;break}throw new Error("The read_relations action is not supported by the client.");case 5:return u={event_id:t,rel_type:r,event_type:i,room_id:n,to:c,from:s,limit:o,direction:d},e.abrupt("return",this.transport.send(l.WidgetApiFromWidgetAction.MSC3869ReadRelations,u));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,o,a,s){return m.apply(this,arguments)})},{key:"readStateEvents",value:function(e,t,n,r){var i={type:e,state_key:void 0===n||n};return void 0!==t&&(i.limit=t),r&&(r.includes(p.Symbols.AnyRoom)?i.room_ids=p.Symbols.AnyRoom:i.room_ids=r),this.transport.send(l.WidgetApiFromWidgetAction.MSC2876ReadEvents,i).then((function(e){return e.events}))}},{key:"setModalButtonEnabled",value:function(e,t){if(e===u.BuiltInModalButtonID.Close)throw new Error("The close button cannot be disabled");return this.transport.send(l.WidgetApiFromWidgetAction.SetModalButtonEnabled,{button:e,enabled:t}).then()}},{key:"navigateTo",value:function(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(l.WidgetApiFromWidgetAction.MSC2931Navigate,{uri:e}).then()}},{key:"getTurnServers",value:function(){var e,t=this;return(e=v().mark((function e(){var n,r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(){var e=g(v().mark((function e(r){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n(r.detail.data),e.next=4,t.transport.reply(r.detail,{});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.on("action:".concat(l.WidgetApiToWidgetAction.UpdateTurnServers),r),0!==t.turnServerWatchers){e.next=12;break}return e.prev=3,e.next=6,N(t.transport.send(l.WidgetApiFromWidgetAction.WatchTurnServers,{}));case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),t.off("action:".concat(l.WidgetApiToWidgetAction.UpdateTurnServers),r),e.t0;case 12:t.turnServerWatchers++,e.prev=13;case 14:return e.next=17,N(new Promise((function(e){return n=e})));case 17:return e.next=19,e.sent;case 19:e.next=14;break;case 21:if(e.prev=21,t.off("action:".concat(l.WidgetApiToWidgetAction.UpdateTurnServers),r),t.turnServerWatchers--,0!==t.turnServerWatchers){e.next=27;break}return e.next=27,N(t.transport.send(l.WidgetApiFromWidgetAction.UnwatchTurnServers,{}));case 27:return e.finish(21);case 28:case"end":return e.stop()}}),e,null,[[3,8],[13,,21,28]])})),function(){return new D(e.apply(this,arguments))})()}},{key:"searchUserDirectory",value:(i=g(v().mark((function e(t,n){var r;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC3973)){e.next=5;break}throw new Error("The user_directory_search action is not supported by the client.");case 5:return r={search_term:t,limit:n},e.abrupt("return",this.transport.send(l.WidgetApiFromWidgetAction.MSC3973UserDirectorySearch,r));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getMediaConfig",value:(r=g(v().mark((function e(){var t;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC4039)){e.next=5;break}throw new Error("The get_media_config action is not supported by the client.");case 5:return t={},e.abrupt("return",this.transport.send(l.WidgetApiFromWidgetAction.MSC4039GetMediaConfigAction,t));case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"uploadFile",value:(n=g(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC4039)){e.next=5;break}throw new Error("The upload_file action is not supported by the client.");case 5:return n={file:t},e.abrupt("return",this.transport.send(l.WidgetApiFromWidgetAction.MSC4039UploadFileAction,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"downloadFile",value:(t=g(v().mark((function e(t){var n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClientVersions();case 2:if(e.sent.includes(a.UnstableApiVersion.MSC4039)){e.next=5;break}throw new Error("The download_file action is not supported by the client.");case 5:return n={content_uri:t},e.abrupt("return",this.transport.send(l.WidgetApiFromWidgetAction.MSC4039DownloadFileAction,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"start",value:function(){var e=this;this.transport.start(),this.getClientVersions().then((function(t){t.includes(a.UnstableApiVersion.MSC2974)&&(e.supportsMSC2974Renegotiate=!0)}))}},{key:"handleMessage",value:function(e){var t=new CustomEvent("action:".concat(e.detail.action),{detail:e.detail,cancelable:!0});if(this.emit("action:".concat(e.detail.action),t),!t.defaultPrevented)switch(e.detail.action){case l.WidgetApiToWidgetAction.SupportedApiVersions:return this.replyVersions(e.detail);case l.WidgetApiToWidgetAction.Capabilities:return this.handleCapabilities(e.detail);case l.WidgetApiToWidgetAction.UpdateVisibility:case l.WidgetApiToWidgetAction.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}},{key:"replyVersions",value:function(e){this.transport.reply(e,{supported_versions:a.CurrentApiVersions})}},{key:"getClientVersions",value:function(){var e=this;return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(l.WidgetApiFromWidgetAction.SupportedApiVersions,{}).then((function(t){return e.cachedClientVersions=t.supported_versions,t.supported_versions})).catch((function(e){return console.warn("non-fatal error getting supported client versions: ",e),[]}))}},{key:"handleCapabilities",value:function(e){var t=this;return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then((function(n){return n.includes(a.UnstableApiVersion.MSC2871)?t.once("action:".concat(l.WidgetApiToWidgetAction.NotifyCapabilities),(function(e){t.approvedCapabilities=e.detail.data.approved,t.emit("ready")})):t.emit("ready"),t.capabilitiesFinished=!0,t.transport.reply(e,{capabilities:t.requestedCapabilities})}))}}]),E}(i.EventEmitter);t.WidgetApi=M},435:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetDriver=void 0;var r=n(2238);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e){if("object"!==i(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===i(o)?o:String(o)),r)}var o}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"validateCapabilities",value:function(e){return Promise.resolve(new Set)}},{key:"sendEvent",value:function(e,t){return Promise.reject(new Error("Failed to override function"))}},{key:"sendDelayedEvent",value:function(e,t,n,r){return Promise.reject(new Error("Failed to override function"))}},{key:"updateDelayedEvent",value:function(e,t){return Promise.reject(new Error("Failed to override function"))}},{key:"sendToDevice",value:function(e,t,n){return Promise.reject(new Error("Failed to override function"))}},{key:"readRoomAccountData",value:function(e){return Promise.resolve([])}},{key:"readRoomEvents",value:function(e,t,n){return Promise.resolve([])}},{key:"readStateEvents",value:function(e,t,n){return Promise.resolve([])}},{key:"readRoomTimeline",value:function(e,t,n,r,i,o){return void 0===r?this.readRoomEvents(t,n,i,[e],o):this.readStateEvents(t,r,i,[e])}},{key:"readRoomState",value:function(e,t,n){return this.readStateEvents(t,n,Number.MAX_SAFE_INTEGER,[e])}},{key:"readEventRelations",value:function(e,t,n,r,i,o,a,s){return Promise.resolve({chunk:[]})}},{key:"askOpenID",value:function(e){e.update({state:r.OpenIDRequestState.Blocked})}},{key:"navigate",value:function(e){throw new Error("Navigation is not implemented")}},{key:"getTurnServers",value:function(){throw new Error("TURN server support is not implemented")}},{key:"searchUserDirectory",value:function(e,t){return Promise.resolve({limited:!1,results:[]})}},{key:"getMediaConfig",value:function(){throw new Error("Get media config is not implemented")}},{key:"uploadFile",value:function(e){throw new Error("Upload file is not implemented")}},{key:"downloadFile",value:function(e){throw new Error("Download file is not implemented")}},{key:"getKnownRooms",value:function(){throw new Error("Querying known rooms is not implemented")}},{key:"processError",value:function(e){}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.WidgetDriver=a},2238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5094);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n(2291);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var o=n(27);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(2052);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var s=n(2091);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=n(8409);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(8769);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(9134);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=n(9323);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var h=n(8145);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var p=n(1992);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var v=n(2121);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var m=n(6872);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(8839);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(1286);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var y=n(3099);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var _=n(8820);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var E=n(7008);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var b=n(7317);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var S=n(4478);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var C=n(2130);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var w=n(8300);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var A=n(435);Object.keys(A).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===A[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}}))}))},9323:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableApiVersion=t.MatrixApiVersion=t.CurrentApiVersions=void 0;var n=function(e){return e.Prerelease1="0.0.1",e.Prerelease2="0.0.2",e}({});t.MatrixApiVersion=n;var r=function(e){return e.MSC2762="org.matrix.msc2762",e.MSC2762_UPDATE_STATE="org.matrix.msc2762_update_state",e.MSC2871="org.matrix.msc2871",e.MSC2873="org.matrix.msc2873",e.MSC2931="org.matrix.msc2931",e.MSC2974="org.matrix.msc2974",e.MSC2876="org.matrix.msc2876",e.MSC3819="org.matrix.msc3819",e.MSC3846="town.robin.msc3846",e.MSC3869="org.matrix.msc3869",e.MSC3973="org.matrix.msc3973",e.MSC4039="org.matrix.msc4039",e}({});t.UnstableApiVersion=r;var i=[n.Prerelease1,n.Prerelease2,r.MSC2762,r.MSC2762_UPDATE_STATE,r.MSC2871,r.MSC2873,r.MSC2931,r.MSC2974,r.MSC2876,r.MSC3819,r.MSC3846,r.MSC3869,r.MSC3973,r.MSC4039];t.CurrentApiVersions=i},8145:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoConferenceCapabilities=t.StickerpickerCapabilities=t.MatrixCapabilities=void 0,t.getTimelineRoomIDFromCapability=function(e){return e.substring(e.indexOf(":")+1)},t.isTimelineCapability=function(e){return null==e?void 0:e.startsWith("org.matrix.msc2762.timeline:")},t.isTimelineCapabilityFor=function(e,t){return e==="org.matrix.msc2762.timeline:".concat(t)};var n=function(e){return e.Screenshots="m.capability.screenshot",e.StickerSending="m.sticker",e.AlwaysOnScreen="m.always_on_screen",e.RequiresClient="io.element.requires_client",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC3846TurnServers="town.robin.msc3846.turn_servers",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039UploadFile="org.matrix.msc4039.upload_file",e.MSC4039DownloadFile="org.matrix.msc4039.download_file",e.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e}({});t.MatrixCapabilities=n;var r=[n.StickerSending];t.StickerpickerCapabilities=r;var i=[n.AlwaysOnScreen];t.VideoConferenceCapabilities=i},1992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenIDRequestState=void 0;var n=function(e){return e.Allowed="allowed",e.Blocked="blocked",e.PendingUserConfirmation="request",e}({});t.OpenIDRequestState=n},8409:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isErrorResponse=function(e){var t=e.error;return"object"===n(t)&&null!==t&&"message"in t&&"string"==typeof t.message}},6872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModalButtonKind=void 0;var n=function(e){return e.Primary="m.primary",e.Secondary="m.secondary",e.Warning="m.warning",e.Danger="m.danger",e.Link="m.link",e}({});t.ModalButtonKind=n},8839:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BuiltInModalButtonID=void 0;var n=function(e){return e.Close="m.close",e}({});t.BuiltInModalButtonID=n},1286:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateDelayedEventAction=void 0;var n=function(e){return e.Cancel="cancel",e.Restart="restart",e.Send="send",e}({});t.UpdateDelayedEventAction=n},8769:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetApiToWidgetAction=t.WidgetApiFromWidgetAction=void 0;var n=function(e){return e.SupportedApiVersions="supported_api_versions",e.Capabilities="capabilities",e.NotifyCapabilities="notify_capabilities",e.ThemeChange="theme_change",e.LanguageChange="language_change",e.TakeScreenshot="screenshot",e.UpdateVisibility="visibility",e.OpenIDCredentials="openid_credentials",e.WidgetConfig="widget_config",e.CloseModalWidget="close_modal",e.ButtonClicked="button_clicked",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.UpdateState="update_state",e.UpdateTurnServers="update_turn_servers",e}({});t.WidgetApiToWidgetAction=n;var r=function(e){return e.SupportedApiVersions="supported_api_versions",e.ContentLoaded="content_loaded",e.SendSticker="m.sticker",e.UpdateAlwaysOnScreen="set_always_on_screen",e.GetOpenIDCredentials="get_openid",e.CloseModalWidget="close_modal",e.OpenModalWidget="open_modal",e.SetModalButtonEnabled="set_button_enabled",e.SendEvent="send_event",e.SendToDevice="send_to_device",e.WatchTurnServers="watch_turn_servers",e.UnwatchTurnServers="unwatch_turn_servers",e.BeeperReadRoomAccountData="com.beeper.read_room_account_data",e.MSC2876ReadEvents="org.matrix.msc2876.read_events",e.MSC2931Navigate="org.matrix.msc2931.navigate",e.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",e.MSC3869ReadRelations="org.matrix.msc3869.read_relations",e.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",e.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",e.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",e.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",e.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",e}({});t.WidgetApiFromWidgetAction=r},9134:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetApiDirection=void 0,t.invertedDirection=function(e){if(e===n.ToWidget)return n.FromWidget;if(e===n.FromWidget)return n.ToWidget;throw new Error("Invalid direction")};var n=function(e){return e.ToWidget="toWidget",e.FromWidget="fromWidget",e}({});t.WidgetApiDirection=n},2121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetKind=void 0;var n=function(e){return e.Room="room",e.Account="account",e.Modal="modal",e}({});t.WidgetKind=n},2091:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixWidgetType=void 0;var n=function(e){return e.Custom="m.custom",e.JitsiMeet="m.jitsi",e.Stickerpicker="m.stickerpicker",e}({});t.MatrixWidgetType=n},7317:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Widget=void 0;var r=n(7008),i=n(2238);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,i=function(e){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===o(i)?i:String(i)),r)}var i}var s=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.definition=t,!this.definition)throw new Error("Definition is required");(0,r.assertPresent)(t,"id"),(0,r.assertPresent)(t,"creatorUserId"),(0,r.assertPresent)(t,"type"),(0,r.assertPresent)(t,"url")}var t,n;return t=e,(n=[{key:"creatorUserId",get:function(){return this.definition.creatorUserId}},{key:"type",get:function(){return this.definition.type}},{key:"id",get:function(){return this.definition.id}},{key:"name",get:function(){return this.definition.name||null}},{key:"title",get:function(){return this.rawData.title||null}},{key:"templateUrl",get:function(){return this.definition.url}},{key:"origin",get:function(){return new URL(this.templateUrl).origin}},{key:"waitForIframeLoad",get:function(){return!1!==this.definition.waitForIframeLoad&&(this.definition.waitForIframeLoad,!0)}},{key:"rawData",get:function(){return this.definition.data||{}}},{key:"getCompleteUrl",value:function(e){return(0,i.runTemplate)(this.templateUrl,this.definition,e)}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.Widget=s},3099:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,o=function(e){if("object"!==n(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===n(o)?o:String(o)),i)}var o}Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetEventCapability=t.EventKind=t.EventDirection=void 0;var o=function(e){return e.Event="event",e.State="state_event",e.ToDevice="to_device",e.RoomAccount="room_account",e}({});t.EventKind=o;var a=function(e){return e.Send="send",e.Receive="receive",e}({});t.EventDirection=a;var s=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.direction=t,this.eventType=n,this.kind=r,this.keyStr=i,this.raw=o}var t,n,s;return t=e,n=[{key:"matchesAsStateEvent",value:function(e,t,n){return this.kind===o.State&&this.direction===e&&this.eventType===t&&(null===this.keyStr||this.keyStr===n)}},{key:"matchesAsToDeviceEvent",value:function(e,t){return this.kind===o.ToDevice&&this.direction===e&&this.eventType===t}},{key:"matchesAsRoomEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.kind===o.Event&&this.direction===e&&this.eventType===t&&("m.room.message"!==this.eventType||null===this.keyStr||this.keyStr===n)}},{key:"matchesAsRoomAccountData",value:function(e,t){return this.kind===o.RoomAccount&&this.direction===e&&this.eventType===t}}],s=[{key:"forStateEvent",value:function(t,n,r){n=n.replace(/#/g,"\\#"),r=null!=r?"#".concat(r):"";var i="org.matrix.msc2762.".concat(t,".state_event:").concat(n).concat(r);return e.findEventCapabilities([i])[0]}},{key:"forToDeviceEvent",value:function(t,n){var r="org.matrix.msc3819.".concat(t,".to_device:").concat(n);return e.findEventCapabilities([r])[0]}},{key:"forRoomEvent",value:function(t,n){var r="org.matrix.msc2762.".concat(t,".event:").concat(n);return e.findEventCapabilities([r])[0]}},{key:"forRoomMessageEvent",value:function(t,n){n=null==n?"":n;var r="org.matrix.msc2762.".concat(t,".event:m.room.message#").concat(n);return e.findEventCapabilities([r])[0]}},{key:"forRoomAccountData",value:function(t,n){var r="com.beeper.capabilities.".concat(t,".room_account_data:").concat(n);return e.findEventCapabilities([r])[0]}},{key:"findEventCapabilities",value:function(t){var n,i=[],s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}(t);try{for(s.s();!(n=s.n()).done;){var l=n.value,c=null,d=void 0,u=null;if(l.startsWith("org.matrix.msc2762.send.event:")?(c=a.Send,u=o.Event,d=l.substring(30)):l.startsWith("org.matrix.msc2762.send.state_event:")?(c=a.Send,u=o.State,d=l.substring(36)):l.startsWith("org.matrix.msc3819.send.to_device:")?(c=a.Send,u=o.ToDevice,d=l.substring(34)):l.startsWith("org.matrix.msc2762.receive.event:")?(c=a.Receive,u=o.Event,d=l.substring(33)):l.startsWith("org.matrix.msc2762.receive.state_event:")?(c=a.Receive,u=o.State,d=l.substring(39)):l.startsWith("org.matrix.msc3819.receive.to_device:")?(c=a.Receive,u=o.ToDevice,d=l.substring(37)):l.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(c=a.Receive,u=o.RoomAccount,d=l.substring(50)),null!==c&&null!==u&&void 0!==d){var h=d.startsWith("m.room.message#")||u===o.State,p=null;if(d.includes("#")&&h){var v=d.split("#"),m=v.findIndex((function(e){return!e.endsWith("\\")}));d=v.slice(0,m+1).map((function(e){return e.endsWith("\\")?e.substring(0,e.length-1):e})).join("#"),p=v.slice(m+1).join("#")}i.push(new e(c,d,u,p,l))}}}catch(e){s.e(e)}finally{s.f()}return i}}],n&&i(t.prototype,n),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.WidgetEventCapability=s},4478:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetParser=void 0;var r=n(7317),i=n(8820);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,i=function(e){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===o(i)?i:String(i)),r)}var i}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"parseAccountData",value:function(t){if(!t)return[];for(var n=[],r=0,i=Object.keys(t);r<i.length;r++){var o=i[r],a=t[o];if(a&&("m.widget"===a.type||"im.vector.modular.widgets"===a.type)&&a.sender&&(a.state_key||a.id)===o){var s={content:a.content,sender:a.sender,type:"m.widget",state_key:o,event_id:"$example",room_id:"!example",origin_server_ts:1},l=e.parseRoomWidget(s);l&&n.push(l)}}return n}},{key:"parseWidgetsFromRoomState",value:function(t){if(!t)return[];var n,r=[],i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=e.parseRoomWidget(o);s&&r.push(s)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"parseRoomWidget",value:function(t){if(!t)return null;if("m.widget"!==t.type&&"im.vector.modular.widgets"!==t.type)return null;var n=t.content||{},r={id:t.state_key,creatorUserId:n.creatorUserId||t.sender,name:n.name,type:n.type,url:n.url,waitForIframeLoad:n.waitForIframeLoad,data:n.data};return e.processEstimatedWidget(r)}},{key:"processEstimatedWidget",value:function(e){return e.id&&e.creatorUserId&&e.type&&(0,i.isValidUrl)(e.url)?new r.Widget(e):null}}],null&&s(t.prototype,null),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.WidgetParser=l},8820:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidUrl=function(e){if(!e)return!1;try{var t=new URL(e);return"http"===t.protocol||"https"===t.protocol}catch(e){if(e instanceof TypeError)return!1;throw e}}},7008:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertPresent=function(e,t){if(!e[t])throw new Error("".concat(String(t)," is required"))}},2130:(e,t)=>{"use strict";function n(e){return null==e?"".concat(e):String(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.runTemplate=function(e,t,r){for(var i=Object.assign({},t.data,{matrix_room_id:r.widgetRoomId||"",matrix_user_id:r.currentUserId,matrix_display_name:r.userDisplayName||r.currentUserId,matrix_avatar_url:r.userHttpAvatarUrl||"",matrix_widget_id:t.id,"org.matrix.msc2873.client_id":r.clientId||"","org.matrix.msc2873.client_theme":r.clientTheme||"","org.matrix.msc2873.client_language":r.clientLanguage||"","org.matrix.msc3819.matrix_device_id":r.deviceId||"","org.matrix.msc4039.matrix_base_url":r.baseUrl||""}),o=e,a=0,s=Object.keys(i);a<s.length;a++){var l=s[a],c="$".concat(l).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(c,"g");o=o.replace(d,encodeURIComponent(n(i[l])))}return o},t.toString=n},2052:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostmessageTransport=void 0;var r=n(7007),i=n(2238),o=["message"];function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function p(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=function(e){if("object"!==a(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===a(t)?t:String(t)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(m,e);var t,n,r,s,v=(r=m,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(s){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,e)});function m(e,t,n,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(i=v.call(this)).sendDirection=e,i.initialWidgetId=t,i.transportWindow=n,i.inboundWindow=r,p(u(i),"strictOriginCheck",!1),p(u(i),"targetOrigin","*"),p(u(i),"timeoutSeconds",10),p(u(i),"_ready",!1),p(u(i),"_widgetId",null),p(u(i),"outboundRequests",new Map),p(u(i),"stopController",new AbortController),i._widgetId=t,i}return t=m,(n=[{key:"ready",get:function(){return this._ready}},{key:"widgetId",get:function(){return this._widgetId||null}},{key:"nextRequestId",get:function(){for(var e="widgetapi-".concat(Date.now()),t=0,n=e;this.outboundRequests.has(n);)n="".concat(e,"-").concat(t++);return this.outboundRequests.set(n,null),n}},{key:"sendInternal",value:function(e){console.log("[PostmessageTransport] Sending object to ".concat(this.targetOrigin,": "),e),this.transportWindow.postMessage(e,this.targetOrigin)}},{key:"reply",value:function(e,t){return this.sendInternal(l(l({},e),{},{response:t}))}},{key:"send",value:function(e,t){return this.sendComplete(e,t).then((function(e){return e.response}))}},{key:"sendComplete",value:function(e,t){var n=this;if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));var r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:t};return e===i.WidgetApiToWidgetAction.UpdateVisibility&&(r.visible=t.visible),new Promise((function(e,t){var i=function(e){s(),t(e)},o=setTimeout((function(){return i(new Error("Request timed out"))}),1e3*(n.timeoutSeconds||1)),a=function(){return i(new Error("Transport stopped"))};n.stopController.signal.addEventListener("abort",a);var s=function(){n.outboundRequests.delete(r.requestId),clearTimeout(o),n.stopController.signal.removeEventListener("abort",a)};n.outboundRequests.set(r.requestId,{request:r,resolve:function(t){s(),e(t)},reject:i}),n.sendInternal(r)}))}},{key:"start",value:function(){var e=this;this.inboundWindow.addEventListener("message",(function(t){e.handleMessage(t)})),this._ready=!0}},{key:"stop",value:function(){this._ready=!1,this.stopController.abort()}},{key:"handleMessage",value:function(e){if(!this.stopController.signal.aborted&&e.data&&(!this.strictOriginCheck||e.origin===window.origin)){var t=e.data;if(t.action&&t.requestId&&t.widgetId)if(t.response){if(t.api!==this.sendDirection)return;this.handleResponse(t)}else{var n=t;if(n.api!==(0,i.invertedDirection)(this.sendDirection))return;this.handleRequest(n)}}}},{key:"handleRequest",value:function(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}},{key:"handleResponse",value:function(e){if(e.widgetId===this.widgetId){var t=this.outboundRequests.get(e.requestId);if(t)if((0,i.isErrorResponse)(e.response)){var n=e.response.error,r=n.message,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(n,o);t.reject(new i.WidgetApiResponseError(r,a))}else t.resolve(e)}}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),m}(r.EventEmitter);t.PostmessageTransport=m},8300:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e){if("object"!==n(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleObservable=void 0;var a=function(){function e(t){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,i=[],(r=o(r="listeners"))in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,t&&this.listeners.push(t)}var t,n;return t=e,(n=[{key:"onUpdate",value:function(e){this.listeners.push(e)}},{key:"update",value:function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw a}}}}(this.listeners);try{for(n.s();!(t=n.n()).done;)(0,t.value)(e)}catch(e){n.e(e)}finally{n.f()}}},{key:"close",value:function(){this.listeners=[]}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.SimpleObservable=a},6585:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,a){a=a||{};var s,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&!1===isNaN(e))return a.long?o(s=e,i,"day")||o(s,r,"hour")||o(s,n,"minute")||o(s,t,"second")||s+" ms":function(e){return e>=i?Math.round(e/i)+"d":e>=r?Math.round(e/r)+"h":e>=n?Math.round(e/n)+"m":e>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1906:e=>{var t,n;n=function(e,n,r){var i,o,a,s,l,c,d,u,h,p,v,m,g,f,y;if(null==r&&(r={}),!(n>=2))throw new RangeError("`n` must be at least 2");if(0===(g=e.length))return new t([],0);if(1===g)return l=e[0],new t([l],l.weight);if(r.sorted||(e=e.slice(0).sort((function(e,t){return t.weight-e.weight}))),f=1+(n-1)*(v=Math.ceil((g-1)/(n-1)))-g,o=Array(v),d=0,i=0,c=g-1,f>0){for(m=n-f,y=0,s=Array(m),a=0;a<m;)l=e[c],s[a]=l,y+=l.weight,c--,a++;o[0]=new t(s,y),d=1}for(p=c>=0?e[c]:null;d<v;){for(y=0,s=Array(n),a=0,h=o[i];a<n;)null==p||null!=h&&h.weight<=p.weight?(u=h,h=o[++i]):(u=p,p=--c>=0?e[c]:null),s[a]=u,y+=u.weight,a++;o[d]=new t(s,y),d++}return o[v-1]},t=function(){function e(e,t){this.children=e,this.weight=t}return e.prototype.assignCodeWords=function(t,n,r){var i,o,a,s,l;for(null==r&&(r=""),a=0,o=(l=this.children).length-1;o>=0;o+=-1)s=l[o],i=r+t[a++],s instanceof e?s.assignCodeWords(t,n,i):n(s,i)},e}(),e.exports={createTree:n,BranchPoint:t}},4623:function(e){e.exports=function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function t(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function n(e,n,r){this.root=null,this._routes=[],this._useHash=n,this._hash=void 0===r?"#":r,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!n&&t(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=n?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):n&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function r(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function i(e){return e.replace(/\/$/,"").split("/").length}function o(e,t){return i(t)-i(e)}function a(e,t){return function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(t){var i=function(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(n.PARAMETER_REGEXP,(function(e,r,i){return t.push(i),n.REPLACE_VARIABLE_REGEXP})).replace(n.WILDCARD_REGEXP,n.REPLACE_WILDCARD)+n.FOLLOWED_BY_SLASH_REGEXP,n.MATCH_REGEXP_FLAGS),paramNames:t}}(r(t.route)),o=i.regexp,a=i.paramNames,s=e.replace(/^\/+/,"/").match(o),l=function(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce((function(e,n,r){return null===e&&(e={}),e[t[r]]=decodeURIComponent(n),e}),null):null}(s,a);return!!s&&{match:s,route:t,params:l}})).filter((function(e){return e}))}(e,t)[0]||!1}function s(e,t){var n=t.map((function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]})),i=r(e);return n.length>1?n.reduce((function(e,t){return e.length>t.length&&(e=t),e}),n[0]):1===n.length?n[0]:i}function l(e,n,r){var i,o=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===r&&(r="#"),t()&&!n?o(e).split(r)[0]:(i=e.split(r)).length>1?o(i[1]):o(i[0])}function c(t,n,r){if(n&&"object"===(void 0===n?"undefined":e(n))){if(n.before)return void n.before((function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(t(),n.after&&n.after(r))}),r);if(n.after)return t(),void(n.after&&n.after(r))}t()}return n.prototype={helpers:{match:a,root:s,clean:r,getOnlyURL:l},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var t=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];if("function"==typeof r[0])this._defaultHandler={handler:r[0],hooks:r[1]};else if(r.length>=2)if("/"===r[0]){var a=r[1];"object"===e(r[1])&&(a=r[1].uses),this._defaultHandler={handler:a,hooks:r[2]}}else this._add(r[0],r[1],r[2]);else"object"===e(r[0])&&Object.keys(r[0]).sort(o).forEach((function(e){t.on(e,r[0][e])}));return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(t,n){return n.handler!==e&&t.push(n),t}),[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var n,r,i=this,o=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(o=o.replace(new RegExp("^/"+this._hash),"/"));var s=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),d=l(o,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&d===this._lastRouteResolved.url&&s===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(r=a(d,this._routes))?(this._callLeave(),this._lastRouteResolved={url:d,query:s,hooks:r.route.hooks,params:r.params,name:r.route.name},n=r.route.handler,c((function(){c((function(){r.route.route instanceof RegExp?n.apply(void 0,r.match.slice(1,r.match.length)):n(r.params,s)}),r.route.hooks,r.params,i._genericHooks)}),this._genericHooks,r.params),r):this._defaultHandler&&(""===d||"/"===d||d===this._hash||function(e,n,r){if(t()&&!n)return!1;if(!e.match(r))return!1;var i=e.split(r);return i.length<2||""===i[1]}(d,this._useHash,this._hash))?(c((function(){c((function(){i._callLeave(),i._lastRouteResolved={url:d,query:s,hooks:i._defaultHandler.hooks},i._defaultHandler.handler(s)}),i._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&c((function(){c((function(){i._callLeave(),i._lastRouteResolved={url:d,query:s,hooks:i._notFoundHandler.hooks},i._notFoundHandler.handler(s)}),i._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var r=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(r.replace(/\/+$/,"").replace(/^\/+/,"/")))})),t.hasListenerAttached=!0)}))},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce((function(n,r){var i;if(r.name===e)for(i in n=r.route,t)n=n.toString().replace(":"+i,t[i]);return n}),"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){t()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof t&&(t=encodeURI(t)),this._routes.push("object"===(void 0===n?"undefined":e(n))?{route:t,handler:n.uses,name:n.as,hooks:r||n.hooks}:{route:t,handler:n,hooks:r}),this._add},_getRoot:function(){return null!==this.root||(this.root=s(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,r=void 0;(r=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(r,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:r(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},n.PARAMETER_REGEXP=/([:*])(\w+)/g,n.WILDCARD_REGEXP=/\*/g,n.REPLACE_VARIABLE_REGEXP="([^/]+)",n.REPLACE_WILDCARD="(?:.*)",n.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",n.MATCH_REGEXP_FLAGS="",n}()},4116:(e,t,n)=>{"use strict";const r=n(5617),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class o extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const a=(e,t)=>new Promise(((n,a)=>{t={onFailedAttempt:()=>{},retries:10,...t};const s=r.operation(t);s.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void a(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof o)s.stop(),a(e.originalError);else if(e instanceof TypeError&&(l=e.message,!i.includes(l)))s.stop(),a(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void a(e)}s.retry(e)||a(s.mainError())}}var l}))}));e.exports=a,e.exports.default=a,e.exports.AbortError=o},3992:(e,t)=>{"use strict";var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function i(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var r,o,a=[];for(o in"string"!=typeof t&&(t="?"),e)if(n.call(e,o)){if((r=e[o])||null!=r&&!isNaN(r)||(r=""),o=i(o),r=i(r),null===o||null===r)continue;a.push(o+"="+r)}return a.length?t+a.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var o=r(t[1]),a=r(t[2]);null===o||null===a||o in i||(i[o]=a)}return i}},2063:e=>{"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},5617:(e,t,n)=>{e.exports=n(8303)},8303:(e,t,n)=>{var r=n(3961);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],e)"function"==typeof e[i]&&r.push(i);for(var o=0;o<r.length;o++){var a=r[o],s=e[a];e[a]=function(r){var i=t.operation(n),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),a.apply(this,arguments))})),i.attempt((function(){r.apply(e,o)}))}.bind(e,s),e[a].options=n}}},3961:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],o=i.message,a=(e[o]||0)+1;e[o]=a,a>=n&&(t=i,n=a)}return t}},5602:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},7363:(e,t,n)=>{var r=n(5020),i=n(3804);n(5602),t.M9=i,t.qg=r.parse,r.parseParams,r.parseFmtpConfig,r.parsePayloads,r.parseRemoteCandidates,r.parseImageAttributes,r.parseSimulcastStreamList},5020:(e,t,n)=>{var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(5602),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach((function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var l=o[t][s];if(l.reg.test(a))return i(l,r,a)}})),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},3804:(e,t,n)=>{var r=n(5602),i=/%[sdv%]/g,o=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},a=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?r.push(n[t.name][a]):r.push(n[t.names[i]])}else r.push(n[t.name]);return o.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,i=t.innerOrder||l,o=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){o.push(a(t,n,e))}))}))})),e.media.forEach((function(e){o.push(a("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){o.push(a(t,n,e))}))}))}))})),o.join("\r\n")+"\r\n"}},5072:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var h=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var v=i(p,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:v,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var l=r(e,i),c=0;c<o.length;c++){var d=n(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},7659:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1487:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(5731)),o=l(n(7833)),a=n(3011),s=l(n(1160));function l(e){return e&&e.__esModule?e:{default:e}}var c={log:(0,o.default)("superlogin:log"),info:(0,o.default)("superlogin:info"),warn:(0,o.default)("superlogin:warn"),error:(0,o.default)("superlogin:error")};function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}function u(e){return new s.default(e).host}function h(e,t){for(var n=u(e),r=0;r<t.length;r+=1)if(n===t[r])return!0;return!1}function p(e){return e&&e.response&&e.response.data?e.response.data:e}var v={setItem:function(e,t){v.storage.set(e,t)},getItem:function(e){var t=v.storage.get(e);return void 0!==t?t:null},removeItem:function(e){v.storage.delete(e)},storage:new Map},m=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._oauthComplete=!1,e._config={},e._refreshInProgress=!1,e._http=i.default.create(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"configure",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.serverUrl&&(this._http=i.default.create({baseURL:t.serverUrl,timeout:t.timeout})),t.baseUrl=t.baseUrl||"/auth",t.baseUrl=t.baseUrl.replace(/\/$/,""),t.socialUrl=t.socialUrl||t.baseUrl,t.socialUrl=t.socialUrl.replace(/\/$/,""),t.local=t.local||{},t.local.usernameField=t.local.usernameField||"username",t.local.passwordField=t.local.passwordField||"password",t.endpoints&&t.endpoints instanceof Array||(t.endpoints=[]),!t.noDefaultEndpoint){var n=window.location.host;t.serverUrl&&(n=u(t.serverUrl)),t.endpoints.push(n)}t.providers=t.providers||[],t.timeout=t.timeout||0,function(){var e="__STORAGE__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}()?"session"===t.storage?this.storage=window.sessionStorage:this.storage=window.localStorage:this.storage=v,this._config=t,this._session=JSON.parse(this.storage.getItem("superlogin.session")),this._httpInterceptor(),t.checkExpired&&(this.checkExpired(),this.validateSession().then((function(){e._onLogin(e._session)})).catch((function(){})))}},{key:"_httpInterceptor",value:function(){var e=this;this._http.interceptors.request.eject(this._httpRequestInterceptor),this._http.interceptors.response.eject(this._httpResponseInterceptor),this._httpRequestInterceptor=this._http.interceptors.request.use(function(t){var n=e.getConfig(),r=e.getSession();return r&&r.token?t.skipRefresh?Promise.resolve(t):e.checkRefresh().then((function(){return h(t.url,n.endpoints)&&(t.headers.Authorization="Bearer "+r.token+":"+r.password),t})):Promise.resolve(t)}.bind(this)),this._httpResponseInterceptor=this._http.interceptors.response.use(null,function(t){var n=e.getConfig();return t&&t.config?(h(t.config.url,n.endpoints)&&t.response&&401===t.response.status&&e.authenticated()&&(c.warn("Not authorized"),e._onLogout("Session expired")),Promise.reject(t)):Promise.reject(t)}.bind(this))}},{key:"authenticated",value:function(){return!(!this._session||!this._session.user_id)}},{key:"getConfig",value:function(){return this._config}},{key:"validateSession",value:function(){var e=this;return this.authenticated()?this._http.get(this._config.baseUrl+"/session").catch((function(t){throw e._onLogout("Session expired"),p(t)})):Promise.reject()}},{key:"getSession",value:function(){return this._session||(this._session=JSON.parse(this.storage.getItem("superlogin.session"))),this._session?Object.assign(this._session):null}},{key:"setSession",value:function(e){this._session=e,this.storage.setItem("superlogin.session",JSON.stringify(this._session)),c.info("New session set")}},{key:"deleteSession",value:function(){this.storage.removeItem("superlogin.session"),this._session=null}},{key:"getDbUrl",value:function(e){return this._session.userDBs&&this._session.userDBs[e]?this._session.userDBs[e]:null}},{key:"getHttp",value:function(){return this._http}},{key:"confirmRole",value:function(e){return!!(this._session&&this._session.roles&&this._session.roles.length)&&-1!==this._session.roles.indexOf(e)}},{key:"confirmAnyRole",value:function(e){if(!this._session||!this._session.roles||!this._session.roles.length)return!1;for(var t=0;t<e.length;t+=1)if(-1!==this._session.roles.indexOf(e[t]))return!0;return!1}},{key:"confirmAllRoles",value:function(e){if(!this._session||!this._session.roles||!this._session.roles.length)return!1;for(var t=0;t<e.length;t+=1)if(-1===this._session.roles.indexOf(e[t]))return!1;return!0}},{key:"checkRefresh",value:function(){if(this._refreshInProgress)return Promise.resolve();if(!this._session||!this._session.user_id)return Promise.reject();var e=this._session.refreshed||this._session.issued,t=this._session.expires,n=isNaN(this._config.refreshThreshold)?.5:this._config.refreshThreshold,r=t-e,i=this._session.serverTimeDiff||0;return Math.abs(i)<5e3&&(i=0),(Date.now()+i-e)/r>n?(c.info("Refreshing session"),this.refresh().then((function(e){return c.log("Refreshing session sucess",e),e})).catch((function(e){throw c.error("Refreshing session failed",e),e}))):Promise.resolve()}},{key:"checkExpired",value:function(){if(this.authenticated()){var e=this._session.expires,t=this._session.serverTimeDiff||0;Math.abs(t)<5e3&&(t=0),Date.now()+t>e&&this._onLogout("Session expired")}}},{key:"refresh",value:function(){var e=this,t=this.getSession();return this._refreshInProgress=!0,this._http.post(this._config.baseUrl+"/refresh",{}).then((function(n){return e._refreshInProgress=!1,n.data.token&&n.data.expires&&(Object.assign(t,n.data),e.setSession(t),e._onRefresh(t)),t})).catch((function(t){throw e._refreshInProgress=!1,p(t)}))}},{key:"authenticate",value:function(){var e=this;return new Promise((function(t){var n=e.getSession();n?t(n):e.on("login",(function(e){t(e)}))}))}},{key:"login",value:function(e){var t=this,n=this._config.local,r=n.usernameField,i=n.passwordField;return e[r]&&e[i]?this._http.post(this._config.baseUrl+"/login",e,{skipRefresh:!0}).then((function(e){return e.data.serverTimeDiff=e.data.issued-Date.now(),t.setSession(e.data),t._onLogin(e.data),e.data})).catch((function(e){throw t.deleteSession(),p(e)})):Promise.reject({error:"Username or Password missing..."})}},{key:"register",value:function(e){var t=this;return this._http.post(this._config.baseUrl+"/register",e,{skipRefresh:!0}).then((function(n){return n.data.user_id&&n.data.token&&(n.data.serverTimeDiff=n.data.issued-Date.now(),t.setSession(n.data),t._onLogin(n.data)),t._onRegister(e),n.data})).catch((function(e){throw p(e)}))}},{key:"logout",value:function(e){var t=this;return this._http.post(this._config.baseUrl+"/logout",{}).then((function(n){return t._onLogout(e||"Logged out"),n.data})).catch((function(n){if(t._onLogout(e||"Logged out"),!n.response||401!==n.response.data.status)throw p(n)}))}},{key:"logoutAll",value:function(e){var t=this;return this._http.post(this._config.baseUrl+"/logout-all",{}).then((function(n){return t._onLogout(e||"Logged out"),n.data})).catch((function(n){if(t._onLogout(e||"Logged out"),!n.response||401!==n.response.data.status)throw p(n)}))}},{key:"logoutOthers",value:function(){return this._http.post(this._config.baseUrl+"/logout-others",{}).then((function(e){return e.data})).catch((function(e){throw p(e)}))}},{key:"socialAuth",value:function(e){if(-1===this._config.providers.indexOf(e))return Promise.reject({error:"Provider "+e+" not supported."});var t=this._config.socialUrl+"/"+e;return this._oAuthPopup(t,{windowTitle:"Login with "+d(e)})}},{key:"tokenSocialAuth",value:function(e,t){var n=this;return-1===this._config.providers.indexOf(e)?Promise.reject({error:"Provider "+e+" not supported."}):this._http.post(this._config.baseUrl+"/"+e+"/token",{access_token:t}).then((function(e){return e.data.user_id&&e.data.token&&(e.data.serverTimeDiff=e.data.issued-Date.now(),n.setSession(e.data),n._onLogin(e.data)),e.data})).catch((function(e){throw p(e)}))}},{key:"tokenLink",value:function(e,t){if(-1===this._config.providers.indexOf(e))return Promise.reject({error:"Provider "+e+" not supported."});var n=this._config.baseUrl+"/link/"+e+"/token";return this._http.post(n,{access_token:t}).then((function(e){return e.data})).catch((function(e){throw p(e)}))}},{key:"link",value:function(e){if(-1===this._config.providers.indexOf(e))return Promise.reject({error:"Provider "+e+" not supported."});if(this.authenticated()){var t=this.getSession(),n="bearer_token="+t.token+":"+t.password,r=this._config.socialUrl+"/link/"+e+"?"+n,i="Link your account to "+d(e);return this._oAuthPopup(r,{windowTitle:i})}return Promise.reject({error:"Authentication required"})}},{key:"unlink",value:function(e){return-1===this._config.providers.indexOf(e)?Promise.reject({error:"Provider "+e+" not supported."}):this.authenticated()?this._http.post(this._config.baseUrl+"/unlink/"+e).then((function(e){return e.data})).catch((function(e){throw p(e)})):Promise.reject({error:"Authentication required"})}},{key:"confirmEmail",value:function(e){return e&&"string"==typeof e?this._http.get(this._config.baseUrl+"/confirm-email/"+e).then((function(e){return e.data})).catch((function(e){throw p(e)})):Promise.reject({error:"Invalid token"})}},{key:"forgotPassword",value:function(e){return this._http.post(this._config.baseUrl+"/forgot-password",{email:e},{skipRefresh:!0}).then((function(e){return e.data})).catch((function(e){throw p(e)}))}},{key:"resetPassword",value:function(e){var t=this;return this._http.post(this._config.baseUrl+"/password-reset",e,{skipRefresh:!0}).then((function(e){return e.data.user_id&&e.data.token&&(t.setSession(e.data),t._onLogin(e.data)),e.data})).catch((function(e){throw p(e)}))}},{key:"changePassword",value:function(e){return this.authenticated()?this._http.post(this._config.baseUrl+"/password-change",e).then((function(e){return e.data})).catch((function(e){throw p(e)})):Promise.reject({error:"Authentication required"})}},{key:"changeEmail",value:function(e){return this.authenticated()?this._http.post(this._config.baseUrl+"/change-email",{newEmail:e}).then((function(e){return e.data})).catch((function(e){throw p(e)})):Promise.reject({error:"Authentication required"})}},{key:"validateUsername",value:function(e){return this._http.get(this._config.baseUrl+"/validate-username/"+encodeURIComponent(e)).then((function(){return!0})).catch((function(e){throw p(e)}))}},{key:"validateEmail",value:function(e){return this._http.get(this._config.baseUrl+"/validate-email/"+encodeURIComponent(e)).then((function(){return!0})).catch((function(e){throw p(e)}))}},{key:"_oAuthPopup",value:function(e,t){var n=this;return new Promise((function(r,i){n._oauthComplete=!1,t.windowName=t.windowTitle||"Social Login",t.windowOptions=t.windowOptions||"location=0,status=0,width=800,height=600";var o=window.open(e,t.windowName,t.windowOptions);o||i({error:"Authorization popup blocked"});var a=setInterval((function(){o.closed&&(clearInterval(a),n._oauthComplete||(n.authComplete=!0,i({error:"Authorization cancelled"})))}),500);window.superlogin={},window.superlogin.oauthSession=function(e,t,o){return!e&&t?(t.serverTimeDiff=t.issued-Date.now(),n.setSession(t),n._onLogin(t),r(t)):!e&&o?(n._onLink(o),r(d(o)+" successfully linked.")):(n._oauthComplete=!0,i(e))}}))}},{key:"_onLogin",value:function(e){c.info("Login",e),this.emit("login",e)}},{key:"_onLogout",value:function(e){this.deleteSession(),c.info("Logout",e),this.emit("logout",e)}},{key:"_onLink",value:function(e){c.info("Link",e),this.emit("link",e)}},{key:"_onRegister",value:function(e){c.info("Register",e),this.emit("register",e)}},{key:"_onRefresh",value:function(e){c.info("Refresh",e),this.emit("refresh",e)}}]),t}(a.EventEmitter2);t.A=new m},5731:(e,t,n)=>{e.exports=n(7829)},3314:(e,t,n)=>{"use strict";var r=n(9166),i=n(2484),o=n(8928),a=n(834),s=n(9976),l=n(1317),c="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(8647);e.exports=function(e){return new Promise((function(t,d){var u=e.data,h=e.headers;r.isFormData(u)&&delete h["Content-Type"];var p=new XMLHttpRequest,v="onreadystatechange",m=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in p||s(e.url)||(p=new window.XDomainRequest,v="onload",m=!0,p.onprogress=function(){},p.ontimeout=function(){}),e.auth){var g=e.auth.username||"",f=e.auth.password||"";h.Authorization="Basic "+c(g+":"+f)}if(p.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p[v]=function(){if(p&&(4===p.readyState||m)&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,r={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:1223===p.status?204:p.status,statusText:1223===p.status?"No Content":p.statusText,headers:n,config:e,request:p};i(t,d,r),p=null}},p.onerror=function(){d(l("Network Error",e,null,p)),p=null},p.ontimeout=function(){d(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",p)),p=null},r.isStandardBrowserEnv()){var y=n(7762),_=(e.withCredentials||s(e.url))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;_&&(h[e.xsrfHeaderName]=_)}if("setRequestHeader"in p&&r.forEach(h,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),e.withCredentials&&(p.withCredentials=!0),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),d(e),p=null)})),void 0===u&&(u=null),p.send(u)}))}},7829:(e,t,n)=>{"use strict";var r=n(9166),i=n(3178),o=n(5925),a=n(4733);function s(e){var t=new o(e),n=i(o.prototype.request,t);return r.extend(n,o.prototype,t),r.extend(n,t),n}var l=s(a);l.Axios=o,l.create=function(e){return s(r.merge(a,e))},l.Cancel=n(6434),l.CancelToken=n(2929),l.isCancel=n(7894),l.all=function(e){return Promise.all(e)},l.spread=n(4818),e.exports=l,e.exports.default=l},6434:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},2929:(e,t,n)=>{"use strict";var r=n(6434);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},7894:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},5925:(e,t,n)=>{"use strict";var r=n(4733),i=n(9166),o=n(2165),a=n(8660),s=n(959),l=n(7658);function c(e){this.defaults=e,this.interceptors={request:new o,response:new o}}c.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(r,this.defaults,{method:"get"},e)).method=e.method.toLowerCase(),e.baseURL&&!s(e.url)&&(e.url=l(e.baseURL,e.url));var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},i.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,n){return this.request(i.merge(n||{},{method:e,url:t}))}})),i.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,n,r){return this.request(i.merge(r||{},{method:e,url:t,data:n}))}})),e.exports=c},2165:(e,t,n)=>{"use strict";var r=n(9166);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},1317:(e,t,n)=>{"use strict";var r=n(9091);e.exports=function(e,t,n,i,o){var a=new Error(e);return r(a,t,n,i,o)}},8660:(e,t,n)=>{"use strict";var r=n(9166),i=n(5995),o=n(7894),a=n(4733);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},9091:e=>{"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e}},2484:(e,t,n)=>{"use strict";var r=n(1317);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},5995:(e,t,n)=>{"use strict";var r=n(9166);e.exports=function(e,t,n){return r.forEach(n,(function(n){e=n(e,t)})),e}},4733:(e,t,n)=>{"use strict";var r=n(9166),i=n(5460),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,l={adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process)&&(s=n(3314)),s),transformRequest:[function(e,t){return i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(o)})),e.exports=l},3178:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},8647:e=>{"use strict";function t(){this.message="String contains an invalid character"}t.prototype=new Error,t.prototype.code=5,t.prototype.name="InvalidCharacterError",e.exports=function(e){for(var n,r,i=String(e),o="",a=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|a)||(s="=",a%1);o+=s.charAt(63&n>>8-a%1*8)){if((r=i.charCodeAt(a+=3/4))>255)throw new t;n=n<<8|r}return o}},8928:(e,t,n)=>{"use strict";var r=n(9166);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)&&(t+="[]"),r.isArray(e)||(e=[e]),r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},7658:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},7762:(e,t,n)=>{"use strict";var r=n(9166);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},959:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},9976:(e,t,n)=>{"use strict";var r=n(9166);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},5460:(e,t,n)=>{"use strict";var r=n(9166);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},834:(e,t,n)=>{"use strict";var r=n(9166);e.exports=function(e){var t,n,i,o={};return e?(r.forEach(e.split("\n"),(function(e){i=e.indexOf(":"),t=r.trim(e.substr(0,i)).toLowerCase(),n=r.trim(e.substr(i+1)),t&&(o[t]=o[t]?o[t]+", "+n:n)})),o):o}},4818:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},9166:(e,t,n)=>{"use strict";var r=n(3178),i=n(7206),o=Object.prototype.toString;function a(e){return"[object Array]"===o.call(e)}function s(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===o.call(e)}function c(e,t){if(null!=e)if("object"==typeof e||a(e)||(e=[e]),a(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:i,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:c,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)c(arguments[r],n);return t},extend:function(e,t,n){return c(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},5395:(e,t,n)=>{"use strict";var r=n(144),i=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function o(e){return r[e]}e.exports=function(e){return e.replace(i,o)}},1160:(e,t,n)=>{"use strict";var r=n(2063),i=n(3992),o=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a=/[\n\r\t]/g,s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/:\d+$/,c=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,d=/^[a-zA-Z]:/;function u(e){return(e||"").toString().replace(o,"")}var h=[["#","hash"],["?","query"],function(e,t){return m(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function v(e){var t,r=("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{}).location||{},i={},o=typeof(e=e||r);if("blob:"===e.protocol)i=new f(unescape(e.pathname),{});else if("string"===o)for(t in i=new f(e,{}),p)delete i[t];else if("object"===o){for(t in e)t in p||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=s.test(e.href))}return i}function m(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function g(e,t){e=(e=u(e)).replace(a,""),t=t||{};var n,r=c.exec(e),i=r[1]?r[1].toLowerCase():"",o=!!r[2],s=!!r[3],l=0;return o?s?(n=r[2]+r[3]+r[4],l=r[2].length+r[3].length):(n=r[2]+r[4],l=r[2].length):s?(n=r[3]+r[4],l=r[3].length):n=r[4],"file:"===i?l>=2&&(n=n.slice(2)):m(i)?n=r[4]:i?o&&(n=n.slice(2)):l>=2&&m(t.protocol)&&(n=r[4]),{protocol:i,slashes:o||m(i),slashesCount:l,rest:n}}function f(e,t,n){if(e=(e=u(e)).replace(a,""),!(this instanceof f))return new f(e,t,n);var o,s,l,c,p,y,_=h.slice(),E=typeof t,b=this,S=0;for("object"!==E&&"string"!==E&&(n=t,t=null),n&&"function"!=typeof n&&(n=i.parse),o=!(s=g(e||"",t=v(t))).protocol&&!s.slashes,b.slashes=s.slashes||o&&t.slashes,b.protocol=s.protocol||t.protocol||"",e=s.rest,("file:"===s.protocol&&(2!==s.slashesCount||d.test(e))||!s.slashes&&(s.protocol||s.slashesCount<2||!m(b.protocol)))&&(_[3]=[/(.*)/,"pathname"]);S<_.length;S++)"function"!=typeof(c=_[S])?(l=c[0],y=c[1],l!=l?b[y]=e:"string"==typeof l?~(p="@"===l?e.lastIndexOf(l):e.indexOf(l))&&("number"==typeof c[2]?(b[y]=e.slice(0,p),e=e.slice(p+c[2])):(b[y]=e.slice(p),e=e.slice(0,p))):(p=l.exec(e))&&(b[y]=p[1],e=e.slice(0,p.index)),b[y]=b[y]||o&&c[3]&&t[y]||"",c[4]&&(b[y]=b[y].toLowerCase())):e=c(e,b);n&&(b.query=n(b.query)),o&&t.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==t.pathname)&&(b.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],o=!1,a=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),a++):a&&(0===r&&(o=!0),n.splice(r,1),a--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(b.pathname,t.pathname)),"/"!==b.pathname.charAt(0)&&m(b.protocol)&&(b.pathname="/"+b.pathname),r(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(p=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,p),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(p+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&m(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}f.prototype={set:function(e,t,n){var o=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||i.parse)(t)),o[e]=t;break;case"port":o[e]=t,r(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,l.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!n;break;case"pathname":case"hash":if(t){var a="pathname"===e?"/":"#";o[e]=t.charAt(0)!==a?a+t:t}else o[e]=t;break;case"username":case"password":o[e]=encodeURIComponent(t);break;case"auth":var s=t.indexOf(":");~s?(o.username=t.slice(0,s),o.username=encodeURIComponent(decodeURIComponent(o.username)),o.password=t.slice(s+1),o.password=encodeURIComponent(decodeURIComponent(o.password))):o.username=encodeURIComponent(decodeURIComponent(t))}for(var c=0;c<h.length;c++){var d=h[c];d[4]&&(o[d[1]]=o[d[1]].toLowerCase())}return o.auth=o.password?o.username+":"+o.password:o.username,o.origin="file:"!==o.protocol&&m(o.protocol)&&o.host?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},toString:function(e){e&&"function"==typeof e||(e=i.stringify);var t,n=this,r=n.host,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var a=o+(n.protocol&&n.slashes||m(n.protocol)?"//":"");return n.username?(a+=n.username,n.password&&(a+=":"+n.password),a+="@"):n.password?(a+=":"+n.password,a+="@"):"file:"!==n.protocol&&m(n.protocol)&&!r&&"/"!==n.pathname&&(a+="@"),(":"===r[r.length-1]||l.test(n.hostname)&&!n.port)&&(r+=":"),a+=r+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(a+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(a+=n.hash),a}},f.extractProtocol=g,f.location=v,f.trimLeft=u,f.qs=i,e.exports=f},4765:(e,t,n)=>{"use strict";n.d(t,{A:()=>J});var r=["compactDisplay","currency","currencyDisplay","currencySign","localeMatcher","notation","numberingSystem","signDisplay","style","unit","unitDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"],i=["dateStyle","timeStyle","calendar","localeMatcher","hour12","hourCycle","timeZone","formatMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function o(e,t){"undefined"!=typeof console&&(console.warn("[vue-i18n] "+e),t&&console.warn(t.stack))}var a=Array.isArray;function s(e){return null!==e&&"object"==typeof e}function l(e){return"string"==typeof e}var c=Object.prototype.toString,d="[object Object]";function u(e){return c.call(e)===d}function h(e){return null==e}function p(e){return"function"==typeof e}function v(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var n=null,r=null;return 1===e.length?s(e[0])||a(e[0])?r=e[0]:"string"==typeof e[0]&&(n=e[0]):2===e.length&&("string"==typeof e[0]&&(n=e[0]),(s(e[1])||a(e[1]))&&(r=e[1])),{locale:n,params:r}}function m(e){return JSON.parse(JSON.stringify(e))}function g(e,t){return!!~e.indexOf(t)}var f=Object.prototype.hasOwnProperty;function y(e,t){return f.call(e,t)}function _(e){for(var t=arguments,n=Object(e),r=1;r<arguments.length;r++){var i=t[r];if(null!=i){var o=void 0;for(o in i)y(i,o)&&(s(i[o])?n[o]=_(n[o],i[o]):n[o]=i[o])}}return n}function E(e,t){if(e===t)return!0;var n=s(e),r=s(t);if(!n||!r)return!n&&!r&&String(e)===String(t);try{var i=a(e),o=a(t);if(i&&o)return e.length===t.length&&e.every((function(e,n){return E(e,t[n])}));if(i||o)return!1;var l=Object.keys(e),c=Object.keys(t);return l.length===c.length&&l.every((function(n){return E(e[n],t[n])}))}catch(e){return!1}}var b={name:"i18n",functional:!0,props:{tag:{type:[String,Boolean,Object],default:"span"},path:{type:String,required:!0},locale:{type:String},places:{type:[Array,Object]}},render:function(e,t){var n=t.data,r=t.parent,i=t.props,o=t.slots,a=r.$i18n;if(a){var s=i.path,l=i.locale,c=i.places,d=o(),u=a.i(s,l,function(e){var t;for(t in e)if("default"!==t)return!1;return Boolean(t)}(d)||c?function(e,t){var n=t?function(e){return Array.isArray(e)?e.reduce(C,{}):Object.assign({},e)}(t):{};if(!e)return n;var r=(e=e.filter((function(e){return e.tag||""!==e.text.trim()}))).every(w);return e.reduce(r?S:C,n)}(d.default,c):d),h=i.tag&&!0!==i.tag||!1===i.tag?i.tag:"span";return h?e(h,n,u):u}}};function S(e,t){return t.data&&t.data.attrs&&t.data.attrs.place&&(e[t.data.attrs.place]=t),e}function C(e,t,n){return e[n]=t,e}function w(e){return Boolean(e.data&&e.data.attrs&&e.data.attrs.place)}var A,T={name:"i18n-n",functional:!0,props:{tag:{type:[String,Boolean,Object],default:"span"},value:{type:Number,required:!0},format:{type:[String,Object]},locale:{type:String}},render:function(e,t){var n=t.props,i=t.parent,o=t.data,a=i.$i18n;if(!a)return null;var c=null,d=null;l(n.format)?c=n.format:s(n.format)&&(n.format.key&&(c=n.format.key),d=Object.keys(n.format).reduce((function(e,t){var i;return g(r,t)?Object.assign({},e,((i={})[t]=n.format[t],i)):e}),null));var u=n.locale||a.locale,h=a._ntp(n.value,u,c,d),p=h.map((function(e,t){var n,r=o.scopedSlots&&o.scopedSlots[e.type];return r?r(((n={})[e.type]=e.value,n.index=t,n.parts=h,n)):e.value})),v=n.tag&&!0!==n.tag||!1===n.tag?n.tag:"span";return v?e(v,{attrs:o.attrs,class:o.class,staticClass:o.staticClass},p):p}};function I(e,t,n){R(0,n)&&x(e,t,n)}function k(e,t,n,r){if(R(0,n)){var i=n.context.$i18n;(function(e,t){var n=t.context;return e._locale===n.$i18n.locale})(e,n)&&E(t.value,t.oldValue)&&E(e._localeMessage,i.getLocaleMessage(i.locale))||x(e,t,n)}}function O(e,t,n,r){if(n.context){var i=n.context.$i18n||{};t.modifiers.preserve||i.preserveDirectiveContent||(e.textContent=""),e._vt=void 0,delete e._vt,e._locale=void 0,delete e._locale,e._localeMessage=void 0,delete e._localeMessage}else o("Vue instance does not exists in VNode context")}function R(e,t){var n=t.context;return n?!!n.$i18n||(o("VueI18n instance does not exists in Vue instance"),!1):(o("Vue instance does not exists in VNode context"),!1)}function x(e,t,n){var r,i,a=function(e){var t,n,r,i;return l(e)?t=e:u(e)&&(t=e.path,n=e.locale,r=e.args,i=e.choice),{path:t,locale:n,args:r,choice:i}}(t.value),s=a.path,c=a.locale,d=a.args,h=a.choice;if(s||c||d)if(s){var p=n.context;e._vt=e.textContent=null!=h?(r=p.$i18n).tc.apply(r,[s,h].concat(N(c,d))):(i=p.$i18n).t.apply(i,[s].concat(N(c,d))),e._locale=p.$i18n.locale,e._localeMessage=p.$i18n.getLocaleMessage(p.$i18n.locale)}else o("`path` is required in v-t directive");else o("value type not supported")}function N(e,t){var n=[];return e&&n.push(e),t&&(Array.isArray(t)||u(t))&&n.push(t),n}function D(e,t){void 0===t&&(t={bridge:!1}),D.installed=!0,(A=e).version&&Number(A.version.split(".")[0]),function(e){e.prototype.hasOwnProperty("$i18n")||Object.defineProperty(e.prototype,"$i18n",{get:function(){return this._i18n}}),e.prototype.$t=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=this.$i18n;return r._t.apply(r,[e,r.locale,r._getMessages(),this].concat(t))},e.prototype.$tc=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];var i=this.$i18n;return i._tc.apply(i,[e,i.locale,i._getMessages(),this,t].concat(n))},e.prototype.$te=function(e,t){var n=this.$i18n;return n._te(e,n.locale,n._getMessages(),t)},e.prototype.$d=function(e){for(var t,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return(t=this.$i18n).d.apply(t,[e].concat(n))},e.prototype.$n=function(e){for(var t,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return(t=this.$i18n).n.apply(t,[e].concat(n))}}(A),A.mixin(function(e){function t(){this!==this.$root&&this.$options.__INTLIFY_META__&&this.$el&&this.$el.setAttribute("data-intlify",this.$options.__INTLIFY_META__)}return void 0===e&&(e=!1),e?{mounted:t}:{beforeCreate:function(){var e=this.$options;if(e.i18n=e.i18n||(e.__i18nBridge||e.__i18n?{}:null),e.i18n){if(e.i18n instanceof Y){if(e.__i18nBridge||e.__i18n)try{var t=e.i18n&&e.i18n.messages?e.i18n.messages:{};(e.__i18nBridge||e.__i18n).forEach((function(e){t=_(t,JSON.parse(e))})),Object.keys(t).forEach((function(n){e.i18n.mergeLocaleMessage(n,t[n])}))}catch(e){}this._i18n=e.i18n,this._i18nWatcher=this._i18n.watchI18nData()}else if(u(e.i18n)){var n=this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Y?this.$root.$i18n:null;if(n&&(e.i18n.root=this.$root,e.i18n.formatter=n.formatter,e.i18n.fallbackLocale=n.fallbackLocale,e.i18n.formatFallbackMessages=n.formatFallbackMessages,e.i18n.silentTranslationWarn=n.silentTranslationWarn,e.i18n.silentFallbackWarn=n.silentFallbackWarn,e.i18n.pluralizationRules=n.pluralizationRules,e.i18n.preserveDirectiveContent=n.preserveDirectiveContent),e.__i18nBridge||e.__i18n)try{var r=e.i18n&&e.i18n.messages?e.i18n.messages:{};(e.__i18nBridge||e.__i18n).forEach((function(e){r=_(r,JSON.parse(e))})),e.i18n.messages=r}catch(e){}var i=e.i18n.sharedMessages;i&&u(i)&&(e.i18n.messages=_(e.i18n.messages,i)),this._i18n=new Y(e.i18n),this._i18nWatcher=this._i18n.watchI18nData(),(void 0===e.i18n.sync||e.i18n.sync)&&(this._localeWatcher=this.$i18n.watchLocale()),n&&n.onComponentInstanceCreated(this._i18n)}}else this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Y?this._i18n=this.$root.$i18n:e.parent&&e.parent.$i18n&&e.parent.$i18n instanceof Y&&(this._i18n=e.parent.$i18n)},beforeMount:function(){var e=this.$options;e.i18n=e.i18n||(e.__i18nBridge||e.__i18n?{}:null),e.i18n?(e.i18n instanceof Y||u(e.i18n))&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0):(this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Y||e.parent&&e.parent.$i18n&&e.parent.$i18n instanceof Y)&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0)},mounted:t,beforeDestroy:function(){if(this._i18n){var e=this;this.$nextTick((function(){e._subscribing&&(e._i18n.unsubscribeDataChanging(e),delete e._subscribing),e._i18nWatcher&&(e._i18nWatcher(),e._i18n.destroyVM(),delete e._i18nWatcher),e._localeWatcher&&(e._localeWatcher(),delete e._localeWatcher)}))}}}}(t.bridge)),A.directive("t",{bind:I,update:k,unbind:O}),A.component(b.name,b),A.component(T.name,T),A.config.optionMergeStrategies.i18n=function(e,t){return void 0===t?e:t}}var L=function(){this._caches=Object.create(null)};L.prototype.interpolate=function(e,t){if(!t)return[e];var n=this._caches[e];return n||(n=function(e){for(var t=[],n=0,r="";n<e.length;){var i=e[n++];if("{"===i){r&&t.push({type:"text",value:r}),r="";var o="";for(i=e[n++];void 0!==i&&"}"!==i;)o+=i,i=e[n++];var a="}"===i,s=P.test(o)?"list":a&&M.test(o)?"named":"unknown";t.push({value:o,type:s})}else"%"===i?"{"!==e[n]&&(r+=i):r+=i}return r&&t.push({type:"text",value:r}),t}(e),this._caches[e]=n),function(e,t){var n=[],r=0,i=Array.isArray(t)?"list":s(t)?"named":"unknown";if("unknown"===i)return n;for(;r<e.length;){var o=e[r];switch(o.type){case"text":n.push(o.value);break;case"list":n.push(t[parseInt(o.value,10)]);break;case"named":"named"===i&&n.push(t[o.value])}r++}return n}(n,t)};var P=/^(?:\d)+/,M=/^(?:\w)+/,U=[];U[0]={ws:[0],ident:[3,0],"[":[4],eof:[7]},U[1]={ws:[1],".":[2],"[":[4],eof:[7]},U[2]={ws:[2],ident:[3,0],0:[3,0],number:[3,0]},U[3]={ident:[3,0],0:[3,0],number:[3,0],ws:[1,1],".":[2,1],"[":[4,1],eof:[7,1]},U[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],eof:8,else:[4,0]},U[5]={"'":[4,0],eof:8,else:[5,0]},U[6]={'"':[4,0],eof:8,else:[6,0]};var F=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function B(e){if(null==e)return"eof";switch(e.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return e;case 95:case 36:case 45:return"ident";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return"ident"}var G=function(){this._cache=Object.create(null)};G.prototype.parsePath=function(e){var t=this._cache[e];return t||(t=function(e){var t,n,r,i,o,a,s,l=[],c=-1,d=0,u=0,h=[];function p(){var t=e[c+1];if(5===d&&"'"===t||6===d&&'"'===t)return c++,r="\\"+t,h[0](),!0}for(h[1]=function(){void 0!==n&&(l.push(n),n=void 0)},h[0]=function(){void 0===n?n=r:n+=r},h[2]=function(){h[0](),u++},h[3]=function(){if(u>0)u--,d=4,h[0]();else{if(u=0,void 0===n)return!1;if(!1===(n=function(e){var t,n,r,i=e.trim();return("0"!==e.charAt(0)||!isNaN(e))&&(r=i,F.test(r)?(n=(t=i).charCodeAt(0))!==t.charCodeAt(t.length-1)||34!==n&&39!==n?t:t.slice(1,-1):"*"+i)}(n)))return!1;h[1]()}};null!==d;)if(c++,"\\"!==(t=e[c])||!p()){if(i=B(t),8===(o=(s=U[d])[i]||s.else||8))return;if(d=o[0],(a=h[o[1]])&&(r=void 0===(r=o[2])?t:r,!1===a()))return;if(7===d)return l}}(e),t&&(this._cache[e]=t)),t||[]},G.prototype.getPathValue=function(e,t){if(!s(e))return null;var n=this.parsePath(t);if(0===n.length)return null;for(var r=n.length,i=e,o=0;o<r;){var a=i[n[o]];if(null==a)return null;i=a,o++}return i};var $,V=/<\/?[\w\s="/.':;#-\/]+>/,j=/(?:@(?:\.[a-zA-Z]+)?:(?:[\w\-_|./]+|\([\w\-_:|./]+\)))/g,K=/^@(?:\.([a-zA-Z]+))?:/,W=/[()]/g,q={upper:function(e){return e.toLocaleUpperCase()},lower:function(e){return e.toLocaleLowerCase()},capitalize:function(e){return""+e.charAt(0).toLocaleUpperCase()+e.substr(1)}},H=new L,Y=function(e){var t=this;void 0===e&&(e={}),!A&&"undefined"!=typeof window&&window.Vue&&D(window.Vue);var n=e.locale||"en-US",r=!1!==e.fallbackLocale&&(e.fallbackLocale||"en-US"),i=e.messages||{},o=e.dateTimeFormats||e.datetimeFormats||{},a=e.numberFormats||{};this._vm=null,this._formatter=e.formatter||H,this._modifiers=e.modifiers||{},this._missing=e.missing||null,this._root=e.root||null,this._sync=void 0===e.sync||!!e.sync,this._fallbackRoot=void 0===e.fallbackRoot||!!e.fallbackRoot,this._fallbackRootWithEmptyString=void 0===e.fallbackRootWithEmptyString||!!e.fallbackRootWithEmptyString,this._formatFallbackMessages=void 0!==e.formatFallbackMessages&&!!e.formatFallbackMessages,this._silentTranslationWarn=void 0!==e.silentTranslationWarn&&e.silentTranslationWarn,this._silentFallbackWarn=void 0!==e.silentFallbackWarn&&!!e.silentFallbackWarn,this._dateTimeFormatters={},this._numberFormatters={},this._path=new G,this._dataListeners=new Set,this._componentInstanceCreatedListener=e.componentInstanceCreatedListener||null,this._preserveDirectiveContent=void 0!==e.preserveDirectiveContent&&!!e.preserveDirectiveContent,this.pluralizationRules=e.pluralizationRules||{},this._warnHtmlInMessage=e.warnHtmlInMessage||"off",this._postTranslation=e.postTranslation||null,this._escapeParameterHtml=e.escapeParameterHtml||!1,"__VUE_I18N_BRIDGE__"in e&&(this.__VUE_I18N_BRIDGE__=e.__VUE_I18N_BRIDGE__),this.getChoiceIndex=function(e,n){var r,i,o=Object.getPrototypeOf(t);return o&&o.getChoiceIndex?o.getChoiceIndex.call(t,e,n):t.locale in t.pluralizationRules?t.pluralizationRules[t.locale].apply(t,[e,n]):(r=e,i=n,r=Math.abs(r),2===i?r?r>1?1:0:1:r?Math.min(r,2):0)},this._exist=function(e,n){return!(!e||!n||h(t._path.getPathValue(e,n))&&!e[n])},"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||Object.keys(i).forEach((function(e){t._checkLocaleMessage(e,t._warnHtmlInMessage,i[e])})),this._initVM({locale:n,fallbackLocale:r,messages:i,dateTimeFormats:o,numberFormats:a})},z={vm:{configurable:!0},messages:{configurable:!0},dateTimeFormats:{configurable:!0},numberFormats:{configurable:!0},availableLocales:{configurable:!0},locale:{configurable:!0},fallbackLocale:{configurable:!0},formatFallbackMessages:{configurable:!0},missing:{configurable:!0},formatter:{configurable:!0},silentTranslationWarn:{configurable:!0},silentFallbackWarn:{configurable:!0},preserveDirectiveContent:{configurable:!0},warnHtmlInMessage:{configurable:!0},postTranslation:{configurable:!0},sync:{configurable:!0}};Y.prototype._checkLocaleMessage=function(e,t,n){var r=function(e,t,n,i){if(u(n))Object.keys(n).forEach((function(o){var a=n[o];u(a)?(i.push(o),i.push("."),r(e,t,a,i),i.pop(),i.pop()):(i.push(o),r(e,t,a,i),i.pop())}));else if(a(n))n.forEach((function(n,o){u(n)?(i.push("["+o+"]"),i.push("."),r(e,t,n,i),i.pop(),i.pop()):(i.push("["+o+"]"),r(e,t,n,i),i.pop())}));else if(l(n)&&V.test(n)){var s="Detected HTML in message '"+n+"' of keypath '"+i.join("")+"' at '"+t+"'. Consider component interpolation with '<i18n>' to avoid XSS. See https://bit.ly/2ZqJzkp";"warn"===e?o(s):"error"===e&&function(e){"undefined"!=typeof console&&console.error("[vue-i18n] "+e)}(s)}};r(t,e,n,[])},Y.prototype._initVM=function(e){var t=A.config.silent;A.config.silent=!0,this._vm=new A({data:e,__VUE18N__INSTANCE__:!0}),A.config.silent=t},Y.prototype.destroyVM=function(){this._vm.$destroy()},Y.prototype.subscribeDataChanging=function(e){this._dataListeners.add(e)},Y.prototype.unsubscribeDataChanging=function(e){var t,n;t=this._dataListeners,n=e,t.delete(n)},Y.prototype.watchI18nData=function(){var e=this;return this._vm.$watch("$data",(function(){for(var t,n,r=(t=e._dataListeners,n=[],t.forEach((function(e){return n.push(e)})),n),i=r.length;i--;)A.nextTick((function(){r[i]&&r[i].$forceUpdate()}))}),{deep:!0})},Y.prototype.watchLocale=function(e){if(e){if(!this.__VUE_I18N_BRIDGE__)return null;var t=this,n=this._vm;return this.vm.$watch("locale",(function(r){n.$set(n,"locale",r),t.__VUE_I18N_BRIDGE__&&e&&(e.locale.value=r),n.$forceUpdate()}),{immediate:!0})}if(!this._sync||!this._root)return null;var r=this._vm;return this._root.$i18n.vm.$watch("locale",(function(e){r.$set(r,"locale",e),r.$forceUpdate()}),{immediate:!0})},Y.prototype.onComponentInstanceCreated=function(e){this._componentInstanceCreatedListener&&this._componentInstanceCreatedListener(e,this)},z.vm.get=function(){return this._vm},z.messages.get=function(){return m(this._getMessages())},z.dateTimeFormats.get=function(){return m(this._getDateTimeFormats())},z.numberFormats.get=function(){return m(this._getNumberFormats())},z.availableLocales.get=function(){return Object.keys(this.messages).sort()},z.locale.get=function(){return this._vm.locale},z.locale.set=function(e){this._vm.$set(this._vm,"locale",e)},z.fallbackLocale.get=function(){return this._vm.fallbackLocale},z.fallbackLocale.set=function(e){this._localeChainCache={},this._vm.$set(this._vm,"fallbackLocale",e)},z.formatFallbackMessages.get=function(){return this._formatFallbackMessages},z.formatFallbackMessages.set=function(e){this._formatFallbackMessages=e},z.missing.get=function(){return this._missing},z.missing.set=function(e){this._missing=e},z.formatter.get=function(){return this._formatter},z.formatter.set=function(e){this._formatter=e},z.silentTranslationWarn.get=function(){return this._silentTranslationWarn},z.silentTranslationWarn.set=function(e){this._silentTranslationWarn=e},z.silentFallbackWarn.get=function(){return this._silentFallbackWarn},z.silentFallbackWarn.set=function(e){this._silentFallbackWarn=e},z.preserveDirectiveContent.get=function(){return this._preserveDirectiveContent},z.preserveDirectiveContent.set=function(e){this._preserveDirectiveContent=e},z.warnHtmlInMessage.get=function(){return this._warnHtmlInMessage},z.warnHtmlInMessage.set=function(e){var t=this,n=this._warnHtmlInMessage;if(this._warnHtmlInMessage=e,n!==e&&("warn"===e||"error"===e)){var r=this._getMessages();Object.keys(r).forEach((function(e){t._checkLocaleMessage(e,t._warnHtmlInMessage,r[e])}))}},z.postTranslation.get=function(){return this._postTranslation},z.postTranslation.set=function(e){this._postTranslation=e},z.sync.get=function(){return this._sync},z.sync.set=function(e){this._sync=e},Y.prototype._getMessages=function(){return this._vm.messages},Y.prototype._getDateTimeFormats=function(){return this._vm.dateTimeFormats},Y.prototype._getNumberFormats=function(){return this._vm.numberFormats},Y.prototype._warnDefault=function(e,t,n,r,i,o){if(!h(n))return n;if(this._missing){var a=this._missing.apply(null,[e,t,r,i]);if(l(a))return a}if(this._formatFallbackMessages){var s=v.apply(void 0,i);return this._render(t,o,s.params,t)}return t},Y.prototype._isFallbackRoot=function(e){return(this._fallbackRootWithEmptyString?!e:h(e))&&!h(this._root)&&this._fallbackRoot},Y.prototype._isSilentFallbackWarn=function(e){return this._silentFallbackWarn instanceof RegExp?this._silentFallbackWarn.test(e):this._silentFallbackWarn},Y.prototype._isSilentFallback=function(e,t){return this._isSilentFallbackWarn(t)&&(this._isFallbackRoot()||e!==this.fallbackLocale)},Y.prototype._isSilentTranslationWarn=function(e){return this._silentTranslationWarn instanceof RegExp?this._silentTranslationWarn.test(e):this._silentTranslationWarn},Y.prototype._interpolate=function(e,t,n,r,i,o,s){if(!t)return null;var c,d=this._path.getPathValue(t,n);if(a(d)||u(d))return d;if(h(d)){if(!u(t))return null;if(!l(c=t[n])&&!p(c))return null}else{if(!l(d)&&!p(d))return null;c=d}return l(c)&&(c.indexOf("@:")>=0||c.indexOf("@.")>=0)&&(c=this._link(e,t,c,r,"raw",o,s)),this._render(c,i,o,n)},Y.prototype._link=function(e,t,n,r,i,o,s){var l=n,c=l.match(j);for(var d in c)if(c.hasOwnProperty(d)){var u=c[d],h=u.match(K),p=h[0],v=h[1],m=u.replace(p,"").replace(W,"");if(g(s,m))return l;s.push(m);var f=this._interpolate(e,t,m,r,"raw"===i?"string":i,"raw"===i?void 0:o,s);if(this._isFallbackRoot(f)){if(!this._root)throw Error("unexpected error");var y=this._root.$i18n;f=y._translate(y._getMessages(),y.locale,y.fallbackLocale,m,r,i,o)}f=this._warnDefault(e,m,f,r,a(o)?o:[o],i),this._modifiers.hasOwnProperty(v)?f=this._modifiers[v](f):q.hasOwnProperty(v)&&(f=q[v](f)),s.pop(),l=f?l.replace(u,f):l}return l},Y.prototype._createMessageContext=function(e,t,n,r){var i=this,o=a(e)?e:[],l=s(e)?e:{},c=this._getMessages(),d=this.locale;return{list:function(e){return o[e]},named:function(e){return l[e]},values:e,formatter:t,path:n,messages:c,locale:d,linked:function(e){return i._interpolate(d,c[d]||{},e,null,r,void 0,[e])}}},Y.prototype._render=function(e,t,n,r){if(p(e))return e(this._createMessageContext(n,this._formatter||H,r,t));var i=this._formatter.interpolate(e,n,r);return i||(i=H.interpolate(e,n,r)),"string"!==t||l(i)?i:i.join("")},Y.prototype._appendItemToChain=function(e,t,n){var r=!1;return g(e,t)||(r=!0,t&&(r="!"!==t[t.length-1],t=t.replace(/!/g,""),e.push(t),n&&n[t]&&(r=n[t]))),r},Y.prototype._appendLocaleToChain=function(e,t,n){var r,i=t.split("-");do{var o=i.join("-");r=this._appendItemToChain(e,o,n),i.splice(-1,1)}while(i.length&&!0===r);return r},Y.prototype._appendBlockToChain=function(e,t,n){for(var r=!0,i=0;i<t.length&&"boolean"==typeof r;i++){var o=t[i];l(o)&&(r=this._appendLocaleToChain(e,o,n))}return r},Y.prototype._getLocaleChain=function(e,t){if(""===e)return[];this._localeChainCache||(this._localeChainCache={});var n=this._localeChainCache[e];if(!n){t||(t=this.fallbackLocale),n=[];for(var r,i=[e];a(i);)i=this._appendBlockToChain(n,i,t);(i=l(r=a(t)?t:s(t)?t.default?t.default:null:t)?[r]:r)&&this._appendBlockToChain(n,i,null),this._localeChainCache[e]=n}return n},Y.prototype._translate=function(e,t,n,r,i,o,a){for(var s,l=this._getLocaleChain(t,n),c=0;c<l.length;c++){var d=l[c];if(!h(s=this._interpolate(d,e[d],r,i,o,a,[r])))return s}return null},Y.prototype._t=function(e,t,n,r){for(var i,o=[],a=arguments.length-4;a-- >0;)o[a]=arguments[a+4];if(!e)return"";var s,l=v.apply(void 0,o);this._escapeParameterHtml&&(l.params=(null!=(s=l.params)&&Object.keys(s).forEach((function(e){"string"==typeof s[e]&&(s[e]=s[e].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"))})),s));var c=l.locale||t,d=this._translate(n,c,this.fallbackLocale,e,r,"string",l.params);if(this._isFallbackRoot(d)){if(!this._root)throw Error("unexpected error");return(i=this._root).$t.apply(i,[e].concat(o))}return d=this._warnDefault(c,e,d,r,o,"string"),this._postTranslation&&null!=d&&(d=this._postTranslation(d,e)),d},Y.prototype.t=function(e){for(var t,n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return(t=this)._t.apply(t,[e,this.locale,this._getMessages(),null].concat(n))},Y.prototype._i=function(e,t,n,r,i){var o=this._translate(n,t,this.fallbackLocale,e,r,"raw",i);if(this._isFallbackRoot(o)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.i(e,t,i)}return this._warnDefault(t,e,o,r,[i],"raw")},Y.prototype.i=function(e,t,n){return e?(l(t)||(t=this.locale),this._i(e,t,this._getMessages(),null,n)):""},Y.prototype._tc=function(e,t,n,r,i){for(var o,a=[],s=arguments.length-5;s-- >0;)a[s]=arguments[s+5];if(!e)return"";void 0===i&&(i=1);var l={count:i,n:i},c=v.apply(void 0,a);return c.params=Object.assign(l,c.params),a=null===c.locale?[c.params]:[c.locale,c.params],this.fetchChoice((o=this)._t.apply(o,[e,t,n,r].concat(a)),i)},Y.prototype.fetchChoice=function(e,t){if(!e||!l(e))return null;var n=e.split("|");return n[t=this.getChoiceIndex(t,n.length)]?n[t].trim():e},Y.prototype.tc=function(e,t){for(var n,r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];return(n=this)._tc.apply(n,[e,this.locale,this._getMessages(),null,t].concat(r))},Y.prototype._te=function(e,t,n){for(var r=[],i=arguments.length-3;i-- >0;)r[i]=arguments[i+3];var o=v.apply(void 0,r).locale||t;return this._exist(n[o],e)},Y.prototype.te=function(e,t){return this._te(e,this.locale,this._getMessages(),t)},Y.prototype.getLocaleMessage=function(e){return m(this._vm.messages[e]||{})},Y.prototype.setLocaleMessage=function(e,t){"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||this._checkLocaleMessage(e,this._warnHtmlInMessage,t),this._vm.$set(this._vm.messages,e,t)},Y.prototype.mergeLocaleMessage=function(e,t){"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||this._checkLocaleMessage(e,this._warnHtmlInMessage,t),this._vm.$set(this._vm.messages,e,_(void 0!==this._vm.messages[e]&&Object.keys(this._vm.messages[e]).length?Object.assign({},this._vm.messages[e]):{},t))},Y.prototype.getDateTimeFormat=function(e){return m(this._vm.dateTimeFormats[e]||{})},Y.prototype.setDateTimeFormat=function(e,t){this._vm.$set(this._vm.dateTimeFormats,e,t),this._clearDateTimeFormat(e,t)},Y.prototype.mergeDateTimeFormat=function(e,t){this._vm.$set(this._vm.dateTimeFormats,e,_(this._vm.dateTimeFormats[e]||{},t)),this._clearDateTimeFormat(e,t)},Y.prototype._clearDateTimeFormat=function(e,t){for(var n in t){var r=e+"__"+n;this._dateTimeFormatters.hasOwnProperty(r)&&delete this._dateTimeFormatters[r]}},Y.prototype._localizeDateTime=function(e,t,n,r,i,o){for(var a=t,s=r[a],l=this._getLocaleChain(t,n),c=0;c<l.length;c++){var d=l[c];if(a=d,!h(s=r[d])&&!h(s[i]))break}if(h(s)||h(s[i]))return null;var u,p=s[i];if(o)u=new Intl.DateTimeFormat(a,Object.assign({},p,o));else{var v=a+"__"+i;(u=this._dateTimeFormatters[v])||(u=this._dateTimeFormatters[v]=new Intl.DateTimeFormat(a,p))}return u.format(e)},Y.prototype._d=function(e,t,n,r){if(!n)return(r?new Intl.DateTimeFormat(t,r):new Intl.DateTimeFormat(t)).format(e);var i=this._localizeDateTime(e,t,this.fallbackLocale,this._getDateTimeFormats(),n,r);if(this._isFallbackRoot(i)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.d(e,n,t)}return i||""},Y.prototype.d=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=this.locale,o=null,a=null;return 1===t.length?(l(t[0])?o=t[0]:s(t[0])&&(t[0].locale&&(r=t[0].locale),t[0].key&&(o=t[0].key)),a=Object.keys(t[0]).reduce((function(e,n){var r;return g(i,n)?Object.assign({},e,((r={})[n]=t[0][n],r)):e}),null)):2===t.length&&(l(t[0])&&(o=t[0]),l(t[1])&&(r=t[1])),this._d(e,r,o,a)},Y.prototype.getNumberFormat=function(e){return m(this._vm.numberFormats[e]||{})},Y.prototype.setNumberFormat=function(e,t){this._vm.$set(this._vm.numberFormats,e,t),this._clearNumberFormat(e,t)},Y.prototype.mergeNumberFormat=function(e,t){this._vm.$set(this._vm.numberFormats,e,_(this._vm.numberFormats[e]||{},t)),this._clearNumberFormat(e,t)},Y.prototype._clearNumberFormat=function(e,t){for(var n in t){var r=e+"__"+n;this._numberFormatters.hasOwnProperty(r)&&delete this._numberFormatters[r]}},Y.prototype._getNumberFormatter=function(e,t,n,r,i,o){for(var a=t,s=r[a],l=this._getLocaleChain(t,n),c=0;c<l.length;c++){var d=l[c];if(a=d,!h(s=r[d])&&!h(s[i]))break}if(h(s)||h(s[i]))return null;var u,p=s[i];if(o)u=new Intl.NumberFormat(a,Object.assign({},p,o));else{var v=a+"__"+i;(u=this._numberFormatters[v])||(u=this._numberFormatters[v]=new Intl.NumberFormat(a,p))}return u},Y.prototype._n=function(e,t,n,r){if(!Y.availabilities.numberFormat)return"";if(!n)return(r?new Intl.NumberFormat(t,r):new Intl.NumberFormat(t)).format(e);var i=this._getNumberFormatter(e,t,this.fallbackLocale,this._getNumberFormats(),n,r),o=i&&i.format(e);if(this._isFallbackRoot(o)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.n(e,Object.assign({},{key:n,locale:t},r))}return o||""},Y.prototype.n=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var i=this.locale,o=null,a=null;return 1===t.length?l(t[0])?o=t[0]:s(t[0])&&(t[0].locale&&(i=t[0].locale),t[0].key&&(o=t[0].key),a=Object.keys(t[0]).reduce((function(e,n){var i;return g(r,n)?Object.assign({},e,((i={})[n]=t[0][n],i)):e}),null)):2===t.length&&(l(t[0])&&(o=t[0]),l(t[1])&&(i=t[1])),this._n(e,i,o,a)},Y.prototype._ntp=function(e,t,n,r){if(!Y.availabilities.numberFormat)return[];if(!n)return(r?new Intl.NumberFormat(t,r):new Intl.NumberFormat(t)).formatToParts(e);var i=this._getNumberFormatter(e,t,this.fallbackLocale,this._getNumberFormats(),n,r),o=i&&i.formatToParts(e);if(this._isFallbackRoot(o)){if(!this._root)throw Error("unexpected error");return this._root.$i18n._ntp(e,t,n,r)}return o||[]},Object.defineProperties(Y.prototype,z),Object.defineProperty(Y,"availabilities",{get:function(){if(!$){var e="undefined"!=typeof Intl;$={dateTimeFormat:e&&void 0!==Intl.DateTimeFormat,numberFormat:e&&void 0!==Intl.NumberFormat}}return $}}),Y.install=D,Y.version="8.28.2";const J=Y},5262:function(e){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=89)}([function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(35),i=Function.prototype,o=i.call,a=r&&i.bind.bind(o,o);e.exports=r?a:function(e){return function(){return o.apply(e,arguments)}}},function(e,t,n){var r=n(59),i=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},function(e,t,n){var r=n(4),i=n(43).f,o=n(30),a=n(11),s=n(33),l=n(95),c=n(66);e.exports=function(e,t){var n,d,u,h,p,v=e.target,m=e.global,g=e.stat;if(n=m?r:g?r[v]||s(v,{}):(r[v]||{}).prototype)for(d in t){if(h=t[d],u=e.dontCallGetSet?(p=i(n,d))&&p.value:n[d],!c(m?d:v+(g?".":"#")+d,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&o(h,"sham",!0),a(n,d,h,e)}}},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(t,n(139))},function(e,t,n){var r=n(0);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,n){var r=n(8),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw o(i(e)+" is not an object")}},function(e,t,n){var r=n(1),i=n(14),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},function(e,t,n){var r=n(2),i=n(59),o=i.all;e.exports=i.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===o}:function(e){return"object"==typeof e?null!==e:r(e)}},function(e,t,n){var r=n(4),i=n(47),o=n(7),a=n(75),s=n(72),l=n(76),c=i("wks"),d=r.Symbol,u=d&&d.for,h=l?d:d&&d.withoutSetter||a;e.exports=function(e){if(!o(c,e)||!s&&"string"!=typeof c[e]){var t="Symbol."+e;s&&o(d,e)?c[e]=d[e]:c[e]=l&&u?u(t):h(t)}return c[e]}},function(e,t,n){var r=n(123);e.exports=function(e){return r(e.length)}},function(e,t,n){var r=n(2),i=n(13),o=n(104),a=n(33);e.exports=function(e,t,n,s){s||(s={});var l=s.enumerable,c=void 0!==s.name?s.name:t;if(r(n)&&o(n,c,s),s.global)l?e[t]=n:a(t,n);else{try{s.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},function(e,t,n){var r=n(35),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},function(e,t,n){var r=n(5),i=n(62),o=n(77),a=n(6),s=n(50),l=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor;t.f=r?o?function(e,t,n){if(a(e),t=s(t),a(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=d(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(a(e),t=s(t),a(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(24),i=Object;e.exports=function(e){return i(r(e))}},function(e,t,n){var r=n(1),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},function(e,t,n){var r=n(0),i=n(9),o=n(23),a=i("species");e.exports=function(e){return o>=51||!r((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,n){var r=n(4),i=n(2);e.exports=function(e,t){return arguments.length<2?function(e){return i(e)?e:void 0}(r[e]):r[e]&&r[e][t]}},function(e,t,n){var r=n(15);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(39),i=n(24);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(29),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},function(e,t,n){var r=n(100),i=n(1),o=n(39),a=n(14),s=n(10),l=n(28),c=i([].push),d=function(e){var t=1==e,n=2==e,i=3==e,d=4==e,u=6==e,h=7==e,p=5==e||u;return function(v,m,g,f){for(var y,_,E=a(v),b=o(E),S=r(m,g),C=s(b),w=0,A=f||l,T=t?A(v,C):n||h?A(v,0):void 0;C>w;w++)if((p||w in b)&&(_=S(y=b[w],w,E),e))if(t)T[w]=_;else if(_)switch(e){case 3:return!0;case 5:return y;case 6:return w;case 2:c(T,y)}else switch(e){case 4:return!1;case 7:c(T,y)}return u?-1:i||d?d:T}};e.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},function(e,t){var n=TypeError;e.exports=function(e){if(e>9007199254740991)throw n("Maximum allowed index exceeded");return e}},function(e,t,n){var r,i,o=n(4),a=n(97),s=o.process,l=o.Deno,c=s&&s.versions||l&&l.version,d=c&&c.v8;d&&(i=(r=d.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},function(e,t,n){var r=n(40),i=TypeError;e.exports=function(e){if(r(e))throw i("Can't call method on "+e);return e}},function(e,t,n){var r=n(2),i=n(74),o=TypeError;e.exports=function(e){if(r(e))return e;throw o(i(e)+" is not a function")}},function(e,t,n){"use strict";var r=n(0);e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){return 1},1)}))}},function(e,t,n){"use strict";var r=n(5),i=n(18),o=TypeError,a=Object.getOwnPropertyDescriptor,s=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(i(e)&&!a(e,"length").writable)throw o("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},function(e,t,n){var r=n(94);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},function(e,t,n){var r=n(51),i=n(2),o=n(15),a=n(9)("toStringTag"),s=Object,l="Arguments"==o(function(){return arguments}());e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?n:l?o(t):"Object"==(r=o(t))&&i(t.callee)?"Arguments":r}},function(e,t,n){var r=n(5),i=n(13),o=n(31);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var r=n(50),i=n(13),o=n(31);e.exports=function(e,t,n){var a=r(t);a in e?i.f(e,a,o(0,n)):e[a]=n}},function(e,t,n){var r=n(4),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var r=n(0);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},function(e,t,n){var r=n(5),i=n(7),o=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,s=i(o,"name"),l=s&&"something"===function(){}.name,c=s&&(!r||r&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:l,CONFIGURABLE:c}},function(e,t,n){var r=n(15),i=n(1);e.exports=function(e){if("Function"===r(e))return i(e)}},function(e,t){e.exports={}},function(e,t,n){var r=n(1),i=n(0),o=n(15),a=Object,s=r("".split);e.exports=i((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?s(e,""):a(e)}:a},function(e,t){e.exports=function(e){return null==e}},function(e,t,n){var r=n(17),i=n(2),o=n(44),a=n(76),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,s(e))}},function(e,t,n){var r,i=n(6),o=n(107),a=n(34),s=n(38),l=n(101),c=n(60),d=n(70)("IE_PROTO"),u=function(){},h=function(e){return"<script>"+e+"<\/script>"},p=function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}v="undefined"!=typeof document?document.domain&&r?p(r):function(){var e,t=c("iframe");return t.style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F}():p(r);for(var e=a.length;e--;)delete v.prototype[a[e]];return v()};s[d]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(u.prototype=i(e),n=new u,u.prototype=null,n[d]=e):n=v(),void 0===t?n:o.f(n,t)}},function(e,t,n){var r=n(5),i=n(12),o=n(110),a=n(31),s=n(19),l=n(50),c=n(7),d=n(62),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=s(e),t=l(t),d)try{return u(e,t)}catch(e){}if(c(e,t))return a(!i(o.f,e,t),e[t])}},function(e,t,n){var r=n(1);e.exports=r({}.isPrototypeOf)},function(e,t,n){"use strict";var r=n(12),i=n(1),o=n(20),a=n(69),s=n(117),l=n(47),c=n(42),d=n(64).get,u=n(118),h=n(119),p=l("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,m=v,g=i("".charAt),f=i("".indexOf),y=i("".replace),_=i("".slice),E=function(){var e=/a/,t=/b*/g;return r(v,e,"a"),r(v,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),b=s.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(E||S||b||u||h)&&(m=function(e){var t,n,i,s,l,u,h,C=this,w=d(C),A=o(e),T=w.raw;if(T)return T.lastIndex=C.lastIndex,t=r(m,T,A),C.lastIndex=T.lastIndex,t;var I=w.groups,k=b&&C.sticky,O=r(a,C),R=C.source,x=0,N=A;if(k&&(O=y(O,"y",""),-1===f(O,"g")&&(O+="g"),N=_(A,C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&"\n"!==g(A,C.lastIndex-1))&&(R="(?: "+R+")",N=" "+N,x++),n=new RegExp("^(?:"+R+")",O)),S&&(n=new RegExp("^"+R+"$(?!\\s)",O)),E&&(i=C.lastIndex),s=r(v,k?n:C,N),k?s?(s.input=_(s.input,x),s[0]=_(s[0],x),s.index=C.lastIndex,C.lastIndex+=s[0].length):C.lastIndex=0:E&&s&&(C.lastIndex=C.global?s.index+s[0].length:i),S&&s&&s.length>1&&r(p,s[0],n,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(s[l]=void 0)})),s&&I)for(s.groups=u=c(null),l=0;l<I.length;l++)u[(h=I[l])[0]]=s[h[1]];return s}),e.exports=m},function(e,t,n){var r=n(4),i=n(33),o=r["__core-js_shared__"]||i("__core-js_shared__",{});e.exports=o},function(e,t,n){var r=n(103),i=n(46);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(e,t,n){var r=n(49),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},function(e,t,n){var r=n(105);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},function(e,t,n){var r=n(73),i=n(41);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},function(e,t,n){var r={};r[n(9)("toStringTag")]="z",e.exports="[object z]"===String(r)},function(e,t,n){"use strict";var r=n(5),i=n(4),o=n(1),a=n(66),s=n(11),l=n(7),c=n(102),d=n(44),u=n(41),h=n(73),p=n(0),v=n(67).f,m=n(43).f,g=n(13).f,f=n(122),y=n(71).trim,_=i.Number,E=_.prototype,b=i.TypeError,S=o("".slice),C=o("".charCodeAt),w=function(e){var t,n,r,i,o,a,s,l,c=h(e,"number");if(u(c))throw b("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=y(c),43===(t=C(c,0))||45===t){if(88===(n=C(c,2))||120===n)return NaN}else if(48===t){switch(C(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(a=(o=S(c,2)).length,s=0;s<a;s++)if((l=C(o,s))<48||l>i)return NaN;return parseInt(o,r)}return+c};if(a("Number",!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var A,T=function(e){var t=arguments.length<1?0:_(function(e){var t=h(e,"number");return"bigint"==typeof t?t:w(t)}(e)),n=this;return d(E,n)&&p((function(){f(n)}))?c(Object(t),n,T):t},I=r?v(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),k=0;I.length>k;k++)l(_,A=I[k])&&!l(T,A)&&g(T,A,m(_,A));T.prototype=E,E.constructor=T,s(i,"Number",T,{constructor:!0})}},function(e,t,n){"use strict";var r=n(3),i=n(45);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},function(e,t,n){"use strict";function r(e){return!(0===e||(!Array.isArray(e)||0!==e.length)&&e)}function i(e,t,n,r){return e.filter((function(e){return function(e,t){return void 0===e&&(e="undefined"),null===e&&(e="null"),!1===e&&(e="false"),-1!==e.toString().toLowerCase().indexOf(t.trim())}(r(e,n),t)}))}function o(e){return e.filter((function(e){return!e.$isLabel}))}function a(e,t){return function(n){return n.reduce((function(n,r){return r[e]&&r[e].length?(n.push({$groupLabel:r[t],$isLabel:!0}),n.concat(r[e])):n}),[])}}function s(e,t,r,o,a){return function(s){return s.map((function(s){var l;if(!s[r])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];var d=i(s[r],e,t,a);return d.length?(l={},n.i(c.a)(l,o,s[o]),n.i(c.a)(l,r,d),l):[]}))}}var l=n(88),c=n(87),d=n(129),u=(n.n(d),n(82)),h=(n.n(u),n(81)),p=(n.n(h),n(83)),v=(n.n(p),n(84)),m=(n.n(v),n(128)),g=(n.n(m),n(135)),f=(n.n(g),n(127)),y=(n.n(f),n(132)),_=(n.n(y),n(131)),E=(n.n(_),n(125)),b=(n.n(E),n(130)),S=(n.n(b),n(52)),C=(n.n(S),n(53)),w=(n.n(C),n(85)),A=(n.n(w),n(134)),T=(n.n(A),n(80)),I=(n.n(T),n(79)),k=(n.n(I),n(133)),O=(n.n(k),n(126)),R=(n.n(O),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}});t.a={data:function(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},value:{type:null,default:function(){return[]}},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default:function(e,t){return r(e)?"":t?e[t]:e}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default:function(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1}},mounted:function(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue:function(){return this.value||0===this.value?Array.isArray(this.value)?this.value:[this.value]:[]},filteredOptions:function(){var e=this.search||"",t=e.toLowerCase().trim(),n=this.options.concat();return n=this.internalSearch?this.groupValues?this.filterAndFlat(n,t,this.label):i(n,t,this.label,this.customLabel):this.groupValues?a(this.groupValues,this.groupLabel)(n):n,n=this.hideSelected?n.filter(function(e){return function(){return!e.apply(void 0,arguments)}}(this.isSelected)):n,this.taggable&&t.length&&!this.isExistingOption(t)&&("bottom"===this.tagPosition?n.push({isTag:!0,label:e}):n.unshift({isTag:!0,label:e})),n.slice(0,this.optionsLimit)},valueKeys:function(){var e=this;return this.trackBy?this.internalValue.map((function(t){return t[e.trackBy]})):this.internalValue},optionKeys:function(){var e=this;return(this.groupValues?this.flatAndStrip(this.options):this.options).map((function(t){return e.customLabel(t,e.label).toString().toLowerCase()}))},currentOptionLabel:function(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:function(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("input",this.multiple?[]:null))},search:function(){this.$emit("search-change",this.search,this.id)}},methods:{getValue:function(){return this.multiple?this.internalValue:0===this.internalValue.length?null:this.internalValue[0]},filterAndFlat:function(e,t,n){return R(s(t,n,this.groupValues,this.groupLabel,this.customLabel),a(this.groupValues,this.groupLabel))(e)},flatAndStrip:function(e){return R(a(this.groupValues,this.groupLabel),o)(e)},updateSearch:function(e){this.search=e},isExistingOption:function(e){return!!this.options&&this.optionKeys.indexOf(e)>-1},isSelected:function(e){var t=this.trackBy?e[this.trackBy]:e;return this.valueKeys.indexOf(t)>-1},isOptionDisabled:function(e){return!!e.$isDisabled},getOptionLabel:function(e){if(r(e))return"";if(e.isTag)return e.label;if(e.$isLabel)return e.$groupLabel;var t=this.customLabel(e,this.label);return r(t)?"":t},select:function(e,t){if(e.$isLabel&&this.groupSelect)this.selectGroup(e);else if(!(-1!==this.blockKeys.indexOf(t)||this.disabled||e.$isDisabled||e.$isLabel)&&(!this.max||!this.multiple||this.internalValue.length!==this.max)&&("Tab"!==t||this.pointerDirty)){if(e.isTag)this.$emit("tag",e.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(e))return void("Tab"!==t&&this.removeElement(e));this.multiple?this.$emit("input",this.internalValue.concat([e]),this.id):this.$emit("input",e,this.id),this.$emit("select",e,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup:function(e){var t=this,n=this.options.find((function(n){return n[t.groupLabel]===e.$groupLabel}));if(n){if(this.wholeGroupSelected(n)){this.$emit("remove",n[this.groupValues],this.id);var r=this.internalValue.filter((function(e){return-1===n[t.groupValues].indexOf(e)}));this.$emit("input",r,this.id)}else{var i=n[this.groupValues].filter((function(e){return!(t.isOptionDisabled(e)||t.isSelected(e))}));this.max&&i.splice(this.max-this.internalValue.length),this.$emit("select",i,this.id),this.$emit("input",this.internalValue.concat(i),this.id)}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected:function(e){var t=this;return e[this.groupValues].every((function(e){return t.isSelected(e)||t.isOptionDisabled(e)}))},wholeGroupDisabled:function(e){return e[this.groupValues].every(this.isOptionDisabled)},removeElement:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.disabled&&!e.$isDisabled){if(!this.allowEmpty&&this.internalValue.length<=1)return void this.deactivate();var r="object"===n.i(l.a)(e)?this.valueKeys.indexOf(e[this.trackBy]):this.valueKeys.indexOf(e);if(this.multiple){var i=this.internalValue.slice(0,r).concat(this.internalValue.slice(r+1));this.$emit("input",i,this.id)}else this.$emit("input",null,this.id);this.$emit("remove",e,this.id),this.closeOnSelect&&t&&this.deactivate()}},removeLastElement:function(){-1===this.blockKeys.indexOf("Delete")&&0===this.search.length&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate:function(){var e=this;this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&0===this.pointer&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick((function(){return e.$refs.search&&e.$refs.search.focus()}))):this.preventAutofocus||void 0!==this.$el&&this.$el.focus(),this.$emit("open",this.id))},deactivate:function(){this.isOpen&&(this.isOpen=!1,this.searchable?null!==this.$refs.search&&void 0!==this.$refs.search&&this.$refs.search.blur():void 0!==this.$el&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle:function(){this.isOpen?this.deactivate():this.activate()},adjustPosition:function(){if("undefined"!=typeof window){var e=this.$el.getBoundingClientRect().top,t=window.innerHeight-this.$el.getBoundingClientRect().bottom;t>this.maxHeight||t>e||"below"===this.openDirection||"bottom"===this.openDirection?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(t-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(e-40,this.maxHeight))}}}}},function(e,t,n){"use strict";var r=n(52),i=(n.n(r),n(53)),o=(n.n(i),n(85)),a=(n.n(o),n(82)),s=(n.n(a),n(81)),l=(n.n(s),n(83)),c=(n.n(l),n(84)),d=(n.n(c),n(79));n.n(d),t.a={data:function(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition:function(){return this.pointer*this.optionHeight},visibleElements:function(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions:function(){this.pointerAdjust()},isOpen:function(){this.pointerDirty=!1},pointer:function(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight:function(e,t){return{"multiselect__option--highlight":e===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(t)}},groupHighlight:function(e,t){var n=this;if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":t.$isLabel}];var r=this.options.find((function(e){return e[n.groupLabel]===t.$groupLabel}));return r&&!this.wholeGroupDisabled(r)?["multiselect__option--group",{"multiselect__option--highlight":e===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(r)}]:"multiselect__option--disabled"},addPointerElement:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Enter").key;this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],e),this.pointerReset()},pointerForward:function(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward:function(){this.pointer>0?(this.pointer--,this.$refs.list.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset:function(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust:function(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet:function(e){this.pointer=e,this.pointerDirty=!0}}}},function(e,t,n){"use strict";var r=n(52),i=(n.n(r),n(80)),o=(n.n(i),n(54)),a=n(55);t.a={name:"vue-multiselect",mixins:[o.a,a.a],props:{name:{type:String,default:""},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:function(e){return"and ".concat(e," more")}},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0}},computed:{hasOptionGroup:function(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible:function(){return(this.singleValue||0===this.singleValue)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible:function(){return!(this.internalValue.length||this.searchable&&this.isOpen)},visibleValues:function(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue:function(){return this.internalValue[0]},deselectLabelText:function(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText:function(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText:function(){return this.showLabels?this.selectLabel:""},selectGroupLabelText:function(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText:function(){return this.showLabels?this.selectedLabel:""},inputStyle:function(){return this.searchable||this.multiple&&this.value&&this.value.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle:function(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove:function(){return"above"===this.openDirection||"top"===this.openDirection||"below"!==this.openDirection&&"bottom"!==this.openDirection&&"above"===this.preferredOpenDirection},showSearchInput:function(){return this.searchable&&(!this.hasSingleSelectedSlot||!this.visibleSingleValue&&0!==this.visibleSingleValue||this.isOpen)}}}},function(e,t,n){var r=n(19),i=n(48),o=n(10),a=function(e){return function(t,n,a){var s,l=r(t),c=o(l),d=i(a,c);if(e&&n!=n){for(;c>d;)if((s=l[d++])!=s)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,n){"use strict";var r=n(74),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw i("Cannot delete property "+r(t)+" of "+r(e))}},function(e,t){var n="object"==typeof document&&document.all,r=void 0===n&&void 0!==n;e.exports={all:n,IS_HTMLDDA:r}},function(e,t,n){var r=n(4),i=n(8),o=r.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,n){var r=n(25),i=n(40);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},function(e,t,n){var r=n(5),i=n(0),o=n(60);e.exports=!r&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(1),i=n(2),o=n(46),a=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},function(e,t,n){var r,i,o,a=n(124),s=n(4),l=n(8),c=n(30),d=n(7),u=n(46),h=n(70),p=n(38),v=s.TypeError,m=s.WeakMap;if(a||u.state){var g=u.state||(u.state=new m);g.get=g.get,g.has=g.has,g.set=g.set,r=function(e,t){if(g.has(e))throw v("Object already initialized");return t.facade=e,g.set(e,t),t},i=function(e){return g.get(e)||{}},o=function(e){return g.has(e)}}else{var f=h("state");p[f]=!0,r=function(e,t){if(d(e,f))throw v("Object already initialized");return t.facade=e,c(e,f,t),t},i=function(e){return d(e,f)?e[f]:{}},o=function(e){return d(e,f)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw v("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var r=n(1),i=n(0),o=n(2),a=n(29),s=n(17),l=n(63),c=function(){},d=[],u=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=r(h.exec),v=!h.exec(c),m=function(e){if(!o(e))return!1;try{return u(c,d,e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return v||!!p(h,l(e))}catch(e){return!0}};g.sham=!0,e.exports=!u||i((function(){var e;return m(m.call)||!m(Object)||!m((function(){e=!0}))||e}))?g:m},function(e,t,n){var r=n(0),i=n(2),o=/#|\.prototype\./,a=function(e,t){var n=l[s(e)];return n==d||n!=c&&(i(t)?r(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=a.data={},c=a.NATIVE="N",d=a.POLYFILL="P";e.exports=a},function(e,t,n){var r=n(68),i=n(34).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(1),i=n(7),o=n(19),a=n(57).indexOf,s=n(38),l=r([].push);e.exports=function(e,t){var n,r=o(e),c=0,d=[];for(n in r)!i(s,n)&&i(r,n)&&l(d,n);for(;t.length>c;)i(r,n=t[c++])&&(~a(d,n)||l(d,n));return d}},function(e,t,n){"use strict";var r=n(6);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},function(e,t,n){var r=n(47),i=n(75),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t,n){var r=n(1),i=n(24),o=n(20),a=n(78),s=r("".replace),l="["+a+"]",c=RegExp("^"+l+l+"*"),d=RegExp(l+l+"*$"),u=function(e){return function(t){var n=o(i(t));return 1&e&&(n=s(n,c,"")),2&e&&(n=s(n,d,"")),n}};e.exports={start:u(1),end:u(2),trim:u(3)}},function(e,t,n){var r=n(23),i=n(0);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},function(e,t,n){var r=n(12),i=n(8),o=n(41),a=n(61),s=n(113),l=n(9),c=TypeError,d=l("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,l=a(e,d);if(l){if(void 0===t&&(t="default"),n=r(l,e,t),!i(n)||o(n))return n;throw c("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},function(e,t){var n=String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},function(e,t,n){var r=n(1),i=0,o=Math.random(),a=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},function(e,t,n){var r=n(72);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var r=n(5),i=n(0);e.exports=r&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(e,t,n){"use strict";var r=n(3),i=n(21).find,o=n(91),a=!0;"find"in[]&&Array(1).find((function(){a=!1})),r({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(e,t,n){"use strict";var r=n(3),i=n(18),o=n(65),a=n(8),s=n(48),l=n(10),c=n(19),d=n(32),u=n(9),h=n(16),p=n(93),v=h("slice"),m=u("species"),g=Array,f=Math.max;r({target:"Array",proto:!0,forced:!v},{slice:function(e,t){var n,r,u,h=c(this),v=l(h),y=s(e,v),_=s(void 0===t?v:t,v);if(i(h)&&(n=h.constructor,(o(n)&&(n===g||i(n.prototype))||a(n)&&null===(n=n[m]))&&(n=void 0),n===g||void 0===n))return p(h,y,_);for(r=new(void 0===n?g:n)(f(_-y,0)),u=0;y<_;y++,u++)y in h&&d(r,u,h[y]);return r.length=u,r}})},function(e,t,n){var r=n(1),i=n(11),o=Date.prototype,a=r(o.toString),s=r(o.getTime);"Invalid Date"!=String(new Date(NaN))&&i(o,"toString",(function(){var e=s(this);return e==e?a(this):"Invalid Date"}))},function(e,t,n){var r=n(11),i=n(98),o=Error.prototype;o.toString!==i&&r(o,"toString",i)},function(e,t,n){var r=n(51),i=n(11),o=n(112);r||i(Object.prototype,"toString",o,{unsafe:!0})},function(e,t,n){"use strict";var r=n(36).PROPER,i=n(11),o=n(6),a=n(20),s=n(0),l=n(116),c=RegExp.prototype.toString,d=s((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),u=r&&"toString"!=c.name;(d||u)&&i(RegExp.prototype,"toString",(function(){var e=o(this);return"/"+a(e.source)+"/"+a(l(e))}),{unsafe:!0})},function(e,t,n){"use strict";var r=n(12),i=n(99),o=n(6),a=n(40),s=n(24),l=n(120),c=n(20),d=n(61),u=n(115);i("search",(function(e,t,n){return[function(t){var n=s(this),i=a(t)?void 0:d(t,e);return i?r(i,t,n):new RegExp(t)[e](c(n))},function(e){var r=o(this),i=c(e),a=n(t,r,i);if(a.done)return a.value;var s=r.lastIndex;l(s,0)||(r.lastIndex=0);var d=u(r,i);return l(r.lastIndex,s)||(r.lastIndex=s),null===d?-1:d.index}]}))},function(e,t,n){"use strict";var r=n(56),i=n(138),o=function(e){n(136)},a=n(137)(r.a,i.a,!1,o,null,null);t.a=a.exports},function(e,t,n){"use strict";t.a=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(86),i=n(54),o=n(55);n.d(t,"Multiselect",(function(){return r.a})),n.d(t,"multiselectMixin",(function(){return i.a})),n.d(t,"pointerMixin",(function(){return o.a})),t.default=r.a},function(e,t,n){var r=n(2),i=String,o=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw o("Can't set "+i(e)+" as a prototype")}},function(e,t,n){var r=n(9),i=n(42),o=n(13).f,a=r("unscopables"),s=Array.prototype;null==s[a]&&o(s,a,{configurable:!0,value:i(null)}),e.exports=function(e){s[a][e]=!0}},function(e,t,n){var r=n(25),i=n(14),o=n(39),a=n(10),s=TypeError,l=function(e){return function(t,n,l,c){r(n);var d=i(t),u=o(d),h=a(d),p=e?h-1:0,v=e?-1:1;if(l<2)for(;;){if(p in u){c=u[p],p+=v;break}if(p+=v,e?p<0:h<=p)throw s("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=v)p in u&&(c=n(c,u[p],p,d));return c}};e.exports={left:l(!1),right:l(!0)}},function(e,t,n){var r=n(1);e.exports=r([].slice)},function(e,t,n){var r=n(18),i=n(65),o=n(8),a=n(9)("species"),s=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(i(t)&&(t===s||r(t.prototype))||o(t)&&null===(t=t[a]))&&(t=void 0)),void 0===t?s:t}},function(e,t,n){var r=n(7),i=n(114),o=n(43),a=n(13);e.exports=function(e,t,n){for(var s=i(t),l=a.f,c=o.f,d=0;d<s.length;d++){var u=s[d];r(e,u)||n&&r(n,u)||l(e,u,c(t,u))}}},function(e,t,n){var r=n(15),i=n(4);e.exports="process"==r(i.process)},function(e,t,n){var r=n(17);e.exports=r("navigator","userAgent")||""},function(e,t,n){"use strict";var r=n(5),i=n(0),o=n(6),a=n(42),s=n(106),l=Error.prototype.toString,c=i((function(){if(r){var e=a(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==l.call(e))return!0}return"2: 1"!==l.call({message:1,name:2})||"Error"!==l.call({})}));e.exports=c?function(){var e=o(this),t=s(e.name,"Error"),n=s(e.message);return t?n?t+": "+n:t:n}:l},function(e,t,n){"use strict";n(53);var r=n(37),i=n(11),o=n(45),a=n(0),s=n(9),l=n(30),c=s("species"),d=RegExp.prototype;e.exports=function(e,t,n,u){var h=s(e),p=!a((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),v=p&&!a((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!p||!v||n){var m=r(/./[h]),g=t(h,""[e],(function(e,t,n,i,a){var s=r(e),l=t.exec;return l===o||l===d.exec?p&&!a?{done:!0,value:m(t,n,i)}:{done:!0,value:s(n,t,i)}:{done:!1}}));i(String.prototype,e,g[0]),i(d,h,g[1])}u&&l(d[h],"sham",!0)}},function(e,t,n){var r=n(37),i=n(25),o=n(35),a=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(17);e.exports=r("document","documentElement")},function(e,t,n){var r=n(2),i=n(8),o=n(111);e.exports=function(e,t,n){var a,s;return o&&r(a=t.constructor)&&a!==n&&i(s=a.prototype)&&s!==n.prototype&&o(e,s),e}},function(e,t){e.exports=!1},function(e,t,n){var r=n(0),i=n(2),o=n(7),a=n(5),s=n(36).CONFIGURABLE,l=n(63),c=n(64),d=c.enforce,u=c.get,h=Object.defineProperty,p=a&&!r((function(){return 8!==h((function(){}),"length",{value:8}).length})),v=String(String).split("String"),m=e.exports=function(e,t,n){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!o(e,"name")||s&&e.name!==t)&&(a?h(e,"name",{value:t,configurable:!0}):e.name=t),p&&n&&o(n,"arity")&&e.length!==n.arity&&h(e,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&h(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=d(e);return o(r,"source")||(r.source=v.join("string"==typeof t?t:"")),e};Function.prototype.toString=m((function(){return i(this)&&u(this).source||l(this)}),"toString")},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var t=+e;return(t>0?r:n)(t)}},function(e,t,n){var r=n(20);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},function(e,t,n){var r=n(5),i=n(77),o=n(13),a=n(6),s=n(19),l=n(109);t.f=r&&!i?Object.defineProperties:function(e,t){a(e);for(var n,r=s(t),i=l(t),c=i.length,d=0;c>d;)o.f(e,n=i[d++],r[n]);return e}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(68),i=n(34);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},function(e,t,n){var r=n(1),i=n(6),o=n(90);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return i(n),o(r),t?e(n,r):n.__proto__=r,n}}():void 0)},function(e,t,n){"use strict";var r=n(51),i=n(29);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,n){var r=n(12),i=n(2),o=n(8),a=TypeError;e.exports=function(e,t){var n,s;if("string"===t&&i(n=e.toString)&&!o(s=r(n,e)))return s;if(i(n=e.valueOf)&&!o(s=r(n,e)))return s;if("string"!==t&&i(n=e.toString)&&!o(s=r(n,e)))return s;throw a("Can't convert object to primitive value")}},function(e,t,n){var r=n(17),i=n(1),o=n(67),a=n(108),s=n(6),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(s(e)),n=a.f;return n?l(t,n(e)):t}},function(e,t,n){var r=n(12),i=n(6),o=n(2),a=n(15),s=n(45),l=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===a(e))return r(s,e,t);throw l("RegExp#exec called on incompatible receiver")}},function(e,t,n){var r=n(12),i=n(7),o=n(44),a=n(69),s=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||i(e,"flags")||!o(s,e)?t:r(a,e)}},function(e,t,n){var r=n(0),i=n(4).RegExp,o=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),a=o||r((function(){return!i("a","y").sticky})),s=o||r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:s,MISSED_STICKY:a,UNSUPPORTED_Y:o}},function(e,t,n){var r=n(0),i=n(4).RegExp;e.exports=r((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},function(e,t,n){var r=n(0),i=n(4).RegExp;e.exports=r((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){var r=n(36).PROPER,i=n(0),o=n(78);e.exports=function(e){return i((function(){return!!o[e]()||"​᠎"!=="​᠎"[e]()||r&&o[e].name!==e}))}},function(e,t,n){var r=n(1);e.exports=r(1..valueOf)},function(e,t,n){var r=n(49),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(4),i=n(2),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},function(e,t,n){"use strict";var r=n(3),i=n(0),o=n(18),a=n(8),s=n(14),l=n(10),c=n(22),d=n(32),u=n(28),h=n(16),p=n(9),v=n(23),m=p("isConcatSpreadable"),g=v>=51||!i((function(){var e=[];return e[m]=!1,e.concat()[0]!==e})),f=h("concat"),y=function(e){if(!a(e))return!1;var t=e[m];return void 0!==t?!!t:o(e)};r({target:"Array",proto:!0,arity:1,forced:!g||!f},{concat:function(e){var t,n,r,i,o,a=s(this),h=u(a,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(y(o=-1===t?a:arguments[t]))for(i=l(o),c(p+i),n=0;n<i;n++,p++)n in o&&d(h,p,o[n]);else c(p+1),d(h,p++,o);return h.length=p,h}})},function(e,t,n){"use strict";var r=n(3),i=n(21).every;r({target:"Array",proto:!0,forced:!n(26)("every")},{every:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(3),i=n(21).filter;r({target:"Array",proto:!0,forced:!n(16)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(3),i=n(37),o=n(57).indexOf,a=n(26),s=i([].indexOf),l=!!s&&1/s([1],1,-0)<0,c=a("indexOf");r({target:"Array",proto:!0,forced:l||!c},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return l?s(this,e,t)||0:o(this,e,t)}})},function(e,t,n){n(3)({target:"Array",stat:!0},{isArray:n(18)})},function(e,t,n){"use strict";var r=n(3),i=n(21).map;r({target:"Array",proto:!0,forced:!n(16)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(3),i=n(14),o=n(10),a=n(27),s=n(22),l=n(0)((function(){return 4294967297!==[].push.call({length:4294967296},1)})),c=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}();r({target:"Array",proto:!0,arity:1,forced:l||c},{push:function(e){var t=i(this),n=o(t),r=arguments.length;s(n+r);for(var l=0;l<r;l++)t[n]=arguments[l],n++;return a(t,n),n}})},function(e,t,n){"use strict";var r=n(3),i=n(92).left,o=n(26),a=n(23),s=n(96);r({target:"Array",proto:!0,forced:!o("reduce")||!s&&a>79&&a<83},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},function(e,t,n){"use strict";var r=n(3),i=n(14),o=n(48),a=n(49),s=n(10),l=n(27),c=n(22),d=n(28),u=n(32),h=n(58),p=n(16)("splice"),v=Math.max,m=Math.min;r({target:"Array",proto:!0,forced:!p},{splice:function(e,t){var n,r,p,g,f,y,_=i(this),E=s(_),b=o(e,E),S=arguments.length;for(0===S?n=r=0:1===S?(n=0,r=E-b):(n=S-2,r=m(v(a(t),0),E-b)),c(E+n-r),p=d(_,r),g=0;g<r;g++)(f=b+g)in _&&u(p,g,_[f]);if(p.length=r,n<r){for(g=b;g<E-r;g++)y=g+n,(f=g+r)in _?_[y]=_[f]:h(_,y);for(g=E;g>E-r+n;g--)h(_,g-1)}else if(n>r)for(g=E-r;g>b;g--)y=g+n-1,(f=g+r-1)in _?_[y]=_[f]:h(_,y);for(g=0;g<n;g++)_[g+b]=arguments[g+2];return l(_,E-r+n),p}})},function(e,t,n){"use strict";var r=n(3),i=n(14),o=n(10),a=n(27),s=n(58),l=n(22),c=1!==[].unshift(0),d=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();r({target:"Array",proto:!0,arity:1,forced:c||d},{unshift:function(e){var t=i(this),n=o(t),r=arguments.length;if(r){l(n+r);for(var c=n;c--;){var d=c+r;c in t?t[d]=t[c]:s(t,d)}for(var u=0;u<r;u++)t[u]=arguments[u]}return a(t,n+r)}})},function(e,t,n){"use strict";var r=n(3),i=n(71).trim;r({target:"String",proto:!0,forced:n(121)("trim")},{trim:function(){return i(this)}})},function(e,t){},function(e,t){e.exports=function(e,t,n,r,i,o){var a,s=e=e||{},l=typeof e.default;"object"!==l&&"function"!==l||(a=e,s=e.default);var c,d="function"==typeof s?s.options:s;if(t&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0),n&&(d.functional=!0),i&&(d._scopeId=i),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=c):r&&(c=r),c){var u=d.functional,h=u?d.render:d.beforeCreate;u?(d._injectStyles=c,d.render=function(e,t){return c.call(t),h(e,t)}):d.beforeCreate=h?[].concat(h,c):[c]}return{esModule:a,exports:s,options:d}}},function(e,t,n){"use strict";var r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"multiselect",class:{"multiselect--active":e.isOpen,"multiselect--disabled":e.disabled,"multiselect--above":e.isAbove,"multiselect--has-options-group":e.hasOptionGroup},attrs:{tabindex:e.searchable?-1:e.tabindex,role:"combobox","aria-owns":"listbox-"+e.id},on:{focus:function(t){return e.activate()},blur:function(t){!e.searchable&&e.deactivate()},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])||t.target!==t.currentTarget?null:(t.preventDefault(),e.pointerForward())},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])||t.target!==t.currentTarget?null:(t.preventDefault(),e.pointerBackward())}],keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")&&e._k(t.keyCode,"tab",9,t.key,"Tab")?null:(t.stopPropagation(),t.target!==t.currentTarget?null:e.addPointerElement(t))},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.deactivate()}}},[e._t("caret",(function(){return[n("div",{staticClass:"multiselect__select",on:{mousedown:function(t){return t.preventDefault(),t.stopPropagation(),e.toggle()}}})]}),{toggle:e.toggle}),e._v(" "),e._t("clear",null,{search:e.search}),e._v(" "),n("div",{ref:"tags",staticClass:"multiselect__tags"},[e._t("selection",(function(){return[n("div",{directives:[{name:"show",rawName:"v-show",value:e.visibleValues.length>0,expression:"visibleValues.length > 0"}],staticClass:"multiselect__tags-wrap"},[e._l(e.visibleValues,(function(t,r){return[e._t("tag",(function(){return[n("span",{key:r,staticClass:"multiselect__tag"},[n("span",{domProps:{textContent:e._s(e.getOptionLabel(t))}}),e._v(" "),n("i",{staticClass:"multiselect__tag-icon",attrs:{tabindex:"1"},on:{keypress:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:(n.preventDefault(),e.removeElement(t))},mousedown:function(n){return n.preventDefault(),e.removeElement(t)}}})])]}),{option:t,search:e.search,remove:e.removeElement})]}))],2),e._v(" "),e.internalValue&&e.internalValue.length>e.limit?[e._t("limit",(function(){return[n("strong",{staticClass:"multiselect__strong",domProps:{textContent:e._s(e.limitText(e.internalValue.length-e.limit))}})]}))]:e._e()]}),{search:e.search,remove:e.removeElement,values:e.visibleValues,isOpen:e.isOpen}),e._v(" "),n("transition",{attrs:{name:"multiselect__loading"}},[e._t("loading",(function(){return[n("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"multiselect__spinner"})]}))],2),e._v(" "),e.searchable?n("input",{ref:"search",staticClass:"multiselect__input",style:e.inputStyle,attrs:{name:e.name,id:e.id,type:"text",autocomplete:"off",spellcheck:"false",placeholder:e.placeholder,disabled:e.disabled,tabindex:e.tabindex,"aria-controls":"listbox-"+e.id},domProps:{value:e.search},on:{input:function(t){return e.updateSearch(t.target.value)},focus:function(t){return t.preventDefault(),e.activate()},blur:function(t){return t.preventDefault(),e.deactivate()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.deactivate()},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.preventDefault(),e.pointerForward())},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.preventDefault(),e.pointerBackward())},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:(t.stopPropagation(),e.removeLastElement())}],keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),t.stopPropagation(),t.target!==t.currentTarget?null:e.addPointerElement(t))}}}):e._e(),e._v(" "),e.isSingleLabelVisible?n("span",{staticClass:"multiselect__single",on:{mousedown:function(t){return t.preventDefault(),e.toggle.apply(null,arguments)}}},[e._t("singleLabel",(function(){return[[e._v(e._s(e.currentOptionLabel))]]}),{option:e.singleValue})],2):e._e(),e._v(" "),e.isPlaceholderVisible?n("span",{staticClass:"multiselect__placeholder",on:{mousedown:function(t){return t.preventDefault(),e.toggle.apply(null,arguments)}}},[e._t("placeholder",(function(){return[e._v("\n          "+e._s(e.placeholder)+"\n        ")]}))],2):e._e()],2),e._v(" "),n("transition",{attrs:{name:"multiselect"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}],ref:"list",staticClass:"multiselect__content-wrapper",style:{maxHeight:e.optimizedHeight+"px"},attrs:{tabindex:"-1"},on:{focus:e.activate,mousedown:function(e){e.preventDefault()}}},[n("ul",{staticClass:"multiselect__content",style:e.contentStyle,attrs:{role:"listbox",id:"listbox-"+e.id}},[e._t("beforeList"),e._v(" "),e.multiple&&e.max===e.internalValue.length?n("li",[n("span",{staticClass:"multiselect__option"},[e._t("maxElements",(function(){return[e._v("Maximum of "+e._s(e.max)+" options selected. First remove a selected option to select another.")]}))],2)]):e._e(),e._v(" "),!e.max||e.internalValue.length<e.max?e._l(e.filteredOptions,(function(t,r){return n("li",{key:r,staticClass:"multiselect__element",attrs:{id:e.id+"-"+r,role:t&&(t.$isLabel||t.$isDisabled)?null:"option"}},[t&&(t.$isLabel||t.$isDisabled)?e._e():n("span",{staticClass:"multiselect__option",class:e.optionHighlight(r,t),attrs:{"data-select":t&&t.isTag?e.tagPlaceholder:e.selectLabelText,"data-selected":e.selectedLabelText,"data-deselect":e.deselectLabelText},on:{click:function(n){return n.stopPropagation(),e.select(t)},mouseenter:function(t){return t.target!==t.currentTarget?null:e.pointerSet(r)}}},[e._t("option",(function(){return[n("span",[e._v(e._s(e.getOptionLabel(t)))])]}),{option:t,search:e.search,index:r})],2),e._v(" "),t&&(t.$isLabel||t.$isDisabled)?n("span",{staticClass:"multiselect__option",class:e.groupHighlight(r,t),attrs:{"data-select":e.groupSelect&&e.selectGroupLabelText,"data-deselect":e.groupSelect&&e.deselectGroupLabelText},on:{mouseenter:function(t){if(t.target!==t.currentTarget)return null;e.groupSelect&&e.pointerSet(r)},mousedown:function(n){return n.preventDefault(),e.selectGroup(t)}}},[e._t("option",(function(){return[n("span",[e._v(e._s(e.getOptionLabel(t)))])]}),{option:t,search:e.search,index:r})],2):e._e()])})):e._e(),e._v(" "),n("li",{directives:[{name:"show",rawName:"v-show",value:e.showNoResults&&0===e.filteredOptions.length&&e.search&&!e.loading,expression:"showNoResults && (filteredOptions.length === 0 && search && !loading)"}]},[n("span",{staticClass:"multiselect__option"},[e._t("noResult",(function(){return[e._v("No elements found. Consider changing the search query.")]}),{search:e.search})],2)]),e._v(" "),n("li",{directives:[{name:"show",rawName:"v-show",value:e.showNoOptions&&(0===e.options.length||!0===e.hasOptionGroup&&0===e.filteredOptions.length)&&!e.search&&!e.loading,expression:"showNoOptions && ((options.length === 0 || (hasOptionGroup === true && filteredOptions.length === 0)) && !search && !loading)"}]},[n("span",{staticClass:"multiselect__option"},[e._t("noOptions",(function(){return[e._v("List is empty.")]}))],2)]),e._v(" "),e._t("afterList")],2)])])],2)},staticRenderFns:[]};t.a=r},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n}])},5921:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const r=$,i=n.n(r)()},1345:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});let r=window.Model},7645:(e,t,n)=>{"use strict";n.d(t,{E:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,fileName:[String],dataBase64:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName().toLowerCase())}static getModelName(){return"AdditionalGridFile"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},6697:(e,t,n)=>{"use strict";n.d(t,{Y:()=>o});var r=n(1345),i=n(3734);class o extends((0,r.K)({modelName:String,modelVersion:String,colorSchemesActivated:[Boolean],activeColorScheme:[String],additionalColorSchemes:[Array],elementBackgroundColor:[String],elementBorderColor:[String],gridBackgroundColor:[String],borderWidth:[Number],elementMargin:[Number],borderRadius:[Number],colorMode:[String]})){constructor(e){super(e)}static getModelName(){return"ColorConfig"}}o.COLOR_MODE_BACKGROUND="COLOR_MODE_BACKGROUND",o.COLOR_MODE_BORDER="COLOR_MODE_BORDER",o.BORDER_WIDTH_BORDER_COLORED=.45,o.BORDER_WIDTH_BG_COLORED=.1,o.defaults({modelName:o.getModelName(),modelVersion:i.A.MODEL_VERSION,colorSchemesActivated:!0,activeColorScheme:i.A.DEFAULT_COLOR_SCHEMES[0].name,additionalColorSchemes:[],elementBackgroundColor:i.A.DEFAULT_ELEMENT_BACKGROUND_COLOR,elementBorderColor:i.A.DEFAULT_ELEMENT_BORDER_COLOR,gridBackgroundColor:i.A.DEFAULT_GRID_BACKGROUND_COLOR,borderWidth:o.BORDER_WIDTH_BG_COLORED,elementMargin:.15,borderRadius:.4,colorMode:o.COLOR_MODE_BACKGROUND})},3952:(e,t,n)=>{"use strict";n.d(t,{h:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,areURL:[String],areModelGridFileName:[String],componentId:[String],dataPortId:[String],dataPortSendData:[String],eventPortId:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-are")}static getModelName(){return"GridActionARE"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},1612:(e,t,n)=>{"use strict";n.d(t,{T:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,dataBase64:[String],mimeType:[String],durationMs:[Number],filename:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-audio")}static getModelName(){return"GridActionAudio"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},1140:(e,t,n)=>{"use strict";n.d(t,{N:()=>o});var r=n(4962),i=n(1345);class o extends((0,i.K)({id:String,modelName:String,language:[String],voice:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,o)),this.id=this.id||r.S.generateId("grid-action-change-lang")}static getModelName(){return"GridActionChangeLang"}}o.LAST_LANG="LAST_LANG",o.defaults({id:"",modelName:o.getModelName()})},4666:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,action:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-collect-elm")}static getModelName(){return"GridActionCollectElement"}static isSpeakAction(e){return[a.COLLECT_ACTION_SPEAK,a.COLLECT_ACTION_SPEAK_CONTINUOUS,a.COLLECT_ACTION_SPEAK_CLEAR,a.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR].includes(e)}static getActions(){return[a.COLLECT_ACTION_SPEAK,a.COLLECT_ACTION_SPEAK_CONTINUOUS,a.COLLECT_ACTION_SPEAK_CLEAR,a.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR,a.COLLECT_ACTION_CLEAR,a.COLLECT_ACTION_REMOVE_WORD,a.COLLECT_ACTION_REMOVE_CHAR,a.COLLECT_ACTION_SHARE,a.COLLECT_ACTION_COPY_IMAGE_CLIPBOARD,a.COLLECT_ACTION_COPY_CLIPBOARD,a.COLLECT_ACTION_APPEND_CLIPBOARD,a.COLLECT_ACTION_CLEAR_CLIPBOARD,a.COLLECT_ACTION_TO_YOUTUBE]}}a.canBeTested=!1,a.COLLECT_ACTION_SPEAK="COLLECT_ACTION_SPEAK",a.COLLECT_ACTION_SPEAK_CONTINUOUS="COLLECT_ACTION_SPEAK_CONTINUOUS",a.COLLECT_ACTION_SPEAK_CLEAR="COLLECT_ACTION_SPEAK_CLEAR",a.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR="COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR",a.COLLECT_ACTION_CLEAR="COLLECT_ACTION_CLEAR",a.COLLECT_ACTION_REMOVE_WORD="COLLECT_ACTION_REMOVE_WORD",a.COLLECT_ACTION_REMOVE_CHAR="COLLECT_ACTION_REMOVE_CHAR",a.COLLECT_ACTION_SHARE="COLLECT_ACTION_SHARE",a.COLLECT_ACTION_COPY_IMAGE_CLIPBOARD="COLLECT_ACTION_COPY_IMAGE_CLIPBOARD",a.COLLECT_ACTION_COPY_CLIPBOARD="COLLECT_ACTION_COPY_CLIPBOARD",a.COLLECT_ACTION_APPEND_CLIPBOARD="COLLECT_ACTION_APPEND_CLIPBOARD",a.COLLECT_ACTION_CLEAR_CLIPBOARD="COLLECT_ACTION_CLEAR_CLIPBOARD",a.COLLECT_ACTION_TO_YOUTUBE="COLLECT_ACTION_TO_YOUTUBE",a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},1288:(e,t,n)=>{"use strict";n.d(t,{h:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,restUrl:[String],method:[String],contentType:[String],acceptHeader:[String],body:[String],authUser:[String],authPw:[String],noCorsMode:[Boolean],useCorsProxy:[Boolean],isLiveAction:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-http")}static getModelName(){return"GridActionHTTP"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,method:"POST",contentType:"text/plain"})},3921:(e,t,n)=>{"use strict";n.d(t,{M:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,action:[String],sendText:[String],scrollPx:[Number],selectRoomId:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName())}static getModelName(){return"GridActionMatrix"}static getActions(){return Object.keys(a.actions)}}a.canBeTested=!1,a.actions={MATRIX_SEND_COLLECTED:"MATRIX_SEND_COLLECTED",MATRIX_SEND_COLLECTED_TEXT:"MATRIX_SEND_COLLECTED_TEXT",MATRIX_SEND_CUSTOM:"MATRIX_SEND_CUSTOM",MATRIX_NEXT_CONVERSATION:"MATRIX_NEXT_CONVERSATION",MATRIX_PREV_CONVERSATION:"MATRIX_PREV_CONVERSATION",MATRIX_SET_CONVERSATION:"MATRIX_SET_CONVERSATION",MATRIX_SCROLL_UP:"MATRIX_SCROLL_UP",MATRIX_SCROLL_DOWN:"MATRIX_SCROLL_DOWN",MATRIX_SPEAK_LAST_MSG:"MATRIX_SPEAK_LAST_MSG"},a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},367:(e,t,n)=>{"use strict";n.d(t,{g:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,navType:[String],toGridId:[String],addToCollectElem:[Boolean],searchCollectedText:[Boolean],searchText:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-navigate")}static getModelName(){return"GridActionNavigate"}}a.NAV_TYPES={TO_GRID:"navigateToGrid",TO_HOME:"navigateToHomeGrid",TO_LAST:"navigateToLastOpenedGrid",OPEN_SEARCH:"navigateToSearch"},a.canBeTested=!1,a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,navType:a.NAV_TYPES.TO_GRID})},9186:(e,t,n)=>{"use strict";n.d(t,{t:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,groupId:[String],actionInfo:[Object],customValues:[Object],isLiveAction:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName())}static getModelName(){return"GridActionPredefined"}}a.canBeTested=!0,a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,customValues:{}})},1683:(e,t,n)=>{"use strict";n.d(t,{G:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,dictionaryKey:[String,void 0,null],suggestOnChange:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-predict")}static getModelName(){return"GridActionPredict"}}a.canBeTested=!1,a.USE_DICTIONARY_CURRENT_LANG="USE_DICTIONARY_CURRENT_LANG",a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,dictionaryKey:null,suggestOnChange:!1})},6152:(e,t,n)=>{"use strict";n.d(t,{v:()=>a});var r=n(4962),i=n(3734),o=n(1345);n(3313);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,speakLanguage:[String,null,void 0]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-speak")}static getModelName(){return"GridActionSpeak"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION})},5855:(e,t,n)=>{"use strict";n.d(t,{m:()=>a});var r=n(4962),i=n(3734),o=n(1345);n(3313);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,speakLanguage:[String,null,void 0],speakText:[Object,String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-speak-custom")}static getModelName(){return"GridActionSpeakCustom"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,speakText:{}})},7989:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,action:[String],actionValue:[String,Number,void 0]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName())}static getModelName(){return"GridActionSystem"}}a.canBeTested=!1,a.actions={SYS_VOLUME_UP:"SYS_VOLUME_UP",SYS_VOLUME_DOWN:"SYS_VOLUME_DOWN",SYS_VOLUME_TOGGLE_MUTE:"SYS_VOLUME_TOGGLE_MUTE",SYS_ENTER_FULLSCREEN:"SYS_ENTER_FULLSCREEN",SYS_LEAVE_FULLSCREEN:"SYS_LEAVE_FULLSCREEN",SYS_UPDATE_LIVE_ELEMENTS:"SYS_UPDATE_LIVE_ELEMENTS"},a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,action:a.actions.SYS_VOLUME_UP,actionValue:10})},5628:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,data:[String],connectionType:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName())}static getModelName(){return"GridActionUART"}}a.CONN_TYPE_BT="CONN_TYPE_BT",a.CONN_TYPE_SERIAL="CONN_TYPE_SERIAL",a.CONN_TYPES=[a.CONN_TYPE_BT,a.CONN_TYPE_SERIAL],a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,connectionType:a.CONN_TYPE_BT})},2681:(e,t,n)=>{"use strict";n.d(t,{o:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,action:[String],radioId:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-webradio")}static getModelName(){return"GridActionWebradio"}static getActions(){return[a.WEBRADIO_ACTION_START,a.WEBRADIO_ACTION_TOGGLE,a.WEBRADIO_ACTION_STOP,a.WEBRADIO_ACTION_NEXT,a.WEBRADIO_ACTION_PREV,a.WEBRADIO_ACTION_VOLUP,a.WEBRADIO_ACTION_VOLDOWN]}}a.WEBRADIO_ACTION_START="WEBRADIO_ACTION_START",a.WEBRADIO_ACTION_TOGGLE="WEBRADIO_ACTION_TOGGLE",a.WEBRADIO_ACTION_STOP="WEBRADIO_ACTION_STOP",a.WEBRADIO_ACTION_NEXT="WEBRADIO_ACTION_NEXT",a.WEBRADIO_ACTION_PREV="WEBRADIO_ACTION_PREV",a.WEBRADIO_ACTION_VOLUP="WEBRADIO_ACTION_VOLUP",a.WEBRADIO_ACTION_VOLDOWN="WEBRADIO_ACTION_VOLDOWN",a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,radioId:"",action:a.WEBRADIO_ACTION_START})},4310:(e,t,n)=>{"use strict";n.d(t,{N:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,type:[String],secondaryType:[String],tags:[o.K.Array(String)],toggle:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("grid-action-word-form")}static getModelName(){return"GridActionWordForm"}}a.WORDFORM_MODE_CHANGE_ELEMENTS="WORDFORM_MODE_CHANGE_ELEMENTS",a.WORDFORM_MODE_CHANGE_BAR="WORDFORM_MODE_CHANGE_BAR",a.WORDFORM_MODE_CHANGE_EVERYWHERE="WORDFORM_MODE_CHANGE_EVERYWHERE",a.WORDFORM_MODE_NEXT_FORM="WORDFORM_MODE_NEXT_FORM",a.WORDFORM_MODE_RESET_FORMS="WORDFORM_MODE_RESET_FORMS",a.MODES=[a.WORDFORM_MODE_CHANGE_ELEMENTS,a.WORDFORM_MODE_CHANGE_BAR,a.WORDFORM_MODE_CHANGE_EVERYWHERE,a.WORDFORM_MODE_NEXT_FORM,a.WORDFORM_MODE_RESET_FORMS],a.MODES_SECONDARY=[a.WORDFORM_MODE_CHANGE_ELEMENTS,a.WORDFORM_MODE_CHANGE_BAR,a.WORDFORM_MODE_CHANGE_EVERYWHERE],a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,type:a.WORDFORM_MODE_CHANGE_ELEMENTS,tags:[]})},3647:(e,t,n)=>{"use strict";n.d(t,{a:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,action:[String],playType:[String],data:[String],stepSeconds:[Number],stepVolume:[Number],showCC:[Boolean],playMuted:[Boolean],performAfterNav:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName())}static getModelName(){return"GridActionYoutube"}static getActions(){return Object.keys(a.actions)}static getPlayTypes(){return Object.keys(a.playTypes)}}a.canBeTested=!1,a.actions={YT_PLAY:"YT_PLAY",YT_PAUSE:"YT_PAUSE",YT_TOGGLE:"YT_TOGGLE",YT_RESTART:"YT_RESTART",YT_STOP:"YT_STOP",YT_STEP_FORWARD:"YT_STEP_FORWARD",YT_STEP_BACKWARD:"YT_STEP_BACKWARD",YT_NEXT_VIDEO:"YT_NEXT_VIDEO",YT_PREV_VIDEO:"YT_PREV_VIDEO",YT_ENTER_FULLSCREEN:"YT_ENTER_FULLSCREEN",YT_VOLUME_UP:"YT_VOLUME_UP",YT_VOLUME_DOWN:"YT_VOLUME_DOWN",YT_VOLUME_MUTE:"YT_VOLUME_MUTE"},a.playTypes={YT_PLAY_VIDEO:"YT_PLAY_VIDEO",YT_PLAY_PLAYLIST:"YT_PLAY_PLAYLIST",YT_PLAY_SEARCH:"YT_PLAY_SEARCH",YT_PLAY_CHANNEL:"YT_PLAY_CHANNEL",YT_PLAY_RELATED:"YT_PLAY_RELATED"},a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,stepSeconds:10,stepVolume:20,playType:a.playTypes.YT_PLAY_VIDEO})},7732:(e,t,n)=>{"use strict";n.d(t,{D:()=>u});var r=n(4962),i=n(1964),o=n(7645),a=n(3734),s=n(1345);class l extends((0,s.K)({id:String,modelName:String,modelVersion:String,radioId:[String],radioUUID:[String],radioName:[String],radioUrl:[String],faviconUrl:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,l)),this.id=this.id||r.S.generateId("webradio")}static getModelName(){return"Webradio"}}l.defaults({id:"",modelName:l.getModelName(),modelVersion:a.A.MODEL_VERSION});var c=n(8923),d=n(4041);class u extends((0,s.K)({id:String,modelName:String,modelVersion:String,lastUpdateTime:[Number],isShortVersion:Boolean,label:[Object,String],rowCount:[Number],minColumnCount:[Number],gridElements:s.K.Array(i.V),additionalFiles:[s.K.Array(o.E)],webRadios:[s.K.Array(l)],thumbnail:[Object],showGlobalGrid:[Boolean],globalGridId:[String],keyboardMode:[String]})){constructor(e,t){(e=r.S.setDefaults(e,t,u))&&(e.id=e.id?e.id:r.S.generateId(u.getIdPrefix())),super(e),this.minColumnCount=e.minColumnCount||this.getWidth()||d.w.getLastGridDimensions().minColumnCount||4,this.rowCount=e.rowCount||this.getHeight()||d.w.getLastGridDimensions().rowCount||3,this.id=this.id||r.S.generateId("grid-data")}hasSetPositions(){return this.gridElements.every((e=>e.hasSetPosition()))}getWidth(){return c.b.getWidth(this)}getHeight(){return c.b.getHeight(this)}getWidthWithBounds(){return c.b.getWidthWithBounds(this)}getHeightWithBounds(){return c.b.getHeightWithBounds(this)}isFull(){return 0!==this.gridElements.length&&this.getWidthWithBounds()*this.getHeightWithBounds()===this.gridElements.reduce(((e,t)=>e+t.width*t.height),0)}getNewXYPos(e){if(e)return{x:this.gridElements.reduce(((e,t)=>{let n=t.x+t.width;return 0===t.y&&n>e&&(e=n),e}),0),y:0};let t=c.b.getFreeCoordinates(this);return t.length>0?t[0]:{x:0,y:c.b.getHeightWithBounds(this)}}getNewGridElement(e){e=e||{};let t=this.getNewXYPos();return e=Object.assign(e,{x:t.x,y:t.y}),new i.V(e)}isEqual(e){var t=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(this));return delete t._rev,delete n._rev,delete t._id,delete n._id,JSON.stringify(t)==JSON.stringify(n)}getNextElementId(e,t,n){if(n=n||i.V.ELEMENT_TYPE_NORMAL,!this.gridElements||0===this.gridElements.length)return e;if(1===this.gridElements.length)return this.gridElements[0].id;var r=JSON.parse(JSON.stringify(this.gridElements)).sort(((e,t)=>e.y!==t.y?e.y-t.y:e.x-t.x)),o=(r=r.filter((e=>e.type===n))).map((e=>e.id)),a=o.indexOf(e);if(-1===a)return o[0];var s=a+(t?-1:1);return o[s=(s=s>o.length-1?0:s)<0?o.length-1:s]}getPreviousElementId(e){return this.getNextElementId(e,!0)}getAdditionalFile(e){var t=this.additionalFiles.filter((t=>t.fileName===e));return t.length>0?t[0]:null}hasPredictionElements(){for(let e of this.gridElements)if(e.type===i.V.ELEMENT_TYPE_PREDICTION)return!0;return!1}clone(){let e=new u(this);for(let t of e.gridElements)t.id=(new i.V).id;return delete e._id,delete e._rev,e.id=r.S.generateId("grid-data"),Object.keys(this.label).forEach((t=>{e.label[t]=this.label[t]+" (Copy)"})),e}static getModelName(){return"GridData"}static getIdPrefix(){return"grid-data"}}u.KEYBOARD_ENABLED="KEYBOARD_ENABLED",u.KEYBOARD_DISABLED="KEYBOARD_DISABLED",u.KEYBOARD_MODES=[u.KEYBOARD_ENABLED,u.KEYBOARD_DISABLED],u.DEFAULTS={id:"",modelName:u.getModelName(),modelVersion:a.A.MODEL_VERSION,isShortVersion:!1,additionalFiles:[],webRadios:[],label:{},lastUpdateTime:(new Date).getTime(),showGlobalGrid:!0,globalGridId:null,keyboardMode:null},u.defaults(u.DEFAULTS)},1964:(e,t,n)=>{"use strict";n.d(t,{V:()=>A});var r=n(4962),i=n(2649),o=n(6152),a=n(5855),s=n(367),l=n(3952),c=n(3734),d=n(1345);class u extends((0,d.K)({id:String,modelName:String,modelVersion:String,openHABUrl:[String],itemType:[String],itemName:[String],actionType:[String],actionValue:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,u)),this.id=this.id||r.S.generateId("grid-action-openHAB")}static getModelName(){return"GridActionOpenHAB"}}u.defaults({id:"",modelName:u.getModelName(),modelVersion:c.A.MODEL_VERSION,actionValue:"0",itemType:"",itemName:"",actionType:"",openHABUrl:""});var h=n(1683),p=n(4666),v=n(2681),m=n(1140),g=n(3647);class f extends((0,d.K)({id:String,modelName:String,modelVersion:String,openURL:[String],timeoutSeconds:[Number]})){constructor(e,t){super(e=r.S.setDefaults(e,t,f)),this.id=this.id||r.S.generateId(f.getModelName())}static getModelName(){return"GridActionOpenWebpage"}}f.defaults({id:"",modelName:f.getModelName(),modelVersion:c.A.MODEL_VERSION,timeoutSeconds:0});var y=n(1612),_=n(1288),E=n(4310),b=n(5628),S=n(7989),C=n(9186),w=n(3921);class A extends((0,d.K)({id:String,modelName:String,modelVersion:String,width:Number,height:Number,x:[Number],y:[Number],label:[Object,String,void 0],wordForms:[d.K.Array(Object)],fontSizePct:[Number],fontColor:[String],backgroundColor:[String],colorCategory:[String],hidden:[Boolean],dontCollect:[Boolean],toggleInBar:[Boolean],image:[i.q],actions:[Object],type:String,vocabularyLevel:[Number,null],additionalProps:[Object]})){constructor(e,t){let n=JSON.parse(JSON.stringify(A.DEFAULTS));(e=r.S.setDefaults(e,t,A)||{}).actions=e.actions||[new o.v],super(Object.assign(n,e)),this.id=this.id||r.S.generateId(A.ID_PREFIX)}hasSetPosition(){return null!=this.x&&null!=this.x&&null!=this.y&&null!=this.y}getNavigateGridId(){let e=this.actions.filter((e=>e.modelName===s.g.getModelName()))[0];return e?e.toGridId:null}static getActionTypes(){return[o.v,s.g,a.m,y.T,E.N,h.G,p.z,l.h,u,v.o,g.a,m.N,f,_.h,b.D,S.u,C.t,w.M]}static getActionTypeModelNames(){return this.getActionTypes().map((e=>e.getModelName()))}static getActionInstance(e){let t=this.getActionClass(e);if(t)return new t;log.warn("action type not found: "+e)}static getActionClass(e){let t=this.getActionTypes().filter((t=>t.getModelName()===e))[0];if(t)return t;log.warn("action type not found: "+e)}static canActionClassBeTested(e){return!this.getActionClass(e)||!1!==this.getActionClass(e).canBeTested}static getModelName(){return"GridElement"}}A.ELEMENT_TYPE_NORMAL="ELEMENT_TYPE_NORMAL",A.ELEMENT_TYPE_COLLECT="ELEMENT_TYPE_COLLECT",A.ELEMENT_TYPE_PREDICTION="ELEMENT_TYPE_PREDICTION",A.ELEMENT_TYPE_YT_PLAYER="ELEMENT_TYPE_YT_PLAYER",A.ELEMENT_TYPE_LIVE="ELEMENT_TYPE_LIVE",A.ELEMENT_TYPE_MATRIX_CONVERSATION="ELEMENT_TYPE_MATRIX_CONVERSATION",A.PROP_YT_PREVENT_CLICK="PROP_YT_PREVENT_CLICK",A.ID_PREFIX="grid-element",A.DEFAULTS={id:"",modelName:A.getModelName(),modelVersion:c.A.MODEL_VERSION,label:{},width:1,height:1,image:new i.q,type:A.ELEMENT_TYPE_NORMAL,additionalProps:{},wordForms:[],x:0,y:0,hidden:!1,vocabularyLevel:null}},1540:(e,t,n)=>{"use strict";n.d(t,{$:()=>a});var r=n(1964),i=n(4666),o=n(1683);class a extends(r.V.extend({showLabels:[Boolean],showFullLabels:[Boolean],imageHeightPercentage:[Number],mode:[String],singleLine:[Boolean],convertToLowercase:[Boolean],textElemSizeFactor:[Number]})){constructor(e){(e=e||{}).showLabels=!0,e.singleLine=!0,e.convertToLowercase=void 0!==e.convertToLowercase&&e.convertToLowercase,e.imageHeightPercentage=85,e.mode=a.MODE_AUTO,e.type=r.V.ELEMENT_TYPE_COLLECT,e.textElemSizeFactor=1.5,e.actions=e.actions||[new i.z({action:i.z.COLLECT_ACTION_SPEAK_CONTINUOUS}),new o.G({suggestOnChange:!0,dictionaryKey:o.G.USE_DICTIONARY_CURRENT_LANG})],super(e)}}a.MODE_AUTO="MODE_AUTO",a.MODE_COLLECT_SEPARATED="MODE_COLLECT_SEPARATED",a.MODE_COLLECT_TEXT="MODE_COLLECT_TEXT",a.MODES=[a.MODE_AUTO,a.MODE_COLLECT_SEPARATED,a.MODE_COLLECT_TEXT]},2649:(e,t,n)=>{"use strict";n.d(t,{q:()=>a});var r=n(4962),i=n(1345),o=n(7410);class a extends((0,i.K)({data:[String],url:[String],author:[String],authorURL:[String],searchProviderName:[String],searchProviderOptions:[Array]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a))}getImageType(){if(!this.data&&!this.url)return null;if(this.data){let e=this.data.substring(11,this.data.indexOf(";base64"));switch(e){case"png":return a.IMAGE_TYPES.PNG;case"jpeg":return a.IMAGE_TYPES.JPEG;case"svg":case"svg+xml":return a.IMAGE_TYPES.SVG;default:return log.warn("not recognized image type: "+e),null}}if(this.url){if(this.url.includes("api.arasaac.org"))return a.IMAGE_TYPES.PNG;if(this.url.toLowerCase().includes(".jpeg")||this.url.toLowerCase().includes(".jpg"))return a.IMAGE_TYPES.JPEG;if(this.url.toLowerCase().includes(".png"))return a.IMAGE_TYPES.PNG;if(this.url.toLowerCase().includes(".svg"))return a.IMAGE_TYPES.SVG}}getDimensions(){return o.M.getImageDimensionsFromDataUrl(this.data)}static getModelName(){return"GridImage"}static getIdPrefix(){return"grid-image"}}a.IMAGE_TYPES={PNG:"PNG",JPEG:"JPEG",SVG:"SVG"},a.defaults({data:null,author:null,authorURL:null})},3866:(e,t,n)=>{"use strict";n.d(t,{R:()=>c});var r=n(4962),i=n(3734),o=n(1345),a=n(583),s=n(9410),l=n(3766);class c extends((0,o.K)({id:String,modelName:String,modelVersion:String,globalReadActive:[Boolean],globalReadActiveRate:[Number],globalReadAdditionalActions:[Boolean],globalBeepFeedback:[Boolean],globalMinPauseCollectSpeak:[Number],scanEnabled:[Boolean],scanAuto:[Boolean],scanTimeoutMs:[Number],scanTimeoutFirstElementFactor:[Number],scanVertical:[Boolean],scanBinary:[Boolean],scanStartWithAction:[Boolean],scanRoundsUntilBack:[Number],scanInputs:[o.K.Array(Object)],hoverEnabled:[Boolean],hoverTimeoutMs:Number,hoverHideCursor:[Boolean],hoverDisableHoverpane:[Boolean],mouseclickEnabled:[Boolean],mouseDoubleClickEnabled:[Boolean],mouseDownInsteadClick:[Boolean],dirEnabled:[Boolean],dirInputs:[o.K.Array(Object)],dirWrapAround:[Boolean],dirResetToStart:[Boolean],seqEnabled:[Boolean],seqInputs:[o.K.Array(Object)],seqAuto:[Boolean],seqTimeoutFirstElementFactor:[Number],seqTimeoutMs:[Number],seqResetToStart:[Boolean],seqStartWithAction:[Boolean],seqRoundsUntilStop:[Number],huffEnabled:[Boolean],huffElementCount:[Number],huffInputs:[o.K.Array(Object)],huffColors:[o.K.Array(String)],huffShowColors:[Boolean],huffShowNumbers:[Boolean],huffColorWholeElement:[Boolean],huffTimeout:[Number],huffMarkInactive:[Boolean]})){constructor(e,t){super(e=r.S.setDefaults(e,t,c)),this.id=this.id||r.S.generateId("input-config")}static getModelName(){return"InputConfig"}static getInputEventTypes(){return[a.O,l.n,s.L]}static getInputEventInstance(e,t){let n=this.getInputEventTypes().filter((t=>t.getModelName()===e))[0];if(n)return new n(t);log.warn("input event type not found: "+e)}}c.UP="UP",c.DOWN="DOWN",c.LEFT="LEFT",c.RIGHT="RIGHT",c.SELECT="SELECT",c.NEXT="NEXT",c.NEXT_ELEMENT="NEXT_ELEMENT",c.PREVIOUS_ELEMENT="PREVIOUS_ELEMENT",c.GENERAL_INPUT="GENERAL_INPUT",c.getNumConst=e=>"NUM"+e,c.DEFAULT_SCAN_INPUTS=[new a.O({label:c.SELECT,keyCode:32,keyName:"Space",holdDuration:400}),new a.O({label:c.NEXT,keyCode:32,keyName:"Space"})],c.DEFAULT_SEQ_INPUTS=[new a.O({label:c.SELECT,keyCode:32,keyName:"Space"}),new a.O({label:c.NEXT_ELEMENT,keyCode:39,keyName:"ArrowRight"}),new a.O({label:c.PREVIOUS_ELEMENT,keyCode:37,keyName:"ArrowLeft"})],c.DEFAULT_DIR_INPUTS=[new a.O({label:c.SELECT,keyCode:32,keyName:"Space"}),new a.O({label:c.LEFT,keyCode:37,keyName:"ArrowLeft"}),new a.O({label:c.RIGHT,keyCode:39,keyName:"ArrowRight"}),new a.O({label:c.UP,keyCode:38,keyName:"ArrowUp"}),new a.O({label:c.DOWN,keyCode:40,keyName:"ArrowDown"})],c.DEFAULT_HUFF_INPUTS=[new a.O({label:c.GENERAL_INPUT,keyCode:49,keyName:"Digit1"}),new a.O({label:c.GENERAL_INPUT,keyCode:50,keyName:"Digit2"}),new a.O({label:c.GENERAL_INPUT,keyCode:51,keyName:"Digit3"}),new a.O({label:c.GENERAL_INPUT,keyCode:52,keyName:"Digit4"})],c.DEFAULT_HUFF_COLORS=["#D55E00","#F0E442","#009E73","#0072B2","#CC79A7","#E69F00","#56B4E9","#000000","#016619"],c.defaults({id:"",modelName:c.getModelName(),modelVersion:i.A.MODEL_VERSION,globalReadActiveRate:1,globalMinPauseCollectSpeak:0,scanAuto:!1,scanTimeoutMs:1e3,scanTimeoutFirstElementFactor:1,scanBinary:!1,scanStartWithAction:!1,scanRoundsUntilBack:3,hoverTimeoutMs:1e3,hoverDisableHoverpane:!0,mouseclickEnabled:!0,mouseDoubleClickEnabled:!1,mouseDownInsteadClick:!1,scanInputs:c.DEFAULT_SCAN_INPUTS,dirInputs:c.DEFAULT_DIR_INPUTS,seqInputs:c.DEFAULT_SEQ_INPUTS,seqAuto:!1,seqTimeoutMs:1e3,seqTimeoutFirstElementFactor:1,seqResetToStart:!0,seqStartWithAction:!1,seqRoundsUntilStop:3,dirWrapAround:!0,huffInputs:c.DEFAULT_HUFF_INPUTS,huffColors:c.DEFAULT_HUFF_COLORS,huffShowColors:!0,huffShowNumbers:!0,huffElementCount:0,huffTimeout:4e3,huffMarkInactive:!0})},9410:(e,t,n)=>{"use strict";n.d(t,{L:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,label:[String],eventNames:[o.K.Array(String)],areURL:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("input-event-are")}isValid(){return this.modelName&&this.label&&this.eventNames.length>0}static getModelName(){return"InputEventARE"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,eventNames:[]})},3766:(e,t,n)=>{"use strict";n.d(t,{n:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,volThresholdHigh:[Number],volThresholdLow:[Number],freqThresholdHigh:[Number],freqThresholdLow:[Number],debounceMs:[Number]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("input-event-audio")}isValid(){return this.modelName&&void 0!==this.volThresholdHigh&&void 0!==this.volThresholdLow}static getModelName(){return"InputEventAudio"}}a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,volThresholdHigh:5,volThresholdLow:1,freqThresholdHigh:2e4,freqThresholdLow:0,debounceMs:200})},583:(e,t,n)=>{"use strict";n.d(t,{O:()=>a});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,label:[String],keyCode:[Number,String,void 0],keyName:[String],repeat:[Number],timeout:[Number],holdDuration:[Number]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId("input-event-key")}isValid(){return this.modelName&&this.label&&this.keyCode}static getModelName(){return"InputEventKey"}}a.KEY_MOUSE_PREFIX="KEY_MOUSE",a.KEY_MOUSE_LEFT="KEY_MOUSE0",a.KEY_MOUSE_MIDDLE="KEY_MOUSE1",a.KEY_MOUSE_RIGHT="KEY_MOUSE2",a.KEY_TAP="KEY_TAP",a.SPECIAL_KEYS=[a.KEY_MOUSE_LEFT,a.KEY_MOUSE_MIDDLE,a.KEY_MOUSE_RIGHT,a.KEY_TAP],a.defaults({id:"",modelName:a.getModelName(),modelVersion:i.A.MODEL_VERSION,repeat:1,timeout:0,holdDuration:0})},7858:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class r{constructor(e={}){this.homeserver=e.homeserver,this.user=e.user,this.accessToken=e.accessToken,this.deviceId=e.deviceId,this.useCrypto=e.useCrypto||!1}}},8058:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});class r{constructor(e={}){this.homeserver=e.homeserver||"https://matrix.org",this.user=e.user,this.password=e.password}}},8312:(e,t,n)=>{"use strict";n.d(t,{e:()=>u});var r=n(4962),i=n(3866),o=n(3734),a=n(1345),s=n(6697),l=n(4519);class c extends((0,a.K)({modelName:String,modelVersion:String,backupNotifyIntervalDays:[Number],lastBackupNotification:[Number],lastBackup:[Number]})){constructor(e){super(e)}static getModelName(){return"NotificationConfig"}}c.defaults({modelName:c.getModelName(),modelVersion:o.A.MODEL_VERSION,backupNotifyIntervalDays:7,lastBackupNotification:0,lastBackup:0});var d=n(8058);class u extends((0,a.K)({id:String,modelName:String,modelVersion:String,homeGridId:[String],toHomeAfterSelect:[Boolean],lastOpenedGridId:[String],globalGridId:[String],globalGridActive:[Boolean],globalGridHeightPercentage:[Number],locked:[Boolean],fullscreen:[Boolean],hashCodes:[Object],inputConfig:i.R,colorConfig:[s.Y],textConfig:[l.a],notificationConfig:[c],activateARASAACGrammarAPI:[Boolean],vocabularyLevel:[Number,null],integrations:[Object]})){constructor(e,t){super(e=r.S.setDefaults(e,t,u)||{}),this.id=this.id||r.S.generateId(u.getIdPrefix()),this.colorConfig=e.colorConfig||new s.Y,this.textConfig=e.textConfig||new l.a,this.notificationConfig=e.notificationConfig||new c,this.homeGridId=e.homeGridId||null}isEqual(e){var t=JSON.parse(JSON.stringify(e)),n=JSON.parse(JSON.stringify(this));return delete t._rev,delete n._rev,delete t._id,delete n._id,JSON.stringify(t)==JSON.stringify(n)}static getActiveColorScheme(e){return e=e||new u,o.A.DEFAULT_COLOR_SCHEMES.filter((t=>t.name===e.colorConfig.activeColorScheme))[0]||o.A.DEFAULT_COLOR_SCHEMES[0]}static getElementColor(e,t,n){if(!t||!t.colorConfig)return o.A.DEFAULT_ELEMENT_BACKGROUND_COLOR;let r=u.getActiveColorScheme(t),i=r.categories.indexOf(e.colorCategory);return t.colorConfig.colorSchemesActivated&&e.colorCategory&&-1!==i?r.colors[i]:e.backgroundColor||n||t.colorConfig.elementBackgroundColor}static getModelName(){return"MetaData"}static getIdPrefix(){return"meta-data"}}u.defaults({id:"",modelName:u.getModelName(),modelVersion:o.A.MODEL_VERSION,locked:void 0,fullscreen:void 0,hashCodes:{},inputConfig:new i.R,globalGridActive:!1,globalGridHeightPercentage:17,vocabularyLevel:null,integrations:new class{constructor(e={}){this.matrixConfig=e.matrixConfig||new d.P}}})},4519:(e,t,n)=>{"use strict";n.d(t,{a:()=>o});var r=n(1345),i=n(3734);class o extends((0,r.K)({modelName:String,modelVersion:String,convertMode:[String],fontFamily:[String],fontSizePct:[Number],lineHeight:[Number],maxLines:[Number],textPosition:[String],onlyTextFontSizePct:[Number],onlyTextLineHeight:[Number],fittingMode:[String],autoSizeKeyboardLetters:[Boolean],fontColor:[String]})){constructor(e){super(e)}static getModelName(){return"TextConfig"}}o.CONVERT_MODE_UPPERCASE="CONVERT_MODE_UPPERCASE",o.CONVERT_MODE_LOWERCASE="CONVERT_MODE_LOWERCASE",o.TEXT_POS_ABOVE="ABOVE",o.TEXT_POS_BELOW="BELOW",o.TOO_LONG_AUTO="AUTO",o.TOO_LONG_TRUNCATE="TRUNCATE",o.TOO_LONG_ELLIPSIS="ELLIPSIS",o.FONTS=["Arial","Roboto-Regular","OpenDyslexic-Regular","Jost-400-Book","Times"],o.defaults({modelName:o.getModelName(),modelVersion:i.A.MODEL_VERSION,convertMode:null,fontFamily:"Arial",fontSizePct:15,lineHeight:1.5,maxLines:1,textPosition:o.TEXT_POS_BELOW,onlyTextFontSizePct:35,onlyTextLineHeight:1.5,fittingMode:o.TOO_LONG_AUTO,autoSizeKeyboardLetters:!0,fontColor:i.A.DEFAULT_ELEMENT_FONT_COLOR})},2872:(e,t,n)=>{"use strict";n.d(t,{r:()=>r});class r{constructor(e){e=e||{},this.preferredVoice=e.preferredVoice,this.secondVoice=e.secondVoice,this.voiceLangIsTextLang=e.voiceLangIsTextLang,this.voicePitch=e.voicePitch,this.voiceRate=e.voiceRate}}},8033:(e,t,n)=>{"use strict";n.d(t,{H:()=>u});var r=n(4962),i=n(3734),o=n(1345);class a extends((0,o.K)({id:String,modelName:String,modelVersion:String,encryptedDataBase64:[String],encryptedDataBase64Short:[String]})){constructor(e,t){super(e=r.S.setDefaults(e,t,a)),this.id=this.id||r.S.generateId(a.getModelName().toLowerCase())}static getModelName(){return"EncryptedObject"}}a.defaults({modelVersion:i.A.MODEL_VERSION});var s=n(2867);let l=window.sjcl;var c=n(9557),d=n(4843);let u={},h=null,p=null,v=!1,m=new d.X,g=new d.X;function f(e){return u.getStringHash(""+e+p)}function y(){if(!p||!h||0===h.length){let e="using encryptionService uninitialized is not possible, aborting...";throw c.R.error(e),e}}u.encryptObject=function(e){if(y(),!e)return e;let t=new a({id:e.id,modelName:e.modelName});t._id=e.id,e._rev&&(t._rev=e._rev);let n=JSON.stringify(e),r=JSON.stringify(s.j.removeLongPropertyValues(e)),i=n!==r;return t.encryptedDataBase64=u.encryptString(n,h[0]),t.encryptedDataBase64Short=i?u.encryptString(r,h[0]):null,t},u.decryptObjects=function(e,t){if(y(),!e)return e;let n=(t=t||{}).onlyShortVersion,r=[];return(e=e instanceof Array?e:[e]).forEach((e=>{try{let t=null,i=null;if(n){let n=e.encryptedDataBase64Short||e.encryptedDataBase64;t=u.decryptStringTrySalts(n,h),i=JSON.parse(t),i.isShortVersion=!0}else t=u.decryptStringTrySalts(e.encryptedDataBase64,h),i=JSON.parse(t);i._id=e._id,i._rev=e._rev,r.push(i)}catch(t){c.R.error("error decrypting object: "+e.modelName+", id: "+e.id),c.R.error(t)}})),r.length>1?r:r[0]},u.encryptString=function(e,t){y();let n=f(t),r=null;return r=n&&!v?l.encrypt(n,e,{iter:1e3}):e,r},u.decryptString=function(e,t){if(y(),m.has(e))return c.R.debug("using decryption cache..."),m.get(e);let n=f(t),r=null;if((new Date).getTime(),n&&!v)r=l.decrypt(n,e);else try{r=e;let t=JSON.parse(r);t.iv&&t.cipher&&t.ct&&(r=l.decrypt(n,e))}catch(t){r=l.decrypt(n,e)}return m.set(e,r),r},u.decryptStringTrySalts=function(e,t){try{return t=JSON.parse(JSON.stringify(t)),u.decryptString(e,t.shift())}catch(n){if(0===t.length)throw c.R.error("wasn't able to decrypt string, no remaining salts for trying!"),n;return c.R.warn("wasn't able to decrypt string, try next salt...",t[0]),u.decryptStringTrySalts(e,t)}},u.getStringHash=function(e){if(g.has(e))return g.get(e);let t=l.hash.sha256.hash(e),n=l.codec.hex.fromBits(t);return g.set(e,n),n},u.getUserPasswordHash=function(e){return u.getStringHash("STATIC_USER_PW_SALT"+e)},u.setEncryptionProperties=function(e,t,n){p=e=e||"",h=Array.isArray(t)?t:[t],v=n,m.clearAll(),g.clearAll()},u.resetEncryptionProperties=function(){c.R.debug("reset encryption properties..."),h=null,p=null,v=!1}},4041:(e,t,n)=>{"use strict";n.d(t,{w:()=>T});var r=n(3734),i=n(4962),o=n(2872),a=n(3647),s=n(7858);class l{constructor(e={}){this.matrixConfig=e.matrixConfig||new s.Z}}let c={lastPlayType:a.a.playTypes.YT_PLAY_PLAYLIST,lastData:"https://www.youtube.com/watch?v=5ffLB4a9APc&list=PL0UXHkT03dGrIHldlEKR0ZWfNMkShuTNz",lastVideoId:null,lastTimes:{},lastPlaylistIndexes:{},dataApiCalls:{},muted:!1,volume:100};class d{constructor(e){e=e||{},this.modelVersion=e.modelVersion,this.modelVersionDb=e.modelVersionDb,this.contentLang=e.contentLang,this.lastContentLang=e.lastContentLang,this.username=e.username,this.password=e.password,this.metadata=e.metadata,this.ytState=e.ytState||JSON.parse(JSON.stringify(c)),this.voiceConfig=e.voiceConfig&&Object.keys(e.voiceConfig).length?new o.r(e.voiceConfig):{},this.originGridsetFilename=e.originGridsetFilename,this.isEmpty=void 0===e.isEmpty||e.isEmpty,this.systemVolume=void 0!==e.systemVolume?e.systemVolume:100,this.systemVolumeMuted=e.systemVolumeMuted||!1,this.integrations=e.integrations||new l,h.updateDataModel(this)}}var u=n(8312);let h={},p="AG_LOCAL_METADATA_KEY";function v(e){if(e.major===i.S.getLatestModelVersionLocal().major)return[];let t=[];return null===e.major&&t.push((function(e){if(!e)return e;if(e instanceof g&&(e.appLang=void 0!==e.appLang?e.appLang:T.get("CUSTOM_LANGUAGE_KEY"),e.unlockPasscode=void 0!==e.unlockPasscode?e.unlockPasscode:T.getJSON("AG_UNLOCK_PASSCODE_KEY"),e.syncNavigation=void 0!==e.syncNavigation?e.syncNavigation:T.getJSON("AG_SYNC_NAVIGATION_KEY")),e instanceof d){let t=e.username;e.modelVersionDb=void 0!==e.modelVersionDb?e.modelVersionDb:m(t,"USER_MODELVERSION_KEY"),e.password=void 0!==e.password?e.password:m(t,"USER_PASSWORDS_KEY"),e.metadata=void 0!==e.metadata?e.metadata:m(t,p),e.ytState=void 0!==e.ytState?e.ytState:m(t,"AG_YT_STATE_KEY")}return e.modelVersion=r.A.MODEL_VERSION_LOCAL,e})),t}function m(e,t){let n=T.getJSON(t)||{},r=n[e];return r||(r||t!==p||n.modelName!==u.e.getModelName()?void 0:n)}h.updateDataModel=function(e){return i.S.convertObjects(e,v)};class g{constructor(e){e=e||{},this.modelVersion=e.modelVersion,this.appLang=e.appLang||"",this.unlockPasscode=e.unlockPasscode,this.syncNavigation=e.syncNavigation,this.externalSpeechServiceUrl=e.externalSpeechServiceUrl,h.updateDataModel(this)}}var f=n(5921);let y="could not access local storage, maybe disabled by user? Error: ",_="SYNCED_DBS_LIST_KEY",E="LAST_ACTIVEUSER_KEY",b="AUTOLOGIN_USER_KEY",S="AG_GRID_DIMENSIONS_KEY",C="AG_CURRENT_VERSION_KEY",w="AG_APP_SETTINGS",A="AG_USER_SETTINGS",T={},I=window.localStorage;function k(){let e=T.get(_);return e?JSON.parse(e):(T.save(_,JSON.stringify([])),[])}function O(){if(T.getJSON(A))return;log.info("transferring user data to new data model...");let e=T.getJSON("USER_PASSWORDS_KEY")||{},t=Object.keys(e)||[];for(let n of t)T.saveUserSettings({username:n,password:e[n]});0===t.length&&T.saveJSON(A,{})}window.service=T,T.save=function(e,t){if(I)try{return I.setItem(e,t)}catch(e){log.error(y+e)}},T.get=function(e){if(I)try{return I.getItem(e)}catch(e){log.error(y+e)}},T.remove=function(e){if(I)try{return I.removeItem(e)}catch(e){log.error(y+e)}},T.saveJSON=function(e,t){T.save(e,JSON.stringify(t))},T.getJSON=function(e){return JSON.parse(T.get(e))},T.getAppSettings=function(){let e=T.getJSON(w);return new g(e)},T.saveAppSettings=function(e){e=e||{};let t=T.getAppSettings();Object.assign(t,e),T.saveJSON(w,t),(0,f.A)(document).trigger(r.A.EVENT_APPSETTINGS_UPDATED,t)},T.getUserSettings=function(e=null){if(!(e=e||T.getAutologinUser()||T.getLastActiveUser()))return new d;let t=(T.getJSON(A)||{})[e]||{};return t.username=e,new d(t)},T.saveUserSettings=function(e,t){if(!(t=(e=e||{}).username||t||T.getAutologinUser()||T.getLastActiveUser()))return;let n=T.getUserSettings(t)||{};Object.assign(n,e);let i=T.getJSON(A)||{};i[t]=n,T.saveJSON(A,i),(0,f.A)(document).trigger(r.A.EVENT_USERSETTINGS_UPDATED,n)},T.anyMatrixUserUsingCrypto=function(){let e=T.getJSON(A)||{},t=!1;for(let n of Object.values(e))n.integrations&&n.integrations.matrixConfig&&(t=t||n.integrations.matrixConfig.useCrypto);return t},T.getAutoImportedUserSettings=function(){let e=T.getJSON(A)||{};return Object.keys(e).filter((e=>e.startsWith(r.A.LOCAL_DEFAULT_USER_PREFIX))).map((t=>new d(e[t])))},T.getNextAutoUserName=function(){let e=T.getJSON(A)||{},t=Object.keys(e);for(let e=1;e<20;e++){let n=r.A.LOCAL_DEFAULT_USER_PREFIX+e;if(!t.includes(n))return n}return r.A.LOCAL_DEFAULT_USER_PREFIX+"fallback"},T.isSavedLocalUser=function(e){return""===T.getUserSettings(e).password},T.saveUserPassword=function(e,t){T.saveUserSettings({username:e,password:t})},T.removeLocalUser=function(e){T.unmarkSyncedDatabase(e);let t=T.getJSON(A)||{};delete t[e],T.saveJSON(A,t),T.getAutologinUser()===e&&T.setAutologinUser("")},T.getSavedUsers=function(e){let t=T.getSavedLocalUsers(),n=T.getSavedOnlineUsers().concat(t);return e&&n.includes(e)&&(n=n.filter((t=>t!==e)),n.unshift(e)),n},T.getSavedLocalUsers=function(){O();let e=T.getJSON(A)||{};return(Object.keys(e)||[]).filter((t=>""===e[t].password)).sort(((e,t)=>e===r.A.LOCAL_DEMO_USERNAME?1:t===r.A.LOCAL_DEMO_USERNAME?-1:e.localeCompare(t)))},T.getSavedOnlineUsers=function(){O();let e=T.getJSON(A)||{};return(Object.keys(e)||[]).filter((t=>""!==e[t].password)).sort()},T.setLastActiveUser=function(e){T.save(E,e)},T.getLastActiveUser=function(){return T.get(E)},T.setAutologinUser=function(e){e!==r.A.LOCAL_DEMO_USERNAME&&T.save(b,e)},T.getAutologinUser=function(){return T.get(b)},T.markSyncedDatabase=function(e){let t=k();t.includes(e)||t.push(e),T.save(_,JSON.stringify(t))},T.isDatabaseSynced=function(e){return k().includes(e)},T.unmarkSyncedDatabase=function(e){let t=k();t=t.filter((t=>t!==e)),T.save(_,JSON.stringify(t))},T.getUserMajorModelVersion=function(e){let t=T.getUserSettings(e).modelVersionDb;return t?parseInt(JSON.parse(t).major):1},T.setUserModelVersion=function(e,t){T.getUserMajorModelVersion(e)<JSON.parse(t).major&&T.saveUserSettings({modelVersionDb:t},e)},T.saveLastGridDimensions=function(e){return T.save(S,JSON.stringify(e))},T.getLastGridDimensions=function(){let e=T.get(S);return e?JSON.parse(e):{}},T.getCurrentAppVersion=function(){return T.get(C)},T.setCurrentAppVersion=function(e){T.save(C,e)}},3313:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(5921),i=n(4765),o=n(4041),a=n(3734);let s={},l=a.A.BOARDS_REPO_BASE_URL+"predefined_mappings/i18n/",c=null,d=[],u="en",h=null,p=o.w.getAppSettings().appLang,v={},m=["en","de","ar","eu","bg","ca","hr","cs","nl","fr","gl","he","hu","it","ko","pl","pt","ro","ru","sl","es","tr","uk","val"],g=["aa","ab","ae","af","ak","am","an","ar","ar-ae","ar-bh","ar-dz","ar-eg","ar-iq","ar-jo","ar-kw","ar-lb","ar-ly","ar-ma","ar-om","ar-qa","ar-sa","ar-sy","ar-tn","ar-ye","as","av","ay","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","de-at","de-ch","de-ch-loc","de-li","de-lu","dv","dz","ee","el","en","en-au","en-bz","en-ca","en-gb","en-ie","en-in","en-jm","en-nz","en-tt","en-us","en-za","eo","es","es-ar","es-bo","es-cl","es-co","es-cr","es-do","es-ec","es-gt","es-hn","es-mx","es-ni","es-pa","es-pe","es-pr","es-py","es-sv","es-uy","es-ve","et","eu","fa","ff","fi","fj","fo","fr","fr-be","fr-ca","fr-ch","fr-lu","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","it-ch","iu","ja","ji","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lu","lv","mg","mh","mi","mk","ml","mn","mr","ms","mt","my","na","nb","nd","ne","ng","nl","nl-be","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","pt-br","qu","rm","rn","ro","ro-md","ru","ru-md","rw","sa","sb","sc","sd","se","sg","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sv-fi","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","val","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zh-cn","zh-hk","zh-sg","zh-tw","zu"].map((e=>({code:e})));async function f(e,t){if(!e||d.includes(e))return;let i="app/lang/i18n."+e+".json";try{let t=await r.A.get(i);d.push(e),c.setLocaleMessage(e,t)}catch(e){return void(t||await f(u,!0))}g.forEach((t=>{if(!t[e]){let n=s.getBaseLang(t.code),r=s.getCountryCode(t.code);t[e]=s.tl(`lang.${n}`,[],e),r&&(t[e]=`${t[e]}, ${s.tl(`country.${r}`,[],e)}`)}})),(await Promise.resolve().then(n.bind(n,5888))).serviceWorkerService.cacheUrl(i)}async function y(){let e=o.w.getUserSettings();h=e.contentLang,f(s.getContentLangBase())}async function _(e){if(e=e||s.getAppLang(),v[e])return v[e];let t=`i18n.${e}.json`;try{let n=await fetch(l+t),r=await n.json();return v[e]=r,r}catch(n){return log.warn(`translation file ${t} not found.`),"en"!==e?(log.warn('trying "en" translation file.'),_("en")):{}}}s.getVueI18n=async function(){return c||(c=new i.A({locale:s.getAppLang(),fallbackLocale:u,messages:{}}),await f(u),await _(u),await _(),y(),s.setAppLanguage(s.getAppLang(),!0).then((()=>Promise.resolve(c))))},s.getBrowserLang=function(){return navigator.language.substring(0,2).toLowerCase()},s.getContentLang=function(){return h||s.getAppLang()},s.getContentLangBase=function(){return s.getBaseLang(s.getContentLang())},s.getContentLangReadable=function(){return s.getLangReadable(s.getContentLang())},s.getAppLang=function(){return s.getCustomAppLang()||s.getBrowserLang()},s.getCustomAppLang=function(){return p||""},s.isCurrentAppLangDE=function(){return"de"===s.getAppLang()},s.isCurrentAppLangEN=function(){return"en"===s.getAppLang()},s.isCurrentContentLangEN=function(){return"en"===s.getContentLangBase()},s.setAppLanguage=async function(e,t){if(p!==e)return t||o.w.saveAppSettings({appLang:e}),p=e||s.getBrowserLang(),(0,r.A)("html").prop("lang",p),await _(),f(p).then((()=>(c.locale=p,g.sort(((e,t)=>e[p].toLowerCase().localeCompare(t[p].toLowerCase()))),Promise.resolve())))},s.setContentLanguage=async function(e,t){let n=h;return h=e||void 0,t||o.w.saveUserSettings({contentLang:h,lastContentLang:n}),f(s.getContentLangBase())},s.getAllLanguages=function(){return JSON.parse(JSON.stringify(g))},s.getAllLangCodes=function(){return s.getAllLanguages().map((e=>e.code))},s.getAppLanguages=function(){return JSON.parse(JSON.stringify(m))},s.getLangReadable=function(e){let t=s.getBaseLang(e),n=g.find((t=>t.code===e)),r=g.find((e=>e.code===t))||{};return n?n[s.getAppLang()]:r[s.getAppLang()]},s.t=function(e,...t){return c.t(e,s.getAppLang(),t)},s.te=function(e){return c.te(e,s.getAppLang())},s.tFallback=function(...e){for(let t of e)if(s.te(t))return s.t(t);return e.length>0?e[e.length-1]:""},s.tl=function(e,t,n){return c.t(e,n,t)},s.tLoad=async function(e){return await f(s.getAppLang()),s.t(e)},s.tPredefined=function(e){let t=v[s.getAppLang()]||{},n=v[u]||{};return t[e]?t[e]:n[e]?n[e]:e},s.getTranslation=function(e,t={}){if(!e)return"";t.lang=t.lang||"";let n=t.forceLang||t.lang||s.getContentLang(),r=t.forceLang||s.getBaseLang(t.lang)||s.getContentLangBase();if(t.fallbackLang=t.fallbackLang||"en","string"==typeof e)return s.t(e);if(e[n])return t.includeLang?{lang:n,text:e[n]}:e[n];if(e[r])return t.includeLang?{lang:r,text:e[r]}:e[r];if(!t.noFallback){if(e[t.fallbackLang])return t.includeLang?{lang:t.fallbackLang,text:`${e[t.fallbackLang]}`}:`${e[t.fallbackLang]}`;let n=Object.keys(e);for(let r of n)if(e[r])return t.includeLang?{lang:r,text:`${e[r]}`}:`${e[r]}`}return t.includeLang?{lang:void 0,text:""}:""},s.getTranslationAppLang=function(e){return s.getTranslation(e,{forceLang:s.getAppLang()})},s.getTranslationObject=function(e,t){let n={};return n[t=t||s.getContentLang()]=e,n},s.getBaseLang=function(e=""){let t=e.search(/[^A-Za-z]/);return-1!==t?e.substring(0,t):e},s.getCountryCode=function(e){let t=e.search(/[^A-Za-z]/);return-1!==t?e.substring(t+1):""},(0,r.A)(document).on(a.A.EVENT_USER_CHANGED,y)},5888:(e,t,n)=>{"use strict";n.r(t),n.d(t,{serviceWorkerService:()=>l});var r=n(7732),i=n(3734),o=n(4041),a=n(5921),s=n(1547);let l={},c="KEY_SHOULD_CACHE_ELEMS",d=o.w.getJSON(c)||[],u=!1,h=0,p=[];function v(){if(0===d.length)return log.info("caching files via service worker finished."),void(0,a.A)(document).trigger(i.A.EVENT_GRID_IMAGES_CACHED);var e;u||(u=!0,d=d.filter((e=>!!e.url)),d[0].type===i.A.SW_CACHE_TYPE_IMG&&(0,a.A)(document).trigger(i.A.EVENT_GRID_IMAGES_CACHING),e={type:i.A.SW_EVENT_REQ_CACHE,cacheType:d[0].type,url:d[0].url},(navigator.serviceWorker?new Promise((e=>{navigator.serviceWorker.controller&&"activated"===navigator.serviceWorker.controller.state?e(navigator.serviceWorker.controller):navigator.serviceWorker.addEventListener("message",(t=>{t.data&&t.data.activated&&e(navigator.serviceWorker.controller)}))})):Promise.resolve(null)).then((t=>{t&&t.postMessage(e)})))}function m(e,t){d.map((e=>e.url)).includes(e)||(d.push({type:t,url:e}),o.w.saveJSON(c,d))}l.cacheUrl=function(e){m(e,i.A.SW_CACHE_TYPE_GENERIC),v()},l.cacheImagesOfGrids=function(e){e=e||[];for(let t of e)if(t.modelName===r.D.getModelName())for(let e of t.gridElements)e.image&&e.image.url&&m(e.image.url,i.A.SW_CACHE_TYPE_IMG);log.info("caching",d.length,"grid images..."),v()},l.addMessageEventListener=function(e){p.includes(e)||p.push(e)},window.serviceWorkerService=l,navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("message",(e=>{for(let t of p)t(e);let t=e.data;if(t.type===i.A.SW_EVENT_URL_CACHED)if(u=!1,t.success||404===t.responseCode||403===t.responseCode)404===t.responseCode&&log.warn("failed to cache url with status: ",t.responseCode,t.url,", not trying again."),h=0,n=t.url,d=d.filter((e=>e.url!==n)),o.w.saveJSON(c,d),v();else{let e=Math.min(5+2*h*h,1800);e=Math.round(e*s.Z.getRandom(1,1.5)),log.warn("failed to cache url: ",t.url,t.responseCode,", next try in seconds: ",e),h++,s.Z.shuffleArray(d),setTimeout((()=>{v()}),1e3*e)}var n})),v())},4843:(e,t,n)=>{"use strict";n.d(t,{X:()=>i});var r=n(9557);function i(){let e=this,t={},n={};function i(e,t){return e?new e(t):t}e.set=function(e,i,o){let a=i instanceof Array&&i.length>1?i[0]:i;"string"==typeof e?i?o&&"function"!=typeof o?r.R.warn("object type has to be a constructor function or empty, aborting."):a&&a.isShortVersion?r.R.debug("not caching model instances only containing short version of data, aborting."):(t[e]=JSON.stringify(i),delete n[e],o&&(n[e]=o)):r.R.warn("cache-values has to be set, aborting."):r.R.warn("cache-key has to be a string, aborting.")},e.get=function(e){if("string"!=typeof e)return void r.R.warn("cache-key has to be a string, aborting.");if(!t[e])return null;let o=JSON.parse(t[e]),a=n[e];return o instanceof Array?o.map((e=>i(a,e))):i(a,o)},e.getAsPromise=function(t){let n=e.get(t);return new Promise((e=>{setTimeout((()=>{e(n)}),1)}))},e.has=function(e){return"string"!=typeof e?(r.R.warn("cache-key has to be a string, aborting."),!1):!!t[e]},e.clear=function(e){e&&(delete t[e],delete n[e])},e.clearAll=function(){t={},n={}}}},3734:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r={ELEMENT_EVENT_ID:"ELEMENT_EVENT_ID",MODEL_VERSION:'{"major": 6, "minor": 0, "patch": 0}',MODEL_VERSION_LOCAL:'{"major": 1, "minor": 0, "patch": 0}',LOCAL_NOLOGIN_USERNAME:"default-user",LOCAL_DEMO_USERNAME:"local-demo-user",LOCAL_DEFAULT_USER_PREFIX:"default-",USERNAME_REGEX:/^[a-z0-9][a-z0-9_-]{2,15}$/,EMOJI_REGEX:/((\p{Regional_Indicator}{2})|((\p{Emoji}(?:\uFE0F|\u200D\p{Emoji})*)\u20E3?))/gu,VALIDATION_ERROR_REGEX:"VALIDATION_ERROR_REGEX",VALIDATION_ERROR_EXISTING:"VALIDATION_ERROR_EXISTING",VALIDATION_ERROR_FAILED:"VALIDATION_ERROR_FAILED",VALIDATION_VALID:"VALIDATION_VALID",EVENT_DB_CONNECTION_LOST:"EVENT_DB_CONNECTION_LOST",EVENT_DB_PULL_UPDATED:"EVENT_DB_PULL_UPDATED",EVENT_DB_SYNC_STATE_CHANGE:"EVENT_DB_SYNC_STATE_CHANGE",EVENT_DB_INITIAL_SYNC_COMPLETE:"EVENT_DB_INITIAL_SYNC_COMPLETE",EVENT_DB_INITIALIZED:"EVENT_DB_INITIALIZED",EVENT_DB_CLOSED:"EVENT_DB_CLOSED",EVENT_DB_DATAMODEL_UPDATE:"EVENT_DB_DATAMODEL_UPDATE",EVENT_GRID_IMAGES_CACHING:"EVENT_GRID_IMAGES_CACHING",EVENT_GRID_IMAGES_CACHED:"EVENT_GRID_IMAGES_CACHED",EVENT_SIDEBAR_OPEN:"event-sidebar-open",EVENT_SIDEBAR_OPENED:"event-sidebar-opened",EVENT_SIDEBAR_CLOSE:"event-sidebar-close",EVENT_UI_LOCKED:"EVENT_UI_LOCKED",EVENT_UI_UNLOCKED:"EVENT_UI_UNLOCKED",EVENT_GRID_RESIZE:"EVENT_GRID_RESIZE",EVENT_GRID_LOADED:"EVENT_GRID_LOADED",EVENT_ELEM_TEXT_CHANGED:"EVENT_ELEM_TEXT_CHANGED",EVENT_USER_CHANGING:"EVENT_USER_CHANGING",EVENT_USER_CHANGED:"EVENT_USER_CHANGED",EVENT_USER_DELETED:"EVENT_USER_DELETED",EVENT_METADATA_UPDATED:"EVENT_METADATA_UPDATED",EVENT_APPSETTINGS_UPDATED:"EVENT_APPSETTINGS_UPDATED",EVENT_USERSETTINGS_UPDATED:"EVENT_USERSETTINGS_UPDATED",EVENT_CONFIG_RESET:"EVENT_CONFIG_RESET",EVENT_NAVIGATE_GRID_IN_VIEWMODE:"EVENT_NAVIGATE_GRID_IN_VIEWMODE",EVENT_NAVIGATE:"EVENT_NAVIGATE",EVENT_MATRIX_SCROLL_UP:"EVENT_MATRIX_SCROLL_UP",EVENT_MATRIX_SCROLL_DOWN:"EVENT_MATRIX_SCROLL_DOWN",EVENT_MATRIX_SET_ROOM:"EVENT_MATRIX_SET_ROOM",EVENT_MATRIX_SENDING_START:"EVENT_MATRIX_SENDING_START",SW_EVENT_ACTIVATED:"SW_EVENT_ACTIVATED",SW_EVENT_URL_CACHED:"SW_EVENT_URL_CACHED",SW_EVENT_REQ_CACHE:"SW_EVENT_REQ_CACHE",SW_MATRIX_REQ_DATA:"SW_MATRIX_REQ_DATA",SW_CACHE_TYPE_IMG:"CACHE_TYPE_IMG",SW_CACHE_TYPE_GENERIC:"CACHE_TYPE_GENERIC",DB_SYNC_STATE_SYNCINC:"DB_SYNC_STATE_SYNCINC",DB_SYNC_STATE_SYNCED:"DB_SYNC_STATE_SYNCED",DB_SYNC_STATE_STOPPED:"DB_SYNC_STATE_STOPPED",DB_SYNC_STATE_FAIL:"DB_SYNC_STATE_FAIL",DB_SYNC_STATE_ONLINEONLY:"DB_SYNC_STATE_ONLINEONLY",ENVIRONMENT:"PROD"};r.IS_ENVIRONMENT_DEV="#ASTERICS_GRID_ENV#"===r.ENVIRONMENT,r.IS_ENVIRONMENT_BETA="BETA"===r.ENVIRONMENT,r.IS_ENVIRONMENT_PROD=!r.IS_ENVIRONMENT_DEV&&!r.IS_ENVIRONMENT_BETA,r.CURRENT_VERSION="release-2025-05-06-11.21/+0200",r.IS_FIREFOX=-1!==navigator.userAgent.indexOf("Firefox"),r.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r.IS_MAC=(navigator.platform||(navigator.userAgentData||{}).platform||"").toUpperCase().includes("MAC"),r.STATE_ACTIVATED_TTS="STATE_ACTIVATED_TTS",r.VOICE_TYPE_NATIVE="VOICE_TYPE_NATIVE",r.VOICE_TYPE_RESPONSIVEVOICE="VOICE_TYPE_RESPONSIVEVOICE",r.VOICE_TYPE_EXTERNAL_PLAYING="VOICE_TYPE_EXTERNAL_PLAYING",r.VOICE_TYPE_EXTERNAL_DATA="VOICE_TYPE_EXTERNAL_DATA",r.VOICE_DEVICE_DEFAULT="VOICE_DEVICE_DEFAULT",r.WEBRADIO_LAST_VOLUME_KEY="WEBRADIO_LAST_VOLUME_KEY",r.GRIDSET_FOLDER="app/gridsets/",r.BOARDS_REPO_BASE_URL="https://asterics.github.io/AsTeRICS-Grid-Boards/",r.BOARD_TYPE_SELFCONTAINED="BOARD_TYPE_SELFCONTAINED",r.BOARD_TYPE_SINGLE="BOARD_TYPE_SINGLE",r.BOARD_TYPES=[r.BOARD_TYPE_SELFCONTAINED,r.BOARD_TYPE_SINGLE],r.PROP_TRANSFER_DONT_CHANGE="PROP_TRANSFER_DONT_CHANGE",r.PROP_TRANSFER_TYPES={BOOLEAN:"BOOLEAN",COLOR:"COLOR",PERCENTAGE:"PERCENTAGE",TEXT:"TEXT",NUMBER:"NUMBER"},r.PROP_TRANSFER_CATEGORIES={APPEARANCE:"APPEARANCE",OTHERS:"OTHERS"},r.TRANSFER_PROPS={COLOR_CATEGORY:{path:"colorCategory",label:"colorCategory",type:r.PROP_TRANSFER_TYPES.TEXT,category:r.PROP_TRANSFER_CATEGORIES.APPEARANCE},BACKGROUND_COLOR:{path:"backgroundColor",label:"customElementColor",type:r.PROP_TRANSFER_TYPES.COLOR,category:r.PROP_TRANSFER_CATEGORIES.APPEARANCE},FONT_COLOR:{path:"fontColor",label:"fontColor",type:r.PROP_TRANSFER_TYPES.COLOR,category:r.PROP_TRANSFER_CATEGORIES.APPEARANCE},FONT_SIZE:{path:"fontSizePct",label:"fontSize",type:r.PROP_TRANSFER_TYPES.PERCENTAGE,category:r.PROP_TRANSFER_CATEGORIES.APPEARANCE},HIDDEN:{path:"hidden",label:"hideElement",type:r.PROP_TRANSFER_TYPES.BOOLEAN,category:r.PROP_TRANSFER_CATEGORIES.OTHERS},LANGUAGE_LEVEL:{path:"vocabularyLevel",label:"vocabularyLevel",type:r.PROP_TRANSFER_TYPES.NUMBER,category:r.PROP_TRANSFER_CATEGORIES.OTHERS},DONT_COLLECT:{path:"dontCollect",label:"dontAddElementToCollectElement",type:r.PROP_TRANSFER_TYPES.BOOLEAN,category:r.PROP_TRANSFER_CATEGORIES.OTHERS},TOGGLE_IN_BAR:{path:"toggleInBar",label:"toggleInCollectionElementIfAddedMultipleTimes",type:r.PROP_TRANSFER_TYPES.BOOLEAN,category:r.PROP_TRANSFER_CATEGORIES.OTHERS}},r.DEFAULT_ELEMENT_BACKGROUND_COLOR="#ffffff",r.DEFAULT_ELEMENT_BACKGROUND_COLOR_DARK="#555555",r.DEFAULT_COLLECT_ELEMENT_BACKGROUND_COLOR="#E8E8E8",r.DEFAULT_COLLECT_ELEMENT_BACKGROUND_COLOR_DARK="#757575",r.DEFAULT_ELEMENT_BORDER_COLOR="#808080",r.DEFAULT_ELEMENT_FONT_COLOR="#000000",r.DEFAULT_ELEMENT_FONT_COLOR_DARK="#ffffff",r.DEFAULT_GRID_BACKGROUND_COLOR="#e8e8e8",r.DEFAULT_GRID_BACKGROUND_COLOR_DARK="#000000",r.COLOR_SCHEME_FITZGERALD_PREFIX="CS_MODIFIED_FITZGERALD_KEY",r.COLOR_SCHEME_GOOSENS_PREFIX="CS_GOOSENS",r.COLOR_SCHEME_FITZGERALD_LIGHT="CS_MODIFIED_FITZGERALD_KEY_LIGHT",r.COLOR_SCHEME_FITZGERALD_MEDIUM="CS_MODIFIED_FITZGERALD_KEY_MEDIUM",r.COLOR_SCHEME_FITZGERALD_DARK="CS_MODIFIED_FITZGERALD_KEY_DARK",r.COLOR_SCHEME_GOOSENS_LIGHT="CS_GOOSENS_LIGHT",r.COLOR_SCHEME_GOOSENS_MEDIUM="CS_GOOSENS_MEDIUM",r.COLOR_SCHEME_GOOSENS_DARK="CS_GOOSENS_DARK",r.DEFAULT_COLOR_SCHEMES=[{name:r.COLOR_SCHEME_FITZGERALD_LIGHT,categories:["CC_PRONOUN_PERSON_NAME","CC_NOUN","CC_VERB","CC_DESCRIPTOR","CC_SOCIAL_EXPRESSIONS","CC_MISC","CC_PLACE","CC_CATEGORY","CC_IMPORTANT","CC_OTHERS"],colors:["#fdfd96","#ffda89","#c7f3c7","#84b6f4","#fdcae1","#ffffff","#bc98f3","#d8af97","#ff9688","#bdbfbf"]},{name:r.COLOR_SCHEME_FITZGERALD_MEDIUM,categories:["CC_PRONOUN_PERSON_NAME","CC_NOUN","CC_VERB","CC_DESCRIPTOR","CC_SOCIAL_EXPRESSIONS","CC_MISC","CC_PLACE","CC_CATEGORY","CC_IMPORTANT","CC_OTHERS"],colors:["#ffff6b","#ffb56b","#b5ff6b","#6bb5ff","#ff6bff","#ffffff","#ce6bff","#bd754e","#ff704d","#a3a3a3"]},{name:r.COLOR_SCHEME_FITZGERALD_DARK,categories:["CC_PRONOUN_PERSON_NAME","CC_NOUN","CC_VERB","CC_DESCRIPTOR","CC_SOCIAL_EXPRESSIONS","CC_MISC","CC_PLACE","CC_CATEGORY","CC_IMPORTANT","CC_OTHERS"],colors:["#79791F","#804c26","#4c8026","#264c80","#802680","#808080","#602680","#52331f","#80261a","#4d4d4d"]},{name:r.COLOR_SCHEME_GOOSENS_LIGHT,categories:["CC_VERB","CC_DESCRIPTOR","CC_PREPOSITION","CC_NOUN","CC_QUESTION_NEGATION_PRONOUN"],colors:["#fdcae1","#84b6f4","#c7f3c7","#fdfd96","#ffda89"]},{name:r.COLOR_SCHEME_GOOSENS_MEDIUM,categories:["CC_VERB","CC_DESCRIPTOR","CC_PREPOSITION","CC_NOUN","CC_QUESTION_NEGATION_PRONOUN"],colors:["#ff6bff","#6bb5ff","#b5ff6b","#ffff6b","#ffb56b"]},{name:r.COLOR_SCHEME_GOOSENS_DARK,categories:["CC_VERB","CC_DESCRIPTOR","CC_PREPOSITION","CC_NOUN","CC_QUESTION_NEGATION_PRONOUN"],colors:["#802680","#264c80","#4c8026","#79791F","#804c26"]}],r.OPTION_TYPES={BOOLEAN:"BOOLEAN",COLOR:"COLOR",SELECT:"SELECT",SELECT_COLORS:"SELECT_COLORS"},r.ARASAAC_AUTHOR="ARASAAC - CC (BY-NC-SA)",r.ARASAAC_LICENSE_URL="https://arasaac.org/terms-of-use",r.WORDFORM_TAG_BASE="BASE",r.WORDFORM_TAGS=[r.WORDFORM_TAG_BASE,"NEGATION","SINGULAR","PLURAL","1.PERS","2.PERS","3.PERS","1.CASE","2.CASE","3.CASE","4.CASE","5.CASE","6.CASE","FEMININE","MASCULINE","NEUTRAL","COMPARATIVE","SUPERLATIVE","PRESENT","PAST","FUTURE","INDEFINITE","DEFINITE"]},2867:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});let r={},i="_removed_",o=["thumbnail"];function a(e,t,n){if(!e)return e;if("string"==typeof e||e instanceof String){if(e.length>t)return n}else if(e instanceof Array)for(let r=0;r<e.length;r++)e[r]=a(e[r],t,n);else Object.keys(e).forEach((r=>{-1===o.indexOf(r)&&(e[r]=a(e[r],t,n))}));return e}r.removeLongPropertyValues=function(e,t,n){if(!e)return e;n=void 0===n?i:n,t=t||500;let r=JSON.parse(JSON.stringify(e));return Object.keys(r).forEach((e=>{-1===o.indexOf(e)&&(r[e]=a(r[e],t,n))})),r},r.getDefaultRemovedPlaceholder=function(){return i},r.removeDatabaseProperties=function(e,t){if(e){e=e instanceof Array?e:[e];for(let n of e)delete n._id,delete n._rev,t&&delete n.id}}},8923:(e,t,n)=>{"use strict";n.d(t,{b:()=>m});var r=n(4962),i=n(1964),o=n(3313),a=n(2649),s=n(367),l=n(4666),c=n(7732),d=n(1540),u=n(3734),h=n(3952),p=n(8033),v=n(518);let m={},g="NAVIGATION_ID_TO_LAST";function f(e,t){t=t||[];let n=[];return e.children.forEach((e=>{-1===t.indexOf(e)&&(t.push(e),n.push(e))})),n.forEach((e=>{t=f(e,t)})),t}function y(e){return e.gridElements.reduce(((e,t)=>e.concat(t.actions.filter((e=>e.modelName===s.g.getModelName())))),[]).map((e=>e.navType===s.g.NAV_TYPES.TO_LAST?g:e.navType===s.g.NAV_TYPES.TO_GRID?e.toGridId:null)).filter((e=>!!e))}function _(e){let t=e.gridElements?e.gridElements:e;return t&&0!==t.length?t:[]}m.regenerateIDs=function(e){let t={},n=[];return e.forEach((e=>{let n=r.S.generateId("grid-data");t[e.id]=n,e._id=e.id=n,e._rev=null})),e.forEach((e=>{let r=JSON.stringify(e);Object.keys(t).forEach((e=>{r=r.replace(new RegExp(e,"g"),t[e])})),n.push(JSON.parse(r))})),{grids:n,idMapping:t}},m.sortGridElements=function(e){return e?e.sort(((e,t)=>e.y!==t.y?e.y-t.y:e.x-t.x)):e},m.generateGlobalGrid=function(e,t){(t=t||{}).convertToLowercase=void 0!==t.convertToLowercase&&t.convertToLowercase;let n=new i.V({width:1,height:1,x:0,y:0,image:new a.q({author:u.A.ARASAAC_AUTHOR,authorURL:u.A.ARASAAC_LICENSE_URL,url:"https://api.arasaac.org/api/pictograms/38222?download=false&plural=false&color=true"}),actions:[new s.g({navType:s.g.NAV_TYPES.TO_HOME})]}),r=new i.V({width:1,height:1,x:1,y:0,image:new a.q({author:u.A.ARASAAC_AUTHOR,authorURL:u.A.ARASAAC_LICENSE_URL,url:"https://api.arasaac.org/api/pictograms/38249?download=false&plural=false&color=true"}),actions:[new s.g({navType:s.g.NAV_TYPES.TO_LAST})]}),h=new d.$({width:10,height:1,x:2,y:0,convertToLowercase:t.convertToLowercase}),p=new i.V({width:1,height:1,x:2+h.width,y:0,image:new a.q({author:u.A.ARASAAC_AUTHOR,authorURL:u.A.ARASAAC_LICENSE_URL,url:"https://api.arasaac.org/api/pictograms/38221?download=false&plural=false&color=true"}),actions:[new l.z({action:l.z.COLLECT_ACTION_SPEAK_CONTINUOUS})]}),v=new i.V({width:1,height:1,x:3+h.width,y:0,image:new a.q({author:u.A.ARASAAC_AUTHOR,authorURL:u.A.ARASAAC_LICENSE_URL,url:"https://api.arasaac.org/api/pictograms/38200?download=false&plural=false&color=true"}),actions:[new l.z({action:l.z.COLLECT_ACTION_REMOVE_WORD})]}),m=new i.V({width:1,height:1,x:4+h.width,y:0,image:new a.q({author:u.A.ARASAAC_AUTHOR,authorURL:u.A.ARASAAC_LICENSE_URL,url:"https://api.arasaac.org/api/pictograms/38202?download=false&plural=false&color=true"}),actions:[new l.z({action:l.z.COLLECT_ACTION_CLEAR})]});return new c.D({label:o.A.getTranslationObject(o.A.t("globalGrid"),e),gridElements:[n,r,h,p,v,m],rowCount:3})},m.getOffset=function(e){let t=JSON.parse(JSON.stringify(e.gridElements)),n=[],r=1e5;for(let e=0;e<10;e++)for(let i=0;i<10&&!(e+i>=r);i++){let o=t.reduce(((t,n)=>t&&(i>=n.y+n.height||e>=n.x+n.width)),!0);o&&(r=e+i),n.push({x:e,y:i,sum:e+i,valid:o})}let i=n.filter((e=>r===e.sum&&e.valid))[0];return i?{x:i.x,y:i.y}:{x:m.getWidth(e),y:m.getHeight(e)}},m.getFreeCoordinates=function(e){let t=new c.D({},e),n={};for(let e=0;e<t.getHeightWithBounds();e++)for(let r=0;r<t.getWidthWithBounds();r++)n[r+" "+e]={x:r,y:e};return t.gridElements.forEach((e=>{for(let t=e.x;t<e.width+e.x;t++)for(let r=e.y;r<e.height+e.y;r++)delete n[t+" "+r]})),Object.keys(n).map((e=>({x:n[e].x,y:n[e].y})))},m.getFillElements=function(e){return m.getFreeCoordinates(e).map((e=>new i.V({x:e.x,y:e.y})))},m.updateOrAddGridElement=function(e,t){t=JSON.parse(JSON.stringify(t));let n=(e=JSON.parse(JSON.stringify(e))).gridElements.map((e=>e.id)).indexOf(t.id);return-1!==n?e.gridElements[n]=t:e.gridElements.push(t),e},m.getGraphList=function(e,t,n){e=e.filter((e=>e.id!==t));let r=[],i={},a={};for(let t of e)a[t.id]=y(t);return e.forEach((t=>{let n=e.filter((e=>a[e.id].includes(t.id))),o=e.filter((e=>-1!==a[t.id].indexOf(e.id)));1===n.length&&-1!==a[t.id].indexOf(g)&&o.push(n[0]);let s={grid:t,parents:n,children:o,navCount:n.length+o.length};r.push(s),i[t.id]=s})),n?r.sort(((e,t)=>o.A.getTranslation(e.grid.label).localeCompare(o.A.getTranslation(t.grid.label)))):r.sort(((e,t)=>t.navCount-e.navCount)),r.forEach((e=>{e.parents=e.parents.map((e=>i[e.id])),e.children=e.children.map((e=>i[e.id])),e.allRelatives=e.children.concat(e.parents.filter((t=>-1===e.children.indexOf(t))))})),r},m.getAllPaths=function(e,t,n,r={}){if(!e)return[];if(t=t||[],(n=n||[]).includes(e)){t.push(n);let e=n[n.length-1].grid.id;return r[e]=r[e]?r[e]+1:1,t}if(n.push(e),0===e.children.length){t.push(n);let e=n[n.length-1].grid.id;return r[e]=r[e]?r[e]+1:1,t}if(r[n[n.length-1].grid.id]>3)return t;for(let i of e.children)m.getAllPaths(i,t,n.concat([]),r);return t},m.getIdPathMap=function(e){let t=m.getAllPaths(e),n={};for(let e of t)for(let t=0;t<e.length;t++){let r=e[t];(!n[r.grid.id]||n[r.grid.id].length>t+1)&&(n[r.grid.id]=e.slice(0,t+1))}return n},m.getGridPath=function(e,t,n,r){if(!(e&&e.length&&t&&n))return[];let i;i=e[0].children?e:m.getGraphList(e);let o=i.filter((e=>e.grid.id===t))[0];if(!o)return[];if(t===n)return[o.grid];let a=(r=r||m.getIdPathMap(o))[n]?r[n]:null,l=a?a.map((e=>e.grid)):[];if(l=JSON.parse(JSON.stringify(l)),l&&l.length>1)for(let e=0;e<l.length-1;e++){let t=l[e+1].id;for(let n of l[e].gridElements)for(let r of n.actions)if(r.modelName===s.g.getModelName()&&r.navType===s.g.NAV_TYPES.TO_GRID&&r.toGridId===t){l[e].toNextElementId=n.id,l[e].toNextElementLabel=n.label;break}}return l},m.getAllChildrenRecursive=function(e,t){let n=function(e,t){return f(e.filter((e=>e.grid.id===t))[0]).map((e=>e.grid))}(e,t);return n.filter((e=>e.id!==t))},m.getGridsContentLang=function(e,t){if(!e||!e.length)return t;let n=e.reduce(((e,t)=>{let n=m.getGridLangs(t);return e.concat(n)}),[]);return n.includes(t)?t:n[0]},m.getGridLangs=function(e){if(!e||!e.gridElements||!e.gridElements.length)return[];let t=e.gridElements.reduce(((e,t)=>{let n=Object.keys(t.label).filter((e=>!!t.label[e]));return e.concat(n)}),[]);return new Array(...new Set(t))},m.getGridsLangs=function(e){let t=[];for(let n of e)t=t.concat(m.getGridLangs(n));return new Array(...new Set(t))},m.getActionsOfType=function(e,t){let n=e?e.actions:null;return n?n.filter((e=>e.modelName===t)):[]},m.mergeGrids=function(e,t,n={}){if(e&&t&&t.gridElements&&t.gridElements.length>0){t=JSON.parse(JSON.stringify(t)),e=n.noDeepCopy?e:JSON.parse(JSON.stringify(e));let r=!0,i=n.globalGridHeightPercentage?n.globalGridHeightPercentage/100:.15,o=1,a=1;1===m.getHeight(t)&&(a=i*e.rowCount/(1-i),o=1/(e.rowCount*i)-1/e.rowCount,a=Math.round(100*i),o=Math.round((1-i)/e.rowCount*100));let s=m.getOffset(t),l=r?m.getWidth(t)-s.x:1,c=r?m.getWidthWithBounds(e):1;t.gridElements.forEach((e=>{e.width*=c,e.x*=c,0===e.y&&(e.height*=a)})),e.gridElements.forEach((e=>{e.width*=l,e.x*=l,e.x+=s.x*c,e.y=s.y*a+e.y*o,e.height*=o})),e.rowCount*=o,e.rowCount+=s.y*a,e.gridElements=t.gridElements.concat(e.gridElements)}return e},m.getAREFirstAction=function(e){let t=[];return e.gridElements.forEach((e=>{t=t.concat(e.actions)})),t.filter((e=>e.modelName===h.h.getModelName()))[0]},m.getAREModel=function(e){let t=m.getAREFirstAction(e);return t?e.additionalFiles.filter((e=>e.fileName===t.areModelGridFileName))[0]:null},m.getAREURL=function(e){let t=m.getAREFirstAction(e);return t?t.areURL:null},m.hasAREModel=function(e){return!!m.getAREModel(e)},m.hasOutdatedThumbnail=function(e){return!e.thumbnail||!e.thumbnail.data||e.thumbnail.hash!==m.getHash(e)},m.getHash=function(e){let t="";return e.gridElements.forEach((e=>{if(t+=JSON.stringify(e.label)+e.x+e.y,e.image&&(e.image.data||e.image.url)){let n=e.image.data||e.image.url;t+=n.substring(n.length>30?n.length-30:0)}})),p.H.getStringHash(t)},m.getWidth=function(e){let t=_(e);return v.f.getWidth(t)},m.getHeight=function(e){let t=_(e);return v.f.getHeight(t)},m.getWidthWithBounds=function(e){return Math.max(m.getWidth(e),e.minColumnCount?e.minColumnCount:0)},m.getHeightWithBounds=function(e){return Math.max(m.getHeight(e),e.rowCount?e.rowCount:0)},m.ensureDefaults=function(e){for(let t of Object.keys(c.D.DEFAULTS))e[t]=void 0===e[t]?c.D.DEFAULTS[t]:e[t];for(let t of Object.keys(i.V.DEFAULTS))for(let n of e.gridElements)n[t]=void 0===n[t]?i.V.DEFAULTS[t]:n[t];return e},m.duplicateElement=function(e){let t=JSON.parse(JSON.stringify(e));return t.id=r.S.generateId(i.V.ID_PREFIX),t.actions=t.actions||[],t.actions=t.actions.filter((e=>e.modelName!==s.g.getModelName())),t},m.duplicateElements=function(e=[]){return e.map((e=>m.duplicateElement(e)))},m.ensureUniqueIds=function(e){let t=[];for(let n of e)t.includes(n.id)&&(n.id=(new i.V).id),t.push(n.id)},m.getOneElementSize=function(e,t){let n=m.getWidthWithBounds(t),r=m.getHeightWithBounds(t);return{width:e.width/n,height:e.height/r}},m.isWithinElements=function(e,t,n){if(!e||!t||!n)return!1;const r=Math.min(e.x,t.x),i=Math.max(e.x,t.x),o=Math.min(e.y,t.y),a=Math.max(e.y,t.y);return n.x>=r&&n.x<=i&&n.y>=o&&n.y<=a},m.getAllPropTransferPaths=function(){return Object.keys(u.A.TRANSFER_PROPS).map((e=>u.A.TRANSFER_PROPS[e].path))},m.getPropTransferObjectBase=function(){let e={};for(let t of m.getAllPropTransferPaths())e[t]=u.A.PROP_TRANSFER_DONT_CHANGE;return e},m.getPropTransferObjectAll=function(e){let t={};for(let n of m.getAllPropTransferPaths())t[n]=e[n];return t},m.getPropTransferObjectAppearance=function(e){let t=Object.keys(u.A.TRANSFER_PROPS).map((e=>u.A.TRANSFER_PROPS[e])).filter((e=>e.category===u.A.PROP_TRANSFER_CATEGORIES.APPEARANCE)),n=m.getPropTransferObjectBase();for(let r of t)n[r.path]=e[r.path];return n},m.getCursorType=function(e,t="default"){return e&&e.inputConfig&&e.inputConfig.hoverEnabled&&e.inputConfig.hoverHideCursor?"none":t}},7410:(e,t,n)=>{"use strict";n.d(t,{M:()=>r});var r={};function i(e){try{let t=parseInt(e.documentElement.width.baseVal.value)||500,n=parseInt(e.documentElement.height.baseVal.value)||500;return e.documentElement.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,t),e.documentElement.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,n),e}catch(t){return e}}function o(e){try{return s(parseInt(e.documentElement.width.baseVal.value)||500,parseInt(e.documentElement.height.baseVal.value)||500)}catch(e){return s(0,0)}}function a(e){try{return"data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(e))}catch(e){return null}}function s(e,t){return{width:e,height:t,ratio:e/t}}r.getBase64FromImg=function(e,t,n,r){t=t||150,r=(r=(r=(r=r||0===e.src.indexOf("data:")?e.src.substring(5,e.src.indexOf(";")):null)||(e.src.indexOf(".png")>-1?"image/png":null))||(e.src.indexOf(".svg")>-1?"image/svg+xml":null))||"image/jpeg";var i=document.createElement("canvas"),o=1;e.width>t&&(o=t/e.width),i.width=e.width*o,i.height=e.height*o,i.getContext("2d").drawImage(e,0,0,i.width,i.height);try{return{data:i.toDataURL(r,n),dim:s(i.width,i.height)}}catch(e){throw"image converting failed!"}},r.dataStringToFileSuffix=function(e=""){return e.startsWith("data:image/png")?"png":e.startsWith("data:image/svg")?"svg":e.startsWith("data:image/jpeg")?"jpg":""},r.mimeTypeToFileSuffix=function(e){return{"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/bmp":"bmp","image/svg+xml":"svg","image/svg":"svg"}[e]||""},r.getBase64FromInput=function(e){return new Promise((t=>{if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e.files[0])}}))},r.convertBase64=function(e,t,n){return new Promise(((i,o)=>{if(!e)return i(null);if("image/svg+xml"===e.substring(5,e.indexOf(";")))return i(e);t=t||150;var a=document.createElement("img");a.onload=function(){try{i(r.getBase64FromImg(a,t,n).data)}catch(e){i(null)}},a.src=e}))},r.base64SvgToBase64Png=function(e,t,n){return e?new Promise((o=>{let s=document.createElement("img");s.onload=function(){if(!n&&(0===s.naturalWidth||0===s.naturalHeight)){let n=i(function(e){let t=atob(r.dataStringToBase64(e));return t=t.substring(t.indexOf("<svg")),(new DOMParser).parseFromString(t,"image/svg+xml")}(e));return r.base64SvgToBase64Png(a(n),t,!0).then((e=>{o(e)}))}let l=r.getImageDimensionsFromImg(s).ratio||1,c=document.createElement("canvas");c.width=t,c.height=t/l,c.getContext("2d").drawImage(s,0,0,c.width,c.height);try{let e=c.toDataURL("image/png");o(e)}catch(e){o(null)}},s.src=e})):Promise.resolve(null)},r.urlToBase64WithDimensions=function(e,t,n){return t=t||500,new Promise(((s,l)=>{if(e.lastIndexOf(".svg")===e.length-4)$.get(e,null,(function(e){let t=i(e);s({data:a(t),dim:o(t)})})).fail((function(){s(null)}));else{let i=new Image;i.crossOrigin="anonymous",i.onload=function(){try{s(r.getBase64FromImg(i,t,void 0,n))}catch(e){s(null)}},i.onerror=function(){s(null)},i.src=e}}))},r.urlToBase64=function(e,t,n){return r.urlToBase64WithDimensions(e,t,n).then((e=>Promise.resolve(e?e.data:null)))},r.getScreenshot=function(e,t={}){let i=document.querySelector(e);return i?n.e(526).then(n.t.bind(n,354,23)).then((n=>n.default(i,{scale:t.scale||.2,logging:!1,useCORS:!0,ignoreElements:e=>t.ignoreSVG&&(-1!==e.style["background-image"].indexOf("image/svg")||e.src&&e.src.endsWith(".svg"))}).then((n=>{try{let e=t.mimeType||"image/webp";return t.returnCanvas?n:n.toDataURL(e,t.quality||.6)}catch(n){return log.warn("error while creating screenshot"),log.warn(n),t.ignoreSVG?Promise.resolve(r.getEmptyImage()):r.getScreenshot(e,{ignoreSVG:!0})}})))):null},r.canvasToBlob=function(e){return new Promise((t=>{e.toBlob((e=>t(e)))}))},r.getEmptyImage=function(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},r.getImageDimensionsFromDataUrl=function(e){return e?new Promise((t=>{let n=new Image;n.onload=function(){t(r.getImageDimensionsFromImg(n))},n.src=e})):Promise.resolve({})},r.getImageDimensionsFromImg=function(e){if(!e)return{};let t=e.naturalWidth,n=e.naturalHeight;return 0!==t&&0!==n||(document.body.appendChild(e),t=e.clientWidth,n=e.clientHeight,document.body.removeChild(e)),{width:t,height:n,ratio:t/n}},r.allImagesLoaded=function(){return Promise.all(Array.from(document.images).map((e=>e.complete?Promise.resolve(0!==e.naturalHeight):new Promise((t=>{e.addEventListener("load",(()=>t(!0))),e.addEventListener("error",(e=>t(!1))),setTimeout((()=>{t(!1)}),2e3)}))))).then((e=>e.every((e=>e))?Promise.resolve(!0):Promise.resolve(!1)))},r.dataStringToBase64=function(e=""){return e.substring(e.indexOf("base64,")+7)}},9557:(e,t,n)=>{"use strict";n.d(t,{R:()=>r});let r=window.log},4962:(e,t,n)=>{"use strict";n.d(t,{S:()=>i});var r=n(3734),i={},o=100;let a=JSON.parse(r.A.MODEL_VERSION),s=JSON.parse(r.A.MODEL_VERSION),l={major:null,minor:null,patch:null};i.generateId=function(e){return(e=e||"id")+"-"+(new Date).getTime()+"-"+o++},i.getAsObject=function(e){return"string"==typeof e?JSON.parse(e):e},i.getNewName=function(e,t){for(var n=1,r=e;t.includes(r);)r=e+" ("+n+")",n++;return r},i.setDefaults=function(e,t,n){if(t&&e&&n&&n.definition){var r=Object.keys(n.definition);Object.keys(t).forEach((function(n){r.includes(n)&&void 0===e[n]&&(e[n]=t[n])}))}return e},i.hashCode=function(e){e=e||{};var t=JSON.parse(JSON.stringify(e));return delete t._rev,delete t._id,delete t.id,JSON.stringify(t).split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)|0),0)},i.getModelVersionString=function(){return r.A.MODEL_VERSION},i.getModelVersionObject=function(e){if(!e)return l;let t=JSON.parse(e);return t.major&&(t.major=parseInt(t.major),t.minor=parseInt(t.minor),t.patch=parseInt(t.patch)),t.major?t:l},i.getLatestModelVersion=function(){return a},i.getLatestModelVersionLocal=function(){return s},i.convertObjects=function(e,t,n){if(!e||!t)return e;let r=e instanceof Array;e=r?e:[e];for(let r=0;r<e.length;r++)t(i.getModelVersionObject(e[r].modelVersion)).forEach((t=>{e[r]=t(e[r],n)}));return r?e:e[0]}},1547:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4519),i=n(1964),o=n(3734),a=n(7410);let s={},l={},c={},d="";s.DEFAULT_KEY="DEFAULT_KEY",s.DEFAULT_KEY2="DEFAULT_KEY2",s.debounce=function(e,t,n){n=n||s.DEFAULT_KEY,e||t?(l[n]&&clearTimeout(l[n]),l[n]=setTimeout((function(){e()}),t)):log.warn("called util.debounce() without needed parameters. aborting.")},s.clearDebounce=function(e){e=e||s.DEFAULT_KEY,l[e]&&clearTimeout(l[e])},s.throttle=function(e,t,n,r){if(!e||!e.apply)return;n=n||500;let i=r||e,o=c[i];(!o||(new Date).getTime()-o>n)&&(e.apply(null,t),c[i]=(new Date).getTime())},s.copyToClipboard=function(e){let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";log.debug("Copying text command was "+n)}catch(e){log.warn("Unable to copy to clipboard.")}d=e,document.body.removeChild(t)},s.appendToClipboard=function(e){s.copyToClipboard(d+e)},s.copyBlobToClipboard=async function(e){if("undefined"==typeof ClipboardItem||!navigator.clipboard||"function"!=typeof navigator.clipboard.write)return void log.warn("copy blob to clipboard is not supported");if(!e)return;const t=new ClipboardItem({[e.type]:e});try{await navigator.clipboard.write([t])}catch(e){log.warn("failed to copy blob to clipboard:",e)}},s.copyCollectContentToClipboard=async function(){let e=await s.getCollectContentBlob(5);await s.copyBlobToClipboard(e)},s.getCollectContentBlob=async function(e=2){let t=await a.M.getScreenshot(".collect-items-container",{scale:e,returnCanvas:!0});return t?await a.M.canvasToBlob(t):null},s.shareImageBlob=async function(e,t="image"){if(!navigator.share||!navigator.canShare)return void log.warn("sharing not supported!");if(!e)return;let n=new File([e],`${t}.${a.M.mimeTypeToFileSuffix(e.type)}`,{type:e.type});navigator.canShare({files:[n]})?await navigator.share({files:[n]}):log.warn("sharing files not supported!")},s.getClipboardContent=async function(){return navigator.clipboard?navigator.clipboard.readText().then((e=>Promise.resolve(e))).catch((e=>(log.warn("failed to read clipboard."),Promise.resolve(null)))):d},s.gridElementsToClipboard=function(e){e&&e.length&&s.copyToClipboard(JSON.stringify(e))},s.gridElementToClipboard=function(e){s.gridElementsToClipboard([e])},s.getGridElementsFromClipboard=async function(){let e=await s.getClipboardContent(),t=[];try{t=JSON.parse(e),t=t instanceof Array?t:[],t=t.filter((e=>e.id&&e.modelName===i.V.getModelName()))}catch(e){}return t=t.map((e=>(e.id=(new i.V).id,e))),t},s.getElement=function(e,t,n){let r=document.elementsFromPoint(t,n),i=null;return r.forEach((t=>{i=i||function(e,t){for(let n=0;e&&-1===t.indexOf(e)&&n<100;n++)e=e.parentElement;return e}(t,e)})),i},s.splitInChunks=function(e,t){let n=[];for(let r=0,i=e.length;r<i;r+=t)n.push(e.slice(r,r+t));return n},s.openFullscreen=function(){let e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?document.documentElement:document.body,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen;t&&t.call(e)},s.closeFullscreen=function(){if(!document.fullscreenElement)return;let e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document)},s.getRGB=function(e){return e&&"#"===e[0]?s.hexToRGB(e):e&&0===e.indexOf("rgb")?s.cssRGBToRGB(e):null},s.hexToRGB=function(e){if(!e)return null;let t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,r)=>"#"+t+t+n+n+r+r)).substring(1).match(/.{2}/g).map((e=>parseInt(e,16)));return t.some(isNaN)?null:t},s.cssRGBToRGB=function(e){if(!e)return null;let t=e.match(/[0-9.]+/gi).map((e=>parseInt(e)));return t[0]&&t[1]&&t[2]?t:null},s.sleep=function(e){return new Promise((t=>setTimeout(t,e)))},s.isString=function(e){return"string"==typeof e||e instanceof String},s.convertLowerUppercase=function(e,t){return t&&e?t===r.a.CONVERT_MODE_LOWERCASE?e.toLowerCase():t===r.a.CONVERT_MODE_UPPERCASE?e.toUpperCase():void 0:e},s.getCurrentDateTimeString=function(){let e=new Date,t=e=>`0${e}`.slice(-2);return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}_${t(e.getHours())}-${t(e.getMinutes())}`},s.arrayBufferToBase64=function(e){let t="",n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)},s.stringToBase64=function(e){return s.bytesToBase64((new TextEncoder).encode(e))},s.base64ToString=function(e){return(new TextDecoder).decode(s.base64ToBytes(e))},s.base64ToBytes=function(e){const t=window.atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)))},s.bytesToBase64=function(e){const t=String.fromCodePoint(...e);return window.btoa(t)},s.arrayToPrintable=function(e){return JSON.stringify(e).replaceAll("[","").replaceAll("]","").replaceAll('"',"")},s.mapRange=function(e,t,n,r,i){return(e-t)*(i-r)/(n-t)+r},s.fetchWithTimeout=function(e,t){const n=new AbortController;return setTimeout((()=>n.abort()),t),fetch(e,{signal:n.signal})},s.getRandom=function(e,t){return Math.random()*(t-e)+e},s.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},s.deduplicateArray=function(e){return[...new Set(e)]},s.shuffleArray=function(e){let t=e.length;for(;0!==t;){let n=Math.floor(Math.random()*t);t--,[e[t],e[n]]=[e[n],e[t]]}return e},s.getElementSize=async function(e){return window.IntersectionObserver?new Promise((t=>{const n=new IntersectionObserver((e=>{for(const n of e)t(n.boundingClientRect);n.disconnect()}));n.observe(e)})):e.getBoundingClientRect()},s.replaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},s.isSameDate=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},s.getEmojis=function(e){return e.match(new RegExp(o.A.EMOJI_REGEX))||[]},s.isOnlyEmojis=function(e){return s.getEmojis(e).join("")===e}},518:(e,t,n)=>{"use strict";n.d(t,{f:()=>r});let r={};function i(e,t={}){let n=function(e,t){let n=[];for(let r=0;r<e;r++){let e=new Array(t).fill(0);n.push(e)}return n}(r.getWidth(e,t.gridWidth),r.getHeight(e,t.gridHeight));for(let t of e)for(let e=t.x;e<t.x+t.width;e++)for(let r=t.y;r<t.y+t.height;r++)n[e][r]++;return n}function o(e,t,n){return!(!e[t]||!e[t][n])}function a(e){let t=i(e),n=0;for(let e=0;e<t.length;e++)n=Math.max(n,Math.max.apply(null,t[e]));return n>1}function s(e,t){return e.filter((e=>e.id!==t.id&&a([e,t])))}function l(e,t){return s(e,t).every((e=>function(e,t){return e.width>=t.width&&e.height>=t.height&&e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height}(t,e)))}function c(e,t,n){e.sort(((e,r)=>0!==t?t*(r.x-e.x):n*(r.y-e.y)))}function d(e,t){return t?e:Array.isArray(e)?e.map((e=>u(e))):u(e)}function u(e={}){return Object.assign({},e)}r.DIR_UP=1,r.DIR_RIGHT=2,r.DIR_DOWN=3,r.DIR_LEFT=4,r.DIRECTIONS_ALL=[r.DIR_UP,r.DIR_RIGHT,r.DIR_DOWN,r.DIR_LEFT],r.MAX_GRID_SIZE=100,r.getWidth=function(e,t=0){if(0===e.length)return 0;let n=Math.max.apply(null,e.map((e=>e.x+e.width)));return Math.max(n,t)},r.getHeight=function(e,t=0){if(0===e.length)return 0;let n=Math.max.apply(null,e.map((e=>e.y+e.height)));return Math.max(n,t)},r.insertDuplicate=function(e,t,n,i={}){return e=d(e,i.dontCopy),r.isFreeSpace(e,t.x+t.width,t.y,t.width,t.height,i)?(n.x=t.x+t.width,e.push(n)):r.isFreeSpace(e,t.x,t.y+t.height,t.width,t.height,i)?(n.y=t.y+t.height,e.push(n)):r.isFreeSpace(e,t.x-t.width,t.y,t.width,t.height,i)?(n.x=t.x-t.width,e.push(n)):r.isFreeSpace(e,t.x,t.y-t.height,t.width,t.height,i)?(n.y=t.y-t.height,e.push(n)):(e.push(n),i.dontCopy=!0,e=r.resolveCollisions(e,t,i)),e},r.moveElements=function(e,t={}){e=e||[],t.moveX=t.moveX||0,t.moveY=t.moveY||0,t.startX=t.startX||0,t.startY=t.startY||0,t.moveElements=t.moveElements||e.filter((e=>e.x>=t.startX&&e.y>=t.startY)),c(t.moveElements,t.moveX,t.moveY);for(let n of t.moveElements)r.isFreeSpace(e,n.x+t.moveX,n.y+t.moveY,n.width,n.height,{outOfBounds:!0})&&(n.x+=t.moveX,n.y+=t.moveY);return t.moveElements},r.moveAsPossible=function(e=[],t=[],n,i={}){if(i.dontCopy||(e=d(e),t=t.map((t=>e.find((e=>e.id===t.id))))),!r.DIRECTIONS_ALL.includes(n))return e;let o=function(e){return{x:e===r.DIR_LEFT?-1:e===r.DIR_RIGHT?1:0,y:e===r.DIR_UP?-1:e===r.DIR_DOWN?1:0}}(n);c(t,o.x,o.y);for(let n of t){let t,a=e.filter((e=>e.id!==n.id));for(t=1;t<=(i.maxMove||r.MAX_GRID_SIZE)&&r.isFreeSpace(a,n.x+o.x*t,n.y+o.y*t,n.width,n.height,i);t++);n.x+=(t-1)*o.x,n.y+=(t-1)*o.y}return e},r.isFreeSpace=function(e,t,n,a,s,l={}){if(t<0||n<0)return!1;l.outOfBounds=!0===l.outOfBounds;let c=r.getWidth(e,l.gridWidth),d=r.getHeight(e,l.gridHeight),u=i(e,l);for(let e=t;e<t+a;e++)for(let t=n;t<n+s;t++){if(o(u,e,t))return!1;if(!l.outOfBounds&&(e<0||t<0||e>=c||t>=d))return!1}return!0},r.normalizeGrid=function(e,t={}){e=d(e,t.dontCopy);for(let t of e)t.width=1,t.height=1;return t.outOfBounds=!0,t.dontCopy=!0,r.moveAsPossible(e,e,r.DIR_LEFT,t)},r.resolveCollisions=function(e,t,n={}){e=d(e,n.dontCopy),t=e.find((e=>e.id===t.id));let i=n.diff||{x:void 0,y:void 0,exact:void 0,xExact:void 0,yExact:void 0},o=n.calcNewPos?r.getSwapPosition(t,i):d(t);if(!a(e.filter((e=>e.id!==t.id)).concat(o)))return n.calcNewPos&&(t.x=o.x,t.y=o.y),e;if(l(e,o)&&Math.abs(i.x)<=t.width&&Math.abs(i.y)<=t.height&&(0===i.x||0===i.y)){n.calcNewPos&&(t.x=o.x,t.y=o.y);let r=s(e,t);for(let e of r)Math.abs(i.x)>0?e.x+=-1*Math.sign(i.x)*t.width:Math.abs(i.y)>0&&(e.y+=-1*Math.sign(i.y)*t.height)}else if(i.exact&&l(e,o)){n.calcNewPos&&(t.x=o.x,t.y=o.y);let r=s(e,t);for(let e of r)e.x=e.x-i.x,e.y=e.y-i.y}else{if(n.calcNewPos){let e=r.getMoveRightPosition(t,i);t.x=e.x,t.y=e.y}let o=e.filter((e=>e.id!==t.id)),s=o.filter((e=>e.x>=t.x||a([e,t]))),l=Math.max.apply(null,s.map((e=>e.width+t.width))),c=r.moveElements(o,{moveX:l,moveElements:s});n.outOfBounds=!0,n.maxMove=l,n.dontCopy=!0,e=r.moveAsPossible(e,c,r.DIR_LEFT,n)}return e},r.getSwapPosition=function(e,t){let n=d(e);return n.x=Math.max(0,n.x+t.x),n.y=Math.max(0,n.y+t.y),n},r.getMoveRightPosition=function(e,t){let n=d(e);return n.x=Math.max(0,n.x+Math.round(t.xExact+.5)),n.y=Math.max(0,n.y+t.y),n},r.getElementById=function(e=[],t){return e.find((e=>e.id===t))},r.elementsCanBeInsertedAt=function(e,t=[],n){t=JSON.parse(JSON.stringify(t)),t=r.normalizePositions(t);let a=i(e.gridElements);for(let e of t)e.x+=n.x,e.y+=n.y;return!t.some((e=>o(a,e.x,e.y)))},r.normalizePositions=function(e=[]){let t=Math.min(...e.map((e=>e.x))),n=e.filter((e=>e.x===t)),r=Math.min(...n.map((e=>e.y))),i=JSON.parse(JSON.stringify(n.find((e=>e.y===r))));for(let t of e)t.x-=i.x,t.y-=i.y;return e}},467:(e,t,n)=>{"use strict";function r(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,l,"next",e)}function l(e){r(a,i,o,s,l,"throw",e)}s(void 0)}))}}n.d(t,{A:()=>i})},4980:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(2284);function i(e,t,n){return(t=function(e){var t=function(e){if("object"!==(0,r.A)(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==(0,r.A)(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===(0,r.A)(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},5937:(e,t,n)=>{"use strict";n.d(t,{CD:()=>o,IJ:()=>a,Ji:()=>c,QN:()=>i,WM:()=>s,YU:()=>r,kq:()=>d,wp:()=>l});var r=function(e){return e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce",e}({}),i=function(e){return e.Highlight="highlight",e.Sound="sound",e}({}),o=function(e){return e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<=",e}({}),a="2";function s(e){return"==2"===e||"2"===e}var l=function(e){return e.EventMatch="event_match",e.EventPropertyIs="event_property_is",e.EventPropertyContains="event_property_contains",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission",e.CallStarted="call_started",e.CallStartedPrefix="org.matrix.msc3914.call_started",e}({}),c=function(e){return e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride",e}({}),d=function(e){return e.Master=".m.rule.master",e.IsUserMention=".m.rule.is_user_mention",e.IsRoomMention=".m.rule.is_room_mention",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone",e.PollStart=".m.rule.poll_start",e.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",e.PollEnd=".m.rule.poll_end",e.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",e.PollStartOneToOne=".m.rule.poll_start_one_to_one",e.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",e.PollEndOneToOne=".m.rule.poll_end_one_to_one",e.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",e}({})},6412:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,z:()=>o});var r=n(2340),i=new r.qr("m.beacon_info","org.matrix.msc3672.beacon_info"),o=new r.qr("m.beacon","org.matrix.msc3672.beacon")},2986:(e,t,n)=>{"use strict";n.d(t,{Bx:()=>i,CJ:()=>l,Ct:()=>s,D7:()=>d,ID:()=>p,Ng:()=>f,SY:()=>C,Sr:()=>S,VT:()=>E,Wr:()=>a,Xs:()=>b,Yg:()=>y,Z3:()=>g,cr:()=>_,ge:()=>m,iK:()=>v,nN:()=>h,ud:()=>u,wt:()=>c,zZ:()=>o});var r=n(2340),i=(n(6412),n(4744),n(3122),function(e){return e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomPredecessor="org.matrix.msc3946.room_predecessor",e.PolicyRuleUser="m.policy.rule.user",e.PolicyRuleRoom="m.policy.rule.room",e.PolicyRuleServer="m.policy.rule.server",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.CallEncryptionKeysPrefix="io.element.call.encryption_keys",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.KeyVerificationKey="m.key.verification.key",e.KeyVerificationAccept="m.key.verification.accept",e.KeyVerificationReady="m.key.verification.ready",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.PollStart="org.matrix.msc3381.poll.start",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy",e.GroupCallPrefix="org.matrix.msc3401.call",e.GroupCallMemberPrefix="org.matrix.msc3401.call.member",e.CallNotify="org.matrix.msc4075.call.notify",e}({})),o=function(e){return e.Annotation="m.annotation",e.Replace="m.replace",e.Reference="m.reference",e.Thread="m.thread",e}({}),a=function(e){return e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video",e.KeyVerificationRequest="m.key.verification.request",e}({}),s="type",l=function(e){return e.Space="m.space",e.UnstableCall="org.matrix.msc3417.call",e.ElementVideo="io.element.video",e}({}),c="org.matrix.msgid",d=new r.qr("m.room.purpose","org.matrix.msc3088.purpose"),u=new r.qr("m.enabled","org.matrix.msc3088.enabled"),h=new r.qr("m.data_tree","org.matrix.msc3089.data_tree"),p=new r.qr("m.leaf","org.matrix.msc3089.leaf"),v=new r.qr("m.branch","org.matrix.msc3089.branch"),m=new r.qr("m.room.marker","org.matrix.msc2716.marker"),g=new r.qr("with_rel_types","org.matrix.msc3912.with_relations"),f=new r.qr("io.element.functional_members","io.element.functional_members"),y=new r.qr("m.visibility","org.matrix.msc3531.visibility"),_=new r.qr("enabled","org.matrix.msc3881.enabled"),E=new r.qr("device_id","org.matrix.msc3881.device_id"),b=new r.qr("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),S=new r.qr("thread_id","org.matrix.msc4023.thread_id"),C=new r.xu("membership","io.element.msc4115.membership")},6209:(e,t,n)=>{"use strict";n.d(t,{BJ:()=>l,Et:()=>s,K0:()=>o,NY:()=>c,yB:()=>a});var r=n(9787),i=n(8722),o=new r.UnstableValue("m.message","org.matrix.msc1767.message"),a=new r.UnstableValue("m.text","org.matrix.msc1767.text"),s=new r.UnstableValue("m.html","org.matrix.msc1767.html"),l=new r.NamespacedValue("m.reference");function c(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||(0,i.c)(r.altName)&&n.matches(r.altName)}},4867:(e,t,n)=>{"use strict";n.d(t,{J1:()=>o,M6:()=>s,Yg:()=>i,vo:()=>a});var r=n(2340),i=(n(6209),function(e){return e.Self="m.self",e.Pin="m.pin",e}({})),o=new r.qr("m.asset","org.matrix.msc3488.asset"),a=new r.qr("m.ts","org.matrix.msc3488.ts"),s=new r.qr("m.location","org.matrix.msc3488.location")},6560:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var r=function(e){return e.Ban="ban",e.Invite="invite",e.Join="join",e.Knock="knock",e.Leave="leave",e}({})},2114:(e,t,n)=>{"use strict";n.d(t,{D7:()=>a,Jv:()=>l,bv:()=>r,dx:()=>o,k:()=>i,rF:()=>s});var r=function(e){return e.Public="public",e.Private="private",e}({}),i=function(e){return e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat",e}({}),o=function(e){return e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted",e}({}),a=function(e){return e.RoomMembership="m.room_membership",e}({}),s=function(e){return e.CanJoin="can_join",e.Forbidden="forbidden",e}({}),l=function(e){return e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable",e}({})},4744:(e,t,n)=>{"use strict";n.d(t,{$S:()=>a,cI:()=>l,li:()=>o,ms:()=>i,qN:()=>s});var r=n(9787),i=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),o=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),a=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),s=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),l=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end")},6022:(e,t,n)=>{"use strict";n.d(t,{L:()=>r,S:()=>i});var r=function(e){return e.Read="m.read",e.FullyRead="m.fully_read",e.ReadPrivate="m.read.private",e}({}),i="main"},5566:(e,t,n)=>{"use strict";n.d(t,{e:()=>r});var r=function(e){return e.Cancel="cancel",e.Restart="restart",e.Send="send",e}({})},5928:(e,t,n)=>{"use strict";n.d(t,{g:()=>r});var r=function(e){return e.Recent="recent",e.Rank="rank",e}({})},5155:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});var r=new(n(2340).M6)("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications")},1265:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var r=new(n(2340).qr)("m.topic","org.matrix.msc3765.topic")},2340:(e,t,n)=>{"use strict";n.d(t,{M6:()=>o,qr:()=>a,xu:()=>i});var r=n(4980);class i{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],t=this.altName;return t&&e.push(t),e}matches(e){return this.name===e||this.altName===e}findIn(e){var t=void 0;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}class o extends i{constructor(){super(...arguments),(0,r.A)(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class a extends i{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}},4831:(e,t,n)=>{"use strict";n.d(t,{K:()=>i,Q:()=>o});var r=n(4980);class i{constructor(e){this.target=e,(0,r.A)(this,"reEmitters",new WeakMap)}reEmit(e,t){var n=this,r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));var i=function(t){if(r.has(t))return 1;var i=function(){if("error"!==t||0!==n.target.listenerCount("error")){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.target.emit(t,...i,e)}};e.on(t,i),r.set(t,i)};for(var o of t)i(o)}stopReEmitting(e,t){var n=this.reEmitters.get(e);if(n){for(var r of t)e.off(r,n.get(r)),n.delete(r);0===n.size&&this.reEmitters.delete(e)}}}class o extends i{constructor(e){super(e)}reEmit(e,t){super.reEmit(e,t)}stopReEmitting(e,t){super.stopReEmitting(e,t)}}},5061:(e,t,n)=>{"use strict";n.d(t,{MN:()=>d,gc:()=>c,iz:()=>l});var r=n(467),i=n(4980),o=n(3840),a=n(9521),s=n(2228),l=function(e){return e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR",e}({}),c=function(e){return e.Invalid="Invalid homeserver discovery response",e.GenericFailure="Failed to get autodiscovery configuration from server",e.InvalidHsBaseUrl="Invalid base_url for m.homeserver",e.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",e.InvalidIsBaseUrl="Invalid base_url for m.identity_server",e.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",e.InvalidIs="Invalid identity server discovery response",e.MissingWellknown="No .well-known JSON file found",e.InvalidJson="Invalid JSON",e.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",e}({});class d{static fromDiscoveryConfig(e){var t=this;return(0,r.A)((function*(){var n,r={"m.homeserver":{state:d.FAIL_ERROR,error:d.ERROR_INVALID,base_url:null},"m.identity_server":{state:d.PROMPT,error:null,base_url:null}};if(null==e||!e["m.homeserver"])return o.v.error("No m.homeserver key in config"),r["m.homeserver"].state=d.FAIL_PROMPT,r["m.homeserver"].error=d.ERROR_INVALID,Promise.resolve(r);if(!e["m.homeserver"].base_url)return o.v.error("No m.homeserver base_url in config"),r["m.homeserver"].state=d.FAIL_PROMPT,r["m.homeserver"].error=d.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var i=t.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!i)return o.v.error("Invalid base_url for m.homeserver"),r["m.homeserver"].error=d.ERROR_INVALID_HS_BASE_URL,Promise.resolve(r);var a=yield t.fetchWellKnownObject("".concat(i,"/_matrix/client/versions"));if(!a||!Array.isArray(null===(n=a.raw)||void 0===n?void 0:n.versions))return o.v.error("Invalid /versions response"),r["m.homeserver"].error=d.ERROR_INVALID_HOMESERVER,r["m.homeserver"].base_url=i,Promise.resolve(r);var c=new Set(a.raw.versions),u=!1;for(var h of s.Hr)if(c.has(h)){u=!0;break}if(!u)return o.v.error("Homeserver does not meet version requirements"),r["m.homeserver"].error=d.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,r["m.homeserver"].base_url=i,Promise.resolve(r);r["m.homeserver"]={state:d.SUCCESS,error:null,base_url:i};var p="";if(e["m.identity_server"]){var v={"m.homeserver":r["m.homeserver"],"m.identity_server":{state:d.FAIL_PROMPT,error:d.ERROR_INVALID_IS,base_url:null}};if(!(p=t.sanitizeWellKnownUrl(e["m.identity_server"].base_url)))return o.v.error("Invalid base_url for m.identity_server"),v["m.identity_server"].error=d.ERROR_INVALID_IS_BASE_URL,Promise.resolve(v);var m=yield t.fetchWellKnownObject("".concat(p,"/_matrix/identity/v2"));if(null==m||!m.raw||m.action!==l.SUCCESS)return o.v.error("Invalid /v2 response"),v["m.identity_server"].error=d.ERROR_INVALID_IDENTITY_SERVER,v["m.identity_server"].base_url=p,Promise.resolve(v)}return p&&p.toString().length>0&&(r["m.identity_server"]={state:d.SUCCESS,error:null,base_url:p}),Object.keys(e).forEach((t=>{if("m.homeserver"===t||"m.identity_server"===t){var n=["error","state","base_url"];for(var i of Object.keys(e[t]))n.includes(i)||(r[t][i]=e[t][i])}else r[t]=e[t]})),Promise.resolve(r)}))()}static findClientConfig(e){var t=this;return(0,r.A)((function*(){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var n={"m.homeserver":{state:d.FAIL_ERROR,error:d.ERROR_INVALID,base_url:null},"m.identity_server":{state:d.PROMPT,error:null,base_url:null}},r=e.includes("://")?e:"https://".concat(e),i=yield t.fetchWellKnownObject("".concat(r,"/.well-known/matrix/client"));return i&&i.action===l.SUCCESS?d.fromDiscoveryConfig(i.raw):(o.v.error("No response or error when parsing .well-known"),i.reason&&o.v.error(i.reason),i.action===l.IGNORE?n["m.homeserver"]={state:d.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=d.FAIL_PROMPT,n["m.homeserver"].error=d.ERROR_INVALID),Promise.resolve(n))}))()}static getRawClientConfig(e){var t=this;return(0,r.A)((function*(){var n;if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");var r=yield t.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return r&&null!==(n=r.raw)&&void 0!==n?n:{}}))()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var t,n;try{n=new URL(e)}catch(e){o.v.error("Could not parse url",e)}if(null===(t=n)||void 0===t||!t.hostname)return!1;if("http:"!==n.protocol&&"https:"!==n.protocol)return!1;var r=n.port?":".concat(n.port):"",i=n.pathname?n.pathname:"",a="".concat(n.protocol,"//").concat(n.hostname).concat(r).concat(i);return a.endsWith("/")&&(a=a.substring(0,a.length-1)),a}catch(e){return o.v.error(e),!1}}static fetch(e,t){return this.fetchFn?this.fetchFn(e,t):globalThis.fetch(e,t)}static setFetchFn(e){d.fetchFn=e}static fetchWellKnownObject(e){return(0,r.A)((function*(){var t;try{if(404===(t=yield d.fetch(e,{method:a.IT.Get,signal:(0,a._)(5e3)})).status)return{raw:{},action:l.IGNORE,reason:d.ERROR_MISSING_WELLKNOWN};if(!t.ok)return{raw:{},action:l.FAIL_PROMPT,reason:"General failure"}}catch(e){var n=e,r="";return"object"==typeof n&&(r=null==n?void 0:n.message),{error:n,raw:{},action:l.FAIL_PROMPT,reason:r||"General failure"}}try{return{raw:yield t.json(),action:l.SUCCESS}}catch(e){var i=e;return{error:i,raw:{},action:l.FAIL_PROMPT,reason:"SyntaxError"===(null==i?void 0:i.name)?d.ERROR_INVALID_JSON:d.ERROR_INVALID}}}))()}}(0,i.A)(d,"ERROR_INVALID",c.Invalid),(0,i.A)(d,"ERROR_GENERIC_FAILURE",c.GenericFailure),(0,i.A)(d,"ERROR_INVALID_HS_BASE_URL",c.InvalidHsBaseUrl),(0,i.A)(d,"ERROR_INVALID_HOMESERVER",c.InvalidHomeserver),(0,i.A)(d,"ERROR_INVALID_IS_BASE_URL",c.InvalidIsBaseUrl),(0,i.A)(d,"ERROR_INVALID_IDENTITY_SERVER",c.InvalidIdentityServer),(0,i.A)(d,"ERROR_INVALID_IS",c.InvalidIs),(0,i.A)(d,"ERROR_MISSING_WELLKNOWN",c.MissingWellknown),(0,i.A)(d,"ERROR_INVALID_JSON",c.InvalidJson),(0,i.A)(d,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",c.UnsupportedHomeserverSpecVersion),(0,i.A)(d,"ALL_ERRORS",Object.keys(c)),(0,i.A)(d,"FAIL_ERROR",l.FAIL_ERROR),(0,i.A)(d,"FAIL_PROMPT",l.FAIL_PROMPT),(0,i.A)(d,"PROMPT",l.PROMPT),(0,i.A)(d,"SUCCESS",l.SUCCESS),(0,i.A)(d,"fetchFn",void 0)},7723:(e,t,n)=>{"use strict";function r(e,t){if("function"==typeof e.toBase64)return e.toBase64(t);var n=btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""));return t.omitPadding&&(n=n.replace(/={1,2}$/,"")),"base64url"===t.alphabet&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function i(e){return r(e,{alphabet:"base64",omitPadding:!1})}function o(e){return r(e,{alphabet:"base64",omitPadding:!0})}function a(e){return r(e,{alphabet:"base64url",omitPadding:!0})}function s(e){return function(e){return"function"==typeof Uint8Array.fromBase64?Uint8Array.fromBase64(e,{alphabet:"base64",lastChunkHandling:"loose"}):Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}(e.replace(/-/g,"+").replace(/_/g,"/"))}n.d(t,{A4:()=>a,PP:()=>o,WG:()=>i,y4:()=>s})},4792:(e,t,n)=>{"use strict";n.d(t,{Kn:()=>He,AU:()=>it,hx:()=>Xe,pB:()=>at,eO:()=>Je,NB:()=>Ze,A0:()=>et,uD:()=>Qe,HF:()=>ze,jB:()=>nt,rG:()=>tt,mD:()=>lt,fN:()=>dt,Xb:()=>ct});var r=n(467),i=n(4980),o=n(6459),a=n(9561);class s{constructor(){(0,i.A)(this,"accountData",new Map),(0,i.A)(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}setUserCreator(e){}storeEvents(e,t,n,r){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return(0,r.A)((function*(){return[]}))()}setPendingEvents(e,t){return Promise.resolve()}saveToDeviceBatches(e){return(0,r.A)((function*(){return Promise.resolve()}))()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return(0,r.A)((function*(){return Promise.resolve()}))()}destroy(){return(0,r.A)((function*(){}))()}}var l=n(2188),c=n(310),d=n(7016),u=n(4377),h=n(3883),p=n(8221),v=n(3840),m=n(5937),g=n(2986);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=[m.Ji.Override,m.Ji.ContentSpecific,m.Ji.RoomSpecific,m.Ji.SenderSpecific,m.Ji.Underride],E={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:m.wp.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:m.wp.SenderNotificationPermission,key:"room"}],actions:[m.YU.Notify,{set_tweak:m.QN.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:m.wp.EventMatch,key:"type",pattern:"m.reaction"}],actions:[m.YU.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:m.wp.EventMatch,key:"type",pattern:g.Bx.RoomServerAcl},{kind:m.wp.EventMatch,key:"state_key",pattern:""}],actions:[]}},b=Symbol("UserDefinedRules"),S=[m.kq.Master,b,m.kq.SuppressNotices,m.kq.InviteToSelf,m.kq.MemberEvent,m.kq.IsUserMention,m.kq.ContainsDisplayName,m.kq.IsRoomMention,m.kq.AtRoomNotification,m.kq.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],C={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:m.wp.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:m.wp.CallStarted}],actions:[m.YU.Notify,{set_tweak:m.QN.Sound,value:"default"}]}},w=[b,m.kq.IncomingCall,".org.matrix.msc3914.rule.room.call",m.kq.EncryptedDM,m.kq.DM,m.kq.Message,m.kq.EncryptedMessage];function A(e,t,n,r){var i=t.filter((e=>e.default)),o=t.filter((e=>!e.default));function a(t){t===b?l.push(...o):t in n?(v.v.warn("Adding default global ".concat(e," push rule ").concat(t)),l.push(n[t])):v.v.warn("Missing default global ".concat(e," push rule ").concat(t))}var s=0,l=[];for(var c of i){var d=r.indexOf(c.rule_id);if(-1!==d){for(;d>s;)a(r[s]),s+=1;l.push(c),s+=1}else l.push(c)}for(var u of r.slice(s))a(u);return l}class T{constructor(e){this.client=e,(0,i.A)(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var t={notify:!1,tweaks:{}};for(var n of e)n===m.YU.Notify?t.notify=!0:"object"==typeof n&&(void 0===n.value&&(n.value=!0),t.tweaks[n.set_tweak]=n.value);return t}static rewriteDefaultRules(e){var t=JSON.parse(JSON.stringify(e));return t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]),t.global.underride||(t.global.underride=[]),t.global.override=A(m.Ji.Override,t.global.override,E,S),t.global.underride=A(m.Ji.Underride,t.global.underride,C,w),t}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var t=new Set(this.parsedKeys.keys());for(var n of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var r of n)if(r.conditions)for(var i of r.conditions)i.kind===m.wp.EventMatch&&(t.delete(i.key),this.parsedKeys.set(i.key,T.partsForDottedKey(i.key)));t.forEach((e=>this.parsedKeys.delete(e)))}matchingRuleFromKindSet(e,t){for(var n of _){var r=t[n];if(r)for(var i of r)if(i.enabled){var o=this.templateRuleToRaw(n,i);if(o&&this.ruleMatchesEvent(o,e))return y(y({},i),{},{kind:n})}}return null}templateRuleToRaw(e,t){var n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case m.Ji.Underride:case m.Ji.Override:n.conditions=t.conditions;break;case m.Ji.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:m.wp.EventMatch,key:"room_id",value:t.rule_id});break;case m.Ji.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:m.wp.EventMatch,key:"user_id",value:t.rule_id});break;case m.Ji.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:m.wp.EventMatch,key:"content.body",pattern:t.pattern})}return n}eventFulfillsCondition(e,t){switch(e.kind){case m.wp.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case m.wp.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,t);case m.wp.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,t);case m.wp.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case m.wp.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case m.wp.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t);case m.wp.CallStarted:case m.wp.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){var n=e.key;if(!n)return!1;var r=this.client.getRoom(t.getRoomId());return!(null==r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;var n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;var r=n.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)(\d*)$/);if(!i)return!1;var o=i[1],a=parseInt(i[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return r==a;case"<":return r<a;case">":return r>a;case"<=":return r<=a;case">=":return r>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,t){var n,r=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(r=t.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;var i=this.client.getRoom(t.getRoomId()),o=null==i||null===(n=i.currentState)||void 0===n?void 0:n.getMember(this.client.credentials.userId);if(!o)return!1;var a=o.name,s=new RegExp("(^|\\W)"+(0,h.Nt)(a)+"(\\W|$)","i");return r.body.search(s)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;var n=this.valueForDottedKey(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;if("string"!=typeof e.pattern)return!1;var r="content.body"===e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!n.match(r)}eventFulfillsEventPropertyIsCondition(e,t){return!(!e.key||void 0===e.value)&&e.value===this.valueForDottedKey(e.key,t)}eventFulfillsEventPropertyContains(e,t){if(!e.key||void 0===e.value)return!1;var n=this.valueForDottedKey(e.key,t);return!!Array.isArray(n)&&n.includes(e.value)}eventFulfillsCallStartedCondition(e,t){return["m.ring","m.prompt"].includes(t.getContent()["m.intent"])&&!("m.terminated"in t.getContent())&&(t.getPrevContent()["m.terminated"]!==t.getContent()["m.terminated"]||(0,h.ky)(t.getPrevContent(),{}))}createCachedRegex(e,t,n){return T.cachedGlobToRegex[t]||(T.cachedGlobToRegex[t]=new RegExp(e+(0,h.dn)(t)+n,"i")),T.cachedGlobToRegex[t]}static partsForDottedKey(e){var t=[],n="",r=!1;for(var i of e)r?(n+="\\"===i||"."===i?i:"\\"+i,r=!1):"."==i?(t.push(n),n=""):"\\"==i?r=!0:n+=i;return r&&(n+="\\"),t.push(n),t}valueForDottedKey(e,t){var n,r=this.parsedKeys.get(e);void 0===r&&(r=T.partsForDottedKey(e),this.parsedKeys.set(e,r));var i=r[0],o=0;for("content"===i?(n=t.getContent(),++o):"type"===i?(n=t.getType(),++o):n=t.event;o<r.length;++o){if((0,h.hX)(n))return;n=n[r[o]]}return n}matchingRuleForEventWithRulesets(e,t){return t?e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){var n=this.matchingRuleForEventWithRulesets(e,t);if(!n)return{};var r=T.actionListToActionsObject(n.actions);return void 0===r.tweaks.highlight&&(r.tweaks.highlight=n.kind==m.Ji.ContentSpecific),{actions:r,rule:n}}ruleMatchesEvent(e,t){var n;return!(this.client.supportsIntentionalMentions()&&void 0!==t.getContent()["m.mentions"]&&(e.rule_id===m.kq.ContainsUserName||e.rule_id===m.kq.ContainsDisplayName||e.rule_id===m.kq.AtRoomNotification)||null!==(n=e.conditions)&&void 0!==n&&n.some((e=>!this.eventFulfillsCondition(e,t))))}actionsForEvent(e){var{actions:t}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return t||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var t,n=this.getPushRuleAndKindById(e);return null!==(t=null==n?void 0:n.rule)&&void 0!==t?t:null}getPushRuleAndKindById(e){for(var t of["global"]){var n;if(void 0!==(null===(n=this.client.pushRules)||void 0===n?void 0:n[t]))for(var r of _)if(void 0!==this.client.pushRules[t][r])for(var i of this.client.pushRules[t][r])if(i.rule_id===e)return{rule:i,kind:r}}return null}}(0,i.A)(T,"cachedGlobToRegex",{});var I=n(5061),k=n(7723),O=n(4831),R=n(8425),x=n(9521),N=n(7780),D=n(8230),L=n(6344),P=n(1128),M=n(29),U=n(5614),F=n(2027),B=n(4659),G=n(6729),$=n(2114);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=n(5942),W=n(5150),q=n(4116);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class z{constructor(e,t,n){this.client=e,this.indexEvent=t,this.directory=n}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return(0,r.A)((function*(){yield e.client.sendStateEvent(e.roomId,g.iK.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var t=(yield e.getVersionHistory())[1];t&&(yield t.delete())}))()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var t=this;return(0,r.A)((function*(){yield t.client.sendStateEvent(t.roomId,g.iK.name,Y(Y({},t.indexEvent.getContent()),{},{name:e}),t.id)}))()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var t=this;return(0,r.A)((function*(){yield t.client.sendStateEvent(t.roomId,g.iK.name,Y(Y({},t.indexEvent.getContent()),{},{locked:e}),t.id)}))()}getFileInfo(){var e=this;return(0,r.A)((function*(){var t=(yield e.getFileEvent()).getOriginalContent().file,n=e.client.mxcUrlToHttp(t.url);if(!n)throw new Error("No HTTP URL available for ".concat(t.url));return{info:t,httpUrl:n}}))()}getFileEvent(){var e=this;return(0,r.A)((function*(){var t=e.client.getRoom(e.roomId);if(!t)throw new Error("Unknown room");for(var n=t.getUnfilteredTimelineSet().findEventById(e.id);!n&&t.getLiveTimeline().getState(p.q.BACKWARDS).paginationToken;)yield e.client.scrollback(t,100),n=t.getUnfilteredTimelineSet().findEventById(e.id);if(!n)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(n),n}))()}createNewVersion(e,t,n,i){var o=this;return(0,r.A)((function*(){var r=yield o.directory.createFile(e,t,n,Y(Y({},null!=i?i:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:g.zZ.Replace,event_id:o.id}}));return yield o.client.sendStateEvent(o.roomId,g.iK.name,{active:!0,name:e,version:o.version+1},r.event_id),yield o.client.sendStateEvent(o.roomId,g.iK.name,Y(Y({},o.indexEvent.getContent()),{},{active:!1}),o.id),r}))()}getVersionHistory(){var e=this;return(0,r.A)((function*(){var t=[];t.push(e);var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Invalid or unknown room");var r,i=[...n.getLiveTimeline().getEvents()].reverse(),o=yield e.getFileEvent();do{if(r=i.find((e=>e.replacingEventId()===o.getId()))){var a=e.directory.getFile(r.getId());if(!a)break;t.push(a),o=r}}while(r);return t}))()}}var J=n(6560);function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[g.Bx.RoomPowerLevels]:100,[g.Bx.RoomHistoryVisibility]:100,[g.Bx.RoomTombstone]:100,[g.Bx.RoomEncryption]:100,[g.Bx.RoomName]:50,[g.Bx.RoomMessage]:50,[g.Bx.RoomMessageEncrypted]:50,[g.Bx.Sticker]:50},users:{}},ee=function(e){return e.Viewer="viewer",e.Editor="editor",e.Owner="owner",e}({});class te{constructor(e,t){if(this.client=e,this.roomId=t,(0,i.A)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(g.Bx.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}setName(e){var t=this;return(0,r.A)((function*(){yield t.client.sendStateEvent(t.roomId,g.Bx.RoomName,{name:e},"")}))()}invite(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=[n.retryInvite(e)];r&&i.push(...n.getDirectories().map((t=>t.invite(e,r)))),yield Promise.all(i)}))()}retryInvite(e){var t=this;return(0,h.CC)((0,r.A)((function*(){yield t.client.invite(t.roomId,e).catch((e=>{if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new q.AbortError(e);throw e}))})))}setPermissions(e,t){var n=this;return(0,r.A)((function*(){var r,i=n.room.currentState.getStateEvents(g.Bx.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var o=(null==i?void 0:i.getContent())||{},a=o.users_default||0,s=o.events_default||50,l=(null===(r=o.events)||void 0===r?void 0:r[g.Bx.RoomPowerLevels])||100,c=o.users||{};switch(t){case ee.Viewer:c[e]=a;break;case ee.Editor:c[e]=s;break;case ee.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}o.users=c,yield n.client.sendStateEvent(n.roomId,g.Bx.RoomPowerLevels,o,"")}))()}getPermissions(e){var t,n,r=this.room.currentState.getStateEvents(g.Bx.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");var i=(null==r?void 0:r.getContent())||{},o=i.users_default||0,a=i.events_default||50,s=(null===(t=i.events)||void 0===t?void 0:t[g.Bx.RoomPowerLevels])||100,l=(null===(n=i.users)||void 0===n?void 0:n[e])||o;return l>=s?ee.Owner:l>=a?ee.Editor:ee.Viewer}createDirectory(e){var t=this;return(0,r.A)((function*(){var n=yield t.client.unstableCreateFileTree(e);return yield t.client.sendStateEvent(t.roomId,g.Bx.SpaceChild,{via:[t.client.getDomain()]},n.roomId),yield t.client.sendStateEvent(n.roomId,g.Bx.SpaceParent,{via:[t.client.getDomain()]},t.roomId),n}))()}getDirectories(){var e=[],t=this.room.currentState.getStateEvents(g.Bx.SpaceChild);for(var n of t)try{var r=n.getStateKey();if(r){var i=this.client.unstableGetFileTreeSpace(r);i&&e.push(i)}}catch(e){v.v.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}delete(){var e=this;return(0,r.A)((function*(){var t=e.getDirectories();for(var n of t)yield n.delete();var r=[J.O.Invite,J.O.Knock,J.O.Join],i=e.room.currentState.getStateEvents(g.Bx.RoomMember);for(var o of i)if(o.getStateKey()!==e.client.getUserId()&&r.includes(o.getContent().membership)){var a=o.getStateKey();if(!a)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,a,"Room deleted")}yield e.client.leave(e.roomId)}))()}getOrderedChildren(e){var t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order}))).filter((e=>e.roomId));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return(0,h.aw)(e.order,t.order);var n,r,i,o,a=this.client.getRoom(e.roomId),s=this.client.getRoom(t.roomId);if(!a||!s)return(0,h.aw)(e.roomId,t.roomId);var l=null!==(n=null===(r=a.currentState.getStateEvents(g.Bx.RoomCreate,""))||void 0===r?void 0:r.getTs())&&void 0!==n?n:0,c=null!==(i=null===(o=s.currentState.getStateEvents(g.Bx.RoomCreate,""))||void 0===o?void 0:o.getTs())&&void 0!==i?i:0;return l===c?(0,h.aw)(e.roomId,t.roomId):l-c})),t}getParentRoom(){var e=this.room.currentState.getStateEvents(g.Bx.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");var t=e.getStateKey();if(!t)throw new Error("No state key found for parent");var n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom().currentState.getStateEvents(g.Bx.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}setOrder(e){var t=this;return(0,r.A)((function*(){var n;if(t.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var r=t.getParentRoom(),i=r.currentState.getStateEvents(g.Bx.SpaceChild),o=t.getOrderedChildren(i);e=Math.max(Math.min(e,o.length-1),0);var a=t.getOrder()<e;a&&e===o.length-1?e--:a||0!==e||e++;var s=o[a?e:e-1],l=o[a?e+1:e],c=h.Mf[0],d=!1;if(s)if(e===o.length-1)null!=l&&l.order&&(c=(0,h.$9)(l.order));else{var u=null==s?void 0:s.order,p=null==l?void 0:l.order;u&&p?c=u===p?(0,h.$9)(u):(0,h.sy)(u,p):u?c=(0,h.$9)(u):p?c=(0,h.zR)(p):d=!0}else null!=l&&l.order&&(c=(0,h.zR)(l.order));if(d){for(var v,m=0;m<=e;m++){var f=o[m];if(0===m&&(v=f.order),f.order)v=f.order;else{var y;v=v?(0,h.$9)(v):h.Mf[0];var _=r.currentState.getStateEvents(g.Bx.SpaceChild,f.roomId),E=null!==(y=null==_?void 0:_.getContent())&&void 0!==y?y:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,g.Bx.SpaceChild,Q(Q({},E),{},{order:v}),f.roomId)}}v&&(c=(0,h.$9)(v))}var b=r.currentState.getStateEvents(g.Bx.SpaceChild,t.roomId),S=null!==(n=null==b?void 0:b.getContent())&&void 0!==n?n:{via:[t.client.getDomain()]};yield t.client.sendStateEvent(r.roomId,g.Bx.SpaceChild,Q(Q({},S),{},{order:c}),t.roomId)}))()}createFile(e,t,n,i){var o=this;return(0,r.A)((function*(){var r,{content_uri:a}=yield o.client.uploadContent(t,{includeFilename:!1});n.url=a;var s={msgtype:g.Wr.File,body:e,url:a,file:n};(i=null!==(r=i)&&void 0!==r?r:{})["m.new_content"]&&(i["m.new_content"]=s);var l=yield o.client.sendMessage(o.roomId,Q(Q(Q({},i),s),{},{[g.ID.name]:{}}));return yield o.client.sendStateEvent(o.roomId,g.iK.name,{active:!0,name:e},l.event_id),l}))()}getFile(e){var t=this.room.currentState.getStateEvents(g.iK.name,e);return t?new z(this.client,t,this):null}listFiles(){return this.listAllFiles().filter((e=>e.isActive))}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(g.iK.name))&&void 0!==e?e:[]).map((e=>new z(this.client,e,this)))}}var ne=n(5928),re=n(2958),ie=n(9372),oe=n(6387),ae=n(6022),se=n(4787),le=n(441),ce=n(6412),de=n(2340),ue=n(15);class he{constructor(e){var t=this;this.client=e,(0,i.A)(this,"sending",!1),(0,i.A)(this,"running",!0),(0,i.A)(this,"retryTimeout",null),(0,i.A)(this,"retryAttempts",0),(0,i.A)(this,"sendQueue",(0,r.A)((function*(){if(null!==t.retryTimeout&&clearTimeout(t.retryTimeout),t.retryTimeout=null,!t.sending&&t.running){var e;v.v.debug("Attempting to send queued to-device messages"),t.sending=!0;try{for(;t.running&&null!==(e=yield t.client.store.getOldestToDeviceBatch());)yield t.sendBatch(e),yield t.client.store.removeToDeviceBatch(e.id),t.retryAttempts=0;if(!t.running)return;v.v.debug("All queued to-device messages sent")}catch(r){++t.retryAttempts;var n=ue.b.RETRY_BACKOFF_RATELIMIT(null,t.retryAttempts,r);if(-1===n)return void(4===Math.floor(r.httpStatus/100)?(v.v.error("Fatal error when sending to-device message - dropping to-device batch!",r),yield t.client.store.removeToDeviceBatch(e.id)):v.v.info("Automatic retry limit reached for to-device messages."));v.v.info("Failed to send batch of to-device messages. Will retry in ".concat(n,"ms"),r),t.retryTimeout=setTimeout(t.sendQueue,n)}finally{t.sending=!1}}}))),(0,i.A)(this,"onResumedSync",((e,t)=>{e===o.Lm.Syncing&&t!==o.Lm.Syncing&&(v.v.info("Resuming queue after resumed sync"),this.sendQueue())}))}start(){this.running=!0,this.sendQueue(),this.client.on(it.Sync,this.onResumedSync)}stop(){this.running=!1,null!==this.retryTimeout&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(it.Sync,this.onResumedSync)}queueBatch(e){var t=this;return(0,r.A)((function*(){for(var n=[],r=0;r<e.batch.length;r+=20){var i={eventType:e.eventType,batch:e.batch.slice(r,r+20),txnId:t.client.makeTxnId()};n.push(i);var o=i.batch.map((e=>"".concat(e.userId,"/").concat(e.deviceId," (msgid ").concat(e.payload[g.wt],")")));v.v.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(i.txnId),o)}yield t.client.store.saveToDeviceBatches(n),t.sendQueue()}))()}sendBatch(e){var t=this;return(0,r.A)((function*(){var n=new h.kG((()=>new Map));for(var r of e.batch)n.getOrCreate(r.userId).set(r.deviceId,r.payload);v.v.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield t.client.sendToDevice(e.eventType,n,e.txnId)}))()}}var pe=n(3122),ve={[pe.Jo.User]:g.Bx.PolicyRuleUser,[pe.Jo.Room]:g.Bx.PolicyRuleRoom,[pe.Jo.Server]:g.Bx.PolicyRuleServer};class me{constructor(e){this.client=e}addRule(e,t,n){var i=this;return(0,r.A)((function*(){var r=yield i.getOrCreateTargetRoom();return(yield i.client.sendStateEvent(r.roomId,ve[e],{entity:t,reason:n,recommendation:pe.Q5.Ban})).event_id}))()}removeRule(e){var t=this;return(0,r.A)((function*(){yield t.client.redactEvent(e.getRoomId(),e.getId())}))()}addSource(e){var t=this;return(0,r.A)((function*(){yield t.client.joinRoom(e);var n=(yield t.getOrCreateSourceRooms()).map((e=>e.roomId));return!n.includes(e)&&(n.push(e),yield t.withIgnoreInvitesPolicies((e=>{e.sources=n})),!0)}))()}getRuleForInvite(e){var t=this;return(0,r.A)((function*(){var{sender:n,roomId:r}=e,i=yield t.getOrCreateSourceRooms(),o=n.split(":")[1],a=r.split(":")[1];for(var s of i){var l=s.getUnfilteredTimelineSet().getLiveTimeline().getState(p.q.FORWARDS);for(var{scope:c,entities:d}of[{scope:pe.Jo.Room,entities:[r]},{scope:pe.Jo.User,entities:[n]},{scope:pe.Jo.Server,entities:[o,a]}]){var u=l.getStateEvents(ve[c]);for(var v of u){var m=v.getContent();if((null==m?void 0:m.recommendation)==pe.Q5.Ban){var g=null==m?void 0:m.entity;if(g){var f=void 0;try{f=new RegExp((0,h.dn)(g))}catch(e){continue}for(var y of d)if(y&&f.test(y))return v}}}}}return null}))()}getOrCreateTargetRoom(){var e=this;return(0,r.A)((function*(){var t=e.getIgnoreInvitesPolicies().target;if("string"!=typeof t&&(t=null),t){var n=e.client.getRoom(t);if(n)return n;t=null}return t=(yield e.client.createRoom({name:"Individual Policy Room",preset:$.k.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies((e=>{e.target=t})),e.client.getRoom(t)}))()}getOrCreateSourceRooms(){var e=this;return(0,r.A)((function*(){var t=e.getIgnoreInvitesPolicies().sources,n=!1;Array.isArray(t)||(n=!0,t=[]);var r=t.filter((e=>"string"==typeof e)).map((t=>e.client.getRoom(t))).filter((e=>!!e));return r.length!=t.length&&(n=!0),0==r.length&&(n=!0,r=[yield e.getOrCreateTargetRoom()]),n&&(yield e.withIgnoreInvitesPolicies((e=>{e.sources=t}))),r}))()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var t=this;return(0,r.A)((function*(){var{policies:n,ignoreInvitesPolicies:r}=t.getPoliciesAndIgnoreInvitesPolicies();e(r),n[pe.NG.name]=r,yield t.client.setAccountData(pe.fx.name,n)}))()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var t of[pe.fx.name,pe.fx.altName]){var n;if(t){var r=null===(n=this.client.getAccountData(t))||void 0===n?void 0:n.getContent();if(r){e=r;break}}}var i={},o=!1;for(var a of[pe.NG.name,pe.NG.altName])if(a){var s=e[a];if(s&&"object"==typeof s){i=s,o=!0;break}}return o||(e[pe.NG.name]=i),{policies:e,ignoreInvitesPolicies:i}}}var ge=n(8140),fe="matrix-js-sdk",ye=n(8417),_e=n(6900),Ee=n(6122),be=e=>"livekit"===e.type&&"focus_selection"in e,Se=144e5;class Ce{static equal(e,t){return(0,h.ky)(e.membershipData,t.membershipData)}constructor(e,t){this.parentEvent=e,(0,i.A)(this,"membershipData",void 0);var n=[];if(!((e,t)=>{var n,r="Malformed session membership event: ";return"string"!=typeof e.device_id&&t.push(r+"device_id must be string"),"string"!=typeof e.call_id&&t.push(r+"call_id must be string"),"string"!=typeof e.application&&t.push(r+"application must be a string"),"string"!=typeof(null===(n=e.focus_active)||void 0===n?void 0:n.type)&&t.push(r+"focus_active.type must be a string"),Array.isArray(e.foci_preferred)||t.push(r+"foci_preferred must be an array"),e.created_ts&&"number"!=typeof e.created_ts&&t.push(r+"created_ts must be number"),e.scope&&"string"!=typeof e.scope&&t.push(r+"scope must be string"),0===t.length})(t,n))throw Error("unknown CallMembership data. Does not match MSC4143 call.member (".concat(n.join(" & "),") events this could be a legacy membership event: (").concat(t,")"));this.membershipData=t}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){var e;return null!==(e=this.membershipData.created_ts)&&void 0!==e?e:this.parentEvent.getTs()}getAbsoluteExpiry(){var e;return this.createdTs()+(null!==(e=this.membershipData.expires)&&void 0!==e?e:Se)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){var e=this.membershipData.focus_active;if(be(e))return e.focus_selection}}var we=n(5566),Ae=n(3719);class Te{get callMemberEventRetryDelayMinimum(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.callMemberEventRetryDelayMinimum)&&void 0!==e?e:3e3}get membershipExpiryTimeout(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipExpiryTimeout)&&void 0!==e?e:Se}get membershipServerSideExpiryTimeout(){var e,t,n;return null!==(e=null!==(t=this.membershipServerSideExpiryTimeoutOverride)&&void 0!==t?t:null===(n=this.joinConfig)||void 0===n?void 0:n.membershipServerSideExpiryTimeout)&&void 0!==e?e:8e3}get membershipKeepAlivePeriod(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.membershipKeepAlivePeriod)&&void 0!==e?e:5e3}get callMemberEventRetryJitter(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.callMemberEventRetryJitter)&&void 0!==e?e:2e3}constructor(e,t,n,o){var a=this;this.joinConfig=e,this.room=t,this.client=n,this.getOldestMembership=o,(0,i.A)(this,"relativeExpiry",void 0),(0,i.A)(this,"memberEventTimeout",void 0),(0,i.A)(this,"ownFociPreferred",void 0),(0,i.A)(this,"ownFocusActive",void 0),(0,i.A)(this,"updateCallMembershipRunning",!1),(0,i.A)(this,"needCallMembershipUpdate",!1),(0,i.A)(this,"membershipServerSideExpiryTimeoutOverride",void 0),(0,i.A)(this,"disconnectDelayId",void 0),(0,i.A)(this,"triggerCallMembershipEventUpdate",(0,r.A)((function*(){if(a.updateCallMembershipRunning)a.needCallMembershipUpdate=!0;else{a.updateCallMembershipRunning=!0;try{do{a.needCallMembershipUpdate=!1,yield a.updateCallMembershipEvent()}while(a.needCallMembershipUpdate)}finally{a.updateCallMembershipRunning=!1}}}))),(0,i.A)(this,"delayDisconnection",(0,r.A)((function*(){try{var e=a.disconnectDelayId;yield Ie((()=>a.client._unstable_updateDelayedEvent(e,we.e.Restart))),a.scheduleDelayDisconnection()}catch(e){v.v.error("Failed to delay our disconnection event:",e)}})))}isJoined(){return void 0!==this.relativeExpiry}join(e,t){this.ownFocusActive=t,this.ownFociPreferred=e,this.relativeExpiry=this.membershipExpiryTimeout,this.triggerCallMembershipEventUpdate()}leave(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:void 0;return t.relativeExpiry=void 0,t.ownFocusActive=void 0,t.memberEventTimeout&&(clearTimeout(t.memberEventTimeout),t.memberEventTimeout=void 0),n?"timeout"!==(yield Promise.race([t.triggerCallMembershipEventUpdate(),(0,h.yy)(n,"timeout")])):(yield t.triggerCallMembershipEventUpdate(),!0)}))()}onRTCSessionMemberUpdate(e){var t=this;return(0,r.A)((function*(){if(t.isJoined()&&!e.some((e=>e.sender===t.client.getUserId()&&e.deviceId===t.client.getDeviceId())))return v.v.warn("Missing own membership: force re-join"),t.triggerCallMembershipEventUpdate()}))()}getActiveFocus(){if(!this.ownFocusActive){var e=this.getOldestMembership();return null==e?void 0:e.getPreferredFoci()[0]}if(be(this.ownFocusActive)){if("oldest_membership"===this.ownFocusActive.focus_selection){var t=this.getOldestMembership();return null==t?void 0:t.getPreferredFoci()[0]}}else v.v.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.")}makeNewMembership(e){return this.isJoined()?this.makeMyMembership(e):{}}makeMyMembership(e){var t;return{call_id:"",scope:"m.room",application:"m.call",device_id:e,expires:this.relativeExpiry,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:null!==(t=this.ownFociPreferred)&&void 0!==t?t:[]}}updateCallMembershipEvent(){var e=this;return(0,r.A)((function*(){if(e.memberEventTimeout&&(clearTimeout(e.memberEventTimeout),e.memberEventTimeout=void 0),!e.room.getLiveTimeline().getState(p.q.FORWARDS))throw new Error("Couldn't get room state for room "+e.room.roomId);var t,n=e.client.getUserId(),i=e.client.getDeviceId();if(!n||!i)throw new Error("User ID or device ID was null!");t=e.makeNewMembership(i);try{if(e.isJoined()){var o=e.makeMembershipStateKey(n,i),a=function(){var t=(0,r.A)((function*(){try{var t=yield Ie((()=>e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.membershipServerSideExpiryTimeout},g.Bx.GroupCallMemberPrefix,{},o)));e.disconnectDelayId=t.delay_id}catch(t){if(t instanceof Ae.up&&"M_UNKNOWN"===t.errcode&&"M_MAX_DELAY_EXCEEDED"===t.data["org.matrix.msc4140.errcode"]){var n=t.data["org.matrix.msc4140.max_delay"];if("number"==typeof n&&e.membershipServerSideExpiryTimeout>n)return e.membershipServerSideExpiryTimeoutOverride=n,a()}v.v.error("Failed to prepare delayed disconnection event:",t)}}));return function(){return t.apply(this,arguments)}}();if(yield a(),yield Ie((()=>e.client.sendStateEvent(e.room.roomId,g.Bx.GroupCallMemberPrefix,t,o))),void 0!==e.disconnectDelayId)try{var s=e.disconnectDelayId;yield Ie((()=>e.client._unstable_updateDelayedEvent(s,we.e.Restart)))}catch(t){t instanceof Ae.up&&"M_NOT_FOUND"===t.errcode&&(v.v.warn("Failed to update delayed disconnection event, prepare it again:",t),e.disconnectDelayId=void 0,yield a())}void 0!==e.disconnectDelayId&&e.scheduleDelayDisconnection()}else{var l=!1;if(void 0!==e.disconnectDelayId){try{var c=e.disconnectDelayId;yield Ie((()=>e.client._unstable_updateDelayedEvent(c,we.e.Send))),l=!0}catch(e){v.v.error("Failed to send our delayed disconnection event:",e)}e.disconnectDelayId=void 0}l||(yield Ie((()=>e.client.sendStateEvent(e.room.roomId,g.Bx.GroupCallMemberPrefix,{},e.makeMembershipStateKey(n,i)))))}v.v.info("Sent updated call member event.")}catch(t){var d=e.callMemberEventRetryDelayMinimum+Math.random()*e.callMemberEventRetryJitter;v.v.warn("Failed to send call member event (retrying in ".concat(d,"): ").concat(t)),yield(0,h.yy)(d),yield e.triggerCallMembershipEventUpdate()}}))()}scheduleDelayDisconnection(){this.memberEventTimeout=setTimeout(this.delayDisconnection,this.membershipKeepAlivePeriod)}makeMembershipStateKey(e,t){var n="".concat(e,"_").concat(t);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?n:"_".concat(n)}}function Ie(e){return ke.apply(this,arguments)}function ke(){return ke=(0,r.A)((function*(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;;)try{return yield e()}catch(e){if(!(t>0&&e instanceof Ae.Hl&&e.isRateLimitError()))throw e;t--;var n=void 0,r=5e3;try{var i;n=null!==(i=e.getRetryAfterMs())&&void 0!==i?i:r,v.v.info("Rate limited by server, retrying in ".concat(n,"ms"))}catch(e){v.v.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(r),e),n=r}yield(0,h.yy)(n)}})),ke.apply(this,arguments)}var Oe=v.v.getChild("MatrixRTCSession");class Re{get updateEncryptionKeyThrottle(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.updateEncryptionKeyThrottle)&&void 0!==e?e:3e3}get makeKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.makeKeyDelay)&&void 0!==e?e:3e3}get useKeyDelay(){var e,t;return null!==(e=null===(t=this.joinConfig)||void 0===t?void 0:t.useKeyDelay)&&void 0!==e?e:5e3}constructor(e,t,n,o){var a=this;this.client=e,this.room=t,this.getMemberships=n,this.onEncryptionKeysChanged=o,(0,i.A)(this,"manageMediaKeys",!1),(0,i.A)(this,"keysEventUpdateTimeout",void 0),(0,i.A)(this,"makeNewKeyTimeout",void 0),(0,i.A)(this,"setNewKeyTimeouts",new Set),(0,i.A)(this,"encryptionKeys",new Map),(0,i.A)(this,"lastEncryptionKeyUpdateRequest",void 0),(0,i.A)(this,"lastMembershipFingerprints",void 0),(0,i.A)(this,"currentEncryptionKeyIndex",-1),(0,i.A)(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),(0,i.A)(this,"joinConfig",void 0),(0,i.A)(this,"joined",!1),(0,i.A)(this,"isMyMembership",(e=>e.sender===this.client.getUserId()&&e.deviceId===this.client.getDeviceId())),(0,i.A)(this,"sendEncryptionKeysEvent",function(){var e=(0,r.A)((function*(e){if(void 0!==a.keysEventUpdateTimeout&&(clearTimeout(a.keysEventUpdateTimeout),a.keysEventUpdateTimeout=void 0),a.lastEncryptionKeyUpdateRequest=Date.now(),a.joined){Oe.info("Sending encryption keys event. indexToSend=".concat(e));var t=a.client.getUserId(),n=a.client.getDeviceId();if(!t)throw new Error("No userId");if(!n)throw new Error("No deviceId");var r=a.getKeysForParticipant(t,n);if(r)if("number"==typeof e||-1!==a.currentEncryptionKeyIndex){var i=null!=e?e:a.currentEncryptionKeyIndex,o=r[i];try{var s={keys:[{index:i,key:(0,k.PP)(o)}],device_id:n,call_id:"",sent_ts:Date.now()};a.statistics.counters.roomEventEncryptionKeysSent+=1,yield a.client.sendEvent(a.room.roomId,g.Bx.CallEncryptionKeysPrefix,s),Oe.debug("Embedded-E2EE-LOG updateEncryptionKeyEvent participantId=".concat(t,":").concat(n," numKeys=").concat(r.length," currentKeyIndex=").concat(a.currentEncryptionKeyIndex," keyIndexToSend=").concat(i),a.encryptionKeys)}catch(e){var l=e;if(l.event&&a.client.cancelPendingEvent(l.event),void 0===a.keysEventUpdateTimeout){var c=(0,Ae.eM)(l,5e3);Oe.warn("Failed to send m.call.encryption_key, retrying in ".concat(c),e),a.keysEventUpdateTimeout=setTimeout(a.sendEncryptionKeysEvent,c)}else Oe.info("Not scheduling key resend as another re-send is already pending")}}else Oe.warn("Tried to send encryption keys event but no current key index found!");else Oe.warn("Tried to send encryption keys event but no keys found!")}}));return function(t){return e.apply(this,arguments)}}()),(0,i.A)(this,"onCallEncryptionEventReceived",(e=>{var t=e.getSender(),n=e.getContent(),r=n.device_id,i=n.call_id;if(t)if(""===i)if(Array.isArray(n.keys))if(t!==this.client.getUserId()||r!==this.client.getDeviceId()){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-("number"==typeof n.sent_ts?n.sent_ts:e.getTs());for(var a of(this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o,n.keys))if(a){var s=a.key,l=a.index;s&&null!=l&&null!=i&&"string"==typeof r&&"string"==typeof i&&"string"==typeof s&&"number"==typeof l?(Oe.debug("Embedded-E2EE-LOG onCallEncryption userId=".concat(t,":").concat(r," encryptionKeyIndex=").concat(l," age=").concat(o,"ms"),this.encryptionKeys),this.setEncryptionKey(t,r,l,s,e.getTs())):Oe.warn("Malformed call encryption_key: userId=".concat(t,", deviceId=").concat(r,", encryptionKeyIndex=").concat(l," callId=").concat(i))}else Oe.info("Ignoring false-y key in keys event")}else Oe.info("Ignoring our own keys event");else Oe.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(i));else Oe.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(t,", deviceId=").concat(r,", callId=").concat(i));else Oe.warn("Received m.call.encryption_keys with no userId: callId=".concat(i))})),(0,i.A)(this,"onRotateKeyTimeout",(()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,Oe.info("Making new sender key for key rotation");var e=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(e)}}))}getEncryptionKeys(){return this.encryptionKeys}join(e){var t,n,r;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=null!==(t=null===(n=this.joinConfig)||void 0===n?void 0:n.manageMediaKeys)&&void 0!==t?t:this.manageMediaKeys,null!==(r=this.joinConfig)&&void 0!==r&&r.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){var e=this.client.getUserId(),t=this.client.getDeviceId();if(!e)throw new Error("No userId");if(!t)throw new Error("No deviceId");for(var n of(this.encryptionKeys.set(xe(e,t),[]),void 0!==this.makeNewKeyTimeout&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0),this.setNewKeyTimeouts))clearTimeout(n);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){var t=this;return(0,r.A)((function*(){if(t.manageMediaKeys&&t.joined){var n=new Set(e.filter((e=>!t.isMyMembership(e))).map(Ne)),r=new Set(t.getMemberships().filter((e=>!t.isMyMembership(e))).map(Ne)),i=Array.from(n).some((e=>!r.has(e))),o=Array.from(r).some((e=>!n.has(e))),a=t.lastMembershipFingerprints;if(t.storeLastMembershipFingerprints(),i)t.makeNewKeyTimeout||(Oe.debug("Member(s) have left: queueing sender key rotation"),t.makeNewKeyTimeout=setTimeout(t.onRotateKeyTimeout,t.makeKeyDelay));else if(o)Oe.debug("New member(s) have joined: re-sending keys"),t.requestSendCurrentKey();else if(a){var s=t.lastMembershipFingerprints;(Array.from(a).some((e=>!s.has(e)))||Array.from(s).some((e=>!a.has(e))))&&(Oe.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),t.requestSendCurrentKey())}}}))()}makeNewSenderKey(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.client.getUserId(),n=this.client.getDeviceId();if(!t)throw new Error("No userId");if(!n)throw new Error("No deviceId");var r=(0,K.rl)(16),i=this.getNewEncryptionKeyIndex();return Oe.info("Generated new key at index "+i),this.setEncryptionKey(t,n,i,r,Date.now(),e),i}requestSendCurrentKey(){if(this.manageMediaKeys)return this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now()?(Oe.info("Last encryption key event sent too recently: postponing"),void(void 0===this.keysEventUpdateTimeout&&(this.keysEventUpdateTimeout=setTimeout(this.sendEncryptionKeysEvent,this.updateEncryptionKeyThrottle)))):void this.sendEncryptionKeysEvent()}getKeysForParticipant(e,t){var n;return null===(n=this.encryptionKeys.get(xe(e,t)))||void 0===n?void 0:n.map((e=>e.key))}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter((e=>!this.isMyMembership(e))).map((e=>"".concat(Ne(e),":").concat(e.createdTs()))))}getNewEncryptionKeyIndex(){return-1===this.currentEncryptionKeyIndex?0:(this.currentEncryptionKeyIndex+1)%256}setEncryptionKey(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=(0,k.y4)(r),s=xe(e,t);this.encryptionKeys.has(s)||this.encryptionKeys.set(s,[]);var l,c,d=this.encryptionKeys.get(s),u=d[n];if(u){if(u.timestamp>i)return void Oe.info("Ignoring new key at index ".concat(n," for ").concat(s," as it is older than existing known key"));if((l=u.key)===(c=a)||l&&c&&l.length===c.length&&l.every(((e,t)=>e===c[t])))return void(u.timestamp=i)}if(d[n]={key:a,timestamp:i},o){var h=setTimeout((()=>{this.setNewKeyTimeouts.delete(h),Oe.info("Delayed-emitting key changed event for ".concat(s," idx ").concat(n)),e===this.client.getUserId()&&t===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=n),this.onEncryptionKeysChanged(a,n,s)}),this.useKeyDelay);this.setNewKeyTimeouts.add(h)}else e===this.client.getUserId()&&t===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=n),this.onEncryptionKeysChanged(a,n,s)}}var xe=(e,t)=>"".concat(e,":").concat(t),Ne=e=>xe(e.sender,e.deviceId),De=v.v.getChild("MatrixRTCSession"),Le=function(e){return e.MembershipsChanged="memberships_changed",e.JoinStateChanged="join_state_changed",e.EncryptionKeyChanged="encryption_key_changed",e}({});class Pe extends oe.X{get statistics(){return this.encryptionManager.statistics}get callId(){return this._callId}static callMembershipsForRoom(e){var t=e.getLiveTimeline().getState(p.q.FORWARDS);if(!t)throw De.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);var n=t.getStateEvents(g.Bx.GroupCallMemberPrefix),r=[];for(var i of n){var o=i.getContent(),a=Object.keys(o).length;if(0!==a){var s=[];if(a>1&&"focus_active"in o?s.push(o):1===a&&"memberships"in o&&De.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),0!==s.length)for(var l of s)try{var c,d=new Ce(i,l);if(""!==d.callId||"m.room"!==d.scope){De.info("Ignoring user-scoped call");continue}if(d.isExpired()){De.info("Ignoring expired device membership ".concat(d.sender,"/").concat(d.deviceId));continue}if(!e.hasMembershipState(null!==(c=d.sender)&&void 0!==c?c:"",J.O.Join)){De.info("Ignoring membership of user ".concat(d.sender," who is not in the room."));continue}r.push(d)}catch(e){De.warn("Couldn't construct call membership: ",e)}}}return r.sort(((e,t)=>e.createdTs()-t.createdTs())),r.length>1&&De.debug("Call memberships in room ".concat(e.roomId,", in order: "),r.map((e=>[e.createdTs(),e.sender]))),r}static roomSessionForRoom(e,t){var n=Pe.callMembershipsForRoom(t);return new Pe(e,t,n)}constructor(e,t,n){var r;super(),this.client=e,this.room=t,this.memberships=n,(0,i.A)(this,"membershipManager",void 0),(0,i.A)(this,"encryptionManager",void 0),(0,i.A)(this,"_callId",void 0),(0,i.A)(this,"expiryTimeout",void 0),(0,i.A)(this,"onCallEncryption",(e=>{this.encryptionManager.onCallEncryptionEventReceived(e)})),(0,i.A)(this,"onMembershipUpdate",(()=>{this.recalculateSessionMembers()})),(0,i.A)(this,"onRoomMemberUpdate",(()=>{this.recalculateSessionMembers()})),(0,i.A)(this,"onRTCSessionMemberUpdate",(()=>{this.recalculateSessionMembers()})),(0,i.A)(this,"recalculateSessionMembers",(()=>{var e,t,n,r=this.memberships;this.memberships=Pe.callMembershipsForRoom(this.room),this._callId=null!==(e=this._callId)&&void 0!==e?e:null===(t=this.memberships[0])||void 0===t?void 0:t.callId,(r.length!=this.memberships.length||r.some(((e,t)=>!Ce.equal(e,this.memberships[t]))))&&(De.info("Memberships for call in room ".concat(this.room.roomId," have changed: emitting")),this.emit(Le.MembershipsChanged,r,this.memberships),null===(n=this.membershipManager)||void 0===n||n.onRTCSessionMemberUpdate(this.memberships)),this.encryptionManager.onMembershipsUpdate(r),this.setExpiryTimer()})),this._callId=null===(r=n[0])||void 0===r?void 0:r.callId;var o=this.room.getLiveTimeline().getState(p.q.FORWARDS);null==o||o.on(Ee.f.Members,this.onRoomMemberUpdate),this.setExpiryTimer(),this.encryptionManager=new Re(this.client,this.room,(()=>this.memberships),((e,t,n)=>{this.emit(Le.EncryptionKeyChanged,e,t,n)}))}isJoined(){var e,t;return null!==(e=null===(t=this.membershipManager)||void 0===t?void 0:t.isJoined())&&void 0!==e&&e}stop(){var e=this;return(0,r.A)((function*(){var t;yield null===(t=e.membershipManager)||void 0===t?void 0:t.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0);var n=e.room.getLiveTimeline().getState(p.q.FORWARDS);null==n||n.off(Ee.f.Members,e.onRoomMemberUpdate)}))()}joinRoomSession(e,t,n){this.isJoined()?De.info("Already joined to session in room ".concat(this.room.roomId,": ignoring join call")):(this.membershipManager=new Te(n,this.room,this.client,(()=>this.getOldestMembership())),this.membershipManager.join(e,t),this.encryptionManager.join(n),this.emit(Le.JoinStateChanged,!0))}leaveRoomSession(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:void 0;if(!t.isJoined())return De.info("Not joined to session in room ".concat(t.room.roomId,": ignoring leave call")),!1;De.info("Leaving call session in room ".concat(t.room.roomId)),t.encryptionManager.leave();var r=t.membershipManager.leave(n);return t.emit(Le.JoinStateChanged,!1),yield r}))()}getActiveFocus(){var e;return null===(e=this.membershipManager)||void 0===e?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getFocusInUse(){var e=this.getOldestMembership();if("oldest_membership"===(null==e?void 0:e.getFocusSelection()))return e.getPreferredFoci()[0]}reemitEncryptionKeys(){this.encryptionManager.getEncryptionKeys().forEach(((e,t)=>{e.forEach(((e,n)=>{this.emit(Le.EncryptionKeyChanged,e.key,n,t)}))}))}getEncryptionKeys(){var e,t=null!==(e=this.encryptionManager.getEncryptionKeys())&&void 0!==e?e:new Map;return Array.from(t.entries()).map((e=>{var[t,n]=e;return[t,n.map((e=>e.key))]})).values()}setExpiryTimer(){var e;for(var t of(this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0),this.memberships)){var n=t.getMsUntilExpiry();void 0!==n&&(void 0===e||n<e)&&(e=n)}null!=e&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}}var Me=v.v.getChild("MatrixRTCSessionManager"),Ue=function(e){return e.SessionStarted="session_started",e.SessionEnded="session_ended",e}({});class Fe extends oe.X{constructor(e){super(),this.client=e,(0,i.A)(this,"roomSessions",new Map),(0,i.A)(this,"onTimeline",(e=>{this.consumeCallEncryptionEvent(e)})),(0,i.A)(this,"onRoom",(e=>{this.refreshRoom(e)})),(0,i.A)(this,"onRoomState",((e,t)=>{var n=this.client.getRoom(e.getRoomId());n?e.getType()==g.Bx.GroupCallMemberPrefix&&this.refreshRoom(n):Me.error("Got room state event for unknown room ".concat(e.getRoomId(),"!"))}))}start(){for(var e of null!==(t=this.client.getRooms())&&void 0!==t?t:[]){var t,n=Pe.roomSessionForRoom(this.client,e);n.memberships.length>0&&this.roomSessions.set(e.roomId,n)}this.client.on(it.Room,this.onRoom),this.client.on(B.u9.Timeline,this.onTimeline),this.client.on(Ee.f.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(it.Room,this.onRoom),this.client.off(B.u9.Timeline,this.onTimeline),this.client.off(Ee.f.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Pe.roomSessionForRoom(this.client,e)),this.roomSessions.get(e.roomId)}consumeCallEncryptionEvent(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];if(yield n.client.decryptEventIfNeeded(e),e.isDecryptionFailure())r?Me.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(Me.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout((()=>n.consumeCallEncryptionEvent(e,!0)),1e3));else{if(r&&Me.info("Decryption succeeded for event ".concat(e.getId()," after retry")),e.getType()!==g.Bx.CallEncryptionKeysPrefix)return Promise.resolve();var i=n.client.getRoom(e.getRoomId());if(!i)return Me.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve();n.getRoomSession(i).onCallEncryption(e)}}))()}refreshRoom(e){var t=!this.roomSessions.has(e.roomId),n=this.getRoomSession(e),r=n.memberships.length>0&&!t;n.onRTCSessionMemberUpdate();var i=n.memberships.length>0;r&&!i?this.emit(Ue.SessionEnded,e.roomId,this.roomSessions.get(e.roomId)):!r&&i&&this.emit(Ue.SessionStarted,e.roomId,this.roomSessions.get(e.roomId))}}function Be(e){return t=>{var n,r;return(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n.event_id)!==e||(null===(r=t.content)||void 0===r||null===(r=r["m.relates_to"])||void 0===r?void 0:r.rel_type)===le.RN.name}}var Ge=n(7545),$e=n(5792),Ve=n(4304),je=n(4047),Ke=["server","limit","since"];function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var He=(0,N.DM)(),Ye=6e5,ze=new de.qr("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),Je=function(e){return e.Chronological="chronological",e.Detached="detached",e}({}),Xe=new de.xu("m.get_login_token","org.matrix.msc3882.get_login_token"),Qe="uk.half-shot.msc2666",Ze="uk.half-shot.msc2666.mutual_rooms",et="uk.half-shot.msc2666.query_mutual_rooms",tt="org.matrix.msc4140",nt="uk.tcpip.msc4133",rt="$",it=function(e){return e.Sync="sync",e.Event="event",e.ToDeviceEvent="toDeviceEvent",e.AccountData="accountData",e.Room="Room",e.DeleteRoom="deleteRoom",e.SyncUnexpectedError="sync.unexpectedError",e.ClientWellKnown="WellKnown.client",e.ReceivedVoipEvent="received_voip_event",e.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",e.TurnServers="turnServers",e.TurnServersError="turnServers.error",e}({}),ot=new de.qr("action","org.matrix.msc3824.action");class at extends oe.X{constructor(e){var t,n,o,c;super(),o=this,(0,i.A)(this,"logger",void 0),(0,i.A)(this,"reEmitter",new O.Q(this)),(0,i.A)(this,"olmVersion",null),(0,i.A)(this,"usingExternalCrypto",!1),(0,i.A)(this,"_store",void 0),(0,i.A)(this,"deviceId",void 0),(0,i.A)(this,"credentials",void 0),(0,i.A)(this,"pickleKey",void 0),(0,i.A)(this,"scheduler",void 0),(0,i.A)(this,"clientRunning",!1),(0,i.A)(this,"timelineSupport",!1),(0,i.A)(this,"urlPreviewCache",{}),(0,i.A)(this,"identityServer",void 0),(0,i.A)(this,"http",void 0),(0,i.A)(this,"crypto",void 0),(0,i.A)(this,"cryptoBackend",void 0),(0,i.A)(this,"cryptoCallbacks",void 0),(0,i.A)(this,"callEventHandler",void 0),(0,i.A)(this,"groupCallEventHandler",void 0),(0,i.A)(this,"supportsCallTransfer",!1),(0,i.A)(this,"forceTURN",!1),(0,i.A)(this,"iceCandidatePoolSize",0),(0,i.A)(this,"idBaseUrl",void 0),(0,i.A)(this,"baseUrl",void 0),(0,i.A)(this,"isVoipWithNoMediaAllowed",void 0),(0,i.A)(this,"useLivekitForGroupCalls",void 0),(0,i.A)(this,"canSupportVoip",!1),(0,i.A)(this,"peekSync",null),(0,i.A)(this,"isGuestAccount",!1),(0,i.A)(this,"ongoingScrollbacks",{}),(0,i.A)(this,"notifTimelineSet",null),(0,i.A)(this,"cryptoStore",void 0),(0,i.A)(this,"verificationMethods",void 0),(0,i.A)(this,"fallbackICEServerAllowed",!1),(0,i.A)(this,"syncApi",void 0),(0,i.A)(this,"roomNameGenerator",void 0),(0,i.A)(this,"pushRules",void 0),(0,i.A)(this,"syncLeftRoomsPromise",void 0),(0,i.A)(this,"syncedLeftRooms",!1),(0,i.A)(this,"clientOpts",void 0),(0,i.A)(this,"clientWellKnownIntervalID",void 0),(0,i.A)(this,"canResetTimelineCallback",void 0),(0,i.A)(this,"canSupport",new Map),(0,i.A)(this,"pushProcessor",new T(this)),(0,i.A)(this,"serverVersionsPromise",void 0),(0,i.A)(this,"clientWellKnown",void 0),(0,i.A)(this,"clientWellKnownPromise",void 0),(0,i.A)(this,"turnServers",[]),(0,i.A)(this,"turnServersExpiry",0),(0,i.A)(this,"checkTurnServersIntervalID",void 0),(0,i.A)(this,"exportedOlmDeviceToImport",void 0),(0,i.A)(this,"txnCtr",0),(0,i.A)(this,"mediaHandler",new ie.L(this)),(0,i.A)(this,"sessionId",void 0),(0,i.A)(this,"eventsBeingEncrypted",new Set),(0,i.A)(this,"useE2eForGroupCall",!0),(0,i.A)(this,"toDeviceMessageQueue",void 0),(0,i.A)(this,"livekitServiceURL",void 0),(0,i.A)(this,"_secretStorage",void 0),(0,i.A)(this,"ignoredInvites",void 0),(0,i.A)(this,"matrixRTC",void 0),(0,i.A)(this,"serverCapabilitiesService",void 0),(0,i.A)(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&((0,l.sj)()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(it.Sync,this.startCallEventHandler))})),(0,i.A)(this,"startMatrixRTC",(()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(it.Sync,this.startMatrixRTC))})),(0,i.A)(this,"fixupRoomNotifications",(()=>{if(this.isInitialSyncComplete()){var e,t=(null!==(e=this.getRooms())&&void 0!==e?e:[]).filter((e=>e.getUnreadNotificationCount(B.X5.Total)>0));for(var n of t){var r=this.getSafeUserId();n.fixupNotifications(r)}this.off(it.Sync,this.fixupRoomNotifications)}})),this.logger=null!==(t=e.logger)&&void 0!==t?t:v.v,e.baseUrl=h.hc(e.baseUrl),e.idBaseUrl=h.hc(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=null!==(n=e.usingExternalCrypto)&&void 0!==n&&n,this.store=e.store||new s,this.deviceId=e.deviceId||null,this.sessionId=(0,K.US)(10);var p=e.userId||null;this.credentials={userId:p},this.http=new x.ED(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:x.iD.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.deviceToImport?this.deviceId?this.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?this.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):this.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.useLivekitForGroupCalls=Boolean(e.useLivekitForGroupCalls),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(function(){var e=(0,r.A)((function*(e){var t=o.getRoom(e.getRoomId());e.status!==a.fb.SENDING&&o.updatePendingEventStatus(t,e,a.fb.SENDING);var n=yield o.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,a.fb.SENT,n.event_id),n}));return function(t){return e.apply(this,arguments)}}()),(0,l.sj)()&&(this.callEventHandler=new d.N(this),this.groupCallEventHandler=new u.e(this),this.canSupportVoip=!0,this.on(it.Sync,this.startCallEventHandler)),this.matrixRTC=new Fe(this),this.serverCapabilitiesService=new Ge.K(this.http),this.on(it.Sync,this.fixupRoomNotifications),this.timelineSupport=Boolean(e.timelineSupport),this.cryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,void 0!==e.useE2eForGroupCall&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new he(this),this.on(a.OQ.Decrypted,(e=>{lt(this,e)})),this.ignoredInvites=new me(this),this._secretStorage=new _e.ServerSideSecretStorageImpl(this,null!==(c=e.cryptoCallbacks)&&void 0!==c?c:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator((e=>D.K.createUser(e,this)))}get store(){return this._store}startClient(e){var t=this;return(0,r.A)((function*(){if(!t.clientRunning){t.clientRunning=!0,t.on(it.Sync,t.startMatrixRTC);var n=t.getUserId();n&&t.store.storeUser(new D.K(n)),t.canSupportVoip&&(t.checkTurnServersIntervalID=setInterval((()=>{t.checkTurnServers()}),Ye),t.checkTurnServers()),t.syncApi&&(t.logger.error("Still have sync object whilst not running: stopping old one"),t.syncApi.stop());try{yield t.getVersions();var{threads:r,list:i,fwdPagination:a}=yield t.doesServerSupportThread();le.jV.setServerSideSupport(r),le.jV.setServerSideListSupport(i),le.jV.setServerSideFwdPaginationSupport(a)}catch(e){t.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",e)}t.clientOpts=null!=e?e:{},t.clientOpts.slidingSync?t.syncApi=new se.m(t.clientOpts.slidingSync,t,t.clientOpts,t.buildSyncApiOptions()):t.syncApi=new o.w_(t,t.clientOpts,t.buildSyncApiOptions()),t.syncApi.sync().catch((e=>t.logger.info("Sync startup aborted with an error:",e))),void 0!==t.clientOpts.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval((()=>{t.fetchClientWellKnown()}),1e3*t.clientOpts.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.toDeviceMessageQueue.start(),t.serverCapabilitiesService.start()}}))()}buildSyncApiOptions(){return{crypto:this.crypto,cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e)}}stopClient(){var e,t,n,r,i;null===(e=this.cryptoBackend)||void 0===e||e.stop(),this.off(it.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,null===(t=this.syncApi)||void 0===t||t.stop(),this.syncApi=void 0,null===(n=this.peekSync)||void 0===n||n.stopPeeking(),null===(r=this.callEventHandler)||void 0===r||r.stop(),null===(i=this.groupCallEventHandler)||void 0===i||i.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,void 0!==this.clientWellKnownIntervalID&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}rehydrateDevice(){var e=this;return(0,r.A)((function*(){if(e.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(e.cryptoCallbacks.getDehydrationKey){var t=yield e.getDehydratedDevice();if(t)if(t.device_data&&t.device_id){var n=new globalThis.Olm.Account;try{var r=t.device_data;if(r.algorithm!==M.S)return void e.logger.warn("Wrong algorithm for dehydrated device");e.logger.debug("unpickling dehydrated device");var i=yield e.cryptoCallbacks.getDehydrationKey(r,(e=>{n.unpickle(new Uint8Array(e),r.account)}));if(n.unpickle(i,r.account),e.logger.debug("unpickled device"),(yield e.http.authedRequest(x.IT.Post,"/dehydrated_device/claim",void 0,{device_id:t.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){e.deviceId=t.device_id,e.logger.info("using dehydrated device");var o=e.pickleKey||"DEFAULT_KEY";return e.exportedOlmDeviceToImport={pickledAccount:n.pickle(o),sessions:[],pickleKey:o},n.free(),e.deviceId}return n.free(),void e.logger.info("not using dehydrated device")}catch(t){n.free(),e.logger.warn("could not unpickle",t)}}else e.logger.info("no dehydrated device found")}}))()}getDehydratedDevice(){var e=this;return(0,r.A)((function*(){try{return yield e.http.authedRequest(x.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(t){return void e.logger.info("could not get dehydrated device",t)}}))()}setDehydrationKey(e,t,n){var i=this;return(0,r.A)((function*(){if(i.crypto)return i.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,n);i.logger.warn("not dehydrating device if crypto is not enabled")}))()}createDehydratedDevice(e,t,n){var i=this;return(0,r.A)((function*(){if(i.crypto)return yield i.crypto.dehydrationManager.setKey(e,t,n),i.crypto.dehydrationManager.dehydrateDevice();i.logger.warn("not dehydrating device if crypto is not enabled")}))()}exportDevice(){var e=this;return(0,r.A)((function*(){if(e.crypto)return{userId:e.credentials.userId,deviceId:e.deviceId,olmDevice:yield e.crypto.olmDevice.export()};e.logger.warn("not exporting device if crypto is not enabled")}))()}clearStores(){var e=this;if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var t=[];t.push(this.store.deleteAllData()),this.cryptoStore&&t.push(this.cryptoStore.deleteAllData());var n=function(){var t=(0,r.A)((function*(){var t;try{if(!(t=globalThis.indexedDB))return}catch(e){return}var n=function*(n){var r=new Promise(((r,i)=>{e.logger.info("Removing IndexedDB instance ".concat(n));var o=t.deleteDatabase(n);o.onsuccess=t=>{e.logger.info("Removed IndexedDB instance ".concat(n)),r(0)},o.onerror=t=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(n,":"),t),r(0)},o.onblocked=t=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(n))}}));yield r};for(var r of["".concat(fe,"::matrix-sdk-crypto"),"".concat(fe,"::matrix-sdk-crypto-meta")])yield*n(r)}));return function(){return t.apply(this,arguments)}}();return t.push(n()),Promise.all(t).then()}getUserId(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t?void 0:t.userId)&&void 0!==e?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return null!==(e=this.credentials)&&void 0!==e&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,t;return null!==(e=null===(t=this.credentials)||void 0===t||null===(t=t.userId)||void 0===t?void 0:t.split(":")[0].substring(1))&&void 0!==e?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return(0,l.sv)(this,e)}createGroupCall(e,t,n,i,o,a){var s=this;return(0,r.A)((function*(){if(s.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var r=s.getRoom(e);if(!r)throw new Error("Cannot find room ".concat(e));return new re.eO(s,r,t,n,i,void 0,o||s.isVoipWithNoMediaAllowed,a,s.isVoipWithNoMediaAllowed,s.useLivekitForGroupCalls,s.livekitServiceURL).create()}))()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,t;return null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.getSyncState())&&void 0!==e?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return!!e&&(e===o.Lm.Prepared||e===o.Lm.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,t;return this.toDeviceMessageQueue.sendQueue(),null!==(e=null===(t=this.syncApi)||void 0===t?void 0:t.retryImmediately())&&void 0!==e&&e}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return(0,r.A)((function*(){return e.serverCapabilitiesService.getCachedCapabilities()||e.serverCapabilitiesService.fetchCapabilities()}))()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initLegacyCrypto(){var e=this;return(0,r.A)((function*(){if(!(0,N.DM)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(e.cryptoBackend)e.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");else{if(!e.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");e.logger.debug("Crypto: Starting up crypto store..."),yield e.cryptoStore.startup();var t=e.getUserId();if(null===t)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===e.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");var n=new N.Qr(e,t,e.deviceId,e.store,e.cryptoStore,e.verificationMethods);e.reEmitter.reEmit(n,[N.cr.KeyBackupFailed,N.cr.KeyBackupSessionsRemaining,N.cr.RoomKeyRequest,N.cr.RoomKeyRequestCancellation,N.cr.Warning,N.cr.DevicesUpdated,N.cr.WillUpdateDevices,N.cr.DeviceVerificationChanged,N.cr.UserTrustStatusChanged,N.cr.KeysChanged]),e.logger.debug("Crypto: initialising crypto object..."),yield n.init({exportedOlmDevice:e.exportedOlmDeviceToImport,pickleKey:e.pickleKey}),delete e.exportedOlmDeviceToImport,e.olmVersion=N.Qr.getOlmVersion(),n.registerEventHandlers(e),e.cryptoBackend=e.crypto=n,e.crypto.uploadDeviceKeys().catch((t=>{e.logger.error("Error uploading device keys",t)}))}}))()}initRustCrypto(){var e=arguments,t=this;return(0,r.A)((function*(){var r,i=e.length>0&&void 0!==e[0]?e[0]:{};if(t.cryptoBackend)t.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");else{var o=t.getUserId();if(null===o)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var a=t.getDeviceId();if(null===a)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");t.logger.debug("Downloading Rust crypto library");var s=yield n.e(669).then(n.bind(n,3669)),l=yield s.initRustCrypto({logger:t.logger,http:t.http,userId:o,deviceId:a,secretStorage:t.secretStorage,cryptoCallbacks:t.cryptoCallbacks,storePrefix:!1===i.useIndexedDB?null:fe,storeKey:i.storageKey,storePassphrase:i.storagePassword,legacyCryptoStore:t.cryptoStore,legacyPickleKey:null!==(r=t.pickleKey)&&void 0!==r?r:"DEFAULT_KEY",legacyMigrationProgressListener:(e,n)=>{t.emit(ye.CryptoEvent.LegacyCryptoStoreMigrationProgress,e,n)}});l.setSupportedVerificationMethods(t.verificationMethods),t.cryptoBackend=l,t.on(G.o.Membership,l.onRoomMembership.bind(l)),t.on(it.Event,(e=>{l.onLiveEventFromSync(e)})),t.reEmitter.reEmit(l,[ye.CryptoEvent.VerificationRequestReceived,ye.CryptoEvent.UserTrustStatusChanged,ye.CryptoEvent.KeyBackupStatus,ye.CryptoEvent.KeyBackupSessionsRemaining,ye.CryptoEvent.KeyBackupFailed,ye.CryptoEvent.KeyBackupDecryptionKeyCached,ye.CryptoEvent.KeysChanged,ye.CryptoEvent.DevicesUpdated,ye.CryptoEvent.WillUpdateDevices,ye.CryptoEvent.DehydratedDeviceCreated,ye.CryptoEvent.DehydratedDeviceUploaded,ye.CryptoEvent.RehydrationStarted,ye.CryptoEvent.RehydrationProgress,ye.CryptoEvent.RehydrationCompleted,ye.CryptoEvent.RehydrationError,ye.CryptoEvent.DehydrationKeyCached,ye.CryptoEvent.DehydratedDeviceRotationError])}}))()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isCryptoEnabled(){return!!this.cryptoBackend}getDeviceEd25519Key(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceEd25519Key())&&void 0!==e?e:null}getDeviceCurve25519Key(){var e,t;return null!==(e=null===(t=this.crypto)||void 0===t?void 0:t.getDeviceCurve25519Key())&&void 0!==e?e:null}uploadKeys(){var e=this;return(0,r.A)((function*(){e.logger.warn("MatrixClient.uploadKeys is deprecated")}))()}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.setDeviceVerification(e,t,n,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),r}setDeviceBlocked(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,n,null)}setDeviceKnown(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.setDeviceVerification(e,t,null,null,n)}setDeviceVerification(e,t,n,i,o){var a=this;return(0,r.A)((function*(){if(!a.crypto)throw new Error("End-to-end encryption disabled");yield a.crypto.setDeviceVerification(e,t,n,i,o)}))()}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");if(this.crypto)return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,n)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices=e,e}getGlobalBlacklistUnverifiedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalErrorOnUnknownDevices}getCrossSigningId(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.n.Master;if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}checkIfOwnDeviceCrossSigned(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(e)}checkOwnCrossSigningTrust(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,n)}prepareToEncrypt(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.prepareToEncrypt(e)}userHasCrossSigningKeys(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.userHasCrossSigningKeys()}isCrossSigningReady(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.setTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,n){return this.secretStorage.addKey(e,t,n)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}storeSecret(e,t,n){return this.secretStorage.store(e,t,n)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}getEventSenderDeviceInfo(e){var t=this;return(0,r.A)((function*(){return t.crypto?t.crypto.getEventSenderDeviceInfo(e):null}))()}isEventSenderVerified(e){var t=this;return(0,r.A)((function*(){var n=yield t.getEventSenderDeviceInfo(e);return!!n&&n.isVerified()}))()}getOutgoingRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");var t=e.getWireContent(),n={session_id:t.session_id,sender_key:t.sender_key,algorithm:t.algorithm,room_id:e.getRoomId()};return n.session_id&&n.sender_key&&n.algorithm&&n.room_id?this.crypto.cryptoStore.getOutgoingRoomKeyRequest(n):Promise.resolve(null)}cancelAndResendEventRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){var t,n,r=this.getRoom(e);return!!r&&(!!r.hasEncryptionStateEvent()||null!==(t=null===(n=this.crypto)||void 0===n?void 0:n.isRoomEncrypted(e))&&void 0!==t&&t)}encryptAndSendToDevices(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(e,t)}forceDiscardSession(e){if(!this.cryptoBackend)throw new Error("End-to-End encryption disabled");this.cryptoBackend.forceDiscardSession(e)}exportRoomKeys(){return this.cryptoBackend?this.cryptoBackend.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.importRoomKeys(e,t)}checkKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.checkKeyBackup()}getKeyBackupVersion(){var e=this;return(0,r.A)((function*(){var t;try{t=yield e.http.authedRequest(x.IT.Get,"/room_keys/version",void 0,void 0,{prefix:x.iD.V3})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}return W.IO.checkBackupVersion(t),t}))()}isKeyBackupTrusted(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}prepareKeyBackupVersion(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{secureSecretStorage:!1};if(!n.crypto)throw new Error("End-to-end encryption disabled");var{algorithm:i,auth_data:o,recovery_key:a,privateKey:s}=yield n.crypto.backupManager.prepareKeyBackupVersion(e);return r.secureSecretStorage&&(yield n.secretStorage.store("m.megolm_backup.v1",(0,k.WG)(s)),n.logger.info("Key backup private key stored in secret storage")),{algorithm:i,auth_data:o,recovery_key:a}}))()}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}createKeyBackupVersion(e){var t=this;return(0,r.A)((function*(){if(!t.crypto)throw new Error("End-to-end encryption disabled");yield t.crypto.backupManager.createKeyBackupVersion(e);var n={algorithm:e.algorithm,auth_data:e.auth_data};yield t.crypto.signObject(n.auth_data),t.cryptoCallbacks.getCrossSigningKey&&t.crypto.crossSigningInfo.getId()&&(yield t.crypto.crossSigningInfo.signObject(n.auth_data,"master"));var r=yield t.http.authedRequest(x.IT.Post,"/room_keys/version",void 0,n);return yield t.checkKeyBackup(),t.getKeyBackupEnabled()||t.logger.error("Key backup not usable even though we just created it"),r}))()}deleteKeyBackupVersion(e){var t=this;return(0,r.A)((function*(){if(!t.cryptoBackend)throw new Error("End-to-end encryption disabled");yield t.cryptoBackend.deleteKeyBackupVersion(e)}))()}makeKeyBackupPath(e,t,n){return{path:void 0!==t?h.RR("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?h.RR("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",queryData:void 0===n?void 0:{version:n}}}sendKeyBackup(e,t,n,i){var o=this;return(0,r.A)((function*(){if(!o.crypto)throw new Error("End-to-end encryption disabled");var r=o.makeKeyBackupPath(e,t,n);yield o.http.authedRequest(x.IT.Put,r.path,r.queryData,i,{prefix:x.iD.V3})}))()}scheduleAllGroupSessionsForBackup(){var e=this;return(0,r.A)((function*(){if(!e.crypto)throw new Error("End-to-end encryption disabled");yield e.crypto.backupManager.scheduleAllGroupSessionsForBackup()}))()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return(0,ye.decodeRecoveryKey)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return(0,Ve.c)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return(0,ye.decodeRecoveryKey)(e)}restoreKeyBackupWithPassword(e,t,n,i,o){var a=this;return(0,r.A)((function*(){var r=yield(0,Ve.c)(i.auth_data,e);return a.restoreKeyBackup(r,t,n,i,o)}))()}restoreKeyBackupWithSecretStorage(e,t,n,i){var o=this;return(0,r.A)((function*(){if(!o.cryptoBackend)throw new Error("End-to-end encryption disabled");var r=yield o.secretStorage.get("m.megolm_backup.v1"),a=(0,N.D$)(r);if(a){var s=yield o.secretStorage.getKey();yield o.secretStorage.store("m.megolm_backup.v1",a,[s[0]])}var l=(0,k.y4)(a||r);return o.restoreKeyBackup(l,t,n,e,i)}))()}restoreKeyBackupWithRecoveryKey(e,t,n,r,i){var o=(0,ye.decodeRecoveryKey)(e);return this.restoreKeyBackup(o,t,n,r,i)}restoreKeyBackupWithCache(e,t,n,i){var o=this;return(0,r.A)((function*(){if(!o.cryptoBackend)throw new Error("End-to-end encryption disabled");var r=yield o.cryptoBackend.getSessionBackupPrivateKey();if(!r)throw new Error("Couldn't get key");return o.restoreKeyBackup(r,e,t,n,i)}))()}restoreKeyBackup(e,t,n,i,o){var a=this;return(0,r.A)((function*(){var s=null==o?void 0:o.cacheCompleteCallback,l=null==o?void 0:o.progressCallback;if(!a.cryptoBackend)throw new Error("End-to-end encryption disabled");if(!i.version)throw new Error("Backup version must be defined");var c=i.version,d=0,u=0,h=0,p=a.makeKeyBackupPath(t,n,c),m=yield a.cryptoBackend.getBackupDecryptor(i,e),g=!m.sourceTrusted;try{if(!(e instanceof Uint8Array))throw new Error("restoreKeyBackup expects Uint8Array, got ".concat(e));a.cryptoBackend.storeSessionBackupPrivateKey(e,c).catch((e=>{a.logger.warn("Error caching session backup key:",e)})).then(s),l&&l({stage:"fetch"});var f=yield a.http.authedRequest(x.IT.Get,p.path,p.queryData,void 0,{prefix:x.iD.V3});if(l&&l({stage:"load_keys"}),f.rooms)d=a.getTotalKeyCount(f),yield a.handleDecryptionOfAFullBackup(f,m,200,function(){var e=(0,r.A)((function*(e){try{var t=i.version;yield a.cryptoBackend.importBackedUpRoomKeys(e,t,{untrusted:g}),h+=e.length}catch(t){u+=e.length,v.v.error("Error importing keys from backup",t)}l&&l({total:d,successes:h,stage:"load_keys",failures:u})}));return function(t){return e.apply(this,arguments)}}());else if(f.sessions){var y=f.sessions;d=Object.keys(y).length;var _=yield m.decryptSessions(y);for(var E of _)E.room_id=t;yield a.cryptoBackend.importBackedUpRoomKeys(_,c,{progressCallback:l,untrusted:g}),h=_.length}else{d=1;try{var[b]=yield m.decryptSessions({[n]:f});b.room_id=t,b.session_id=n,yield a.cryptoBackend.importBackedUpRoomKeys([b],c,{progressCallback:l,untrusted:g}),h=1}catch(e){a.logger.debug("Failed to decrypt megolm session from backup",e)}}}finally{m.free()}return yield a.cryptoBackend.checkKeyBackupAndEnable(),{total:d,imported:h}}))()}getTotalKeyCount(e){var t=e.rooms,n=0;for(var r of Object.values(t))r.sessions&&(n+=Object.keys(r.sessions).length);return n}handleDecryptionOfAFullBackup(e,t,n,i){return(0,r.A)((function*(){var o=e.rooms,a=0,s=new Map,l=function(){var e=(0,r.A)((function*(e){var n=[];for(var r of e.keys()){var o=yield t.decryptSessions(e.get(r));for(var a in o){var s=o[a];s.room_id=r,n.push(s)}}yield i(n)}));return function(t){return e.apply(this,arguments)}}();for(var[c,d]of Object.entries(o))if(d.sessions)for(var[u,h]of(s.set(c,{}),Object.entries(d.sessions)))s.get(c)[u]=h,(a+=1)>=n&&(yield l(s),(s=new Map).set(c,{}),a=0);a>0&&(yield l(s))}))()}deleteKeysFromBackup(e,t,n){var i=this;return(0,r.A)((function*(){var r=i.makeKeyBackupPath(e,t,n);yield i.http.authedRequest(x.IT.Delete,r.path,r.queryData,void 0,{prefix:x.iD.V3})}))()}getMediaConfig(){return this.http.authedRequest(x.IT.Get,"/config",void 0,void 0,{prefix:x.zs.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.store.getRooms(),n=new Set;for(var r of t){var i,o=null===(i=r.findPredecessor(e))||void 0===i?void 0:i.roomId;o&&n.add(o)}return t.filter((e=>!e.currentState.getStateEvents(g.Bx.RoomTombstone,"")||!n.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t){var n=h.RR("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return(0,x.Y6)(5,(()=>this.http.authedRequest(x.IT.Put,n,void 0,t)))}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var t=this;return(0,r.A)((function*(){if(t.isInitialSyncComplete()){var n=t.store.getAccountData(e);return n?n.getContent():null}var r=h.RR("/user/$userId/account_data/$type",{$userId:t.credentials.userId,$type:e});try{return yield t.http.authedRequest(x.IT.Get,r)}catch(e){var i;if("M_NOT_FOUND"===(null===(i=e.data)||void 0===i?void 0:i.errcode))return null;throw e}}))()}deleteAccountData(e){var t=this;return(0,r.A)((function*(){var n=t.canSupport.get(ge.Xj.AccountDataDeletion);if(n!==ge.Tj.Unsupported){var r=h.RR("/user/$userId/account_data/$type",{$userId:t.getSafeUserId(),$type:e}),i=n===ge.Tj.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield t.http.authedRequest(x.IT.Delete,r,void 0,void 0,i)}yield t.setAccountData(e,{})}))()}getIgnoredUsers(){var e=this.getAccountData(g.Bx.IgnoredUserList);return null!=e&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var t={ignored_users:{}};return e.forEach((e=>{t.ignored_users[e]={}})),this.setAccountData(g.Bx.IgnoredUserList,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};void 0===r.syncRoom&&(r.syncRoom=!0);var i=n.getRoom(e);if(null!=i&&i.hasMembershipState(n.credentials.userId,J.O.Join))return i;var a=Promise.resolve();if(r.inviteSignUrl){var s=new URL(r.inviteSignUrl);s.searchParams.set("mxid",n.credentials.userId),a=n.http.requestOtherUrl(x.IT.Post,s)}var l={};r.viaServers&&(l.server_name=r.viaServers,l.via=r.viaServers);var c={},d=yield a;d&&(c.third_party_signed=d);var u=h.RR("/join/$roomid",{$roomid:e}),p=(yield n.http.authedRequest(x.IT.Post,u,l,c)).room_id,v=n.getRoom(p);if(null!=v&&v.hasMembershipState(n.credentials.userId,J.O.Join))return v;var m=new o.w_(n,n.clientOpts,n.buildSyncApiOptions()).createRoom(p);return r.syncRoom,m}))()}knockRoom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRoom(e);if(null!=n&&n.hasMembershipState(this.credentials.userId,J.O.Knock))return Promise.resolve({room_id:n.roomId});var r=h.RR("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),i={};t.viaServers&&(i.server_name=t.viaServers,i.via=t.viaServers);var o={};return t.reason&&(o.reason=t.reason),this.http.authedRequest(x.IT.Post,r,i,o)}resendEvent(e,t){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(t,e,a.fb.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![a.fb.QUEUED,a.fb.NOT_SENT,a.fb.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===a.fb.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===a.fb.QUEUED&&this.scheduler.removeEventFromQueue(e);var t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,a.fb.CANCELLED)}setRoomName(e,t){return this.sendStateEvent(e,g.Bx.RoomName,{name:t})}setRoomTopic(e,t,n){var r=F.makeTopicContent(t,n);return this.sendStateEvent(e,g.Bx.RoomTopic,r)}getRoomTags(e){var t=h.RR("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(x.IT.Get,t)}setRoomTag(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=h.RR("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(x.IT.Put,r,void 0,n)}deleteRoomTag(e,t){var n=h.RR("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(x.IT.Delete,n)}setRoomAccountData(e,t,n){var r=h.RR("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(x.IT.Put,r,void 0,n)}setPowerLevel(e,t,n){var i=this;return(0,r.A)((function*(){var r,o,a;if(i.clientRunning&&i.isInitialSyncComplete()&&(o=null===(a=i.getRoom(e))||void 0===a||null===(a=a.currentState)||void 0===a||null===(a=a.getStateEvents(g.Bx.RoomPowerLevels,""))||void 0===a?void 0:a.getContent()),!o)try{o=yield i.getStateEvent(e,g.Bx.RoomPowerLevels,"")}catch(e){if(!(e instanceof x.up&&"M_NOT_FOUND"===e.errcode))throw e;o={}}null!==(r=o=h.A4(o))&&void 0!==r&&r.users||(o.users={});var s=Array.isArray(t)?t:[t];for(var l of s)null==n?delete o.users[l]:o.users[l]=n;return i.sendStateEvent(e,g.Bx.RoomPowerLevels,o,"")}))()}unstable_createLiveBeacon(e,t){var n=this;return(0,r.A)((function*(){return n.unstable_setLiveBeacon(e,t)}))()}unstable_setLiveBeacon(e,t){var n=this;return(0,r.A)((function*(){return n.sendStateEvent(e,ce.E.name,t,n.getUserId())}))()}sendEvent(e,t,n,r,i){var o,a,s,l;return null!=t&&t.startsWith(rt)||null===t?(l=i,s=r,a=n,o=t):(l=r,s=n,a=t,o=null),this.addThreadRelationIfNeeded(s,o,e),this.sendCompleteEvent(e,o,{type:a,content:s},l)}addThreadRelationIfNeeded(e,t,n){var r;if(t&&(null===(r=e["m.relates_to"])||void 0===r||!r.rel_type)){var i,o,a=!(null===(i=e["m.relates_to"])||void 0===i||!i["m.in_reply_to"]);e["m.relates_to"]=qe(qe({},e["m.relates_to"]),{},{rel_type:le.RN.name,event_id:t,is_falling_back:!a});var s,l,c=null===(o=this.getRoom(n))||void 0===o?void 0:o.getThread(t);c&&!a&&(e["m.relates_to"]["m.in_reply_to"]={event_id:null!==(s=null===(l=c.lastReply((e=>e.isRelation(le.RN.name)&&!e.status)))||void 0===l?void 0:l.getId())&&void 0!==s?s:t})}}sendCompleteEvent(e,t,n,r,i){var o,s;"string"==typeof r?s=r:(o=r,s=i),s||(s=this.makeTxnId());var l=new a.kl(Object.assign(n,{event_id:"~"+e+":"+s,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),c=this.getRoom(e),d=t?null==c?void 0:c.getThread(t):void 0;d&&l.setThread(d),o||(this.reEmitter.reEmit(l,[a.OQ.Replaced,a.OQ.VisibilityChange]),null==c||c.reEmitter.reEmit(l,[a.OQ.BeforeRedaction]));var u=l.getAssociatedId();if(null!=u&&u.startsWith("~")){var h=null==c?void 0:c.getPendingEvents().find((e=>e.getId()===u));null==h||h.once(a.OQ.LocalEventIdReplaced,(()=>{l.updateAssociatedId(h.getId())}))}var p=l.getType();return this.logger.debug("sendEvent of type ".concat(p," in ").concat(e," with txnId ").concat(s).concat(o?" (delayed event)":"")),l.setTxnId(s),l.setStatus(a.fb.SENDING),o?this.encryptAndSendEvent(c,l,o):(null==c||c.addPendingEvent(l,s),l.status===a.fb.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(c,l))}encryptAndSendEvent(e,t,n){var i=this;return(0,r.A)((function*(){if(n)return i.sendEventHttpRequest(t,n);try{var r;i.eventsBeingEncrypted.add(t.getId());try{yield i.encryptEventIfNeeded(t,null!=e?e:void 0)}finally{r=!i.eventsBeingEncrypted.delete(t.getId())}if(r)return{};t.status===a.fb.ENCRYPTING&&i.updatePendingEventStatus(e,t,a.fb.SENDING);var o=null;return i.scheduler&&(o=i.scheduler.queueEvent(t))&&i.scheduler.getQueueForEvent(t).length>1&&i.updatePendingEventStatus(e,t,a.fb.QUEUED),o||(o=i.sendEventHttpRequest(t),e&&(o=o.then((n=>(e.updatePendingEvent(t,a.fb.SENT,n.event_id),n))))),yield o}catch(n){i.logger.error("Error sending event",n);try{t.error=n,i.updatePendingEventStatus(e,t,a.fb.NOT_SENT)}catch(e){i.logger.error("Exception in error handler!",e)}throw n instanceof x.up&&(n.event=t),n}}))()}encryptEventIfNeeded(e,t){var n=this;return(0,r.A)((function*(){if(t&&(yield n.shouldEncryptEventForRoom(e,t))&&(n.cryptoBackend||!n.usingExternalCrypto)){if(!n.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");n.updatePendingEventStatus(t,e,a.fb.ENCRYPTING),yield n.cryptoBackend.encryptEvent(e,t)}}))()}shouldEncryptEventForRoom(e,t){var n=this;return(0,r.A)((function*(){var r;return!(e.isEncrypted()||e.getType()===g.Bx.Reaction||e.isRedaction()||!t.hasEncryptionStateEvent()&&!(yield null===(r=n.cryptoBackend)||void 0===r?void 0:r.isEncryptionEnabledInRoom(t.roomId)))}))()}getEncryptedIfNeededEventType(e,t){var n;return t===g.Bx.Reaction?t:null!==(n=this.getRoom(e))&&void 0!==n&&n.hasEncryptionStateEvent()?g.Bx.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}sendEventHttpRequest(e,t){var n=e.getTxnId();n||(n=this.makeTxnId(),e.setTxnId(n));var r,i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:n};if(e.isState()){var o="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),r=h.RR(o,i)}else r=e.isRedaction()&&e.event.redacts?h.RR("/rooms/$roomId/redact/$redactsEventId/$txnId",qe({$redactsEventId:e.event.redacts},i)):h.RR("/rooms/$roomId/send/$eventType/$txnId",i);var a=e.getWireContent();return t?this.http.authedRequest(x.IT.Put,r,st(t),a):this.http.authedRequest(x.IT.Put,r,void 0,a).then((t=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(t.event_id)),t)))}redactEvent(e,t,n,r,i){var o,a,s;null!==(o=n)&&void 0!==o&&o.startsWith(rt)||(i=r,r=n,n=t,t=null);var l={reason:null===(a=i)||void 0===a?void 0:a.reason};if(void 0!==(null===(s=i)||void 0===s?void 0:s.with_rel_types)){if(this.canSupport.get(ge.Xj.RelationBasedRedactions)===ge.Tj.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(n," txnId: ").concat(r," threadId ").concat(t));l[this.canSupport.get(ge.Xj.RelationBasedRedactions)===ge.Tj.Stable?g.Z3.stable:g.Z3.unstable]=i.with_rel_types}return this.sendCompleteEvent(e,t,{type:g.Bx.RoomRedaction,content:l,redacts:n},r)}sendMessage(e,t,n,r){"string"!=typeof t&&null!==t&&(r=n,n=t,t=null);var i=g.Bx.RoomMessage,o=n;return this.sendEvent(e,t,i,o,r)}sendTextMessage(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeTextMessage(n);return this.sendMessage(e,t,o,r)}sendNotice(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeNotice(n);return this.sendMessage(e,t,o,r)}sendEmoteMessage(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeEmoteMessage(n);return this.sendMessage(e,t,o,r)}sendImageMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Image";null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(o=r||"Image",r=n,n=t,t=null);var a={msgtype:g.Wr.Image,url:n,info:r,body:o};return this.sendMessage(e,t,a)}sendStickerMessage(e,t,n,r){var i,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Sticker";null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(o=r||"Sticker",r=n,n=t,t=null);var a={url:n,info:r,body:o};return this.sendEvent(e,t,g.Bx.Sticker,a)}sendHtmlMessage(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeHtmlMessage(n,r);return this.sendMessage(e,t,o)}sendHtmlNotice(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeHtmlNotice(n,r);return this.sendMessage(e,t,o)}sendHtmlEmote(e,t,n,r){var i;null!==(i=t)&&void 0!==i&&i.startsWith(rt)||null===t||(r=n,n=t,t=null);var o=F.makeHtmlEmote(n,r);return this.sendMessage(e,t,o)}_unstable_sendDelayedEvent(e,t,n,i,o,a){var s=this;return(0,r.A)((function*(){if(!(yield s.doesServerSupportUnstableFeature(tt)))throw Error("Server does not support the delayed events API");return s.addThreadRelationIfNeeded(o,n,e),s.sendCompleteEvent(e,n,{type:i,content:o},t,a)}))()}_unstable_sendDelayedStateEvent(e,t,n,i){var o=arguments,a=this;return(0,r.A)((function*(){var r=o.length>4&&void 0!==o[4]?o[4]:"",s=o.length>5&&void 0!==o[5]?o[5]:{};if(!(yield a.doesServerSupportUnstableFeature(tt)))throw Error("Server does not support the delayed events API");var l={$roomId:e,$eventType:n,$stateKey:r},c=h.RR("/rooms/$roomId/state/$eventType",l);return void 0!==r&&(c=h.RR(c+"/$stateKey",l)),a.http.authedRequest(x.IT.Put,c,st(t),i,s)}))()}_unstable_getDelayedEvents(e){var t=this;return(0,r.A)((function*(){if(!(yield t.doesServerSupportUnstableFeature(tt)))throw Error("Server does not support the delayed events API");var n=e?{from:e}:void 0;return yield t.http.authedRequest(x.IT.Get,"/delayed_events",n,void 0,{prefix:"".concat(x.iD.Unstable,"/").concat(tt)})}))()}_unstable_updateDelayedEvent(e,t){var n=this;return(0,r.A)((function*(){if(!(yield n.doesServerSupportUnstableFeature(tt)))throw Error("Server does not support the delayed events API");var r=h.RR("/delayed_events/$delayId",{$delayId:e}),i={action:t};return yield n.http.authedRequest(x.IT.Post,r,void 0,i,{prefix:"".concat(x.iD.Unstable,"/").concat(tt)})}))()}sendReceipt(e,t,n){var i=arguments,o=this;return(0,r.A)((function*(){var r=i.length>3&&void 0!==i[3]&&i[3];if(o.isGuest())return Promise.resolve({});var a=h.RR("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),s=!r&&o.supportsThreads()?qe(qe({},n),{},{thread_id:ct(e)}):n,l=o.http.authedRequest(x.IT.Post,a,void 0,s||{}),c=o.getRoom(e.getRoomId());return c&&o.credentials.userId&&c.addLocalEchoReceipt(o.credentials.userId,e,t,r),l}))()}sendReadReceipt(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:ae.L.Read,i=t.length>2&&void 0!==t[2]&&t[2];if(e){var o=e.getId(),a=n.getRoom(e.getRoomId());if(null!=a&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return n.sendReceipt(e,r,{},i)}}))()}setRoomReadMarkers(e,t,n,i){var o=this;return(0,r.A)((function*(){var r,a,s=o.getRoom(e);if(null!=s&&s.hasPendingEvent(t))throw new Error("Cannot set read marker to a pending event (".concat(t,")"));if(n){if(r=n.getId(),null!=s&&s.hasPendingEvent(r))throw new Error("Cannot set read receipt to a pending event (".concat(r,")"));null==s||s.addLocalEchoReceipt(o.credentials.userId,n,ae.L.Read)}if(i){if(a=i.getId(),null!=s&&s.hasPendingEvent(a))throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));null==s||s.addLocalEchoReceipt(o.credentials.userId,i,ae.L.ReadPrivate)}return yield o.setRoomReadMarkersHttpRequest(e,t,r,a)}))()}getUrlPreview(e,t){t=6e4*Math.floor(t/6e4);var n=new URL(e);n.hash="";var r=t+"_"+(e=n.toString());if(r in this.urlPreviewCache)return this.urlPreviewCache[r];var i=this.http.authedRequest(x.IT.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:x.zs.V3,priority:"low"});return this.urlPreviewCache[r]=i,i}sendTyping(e,t,n){if(this.isGuest())return Promise.resolve({});var r=h.RR("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),i={typing:t};return t&&(i.timeout=n||2e4),this.http.authedRequest(x.IT.Put,r,void 0,i)}getRoomUpgradeHistory(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getRoom(e);return r?[...this.findPredecessorRooms(r,t,n),r,...this.findSuccessorRooms(r,t,n)]:[]}findPredecessorRooms(e,t,n){for(var r,i=[],o=new Set([e.roomId]),a=null===(r=e.findPredecessor(n))||void 0===r?void 0:r.roomId;null!==a;){var s;if(a){if(o.has(a))break;o.add(a)}var l=this.getRoom(a);if(null===l)break;if(t){var c=l.currentState.getStateEvents(g.Bx.RoomTombstone,"");if(!c||c.getContent().replacement_room!==e.roomId)break}i.splice(0,0,l),a=null===(s=(e=l).findPredecessor(n))||void 0===s?void 0:s.roomId}return i}findSuccessorRooms(e,t,n){for(var r=[],i=e.currentState.getStateEvents(g.Bx.RoomTombstone,"");i;){var o=this.getRoom(i.getContent().replacement_room);if(!o)break;if(o.roomId===e.roomId)break;if(t){var a,s=null===(a=o.findPredecessor(n))||void 0===a?void 0:a.roomId;if(!s||s!==e.roomId)break}if(r.push(o),new Set(r.map((e=>e.roomId))).size<r.length)return r.slice(0,r.length-1);i=(e=o).currentState.getStateEvents(g.Bx.RoomTombstone,"")}return r}invite(e,t,n){return this.membershipChange(e,t,J.O.Invite,n)}inviteByEmail(e,t){return this.inviteByThreePid(e,"email",t)}inviteByThreePid(e,t,n){var i=this;return(0,r.A)((function*(){var r,o=h.RR("/rooms/$roomId/invite",{$roomId:e}),a=i.getIdentityServerUrl(!0);if(!a)return Promise.reject(new x.up({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var s={id_server:a,medium:t,address:n};if(null!==(r=i.identityServer)&&void 0!==r&&r.getAccessToken){var l=yield i.identityServer.getAccessToken();l&&(s.id_access_token=l)}return i.http.authedRequest(x.IT.Post,o,void 0,s)}))()}leave(e){return this.membershipChange(e,void 0,J.O.Leave)}leaveRoomChain(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getRoomUpgradeHistory(e),r=n;if(!t)for(var i of(r=[],n))if(r.push(i),i.roomId===e)break;var o={},a=[],s=e=>this.leave(e).then((()=>{delete o[e]})).catch((t=>{o[e]=t}));for(var l of r)a.push(s(l.roomId));return Promise.all(a).then((()=>o))}ban(e,t,n){return this.membershipChange(e,t,J.O.Ban,n)}forget(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=!(t.length>1&&void 0!==t[1])||t[1],i=h.RR("/rooms/$room_id/forget",{$room_id:e}),o=yield n.http.authedRequest(x.IT.Post,i);return r&&(n.store.removeRoom(e),n.emit(it.DeleteRoom,e)),o}))()}unban(e,t){var n=h.RR("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this.http.authedRequest(x.IT.Post,n,void 0,r)}kick(e,t,n){var r=h.RR("/rooms/$roomId/kick",{$roomId:e}),i={user_id:t,reason:n};return this.http.authedRequest(x.IT.Post,r,void 0,i)}membershipChange(e,t,n,r){var i=h.RR("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(x.IT.Post,i,void 0,{user_id:t,reason:r})}getPushActionsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushActions()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushActions()}getPushDetailsForEvent(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.getPushDetails()||t){var{actions:n,rule:r}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(n,r)}return e.getPushDetails()}setProfileInfo(e,t){var n=h.RR("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(x.IT.Put,n,void 0,t)}setDisplayName(e){var t=this;return(0,r.A)((function*(){var n=yield t.setProfileInfo("displayname",{displayname:e}),r=t.getUser(t.getUserId());return r&&(r.displayName=e,r.emit(D.U.DisplayName,r.events.presence,r)),n}))()}setAvatarUrl(e){var t=this;return(0,r.A)((function*(){var n=yield t.setProfileInfo("avatar_url",{avatar_url:e}),r=t.getUser(t.getUserId());return r&&(r.avatarUrl=e,r.emit(D.U.AvatarUrl,r.events.presence,r)),n}))()}mxcUrlToHttp(e,t,n,r,i,o,a){return(0,L.y)(this.baseUrl,e,t,n,r,i,o,a)}setSyncPresence(e){var t=this;return(0,r.A)((function*(){var n;null===(n=t.syncApi)||void 0===n||n.setPresence(e)}))()}setPresence(e){var t=this;return(0,r.A)((function*(){var n=h.RR("/presence/$userId/status",{$userId:t.credentials.userId});if(-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);yield t.http.authedRequest(x.IT.Put,n,void 0,e)}))()}getPresence(e){var t=h.RR("/presence/$userId/status",{$userId:e});return this.http.authedRequest(x.IT.Get,t)}scrollback(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=0,r=this.ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){var i=Date.now()-r.errorTs;n=Math.max(3e3-i,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);var o=this.store.scrollback(e,t).length;if(o===t)return Promise.resolve(e);t-=o;var a=new Promise(((r,i)=>{(0,h.yy)(n).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,p.O.Backward))).then((t=>{var n,i,o=t.chunk.map(this.getEventMapper());if(t.state){var a=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(a)}var[s,l,c]=e.partitionThreadedEvents(o);this.processAggregatedTimelineEvents(e,s),e.addEventsToTimeline(s,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,l,!0),c.forEach((t=>e.relations.aggregateChildEvent(t))),e.oldState.paginationToken=null!==(n=t.end)&&void 0!==n?n:null,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,o,null!==(i=t.end)&&void 0!==i?i:null,!0),delete this.ongoingScrollbacks[e.roomId],r(e)})).catch((t=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},i(t)}))}));return r={promise:a},this.ongoingScrollbacks[e.roomId]=r,a}getEventMapper(e){return function(e,t){var n=Boolean(t.preventReEmit),r=!1!==t.decrypt;return function i(o){t.toDevice&&delete o.room_id;var s,l=e.getRoom(o.room_id);l&&void 0===o.state_key&&(s=l.findEventById(o.event_id)),!s||s.status?s=new a.kl(o):(s.setUnsigned(j(j({},s.getUnsigned()),o.unsigned)),n=!0);var c=s.getServerAggregatedRelation(g.zZ.Replace);if(null!=c&&c.content){var d=i(c);s.makeReplaced(d)}var u=null==l?void 0:l.findThreadForEvent(s);return u&&s.setThread(u),s.isEncrypted()&&(n||e.reEmitter.reEmit(s,[a.OQ.Decrypted]),r&&e.decryptEventIfNeeded(s)),n||(e.reEmitter.reEmit(s,[a.OQ.Replaced,a.OQ.VisibilityChange]),null==l||l.reEmitter.reEmit(s,[a.OQ.BeforeRedaction])),s}}(this,e||{})}getEventTimeline(e,t){var n=this;return(0,r.A)((function*(){var r,i,o,a;if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(null==e||!e.room)throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);if(e.thread&&n.supportsThreads())return n.getThreadTimeline(e,t);var s=h.RR("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),l=void 0;null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(l={filter:JSON.stringify(c.d.LAZY_LOADING_MESSAGES_FILTER)});var d=yield n.http.authedRequest(x.IT.Get,s,l);if(!d.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);var u=n.getEventMapper(),v=u(d.event);if(!v.isRelation(le.RN.name)){var m=[...d.events_after.reverse().map(u),v,...d.events_before.map(u)],g=e.getTimelineForEvent(m[0].getId());g?g.getState(p.q.BACKWARDS).setUnknownStateEvents(d.state.map(u)):((g=e.addTimeline()).initialiseState(d.state.map(u)),g.getState(p.q.FORWARDS).paginationToken=d.end);var[f,y,_]=e.room.partitionThreadedEvents(m);return e.addEventsToTimeline(f,!0,!1,g,d.start),n.processThreadEvents(e.room,y,!0),n.processAggregatedTimelineEvents(e.room,f),_.forEach((t=>e.relations.aggregateChildEvent(t))),null!==(i=null!==(o=e.getTimelineForEvent(t))&&void 0!==o?o:null===(a=e.room.findThreadForEvent(v))||void 0===a?void 0:a.liveTimeline)&&void 0!==i?i:g}n.logger.warn("Tried loading a regular timeline at the position of a thread event")}))()}getThreadTimeline(e,t){var n=this;return(0,r.A)((function*(){var r;if(!n.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var i=h.RR("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t}),o={limit:"0"};null!==(r=n.clientOpts)&&void 0!==r&&r.lazyLoadMembers&&(o.filter=JSON.stringify(c.d.LAZY_LOADING_MESSAGES_FILTER));var a=yield n.http.authedRequest(x.IT.Get,i,o),s=n.getEventMapper(),l=s(a.event);if(e.canContain(l)){var d=n.canSupport.get(ge.Xj.RelationsRecursion)!==ge.Tj.Unsupported;if(le.jV.hasServerSideSupport){if(le.jV.hasServerSideFwdPaginationSupport){var u,v,m;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var g=e.thread,f=yield n.fetchRelations(e.room.roomId,g.id,null,null,{dir:p.O.Backward,from:a.start,recurse:d||void 0}),y=yield n.fetchRelations(e.room.roomId,g.id,null,null,{dir:p.O.Forward,from:a.end,recurse:d||void 0}),_=[...y.chunk.reverse().filter(Be(g.id)).map(s),l,...f.chunk.filter(Be(g.id)).map(s)];for(var E of _){var b;yield null===(b=e.thread)||void 0===b?void 0:b.processEvent(E)}var S=e.getTimelineForEvent(l.getId());if(S?S.getState(p.q.BACKWARDS).setUnknownStateEvents(a.state.map(s)):(S=e.addTimeline()).initialiseState(a.state.map(s)),e.addEventsToTimeline(_,!0,!1,S,y.next_batch),!f.next_batch){var C=yield n.fetchRoomEvent(e.room.roomId,g.id);e.addEventsToTimeline([s(C)],!0,!1,S,null)}return S.setPaginationToken(null!==(u=f.next_batch)&&void 0!==u?u:null,p.O.Backward),S.setPaginationToken(null!==(v=y.next_batch)&&void 0!==v?v:null,p.O.Forward),n.processAggregatedTimelineEvents(e.room,_),null!==(m=e.getTimelineForEvent(t))&&void 0!==m?m:S}for(var w,A=e.thread,T=yield n.fetchRelations(e.room.roomId,A.id,le.RN.name,null,{dir:p.O.Backward,from:a.start,recurse:d||void 0}),I=[],k=a.end;k;){var O,R=yield n.fetchRelations(e.room.roomId,A.id,le.RN.name,null,{dir:p.O.Forward,from:k,recurse:d||void 0});k=null!==(O=R.next_batch)&&void 0!==O?O:null,I.push(...R.chunk)}var N=[...I.reverse().map(s),l,...T.chunk.map(s)];for(var D of N){var L;yield null===(L=e.thread)||void 0===L?void 0:L.processEvent(D)}var P=e.getLiveTimeline();if(P.getState(p.q.BACKWARDS).setUnknownStateEvents(a.state.map(s)),e.addEventsToTimeline(N,!0,!1,P,null),!T.next_batch){var M=yield n.fetchRoomEvent(e.room.roomId,A.id);e.addEventsToTimeline([s(M)],!0,!1,P,null)}return P.setPaginationToken(null!==(w=T.next_batch)&&void 0!==w?w:null,p.O.Backward),P.setPaginationToken(null,p.O.Forward),n.processAggregatedTimelineEvents(e.room,N),P}}}))()}getLatestTimeline(e){var t=this;return(0,r.A)((function*(){if(!t.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var n,r;if(null!==e.threadListType)n=null===(r=(yield t.createThreadListMessagesRequest(e.room.roomId,null,1,p.O.Backward,e.threadListType,e.getFilter())).chunk)||void 0===r?void 0:r[0];else if(e.thread&&le.jV.hasServerSideSupport){var i,o=t.canSupport.get(ge.Xj.RelationsRecursion)!==ge.Tj.Unsupported;n=null===(i=(yield t.fetchRelations(e.room.roomId,e.thread.id,le.RN.name,null,{dir:p.O.Backward,limit:1,recurse:o||void 0})).chunk)||void 0===i?void 0:i[0]}else{var a,s,l=h.RR("/rooms/$roomId/messages",{$roomId:e.room.roomId}),d={dir:"b"};null!==(a=t.clientOpts)&&void 0!==a&&a.lazyLoadMembers&&(d.filter=JSON.stringify(c.d.LAZY_LOADING_MESSAGES_FILTER)),n=null===(s=(yield t.http.authedRequest(x.IT.Get,l,d)).chunk)||void 0===s?void 0:s[0]}if(!n)throw new Error("No message returned when trying to construct getLatestTimeline");return t.getEventTimeline(e,n.event_id)}))()}createMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=h.RR("/rooms/$roomId/messages",{$roomId:e}),s={limit:r.toString(),dir:i};t&&(s.from=t);var l,d=null;return null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(d=Object.assign({},c.d.LAZY_LOADING_MESSAGES_FILTER)),o&&(d=d||{},Object.assign(d,null===(l=o.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON())),d&&(s.filter=JSON.stringify(d)),this.http.authedRequest(x.IT.Get,a,s)}createThreadListMessagesRequest(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.O.Backward,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:le.x3.All,a=arguments.length>5?arguments[5]:void 0,s=h.RR("/rooms/$roomId/threads",{$roomId:e}),l={limit:r.toString(),dir:i,include:(0,le.UR)(o)};t&&(l.from=t);var d,u={};null!==(n=this.clientOpts)&&void 0!==n&&n.lazyLoadMembers&&(u=qe({},c.d.LAZY_LOADING_MESSAGES_FILTER)),a&&(u=qe(qe({},u),null===(d=a.getRoomTimelineFilterComponent())||void 0===d?void 0:d.toJSON())),Object.keys(u).length&&(l.filter=JSON.stringify(u));var v={prefix:le.jV.hasServerSideListSupport===le.c1.Stable?x.iD.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(x.IT.Get,s,l,void 0,v).then((e=>{var t;return qe(qe({},e),{},{chunk:null===(t=e.chunk)||void 0===t?void 0:t.reverse(),start:e.prev_batch,end:e.next_batch})}))}paginateEventTimeline(e,t){var n=this,i=e.getTimelineSet()===this.notifTimelineSet,o=this.getRoom(e.getRoomId()),a=e.getTimelineSet().threadListType,s=e.getTimelineSet().thread,l=(t=t||{}).backwards||!1;if(i&&!l)throw new Error("paginateNotifTimeline can only paginate backwards");var c,d,u,v=l?p.q.BACKWARDS:p.q.FORWARDS,m=e.getPaginationToken(v),g=e.paginationRequests[v];if(g)return g;if(i)c={limit:(null!==(u=t.limit)&&void 0!==u?u:30).toString(),only:"highlight"},m&&"end"!==m&&(c.from=m),d=this.http.authedRequest(x.IT.Get,"/notifications",c).then(function(){var t=(0,r.A)((function*(t){var r=t.next_token,i=[];t.notifications=t.notifications.filter(h.O5);for(var o=0;o<t.notifications.length;o++){var a=t.notifications[o],s=n.getEventMapper()(a.event);n.getPushDetailsForEvent(s,!0),s.event.room_id=a.room_id,i[o]=s}var c=e.getTimelineSet();return c.addEventsToTimeline(i,l,!1,e,r),n.processAggregatedTimelineEvents(c.room,i),l&&!t.next_token&&e.setPaginationToken(null,v),Boolean(t.next_token)}));return function(e){return t.apply(this,arguments)}}()).finally((()=>{e.paginationRequests[v]=null})),e.paginationRequests[v]=d;else if(null!==a){if(!o)throw new Error("Unknown room "+e.getRoomId());if(!le.jV.hasServerSideFwdPaginationSupport&&v===p.O.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");d=this.createThreadListMessagesRequest(e.getRoomId(),m,t.limit,v,a,e.getFilter()).then((t=>{if(t.state){var n=e.getState(v),r=t.state.filter(h.O5).map(this.getEventMapper());n.setUnknownStateEvents(r)}var i=t.end,a=t.chunk.filter(h.O5).map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(a,l,!1,e,i),this.processAggregatedTimelineEvents(o,a),this.processThreadRoots(o,a,l),l&&t.end==t.start&&e.setPaginationToken(null,v),t.end!==t.start})).finally((()=>{e.paginationRequests[v]=null})),e.paginationRequests[v]=d}else if(s){var f,y,_=this.getRoom(null!==(f=e.getRoomId())&&void 0!==f?f:void 0);if(!_)throw new Error("Unknown room "+e.getRoomId());var E=this.canSupport.get(ge.Xj.RelationsRecursion)!==ge.Tj.Unsupported;d=this.fetchRelations(null!==(y=e.getRoomId())&&void 0!==y?y:"",s.id,null,null,{dir:v,limit:t.limit,from:null!=m?m:void 0,recurse:E||void 0}).then(function(){var t=(0,r.A)((function*(t){var r=n.getEventMapper(),i=t.chunk.filter(h.O5).filter(Be(s.id)).map(r);for(var o of i.slice().reverse()){yield null==s?void 0:s.processEvent(o);var a=o.getSender();l&&null!==(null==s?void 0:s.getEventReadUpTo(a))||_.addLocalEchoReceipt(a,o,ae.L.Read)}var c=t.next_batch,d=e.getTimelineSet();if(d.addEventsToTimeline(i,l,!1,e,null!=c?c:null),!c&&l){var u,p,m=null!==(u=s.rootEvent)&&void 0!==u?u:r(yield n.fetchRoomEvent(null!==(p=e.getRoomId())&&void 0!==p?p:"",s.id));d.addEventsToTimeline([m],!0,!1,e,null)}return n.processAggregatedTimelineEvents(d.room,i),l&&!c&&e.setPaginationToken(null,v),Boolean(c)}));return function(e){return t.apply(this,arguments)}}()).finally((()=>{e.paginationRequests[v]=null})),e.paginationRequests[v]=d}else{if(!o)throw new Error("Unknown room "+e.getRoomId());d=this.createMessagesRequest(e.getRoomId(),m,t.limit,v,e.getFilter()).then((t=>{if(t.state){var n=e.getState(v),r=t.state.filter(h.O5).map(this.getEventMapper());n.setUnknownStateEvents(r)}var i=t.end,a=t.chunk.filter(h.O5).map(this.getEventMapper()),s=e.getTimelineSet(),[c,,d]=o.partitionThreadedEvents(a);s.addEventsToTimeline(c,l,!1,e,i),this.processAggregatedTimelineEvents(o,c),this.processThreadRoots(o,c.filter((e=>e.getServerAggregatedRelation(le.RN.name))),!1),d.forEach((e=>o.relations.aggregateChildEvent(e)));var u=void 0===t.end||t.end===t.start;return l&&u&&e.setPaginationToken(null,v),!u})).finally((()=>{e.paginationRequests[v]=null})),e.paginationRequests[v]=d}return d}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return null===(t=this.peekSync)||void 0===t||t.stopPeeking(),this.peekSync=new o.w_(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,n)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){var n=this.sendStateEvent(e,g.Bx.RoomGuestAccess,{guest_access:t.allowJoin?$.rF.CanJoin:$.rF.Forbidden},""),r=Promise.resolve();return t.allowRead&&(r=this.sendStateEvent(e,g.Bx.RoomHistoryVisibility,{history_visibility:$.Jv.WorldReadable},"")),Promise.all([r,n]).then()}requestRegisterEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestRegisterMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestAdd3pidMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestPasswordEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestPasswordMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestTokenFromEndpoint(e,t){var n=this;return(0,r.A)((function*(){var r=Object.assign({},t);return n.http.request(x.IT.Post,e,void 0,r)}))()}getRoomPushRule(e,t){var n;if(this.pushRules)return null===(n=this.pushRules[e])||void 0===n||null===(n=n.room)||void 0===n?void 0:n.find((e=>e.rule_id===t));throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,t,n){var r,i=!1,o=this.getRoomPushRule(e,t);if(null!=o&&o.actions.includes(m.YU.DontNotify)&&(i=!0),n)if(o){if(!i){var a=h.v6();this.deletePushRule(e,m.Ji.RoomSpecific,o.rule_id).then((()=>{this.addPushRule(e,m.Ji.RoomSpecific,t,{actions:[m.YU.DontNotify]}).then((()=>{a.resolve()})).catch((e=>{a.reject(e)}))})).catch((e=>{a.reject(e)})),r=a.promise}}else r=this.addPushRule(e,m.Ji.RoomSpecific,t,{actions:[m.YU.DontNotify]});else i&&(r=this.deletePushRule(e,m.Ji.RoomSpecific,o.rule_id));if(r)return new Promise(((e,t)=>{r.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((n=>{this.pushRules=n,t(e)})).catch((n=>{t(e)}))}))}))}searchMessageText(e){var t={search_term:e.query};return"keys"in e&&(t.keys=e.keys),this.search({body:{search_categories:{room_events:t}}})}searchRoomEvents(e){var t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:ne.g.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(n,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var t={body:e._query,next_batch:e.next_batch},n=this.search(t,e.abortSignal).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=void 0}));return e.pendingRequest=n,n}processRoomEventsSearch(e,t){var n,r,i=t.search_categories.room_events;e.count=i.count,e.next_batch=i.next_batch;var o=new Set(i.highlights);e.highlights.forEach((e=>{o.add(e)})),e.highlights=Array.from(o);for(var a=this.getEventMapper(),s=null!==(n=null===(r=i.results)||void 0===r?void 0:r.length)&&void 0!==n?n:0,l=0;l<s;l++){var c=P.q.fromJson(i.results[l],a),d=this.getRoom(c.context.getEvent().getRoomId());if(d)for(var u of c.context.getTimeline())u.setMetadata(d.currentState,!1);e.results.push(c)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new o.w_(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=void 0})),this.syncLeftRoomsPromise}createFilter(e){var t=h.RR("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(x.IT.Post,t,void 0,e).then((t=>{var n=c.d.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(n),n}))}getFilter(e,t,n){if(n){var r=this.store.getFilter(e,t);if(r)return Promise.resolve(r)}var i=h.RR("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(x.IT.Get,i).then((n=>{var r=c.d.fromJson(e,t,n);return this.store.storeFilter(r),r}))}getOrCreateFilter(e,t){var n=this;return(0,r.A)((function*(){var r,i=n.store.getFilterIdByName(e);if(i){try{var o=yield n.getFilter(n.credentials.userId,i,!0);if(o){var a=o.getDefinition(),s=t.getDefinition();h.ky(a,s)&&(r=i)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}r||n.store.setFilterIdByName(e,void 0)}if(r)return r;var l=yield n.createFilter(t.getDefinition());return n.store.setFilterIdByName(e,l.filterId),l.filterId}))()}getOpenIdToken(){var e=h.RR("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(x.IT.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(x.IT.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return void 0!==this.checkTurnServersIntervalID}checkTurnServers(){var e=this;return(0,r.A)((function*(){if(e.canSupportVoip){var t=!1,n=e.turnServersExpiry-Date.now();if(n>Ye)e.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),t=!0;else{e.logger.debug("Fetching new TURN credentials");try{var r=yield e.turnServer();if(r.uris){e.logger.debug("Got TURN URIs: "+r.uris+" refresh in "+r.ttl+" secs");var i={urls:r.uris,username:r.username,credential:r.password};e.turnServers=[i],e.turnServersExpiry=Date.now()+1e3*r.ttl,t=!0,e.emit(it.TurnServers,e.turnServers)}}catch(t){e.logger.error("Failed to get TURN URIs",t),403===t.httpStatus?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==e.checkTurnServersIntervalID&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(it.TurnServersError,t,!0)):e.emit(it.TurnServersError,t,!1)}}return t}}))()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=h.RR("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(x.IT.Get,e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){var t=h.RR("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(x.IT.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var t=h.RR("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(x.IT.Post,t,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return(0,r.A)((function*(){var t;e.clientWellKnownPromise=I.MN.getRawClientConfig(null!==(t=e.getDomain())&&void 0!==t?t:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(it.ClientWellKnown,e.clientWellKnown)}))()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((t=>{var[n,r]=t;return e.includes(typeof r)})).reduce(((e,t)=>{var[n,r]=t;return e[n]=r,e}),{});return this.store.storeClientOptions(t)}_unstable_getSharedRooms(e){var t=this;return(0,r.A)((function*(){var n,r,i=yield t.doesServerSupportUnstableFeature(Qe),o=yield t.doesServerSupportUnstableFeature(Ze),a=yield t.doesServerSupportUnstableFeature(et);if(!i&&!o&&!a)throw Error("Server does not support the Mutual Rooms API");a?(n="/uk.half-shot.msc2666/user/mutual_rooms",r={user_id:e}):(n=h.RR("/uk.half-shot.msc2666/user/".concat(o?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),r={});var s=[],l=null;do{var c={};null!=l&&a&&(c.batch_token=l);var d=yield t.http.authedRequest(x.IT.Get,n,qe(qe({},r),c),void 0,{prefix:x.iD.Unstable});s.push(...d.joined),l=void 0!==d.next_batch_token?d.next_batch_token:null}while(null!=l);return s}))()}getVersions(){var e=this;return(0,r.A)((function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(x.IT.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((t=>{throw e.serverVersionsPromise=void 0,t}));var t=yield e.serverVersionsPromise;return e.canSupport=yield(0,ge.yk)(t),e.serverVersionsPromise}))()}isVersionSupported(e){var t=this;return(0,r.A)((function*(){var{versions:n}=yield t.getVersions();return n&&n.includes(e)}))()}doesServerSupportUnstableFeature(e){var t=this;return(0,r.A)((function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features;return r&&!!r[e]}))()}doesServerForceEncryptionForPreset(e){var t=this;return(0,r.A)((function*(){var n=yield t.getVersions();if(!n)return!1;var r=n.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r["io.element.e2ee_forced.".concat(i)]}))()}doesServerSupportThread(){var e=this;return(0,r.A)((function*(){if(yield e.isVersionSupported("v1.4"))return{threads:le.c1.Stable,list:le.c1.Stable,fwdPagination:le.c1.Stable};try{var[t,n,r,i,o,a]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:(0,le.FD)(n,t),list:(0,le.FD)(i,r),fwdPagination:(0,le.FD)(a,o)}}catch(e){return{threads:le.c1.None,list:le.c1.None,fwdPagination:le.c1.None}}}))()}hasLazyLoadMembersEnabled(){var e;return!(null===(e=this.clientOpts)||void 0===e||!e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,t,n,i){var o=arguments,a=this;return(0,r.A)((function*(){var r,s,l=o.length>4&&void 0!==o[4]?o[4]:{dir:p.O.Backward},c=i?a.getEncryptedIfNeededEventType(e,i):null,[d,u]=yield Promise.all([a.fetchRoomEvent(e,t),a.fetchRelations(e,t,n,c,l)]),h=a.getEventMapper(),v=d?h(d):void 0,m=u.chunk.map(h);if(c===g.Bx.RoomMessageEncrypted){var f=v?m.concat(v):m;yield Promise.all(f.map((e=>a.decryptEventIfNeeded(e)))),null!==i&&(m=m.filter((e=>e.getType()===i)))}return v&&n===g.zZ.Replace&&(m=m.filter((e=>e.getSender()===v.getSender()))),{originalEvent:null!=v?v:null,events:m,nextBatch:null!==(r=u.next_batch)&&void 0!==r?r:null,prevBatch:null!==(s=u.prev_batch)&&void 0!==s?s:null}}))()}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,K.US)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&this.isCryptoEnabled()&&e.attemptDecryption(this.cryptoBackend,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case R.S.IS:return this.http.getUrl("/terms",void 0,x.Pw.V2,t);case R.S.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",t);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,t;return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(null!==(e=this.idBaseUrl)&&void 0!==e&&e.startsWith("http://")||null!==(t=this.idBaseUrl)&&void 0!==t&&t.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=h.hc(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return null!==(e=this.http.opts.refreshToken)&&void 0!==e?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(x.IT.Get,"/register/available",{username:e}).then((e=>e.available)).catch((e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)))}register(e,t,n,r,i,o,a){n&&(r.session=n);var s={auth:r,refresh_token:!0};return null!=e&&(s.username=e),null!=t&&(s.password=t),null!=o&&(s.guest_access_token=o),null!=a&&(s.inhibit_login=a),this.registerRequest(s)}registerGuest(){var{body:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,t){var n={};return t&&(n.kind=t),this.http.request(x.IT.Post,"/register",n,e)}refreshToken(e){var t=t=>this.http.authedRequest(x.IT.Post,"/refresh",void 0,{refresh_token:e},{prefix:t,inhibitLogoutEmit:!0});return t(x.iD.V3).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return t(x.iD.V1);throw e}))}loginFlows(){return this.http.request(x.IT.Get,"/login")}login(e,t){return this.loginRequest(qe(qe({},t),{},{type:e})).then((e=>(e.access_token&&e.user_id&&(this.http.opts.accessToken=e.access_token,this.credentials={userId:e.user_id}),e)))}loginWithPassword(e,t){return this.login("m.login.password",{user:e,password:t})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r="/login/"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sso")+"/redirect";t&&(r+="/"+t);var i={redirectUrl:e,[ot.unstable]:n};return this.http.getUrl(r,i).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var t=this;return(0,r.A)((function*(){return yield t.http.authedRequest(x.IT.Post,"/login",void 0,e)}))()}logout(){var e=arguments,t=this;return(0,r.A)((function*(){var n,r=e.length>0&&void 0!==e[0]&&e[0];if(null!==(n=t.crypto)&&void 0!==n&&null!==(n=n.backupManager)&&void 0!==n&&n.getKeyBackupEnabled())try{for(;(yield t.crypto.backupManager.backupPendingKeys(200))>0;);}catch(e){t.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",e)}return r&&(t.stopClient(),t.http.abort()),t.http.authedRequest(x.IT.Post,"/logout")}))()}deactivateAccount(e,t){var n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(x.IT.Post,"/account/deactivate",void 0,n)}requestLoginToken(e){var t=this;return(0,r.A)((function*(){var n={auth:e};return t.http.authedRequest(x.IT.Post,"/login/get_token",void 0,n,{prefix:x.iD.V1})}))()}getFallbackAuthUrl(e,t){var n=h.RR("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t}).href}createRoom(e){var t=this;return(0,r.A)((function*(){var n,r=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(r.length>0&&null!==(n=t.identityServer)&&void 0!==n&&n.getAccessToken){var i=yield t.identityServer.getAccessToken();if(i)for(var o of r)o.id_access_token=i}return t.http.authedRequest(x.IT.Post,"/createRoom",void 0,e)}))()}fetchRelations(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{dir:p.O.Backward};le.jV.hasServerSideFwdPaginationSupport===le.c1.Experimental&&(i=(0,h.Ab)("dir","org.matrix.msc3715.dir",i)),this.canSupport.get(ge.Xj.RelationsRecursion)===ge.Tj.Unstable&&(i=(0,h.Ab)("recurse","org.matrix.msc3981.recurse",i));var o=h.hm(i),a="/rooms/$roomId/relations/$eventId";null!==n?(a+="/$relationType",null!==r&&(a+="/$eventType")):null!==r&&(this.logger.warn("eventType: ".concat(r," ignored when fetching\n            relations as relationType is null")),r=null);var s=h.RR(a+"?"+o,{$roomId:e,$eventId:t,$relationType:n,$eventType:r});return this.http.authedRequest(x.IT.Get,s,void 0,void 0,{prefix:x.iD.V1})}roomState(e){var t=h.RR("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(x.IT.Get,t)}fetchRoomEvent(e,t){var n=h.RR("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(x.IT.Get,n)}members(e,t,n,r){var i={};t&&(i.membership=t),n&&(i.not_membership=n),r&&(i.at=r);var o=h.hm(i),a=h.RR("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(x.IT.Get,a)}upgradeRoom(e,t){var n=h.RR("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(x.IT.Post,n,void 0,{new_version:t})}getStateEvent(e,t,n){var r={$roomId:e,$eventType:t,$stateKey:n},i=h.RR("/rooms/$roomId/state/$eventType",r);return void 0!==n&&(i=h.RR(i+"/$stateKey",r)),this.http.authedRequest(x.IT.Get,i)}sendStateEvent(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={$roomId:e,$eventType:t,$stateKey:r},a=h.RR("/rooms/$roomId/state/$eventType",o);return void 0!==r&&(a=h.RR(a+"/$stateKey",o)),this.http.authedRequest(x.IT.Put,a,void 0,n,i)}roomInitialSync(e,t){var n,r=h.RR("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(x.IT.Get,r,{limit:null!==(n=null==t?void 0:t.toString())&&void 0!==n?n:"30"})}setRoomReadMarkersHttpRequest(e,t,n,i){var o=this;return(0,r.A)((function*(){var r=h.RR("/rooms/$roomId/read_markers",{$roomId:e}),a={[ae.L.FullyRead]:t,[ae.L.Read]:n};return((yield o.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield o.isVersionSupported("v1.4")))&&(a[ae.L.ReadPrivate]=i),o.http.authedRequest(x.IT.Post,r,void 0,a)}))()}getJoinedRooms(){var e=h.RR("/joined_rooms",{});return this.http.authedRequest(x.IT.Get,e)}getJoinedRoomMembers(e){var t=h.RR("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(x.IT.Get,t)}publicRooms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{server:t,limit:n,since:r}=e,i=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Ke);if(0===Object.keys(i).length){var o={server:t,limit:n,since:r};return this.http.authedRequest(x.IT.Get,"/publicRooms",o)}var a={server:t},s=qe({limit:n,since:r},i);return this.http.authedRequest(x.IT.Post,"/publicRooms",a,s)}createAlias(e,t){var n=h.RR("/directory/room/$alias",{$alias:e}),r={room_id:t};return this.http.authedRequest(x.IT.Put,n,void 0,r)}deleteAlias(e){var t=h.RR("/directory/room/$alias",{$alias:e});return this.http.authedRequest(x.IT.Delete,t)}getLocalAliases(e){var t=h.RR("/rooms/$roomId/aliases",{$roomId:e}),n=x.iD.V3;return this.http.authedRequest(x.IT.Get,t,void 0,void 0,{prefix:n})}getRoomIdForAlias(e){var t=h.RR("/directory/room/$alias",{$alias:e});return this.http.authedRequest(x.IT.Get,t)}getRoomDirectoryVisibility(e){var t=h.RR("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(x.IT.Get,t)}setRoomDirectoryVisibility(e,t){var n=h.RR("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(x.IT.Put,n,void 0,{visibility:t})}searchUserDirectory(e){var{term:t,limit:n}=e,r={search_term:t};return void 0!==n&&(r.limit=n),this.http.authedRequest(x.IT.Post,"/user_directory/search",void 0,r)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t){var n=t?h.RR("/profile/$userId/$info",{$userId:e,$info:t}):h.RR("/profile/$userId",{$userId:e});return this.http.authedRequest(x.IT.Get,n)}doesServerSupportExtendedProfiles(){var e=this;return(0,r.A)((function*(){return e.doesServerSupportUnstableFeature(nt)}))()}getExtendedProfileRequestPrefix(){var e=this;return(0,r.A)((function*(){return(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?x.iD.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"}))()}getExtendedProfile(e){var t=this;return(0,r.A)((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return t.http.authedRequest(x.IT.Get,h.RR("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}getExtendedProfileProperty(e,t){var n=this;return(0,r.A)((function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return(yield n.http.authedRequest(x.IT.Get,h.RR("/profile/$userId/$key",{$userId:e,$key:t}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()}))[t]}))()}setExtendedProfileProperty(e,t){var n=this;return(0,r.A)((function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(x.IT.Put,h.RR("/profile/$userId/$key",{$userId:r,$key:e}),void 0,{[e]:t},{prefix:yield n.getExtendedProfileRequestPrefix()})}))()}deleteExtendedProfileProperty(e){var t=this;return(0,r.A)((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(x.IT.Delete,h.RR("/profile/$userId/$key",{$userId:n,$key:e}),void 0,void 0,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}patchExtendedProfile(e){var t=this;return(0,r.A)((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();return t.http.authedRequest(x.IT.Patch,h.RR("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}setExtendedProfile(e){var t=this;return(0,r.A)((function*(){if(!(yield t.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var n=t.getUserId();yield t.http.authedRequest(x.IT.Put,h.RR("/profile/$userId",{$userId:n}),{},e,{prefix:yield t.getExtendedProfileRequestPrefix()})}))()}getThreePids(){return this.http.authedRequest(x.IT.Get,"/account/3pid")}addThreePidOnly(e){var t=this;return(0,r.A)((function*(){return t.http.authedRequest(x.IT.Post,"/account/3pid/add",void 0,e)}))()}bindThreePid(e){var t=this;return(0,r.A)((function*(){return t.http.authedRequest(x.IT.Post,"/account/3pid/bind",void 0,e)}))()}unbindThreePid(e,t){var n=this;return(0,r.A)((function*(){var r={medium:e,address:t,id_server:n.getIdentityServerUrl(!0)};return n.http.authedRequest(x.IT.Post,"/account/3pid/unbind",void 0,r)}))()}deleteThreePid(e,t){return this.http.authedRequest(x.IT.Post,"/account/3pid/delete",void 0,{medium:e,address:t})}setPassword(e,t,n){var r={auth:e,new_password:t,logout_devices:n};return this.http.authedRequest(x.IT.Post,"/account/password",void 0,r)}getDevices(){return this.http.authedRequest(x.IT.Get,"/devices")}getDevice(e){var t=h.RR("/devices/$device_id",{$device_id:e});return this.http.authedRequest(x.IT.Get,t)}setDeviceDetails(e,t){var n=h.RR("/devices/$device_id",{$device_id:e});return this.http.authedRequest(x.IT.Put,n,void 0,t)}deleteDevice(e,t){var n=h.RR("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this.http.authedRequest(x.IT.Delete,n,void 0,r)}deleteMultipleDevices(e,t){var n={devices:e};return t&&(n.auth=t),this.http.authedRequest(x.IT.Post,"/delete_devices",void 0,n)}getPushers(){var e=this;return(0,r.A)((function*(){var t=yield e.http.authedRequest(x.IT.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(t.pushers=t.pushers.map((e=>(e.hasOwnProperty(g.cr.name)||(e[g.cr.name]=!0),e)))),t}))()}setPusher(e){return this.http.authedRequest(x.IT.Post,"/pushers/set",void 0,e)}removePusher(e,t){var n={pushkey:e,app_id:t,kind:null};return this.http.authedRequest(x.IT.Post,"/pushers/set",void 0,n)}setLocalNotificationSettings(e,t){var n="".concat(g.Xs.name,".").concat(e);return this.setAccountData(n,t)}getPushRules(){return this.http.authedRequest(x.IT.Get,"/pushrules/").then((e=>(this.setPushRules(e),this.pushRules)))}setPushRules(e){this.pushRules=T.rewriteDefaultRules(e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,t,n,r){var i=h.RR("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(x.IT.Put,i,void 0,r)}deletePushRule(e,t,n){var r=h.RR("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(x.IT.Delete,r)}setPushRuleEnabled(e,t,n,r){var i=h.RR("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(x.IT.Put,i,void 0,{enabled:r})}setPushRuleActions(e,t,n,r){var i=h.RR("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(x.IT.Put,i,void 0,{actions:r})}search(e,t){var{body:n,next_batch:r}=e,i={};return r&&(i.next_batch=r),this.http.authedRequest(x.IT.Post,"/search",i,n,{abortSignal:t})}uploadKeysRequest(e,t){return this.http.authedRequest(x.IT.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(x.IT.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={device_keys:{}};return void 0!==t&&(n.token=t),e.forEach((e=>{n.device_keys[e]=[]})),this.http.authedRequest(x.IT.Post,"/keys/query",void 0,n)}claimOneTimeKeys(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signed_curve25519",n=arguments.length>2?arguments[2]:void 0,r={};for(var[i,o]of(void 0===t&&(t="signed_curve25519"),e)){var a=r[i]||{};(0,h.C6)(r,i,a),(0,h.C6)(a,o,t)}var s={one_time_keys:r};return n&&(s.timeout=n),this.http.authedRequest(x.IT.Post,"/keys/claim",void 0,s)}getKeyChanges(e,t){var n={from:e,to:t};return this.http.authedRequest(x.IT.Get,"/keys/changes",n)}uploadDeviceSigningKeys(e,t){var n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(x.IT.Post,"/keys/device_signing/upload",void 0,n,{prefix:x.iD.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var t=this.http.getUrl("/account/register",void 0,x.Pw.V2,this.idBaseUrl);return this.http.requestOtherUrl(x.IT.Post,t,e)}requestEmailToken(e,t,n,r,i){var o={client_secret:t,email:e,send_attempt:null==n?void 0:n.toString()};return r&&(o.next_link=r),this.http.idServerRequest(x.IT.Post,"/validate/email/requestToken",o,x.Pw.V2,i)}requestMsisdnToken(e,t,n,r,i,o){var a={client_secret:n,country:e,phone_number:t,send_attempt:null==r?void 0:r.toString()};return i&&(a.next_link=i),this.http.idServerRequest(x.IT.Post,"/validate/msisdn/requestToken",a,x.Pw.V2,o)}submitMsisdnToken(e,t,n,r){var i={sid:e,client_secret:t,token:n};return this.http.idServerRequest(x.IT.Post,"/validate/msisdn/submitToken",i,x.Pw.V2,null!=r?r:void 0)}submitMsisdnTokenOtherUrl(e,t,n,r){var i={sid:t,client_secret:n,token:r};return this.http.requestOtherUrl(x.IT.Post,e,i)}getIdentityHashDetails(e){return this.http.idServerRequest(x.IT.Get,"/hash_details",void 0,x.Pw.V2,e)}identityHashedLookup(e,t){var n=this;return(0,r.A)((function*(){var i={},o=yield n.getIdentityHashDetails(t);if(!o||!o.lookup_pepper||!o.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=o.lookup_pepper;var a={};if(o.algorithms.includes("sha256"))i.addresses=yield Promise.all(e.map(function(){var e=(0,r.A)((function*(e){var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r=yield(0,$e.s)("".concat(t," ").concat(n," ").concat(i.pepper)),o=(0,k.A4)(r);return a[o]=e[0],o}));return function(t){return e.apply(this,arguments)}}())),i.algorithm="sha256";else{if(!o.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");i.addresses=e.map((e=>{var t=e[0].toLowerCase(),n=e[1].toLowerCase(),r="".concat(t," ").concat(n);return a[r]=e[0],r})),i.algorithm="none"}var s=yield n.http.idServerRequest(x.IT.Post,"/lookup",i,x.Pw.V2,t);if(null==s||!s.mappings)return[];var l=[];for(var c of Object.keys(s.mappings)){var d=s.mappings[c],u=a[c];if(!u)throw new Error("Identity server returned more results than expected");l.push({address:u,mxid:d})}return l}))()}lookupThreePid(e,t,n){var i=this;return(0,r.A)((function*(){var r=(yield i.identityHashedLookup([[t,e]],n)).find((e=>e.address===t));return r?{address:t,medium:e,mxid:r.mxid}:{}}))()}bulkLookupThreePids(e,t){var n=this;return(0,r.A)((function*(){var r=yield n.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),i=[],o=function*(t){var n=e.find((e=>e[1]===t.address));if(!n)throw new Error("Identity sever returned unexpected results");i.push([n[0],t.address,t.mxid])};for(var a of r)yield*o(a);return{threepids:i}}))()}getIdentityAccount(e){return this.http.idServerRequest(x.IT.Get,"/account",void 0,x.Pw.V2,e)}sendToDevice(e,t,n){var r=h.RR("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:h.HF(t)},o=new Map;for(var[a,s]of t)o.set(a,Array.from(s.keys()));return this.logger.debug("PUT ".concat(r),o),this.http.authedRequest(x.IT.Put,r,void 0,i)}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(x.IT.Get,"/thirdparty/protocols").then((e=>{if(!e||"object"!=typeof e)throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e}))}getThirdpartyLocation(e,t){var n=h.RR("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(x.IT.Get,n,t)}getThirdpartyUser(e,t){var n=h.RR("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(x.IT.Get,n,t)}getTerms(e,t){var n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(x.IT.Get,n)}agreeToTerms(e,t,n,r){var i=this.termsUrlForService(e,t),o={Authorization:"Bearer "+n};return this.http.requestOtherUrl(x.IT.Post,i,{user_accepts:r},{headers:o})}reportEvent(e,t,n,r){var i=h.RR("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(x.IT.Post,i,void 0,{score:n,reason:r})}getRoomHierarchy(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=h.RR("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(r),max_depth:null==n?void 0:n.toString(),from:i,limit:null==t?void 0:t.toString()};return this.http.authedRequest(x.IT.Get,o,a,void 0,{prefix:x.iD.V1}).catch((e=>{if("M_UNRECOGNIZED"===e.errcode)return this.http.authedRequest(x.IT.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw e}))}unstableCreateFileTree(e){var t=this;return(0,r.A)((function*(){var{room_id:n}=yield t.createRoom({name:e,preset:$.k.PrivateChat,power_level_content_override:qe(qe({},Z),{},{users:{[t.getUserId()]:100}}),creation_content:{[g.Ct]:g.CJ.Space},initial_state:[{type:g.D7.name,state_key:g.nN.name,content:{[g.ud.name]:!0}},{type:g.Bx.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new te(t,n)}))()}unstableGetFileTreeSpace(e){var t,n,r=this.getRoom(e);if((null==r?void 0:r.getMyMembership())!==J.O.Join)return null;var i=r.currentState.getStateEvents(g.Bx.RoomCreate,""),o=r.currentState.getStateEvents(g.D7.name,g.nN.name);if(!i)throw new Error("Expected single room create event");return null!=o&&null!==(t=o.getContent())&&void 0!==t&&t[g.ud.name]?(null===(n=i.getContent())||void 0===n?void 0:n[g.Ct])!==g.CJ.Space?null:new te(this,e):null}slidingSync(e,t,n){var r={};e.pos&&(r.pos=e.pos,delete e.pos),e.timeout&&(r.timeout=e.timeout,delete e.timeout);var i=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(x.IT.Post,"/sync",r,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:t,localTimeoutMs:i,abortSignal:n})}supportsThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(ge.Xj.IntentionalMentions)!==ge.Tj.Unsupported}getRoomSummary(e,t){var n=this;return(0,r.A)((function*(){var r={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var i=h.RR("/summary/$roomid",{$roomid:e});return yield n.http.authedRequest(x.IT.Get,i,{via:t},void 0,r)}catch(i){if(i instanceof x.up&&"M_UNRECOGNIZED"===i.errcode){var o=h.RR("/rooms/$roomid/summary",{$roomid:e});return yield n.http.authedRequest(x.IT.Get,o,{via:t},void 0,r)}throw i}}))()}processThreadEvents(e,t,n){e.processThreadedEvents(t,n)}processThreadRoots(e,t,n){this.supportsThreads()&&e.processThreadRoots(t,n)}processBeaconEvents(e,t){this.processAggregatedTimelineEvents(e,t)}processAggregatedTimelineEvents(e,t){null!=t&&t.length&&e&&(e.currentState.processBeaconEvents(t,this),e.processPollEvents(t))}whoami(){var e=this;return(0,r.A)((function*(){return e.http.authedRequest(x.IT.Get,"/account/whoami")}))()}timestampToEvent(e,t,n){var i=this;return(0,r.A)((function*(){var r=h.RR("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:t.toString(),dir:n};try{return yield i.http.authedRequest(x.IT.Get,r,o,void 0,{prefix:x.iD.V1})}catch(e){if("M_UNRECOGNIZED"===e.errcode&&(400===e.httpStatus||404===e.httpStatus||405===e.httpStatus))return yield i.http.authedRequest(x.IT.Get,r,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw e}}))()}getAuthIssuer(){var e=this;return(0,r.A)((function*(){return e.http.request(x.IT.Get,"/auth_issuer",void 0,void 0,{prefix:x.iD.Unstable+"/org.matrix.msc2965"})}))()}getAuthMetadata(){var e=this;return(0,r.A)((function*(){var t;try{t=yield e.http.request(x.IT.Get,"/auth_metadata",void 0,void 0,{prefix:x.iD.Unstable+"/org.matrix.msc2965"})}catch(t){if(t instanceof x.up&&"M_UNRECOGNIZED"===t.errcode){var{issuer:n}=yield e.getAuthIssuer();return(0,je.k8)(n)}throw t}return(0,je.Pl)(t)}))()}}function st(e){return Object.fromEntries(Object.entries(e).map((e=>{var[t,n]=e;return["".concat(tt,".").concat(t),n]})))}function lt(e,t){var n,r=e.getUserId(),i=t.getId(),o=e.getRoom(t.getRoomId());if(o&&r&&i)if(o.findEventById(i)){var a,s=!!t.threadRootId&&!t.isThreadRoot;if(s){var l=o.getThread(t.threadRootId);a=!l||l.hasUserReadEvent(r,i)}else a=o.hasUserReadEvent(r,i);if(!a){var c=e.getPushActionsForEvent(t,!0);if(null!=c&&null!==(n=c.tweaks)&&void 0!==n&&n.highlight){var d=o.getUnreadCountForEventContext(B.X5.Highlight,t)+1;s?o.setThreadUnreadNotificationCount(t.threadRootId,B.X5.Highlight,d):o.setUnreadNotificationCount(B.X5.Highlight,d)}if(null!=c&&c.notify){var u=o.getUnreadCountForEventContext(B.X5.Total,t)+1;s?o.setThreadUnreadNotificationCount(t.threadRootId,B.X5.Total,u):o.setUnreadNotificationCount(B.X5.Total,u)}}}else v.v.info("Decrypted event ".concat(t.getId()," is not in room ").concat(o.roomId,": ignoring"))}function ct(e){return dt(e)?ae.S:e.threadRootId}function dt(e){return!(e.threadRootId&&!e.isThreadRoot&&(e.isRelation()?e.isRelation(le.RN.name)||e.relationEventId!==e.threadRootId:(v.v.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(e.getId())),0)))}(0,i.A)(at,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")},6215:(e,t,n)=>{"use strict";n.d(t,{O:()=>i});var r=n(4980);class i extends Error{constructor(e,t,n){super(t),this.code=e,(0,r.A)(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=function(e,t){var n=e.name+"[msg: "+e.message;return t&&(n+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),n+"]"}(this,n)}}},4304:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});var r=n(8417);function i(e,t){if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return(0,r.deriveRecoveryKeyFromPassphrase)(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits)}},2027:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getTextForLocationEvent:()=>g,makeBeaconContent:()=>C,makeBeaconInfoContent:()=>b,makeEmoteMessage:()=>m,makeHtmlEmote:()=>h,makeHtmlMessage:()=>d,makeHtmlNotice:()=>u,makeLocationContent:()=>f,makeNotice:()=>v,makeTextMessage:()=>p,makeTopicContent:()=>_,parseBeaconContent:()=>w,parseBeaconInfoContent:()=>S,parseLocationEvent:()=>y,parseTopicContent:()=>E});var r=n(4980),i=n(2986),o=n(6209),a=n(8722),s=n(4867),l=n(1265);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e,t){return{msgtype:i.Wr.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}}function u(e,t){return{msgtype:i.Wr.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}}function h(e,t){return{msgtype:i.Wr.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}}function p(e){return{msgtype:i.Wr.Text,body:e}}function v(e){return{msgtype:i.Wr.Notice,body:e}}function m(e){return{msgtype:i.Wr.Emote,body:e}}var g=(e,t,n,r)=>{var i="at ".concat(new Date(n).toISOString());return[t===s.Yg.Self?"User":void 0,"Location",r?'"'.concat(r,'"'):void 0,e,i].filter(Boolean).join(" ")},f=(e,t,n,a,l)=>{var d=null!=e?e:g(t,l||s.Yg.Self,n,a),u=n?{[s.vo.name]:n}:{};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({msgtype:i.Wr.Location,body:d,geo_uri:t,[s.M6.name]:{description:a,uri:t},[s.J1.name]:{type:l||s.Yg.Self},[o.yB.name]:d},u)},y=e=>{var t,n,r=s.M6.findIn(e),i=s.J1.findIn(e),a=s.vo.findIn(e),l=o.yB.findIn(e),c=null!==(t=null==r?void 0:r.uri)&&void 0!==t?t:null==e?void 0:e.geo_uri,d=null==r?void 0:r.description,u=null!==(n=null==i?void 0:i.type)&&void 0!==n?n:s.Yg.Self,h=null!=l?l:e.body;return f(h,c,null!=a?a:void 0,d,u)},_=(e,t)=>{var n=[];return(0,a.c)(e)&&n.push({body:e,mimetype:"text/plain"}),(0,a.c)(t)&&n.push({body:t,mimetype:"text/html"}),{topic:e,[l.s.name]:n}},E=e=>{var t,n,r,i,o,s=l.s.findIn(e);return Array.isArray(s)?{text:null!==(t=null!==(n=null==s||null===(r=s.find((e=>!(0,a.c)(e.mimetype)||"text/plain"===e.mimetype)))||void 0===r?void 0:r.body)&&void 0!==n?n:e.topic)&&void 0!==t?t:void 0,html:null==s||null===(i=s.find((e=>"text/html"===e.mimetype)))||void 0===i?void 0:i.body}:{text:null!==(o=e.topic)&&void 0!==o?o:void 0}},b=(e,t,n,r,i)=>({description:n,timeout:e,live:t,[s.vo.name]:i||Date.now(),[s.J1.name]:{type:null!=r?r:s.Yg.Self}}),S=e=>{var t,{description:n,timeout:r,live:i}=e,o=null!==(t=s.vo.findIn(e))&&void 0!==t?t:void 0,a=s.J1.findIn(e);return{description:n,timeout:r,live:i,assetType:null==a?void 0:a.type,timestamp:o}},C=(e,t,n,r)=>({[s.M6.name]:{description:r,uri:e},[s.vo.name]:t,"m.relates_to":{rel_type:o.BJ.name,event_id:n}}),w=e=>{var t,n=s.M6.findIn(e),r=null!==(t=s.vo.findIn(e))&&void 0!==t?t:void 0;return{description:null==n?void 0:n.description,uri:null==n?void 0:n.uri,timestamp:r}}},6344:(e,t,n)=>{"use strict";n.d(t,{y:()=>o});var r=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/,i=/^[\w-]+$/;function o(e,t,n,o,a){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0;if("string"!=typeof t||!t)return"";if(!t.startsWith("mxc://"))return s?t:"";var d,[u,h,...p]=t.slice(6).split("/");if(p.length>0||!function(e){var t=r.exec(e);return(null==t?void 0:t[0])===e}(u)||!function(e){var t=i.exec(e);return(null==t?void 0:t[0])===e}(h))return"";c&&(l=!0);var v=n||o||a?"thumbnail":"download";d=c?"/_matrix/client/v1/media/".concat(v):"/_matrix/media/v3/".concat(v);var m=new URL("".concat(d,"/").concat(u,"/").concat(h),e);return n&&m.searchParams.set("width",Math.round(n).toString()),o&&m.searchParams.set("height",Math.round(o).toString()),a&&m.searchParams.set("method",a),"boolean"==typeof l&&m.searchParams.set("allow_redirect",JSON.stringify(l)),m.href}},8417:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AllDevicesIsolationMode:()=>f,CrossSigningKey:()=>b,CryptoEvent:()=>v,DecryptionFailureCode:()=>m,DeviceIsolationModeKind:()=>g,DeviceVerificationStatus:()=>E,EventShieldColour:()=>S,EventShieldReason:()=>C,OnlySignedDevicesIsolationMode:()=>y,UserVerificationStatus:()=>_,VerificationPhase:()=>i.X9,VerificationRequestEvent:()=>i.FM,VerifierEvent:()=>i.Ji,canAcceptVerificationRequest:()=>i.Dy,decodeRecoveryKey:()=>c,deriveRecoveryKeyFromPassphrase:()=>h,encodeRecoveryKey:()=>l});var r=n(4980),i=n(4400);const o=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let e=0;e<t.length;e++)t[e]=255;for(let n=0;n<e.length;n++){const r=e.charAt(n),i=r.charCodeAt(0);if(255!==t[i])throw new TypeError(r+" is ambiguous");t[i]=n}const n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),o=Math.log(256)/Math.log(n);function a(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let o=0,a=0,s=0;for(;e[o]===r;)a++,o++;const l=(e.length-o)*i+1>>>0,c=new Uint8Array(l);for(;e[o];){let r=t[e.charCodeAt(o)];if(255===r)return;let i=0;for(let e=l-1;(0!==r||i<s)&&-1!==e;e--,i++)r+=n*c[e]>>>0,c[e]=r%256>>>0,r=r/256>>>0;if(0!==r)throw new Error("Non-zero carry");s=i,o++}let d=l-s;for(;d!==l&&0===c[d];)d++;const u=new Uint8Array(a+(l-d));let h=a;for(;d!==l;)u[h++]=c[d++];return u}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let i=0,a=0,s=0;const l=t.length;for(;s!==l&&0===t[s];)s++,i++;const c=(l-s)*o+1>>>0,d=new Uint8Array(c);for(;s!==l;){let e=t[s],r=0;for(let t=c-1;(0!==e||r<a)&&-1!==t;t--,r++)e+=256*d[t]>>>0,d[t]=e%n>>>0,e=e/n>>>0;if(0!==e)throw new Error("Non-zero carry");a=r,s++}let u=c-a;for(;u!==c&&0===d[u];)u++;let h=r.repeat(i);for(;u<c;++u)h+=e.charAt(d[u]);return h},decodeUnsafe:a,decode:function(e){const t=a(e);if(t)return t;throw new Error("Non-base"+n+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var a=[139,1],s=32;function l(e){var t,n=new Uint8Array(a.length+e.length+1);n.set(a,0),n.set(e,a.length);for(var r=0,i=0;i<n.length-1;++i)r^=n[i];return n[n.length-1]=r,null===(t=o.encode(n).match(/.{1,4}/g))||void 0===t?void 0:t.join(" ")}function c(e){var t=o.decode(e.replace(/ /g,"")),n=0;for(var r of t)n^=r;if(0!==n)throw new Error("Incorrect parity");for(var i=0;i<a.length;++i)if(t[i]!==a[i])throw new Error("Incorrect prefix");if(t.length!==a.length+s+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(a.length,a.length+s))}var d=n(467),u=256;function h(e,t,n){return p.apply(this,arguments)}function p(){return p=(0,d.A)((function*(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u;if(!globalThis.crypto.subtle||!TextEncoder)throw new Error("Password-based backup is not available on this platform");var i=yield globalThis.crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),o=yield globalThis.crypto.subtle.deriveBits({name:"PBKDF2",salt:(new TextEncoder).encode(t),iterations:n,hash:"SHA-512"},i,r);return new Uint8Array(o)})),p.apply(this,arguments)}var v=function(e){return e.UserTrustStatusChanged="userTrustStatusChanged",e.KeyBackupStatus="crypto.keyBackupStatus",e.KeyBackupFailed="crypto.keyBackupFailed",e.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",e.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",e.VerificationRequestReceived="crypto.verificationRequestReceived",e.WillUpdateDevices="crypto.willUpdateDevices",e.DevicesUpdated="crypto.devicesUpdated",e.KeysChanged="crossSigning.keysChanged",e.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",e.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",e.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",e.RehydrationStarted="dehydration.RehydrationStarted",e.RehydrationProgress="dehydration.RehydrationProgress",e.RehydrationCompleted="dehydration.RehydrationCompleted",e.RehydrationError="dehydration.RehydrationError",e.DehydrationKeyCached="dehydration.DehydrationKeyCached",e.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",e}({}),m=function(e){return e.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",e.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",e.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",e.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",e.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",e.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",e.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",e.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",e.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",e.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",e.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",e.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",e.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",e.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",e.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",e.OLM_BAD_ROOM="OLM_BAD_ROOM",e.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",e.OLM_BAD_SENDER="OLM_BAD_SENDER",e.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",e.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",e.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",e.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",e}({}),g=function(e){return e[e.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",e[e.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",e}({});class f{constructor(e){this.errorOnVerifiedUserProblems=e,(0,r.A)(this,"kind",g.AllDevicesIsolationMode)}}class y{constructor(){(0,r.A)(this,"kind",g.OnlySignedDevicesIsolationMode)}}class _{constructor(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=n,(0,r.A)(this,"needsUserApproval",void 0),this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class E{constructor(e){var t,n,i,o,a;(0,r.A)(this,"signedByOwner",void 0),(0,r.A)(this,"crossSigningVerified",void 0),(0,r.A)(this,"tofu",void 0),(0,r.A)(this,"localVerified",void 0),(0,r.A)(this,"trustCrossSignedDevices",void 0),this.signedByOwner=null!==(t=e.signedByOwner)&&void 0!==t&&t,this.crossSigningVerified=null!==(n=e.crossSigningVerified)&&void 0!==n&&n,this.tofu=null!==(i=e.tofu)&&void 0!==i&&i,this.localVerified=null!==(o=e.localVerified)&&void 0!==o&&o,this.trustCrossSignedDevices=null!==(a=e.trustCrossSignedDevices)&&void 0!==a&&a}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var b=function(e){return e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing",e}({}),S=function(e){return e[e.NONE=0]="NONE",e[e.GREY=1]="GREY",e[e.RED=2]="RED",e}({}),C=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",e[e.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",e[e.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",e[e.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",e[e.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",e[e.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",e[e.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",e}({})},4400:(e,t,n)=>{"use strict";n.d(t,{Dy:()=>a,FM:()=>r,Ji:()=>o,X9:()=>i});var r=function(e){return e.Change="change",e}({}),i=function(e){return e[e.Unsent=1]="Unsent",e[e.Requested=2]="Requested",e[e.Ready=3]="Ready",e[e.Started=4]="Started",e[e.Cancelled=5]="Cancelled",e[e.Done=6]="Done",e}({}),o=function(e){return e.Cancel="cancel",e.ShowSas="show_sas",e.ShowReciprocateQr="show_reciprocate_qr",e}({});function a(e){return e.phase<i.Ready&&!e.accepting&&!e.declining}},5614:(e,t,n)=>{"use strict";n.d(t,{n:()=>r.CrossSigningKey});var r=n(8417)},5150:(e,t,n)=>{"use strict";n.d(t,{IG:()=>w,IO:()=>y,M7:()=>A});var r=n(467),i=n(4980),o=n(4792),a=n(3840),s=n(8197),l=n(2824),c=n(3883),d=n(5530),u=n(2340),h=n(7780),p=n(9521),v=n(8417),m=n(5542),g=n(1630),f=n(6900);class y{constructor(e,t){this.baseApis=e,this.getKey=t,(0,i.A)(this,"algorithm",void 0),(0,i.A)(this,"backupInfo",void 0),(0,i.A)(this,"checkedForBackup",void 0),(0,i.A)(this,"sendingBackups",void 0),(0,i.A)(this,"sessionLastCheckAttemptedTime",{}),(0,i.A)(this,"clientRunning",!0),this.checkedForBackup=!1,this.sendingBackups=!1}stop(){this.clientRunning=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){var t=S[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}static makeAlgorithm(e,t){var n=S[e.algorithm];if(!n)throw new Error("Unknown backup algorithm");return n.init(e.auth_data,t)}enableKeyBackup(e){var t=this;return(0,r.A)((function*(){t.backupInfo=e,t.algorithm&&t.algorithm.free(),t.algorithm=yield y.makeAlgorithm(e,t.getKey),t.baseApis.emit(h.cr.KeyBackupStatus,!0),t.scheduleKeyBackupSend()}))()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(h.cr.KeyBackupStatus,!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}prepareKeyBackupVersion(e,t){return(0,r.A)((function*(){var n=t?S[t]:C;if(!n)throw new Error("Unknown backup algorithm");var[r,i]=yield n.prepare(e),o=(0,v.encodeRecoveryKey)(r);return{algorithm:n.algorithmName,auth_data:i,recovery_key:o,privateKey:r}}))()}createKeyBackupVersion(e){var t=this;return(0,r.A)((function*(){t.algorithm=yield y.makeAlgorithm(e,t.getKey)}))()}deleteAllKeyBackupVersions(){var e=this;return(0,r.A)((function*(){for(var t,n,r=null!==(t=null===(n=yield e.baseApis.getKeyBackupVersion())||void 0===n?void 0:n.version)&&void 0!==t?t:null;null!=r;){var i,o;yield e.deleteKeyBackupVersion(r),e.disableKeyBackup(),r=null!==(i=null===(o=yield e.baseApis.getKeyBackupVersion())||void 0===o?void 0:o.version)&&void 0!==i?i:null}}))()}deleteKeyBackupVersion(e){var t=this;return(0,r.A)((function*(){var n=(0,c.RR)("/room_keys/version/$version",{$version:e});yield t.baseApis.http.authedRequest(p.IT.Delete,n,void 0,void 0,{prefix:p.iD.V3})}))()}checkAndStart(){var e=this;return(0,r.A)((function*(){if(a.v.log("Checking key backup status..."),e.baseApis.isGuest())return a.v.log("Skipping key backup check since user is guest"),e.checkedForBackup=!0,null;var t;try{var n;t=null!==(n=yield e.baseApis.getKeyBackupVersion())&&void 0!==n?n:void 0}catch(t){return a.v.log("Error checking for active key backup",t),404===t.httpStatus&&(e.checkedForBackup=!0),null}e.checkedForBackup=!0;var r=yield e.isKeyBackupTrusted(t);return r.usable&&!e.backupInfo?(a.v.log("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):!r.usable&&e.backupInfo?(a.v.log("No usable key backup: disabling key backup"),e.disableKeyBackup()):r.usable||e.backupInfo?r.usable&&e.backupInfo&&(t.version!==e.backupInfo.version?(a.v.log("On backup version ".concat(e.backupInfo.version," but ")+"found version ".concat(t.version,": switching.")),e.disableKeyBackup(),yield e.enableKeyBackup(t),yield e.scheduleAllGroupSessionsForBackup()):a.v.log("Backup version ".concat(t.version," still current"))):a.v.log("No usable key backup: not enabling key backup"),{backupInfo:t,trustInfo:r}}))()}checkKeyBackup(){var e=this;return(0,r.A)((function*(){return e.checkedForBackup=!1,e.checkAndStart()}))()}queryKeyBackupRateLimited(e,t){var n=this;return(0,r.A)((function*(){if(n.backupInfo){var r=(new Date).getTime();(!n.sessionLastCheckAttemptedTime[t]||r-n.sessionLastCheckAttemptedTime[t]>5e3)&&(n.sessionLastCheckAttemptedTime[t]=r,yield n.baseApis.restoreKeyBackupWithCache(e,t,n.backupInfo,{}))}}))()}isKeyBackupTrusted(e){var t=this;return(0,r.A)((function*(){var n={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.signatures))return a.v.info("Key backup is absent or missing required data: ".concat(JSON.stringify(e))),n;var i=t.baseApis.getUserId(),o=yield t.baseApis.crypto.getSessionBackupPrivateKey();if(o){var l=null;try{l=yield y.makeAlgorithm(e,(0,r.A)((function*(){return o}))),(yield l.keyMatches(o))&&(a.v.info("Backup is trusted locally"),n.trusted_locally=!0)}catch(e){}finally{var c;null===(c=l)||void 0===c||c.free()}}var d=e.auth_data.signatures[i]||{};for(var u of Object.keys(d)){var h=u.split(":");if("ed25519"===h[0]){var p={deviceId:h[1]},v=t.baseApis.crypto.crossSigningInfo.getId();if(v!==p.deviceId){var m=t.baseApis.crypto.deviceList.getStoredDevice(i,p.deviceId);if(m){p.device=m,p.deviceTrust=t.baseApis.checkDeviceTrust(i,p.deviceId);try{yield(0,s.verifySignature)(t.baseApis.crypto.olmDevice,e.auth_data,i,m.deviceId,m.getFingerprint()),p.valid=!0}catch(n){a.v.info("Bad signature from key ID "+u+" userID "+t.baseApis.getUserId()+" device ID "+m.deviceId+" fingerprint: "+m.getFingerprint(),e.auth_data,n),p.valid=!1}}else p.valid=null,a.v.info("Ignoring signature from unknown key "+u);n.sigs.push(p)}else{p.crossSigningId=!0;try{yield(0,s.verifySignature)(t.baseApis.crypto.olmDevice,e.auth_data,i,p.deviceId,v),p.valid=!0}catch(e){a.v.warn("Bad signature from cross signing key "+v,e),p.valid=!1}n.sigs.push(p)}}else a.v.log("Ignoring unknown signature type: "+h[0])}return n.usable=n.sigs.some((e=>{var t;return e.valid&&(e.device&&(null===(t=e.deviceTrust)||void 0===t?void 0:t.isVerified())||e.crossSigningId)})),n}))()}scheduleKeyBackupSend(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:1e4;if(a.v.debug("Key backup: scheduleKeyBackupSend currentSending:".concat(t.sendingBackups," delay:").concat(n)),!t.sendingBackups){t.sendingBackups=!0;try{var r=Math.random()*n;if(yield(0,c.yy)(r),!t.clientRunning)return void(t.sendingBackups=!1);for(var i=0;;){if(!t.algorithm)return;try{if(0===(yield t.backupPendingKeys(200)))return void(t.sendingBackups=!1);i=0}catch(e){if(i++,a.v.log("Key backup request failed",e),e instanceof p.up){var o=e.data.errcode;if("M_NOT_FOUND"==o||"M_WRONG_ROOM_KEYS_VERSION"==o)return t.sendingBackups=!1,t.baseApis.crypto.emit(h.cr.KeyBackupFailed,o),void(yield t.checkKeyBackup())}}if(i&&(yield(0,c.yy)(1e3*Math.pow(2,Math.min(i-1,4)))),!t.clientRunning)return a.v.debug("Key backup send loop aborted, client stopped"),void(t.sendingBackups=!1)}}catch(e){a.v.log("Backup loop failed ".concat(e)),t.sendingBackups=!1}}}))()}backupPendingKeys(e){var t=this;return(0,r.A)((function*(){var n=yield t.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!n.length)return 0;var r=yield t.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();t.baseApis.crypto.emit(h.cr.KeyBackupSessionsRemaining,r);var i={};for(var o of n){var a,l=o.sessionData.room_id;(0,c.C6)(i,l,i[l]||{sessions:{}});var d=t.baseApis.crypto.olmDevice.exportInboundGroupSession(o.senderKey,o.sessionId,o.sessionData);d.algorithm=s.MEGOLM_ALGORITHM;var u=(d.forwarding_curve25519_key_chain||[]).length,p=t.baseApis.crypto.deviceList.getUserByIdentityKey(s.MEGOLM_ALGORITHM,o.senderKey),v=null!==(a=t.baseApis.crypto.deviceList.getDeviceByIdentityKey(s.MEGOLM_ALGORITHM,o.senderKey))&&void 0!==a?a:void 0,m=t.baseApis.crypto.checkDeviceInfoTrust(p,v).isVerified();(0,c.C6)(i[l].sessions,o.sessionId,{first_message_index:d.first_known_index,forwarded_count:u,is_verified:m,session_data:yield t.algorithm.encryptSession(d)})}return yield t.baseApis.sendKeyBackup(void 0,void 0,t.backupInfo.version,{rooms:i}),yield t.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(n),r=yield t.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),t.baseApis.crypto.emit(h.cr.KeyBackupSessionsRemaining,r),n.length}))()}backupGroupSession(e,t){var n=this;return(0,r.A)((function*(){yield n.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),n.backupInfo&&n.scheduleKeyBackupSend()}))()}scheduleAllGroupSessionsForBackup(){var e=this;return(0,r.A)((function*(){yield e.flagAllGroupSessionsForBackup(),e.scheduleKeyBackupSend(0)}))()}flagAllGroupSessionsForBackup(){var e=this;return(0,r.A)((function*(){yield e.baseApis.crypto.cryptoStore.doTxn("readwrite",[d.y.STORE_INBOUND_GROUP_SESSIONS,d.y.STORE_BACKUP],(t=>{e.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(t,(n=>{null!==n&&e.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([n],t)}))}));var t=yield e.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return e.baseApis.emit(h.cr.KeyBackupSessionsRemaining,t),t}))()}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}class _{constructor(e,t,n){this.authData=e,this.publicKey=t,this.getKey=n}static init(e,t){return(0,r.A)((function*(){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");var n=new globalThis.Olm.PkEncryption;return n.set_recipient_key(e.public_key),new _(e,n,t)}))()}static prepare(e){return(0,r.A)((function*(){var t=new globalThis.Olm.PkDecryption;try{var n={};if(e)if(e instanceof Uint8Array)n.public_key=t.init_with_private_key(e);else{var r=yield(0,l.SM)(e);n.private_key_salt=r.salt,n.private_key_iterations=r.iterations,n.public_key=t.init_with_private_key(r.key)}else n.public_key=t.generate_key();return(new globalThis.Olm.PkEncryption).set_recipient_key(n.public_key),[t.get_private_key(),n]}finally{t.free()}}))()}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}encryptSession(e){var t=this;return(0,r.A)((function*(){var n=Object.assign({},e);return delete n.session_id,delete n.room_id,delete n.first_known_index,t.publicKey.encrypt(JSON.stringify(n))}))()}decryptSessions(e){var t=this;return(0,r.A)((function*(){var n=yield t.getKey(),r=new globalThis.Olm.PkDecryption;try{if(r.init_with_private_key(n)!==t.authData.public_key)throw new p.up({errcode:o.pB.RESTORE_BACKUP_ERROR_BAD_KEY});var i=[];for(var[s,l]of Object.entries(e))try{var c=JSON.parse(r.decrypt(l.session_data.ephemeral,l.session_data.mac,l.session_data.ciphertext));c.session_id=s,i.push(c)}catch(e){a.v.log("Failed to decrypt megolm session from backup",e,l)}return i}finally{r.free()}}))()}keyMatches(e){var t=this;return(0,r.A)((function*(){var n,r=new globalThis.Olm.PkDecryption;try{n=r.init_with_private_key(e)}finally{r.free()}return n===t.authData.public_key}))()}free(){this.publicKey.free()}}(0,i.A)(_,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");var E=new u.qr("m.megolm_backup.v1.aes-hmac-sha2","org.matrix.msc3270.v1.aes-hmac-sha2");class b{constructor(e,t){this.authData=e,this.key=t}static init(e,t){return(0,r.A)((function*(){if(!e)throw new Error("auth_data missing");var n=yield t();if(e.mac){var{mac:r}=yield(0,f.calculateKeyCheck)(n,e.iv);if(e.mac.replace(/=+$/g,"")!==r.replace(/=+/g,""))throw new Error("Key does not match")}return new b(e,n)}))()}static prepare(e){return(0,r.A)((function*(){var t,n,r={};if(e)if(e instanceof Uint8Array)t=new Uint8Array(e);else{var i=yield(0,l.SM)(e);r.private_key_salt=i.salt,r.private_key_iterations=i.iterations,t=i.key}else n=new Uint8Array(32),globalThis.crypto.getRandomValues(n),t=n;var{iv:o,mac:a}=yield(0,f.calculateKeyCheck)(t);return r.iv=o,r.mac=a,[t,r]}))()}static checkBackupVersion(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}encryptSession(e){var t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,(0,g.A)(JSON.stringify(t),this.key,e.session_id)}decryptSessions(e){var t=this;return(0,r.A)((function*(){var n=[];for(var[r,i]of Object.entries(e))try{var o=JSON.parse(yield(0,m.A)(i.session_data,t.key,r));o.session_id=r,n.push(o)}catch(e){a.v.log("Failed to decrypt megolm session from backup",e,i)}return n}))()}keyMatches(e){var t=this;return(0,r.A)((function*(){if(t.authData.mac){var{mac:n}=yield(0,f.calculateKeyCheck)(e,t.authData.iv);return t.authData.mac.replace(/=+$/g,"")===n.replace(/=+/g,"")}return!0}))()}free(){this.key.fill(0)}}(0,i.A)(b,"algorithmName",E.name);var S={[_.algorithmName]:_,[b.algorithmName]:b},C=_;function w(e){var t;return{trusted:e.usable,matchesDecryptionKey:null!==(t=e.trusted_locally)&&void 0!==t&&t}}class A{constructor(e){(0,i.A)(this,"algorithm",void 0),(0,i.A)(this,"sourceTrusted",void 0),this.algorithm=e,this.sourceTrusted=!e.untrusted}free(){this.algorithm.free()}decryptSessions(e){var t=this;return(0,r.A)((function*(){return yield t.algorithm.decryptSessions(e)}))()}}},29:(e,t,n)=>{"use strict";n.d(t,{S:()=>h,v:()=>v});var r=n(467),i=n(4980),o=n(4069),a=n(7723),s=n(5530),l=n(3840),c=n(9521),d=n(5542),u=n(1630),h="org.matrix.msc2697.v1.olm.libolm_pickle",p=6048e5;class v{constructor(e){this.crypto=e,(0,i.A)(this,"inProgress",!1),(0,i.A)(this,"timeoutId",void 0),(0,i.A)(this,"key",void 0),(0,i.A)(this,"keyInfo",void 0),(0,i.A)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}getDehydrationKeyFromCache(){var e=this;return this.crypto.cryptoStore.doTxn("readonly",[s.y.STORE_ACCOUNT],(t=>{this.crypto.cryptoStore.getSecretStorePrivateKey(t,function(){var t=(0,r.A)((function*(t){if(t){var{key:n,keyInfo:r,deviceDisplayName:i,time:o}=t,s=Buffer.from(e.crypto.olmDevice.pickleKey),l=yield(0,d.A)(n,s,h);e.key=(0,a.y4)(l),e.keyInfo=r,e.deviceDisplayName=i;var c=Date.now(),u=Math.max(1,o+p-c);e.timeoutId=globalThis.setTimeout(e.dehydrateDevice.bind(e),u)}}));return function(e){return t.apply(this,arguments)}}(),"dehydration")}))}setKeyAndQueueDehydration(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{},i=t.length>2?t[2]:void 0;(yield n.setKey(e,r,i))||n.dehydrateDevice()}))()}setKey(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{},i=t.length>2?t[2]:void 0;if(!e)return n.timeoutId&&(globalThis.clearTimeout(n.timeoutId),n.timeoutId=void 0),yield n.crypto.cryptoStore.doTxn("readwrite",[s.y.STORE_ACCOUNT],(e=>{n.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),n.key=void 0,void(n.keyInfo=void 0);for(var o=!!n.key&&e.length==n.key.length,a=0;o&&a<e.length;a++)e[a]!=n.key[a]&&(o=!1);return o||(n.key=e,n.keyInfo=r,n.deviceDisplayName=i),o}))()}dehydrateDevice(){var e=this;return(0,r.A)((function*(){if(e.inProgress)l.v.log("Dehydration already in progress -- not starting new dehydration");else{e.inProgress=!0,e.timeoutId&&(globalThis.clearTimeout(e.timeoutId),e.timeoutId=void 0);try{var t=Buffer.from(e.crypto.olmDevice.pickleKey),n=yield(0,u.A)((0,a.WG)(e.key),t,h);yield e.crypto.cryptoStore.doTxn("readwrite",[s.y.STORE_ACCOUNT],(t=>{e.crypto.cryptoStore.storeSecretStorePrivateKey(t,"dehydration",{keyInfo:e.keyInfo,key:n,deviceDisplayName:e.deviceDisplayName,time:Date.now()})})),l.v.log("Attempting to dehydrate device"),l.v.log("Creating account");var r=new globalThis.Olm.Account;r.create();var i=JSON.parse(r.identity_keys()),d=r.max_number_of_one_time_keys();r.generate_one_time_keys(d/2),r.generate_fallback_key();var v=JSON.parse(r.one_time_keys()),m=JSON.parse(r.fallback_key());r.mark_keys_as_published();var g=r.pickle(new Uint8Array(e.key)),f={algorithm:h,account:g};e.keyInfo.passphrase&&(f.passphrase=e.keyInfo.passphrase),l.v.log("Uploading account to server");var y=(yield e.crypto.baseApis.http.authedRequest(c.IT.Put,"/dehydrated_device",void 0,{device_data:f,initial_device_display_name:e.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;l.v.log("Preparing device keys",y);var _={algorithms:e.crypto.supportedAlgorithms,device_id:y,user_id:e.crypto.userId,keys:{["ed25519:".concat(y)]:i.ed25519,["curve25519:".concat(y)]:i.curve25519}},E=r.sign(o.stringify(_));_.signatures={[e.crypto.userId]:{["ed25519:".concat(y)]:E}},e.crypto.crossSigningInfo.getId("self_signing")&&(yield e.crypto.crossSigningInfo.signObject(_,"self_signing")),l.v.log("Preparing one-time keys");var b={};for(var[S,C]of Object.entries(v.curve25519)){var w={key:C},A=r.sign(o.stringify(w));w.signatures={[e.crypto.userId]:{["ed25519:".concat(y)]:A}},b["signed_curve25519:".concat(S)]=w}l.v.log("Preparing fallback keys");var T={};for(var[I,k]of Object.entries(m.curve25519)){var O={key:k,fallback:!0},R=r.sign(o.stringify(O));O.signatures={[e.crypto.userId]:{["ed25519:".concat(y)]:R}},T["signed_curve25519:".concat(I)]=O}return l.v.log("Uploading keys to server"),yield e.crypto.baseApis.http.authedRequest(c.IT.Post,"/keys/upload/"+encodeURI(y),void 0,{device_keys:_,one_time_keys:b,"org.matrix.msc2732.fallback_keys":T}),l.v.log("Done dehydrating"),e.timeoutId=globalThis.setTimeout(e.dehydrateDevice.bind(e),p),y}finally{e.inProgress=!1}}}))()}stop(){this.timeoutId&&(globalThis.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}},446:(e,t,n)=>{"use strict";n.d(t,{V:()=>o});var r=n(4980),i=n(7131);class o{static fromStorage(e,t){var n=new o(t);for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}constructor(e){this.deviceId=e,(0,r.A)(this,"algorithms",[]),(0,r.A)(this,"keys",{}),(0,r.A)(this,"verified",i.u.Unverified),(0,r.A)(this,"known",!1),(0,r.A)(this,"unsigned",{}),(0,r.A)(this,"signatures",{})}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==i.u.Blocked}isVerified(){return this.verified==i.u.Verified}isUnverified(){return this.verified==i.u.Unverified}isKnown(){return!0===this.known}}(0,r.A)(o,"DeviceVerification",{VERIFIED:i.u.Verified,UNVERIFIED:i.u.Unverified,BLOCKED:i.u.Blocked})},7780:(e,t,n)=>{"use strict";n.d(t,{Qr:()=>Bt,cr:()=>Ft,D$:()=>Gt,DM:()=>Ut});var r=n(467),i=n(4980),o=n(4069),a=n(7045),s=n(2986),l=n(4831),c=n(3840),d=n(5530),u=n(8417),h=n(6215);class p extends Error{constructor(){super(...arguments),(0,i.A)(this,"data",{errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"})}}function v(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152)throw new p("Message too long (".concat(e.length," bytes). ")+"The maximum for an encrypted message is ".concat(49152," bytes."))}class m{constructor(e){this.cryptoStore=e,(0,i.A)(this,"pickleKey","DEFAULT_KEY"),(0,i.A)(this,"deviceCurve25519Key",null),(0,i.A)(this,"deviceEd25519Key",null),(0,i.A)(this,"maxOneTimeKeys",null),(0,i.A)(this,"outboundGroupSessionStore",{}),(0,i.A)(this,"inboundGroupSessionMessageIndexes",{}),(0,i.A)(this,"sessionsInProgress",{}),(0,i.A)(this,"olmPrekeyPromise",Promise.resolve())}static getOlmVersion(){return globalThis.Olm.get_library_version()}init(){var e=arguments,t=this;return(0,r.A)((function*(){var n,{pickleKey:r,fromExportedDevice:i}=e.length>0&&void 0!==e[0]?e[0]:{},o=new globalThis.Olm.Account;try{i?(r&&c.v.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),t.pickleKey=i.pickleKey,yield t.initialiseFromExportedDevice(i,o)):(r&&(t.pickleKey=r),yield t.initialiseAccount(o)),n=JSON.parse(o.identity_keys()),t.maxOneTimeKeys=o.max_number_of_one_time_keys()}finally{o.free()}t.deviceCurve25519Key=n.curve25519,t.deviceEd25519Key=n.ed25519}))()}initialiseFromExportedDevice(e,t){var n=this;return(0,r.A)((function*(){yield n.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT,d.y.STORE_SESSIONS],(t=>{n.cryptoStore.storeAccount(t,e.pickledAccount),e.sessions.forEach((e=>{var{deviceKey:r,sessionId:i}=e,o={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};n.cryptoStore.storeEndToEndSession(r,i,o,t)}))})),t.unpickle(n.pickleKey,e.pickledAccount)}))()}initialiseAccount(e){var t=this;return(0,r.A)((function*(){yield t.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(n=>{t.cryptoStore.getAccount(n,(r=>{null!==r?e.unpickle(t.pickleKey,r):(e.create(),r=e.pickle(t.pickleKey),t.cryptoStore.storeAccount(n,r))}))}))}))()}getAccount(e,t){this.cryptoStore.getAccount(e,(e=>{var n=new globalThis.Olm.Account;try{n.unpickle(this.pickleKey,e),t(n)}finally{n.free()}}))}storeAccount(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}export(){var e=this;return(0,r.A)((function*(){var t={pickleKey:e.pickleKey};return yield e.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT,d.y.STORE_SESSIONS],(n=>{e.cryptoStore.getAccount(n,(e=>{t.pickledAccount=e})),t.sessions=[],e.cryptoStore.getAllEndToEndSessions(n,(e=>{t.sessions.push(e)}))})),t}))()}getSession(e,t,n,r){this.cryptoStore.getEndToEndSession(e,t,n,(e=>{this.unpickleSession(e,r)}))}unpickleSession(e,t){var n=new globalThis.Olm.Session;try{n.unpickle(this.pickleKey,e.session),t(Object.assign({},e,{session:n}))}finally{n.free()}}saveSession(e,t,n){var r=t.session.session_id();c.v.debug("Saving Olm session ".concat(r," with device ").concat(e,": ").concat(t.session.describe()));var i=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,r,i,n)}getUtility(e){var t=new globalThis.Olm.Utility;try{return e(t)}finally{t.free()}}sign(e){var t=this;return(0,r.A)((function*(){var n;return yield t.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT],(r=>{t.getAccount(r,(t=>{n=t.sign(e)}))})),n}))()}getOneTimeKeys(){var e=this;return(0,r.A)((function*(){var t;return yield e.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT],(n=>{e.getAccount(n,(e=>{t=JSON.parse(e.one_time_keys())}))})),t}))()}maxNumberOfOneTimeKeys(){var e;return null!==(e=this.maxOneTimeKeys)&&void 0!==e?e:-1}markKeysAsPublished(){var e=this;return(0,r.A)((function*(){yield e.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(t=>{e.getAccount(t,(n=>{n.mark_keys_as_published(),e.storeAccount(t,n)}))}))}))()}generateOneTimeKeys(e){return this.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(t=>{this.getAccount(t,(n=>{n.generate_one_time_keys(e),this.storeAccount(t,n)}))}))}generateFallbackKey(){var e=this;return(0,r.A)((function*(){yield e.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(t=>{e.getAccount(t,(n=>{n.generate_fallback_key(),e.storeAccount(t,n)}))}))}))()}getFallbackKey(){var e=this;return(0,r.A)((function*(){var t;return yield e.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT],(n=>{e.getAccount(n,(e=>{t=JSON.parse(e.unpublished_fallback_key())}))})),t}))()}forgetOldFallbackKey(){var e=this;return(0,r.A)((function*(){yield e.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(t=>{e.getAccount(t,(n=>{n.forget_old_fallback_key(),e.storeAccount(t,n)}))}))}))()}createOutboundSession(e,t){var n=this;return(0,r.A)((function*(){var r;return yield n.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT,d.y.STORE_SESSIONS],(i=>{n.getAccount(i,(o=>{var a=new globalThis.Olm.Session;try{a.create_outbound(o,e,t),r=a.session_id(),n.storeAccount(i,o);var s={session:a,lastReceivedMessageTs:Date.now()};n.saveSession(e,s,i)}finally{a.free()}}))}),c.v.getChild("[createOutboundSession]")),r}))()}createInboundSession(e,t,n){var i=this;return(0,r.A)((function*(){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");var r;return yield i.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT,d.y.STORE_SESSIONS],(o=>{i.getAccount(o,(a=>{var s=new globalThis.Olm.Session;try{s.create_inbound_from(a,e,n),a.remove_one_time_keys(s),i.storeAccount(o,a);var l=s.decrypt(t,n),c={session:s,lastReceivedMessageTs:Date.now()};i.saveSession(e,c,o),r={payload:l,session_id:s.session_id()}}finally{s.free()}}))}),c.v.getChild("[createInboundSession]")),r}))()}getSessionIdsForDevice(e){var t=this;return(0,r.A)((function*(){var n,r=c.v.getChild("[getSessionIdsForDevice]");if(e in t.sessionsInProgress){r.debug("Waiting for Olm session for ".concat(e," to be created"));try{yield t.sessionsInProgress[e]}catch(e){}}return yield t.cryptoStore.doTxn("readonly",[d.y.STORE_SESSIONS],(r=>{t.cryptoStore.getEndToEndSessions(e,r,(e=>{n=Object.keys(e)}))}),r),n}))()}getSessionIdForDevice(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2?t[2]:void 0,o=yield n.getSessionInfoForDevice(e,r,i);if(0===o.length)return null;for(var a=0,s=1;s<o.length;s++){var l=o[s],c=void 0===l.lastReceivedMessageTs?0:l.lastReceivedMessageTs,d=o[a],u=void 0===d.lastReceivedMessageTs?0:d.lastReceivedMessageTs;(c>u||c===u&&l.sessionId<d.sessionId)&&(a=s)}return o[a].sessionId}))()}getSessionInfoForDevice(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2&&void 0!==t[2]?t[2]:c.v;if(i=i.getChild("[getSessionInfoForDevice]"),e in n.sessionsInProgress&&!r){i.debug("Waiting for Olm session for ".concat(e," to be created"));try{yield n.sessionsInProgress[e]}catch(e){}}var o=[];return yield n.cryptoStore.doTxn("readonly",[d.y.STORE_SESSIONS],(t=>{n.cryptoStore.getEndToEndSessions(e,t,(e=>{var t=Object.keys(e).sort(),r=function(t){n.unpickleSession(e[t],(e=>{o.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:t})}))};for(var i of t)r(i)}))}),i),o}))()}encryptMessage(e,t,n){var i=this;return(0,r.A)((function*(){var r;return v(n),yield i.cryptoStore.doTxn("readwrite",[d.y.STORE_SESSIONS],(o=>{i.getSession(e,t,o,(a=>{var s=a.session.describe();c.v.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+s),r=a.session.encrypt(n),i.saveSession(e,a,o)}))}),c.v.getChild("[encryptMessage]")),r}))()}decryptMessage(e,t,n,i){var o=this;return(0,r.A)((function*(){var r;return yield o.cryptoStore.doTxn("readwrite",[d.y.STORE_SESSIONS],(a=>{o.getSession(e,t,a,(s=>{var l=s.session.describe();c.v.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+l),r=s.session.decrypt(n,i),s.lastReceivedMessageTs=Date.now(),o.saveSession(e,s,a)}))}),c.v.getChild("[decryptMessage]")),r}))()}matchesSession(e,t,n,i){var o=this;return(0,r.A)((function*(){return 0===n&&(yield o.cryptoStore.doTxn("readonly",[d.y.STORE_SESSIONS],(n=>{o.getSession(e,t,n,(e=>{r=e.session.matches_inbound(i)}))}),c.v.getChild("[matchesSession]")),r);var r}))()}recordSessionProblem(e,t,n){var i=this;return(0,r.A)((function*(){c.v.info("Recording problem on olm session with ".concat(e," of type ").concat(t,". Recreating: ").concat(n)),yield i.cryptoStore.storeEndToEndSessionProblem(e,t,n)}))()}sessionMayHaveProblems(e,t){return this.cryptoStore.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.cryptoStore.filterOutNotifiedErrorDevices(e)}saveOutboundGroupSession(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}getOutboundGroupSession(e,t){var n=this.outboundGroupSessionStore[e];if(void 0===n)throw new Error("Unknown outbound group session "+e);var r=new globalThis.Olm.OutboundGroupSession;try{return r.unpickle(this.pickleKey,n),t(r)}finally{r.free()}}createOutboundGroupSession(){var e=new globalThis.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}encryptGroupMessage(e,t){return c.v.log("encrypting msg with megolm session ".concat(e)),v(t),this.getOutboundGroupSession(e,(e=>{var n=e.encrypt(t);return this.saveOutboundGroupSession(e),n}))}getOutboundGroupSessionKey(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}unpickleInboundGroupSession(e,t){var n=new globalThis.Olm.InboundGroupSession;try{return n.unpickle(this.pickleKey,e.session),t(n)}finally{n.free()}}getInboundGroupSession(e,t,n,r,i){this.cryptoStore.getEndToEndInboundGroupSession(t,n,r,((t,n)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this.unpickleInboundGroupSession(t,(e=>{i(e,t,n)}))}else i(null,null,n)}))}addInboundGroupSession(e,t,n,i,o,a,s){var l=arguments,u=this;return(0,r.A)((function*(){var r=l.length>7&&void 0!==l[7]?l[7]:{};yield u.cryptoStore.doTxn("readwrite",[d.y.STORE_INBOUND_GROUP_SESSIONS,d.y.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,d.y.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(l=>{u.getInboundGroupSession(e,t,i,l,((d,h)=>{var p=new globalThis.Olm.InboundGroupSession;try{if(s?p.import_session(o):p.create(o),i!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(d&&(c.v.log("Update for megolm session ".concat(t,"|").concat(i)),d.first_known_index()<=p.first_known_index())){if(!h.untrusted||r.untrusted)return void c.v.log("Keeping existing megolm session ".concat(t,"|").concat(i));if(d.first_known_index()<p.first_known_index())return void(d.export_session(p.first_known_index())===p.export_session(p.first_known_index())?(c.v.info("Upgrading trust of existing megolm session "+"".concat(t,"|").concat(i," based on newly-received trusted session")),h.untrusted=!1,u.cryptoStore.storeEndToEndInboundGroupSession(t,i,h,l)):c.v.warn("Newly-received megolm session ".concat(t,"|$sessionId}")+" does not match existing session! Keeping existing session"))}c.v.debug("Storing megolm session ".concat(t,"|").concat(i," with first index ")+p.first_known_index());var v=Object.assign({},r,{room_id:e,session:p.pickle(u.pickleKey),keysClaimed:a,forwardingCurve25519KeyChain:n});u.cryptoStore.storeEndToEndInboundGroupSession(t,i,v,l),!d&&r.sharedHistory&&u.cryptoStore.addSharedHistoryInboundGroupSession(e,t,i,l)}finally{p.free()}}))}),c.v.getChild("[addInboundGroupSession]"))}))()}addInboundGroupSessionWithheld(e,t,n,i,o){var a=this;return(0,r.A)((function*(){yield a.cryptoStore.doTxn("readwrite",[d.y.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(r=>{a.cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,n,{room_id:e,code:i,reason:o},r)}))}))()}decryptGroupMessage(e,t,n,i,o,a){var s=this;return(0,r.A)((function*(){var r,l=null;if(yield s.cryptoStore.doTxn("readwrite",[d.y.STORE_INBOUND_GROUP_SESSIONS,d.y.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(c=>{s.getInboundGroupSession(e,t,n,c,((e,d,p)=>{if(null!==e&&null!==d){var v;try{v=e.decrypt(i)}catch(e){if("OLM.UNKNOWN_MESSAGE_INDEX"===(null==e?void 0:e.message)&&p){var m="m.unverified"===p.code?u.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:u.DecryptionFailureCode.MEGOLM_KEY_WITHHELD;r=new h.O(m,f(p),{session:t+"|"+n})}else r=e;return}var g=v.plaintext;if(void 0===g)g=v;else{var y=t+"|"+n+"|"+v.message_index;if(y in s.inboundGroupSessionMessageIndexes){var _=s.inboundGroupSessionMessageIndexes[y];if(_.id!==o||_.timestamp!==a)return void(r=new Error("Duplicate message index, possible replay attack: "+y))}s.inboundGroupSessionMessageIndexes[y]={id:o,timestamp:a}}d.session=e.pickle(s.pickleKey),s.cryptoStore.storeEndToEndInboundGroupSession(t,n,d,c),l={result:g,keysClaimed:d.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:d.forwardingCurve25519KeyChain||[],untrusted:!!d.untrusted}}else{if(p){var E="m.unverified"===p.code?u.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:u.DecryptionFailureCode.MEGOLM_KEY_WITHHELD;r=new h.O(E,f(p),{session:t+"|"+n})}l=null}}))}),c.v.getChild("[decryptGroupMessage]")),r)throw r;return l}))()}hasInboundSessionKeys(e,t,n){var i=this;return(0,r.A)((function*(){var r;return yield i.cryptoStore.doTxn("readonly",[d.y.STORE_INBOUND_GROUP_SESSIONS,d.y.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(o=>{i.cryptoStore.getEndToEndInboundGroupSession(t,n,o,(i=>{null!==i?e!==i.room_id?(c.v.warn("requested keys for inbound group session ".concat(t,"|")+"".concat(n,", with incorrect room_id ")+"(expected ".concat(i.room_id,", ")+"was ".concat(e,")")),r=!1):r=!0:r=!1}))}),c.v.getChild("[hasInboundSessionKeys]")),r}))()}getInboundGroupSessionKey(e,t,n,i){var o=this;return(0,r.A)((function*(){var r=null;return yield o.cryptoStore.doTxn("readonly",[d.y.STORE_INBOUND_GROUP_SESSIONS,d.y.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(a=>{o.getInboundGroupSession(e,t,n,a,((e,t)=>{if(null!==e&&null!==t){void 0===i&&(i=e.first_known_index());var n=e.export_session(i),o=(t.keysClaimed||{}).ed25519||null,a=t.forwardingCurve25519KeyChain||[],s="untrusted"in t?t.untrusted:a.length>0;r={chain_index:i,key:n,forwarding_curve25519_key_chain:a,sender_claimed_ed25519_key:o,shared_history:t.sharedHistory||!1,untrusted:s}}else r=null}))}),c.v.getChild("[getInboundGroupSessionKey]")),r}))()}exportInboundGroupSession(e,t,n){return this.unpickleInboundGroupSession(n,(r=>{var i=r.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:r.export_session(i),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:r.first_known_index(),"org.matrix.msc3061.shared_history":n.sharedHistory||!1}}))}getSharedHistoryInboundGroupSessions(e){var t=this;return(0,r.A)((function*(){var n;return yield t.cryptoStore.doTxn("readonly",[d.y.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(r=>{n=t.cryptoStore.getSharedHistoryInboundGroupSessions(e,r)}),c.v.getChild("[getSharedHistoryInboundGroupSessionsForRoom]")),n}))()}verifySignature(e,t,n){this.getUtility((function(r){r.ed25519_verify(e,t,n)}))}}var g={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function f(e){return e.code&&e.code in g?g[e.code]:e.reason?e.reason:"decryption key withheld"}var y=n(8197),_=n(446),E=n(7723),b=n(1630),S=n(5542);function C(e){return Object.values(e.keys)[0]}class w{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.userId=e,this.callbacks=t,this.cacheCallbacks=n,(0,i.A)(this,"keys",{}),(0,i.A)(this,"firstUse",!0),(0,i.A)(this,"crossSigningVerifiedBefore",!1)}static fromStorage(e,t){var n=new w(t);for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}getCrossSigningKey(e,t){var n=this;return(0,r.A)((function*(){var r=["master","self_signing","user_signing"].indexOf(e)>=0;if(!n.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function i(e){if(e){var n=new globalThis.Olm.PkSigning,r=n.init_with_seed(e);if(r===t)return[r,n];n.free()}}void 0===t&&(t=n.getId(e));var o=null;n.cacheCallbacks.getCrossSigningKeyCache&&r&&(o=yield n.cacheCallbacks.getCrossSigningKeyCache(e,t));var a=i(o);if(a)return a;var s=i(o=yield n.callbacks.getCrossSigningKey(e,t));if(s)return n.cacheCallbacks.storeCrossSigningKeyCache&&r&&(yield n.cacheCallbacks.storeCrossSigningKeyCache(e,o)),s;if(!o)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}))()}isStoredInSecretStorage(e){return(0,r.A)((function*(){var t=(yield e.isStored("m.cross_signing.master"))||{};function n(e){for(var n of Object.keys(t))e[n]||delete t[n]}for(var r of["self_signing","user_signing"])n((yield e.isStored("m.cross_signing.".concat(r)))||{});return Object.keys(t).length?t:null}))()}static storeInSecretStorage(e,t){return(0,r.A)((function*(){for(var[n,r]of e){var i=(0,E.WG)(r);yield t.store("m.cross_signing.".concat(n),i)}}))()}static getFromSecretStorage(e,t){return(0,r.A)((function*(){var n=yield t.get("m.cross_signing.".concat(e));return n?(0,E.y4)(n):null}))()}isStoredInKeyCache(e){var t=this;return(0,r.A)((function*(){var n=t.cacheCallbacks;if(!n)return!1;var r=e?[e]:["master","self_signing","user_signing"];for(var i of r){var o;if(!(yield null===(o=n.getCrossSigningKeyCache)||void 0===o?void 0:o.call(n,i)))return!1}return!0}))()}getCrossSigningKeysFromCache(){var e=this;return(0,r.A)((function*(){var t=new Map,n=e.cacheCallbacks;if(!n)return t;for(var r of["master","self_signing","user_signing"]){var i,o=yield null===(i=n.getCrossSigningKeyCache)||void 0===i?void 0:i.call(n,r);o&&t.set(r,o)}return t}))()}getId(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"master";return this.keys[e]?C(this.keys[e]):null}resetKeys(e){var t=this;return(0,r.A)((function*(){if(!t.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&A.MASTER||!t.keys.master)e=A.MASTER|A.USER_SIGNING|A.SELF_SIGNING;else if(0===e)return;var n,r,i={},o={};try{if(e&A.MASTER?(n=new globalThis.Olm.PkSigning,i.master=n.generate_seed(),r=n.init_with_seed(i.master),o.master={user_id:t.userId,usage:["master"],keys:{["ed25519:"+r]:r}}):[r,n]=yield t.getCrossSigningKey("master"),e&A.SELF_SIGNING){var a=new globalThis.Olm.PkSigning;try{i.self_signing=a.generate_seed();var s=a.init_with_seed(i.self_signing);o.self_signing={user_id:t.userId,usage:["self_signing"],keys:{["ed25519:"+s]:s}},(0,y.pkSign)(o.self_signing,n,t.userId,r)}finally{a.free()}}if(e&A.USER_SIGNING){var l=new globalThis.Olm.PkSigning;try{i.user_signing=l.generate_seed();var c=l.init_with_seed(i.user_signing);o.user_signing={user_id:t.userId,usage:["user_signing"],keys:{["ed25519:"+c]:c}},(0,y.pkSign)(o.user_signing,n,t.userId,r)}finally{l.free()}}Object.assign(t.keys,o),t.callbacks.saveCrossSigningKeys(i)}finally{n&&n.free()}}))()}clearKeys(){this.keys={}}setKeys(e){var t={};if(e.master){if(e.master.user_id!==this.userId){var n="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw c.v.error(n),new Error(n)}this.keys.master?C(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}var r=C(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){var i="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw c.v.error(i),new Error(i)}try{(0,y.pkVerify)(e.user_signing,r,this.userId)}catch(e){throw c.v.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){var o="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw c.v.error(o),new Error(o)}try{(0,y.pkVerify)(e.self_signing,r,this.userId)}catch(e){throw c.v.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,delete this.keys.self_signing,delete this.keys.user_signing),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}signObject(e,t){var n=this;return(0,r.A)((function*(){if(!n.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");var[r,i]=yield n.getCrossSigningKey(t);try{return(0,y.pkSign)(e,i,n.userId,r),e}finally{i.free()}}))()}signUser(e){var t=this;return(0,r.A)((function*(){if(t.keys.user_signing)return t.signObject(e.keys.master,"user_signing");c.v.info("No user signing key: not signing user")}))()}signDevice(e,t){var n=this;return(0,r.A)((function*(){if(e!==n.userId)throw new Error("Trying to sign ".concat(e,"'s device; can only sign our own device"));if(n.keys.self_signing)return n.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");c.v.info("No self signing key: not signing device")}))()}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new u.UserVerificationStatus(!0,!0,this.firstUse);if(!this.keys.user_signing)return new u.UserVerificationStatus(!1,!1,e.firstUse);var t,n=e.keys.master,r=this.getId("user_signing");try{(0,y.pkVerify)(n,r,this.userId),t=!0}catch(e){t=!1}return new u.UserVerificationStatus(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,n,r){var i=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new T(!1,!1,n,r);var a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,y.pkVerify)(o,e.getId(),e.userId),(0,y.pkVerify)(a,C(o),e.userId),T.fromUserTrustLevel(i,n,r)}catch(e){return new T(!1,!1,n,r)}}getCacheCallbacks(){return this.cacheCallbacks}}var A=function(e){return e[e.MASTER=4]="MASTER",e[e.USER_SIGNING=2]="USER_SIGNING",e[e.SELF_SIGNING=1]="SELF_SIGNING",e}({});class T extends u.DeviceVerificationStatus{constructor(e,t,n,r){super({crossSigningVerified:e,tofu:t,localVerified:n,trustCrossSignedDevices:r,signedByOwner:arguments.length>4&&void 0!==arguments[4]&&arguments[4]})}static fromUserTrustLevel(e,t,n){return new T(e.isCrossSigningVerified(),e.isTofu(),t,n,!0)}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}function I(e,t){return{getCrossSigningKeyCache:(i=(0,r.A)((function*(n,r){var i=yield new Promise((t=>{e.doTxn("readonly",[d.y.STORE_ACCOUNT],(r=>{e.getSecretStorePrivateKey(r,t,n)}))}));if(i&&i.ciphertext){var o=Buffer.from(t.pickleKey),a=yield(0,S.A)(i,o,n);return(0,E.y4)(a)}return i})),function(e,t){return i.apply(this,arguments)}),storeCrossSigningKeyCache:(n=(0,r.A)((function*(n,r){if(!(r instanceof Uint8Array))throw new Error("storeCrossSigningKeyCache expects Uint8Array, got ".concat(r));var i=Buffer.from(t.pickleKey),o=yield(0,b.A)((0,E.WG)(r),i,n);return e.doTxn("readwrite",[d.y.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,n,o)}))})),function(e,t){return n.apply(this,arguments)})};var n,i}function k(){return k=(0,r.A)((function*(e,t,n){if(e.getUserId()===t)return c.v.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,i)=>{var o,a=e,s=a.crypto.crossSigningInfo,l=new w(s.userId,{getCrossSigningKey:(o=(0,r.A)((function*(e){c.v.debug("Cross-signing: requesting secret",e,n);var{promise:t}=a.requestSecret("m.cross_signing.".concat(e),[n]),r=yield t,i=(0,E.y4)(r);return Uint8Array.from(i)})),function(e){return o.apply(this,arguments)})},s.getCacheCallbacks());l.keys=s.keys;var d=new Promise((e=>{setTimeout(e,6e4,new Error("Timeout"))})),u=(0,r.A)((function*(){if(!(yield a.crypto.getSessionBackupPrivateKey())){c.v.info("No cached backup key found. Requesting...");var e=a.requestSecret("m.megolm_backup.v1",[n]),t=yield e.promise;c.v.info("Got key backup key, decoding...");var r=(0,E.y4)(t);c.v.info("Decoded backup key, storing..."),yield a.crypto.storeSessionBackupPrivateKey(Uint8Array.from(r)),c.v.info("Backup key stored. Starting backup restore...");var i=yield a.getKeyBackupVersion();a.restoreKeyBackupWithCache(void 0,void 0,i).then((()=>{c.v.info("Backup restored.")}))}}))();Promise.race([Promise.all([l.getCrossSigningKey("master"),l.getCrossSigningKey("self_signing"),l.getCrossSigningKey("user_signing"),u]),d]).then(t,i)})).catch((e=>{c.v.warn("Cross-signing: failure while requesting keys:",e)}))})),k.apply(this,arguments)}var O=n(3883),R=n(6387),x=function(e){return e[e.NotTracked=0]="NotTracked",e[e.PendingDownload=1]="PendingDownload",e[e.DownloadInProgress=2]="DownloadInProgress",e[e.UpToDate=3]="UpToDate",e}({});class N extends R.X{constructor(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:250;super(),this.cryptoStore=t,this.keyDownloadChunkSize=r,(0,i.A)(this,"devices",{}),(0,i.A)(this,"crossSigningInfo",{}),(0,i.A)(this,"userByIdentityKey",{}),(0,i.A)(this,"deviceTrackingStatus",{}),(0,i.A)(this,"syncToken",null),(0,i.A)(this,"keyDownloadsInProgressByUser",new Map),(0,i.A)(this,"dirty",!1),(0,i.A)(this,"savePromise",null),(0,i.A)(this,"resolveSavePromise",null),(0,i.A)(this,"savePromiseTime",null),(0,i.A)(this,"saveTimer",null),(0,i.A)(this,"hasFetched",null),(0,i.A)(this,"serialiser",void 0),this.serialiser=new D(e,n,this)}load(){var e=this;return(0,r.A)((function*(){for(var t of(yield e.cryptoStore.doTxn("readonly",[d.y.STORE_DEVICE_DATA],(t=>{e.cryptoStore.getEndToEndDeviceData(t,(t=>{var n;for(var r of(e.hasFetched=Boolean(null==t?void 0:t.devices),e.devices=t?t.devices:{},e.crossSigningInfo=t&&t.crossSigningInfo||{},e.deviceTrackingStatus=t?t.trackingStatus:{},e.syncToken=null!==(n=null==t?void 0:t.syncToken)&&void 0!==n?n:null,e.userByIdentityKey={},Object.keys(e.devices))){var i=e.devices[r];for(var o of Object.keys(i)){var a=i[o].keys["curve25519:"+o];void 0!==a&&(e.userByIdentityKey[a]=r)}}}))})),Object.keys(e.deviceTrackingStatus)))e.deviceTrackingStatus[t]==x.DownloadInProgress&&(e.deviceTrackingStatus[t]=x.PendingDownload)}))()}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}saveIfDirty(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:500;if(!t.dirty)return Promise.resolve(!1);var r=Date.now()+n;t.savePromiseTime&&r<t.savePromiseTime&&(clearTimeout(t.saveTimer),t.saveTimer=null,t.savePromiseTime=null);var i=t.savePromise;if(null===i&&(i=new Promise((e=>{t.resolveSavePromise=e})),t.savePromise=i),null===t.saveTimer){var o=t.resolveSavePromise;t.savePromiseTime=r,t.saveTimer=setTimeout((()=>{c.v.log("Saving device tracking data",t.syncToken),t.savePromiseTime=null,t.saveTimer=null,t.savePromise=null,t.resolveSavePromise=null,t.cryptoStore.doTxn("readwrite",[d.y.STORE_DEVICE_DATA],(e=>{var n;t.cryptoStore.storeEndToEndDeviceData({devices:t.devices,crossSigningInfo:t.crossSigningInfo,trackingStatus:t.deviceTrackingStatus,syncToken:null!==(n=t.syncToken)&&void 0!==n?n:void 0},e)})).then((()=>{t.dirty=!1,null==o||o(!0)}),(e=>{c.v.error("Failed to save device tracking data",t.syncToken),c.v.error(e)}))}),n)}return i}))()}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,t){var n=[],r=[];if(e.forEach((e=>{var i=this.deviceTrackingStatus[e];this.keyDownloadsInProgressByUser.has(e)?(c.v.log("downloadKeys: already have a download in progress for "+"".concat(e,": awaiting its result")),r.push(this.keyDownloadsInProgressByUser.get(e))):(t||i!=x.UpToDate)&&n.push(e)})),0!=n.length){c.v.log("downloadKeys: downloading for",n);var i=this.doKeyDownload(n);r.push(i)}return 0===r.length&&c.v.log("downloadKeys: already have all necessary keys"),Promise.all(r).then((()=>this.getDevicesFromStore(e)))}getDevicesFromStore(e){var t=new Map;return e.forEach((e=>{var n,r=new Map;null===(n=this.getStoredDevicesForUser(e))||void 0===n||n.forEach((function(e){r.set(e.deviceId,e)})),t.set(e,r)})),t}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){var t=this.devices[e];if(!t)return null;var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(_.V.fromStorage(t[r],r));return n}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?w.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}getStoredDevice(e,t){var n=this.devices[e];if(null!=n&&n[t])return _.V.fromStorage(n[t],t)}getUserByIdentityKey(e,t){return e!==y.OLM_ALGORITHM&&e!==y.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}getDeviceByIdentityKey(e,t){var n=this.getUserByIdentityKey(e,t);if(!n)return null;var r=this.devices[n];if(!r)return null;for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];for(var a in o.keys)if(o.keys.hasOwnProperty(a)&&0===a.indexOf("curve25519:")&&o.keys[a]==t)return _.V.fromStorage(o,i)}return null}storeDevicesForUser(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(c.v.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=x.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(c.v.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=x.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(var e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=x.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(c.v.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=x.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();var e=[];for(var t of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[t]==x.PendingDownload&&e.push(t);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,t){if(void 0!==this.devices[e])for(var[n,r]of Object.entries(this.devices[e])){var i=r.keys["curve25519:"+n];delete this.userByIdentityKey[i]}for(var[o,a]of(this.devices[e]=t,Object.entries(t))){var s=a.keys["curve25519:"+o];this.userByIdentityKey[s]=e}}setRawStoredCrossSigningForUser(e,t){this.crossSigningInfo[e]=t}doKeyDownload(e){if(0===e.length)return Promise.resolve();var t=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((()=>{n(!0)}),(t=>{throw c.v.error("Error downloading keys for "+e+":",t),n(!1),t}));e.forEach((e=>{this.keyDownloadsInProgressByUser.set(e,t),this.deviceTrackingStatus[e]==x.PendingDownload&&(this.deviceTrackingStatus[e]=x.DownloadInProgress)}));var n=n=>{this.emit(Ft.WillUpdateDevices,e,!this.hasFetched),e.forEach((e=>{this.dirty=!0,this.keyDownloadsInProgressByUser.get(e)===t?(this.keyDownloadsInProgressByUser.delete(e),this.deviceTrackingStatus[e]==x.DownloadInProgress&&(n?(this.deviceTrackingStatus[e]=x.UpToDate,c.v.log("Device list for",e,"now up to date")):this.deviceTrackingStatus[e]=x.PendingDownload)):c.v.log("Another update in the queue for",e,"- not marking up-to-date")})),this.saveIfDirty(),this.emit(Ft.DevicesUpdated,e,!this.hasFetched),this.hasFetched=!0};return t}}class D{constructor(e,t,n){this.baseApis=e,this.olmDevice=t,this.deviceList=n,(0,i.A)(this,"downloadInProgress",!1),(0,i.A)(this,"keyDownloadsQueuedByUser",{}),(0,i.A)(this,"queuedQueryDeferred",void 0),(0,i.A)(this,"syncToken",void 0)}updateDevicesForUsers(e,t){return e.forEach((e=>{this.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,O.v6)()),this.syncToken=t,this.downloadInProgress?(c.v.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){var e=this;if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");var t=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};var n=this.queuedQueryDeferred;this.queuedQueryDeferred=void 0,c.v.log("Starting key download for",t),this.downloadInProgress=!0;var i={};this.syncToken&&(i.token=this.syncToken);for(var o=[],a=function(){var n=t.slice(s,s+e.deviceList.keyDownloadChunkSize);o.push((()=>e.baseApis.downloadKeysForUsers(n,i)))},s=0;s<t.length;s+=this.deviceList.keyDownloadChunkSize)a();return(0,O.iK)(o,3).then(function(){var n=(0,r.A)((function*(n){var r=Object.assign({},...n.map((e=>e.device_keys||{}))),i=Object.assign({},...n.map((e=>e.master_keys||{}))),o=Object.assign({},...n.map((e=>e.self_signing_keys||{}))),a=Object.assign({},...n.map((e=>e.user_signing_keys||{})));for(var s of t){yield(0,O.yy)(5);try{yield e.processQueryResponseForUser(s,r[s],{master:null==i?void 0:i[s],self_signing:null==o?void 0:o[s],user_signing:null==a?void 0:a[s]})}catch(e){c.v.error("Error processing keys for ".concat(s,":"),e)}}}));return function(e){return n.apply(this,arguments)}}()).then((()=>{c.v.log("Completed key download for "+t),this.downloadInProgress=!1,null==n||n.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()}),(e=>{c.v.warn("Error downloading keys for "+t+":",e),this.downloadInProgress=!1,null==n||n.reject(e)})),n.promise}processQueryResponseForUser(e,t,n){var i=this;return(0,r.A)((function*(){c.v.log("got device keys for "+e+":",t),c.v.log("got cross-signing keys for "+e+":",n);var r={},o=i.deviceList.getRawStoredDevicesForUser(e);o&&Object.keys(o).forEach((e=>{var t=_.V.fromStorage(o[e],e);r[e]=t})),yield function(e,t,n,r,i,o){return L.apply(this,arguments)}(i.olmDevice,e,r,t||{},i.baseApis.getUserId(),i.baseApis.deviceId);var a={};if(Object.keys(r).forEach((e=>{a[e]=r[e].toStorage()})),i.deviceList.setRawStoredDevicesForUser(e,a),n&&(n.master||n.self_signing||n.user_signing)){var s=i.deviceList.getStoredCrossSigningForUser(e)||new w(e);s.setKeys(n),i.deviceList.setRawStoredCrossSigningForUser(e,s.toStorage()),i.deviceList.emit(Ft.UserCrossSigningUpdated,e)}}))()}}function L(){return(L=(0,r.A)((function*(e,t,n,r,i,o){var a=!1;for(var s in n)if(n.hasOwnProperty(s)&&!(s in r)){if(t===i&&s===o){c.v.warn("Local device ".concat(s," missing from sync, skipping removal"));continue}c.v.log("Device "+t+":"+s+" has been removed"),delete n[s],a=!0}for(var l in r)if(r.hasOwnProperty(l)){var d=r[l];d.user_id===t?d.device_id===l?(yield P(e,n,d))&&(a=!0):c.v.warn("Mismatched device_id "+d.device_id+" in keys from "+t+":"+l):c.v.warn("Mismatched user_id "+d.user_id+" in keys from "+t+":"+l)}return a}))).apply(this,arguments)}function P(e,t,n){return M.apply(this,arguments)}function M(){return(M=(0,r.A)((function*(e,t,n){if(!n.keys)return!1;var r=n.device_id,i=n.user_id,o="ed25519:"+r,a=n.keys[o];if(!a)return c.v.warn("Device "+i+":"+r+" has no ed25519 key"),!1;var s,l=n.unsigned||{},d=n.signatures||{};try{yield y.verifySignature(e,n,i,r,a)}catch(e){return c.v.warn("Unable to verify signature on device "+i+":"+r+":"+e),!1}if(r in t){if((s=t[r]).getFingerprint()!=a)return c.v.warn("Ed25519 key for device "+i+":"+r+" has changed"),!1}else t[r]=s=new _.V(r);return s.keys=n.keys||{},s.algorithms=n.algorithms||[],s.unsigned=l,s.signatures=d,!0}))).apply(this,arguments)}var U=new Map,F=new Map;class B{constructor(e){(0,i.A)(this,"userId",void 0),(0,i.A)(this,"deviceId",void 0),(0,i.A)(this,"crypto",void 0),(0,i.A)(this,"olmDevice",void 0),(0,i.A)(this,"baseApis",void 0),this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis}prepareToEncrypt(e){}onRoomMembership(e,t,n){}}class G{constructor(e){(0,i.A)(this,"userId",void 0),(0,i.A)(this,"crypto",void 0),(0,i.A)(this,"olmDevice",void 0),(0,i.A)(this,"baseApis",void 0),this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis}onRoomKeyEvent(e){return(0,r.A)((function*(){}))()}importRoomKey(e,t){return(0,r.A)((function*(){}))()}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}retryDecryptionFromSender(e){return(0,r.A)((function*(){return!1}))()}}class $ extends Error{constructor(e,t,n){super(e),this.devices=t,this.event=n,this.name="UnknownDeviceError",this.devices=t}}function V(e,t,n){U.set(e,t),F.set(e,n)}var j=_.V.DeviceVerification;function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}V(y.OLM_ALGORITHM,class extends B{constructor(){super(...arguments),(0,i.A)(this,"sessionPrepared",!1),(0,i.A)(this,"prepPromise",null)}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((()=>this.crypto.ensureOlmSessionsForUsers(e))).then((()=>{this.sessionPrepared=!0})).finally((()=>{this.prepPromise=null})),this.prepPromise)}encryptMessage(e,t,n){var i=this;return(0,r.A)((function*(){var r=(yield e.getEncryptionTargetMembers()).map((function(e){return e.userId}));yield i.ensureSession(r);var o={room_id:e.roomId,type:t,content:n},a={algorithm:y.OLM_ALGORITHM,sender_key:i.olmDevice.deviceCurve25519Key,ciphertext:{}},s=[];for(var l of r){var c=i.crypto.getStoredDevicesForUser(l)||[];for(var d of c)d.getIdentityKey()!=i.olmDevice.deviceCurve25519Key&&d.verified!=j.BLOCKED&&s.push(y.encryptMessageForDevice(a.ciphertext,i.userId,i.deviceId,i.olmDevice,l,d,o))}return Promise.all(s).then((()=>a))}))()}},class extends G{decryptEvent(e){var t=this;return(0,r.A)((function*(){var n=e.getWireContent(),r=n.sender_key,i=n.ciphertext;if(!i)throw new h.O(u.DecryptionFailureCode.OLM_MISSING_CIPHERTEXT,"Missing ciphertext");if(!(t.olmDevice.deviceCurve25519Key in i))throw new h.O(u.DecryptionFailureCode.OLM_NOT_INCLUDED_IN_RECIPIENTS,"Not included in recipients");var o,a=i[t.olmDevice.deviceCurve25519Key];try{o=yield t.decryptMessage(r,a)}catch(e){throw new h.O(u.DecryptionFailureCode.OLM_BAD_ENCRYPTED_MESSAGE,"Bad Encrypted Message",{sender:r,err:e})}var s=JSON.parse(o);if(s.recipient!=t.userId)throw new h.O(u.DecryptionFailureCode.OLM_BAD_RECIPIENT,"Message was intended for "+s.recipient);if(s.recipient_keys.ed25519!=t.olmDevice.deviceEd25519Key)throw new h.O(u.DecryptionFailureCode.OLM_BAD_RECIPIENT_KEY,"Message not intended for this device",{intended:s.recipient_keys.ed25519,our_key:t.olmDevice.deviceEd25519Key});var l=t.crypto.deviceList.getUserByIdentityKey(y.OLM_ALGORITHM,r);if(null==l){try{yield t.crypto.deviceList.downloadKeys([e.getSender()],!1)}catch(e){throw new h.O(u.DecryptionFailureCode.OLM_BAD_SENDER_CHECK_FAILED,"Could not verify sender identity",{sender:r,err:e})}l=t.crypto.deviceList.getUserByIdentityKey(y.OLM_ALGORITHM,r)}if(l!==e.getSender()&&null!=l)throw new h.O(u.DecryptionFailureCode.OLM_BAD_SENDER,"Message claimed to be from "+e.getSender(),{real_sender:l});if(s.sender!=e.getSender())throw new h.O(u.DecryptionFailureCode.OLM_FORWARDED_MESSAGE,"Message forwarded from "+s.sender,{reported_sender:e.getSender()});if(s.room_id!==e.getRoomId())throw new h.O(u.DecryptionFailureCode.OLM_BAD_ROOM,"Message intended for room "+s.room_id,{reported_room:e.getRoomId()||"ROOM_ID_UNDEFINED"});return{clearEvent:s,senderCurve25519Key:r,claimedEd25519Key:(s.keys||{}).ed25519||null}}))()}decryptMessage(e,t){if(0!==t.type)return this.reallyDecryptMessage(e,t);var n=this.olmDevice.olmPrekeyPromise.then((()=>this.reallyDecryptMessage(e,t)));return this.olmDevice.olmPrekeyPromise=n.catch((()=>{})),n}reallyDecryptMessage(e,t){var n=this;return(0,r.A)((function*(){var r,i=yield n.olmDevice.getSessionIdsForDevice(e),o={};for(var a of i)try{var s=yield n.olmDevice.decryptMessage(e,a,t.type,t.body);return c.v.log("Decrypted Olm message from "+e+" with session "+a),s}catch(r){if(yield n.olmDevice.matchesSession(e,a,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+a+": "+r.message);o[a]=r.message}if(0!==t.type){if(0===i.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(o))}try{r=yield n.olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw o["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(o))}return c.v.log("created new inbound Olm session ID "+r.session_id+" with "+e),r.payload}))()}});var q=function(e){return e[e.Unsent=0]="Unsent",e[e.Sent=1]="Sent",e[e.CancellationPending=2]="CancellationPending",e[e.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend",e}({});class H{constructor(e,t,n){this.baseApis=e,this.deviceId=t,this.cryptoStore=n,(0,i.A)(this,"sendOutgoingRoomKeyRequestsTimer",void 0),(0,i.A)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,i.A)(this,"clientRunning",!0)}stop(){c.v.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}queueRoomKeyRequest(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var r=n.length>2&&void 0!==n[2]&&n[2],o=yield i.cryptoStore.getOutgoingRoomKeyRequest(e);if(o)switch(o.state){case q.CancellationPendingAndWillResend:case q.Unsent:return;case q.CancellationPending:var a=r?q.CancellationPendingAndWillResend:q.Sent;yield i.cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,q.CancellationPending,{state:a,cancellationTxnId:i.baseApis.makeTxnId()});break;case q.Sent:if(r){var s=q.CancellationPendingAndWillResend,l=yield i.cryptoStore.updateOutgoingRoomKeyRequest(o.requestId,q.Sent,{state:s,cancellationTxnId:i.baseApis.makeTxnId(),requestTxnId:i.baseApis.makeTxnId()});if(!l)return i.queueRoomKeyRequest(e,t,r);try{yield i.sendOutgoingRoomKeyRequestCancellation(l,!0)}catch(e){c.v.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+o.state)}else yield i.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:i.baseApis.makeTxnId(),state:q.Unsent})}))()}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case q.CancellationPending:case q.CancellationPendingAndWillResend:return;case q.Unsent:return c.v.log("deleting unnecessary room key request for "+Y(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,q.Unsent);case q.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,q.Sent,{state:q.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then((t=>{t?this.sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{c.v.error("Error sending room key request cancellation; will retry later.",e),this.startTimer()})):c.v.log("Tried to cancel room key request for "+Y(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[q.Sent])}cancelAndResendAllOutgoingRequests(){var e=this;return(0,r.A)((function*(){var t=yield e.cryptoStore.getAllOutgoingRoomKeyRequestsByState(q.Sent);return Promise.all(t.map((t=>{var{requestBody:n,recipients:r}=t;return e.queueRoomKeyRequest(n,r,!0)})))}))()}startTimer(){this.sendOutgoingRoomKeyRequestsTimer||(this.sendOutgoingRoomKeyRequestsTimer=setTimeout((()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally((()=>{this.sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{c.v.warn("error in OutgoingRoomKeyRequestManager: ".concat(e))}))}),500))}sendOutgoingRoomKeyRequests(){var e=this;return(0,r.A)((function*(){if(e.clientRunning){var t=yield e.cryptoStore.getOutgoingRoomKeyRequestByState([q.CancellationPending,q.CancellationPendingAndWillResend,q.Unsent]);if(t)try{switch(t.state){case q.Unsent:yield e.sendOutgoingRoomKeyRequest(t);break;case q.CancellationPending:yield e.sendOutgoingRoomKeyRequestCancellation(t);break;case q.CancellationPendingAndWillResend:yield e.sendOutgoingRoomKeyRequestCancellation(t,!0)}return e.sendOutgoingRoomKeyRequests()}catch(t){c.v.error("Error sending room key request; will retry later.",t),e.sendOutgoingRoomKeyRequestsTimer=void 0}else e.sendOutgoingRoomKeyRequestsTimer=void 0}else e.sendOutgoingRoomKeyRequestsTimer=void 0}))()}sendOutgoingRoomKeyRequest(e){c.v.log("Requesting keys for ".concat(Y(e.requestBody))+" from ".concat(z(e.recipients))+"(id ".concat(e.requestId,")"));var t={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,q.Unsent,{state:q.Sent})))}sendOutgoingRoomKeyRequestCancellation(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.v.log("Sending cancellation for key request for "+"".concat(Y(e.requestBody)," to ")+"".concat(z(e.recipients)," ")+"(cancellation id ".concat(e.cancellationTxnId,")"));var n={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(n,e.recipients,e.cancellationTxnId).then((()=>t?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,q.CancellationPendingAndWillResend,{state:q.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,q.CancellationPending)))}sendMessageToDevices(e,t,n){var r=new O.kG((()=>new Map));for(var i of t)r.getOrCreate(i.userId).set(i.deviceId,W(W({},e),{},{[s.wt]:(0,a.A)()}));return this.baseApis.sendToDevice(s.Bx.RoomKeyRequest,r,n)}}function Y(e){return e.room_id+" / "+e.session_id}function z(e){return"[".concat(e.map((e=>"".concat(e.userId,":").concat(e.deviceId))).join(","),"]")}var J=n(6560);function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z=e=>"string"==typeof e.ciphertext?!!e.ciphertext.length:!!Object.keys(e.ciphertext).length;class ee{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sessionId=e,this.sharedHistory=t,(0,i.A)(this,"useCount",0),(0,i.A)(this,"creationTime",void 0),(0,i.A)(this,"sharedWithDevices",new O.kG((()=>new Map))),(0,i.A)(this,"blockedDevicesNotified",new O.kG((()=>new Map))),this.creationTime=(new Date).getTime()}needsRotation(e,t){var n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(c.v.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)}markSharedWithDevice(e,t,n,r){this.sharedWithDevices.getOrCreate(e).set(t,{deviceKey:n,messageIndex:r})}markNotifiedBlockedDevice(e,t){this.blockedDevicesNotified.getOrCreate(e).set(t,!0)}sharedWithTooManyDevices(e){for(var[t,n]of this.sharedWithDevices){if(!e.has(t))return c.v.log("Starting new megolm session because we shared with "+t),!0;for(var[r]of n){var i;if(null===(i=e.get(t))||void 0===i||!i.get(r))return c.v.log("Starting new megolm session because we shared with "+t+":"+r),!0}}return!1}}var te={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};V(y.MEGOLM_ALGORITHM,class extends B{constructor(e){var t,n,r,o;super(e),(0,i.A)(this,"setupPromise",Promise.resolve(null)),(0,i.A)(this,"outboundSessions",{}),(0,i.A)(this,"sessionRotationPeriodMsgs",void 0),(0,i.A)(this,"sessionRotationPeriodMs",void 0),(0,i.A)(this,"encryptionPreparation",void 0),(0,i.A)(this,"roomId",void 0),(0,i.A)(this,"prefixedLogger",void 0),this.roomId=e.roomId,this.prefixedLogger=c.v.getChild("[".concat(this.roomId," encryption]")),this.sessionRotationPeriodMsgs=null!==(t=null===(n=e.config)||void 0===n?void 0:n.rotation_period_msgs)&&void 0!==t?t:100,this.sessionRotationPeriodMs=null!==(r=null===(o=e.config)||void 0===o?void 0:o.rotation_period_ms)&&void 0!==r?r:6048e5}ensureOutboundSession(e,t,n){var i=arguments,o=this;return(0,r.A)((function*(){var a=i.length>3&&void 0!==i[3]&&i[3],s=function(){var i=(0,r.A)((function*(r){var i=function(e){var t,n,r=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),i=null==r||null===(n=r.getContent())||void 0===n?void 0:n.history_visibility;return["world_readable","shared"].includes(i)}(e),s=yield o.prepareSession(t,i,r);return yield o.shareSession(t,i,a,n,s),s}));return function(e){return i.apply(this,arguments)}}(),l=o.setupPromise.then(s);return o.setupPromise=l.catch((e=>(o.prefixedLogger.error("Failed to setup outbound session",e),null))),l}))()}prepareSession(e,t,n){var i=this;return(0,r.A)((function*(){var r,o;return n&&t!==n.sharedHistory&&(n=null),null!==(r=n)&&void 0!==r&&r.needsRotation(i.sessionRotationPeriodMsgs,i.sessionRotationPeriodMs)&&(i.prefixedLogger.debug("Starting new megolm session because we need to rotate."),n=null),null!==(o=n)&&void 0!==o&&o.sharedWithTooManyDevices(e)&&(n=null),n||(i.prefixedLogger.debug("Starting new megolm session"),n=yield i.prepareNewSession(t),i.prefixedLogger.debug("Started new megolm session ".concat(n.sessionId)),i.outboundSessions[n.sessionId]=n),n}))()}shareSession(e,t,n,i,o){var a=this;return(0,r.A)((function*(){var s={};for(var[l,c]of e)for(var[d,u]of c){var h;u.getIdentityKey()!=a.olmDevice.deviceCurve25519Key&&(null!==(h=o.sharedWithDevices.get(l))&&void 0!==h&&h.get(d)||(s[l]=s[l]||[],s[l].push(u)))}var p=a.olmDevice.getOutboundGroupSessionKey(o.sessionId),v={type:"m.room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:a.roomId,session_id:o.sessionId,session_key:p.key,chain_index:p.chain_index,"org.matrix.msc3061.shared_history":t}},[m,g]=yield y.getExistingOlmSessions(a.olmDevice,a.baseApis,s);yield Promise.all([(0,r.A)((function*(){var e=Array.from(g.entries()).map((e=>{var[t,n]=e;return Array.from(n.entries()).map((e=>{var[n,r]=e;return"".concat(t,"/").concat(n,": ").concat(r.sessionId)}))})).flat(1);a.prefixedLogger.debug("Sharing keys with devices with existing Olm sessions:",e),yield a.shareKeyWithOlmSessions(o,p,v,g),a.prefixedLogger.debug("Shared keys with existing Olm sessions")}))(),(0,r.A)((function*(){var e=Array.from(m.entries()).map((e=>{var[t,n]=e;return n.map((e=>"".concat(t,"/").concat(e.deviceId)))})).flat(1);a.prefixedLogger.debug("Sharing keys (start phase 1) with devices without existing Olm sessions:",e);var t=[],i=Date.now(),s=[];yield a.shareKeyWithDevices(o,p,v,m,t,n?1e4:2e3,s),a.prefixedLogger.debug("Shared keys (end phase 1) with devices without existing Olm sessions"),!n&&Date.now()-i<1e4?(0,r.A)((function*(){var e=new O.kG((()=>[])),n=new Set;for(var r of s)n.add(r);var i=[];for(var{userId:l,deviceInfo:c}of t){var d=l.slice(l.indexOf(":")+1);n.has(d)?e.getOrCreate(l).push(c):i.push({userId:l,deviceInfo:c})}var u=Array.from(e.entries()).map((e=>{var[t,n]=e;return n.map((e=>"".concat(t,"/").concat(e.deviceId)))})).flat(1);u.length>0&&(a.prefixedLogger.debug("Sharing keys (start phase 2) with devices without existing Olm sessions:",u),yield a.shareKeyWithDevices(o,p,v,e,i,3e4),a.prefixedLogger.debug("Shared keys (end phase 2) with devices without existing Olm sessions")),yield a.notifyFailedOlmDevices(o,p,i)}))():yield a.notifyFailedOlmDevices(o,p,t)}))(),(0,r.A)((function*(){a.prefixedLogger.debug("There are ".concat(i.size," blocked devices:"),Array.from(i.entries()).map((e=>{var[t,n]=e;return Array.from(n.entries()).map((e=>{var[n,r]=e;return"".concat(t,"/").concat(n)}))})).flat(1));var e=new O.kG((()=>new Map)),t=0;for(var[n,r]of i)for(var[s,l]of r){var c;void 0===(null===(c=o.blockedDevicesNotified.get(n))||void 0===c?void 0:c.get(s))&&(e.getOrCreate(n).set(s,{device:l}),t++)}t&&(a.prefixedLogger.debug("Notifying ".concat(t," newly blocked devices:"),Array.from(e.entries()).map((e=>{var[t,n]=e;return Object.entries(n).map((e=>{var[n,r]=e;return"".concat(t,"/").concat(n)}))})).flat(1)),yield a.notifyBlockedDevices(o,e),a.prefixedLogger.debug("Notified ".concat(t," newly blocked devices")))}))()])}))()}prepareNewSession(e){var t=this;return(0,r.A)((function*(){var n=t.olmDevice.createOutboundGroupSession(),r=t.olmDevice.getOutboundGroupSessionKey(n);return yield t.olmDevice.addInboundGroupSession(t.roomId,t.olmDevice.deviceCurve25519Key,[],n,r.key,{ed25519:t.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),t.crypto.backupManager.backupGroupSession(t.olmDevice.deviceCurve25519Key,n),new ee(n,e)}))()}getDevicesWithoutSessions(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(var[r,i]of t){var o=e.get(r);for(var a of i){var s=a.deviceId,l=null==o?void 0:o.get(s);null!=l&&l.sessionId||(n.push({userId:r,deviceInfo:a}),null==o||o.delete(s))}}return n}splitDevices(e){var t=[],n=[t];for(var[r,i]of e){for(var o of i.values())t.push({userId:r,deviceInfo:o.device});t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n}encryptAndSendKeysToDevices(e,t,n,r){return this.crypto.encryptAndSendToDevices(n,r).then((()=>{for(var r of n)e.markSharedWithDevice(r.userId,r.deviceInfo.deviceId,r.deviceInfo.getIdentityKey(),t)})).catch((e=>{throw this.prefixedLogger.error("failed to encryptAndSendToDevices",e),e}))}sendBlockedNotificationsToDevices(e,t,n){var i=this;return(0,r.A)((function*(){var r=new O.kG((()=>new Map));for(var o of t){var l=o.userId,c=o.deviceInfo,d=c.deviceInfo.deviceId,u=Q(Q({},n),{},{code:c.code,reason:c.reason,[s.wt]:(0,a.A)()});"m.no_olm"===u.code&&(delete u.room_id,delete u.session_id),r.getOrCreate(l).set(d,u)}for(var[h,p]of(yield i.baseApis.sendToDevice("m.room_key.withheld",r),r))for(var v of p.keys())e.markNotifiedBlockedDevice(h,v)}))()}reshareKeyWithDevice(e,t,n,i){var o=this;return(0,r.A)((function*(){var r,l=o.outboundSessions[t];if(l)if(l.sharedWithDevices.has(n)){var c=null===(r=l.sharedWithDevices.get(n))||void 0===r?void 0:r.get(i.deviceId);if(void 0!==c)if(c.deviceKey===i.getIdentityKey()){var d=yield o.olmDevice.getInboundGroupSessionKey(o.roomId,e,t,c.messageIndex);if(d){yield y.ensureOlmSessionsForDevices(o.olmDevice,o.baseApis,new Map([[n,[i]]]));var u={type:"m.forwarded_room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:o.roomId,session_id:t,session_key:d.key,chain_index:d.chain_index,sender_key:e,sender_claimed_ed25519_key:d.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:d.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":d.shared_history||!1}},h={algorithm:y.OLM_ALGORITHM,sender_key:o.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};yield y.encryptMessageForDevice(h.ciphertext,o.userId,o.deviceId,o.olmDevice,n,i,u),yield o.baseApis.sendToDevice("m.room.encrypted",new Map([[n,new Map([[i.deviceId,h]])]])),o.prefixedLogger.debug("Re-shared key for megolm session ".concat(e,"|").concat(t," with ").concat(n,":").concat(i.deviceId))}else o.prefixedLogger.warn("No inbound session key found for megolm session ".concat(e,"|").concat(t,": not re-sharing keys"))}else o.prefixedLogger.warn("Megolm session ".concat(e,"|").concat(t," has been shared with device ").concat(i.deviceId," but ")+"with identity key ".concat(c.deviceKey,". Key is now ").concat(i.getIdentityKey(),"!"));else o.prefixedLogger.debug("megolm session ".concat(e,"|").concat(t," never shared with device ").concat(n,":").concat(i.deviceId))}else o.prefixedLogger.debug("megolm session ".concat(e,"|").concat(t," never shared with user ").concat(n));else o.prefixedLogger.debug("megolm session ".concat(e,"|").concat(t," not found: not re-sharing keys"))}))()}shareKeyWithDevices(e,t,n,i,o,a,s){var l=this;return(0,r.A)((function*(){var r=yield y.ensureOlmSessionsForDevices(l.olmDevice,l.baseApis,i,!1,a,s,l.prefixedLogger);l.getDevicesWithoutSessions(r,i,o),yield l.shareKeyWithOlmSessions(e,t,n,r)}))()}shareKeyWithOlmSessions(e,t,n,i){var o=this;return(0,r.A)((function*(){for(var r=o.splitDevices(i),a=0;a<r.length;a++){var s="megolm keys for ".concat(e.sessionId," (slice ").concat(a+1,"/").concat(r.length,")");try{o.prefixedLogger.debug("Sharing ".concat(s),r[a].map((e=>"".concat(e.userId,"/").concat(e.deviceInfo.deviceId)))),yield o.encryptAndSendKeysToDevices(e,t.chain_index,r[a],n),o.prefixedLogger.debug("Shared ".concat(s))}catch(e){throw o.prefixedLogger.error("Failed to share ".concat(s)),e}}}))()}notifyFailedOlmDevices(e,t,n){var i=this;return(0,r.A)((function*(){for(var{userId:r,deviceInfo:o}of(i.prefixedLogger.debug("Notifying ".concat(n.length," devices we failed to create Olm sessions")),n)){var a=o.deviceId;e.markSharedWithDevice(r,a,o.getIdentityKey(),t.chain_index)}var s=yield i.olmDevice.filterOutNotifiedErrorDevices(n);i.prefixedLogger.debug("Need to notify ".concat(s.length," failed devices which haven't been notified before"));var l=new O.kG((()=>new Map));for(var{userId:c,deviceInfo:d}of s)l.getOrCreate(c).set(d.deviceId,{device:{code:"m.no_olm",reason:g["m.no_olm"],deviceInfo:d}});yield i.notifyBlockedDevices(e,l),i.prefixedLogger.debug("Notified ".concat(s.length," devices we failed to create Olm sessions"))}))()}notifyBlockedDevices(e,t){var n=this;return(0,r.A)((function*(){for(var r={room_id:n.roomId,session_id:e.sessionId,algorithm:y.MEGOLM_ALGORITHM,sender_key:n.olmDevice.deviceCurve25519Key},i=n.splitDevices(t),o=0;o<i.length;o++)try{yield n.sendBlockedNotificationsToDevices(e,i[o],r),n.prefixedLogger.debug("Completed blacklist notification for ".concat(e.sessionId," ")+"(slice ".concat(o+1,"/").concat(i.length,")"))}catch(t){throw n.prefixedLogger.debug("blacklist notification for ".concat(e.sessionId," ")+"(slice ".concat(o+1,"/").concat(i.length,") failed")),t}}))()}prepareToEncrypt(e){var t=this;if(e.roomId!==this.roomId)throw new Error("MegolmEncryption.prepareToEncrypt called on unexpected room");if(null!=this.encryptionPreparation){var n=Date.now()-this.encryptionPreparation.startTime;return this.prefixedLogger.debug("Already started preparing to encrypt for this room ".concat(n,"ms ago, skipping")),this.encryptionPreparation.cancel}this.prefixedLogger.debug("Preparing to encrypt events");var i=!1,o=()=>i;return this.encryptionPreparation={startTime:Date.now(),promise:(0,r.A)((function*(){try{var n=yield t.getDevicesInRoom(e,!1,o);if(null===n)return;var[r,i]=n;t.crypto.globalErrorOnUnknownDevices&&t.removeUnknownDevices(r),t.prefixedLogger.debug("Ensuring outbound megolm session"),yield t.ensureOutboundSession(e,r,i,!0),t.prefixedLogger.debug("Ready to encrypt events")}catch(e){t.prefixedLogger.error("Failed to prepare to encrypt events",e)}finally{delete t.encryptionPreparation}}))(),cancel:()=>{i=!0,delete this.encryptionPreparation}},this.encryptionPreparation.cancel}encryptMessage(e,t,n){var i=this;return(0,r.A)((function*(){if(i.prefixedLogger.debug("Starting to encrypt event"),null!=i.encryptionPreparation)try{yield i.encryptionPreparation.promise}catch(e){}var r=i.isVerificationEvent(t,n),[o,a]=yield i.getDevicesInRoom(e,r);i.crypto.globalErrorOnUnknownDevices&&i.checkForUnknownDevices(o);var s=yield i.ensureOutboundSession(e,o,a),l={room_id:i.roomId,type:t,content:n},c=i.olmDevice.encryptGroupMessage(s.sessionId,JSON.stringify(l)),d={algorithm:y.MEGOLM_ALGORITHM,sender_key:i.olmDevice.deviceCurve25519Key,ciphertext:c,session_id:s.sessionId,device_id:i.deviceId};return s.useCount++,d}))()}isVerificationEvent(e,t){switch(e){case s.Bx.KeyVerificationCancel:case s.Bx.KeyVerificationDone:case s.Bx.KeyVerificationMac:case s.Bx.KeyVerificationStart:case s.Bx.KeyVerificationKey:case s.Bx.KeyVerificationReady:case s.Bx.KeyVerificationAccept:return!0;case s.Bx.RoomMessage:return t.msgtype===s.Wr.KeyVerificationRequest;default:return!1}}forceDiscardSession(){this.setupPromise=this.setupPromise.then((()=>null))}checkForUnknownDevices(e){var t=new O.kG((()=>new Map));for(var[n,r]of e)for(var[i,o]of r)o.isUnverified()&&!o.isKnown()&&t.getOrCreate(n).set(i,o);if(t.size)throw new $("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}removeUnknownDevices(e){for(var[t,n]of e){for(var[r,i]of n)i.isUnverified()&&!i.isKnown()&&n.delete(r);0===n.size&&e.delete(t)}}getDevicesInRoom(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2?t[2]:void 0,o=yield e.getEncryptionTargetMembers();n.prefixedLogger.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(e.shouldEncryptForInvitedMembers(),"):"),o.map((e=>"".concat(e.userId," (").concat(e.membership,")"))));var a=o.map((function(e){return e.userId})),s=n.crypto.globalBlacklistUnverifiedDevices,l=e.getBlacklistUnverifiedDevices();"boolean"==typeof l&&(s=l);var c=yield n.crypto.downloadKeys(a,!1);if(!0===(null==i?void 0:i()))return null;var d=new O.kG((()=>new Map));for(var[u,h]of c)for(var[p,v]of h){if(void 0!==i&&(yield(0,O.iH)()),!0===(null==i?void 0:i()))return null;var m=n.crypto.checkDeviceTrust(u,p);if(v.isBlocked()||!m.isVerified()&&s&&!r){var f=d.getOrCreate(u),y=v.isBlocked();f.set(p,{code:y?"m.blacklisted":"m.unverified",reason:g[y?"m.blacklisted":"m.unverified"],deviceInfo:v}),h.delete(p)}}return[c,d]}))()}},class extends G{constructor(e){super(e),(0,i.A)(this,"pendingEvents",new Map),(0,i.A)(this,"olmlib",y),(0,i.A)(this,"roomId",void 0),(0,i.A)(this,"prefixedLogger",void 0),this.roomId=e.roomId,this.prefixedLogger=c.v.getChild("[".concat(this.roomId," decryption]"))}decryptEvent(e){var t=this;return(0,r.A)((function*(){var n,r=e.getWireContent();if(!r.sender_key||!r.session_id||!r.ciphertext)throw new h.O(u.DecryptionFailureCode.MEGOLM_MISSING_FIELDS,"Missing fields in input");t.addEventToPendingList(e);try{n=yield t.olmDevice.decryptGroupMessage(e.getRoomId(),r.sender_key,r.session_id,r.ciphertext,e.getId(),e.getTs())}catch(n){if("DecryptionError"===n.name)throw n;var i=u.DecryptionFailureCode.OLM_DECRYPT_GROUP_MESSAGE_ERROR;throw"OLM.UNKNOWN_MESSAGE_INDEX"===(null==n?void 0:n.message)&&(t.requestKeysForEvent(e),i=u.DecryptionFailureCode.OLM_UNKNOWN_MESSAGE_INDEX),new h.O(i,n instanceof Error?n.message:"Unknown Error: Error is undefined",{session:r.sender_key+"|"+r.session_id})}if(null===n){t.crypto.backupManager.queryKeyBackupRateLimited(e.getRoomId(),r.session_id).catch((()=>{})),t.requestKeysForEvent(e);var o=yield t.olmDevice.sessionMayHaveProblems(r.sender_key,e.getTs()-12e4);if(o){t.prefixedLogger.info("When handling UISI from ".concat(e.getSender()," (sender key ").concat(r.sender_key,"): ")+"recent session problem with that sender:",o);var a=te[o.type]||te.unknown;throw o.fixed&&(a+=" Trying to create a new secure channel and re-requesting the keys."),new h.O(u.DecryptionFailureCode.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,a,{session:r.sender_key+"|"+r.session_id})}throw new h.O(u.DecryptionFailureCode.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",{session:r.sender_key+"|"+r.session_id})}n.untrusted||t.removeEventFromPendingList(e);var s=JSON.parse(n.result);if(s.room_id!==e.getRoomId())throw new h.O(u.DecryptionFailureCode.MEGOLM_BAD_ROOM,"Message intended for room "+s.room_id);return{clearEvent:s,senderCurve25519Key:n.senderKey,claimedEd25519Key:n.keysClaimed.ed25519,forwardingCurve25519KeyChain:n.forwardingCurve25519KeyChain,untrusted:n.untrusted}}))()}requestKeysForEvent(e){var t=e.getWireContent(),n=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)}addEventToPendingList(e){var t,n=e.getWireContent(),r=n.sender_key,i=n.session_id;this.pendingEvents.has(r)||this.pendingEvents.set(r,new Map);var o=this.pendingEvents.get(r);o.has(i)||o.set(i,new Set),null===(t=o.get(i))||void 0===t||t.add(e)}removeEventFromPendingList(e){var t=e.getWireContent(),n=t.sender_key,r=t.session_id,i=this.pendingEvents.get(n),o=null==i?void 0:i.get(r);o&&(o.delete(e),0===o.size&&i.delete(r),0===i.size&&this.pendingEvents.delete(n))}roomKeyFromEvent(e){var t=e.getSenderKey(),n=e.getContent(),r={};if(n.room_id&&n.session_key&&n.session_id&&n.algorithm){if(y.isOlmEncrypted(e))return n["org.matrix.msc3061.shared_history"]&&(r.sharedHistory=!0),{senderKey:t,sessionId:n.session_id,sessionKey:n.session_key,extraSessionData:r,exportFormat:!1,roomId:n.room_id,algorithm:n.algorithm,forwardingKeyChain:[],keysClaimed:e.getKeysClaimed()};this.prefixedLogger.error("key event not properly encrypted")}else this.prefixedLogger.error("key event is missing fields")}forwardedRoomKeyFromEvent(e){var t=this.roomKeyFromEvent(e);if(t){var n=e.getSenderKey(),r=e.getContent(),i=this.baseApis.crypto.deviceList.getUserByIdentityKey(y.OLM_ALGORITHM,n),o=r.sender_key,a=r.sender_claimed_ed25519_key,s=Array.isArray(r.forwarding_curve25519_key_chain)?r.forwarding_curve25519_key_chain:[];if((s=s.slice()).push(n),i===e.getSender())if(o){if(a){var l={ed25519:a};return t.senderKey=o,t.keysClaimed=l,t.exportFormat=!0,t.forwardingKeyChain=s,t.extraSessionData.untrusted=!0,t}this.prefixedLogger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field")}else this.prefixedLogger.error("forwarded_room_key event is missing sender_key field");else this.prefixedLogger.error("sending device does not belong to the user it claims to be from")}}shouldAcceptForwardedKey(e,t){var n=this;return(0,r.A)((function*(){var r,i=e.getSenderKey(),o=null!==(r=n.crypto.deviceList.getDeviceByIdentityKey(y.OLM_ALGORITHM,i))&&void 0!==r?r:void 0,a=n.crypto.checkDeviceInfoTrust(e.getSender(),o),s=e.getSender()===n.baseApis.getUserId(),l=a.isVerified()&&s,c=yield n.wasRoomKeyRequested(e,t),d=n.wasRoomKeyForwardedByInviter(e,t),u=n.wasRoomKeyForwardedAsHistory(t);return c&&l||d&&u}))()}wasRoomKeyRequested(e,t){var n=this;return(0,r.A)((function*(){return(yield n.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e.getSender(),"*",[q.Sent])).some((e=>e.requestBody.room_id===t.roomId&&e.requestBody.session_id===t.sessionId))}))()}wasRoomKeyForwardedByInviter(e,t){var n,r,i,o=this.baseApis.getRoom(t.roomId),a=e.getSenderKey();if(!a)return!1;var s=this.crypto.deviceList.getUserByIdentityKey(y.OLM_ALGORITHM,a);if(!s)return!1;var l=null==o||null===(n=o.getMember(this.userId))||void 0===n?void 0:n.events.member,c=(null==l?void 0:l.getSender())===s||(null==l||null===(r=l.getUnsigned())||void 0===r?void 0:r.prev_sender)===s&&(null==l||null===(i=l.getPrevContent())||void 0===i?void 0:i.membership)===J.O.Invite;return!(!o||!c)}wasRoomKeyForwardedAsHistory(e){return!(!this.baseApis.getRoom(e.roomId)||!e.extraSessionData.sharedHistory)}shouldParkForwardedKey(e){return!(this.baseApis.getRoom(e.roomId)||!e.extraSessionData.sharedHistory)}parkForwardedKey(e,t){var n=this;return(0,r.A)((function*(){var r={senderId:e.getSender(),senderKey:t.senderKey,sessionId:t.sessionId,sessionKey:t.sessionKey,keysClaimed:t.keysClaimed,forwardingCurve25519KeyChain:t.forwardingKeyChain};yield n.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],(e=>n.crypto.cryptoStore.addParkedSharedHistory(t.roomId,r,e)),c.v.getChild("[addParkedSharedHistory]"))}))()}addRoomKey(e){var t=this;return(0,r.A)((function*(){try{yield t.olmDevice.addInboundGroupSession(e.roomId,e.senderKey,e.forwardingKeyChain,e.sessionId,e.sessionKey,e.keysClaimed,e.exportFormat,e.extraSessionData),(yield t.retryDecryption(e.senderKey,e.sessionId,!e.extraSessionData.untrusted))&&t.crypto.cancelRoomKeyRequest({algorithm:e.algorithm,room_id:e.roomId,session_id:e.sessionId,sender_key:e.senderKey}),yield t.crypto.backupManager.backupGroupSession(e.senderKey,e.sessionId)}catch(e){t.prefixedLogger.error("Error handling m.room_key_event: ".concat(e))}}))()}onForwardedRoomKey(e){var t=this;return(0,r.A)((function*(){var n=t.forwardedRoomKeyFromEvent(e);n&&((yield t.shouldAcceptForwardedKey(e,n))?yield t.addRoomKey(n):t.shouldParkForwardedKey(n)&&(yield t.parkForwardedKey(e,n)))}))()}onRoomKeyEvent(e){var t=this;return(0,r.A)((function*(){if("m.forwarded_room_key"==e.getType())yield t.onForwardedRoomKey(e);else{var n=t.roomKeyFromEvent(e);if(!n)return;yield t.addRoomKey(n)}}))()}onRoomKeyWithheldEvent(e){var t=this;return(0,r.A)((function*(){var n=e.getContent(),r=n.sender_key;"m.no_olm"===n.code?yield t.onNoOlmWithheldEvent(e):"m.unavailable"===n.code||(yield t.olmDevice.addInboundGroupSessionWithheld(n.room_id,r,n.session_id,n.code,n.reason)),n.session_id?yield t.retryDecryption(r,n.session_id):yield t.retryDecryptionFromSender(r)}))()}onNoOlmWithheldEvent(e){var t=this;return(0,r.A)((function*(){var n=e.getContent(),r=n.sender_key,i=e.getSender();if(t.prefixedLogger.warn("".concat(i,":").concat(r," was unable to establish an olm session with us")),yield t.olmDevice.getSessionIdForDevice(r))return t.prefixedLogger.debug("New session already created.  Not creating a new one."),void(yield t.olmDevice.recordSessionProblem(r,"no_olm",!0));var o=t.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r);if(!(o||(yield t.crypto.downloadKeys([i],!1),o=t.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r))))return t.prefixedLogger.info("Couldn't find device for identity key "+r+": not establishing session"),void(yield t.olmDevice.recordSessionProblem(r,"no_olm",!1));yield y.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,new Map([[i,[o]]]),!1);var l={algorithm:y.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};yield y.encryptMessageForDevice(l.ciphertext,t.userId,void 0,t.olmDevice,i,o,{type:"m.dummy"}),yield t.olmDevice.recordSessionProblem(r,"no_olm",!0),yield t.baseApis.sendToDevice("m.room.encrypted",new Map([[i,new Map([[o.deviceId,l]])]]))}))()}hasKeysForKeyRequest(e){var t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}shareKeysWithDevice(e){var t=e.userId,n=e.deviceId,r=this.crypto.getStoredDevice(t,n),i=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,new Map([[t,[r]]])).then((e=>{var r,o=null===(r=e.get(t))||void 0===r?void 0:r.get(n);return null!=o&&o.sessionId?(this.prefixedLogger.debug("sharing keys for session "+i.sender_key+"|"+i.session_id+" with device "+t+":"+n),this.buildKeyForwardingMessage(i.room_id,i.sender_key,i.session_id)):null})).then((e=>{var i={algorithm:y.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};return this.olmlib.encryptMessageForDevice(i.ciphertext,this.userId,void 0,this.olmDevice,t,r,e).then((()=>this.baseApis.sendToDevice("m.room.encrypted",new Map([[t,new Map([[n,i]])]]))))}))}buildKeyForwardingMessage(e,t,n){var i=this;return(0,r.A)((function*(){var r=yield i.olmDevice.getInboundGroupSessionKey(e,t,n);return{type:"m.forwarded_room_key",content:{algorithm:y.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:r.sender_claimed_ed25519_key,session_id:n,session_key:r.key,chain_index:r.chain_index,forwarding_curve25519_key_chain:r.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":r.shared_history||!1}}}))()}importRoomKey(e){var{untrusted:t,source:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};return(t||e.untrusted)&&(r.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(r.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,r).then((()=>{"backup"!==n&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((e=>{this.prefixedLogger.debug("Failed to back up megolm session",e)})),this.retryDecryption(e.sender_key,e.session_id,!r.untrusted)}))}retryDecryption(e,t,n){var i=this;return(0,r.A)((function*(){var o,a=i.pendingEvents.get(e);if(!a)return!0;var s=a.get(t);if(!s)return!0;var l=[...s];return i.prefixedLogger.debug("Retrying decryption on events:",l.map((e=>"".concat(e.getId())))),yield Promise.all(l.map(function(){var e=(0,r.A)((function*(e){try{yield e.attemptDecryption(i.crypto,{isRetry:!0,forceRedecryptIfUntrusted:n})}catch(e){}}));return function(t){return e.apply(this,arguments)}}())),!(null!==(o=i.pendingEvents.get(e))&&void 0!==o&&o.has(t))}))()}retryDecryptionFromSender(e){var t=this;return(0,r.A)((function*(){var n=t.pendingEvents.get(e);return!n||(t.pendingEvents.delete(e),yield Promise.all([...n].map(function(){var e=(0,r.A)((function*(e){var[n,i]=e;yield Promise.all([...i].map(function(){var e=(0,r.A)((function*(e){try{yield e.attemptDecryption(t.crypto)}catch(e){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}())),!t.pendingEvents.has(e))}))()}sendSharedHistoryInboundSessions(e){var t=this;return(0,r.A)((function*(){yield y.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,e);var n=yield t.olmDevice.getSharedHistoryInboundGroupSessions(t.roomId);for(var[r,i]of(t.prefixedLogger.debug("Sharing history in with users ".concat(Array.from(e.keys())),n.map((e=>{var[t,n]=e;return"".concat(t,"|").concat(n)}))),n)){var o=yield t.buildKeyForwardingMessage(t.roomId,r,i),l=[],c=new Map;for(var[d,u]of e){var h=new Map;for(var p of(c.set(d,h),u)){var v={algorithm:y.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};h.set(p.deviceId,v),l.push(y.encryptMessageForDevice(v.ciphertext,t.userId,void 0,t.olmDevice,d,p,o))}}for(var[m,g]of(yield Promise.all(l),c)){for(var[f,_]of g)Z(_)||(t.prefixedLogger.debug("No ciphertext for device "+m+":"+f+": pruning"),g.delete(f));0===g.size&&(t.prefixedLogger.debug("Pruned all devices for user "+m),c.delete(m))}if(0===c.size)return void t.prefixedLogger.debug("No users left to send to: aborting");yield t.baseApis.sendToDevice("m.room.encrypted",c)}}))()}});var ne=n(9561),re=n(9521),ie=n(4792);class oe{constructor(e,t){(0,i.A)(this,"accountDataClientAdapter",void 0),(0,i.A)(this,"crossSigningCallbacks",void 0),(0,i.A)(this,"ssssCryptoCallbacks",void 0),(0,i.A)(this,"crossSigningKeys",void 0),(0,i.A)(this,"keySignatures",void 0),(0,i.A)(this,"keyBackupInfo",void 0),(0,i.A)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new se(e),this.crossSigningCallbacks=new le,this.ssssCryptoCallbacks=new ce(t)}addCrossSigningKeys(e,t){this.crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,t,n){var r;this.keySignatures||(this.keySignatures={});var i=null!==(r=this.keySignatures[e])&&void 0!==r?r:{};this.keySignatures[e]=i,i[t]=n}setAccountData(e,t){var n=this;return(0,r.A)((function*(){yield n.accountDataClientAdapter.setAccountData(e,t)}))()}buildOperation(){var e=this.accountDataClientAdapter.values;return new ae(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}persist(e){var t=this;return(0,r.A)((function*(){if(t.crossSigningKeys){var n=I(e.cryptoStore,e.olmDevice);for(var r of["master","self_signing","user_signing"]){var i;c.v.log("Cache ".concat(r," cross-signing private key locally"));var o=t.crossSigningCallbacks.privateKeys.get(r);yield null===(i=n.storeCrossSigningKeyCache)||void 0===i?void 0:i.call(n,r,o)}yield e.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(n=>{e.cryptoStore.storeCrossSigningKeys(n,t.crossSigningKeys.keys)}))}t.sessionBackupPrivateKey&&(yield e.storeSessionBackupPrivateKey(t.sessionBackupPrivateKey))}))()}}class ae{constructor(e,t,n,r){this.accountData=e,this.crossSigningKeys=t,this.keyBackupInfo=n,this.keySignatures=r}apply(e){var t=this;return(0,r.A)((function*(){var n=e.baseApis;if(t.crossSigningKeys){var r,i,o={};for(var[a,s]of Object.entries(t.crossSigningKeys.keys))o[a+"_key"]=s;yield null===(r=(i=t.crossSigningKeys).authUpload)||void 0===r?void 0:r.call(i,(e=>n.uploadDeviceSigningKeys(null!=e?e:void 0,o))),e.crossSigningInfo.setKeys(t.crossSigningKeys.keys)}if(t.accountData)for(var[l,c]of t.accountData)yield n.setAccountData(l,c.getContent());t.keySignatures&&(yield n.uploadKeySignatures(t.keySignatures)),t.keyBackupInfo&&(t.keyBackupInfo.version?yield n.http.authedRequest(re.IT.Put,"/room_keys/version/"+t.keyBackupInfo.version,void 0,{algorithm:t.keyBackupInfo.algorithm,auth_data:t.keyBackupInfo.auth_data},{prefix:re.iD.V3}):yield n.http.authedRequest(re.IT.Post,"/room_keys/version",void 0,t.keyBackupInfo,{prefix:re.iD.V3}),yield e.backupManager.checkKeyBackup())}))()}}class se extends R.X{constructor(e){super(),this.existingValues=e,(0,i.A)(this,"values",new Map)}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){var t,n,r=null!==(t=this.values.get(e))&&void 0!==t?t:this.existingValues.get(e);return null!==(n=null==r?void 0:r.getContent())&&void 0!==n?n:null}setAccountData(e,t){var n=new ne.kl({type:e,content:t}),r=this.values.get(e);return this.values.set(e,n),Promise.resolve().then((()=>(this.emit(ie.AU.AccountData,n,r),{})))}}class le{constructor(){(0,i.A)(this,"privateKeys",new Map)}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){var n;return Promise.resolve(null!==(n=this.privateKeys.get(e))&&void 0!==n?n:null)}saveCrossSigningKeys(e){for(var[t,n]of Object.entries(e))this.privateKeys.set(t,n)}}class ce{constructor(e){this.delegateCryptoCallbacks=e,(0,i.A)(this,"privateKeys",new Map)}getSecretStorageKey(e,t){var n=this;return(0,r.A)((function*(){var r,{keys:i}=e;for(var o of Object.keys(i)){var a=n.privateKeys.get(o);if(a)return[o,a]}if(null!=n&&null!==(r=n.delegateCryptoCallbacks)&&void 0!==r&&r.getSecretStorageKey){var s=yield n.delegateCryptoCallbacks.getSecretStorageKey({keys:i},t);if(s){var[l,c]=s;n.privateKeys.set(l,c)}return s}return null}))()}addPrivateKey(e,t,n){var r,i;this.privateKeys.set(e,n),null===(r=this.delegateCryptoCallbacks)||void 0===r||null===(i=r.cacheSecretStorageKey)||void 0===i||i.call(r,e,t,n)}}var de=n(6900);class ue{constructor(e,t){this.baseApis=e,this.cryptoCallbacks=t,(0,i.A)(this,"requests",new Map)}request(e,t){var n=this.baseApis.makeTxnId(),r=(0,O.v6)();this.requests.set(n,{name:e,devices:t,deferred:r});var i={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:n,[s.wt]:(0,a.A)()},o=new Map;for(var l of t)o.set(l,i);return c.v.info("Request secret ".concat(e," from ").concat(t,", id ").concat(n)),this.baseApis.sendToDevice("m.secret.request",new Map([[this.baseApis.getUserId(),o]])),{requestId:n,promise:r.promise,cancel:e=>{var i={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:n},o=new Map;for(var a of t)o.set(a,i);this.baseApis.sendToDevice("m.secret.request",new Map([[this.baseApis.getUserId(),o]])),r.reject(new Error(e||"Cancelled"))}}}onRequestReceived(e){var t=this;return(0,r.A)((function*(){var n=e.getSender(),r=e.getContent();if(n===t.baseApis.getUserId()&&r.name&&r.action&&r.requesting_device_id&&r.request_id){var i=r.requesting_device_id;if("request_cancellation"===r.action);else if("request"===r.action){if(i===t.baseApis.deviceId)return;if(c.v.info("received request for secret ("+n+", "+i+", "+r.request_id+")"),!t.cryptoCallbacks.onSecretRequested)return;var o=yield t.cryptoCallbacks.onSecretRequested(n,i,r.request_id,r.name,t.baseApis.checkDeviceTrust(n,i));if(o){c.v.info("Preparing ".concat(r.name," secret for ").concat(i));var l={type:"m.secret.send",content:{request_id:r.request_id,secret:o}},d={algorithm:y.OLM_ALGORITHM,sender_key:t.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};yield y.ensureOlmSessionsForDevices(t.baseApis.crypto.olmDevice,t.baseApis,new Map([[n,[t.baseApis.getStoredDevice(n,i)]]])),yield y.encryptMessageForDevice(d.ciphertext,t.baseApis.getUserId(),t.baseApis.deviceId,t.baseApis.crypto.olmDevice,n,t.baseApis.getStoredDevice(n,i),l);var u=new Map([[n,new Map([[i,d]])]]);c.v.info("Sending ".concat(r.name," secret for ").concat(i)),t.baseApis.sendToDevice("m.room.encrypted",u)}else c.v.info("Request denied for ".concat(r.name," secret for ").concat(i))}}}))()}onSecretReceived(e){if(e.getSender()===this.baseApis.getUserId())if(y.isOlmEncrypted(e)){var t=e.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(y.OLM_ALGORITHM,e.getSenderKey()||"")===e.getSender()){c.v.log("got secret share for request",t.request_id);var n=this.requests.get(t.request_id);if(n){var r=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(y.OLM_ALGORITHM,e.getSenderKey());if(!r)return void c.v.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(r.deviceId))return void c.v.log("unsolicited secret share from device",r.deviceId);if(!this.baseApis.crypto.checkDeviceInfoTrust(e.getSender(),r).isVerified())return void c.v.log("secret share from unverified device");c.v.log("Successfully received secret ".concat(n.name," ")+"from ".concat(r.deviceId)),n.deferred.resolve(t.secret)}}else c.v.error("sending device does not belong to the user it claims to be from")}else c.v.error("secret event not properly encrypted")}}class he{constructor(e,t,n){(0,i.A)(this,"storageImpl",void 0),(0,i.A)(this,"sharingImpl",void 0),this.storageImpl=new de.ServerSideSecretStorageImpl(e,t),this.sharingImpl=new ue(n,t)}getDefaultKeyId(){return this.storageImpl.getDefaultKeyId()}setDefaultKeyId(e){return this.storageImpl.setDefaultKeyId(e)}addKey(e,t,n){return this.storageImpl.addKey(e,t,n)}getKey(e){return this.storageImpl.getKey(e)}hasKey(e){return this.storageImpl.hasKey(e)}checkKey(e,t){return this.storageImpl.checkKey(e,t)}store(e,t,n){return this.storageImpl.store(e,t,n)}get(e){return this.storageImpl.get(e)}isStored(e){var t=this;return(0,r.A)((function*(){return t.storageImpl.isStored(e)}))()}request(e,t){return this.sharingImpl.request(e,t)}onRequestReceived(e){return this.sharingImpl.onRequestReceived(e)}onSecretReceived(e){this.sharingImpl.onSecretReceived(e)}}var pe=n(5614);function ve(e,t){return function(n){return function(e,t,n){var r=Object.assign({},{code:e,reason:t},n);return new ne.kl({type:s.Bx.KeyVerificationCancel,content:r})}(e,t,n)}}var me=ve("m.user","Cancelled by user"),ge=ve("m.timeout","Timed out"),fe=ve("m.unknown_method","Unknown method"),ye=ve("m.unexpected_message","Unexpected message"),_e=ve("m.key_mismatch","Key mismatch"),Ee=ve("m.invalid_message","Invalid message");function be(e){var t=e.getContent();if(t){var{code:n,reason:r}=t;return{code:n,reason:r}}return{code:"Unknown error",reason:"m.unknown"}}var Se=n(4400),Ce=new Error("Verification timed out");class we extends Error{constructor(e){super(),this.startEvent=e}}var Ae=Se.Ji;class Te extends R.X{constructor(e,t,n,r,o,a){super(),this.channel=e,this.baseApis=t,this.userId=n,this.deviceId=r,this.startEvent=o,this.request=a,(0,i.A)(this,"cancelled",!1),(0,i.A)(this,"_done",!1),(0,i.A)(this,"promise",null),(0,i.A)(this,"transactionTimeoutTimer",null),(0,i.A)(this,"expectedEvent",void 0),(0,i.A)(this,"resolve",void 0),(0,i.A)(this,"reject",void 0),(0,i.A)(this,"resolveEvent",void 0),(0,i.A)(this,"rejectEvent",void 0),(0,i.A)(this,"started",void 0),(0,i.A)(this,"doVerification",void 0)}get initiatedByMe(){if(!this.startEvent)return!0;var e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){c.v.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(c.v.info("Triggering verification timeout"),this.cancel(Ce))}),6e5)}endTimer(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(e,t){return this.channel.send(e,t)}waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));var t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this.expectedEvent=e,new Promise(((e,t)=>{this.resolveEvent=e,this.rejectEvent=t})))}canSwitchStartEvent(e){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(c.v.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){var t=this.rejectEvent;this.rejectEvent=void 0,t(new we(e))}else this.startEvent=e}handleEvent(e){var t;if(!this._done)if(e.getType()===this.expectedEvent)this.expectedEvent!==s.Bx.KeyVerificationDone&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),null===(t=this.resolveEvent)||void 0===t||t.call(this,e));else if(e.getType()===s.Bx.KeyVerificationCancel){var n=this.reject;if(this.reject=void 0,n){var r=e.getContent(),{reason:i,code:o}=r;n(new Error("Other side cancelled verification "+"because ".concat(i," (").concat(o,")")))}}else if(this.expectedEvent){var a=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){var l=this.rejectEvent;this.rejectEvent=void 0,l(a)}this.cancel(a)}}done(){var e=this;return(0,r.A)((function*(){var t;if(e.endTimer(),!e._done)return e.request.onVerifierFinished(),null===(t=e.resolve)||void 0===t||t.call(e),function(e,t,n){return k.apply(this,arguments)}(e.baseApis,e.userId,e.deviceId)}))()}cancel(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===Ce){var t=ge();this.send(t.getType(),t.getContent())}else if(e instanceof ne.kl){if(e.getSender()!==this.userId){var n=e.getContent();e.getType()===s.Bx.KeyVerificationCancel?(n.code=n.code||"m.unknown",n.reason=n.reason||n.body||"Unknown reason",this.send(s.Bx.KeyVerificationCancel,n)):this.send(s.Bx.KeyVerificationCancel,{code:"m.unknown",reason:n.body||"Unknown reason"})}}else this.send(s.Bx.KeyVerificationCancel,{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit(Ae.Cancel,e)}}verify(){var e=this;return this.promise||(this.promise=new Promise(((t,n)=>{this.resolve=function(){e._done=!0,e.endTimer(),t(...arguments)},this.reject=e=>{this._done=!0,this.endTimer(),n(e)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise(((e,t)=>{var n;(null===(n=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(this.userId))||void 0===n?void 0:n.getId())===this.deviceId&&t(new Error("Device ID is the same as the cross-signing ID")),e()})).then((()=>this.doVerification())).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}verifyKeys(e,t,n){var i=this;return(0,r.A)((function*(){var r=[];for(var[o,a]of Object.entries(t)){var s=o.split(":",2)[1],l=i.baseApis.getStoredDevice(e,s);if(l)n(o,l,a),r.push([s,o,l.keys[o]]);else{var d=i.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);d&&d.getId()===s?(n(o,_.V.fromStorage({keys:{[o]:s}},s),a),r.push([s,o,s])):c.v.warn("verification: Could not find device ".concat(s," to verify"))}}if(!r.length)throw new Error("No devices could be verified");for(var[u,h,p]of(c.v.info("Verification completed! Marking devices verified: ",r),r))yield i.baseApis.crypto.setDeviceVerification(e,u,!0,null,null,{[h]:p});e==i.baseApis.credentials.userId&&(yield i.baseApis.checkKeyBackup())}))()}get events(){}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}var Ie=n(9255),ke=Ie.V.ShowQrCode,Oe=Ie.V.ScanQrCode,Re=Se.Ji;class xe extends Te{constructor(){var e;super(...arguments),e=this,(0,i.A)(this,"reciprocateQREvent",void 0),(0,i.A)(this,"doVerification",(0,r.A)((function*(){if(!e.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");var{qrCodeData:t}=e.request;if(e.startEvent.getContent().secret!==(null==t?void 0:t.encodedSharedSecret))throw _e();yield new Promise(((t,n)=>{e.reciprocateQREvent={confirm:t,cancel:()=>n(me())},e.emit(Re.ShowReciprocateQr,e.reciprocateQREvent)}));var n={};switch(null==t?void 0:t.mode){case Ne.VerifyOtherUser:var r=t.otherUserMasterKey;n["ed25519:".concat(r)]=r;break;case Ne.VerifySelfTrusted:var i=e.request.targetDevice.deviceId;n["ed25519:".concat(i)]=t.otherDeviceKey;break;case Ne.VerifySelfUntrusted:var o=t.myMasterKey;n["ed25519:".concat(o)]=o}yield e.verifyKeys(e.userId,n,((e,t,r)=>{var i=n[e];if(!i)throw _e();if(r!==i)throw c.v.error("key ID from key info does not match"),_e();for(var o in t.keys)if(o.startsWith("ed25519")){var a=n[o];if(!a)throw _e();if(t.keys[o]!==a)throw c.v.error("master key does not match"),_e()}}))})))}static factory(e,t,n,r,i,o){return new xe(e,t,n,r,i,o)}static get NAME(){return"m.reciprocate.v1"}getReciprocateQrCodeCallbacks(){var e;return null!==(e=this.reciprocateQREvent)&&void 0!==e?e:null}}var Ne=function(e){return e[e.VerifyOtherUser=0]="VerifyOtherUser",e[e.VerifySelfTrusted=1]="VerifySelfTrusted",e[e.VerifySelfUntrusted=2]="VerifySelfUntrusted",e}(Ne||{});class De{constructor(e,t,n,r,i,o){this.mode=e,this.sharedSecret=t,this.otherUserMasterKey=n,this.otherDeviceKey=r,this.myMasterKey=i,this.buffer=o}static create(e,t){return(0,r.A)((function*(){var n=De.generateSharedSecret(),r=De.determineMode(e,t),i=null,o=null,a=null;if(r===Ne.VerifyOtherUser)i=t.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(r===Ne.VerifySelfTrusted)o=yield De.getOtherDeviceKey(e,t);else if(r===Ne.VerifySelfUntrusted){var s=t.getUserId();a=t.getStoredCrossSigningForUser(s).getId("master")}var l=De.generateQrData(e,t,r,n,i,o,a),c=De.generateBuffer(l);return new De(r,n,i,o,a,c)}))()}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){var e=new Uint8Array(11);return globalThis.crypto.getRandomValues(e),(0,E.PP)(e)}static getOtherDeviceKey(e,t){return(0,r.A)((function*(){var n=t.getUserId(),r=e.targetDevice,i=r.deviceId?t.getStoredDevice(n,r.deviceId):void 0;if(!i)throw new Error("could not find device "+(null==r?void 0:r.deviceId));return i.getFingerprint()}))()}static determineMode(e,t){var n=t.getUserId(),r=e.otherUserId,i=Ne.VerifyOtherUser;return n===r&&(i=t.checkUserTrust(n).isCrossSigningVerified()?Ne.VerifySelfTrusted:Ne.VerifySelfUntrusted),i}static generateQrData(e,t,n,r,i,o,a){var s=t.getUserId(),l={prefix:"MATRIX",version:2,mode:n,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:r},c=t.getStoredCrossSigningForUser(s);return n===Ne.VerifyOtherUser?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=i):n===Ne.VerifySelfTrusted?(l.firstKeyB64=c.getId("master"),l.secondKeyB64=o):n===Ne.VerifySelfUntrusted&&(l.firstKeyB64=t.getDeviceEd25519Key(),l.secondKeyB64=a),l}static generateBuffer(e){var t=Buffer.alloc(0),n=e=>{var n=Buffer.from([e]);t=Buffer.concat([t,n])},r=function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Buffer.from(e,n);r&&(e=>{var n=Buffer.alloc(2);n.writeInt16BE(e,0),t=Buffer.concat([t,n])})(i.byteLength),t=Buffer.concat([t,i])},i=e=>{var n=(0,E.y4)(e),r=Buffer.from(n);t=Buffer.concat([t,r])};return r(e.prefix,"ascii",!1),n(e.version),n(e.mode),r(e.transactionId,"utf-8"),i(e.firstKeyB64),i(e.secondKeyB64),i(e.secretB64),t}}var Le,Pe=s.Bx.KeyVerificationStart,Me=[s.Bx.KeyVerificationAccept,s.Bx.KeyVerificationKey,s.Bx.KeyVerificationMac],Ue=ve("m.mismatched_sas","Mismatched short authentication string"),Fe=ve("m.mismatched_commitment","Mismatched commitment"),Be=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["😀","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]],Ge={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>Be[e]))}};function $e(e,t){var n={};for(var r of t)r in Ge&&(n[r]=Ge[r](Array.from(e)));return n}var Ve={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hkdf-hmac-sha256.v2":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function je(e,t){return function(n,r){var i=e[Ve[t]](n,r);return c.v.log("SAS calculateMAC:",t,[n,r],i),i}}var Ke={"curve25519-hkdf-sha256":function(e,t,n){var r="".concat(e.baseApis.getUserId(),"|").concat(e.baseApis.deviceId,"|")+"".concat(e.ourSASPubKey,"|"),i="".concat(e.userId,"|").concat(e.deviceId,"|").concat(e.theirSASPubKey,"|"),o="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(o,n)},curve25519:function(e,t,n){var r="".concat(e.baseApis.getUserId()).concat(e.baseApis.deviceId),i="".concat(e.userId).concat(e.deviceId),o="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(o,n)}},We=["curve25519-hkdf-sha256","curve25519"],qe=["sha256"],He=["hkdf-hmac-sha256.v2","org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],Ye=Object.keys(Ge),ze=new Set(We),Je=new Set(qe),Xe=new Set(He),Qe=new Set(Ye);function Ze(e,t){return Array.isArray(e)?e.filter((e=>t.has(e))):[]}var et=Se.Ji;class tt extends Te{constructor(){var e;super(...arguments),e=this,(0,i.A)(this,"waitingForAccept",void 0),(0,i.A)(this,"ourSASPubKey",void 0),(0,i.A)(this,"theirSASPubKey",void 0),(0,i.A)(this,"sasEvent",void 0),(0,i.A)(this,"doVerification",(0,r.A)((function*(){yield globalThis.Olm.init(),Le=Le||new globalThis.Olm.Utility,yield e.baseApis.downloadKeys([e.userId]);var t=!1;do{try{return e.initiatedByMe?yield e.doSendVerification():yield e.doRespondVerification()}catch(n){if(!(n instanceof we))throw n;e.startEvent=n.startEvent,t=!0}}while(t)})))}static get NAME(){return Ie.V.Sas}get events(){return Me}canSwitchStartEvent(e){if(e.getType()!==Pe)return!1;var t=e.getContent();return(null==t?void 0:t.method)===tt.NAME&&!!this.waitingForAccept}sendStart(){var e=this;return(0,r.A)((function*(){var t=e.channel.completeContent(Pe,{method:tt.NAME,from_device:e.baseApis.deviceId,key_agreement_protocols:We,hashes:qe,message_authentication_codes:He,short_authentication_string:Ye});return yield e.channel.sendCompleted(Pe,t),t}))()}verifyAndCheckMAC(e,t,n,i){var o=this;return(0,r.A)((function*(){var a=Ke[e](o,n,6),l=new Promise(((e,s)=>{var l;o.sasEvent={sas:$e(a,t),confirm:(l=(0,r.A)((function*(){try{yield o.sendMAC(n,i),e()}catch(e){s(e)}})),function(){return l.apply(this,arguments)}),cancel:()=>s(me()),mismatch:()=>s(Ue())},o.emit(et.ShowSas,o.sasEvent)})),[c]=yield Promise.all([o.waitForEvent(s.Bx.KeyVerificationMac).then((e=>(o.expectedEvent=s.Bx.KeyVerificationDone,e))),l]),d=c.getContent();yield o.checkMAC(n,d,i)}))()}doSendVerification(){var e=this;return(0,r.A)((function*(){var t,n;if(e.waitingForAccept=!0,t=e.startEvent?e.channel.completedContentFromEvent(e.startEvent):yield e.sendStart(),!e.initiatedByMe)throw new we(e.startEvent);try{n=yield e.waitForEvent(s.Bx.KeyVerificationAccept)}finally{e.waitingForAccept=!1}var r=n.getContent(),i=Ze(r.short_authentication_string,Qe);if(!(ze.has(r.key_agreement_protocol)&&Je.has(r.hash)&&Xe.has(r.message_authentication_code)&&i.length))throw fe();if("string"!=typeof r.commitment)throw Ee();var a=r.key_agreement_protocol,l=r.message_authentication_code,c=r.commitment,d=new globalThis.Olm.SAS;try{e.ourSASPubKey=d.get_pubkey(),yield e.send(s.Bx.KeyVerificationKey,{key:e.ourSASPubKey});var u=(r=(n=yield e.waitForEvent(s.Bx.KeyVerificationKey)).getContent()).key+o.stringify(t);if(Le.sha256(u)!==c)throw Fe();e.theirSASPubKey=r.key,d.set_their_key(r.key),yield e.verifyAndCheckMAC(a,i,d,l)}finally{d.free()}}))()}doRespondVerification(){var e=this;return(0,r.A)((function*(){var t=e.channel.completedContentFromEvent(e.startEvent),n=Ze(We,new Set(t.key_agreement_protocols))[0],r=Ze(qe,new Set(t.hashes))[0],i=Ze(He,new Set(t.message_authentication_codes))[0],a=Ze(t.short_authentication_string,Qe);if(void 0===n||void 0===r||void 0===i||!a.length)throw fe();var l=new globalThis.Olm.SAS;try{var c=l.get_pubkey()+o.stringify(t);yield e.send(s.Bx.KeyVerificationAccept,{key_agreement_protocol:n,hash:r,message_authentication_code:i,short_authentication_string:a,commitment:Le.sha256(c)}),t=(yield e.waitForEvent(s.Bx.KeyVerificationKey)).getContent(),e.theirSASPubKey=t.key,l.set_their_key(t.key),e.ourSASPubKey=l.get_pubkey(),yield e.send(s.Bx.KeyVerificationKey,{key:e.ourSASPubKey}),yield e.verifyAndCheckMAC(n,a,l,i)}finally{l.free()}}))()}sendMAC(e,t){var n={},r=[],i="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,o="ed25519:".concat(this.baseApis.deviceId);n[o]=je(e,t)(this.baseApis.getDeviceEd25519Key(),i+o),r.push(o);var a=this.baseApis.getCrossSigningId();if(a){var l="ed25519:".concat(a);n[l]=je(e,t)(a,i+l),r.push(l)}var c=je(e,t)(r.sort().join(","),i+"KEY_IDS");return this.send(s.Bx.KeyVerificationMac,{mac:n,keys:c})}checkMAC(e,t,n){var i=this;return(0,r.A)((function*(){var r="MATRIX_KEY_VERIFICATION_MAC"+i.userId+i.deviceId+i.baseApis.getUserId()+i.baseApis.deviceId+i.channel.transactionId;if(t.keys!==je(e,n)(Object.keys(t.mac).sort().join(","),r+"KEY_IDS"))throw _e();yield i.verifyKeys(i.userId,t.mac,((t,i,o)=>{if(o!==je(e,n)(i.keys[t],r+t))throw _e()}))}))()}getShowSasCallbacks(){var e;return null!==(e=this.sasEvent)&&void 0!==e?e:null}}var nt=n(2824),rt="m.key.verification.",it=rt+"request",ot=rt+"start",at=rt+"cancel",st=rt+"done",lt=rt+"ready",ct=Se.X9.Unsent,dt=Se.X9.Requested,ut=Se.X9.Ready,ht=Se.X9.Started,pt=Se.X9.Cancelled,vt=Se.X9.Done;class mt extends R.X{constructor(e,t,n){var o;super(),o=this,this.channel=e,this.verificationMethods=t,this.client=n,(0,i.A)(this,"eventsByUs",new Map),(0,i.A)(this,"eventsByThem",new Map),(0,i.A)(this,"_observeOnly",!1),(0,i.A)(this,"timeoutTimer",null),(0,i.A)(this,"_accepting",!1),(0,i.A)(this,"_declining",!1),(0,i.A)(this,"verifierHasFinished",!1),(0,i.A)(this,"_cancelled",!1),(0,i.A)(this,"_chosenMethod",null),(0,i.A)(this,"_qrCodeData",null),(0,i.A)(this,"requestReceivedAt",null),(0,i.A)(this,"commonMethods",[]),(0,i.A)(this,"_phase",void 0),(0,i.A)(this,"_cancellingUserId",void 0),(0,i.A)(this,"_verifier",void 0),(0,i.A)(this,"cancelOnTimeout",(0,r.A)((function*(){try{o.initiatedByMe?yield o.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):yield o.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){c.v.error("Error while cancelling verification request",e)}}))),this.channel.request=this,this.setPhase(ct,!1)}static validateEvent(e,t,n){var r=t.getContent();return!(!e||!e.startsWith(rt))&&(r?e!==it&&e!==lt||Array.isArray(r.methods)?e!==it&&e!==lt&&e!==ot||"string"==typeof r.from_device&&0!==r.from_device.length||(c.v.log("VerificationRequest: validateEvent: fail because from_device"),!1):(c.v.log("VerificationRequest: validateEvent: fail because methods"),!1):(c.v.log("VerificationRequest: validateEvent: no content"),!1))}get transactionId(){return this.channel.transactionId}get roomId(){return this.channel.roomId}get invalid(){return this.phase===ct}get requested(){return this.phase===dt}get cancelled(){return this.phase===pt}get ready(){return this.phase===ut}get started(){return this.phase===ht}get done(){return this.phase===vt}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){var t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=dt){var n=this.requestReceivedAt+12e4;t=Math.min(t,n)}return Math.max(0,t-Date.now())}get timeout(){var e=this.getEventByEither(it);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this.getEventByEither(it)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return(0,Se.Dy)(this)}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==vt&&this._phase!==pt}get qrCodeData(){return this._qrCodeData}getQRCodeBytes(){if(this._qrCodeData)return new Uint8ClampedArray(this._qrCodeData.getBuffer())}generateQRCode(){var e=this;return(0,r.A)((function*(){return e.getQRCodeBytes()}))()}otherPartySupportsMethod(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.ready||this.started))return!1;var t=this.eventsByThem.get(it)||this.eventsByThem.get(lt);if(!t){if(this.started&&this.initiatedByMe){var n=this.eventsByUs.get(ot),r=n&&n.getContent();return e==(r&&r.method)}return!1}var i=t.getContent();if(!i)return!1;var{methods:o}=i;return!!Array.isArray(o)&&o.includes(e)}get initiatedByMe(){var e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===ct&&e)return!0;var t=this.eventsByUs.has(it),n=this.eventsByThem.has(it);if(t&&!n)return!0;if(!t&&n)return!1;var r=this.eventsByUs.has(ot),i=this.eventsByThem.has(ot);return!(!r||i)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get otherDeviceId(){return this.channel.deviceId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){var e=this.eventsByUs.get(at),t=this.eventsByThem.get(at);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){var e=this.getEventByEither(at);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){var e=this.eventsByThem.get(it)||this.eventsByThem.get(lt)||this.eventsByThem.get(ot),t=null==e?void 0:e.getContent(),n=null==t?void 0:t.from_device;return{userId:this.otherUserId,deviceId:n}}beginKeyVerification(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.observeOnly&&!this._verifier&&(this.phase===dt||this.phase===ut||this.phase===ct&&this.channel.canCreateRequest(ot))){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw fe();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw fe();this._chosenMethod=e}return this._verifier}startVerification(e){var t=this;return(0,r.A)((function*(){var n=t.beginKeyVerification(e);return n.verify(),n}))()}scanQRCode(e){throw new Error("QR code scanning not supported by legacy crypto")}sendRequest(){var e=this;return(0,r.A)((function*(){if(!e.observeOnly&&e._phase===ct){var t=[...e.verificationMethods.keys()];yield e.channel.send(it,{methods:t})}}))()}cancel(){var e=arguments,t=this;return(0,r.A)((function*(){var{reason:n="User declined",code:r="m.user"}=e.length>0&&void 0!==e[0]?e[0]:{};if(!t.observeOnly&&t._phase!==pt){if(t._declining=!0,t.emit(Se.FM.Change),t._verifier)return t._verifier.cancel(ve(r,n)());t._cancellingUserId=t.client.getUserId(),yield t.channel.send(at,{code:r,reason:n})}}))()}accept(){var e=this;return(0,r.A)((function*(){if(!e.observeOnly&&e.phase===dt&&!e.initiatedByMe){var t=[...e.verificationMethods.keys()];e._accepting=!0,e.emit(Se.FM.Change),yield e.channel.send(lt,{methods:t})}}))()}waitFor(e){return new Promise(((t,n)=>{var r=()=>{var i=!1;return e(this)?(t(this),i=!0):this.cancelled&&(n(new Error("cancelled")),i=!0),i&&this.off(Se.FM.Change,r),i};r()||this.on(Se.FM.Change,r)}))}setPhase(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._phase=e,t&&this.emit(Se.FM.Change)}getEventByEither(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}getEventBy(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.eventsByThem.get(e):this.eventsByUs.get(e)}calculatePhaseTransitions(){var e=[{phase:ct}],t=()=>e[e.length-1].phase,n=this.eventsByThem.has(it),r=this.getEventBy(it,n);r&&e.push({phase:dt,event:r});var i,o=r&&this.getEventBy(lt,!n);if(o&&t()===dt&&e.push({phase:ut,event:o}),o||!r){var a=this.eventsByThem.get(ot),s=this.eventsByUs.get(ot);i=a&&s?a.getSender()<s.getSender()?a:s:a||s}else i=this.getEventBy(ot,!n);if(i){var l=t()===dt&&(null==r?void 0:r.getSender())!==i.getSender(),c=t()===ct&&this.channel.canCreateRequest(ot);(l||t()===ut||c)&&e.push({phase:ht,event:i})}var d=this.eventsByUs.get(st);(this.verifierHasFinished||d&&t()===ht)&&e.push({phase:vt});var u=this.getEventByEither(at);return(this._cancelled||u)&&t()!==vt?(e.push({phase:pt,event:u}),e):e}transitionToPhase(e){var{phase:t,event:n}=e;if((t===dt||t===ut)&&!this.wasSentByOwnDevice(n)){var r=n.getContent();this.commonMethods=r.methods.filter((e=>this.verificationMethods.has(e)))}if(this.observeOnly||t!==dt&&t!==ht&&t!==ut||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(n)&&!this.wasSentByOwnDevice(n)&&(this._observeOnly=!0),t===ht){var{method:i}=n.getContent();this._verifier||this.observeOnly||(this._verifier=this.createVerifier(i,n),this._verifier?this._chosenMethod=i:this.cancel({code:"m.unknown_method",reason:"Unknown method: ".concat(i)}))}}applyPhaseTransitions(){var e=this.calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),n=e.slice(t+1);for(var r of n)this.transitionToPhase(r);return n}isWinningStartRace(e){if(e.getType()!==ot)return!1;var t,n,r=this._verifier.startEvent;if(this.isSelfVerification)if(r){var i=r.getContent();t=i&&i.from_device}else t=this.client.getDeviceId();else t=r?r.getSender():this.client.getUserId();if(this.isSelfVerification){var o=e.getContent();n=o&&o.from_device}else n=e.getSender();return n<t}hasEventId(e){for(var t of this.eventsByUs.values())if(t.getId()===e)return!0;for(var n of this.eventsByThem.values())if(n.getId()===e)return!0;return!1}handleEvent(e,t,n,i,o){var a=this;return(0,r.A)((function*(){if(!a.done&&!a.cancelled){var r=a._observeOnly;if(a.adjustObserveOnly(t,n),(a.observeOnly||i||!(yield a.cancelOnError(e,t)))&&!(o?a.eventsByUs.has(e):a.eventsByThem.has(e))){var s=a.phase;a.addEvent(e,t,o);var l=a.applyPhaseTransitions();try{if(a._verifier&&!a.observeOnly){var d=a.isWinningStartRace(t);if(a._verifier.canSwitchStartEvent(t)&&d)a._verifier.switchStartEvent(t);else if(!i){var u;(e===at||null!==(u=a._verifier.events)&&void 0!==u&&u.includes(e))&&a._verifier.handleEvent(t)}}if(l.length){n&&l.some((e=>e.phase===ut))&&a.otherPartySupportsMethod(Oe,!0)&&(a._qrCodeData=yield De.create(a,a.client));var h=l[l.length-1],{phase:p}=h;a.setupTimeout(p),a.setPhase(p)}else a._observeOnly!==r&&a.emit(Se.FM.Change)}finally{c.v.log("Verification request ".concat(a.channel.transactionId,": ")+"".concat(e," event with id:").concat(t.getId(),", ")+"content:".concat(JSON.stringify(t.getContent())," ")+"deviceId:".concat(a.channel.deviceId,", ")+"sender:".concat(t.getSender(),", isSentByUs:").concat(o,", ")+"isLiveEvent:".concat(n,", isRemoteEcho:").concat(i,", ")+"phase:".concat(s,"=>").concat(a.phase,", ")+"observeOnly:".concat(r,"=>").concat(a._observeOnly))}}}}))()}setupTimeout(e){!this.timeoutTimer&&!this.observeOnly&&e===dt&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer&&(e===ht||e===ut||e===vt||e===pt)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}cancelOnError(e,t){var n=this;return(0,r.A)((function*(){if(e===ot){var r=t.getContent().method;if(!n.verificationMethods.has(r))return yield n.cancel(be(fe())),!0}var i=e===it&&n.phase!==ct,o=e===lt&&n.phase!==dt&&n.phase!==ht;if(n.phase!==ct&&(i||o)){c.v.warn("Cancelling, unexpected ".concat(e," verification ")+"event from ".concat(t.getSender()));var a="Unexpected ".concat(e," event in phase ").concat(n.phase);return yield n.cancel(be(ye({reason:a}))),!0}return!1}))()}adjustObserveOnly(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}addEvent(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===it){for(var[n,r]of this.eventsByThem.entries())r.getSender()!==this.otherUserId&&this.eventsByThem.delete(n);this.requestReceivedAt=Date.now()}}createVerifier(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n||(n=this.targetDevice);var{userId:r,deviceId:i}=n,o=this.verificationMethods.get(e);if(o)return new o(this.channel,this.client,r,i,t,this);c.v.warn("could not find verifier constructor for method",e)}wasSentByOwnUser(e){return(null==e?void 0:e.getSender())===this.client.getUserId()}wasSentByOwnDevice(e){if(!this.wasSentByOwnUser(e))return!1;var t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send(s.Bx.KeyVerificationDone,{}),this.verifierHasFinished=!0;var e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this.eventsByThem.get(e)}}var gt=s.Bx.RoomMessage,ft="m.reference",yt="m.relates_to";class _t{constructor(e,t,n){this.client=e,this.roomId=t,this.userId=n,(0,i.A)(this,"requestEventId",void 0)}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(e,t){if(_t.getEventType(e)===it){var n=t.getUserId(),r=e.getSender(),i=e.getContent().to;return r===n?i:i===n?r:void 0}}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===it}canCreateRequest(e){return _t.canCreateRequest(e)}static getTransactionId(e){if(_t.getEventType(e)===it)return e.getId();var t=e.getRelation();return(null==t?void 0:t.rel_type)===ft?t.event_id:void 0}static validateEvent(e,t){var n=_t.getTransactionId(e);if("string"!=typeof n||0===n.length)return!1;var r=_t.getEventType(e),i=e.getContent();if(r===it){if(!i||"string"!=typeof i.to||!i.to.length)return c.v.log("InRoomChannel: validateEvent: no valid to "+i.to),!1;if(!_t.getOtherPartyUserId(e,t))return c.v.log("InRoomChannel: validateEvent: "+"not directed to or sent by me: ".concat(e.getSender())+", ".concat(i.to)),!1}return mt.validateEvent(r,e,t)}static getEventType(e){var t=e.getType();if(t===gt){var n=e.getContent();if(n){var{msgtype:r}=n;if(r===it)return it}}return t&&t!==it?t:""}handleEvent(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var r=n.length>2&&void 0!==n[2]&&n[2];if(!t.hasEventId(e.getId())){var o=_t.getEventType(e);if(e.getRoomId()===i.roomId){if(!i.userId){var a=_t.getOtherPartyUserId(e,i.client);a&&(i.userId=a)}var s=i.client.getUserId(),l=e.getSender();if(!i.userId||l===s||l===i.userId){i.requestEventId||(i.requestEventId=_t.getTransactionId(e));var d=!!e.getTxnId(),u=!!e.getUnsigned().transaction_id,h=e.getSender()===i.client.getUserId();return t.handleEvent(o,e,r,d||u,h)}c.v.log("InRoomChannel: ignoring verification event from non-participating sender ".concat(l))}}}))()}completedContentFromEvent(e){var t=Object.assign({},e.getContent());return t[yt]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==it&&e!==lt&&e!==ot||(t.from_device=this.client.getDeviceId()),e===it?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:it,to:this.userId,from_device:t.from_device,methods:t.methods}:t[yt]={rel_type:ft,event_id:this.transactionId},t}send(e,t){var n=this.completeContent(e,t);return this.sendCompleted(e,n)}sendCompleted(e,t){var n=this;return(0,r.A)((function*(){var r=e;e===it&&(r=gt);var i=yield n.client.sendEvent(n.roomId,r,t);e===it&&(n.requestEventId=i.event_id)}))()}}class Et{constructor(){(0,i.A)(this,"requestsByRoomId",new Map)}getRequest(e){var t=e.getRoomId(),n=_t.getTransactionId(e);return this.getRequestByTxnId(t,n)}getRequestByChannel(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}getRequestByTxnId(e,t){var n=this.requestsByRoomId.get(e);if(n)return n.get(t)}setRequest(e,t){this.doSetRequest(e.getRoomId(),_t.getTransactionId(e),t)}setRequestByChannel(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}doSetRequest(e,t,n){var r=this.requestsByRoomId.get(e);r||(r=new Map,this.requestsByRoomId.set(e,r)),r.set(t,n)}removeRequest(e){var t=e.getRoomId(),n=this.requestsByRoomId.get(t);n&&(n.delete(_t.getTransactionId(e)),0===n.size&&this.requestsByRoomId.delete(t))}findRequestInProgress(e,t){var n=this.requestsByRoomId.get(e);if(n)for(var r of n.values())if(r.pending&&(void 0===t||r.requestingUserId===t))return r}}var bt=n(5942);class St{constructor(e,t,n,r,o){this.client=e,this.userId=t,this.devices=n,this.transactionId=r,this.deviceId=o,(0,i.A)(this,"request",void 0)}isToDevices(e){if(e.length===this.devices.length){for(var t of e)if(!this.devices.includes(t))return!1;return!0}return!1}static getEventType(e){return e.getType()}static getTransactionId(e){var t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===it||e===ot}canCreateRequest(e){return St.canCreateRequest(e)}static validateEvent(e,t){if(e.isCancelled())return c.v.warn("Ignoring flagged verification request from "+e.getSender()),!1;var n=e.getContent();if(!n)return c.v.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!n.transaction_id)return c.v.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;var r=e.getType();if(r===it){if(!Number.isFinite(n.timestamp))return c.v.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return c.v.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return mt.validateEvent(r,e,t)}getTimestamp(e){var t=e.getContent();return t&&t.timestamp}handleEvent(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var r=n.length>2&&void 0!==n[2]&&n[2],o=e.getType(),a=e.getContent();if(o===it||o===lt||o===ot){i.transactionId||(i.transactionId=a.transaction_id);var s=a.from_device;if(!i.deviceId&&i.devices.includes(s)&&(i.deviceId=s),!i.deviceId||i.deviceId!==s){var l=i.completeContent(at,be(ye()));return i.sendToDevices(at,l,[s])}}var c=t.phase===ht||t.phase===ut;yield t.handleEvent(e.getType(),e,r,!1,!1);var d=t.phase===ht||t.phase===ut;if((o===ot||o===lt)&&!c&&d&&i.deviceId){var u=i.devices.filter((e=>e!==i.deviceId&&e!==i.client.getDeviceId()));if(u.length){var h=i.completeContent(at,{code:"m.accepted",reason:"Verification request accepted by another device"});yield i.sendToDevices(at,h,u)}}}))()}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==it&&e!==lt&&e!==ot||(t.from_device=this.client.getDeviceId()),e===it&&(t.timestamp=Date.now()),t}send(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e!==it&&e!==ot||this.transactionId||(this.transactionId=St.makeTransactionId());var n=this.completeContent(e,t);return this.sendCompleted(e,n)}sendCompleted(e,t){var n=this;return(0,r.A)((function*(){var r;r=e===it||e===at&&!n.deviceId?yield n.sendToDevices(e,t,n.devices):yield n.sendToDevices(e,t,[n.deviceId]);var i=new ne.kl({sender:n.client.getUserId(),content:t,type:e});return yield n.request.handleEvent(e,i,!0,!0,!0),r}))()}sendToDevices(e,t,n){var i=this;return(0,r.A)((function*(){if(n.length){var r=new Map;for(var o of n)r.set(o,t);yield i.client.sendToDevice(e,new Map([[i.userId,r]]))}}))()}static makeTransactionId(){return(0,bt.US)(32)}}class Ct{constructor(){(0,i.A)(this,"requestsByUserId",new Map)}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),St.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){var n=this.requestsByUserId.get(e);if(n)return n.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),St.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,n){var r=this.requestsByUserId.get(e);r||(r=new Map,this.requestsByUserId.set(e,r)),r.set(t,n)}removeRequest(e){var t=e.getSender(),n=this.requestsByUserId.get(t);n&&(n.delete(St.getTransactionId(e)),0===n.size&&this.requestsByUserId.delete(t))}findRequestInProgress(e,t){var n=this.requestsByUserId.get(e);if(n)for(var r of n.values())if(r.pending&&r.channel.isToDevices(t))return r}getRequestsInProgress(e){var t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}class wt extends Te{constructor(){super(...arguments),(0,i.A)(this,"doVerification",(0,r.A)((function*(){throw new Error("Verification is not possible with this method")})))}static factory(e,t,n,r,i,o){return new wt(e,t,n,r,i,o)}static get NAME(){return"org.matrix.illegal_method"}}var At=n(4575),Tt=n(29),It=n(5150),kt=n(4659),Ot=n(6729);class Rt{constructor(e){this.cryptoStore=e,(0,i.A)(this,"roomEncryption",{})}init(){var e=this;return(0,r.A)((function*(){yield e.cryptoStore.doTxn("readwrite",[d.y.STORE_ROOMS],(t=>{e.cryptoStore.getEndToEndRooms(t,(t=>{e.roomEncryption=t}))}))}))()}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}setRoomEncryption(e,t){var n=this;return(0,r.A)((function*(){n.roomEncryption[e]=t,yield n.cryptoStore.doTxn("readwrite",[d.y.STORE_ROOMS],(r=>{n.cryptoStore.storeEndToEndRoom(e,t,r)}))}))()}}var xt=n(6122),Nt=n(7131);function Dt(e,t){var n=new Map(Object.entries(e.keys)),r=e.getDisplayName()||void 0,i=new Map;if(e.signatures)for(var o in e.signatures)i.set(o,new Map(Object.entries(e.signatures[o])));return new Nt.p({deviceId:e.deviceId,userId:t,keys:n,algorithms:e.algorithms,verified:e.verified,signatures:i,displayName:r})}function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Pt=_.V.DeviceVerification,Mt={[xe.NAME]:xe,[tt.NAME]:tt,[ke]:wt,[Oe]:wt};function Ut(){return Boolean(globalThis.Olm)}var Ft=function(e){return e.DeviceVerificationChanged="deviceVerificationChanged",e[e.UserTrustStatusChanged=u.CryptoEvent.UserTrustStatusChanged]="UserTrustStatusChanged",e.UserCrossSigningUpdated="userCrossSigningUpdated",e.RoomKeyRequest="crypto.roomKeyRequest",e.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",e[e.KeyBackupStatus=u.CryptoEvent.KeyBackupStatus]="KeyBackupStatus",e[e.KeyBackupFailed=u.CryptoEvent.KeyBackupFailed]="KeyBackupFailed",e[e.KeyBackupSessionsRemaining=u.CryptoEvent.KeyBackupSessionsRemaining]="KeyBackupSessionsRemaining",e[e.KeyBackupDecryptionKeyCached=u.CryptoEvent.KeyBackupDecryptionKeyCached]="KeyBackupDecryptionKeyCached",e.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",e.VerificationRequest="crypto.verification.request",e[e.VerificationRequestReceived=u.CryptoEvent.VerificationRequestReceived]="VerificationRequestReceived",e.Warning="crypto.warning",e[e.WillUpdateDevices=u.CryptoEvent.WillUpdateDevices]="WillUpdateDevices",e[e.DevicesUpdated=u.CryptoEvent.DevicesUpdated]="DevicesUpdated",e[e.KeysChanged=u.CryptoEvent.KeysChanged]="KeysChanged",e[e.LegacyCryptoStoreMigrationProgress=u.CryptoEvent.LegacyCryptoStoreMigrationProgress]="LegacyCryptoStoreMigrationProgress",e}({});class Bt extends R.X{static getOlmVersion(){return m.getOlmVersion()}constructor(e,t,n,o,a,d){var u;if(super(),u=this,this.baseApis=e,this.userId=t,this.deviceId=n,this.clientStore=o,this.cryptoStore=a,(0,i.A)(this,"backupManager",void 0),(0,i.A)(this,"crossSigningInfo",void 0),(0,i.A)(this,"olmDevice",void 0),(0,i.A)(this,"deviceList",void 0),(0,i.A)(this,"dehydrationManager",void 0),(0,i.A)(this,"secretStorage",void 0),(0,i.A)(this,"roomList",void 0),(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"verificationMethods",void 0),(0,i.A)(this,"supportedAlgorithms",void 0),(0,i.A)(this,"outgoingRoomKeyRequestManager",void 0),(0,i.A)(this,"toDeviceVerificationRequests",void 0),(0,i.A)(this,"inRoomVerificationRequests",void 0),(0,i.A)(this,"trustCrossSignedDevices",!0),(0,i.A)(this,"lastOneTimeKeyCheck",null),(0,i.A)(this,"oneTimeKeyCheckInProgress",!1),(0,i.A)(this,"roomEncryptors",new Map),(0,i.A)(this,"roomDecryptors",new Map),(0,i.A)(this,"deviceKeys",{}),(0,i.A)(this,"globalBlacklistUnverifiedDevices",!1),(0,i.A)(this,"globalErrorOnUnknownDevices",!0),(0,i.A)(this,"receivedRoomKeyRequests",[]),(0,i.A)(this,"receivedRoomKeyRequestCancellations",[]),(0,i.A)(this,"processingRoomKeyRequests",!1),(0,i.A)(this,"lazyLoadMembers",!1),(0,i.A)(this,"roomDeviceTrackingState",{}),(0,i.A)(this,"forceNewSessionRetryTime",new O.kG((()=>new O.kG((()=>0))))),(0,i.A)(this,"sendKeyRequestsImmediately",!1),(0,i.A)(this,"oneTimeKeyCount",void 0),(0,i.A)(this,"needsNewFallback",void 0),(0,i.A)(this,"fallbackCleanup",void 0),(0,i.A)(this,"onDeviceListUserCrossSigningUpdated",function(){var e=(0,r.A)((function*(e){if(e===u.userId){var t=u.deviceList.getStoredCrossSigningForUser(e),n=t?t.getId():null,r=u.crossSigningInfo.getId();r&&n&&r===n?yield u.checkOwnCrossSigningTrust():(u.storeTrustedSelfKeys(null),u.emit(Ft.KeysChanged,{}),u.emit(Ft.UserTrustStatusChanged,u.userId,u.checkUserTrust(e)))}else{yield u.checkDeviceVerifications(e);var i=u.deviceList.getStoredCrossSigningForUser(e);i&&(i.updateCrossSigningVerifiedBefore(u.checkUserTrust(e).isCrossSigningVerified()),u.deviceList.setRawStoredCrossSigningForUser(e,i.toStorage())),u.emit(Ft.UserTrustStatusChanged,e,u.checkUserTrust(e))}}));return function(t){return e.apply(this,arguments)}}()),(0,i.A)(this,"onMembership",((e,t,n)=>{try{this.onRoomMembership(e,t,n)}catch(e){c.v.error("Error handling membership change:",e)}})),(0,i.A)(this,"onToDeviceEvent",(e=>{try{c.v.log("received to-device ".concat(e.getType()," from: ")+"".concat(e.getSender()," id: ").concat(e.getContent()[s.wt])),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?this.secretStorage.onSecretReceived(e):"m.room_key.withheld"===e.getType()?this.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once(ne.OQ.Decrypted,(e=>{this.onToDeviceEvent(e)})))}catch(e){c.v.error("Error handling toDeviceEvent:",e)}})),(0,i.A)(this,"onTimelineEvent",(function(e,t,n,r){var{liveEvent:i=!0}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};_t.validateEvent(e,u.baseApis)&&u.handleVerificationEvent(e,u.inRoomVerificationRequests,(e=>{var t=new _t(u.baseApis,e.getRoomId());return new mt(t,u.verificationMethods,u.baseApis)}),i)})),c.v.debug("Crypto: initialising roomlist..."),this.roomList=new Rt(a),this.reEmitter=new l.Q(this),d)for(var h of(this.verificationMethods=new Map,d))"string"==typeof h?Mt[h]&&this.verificationMethods.set(h,Mt[h]):h.NAME?this.verificationMethods.set(h.NAME,h):c.v.warn("Excluding unknown verification method ".concat(h));else this.verificationMethods=new Map(Object.entries(Mt));this.backupManager=new It.IO(e,(0,r.A)((function*(){var e=yield u.getSessionBackupPrivateKey();if(e)return e;var t=yield u.secretStorage.get("m.megolm_backup.v1");if(t){var n=Gt(t);if(n){var r=yield u.secretStorage.getKey();yield u.secretStorage.store("m.megolm_backup.v1",n,[r[0]])}return(0,E.y4)(n||t)}if(u.baseApis.cryptoCallbacks&&u.baseApis.cryptoCallbacks.getBackupKey)return u.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")}))),this.olmDevice=new m(a),this.deviceList=new N(e,a,this.olmDevice),this.deviceList.on(Ft.UserCrossSigningUpdated,this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,[Ft.DevicesUpdated,Ft.WillUpdateDevices]),this.supportedAlgorithms=Array.from(F.keys()),this.outgoingRoomKeyRequestManager=new H(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new Ct,this.inRoomVerificationRequests=new Et;var p=this.baseApis.cryptoCallbacks||{},v=I(a,this.olmDevice);this.crossSigningInfo=new w(t,p,v),this.secretStorage=new he(e,p,e),this.dehydrationManager=new Tt.v(this),!p.getCrossSigningKey&&p.getSecretStorageKey&&(p.getCrossSigningKey=function(){var e=(0,r.A)((function*(e){return w.getFromSecretStorage(e,u.secretStorage)}));return function(t){return e.apply(this,arguments)}}())}init(){var e=arguments,t=this;return(0,r.A)((function*(){var{exportedOlmDevice:n,pickleKey:r}=e.length>0&&void 0!==e[0]?e[0]:{};c.v.log("Crypto: initialising Olm..."),yield globalThis.Olm.init(),c.v.log(n?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),yield t.olmDevice.init({fromExportedDevice:n,pickleKey:r}),c.v.log("Crypto: loading device list..."),yield t.deviceList.load(),t.deviceKeys["ed25519:"+t.deviceId]=t.olmDevice.deviceEd25519Key,t.deviceKeys["curve25519:"+t.deviceId]=t.olmDevice.deviceCurve25519Key,c.v.log("Crypto: fetching own devices...");var i=t.deviceList.getRawStoredDevicesForUser(t.userId);if(i||(i={}),!i[t.deviceId]){c.v.log("Crypto: adding this device to the store...");var o={keys:t.deviceKeys,algorithms:t.supportedAlgorithms,verified:Pt.VERIFIED,known:!0};i[t.deviceId]=o,t.deviceList.storeDevicesForUser(t.userId,i),t.deviceList.saveIfDirty()}yield t.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT],(e=>{t.cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(c.v.log("Loaded cross-signing public keys from crypto store"),t.crossSigningInfo.setKeys(e))}))})),t.deviceList.startTrackingDeviceList(t.userId),c.v.debug("Crypto: initialising roomlist..."),yield t.roomList.init(),c.v.log("Crypto: checking for key backup..."),t.backupManager.checkAndStart()}))()}setDeviceIsolationMode(e){throw new Error("Not supported")}getVersion(){var e=Bt.getOlmVersion();return"Olm ".concat(e[0],".").concat(e[1],".").concat(e[2])}getTrustCrossSignedDevices(){return this.trustCrossSignedDevices}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setTrustCrossSignedDevices(e){for(var t of(this.trustCrossSignedDevices=e,this.deviceList.getKnownUserIds())){var n=this.deviceList.getRawStoredDevicesForUser(t);for(var r of Object.keys(n)){var i=this.checkDeviceTrust(t,r);if(!i.isLocallyVerified()&&i.isCrossSigningVerified()){var o=this.deviceList.getStoredDevice(t,r);this.emit(Ft.DeviceVerificationChanged,t,r,o)}}}}setCryptoTrustCrossSignedDevices(e){this.setTrustCrossSignedDevices(e)}createRecoveryKeyFromPassphrase(e){return(0,r.A)((function*(){var t=new globalThis.Olm.PkDecryption;try{if(e){var n=yield(0,nt.SM)(e);t.init_with_private_key(n.key);var r=t.get_private_key();return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:n.iterations,salt:n.salt}},privateKey:r,encodedPrivateKey:(0,u.encodeRecoveryKey)(r)}}t.generate_key();var i=t.get_private_key();return{privateKey:i,encodedPrivateKey:(0,u.encodeRecoveryKey)(i)}}finally{null==t||t.free()}}))()}userHasCrossSigningKeys(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:t.userId;return yield t.downloadKeys([n]),null!==t.deviceList.getStoredCrossSigningForUser(n)}))()}isCrossSigningReady(){var e=this;return(0,r.A)((function*(){var t=e.crossSigningInfo.getId(),n=(yield e.crossSigningInfo.isStoredInKeyCache())||(yield e.crossSigningInfo.isStoredInSecretStorage(e.secretStorage));return!(!t||!n)}))()}isSecretStorageReady(){var e=this;return(0,r.A)((function*(){var t=yield e.secretStorage.hasKey(),n=yield e.crossSigningInfo.isStoredInSecretStorage(e.secretStorage),r=!e.backupManager.getKeyBackupEnabled()||(yield e.baseApis.isKeyBackupKeyStored());return!!(t&&n&&r)}))()}getCrossSigningStatus(){var e=this;return(0,r.A)((function*(){var t,n,r,i=Boolean(e.crossSigningInfo.getId()),o=Boolean(yield e.crossSigningInfo.isStoredInSecretStorage(e.secretStorage)),a=e.crossSigningInfo.getCacheCallbacks();return{publicKeysOnDevice:i,privateKeysInSecretStorage:o,privateKeysCachedLocally:{masterKey:Boolean(yield null===(t=a.getCrossSigningKeyCache)||void 0===t?void 0:t.call(a,"master")),selfSigningKey:Boolean(yield null===(n=a.getCrossSigningKeyCache)||void 0===n?void 0:n.call(a,"self_signing")),userSigningKey:Boolean(yield null===(r=a.getCrossSigningKeyCache)||void 0===r?void 0:r.call(a,"user_signing"))}}}))()}bootstrapCrossSigning(){var e=arguments,t=this;return(0,r.A)((function*(){var{authUploadDeviceSigningKeys:n,setupNewCrossSigning:i}=e.length>0&&void 0!==e[0]?e[0]:{};c.v.log("Bootstrapping cross-signing");var o=t.baseApis.cryptoCallbacks,a=new oe(t.baseApis.store.accountData,o),s=new w(t.userId,a.crossSigningCallbacks,a.crossSigningCallbacks),l=function(){var e=(0,r.A)((function*(){s.resetKeys(),yield t.signObject(s.keys.master),a.addCrossSigningKeys(n,s.keys);var e=t.deviceList.getStoredDevice(t.userId,t.deviceId),r=yield s.signDevice(t.userId,e);a.addKeySignature(t.userId,t.deviceId,r),t.backupManager.backupInfo&&(yield s.signObject(t.backupManager.backupInfo.auth_data,"master"),a.addSessionBackup(t.backupManager.backupInfo))}));return function(){return e.apply(this,arguments)}}(),d=t.crossSigningInfo.getId(),u=yield t.crossSigningInfo.isStoredInKeyCache(),h=yield t.crossSigningInfo.isStoredInSecretStorage(t.secretStorage),p=u||h;c.v.log({setupNewCrossSigning:i,publicKeysOnDevice:d,privateKeysInCache:u,privateKeysInStorage:h,privateKeysExistSomewhere:p}),!p||i?(c.v.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),yield l()):d&&u?c.v.log("Cross-signing public keys trusted and private keys found locally"):h&&(c.v.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),yield t.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));var v=a.crossSigningCallbacks.privateKeys;if(v.size&&!t.baseApis.cryptoCallbacks.saveCrossSigningKeys){var m=new de.ServerSideSecretStorageImpl(a.accountDataClientAdapter,a.ssssCryptoCallbacks);(yield m.hasKey())&&(c.v.log("Storing new cross-signing private keys in secret storage"),yield w.storeInSecretStorage(v,m))}var g=a.buildOperation();yield g.apply(t),yield a.persist(t),c.v.log("Cross-signing ready")}))()}bootstrapSecretStorage(){var e=arguments,t=this;return(0,r.A)((function*(){var{createSecretStorageKey:n=(0,r.A)((function*(){return{}})),keyBackupInfo:i,setupNewKeyBackup:o,setupNewSecretStorage:a,getKeyBackupPassphrase:s}=e.length>0&&void 0!==e[0]?e[0]:{};c.v.log("Bootstrapping Secure Secret Storage");var l=t.baseApis.cryptoCallbacks,d=new oe(t.baseApis.store.accountData,l),h=new de.ServerSideSecretStorageImpl(d.accountDataClientAdapter,d.ssssCryptoCallbacks),p=null,v=function(){var e=(0,r.A)((function*(e){var{keyId:t,keyInfo:n}=yield h.addKey(de.SECRET_STORAGE_ALGORITHM_V1_AES,e);return d.ssssCryptoCallbacks.addPrivateKey(t,n,e.key),yield h.setDefaultKeyId(t),t}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,r.A)((function*(e,n){if(!n.mac){var r,i,o=yield null===(r=(i=t.baseApis.cryptoCallbacks).getSecretStorageKey)||void 0===r?void 0:r.call(i,{keys:{[e]:n}},"");if(o){var a=o[1];d.ssssCryptoCallbacks.addPrivateKey(e,n,a);var{iv:s,mac:l}=yield(0,de.calculateKeyCheck)(a);n.iv=s,n.mac=l,yield d.setAccountData("m.secret_storage.key.".concat(e),n)}}}));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=(0,r.A)((function*(e){if(t.crossSigningInfo.getId()&&(yield t.crossSigningInfo.isStoredInKeyCache("master")))try{c.v.log("Adding cross-signing signature to key backup"),yield t.crossSigningInfo.signObject(e,"master")}catch(e){c.v.error("Signing key backup with cross-signing keys failed",e)}else c.v.warn("Cross-signing keys not available, skipping signature on key backup")}));return function(t){return e.apply(this,arguments)}}(),f=yield t.secretStorage.getKey(),[y,_]=f||[null,null],b=!a&&_&&_.algorithm===de.SECRET_STORAGE_ALGORITHM_V1_AES;if(c.v.log({keyBackupInfo:i,setupNewKeyBackup:o,setupNewSecretStorage:a,storageExists:b,oldKeyInfo:_}),b||i)if(!b&&i){c.v.log("Secret storage does not exist, using key backup key");var S=(yield t.getSessionBackupPrivateKey())||(yield null==s?void 0:s()),C={key:S};i.auth_data.private_key_salt&&i.auth_data.private_key_iterations&&(C.passphrase={algorithm:"m.pbkdf2",iterations:i.auth_data.private_key_iterations,salt:i.auth_data.private_key_salt,bits:256}),p=yield v(C),yield h.store("m.megolm_backup.v1",(0,E.WG)(S),[p]),yield g(i.auth_data),d.addSessionBackup(i)}else c.v.log("Secret storage exists"),_&&_.algorithm===de.SECRET_STORAGE_ALGORITHM_V1_AES&&(yield m(y,_));else{c.v.log("Secret storage does not exist, creating new storage key");var{keyInfo:A,privateKey:T}=yield n();p=yield v({passphrase:null==A?void 0:A.passphrase,key:T,name:null==A?void 0:A.name})}if(!t.baseApis.cryptoCallbacks.saveCrossSigningKeys&&(yield t.isCrossSigningReady())&&(p||!(yield t.crossSigningInfo.isStoredInSecretStorage(h)))){c.v.log("Copying cross-signing private keys from cache to secret storage");var I=yield t.crossSigningInfo.getCrossSigningKeysFromCache();yield w.storeInSecretStorage(I,h)}if(o&&!i){c.v.log("Creating new message key backup version");var k=yield t.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),O=(0,u.decodeRecoveryKey)(k.recovery_key);yield h.store("m.megolm_backup.v1",(0,E.WG)(O));var R={algorithm:k.algorithm,auth_data:k.auth_data};yield g(R.auth_data),yield t.signObject(R.auth_data),d.addSessionBackup(R)}var x=yield h.get("m.megolm_backup.v1");if(x){c.v.info("Got session backup key from secret storage: caching");var N=Gt(x);if(N){var D=p||y;yield h.store("m.megolm_backup.v1",N,D?[D]:null)}var L=new Uint8Array((0,E.y4)(N||x));d.addSessionBackupPrivateKeyToCache(L)}else if(t.backupManager.getKeyBackupEnabled()){var P=(yield t.getSessionBackupPrivateKey())||(yield null==s?void 0:s());if(!P)return void c.v.error("Key backup is enabled but couldn't get key backup key!");c.v.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),yield h.store("m.megolm_backup.v1",(0,E.WG)(P))}var M=d.buildOperation();yield M.apply(t),yield d.persist(t),c.v.log("Secure Secret Storage ready")}))()}resetKeyBackup(){var e=this;return(0,r.A)((function*(){yield e.backupManager.deleteAllKeyBackupVersions();var t=yield e.backupManager.prepareKeyBackupVersion();yield e.signObject(t.auth_data);var{version:n}=yield e.baseApis.http.authedRequest(re.IT.Post,"/room_keys/version",void 0,t,{prefix:re.iD.V3});c.v.log("Created backup version ".concat(n));var r=t.privateKey;yield e.secretStorage.store("m.megolm_backup.v1",(0,E.WG)(r)),yield e.storeSessionBackupPrivateKey(r),yield e.backupManager.checkAndStart(),yield e.backupManager.scheduleAllGroupSessionsForBackup()}))()}deleteKeyBackupVersion(e){var t=this;return(0,r.A)((function*(){yield t.backupManager.deleteKeyBackupVersion(e)}))()}addSecretStorageKey(e,t,n){return this.secretStorage.addKey(e,t,n)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,t,n){return this.secretStorage.store(e,t,n)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}checkSecretStoragePrivateKey(e,t){var n=null;try{return(n=new globalThis.Olm.PkDecryption).init_with_private_key(e)===t}finally{var r;null===(r=n)||void 0===r||r.free()}}getSessionBackupPrivateKey(){var e=this;return(0,r.A)((function*(){var t=yield new Promise((t=>{e.cryptoStore.doTxn("readonly",[d.y.STORE_ACCOUNT],(n=>{e.cryptoStore.getSecretStorePrivateKey(n,t,"m.megolm_backup.v1")}))})),n=null;if("string"==typeof t&&(n=new Uint8Array((0,E.y4)(Gt(t)||t)),yield e.storeSessionBackupPrivateKey(n)),t&&"object"==typeof t&&"ciphertext"in t){var r=Buffer.from(e.olmDevice.pickleKey),i=yield(0,S.A)(t,r,"m.megolm_backup.v1");n=(0,E.y4)(i)}return n}))()}storeSessionBackupPrivateKey(e,t){var n=this;return(0,r.A)((function*(){if(!(e instanceof Uint8Array))throw new Error("storeSessionBackupPrivateKey expects Uint8Array, got ".concat(e));var t=Buffer.from(n.olmDevice.pickleKey),r=yield(0,b.A)((0,E.WG)(e),t,"m.megolm_backup.v1");return n.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(e=>{n.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",r)}))}))()}loadSessionBackupPrivateKeyFromSecretStorage(){throw new Error("Not implmeented")}getActiveSessionBackupVersion(){var e=this;return(0,r.A)((function*(){var t;return e.backupManager.getKeyBackupEnabled()&&null!==(t=e.backupManager.version)&&void 0!==t?t:null}))()}getKeyBackupInfo(){return(0,r.A)((function*(){throw new Error("Not implemented")}))()}isKeyBackupTrusted(e){var t=this;return(0,r.A)((function*(){var n=yield t.backupManager.isKeyBackupTrusted(e);return(0,It.IG)(n)}))()}checkKeyBackupAndEnable(){var e=this;return(0,r.A)((function*(){var t=yield e.backupManager.checkKeyBackup();return t&&t.backupInfo?{backupInfo:t.backupInfo,trustInfo:(0,It.IG)(t.trustInfo)}:null}))()}checkCrossSigningPrivateKey(e,t){var n=null;try{return(n=new globalThis.Olm.PkSigning).init_with_seed(e)===t}finally{var r;null===(r=n)||void 0===r||r.free()}}afterCrossSigningLocalKeyChange(){var e=this;return(0,r.A)((function*(){c.v.info("Starting cross-signing key change post-processing");var t=e.deviceList.getStoredDevice(e.userId,e.deviceId),n=yield e.crossSigningInfo.signDevice(e.userId,t);c.v.info("Starting background key sig upload for ".concat(e.deviceId));var r=t=>{var{shouldEmit:i=!1}=t;return e.baseApis.uploadKeySignatures({[e.userId]:{[e.deviceId]:n}}).then((t=>{var{failures:n}=t||{};if(Object.keys(n||[]).length>0)throw i&&e.baseApis.emit(Ft.KeySignatureUploadFailure,n,"afterCrossSigningLocalKeyChange",r),new At.b0("Key upload failed",{failures:n});c.v.info("Finished background key sig upload for ".concat(e.deviceId))})).catch((t=>{c.v.error("Error during background key sig upload for ".concat(e.deviceId),t)}))};r({shouldEmit:!0});var i=e.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(i){c.v.info("Starting device verification upgrade");var o={};for(var[a,s]of Object.entries(e.deviceList.crossSigningInfo)){var l=yield e.checkForDeviceVerificationUpgrade(a,w.fromStorage(s,a));l&&(o[a]=l)}if(Object.keys(o).length>0){c.v.info("Found ".concat(Object.keys(o).length," verif users to upgrade"));try{var d=yield i({users:o});if(d)for(var u of d)u in o&&(yield e.baseApis.setDeviceVerified(u,o[u].crossSigningInfo.getId()))}catch(e){c.v.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}c.v.info("Finished device verification upgrade")}c.v.info("Finished cross-signing key change post-processing")}))()}checkForDeviceVerificationUpgrade(e,t){var n=this;return(0,r.A)((function*(){var r=n.crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!r.isVerified()){var i=n.deviceList.getRawStoredDevicesForUser(e),o=yield n.checkForValidDeviceSignature(e,t.keys.master,i);if(o.length)return{devices:o.map((e=>_.V.fromStorage(i[e],e))),crossSigningInfo:t}}}))()}checkForValidDeviceSignature(e,t,n){var i=this;return(0,r.A)((function*(){var r=[];if(n&&t.signatures&&t.signatures[e])for(var o of Object.keys(t.signatures[e])){var[,a]=o.split(":",2);if(a in n&&n[a].verified===Pt.VERIFIED)try{yield y.verifySignature(i.olmDevice,t,e,a,n[a].keys[o]),r.push(a)}catch(e){}}return r}))()}getCrossSigningKeyId(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe.n.Master;return Promise.resolve(this.getCrossSigningId(e))}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){var t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new u.UserVerificationStatus(!1,!1,!1)}getUserVerificationStatus(e){var t=this;return(0,r.A)((function*(){return t.checkUserTrust(e)}))()}pinCurrentUserIdentity(e){return(0,r.A)((function*(){throw new Error("not implemented")}))()}withdrawVerificationRequirement(e){return(0,r.A)((function*(){throw new Error("not implemented")}))()}getDeviceVerificationStatus(e,t){var n=this;return(0,r.A)((function*(){var r=n.deviceList.getStoredDevice(e,t);return r?n.checkDeviceInfoTrust(e,r):null}))()}checkDeviceTrust(e,t){var n=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,n)}checkDeviceInfoTrust(e,t){var n=!(null==t||!t.isVerified()),r=this.deviceList.getStoredCrossSigningForUser(e);if(t&&r){var i=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(r,t,n,i)}return new T(!1,!1,n,!1)}checkIfOwnDeviceCrossSigned(e){var t,n=this.deviceList.getStoredDevice(this.userId,e);if(!n)return!1;var r=this.deviceList.getStoredCrossSigningForUser(this.userId);return null!==(t=null==r?void 0:r.checkDeviceTrust(r,n,!1,!0).isCrossSigningVerified())&&void 0!==t&&t}checkOwnCrossSigningTrust(){var e=arguments,t=this;return(0,r.A)((function*(){var{allowPrivateKeyRequests:n=!1}=e.length>0&&void 0!==e[0]?e[0]:{},r=t.userId;yield t.downloadKeys([t.userId]);var i=yield t.crossSigningInfo.getCrossSigningKeysFromCache(),o=t.deviceList.getStoredCrossSigningForUser(r);if(o){var a=o.getId(),s=t.crossSigningInfo.getId()!==a,l=o.getId()&&!i.has("master");if(s&&c.v.info("Got new master public key",a),n&&(s||l)){c.v.info("Attempting to retrieve cross-signing master private key");var d=null;try{d=(yield t.crossSigningInfo.getCrossSigningKey("master",a))[1],c.v.info("Got cross-signing master private key")}finally{var u;null===(u=d)||void 0===u||u.free()}}var h=t.crossSigningInfo.getId("self_signing"),p=t.crossSigningInfo.getId("user_signing");t.storeTrustedSelfKeys(o.keys);var v=h!==o.getId("self_signing"),m=p!==o.getId("user_signing"),g=o.getId("self_signing")&&!i.has("self_signing"),f=o.getId("user_signing")&&!i.has("user_signing"),y={};if(v&&c.v.info("Got new self-signing key",o.getId("self_signing")),n&&(v||g)){c.v.info("Attempting to retrieve cross-signing self-signing private key");var _=null;try{_=(yield t.crossSigningInfo.getCrossSigningKey("self_signing",o.getId("self_signing")))[1],c.v.info("Got cross-signing self-signing private key")}finally{var E;null===(E=_)||void 0===E||E.free()}var b=t.deviceList.getStoredDevice(t.userId,t.deviceId),S=yield t.crossSigningInfo.signDevice(t.userId,b);y[t.deviceId]=S}if(m&&c.v.info("Got new user-signing key",o.getId("user_signing")),n&&(m||f)){c.v.info("Attempting to retrieve cross-signing user-signing private key");var C=null;try{C=(yield t.crossSigningInfo.getCrossSigningKey("user_signing",o.getId("user_signing")))[1],c.v.info("Got cross-signing user-signing private key")}finally{var w;null===(w=C)||void 0===w||w.free()}}if(s){var A=t.crossSigningInfo.keys.master;yield t.signObject(A);var T=A.signatures[t.userId]["ed25519:"+t.deviceId];y[t.crossSigningInfo.getId()]=Object.assign({},A,{signatures:{[t.userId]:{["ed25519:"+t.deviceId]:T}}})}var I=Object.keys(y);if(I.length){var k=e=>{var{shouldEmit:n=!1}=e;return c.v.info("Starting background key sig upload for ".concat(I)),t.baseApis.uploadKeySignatures({[t.userId]:y}).then((e=>{var{failures:r}=e||{};if(c.v.info("Finished background key sig upload for ".concat(I)),Object.keys(r||[]).length>0)throw n&&t.baseApis.emit(Ft.KeySignatureUploadFailure,r,"checkOwnCrossSigningTrust",k),new At.b0("Key upload failed",{failures:r})})).catch((e=>{c.v.error("Error during background key sig upload for ".concat(I),e)}))};k({shouldEmit:!0})}t.emit(Ft.UserTrustStatusChanged,r,t.checkUserTrust(r)),s&&(t.emit(Ft.KeysChanged,{}),yield t.afterCrossSigningLocalKeyChange()),yield t.backupManager.checkKeyBackup()}else c.v.error("Got cross-signing update event for user "+r+" but no new cross-signing information found!")}))()}getBackupDecryptor(e,t){return(0,r.A)((function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor expects Uint8Array");var n=yield It.IO.makeAlgorithm(e,(0,r.A)((function*(){return t})));return(yield n.keyMatches(t))?new It.M7(n):Promise.reject(new re.up({errcode:ie.pB.RESTORE_BACKUP_ERROR_BAD_KEY}))}))()}importBackedUpRoomKeys(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.source="backup",this.importRoomKeys(e,n)}storeTrustedSelfKeys(e){var t=this;return(0,r.A)((function*(){e?t.crossSigningInfo.setKeys(e):t.crossSigningInfo.clearKeys(),yield t.cryptoStore.doTxn("readwrite",[d.y.STORE_ACCOUNT],(e=>{t.cryptoStore.storeCrossSigningKeys(e,t.crossSigningInfo.keys)}))}))()}checkDeviceVerifications(e){var t=this;return(0,r.A)((function*(){var n=t.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n){if(c.v.info("Starting device verification upgrade for ".concat(e)),t.crossSigningInfo.keys.user_signing){var r=t.deviceList.getStoredCrossSigningForUser(e);if(r){var i=yield t.checkForDeviceVerificationUpgrade(e,r);i&&(yield n({users:{[e]:i}})).includes(e)&&(yield t.baseApis.setDeviceVerified(e,r.getId()))}}c.v.info("Finished device verification upgrade for ".concat(e))}}))()}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on(Ot.o.Membership,this.onMembership),e.on(ie.AU.ToDeviceEvent,this.onToDeviceEvent),e.on(kt.u9.Timeline,this.onTimelineEvent),e.on(ne.OQ.Decrypted,this.onTimelineEvent)}start(){c.v.warn("MatrixClient.crypto.start() is deprecated")}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop(),this.backupManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}getOwnDeviceKeys(){var e=this;return(0,r.A)((function*(){if(!e.olmDevice.deviceCurve25519Key)throw new Error("Curve25519 key not yet created");if(!e.olmDevice.deviceEd25519Key)throw new Error("Ed25519 key not yet created");return{ed25519:e.olmDevice.deviceEd25519Key,curve25519:e.olmDevice.deviceCurve25519Key}}))()}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}uploadDeviceKeys(){var e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then((()=>this.baseApis.uploadKeysRequest({device_keys:e})))}getNeedsNewFallback(){return!!this.needsNewFallback}maybeUploadOneTimeKeys(){var e=this;if(!this.oneTimeKeyCheckInProgress){var t=Date.now();if(!(null!==this.lastOneTimeKeyCheck&&t-this.lastOneTimeKeyCheck<6e4)){this.lastOneTimeKeyCheck=t;var n=this.olmDevice.maxNumberOfOneTimeKeys(),i=Math.floor(n/2),o=function(){var t=(0,r.A)((function*(t){for(;i>t||e.getNeedsNewFallback();){if(i>t){c.v.info("generating oneTimeKeys");var n=Math.min(i-t,5);yield e.olmDevice.generateOneTimeKeys(n)}if(e.getNeedsNewFallback()){var r=yield e.olmDevice.getFallbackKey();r.curve25519&&0!=Object.keys(r.curve25519).length||(c.v.info("generating fallback key"),e.fallbackCleanup&&(clearTimeout(e.fallbackCleanup),delete e.fallbackCleanup),yield e.olmDevice.generateFallbackKey())}c.v.info("calling uploadOneTimeKeys");var o=yield e.uploadOneTimeKeys();if(!o.one_time_key_counts||!o.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");t=o.one_time_key_counts.signed_curve25519}}));return function(e){return t.apply(this,arguments)}}();this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((e=>o(e))).catch((e=>{c.v.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1}))}}}uploadOneTimeKeys(){var e=this;return(0,r.A)((function*(){var t,n=[];if(e.getNeedsNewFallback()){t={};var r=yield e.olmDevice.getFallbackKey();for(var[i,o]of Object.entries(r.curve25519)){var a={key:o,fallback:!0};t["signed_curve25519:"+i]=a,n.push(e.signObject(a))}e.needsNewFallback=!1}var s=yield e.olmDevice.getOneTimeKeys(),l={};for(var c in s.curve25519)if(s.curve25519.hasOwnProperty(c)){var d={key:s.curve25519[c]};l["signed_curve25519:"+c]=d,n.push(e.signObject(d))}yield Promise.all(n);var u={one_time_keys:l};t&&(u["org.matrix.msc2732.fallback_keys"]=t,u.fallback_keys=t);var h=yield e.baseApis.uploadKeysRequest(u);return t&&(e.fallbackCleanup=setTimeout((()=>{delete e.fallbackCleanup,e.olmDevice.forgetOldFallbackKey()}),36e5)),yield e.olmDevice.markKeysAsPublished(),h}))()}downloadKeys(e,t){return this.deviceList.downloadKeys(e,!!t)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}getUserDeviceInfo(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=new Map,o=[],a=function*(e){var t=yield n.getStoredDevicesForUser(e);if(t){var r=new Map(t.map((t=>[t.deviceId,Dt(t,e)])));i.set(e,r)}else o.push(e)};for(var s of e)yield*a(s);return r&&o.length>0&&(yield n.downloadKeys(o)).forEach(((e,t)=>{var n=new Map;e.forEach(((e,r)=>n.set(r,Dt(e,t)))),i.set(t,n)})),i}))()}getStoredDevice(e,t){return this.deviceList.getStoredDevice(e,t)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}setDeviceVerified(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var r=!(n.length>2&&void 0!==n[2])||n[2];yield i.setDeviceVerification(e,t,r)}))()}crossSignDevice(e){var t=this;return(0,r.A)((function*(){yield t.setDeviceVerified(t.userId,e,!0)}))()}setDeviceVerification(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var o=n.length>2&&void 0!==n[2]?n[2]:null,a=n.length>3&&void 0!==n[3]?n[3]:null,s=n.length>4&&void 0!==n[4]?n[4]:null,l=n.length>5?n[5]:void 0,d=i.deviceList.getStoredCrossSigningForUser(e);if((null==d?void 0:d.getId())===t){if(null!==a||null!==s)throw new Error("Cannot set blocked or known for a cross-signing key");if(!o)throw new Error("Cannot set a cross-signing key as unverified");var u=l?Object.values(l)[0]:null;if(l&&(1!==Object.values(l).length||u!==d.getId()))throw new Error("Key did not match expected value: expected ".concat(d.getId(),", got ").concat(u));if(i.crossSigningInfo.getId()||e!==i.crossSigningInfo.userId||(i.storeTrustedSelfKeys(d.keys),i.emit(Ft.UserTrustStatusChanged,i.userId,i.checkUserTrust(e))),e!==i.userId){c.v.info("Master key "+d.getId()+" for "+e+" marked verified. Signing...");var h=yield i.crossSigningInfo.signUser(d);if(h){var p=function(){var n=(0,r.A)((function*(n){var{shouldEmit:r=!1}=n;c.v.info("Uploading signature for "+e+"...");var o=yield i.baseApis.uploadKeySignatures({[e]:{[t]:h}}),{failures:a}=o||{};if(Object.keys(a||[]).length>0)throw r&&i.baseApis.emit(Ft.KeySignatureUploadFailure,a,"setDeviceVerification",p),new At.b0("Key upload failed",{failures:a})}));return function(e){return n.apply(this,arguments)}}();yield p({shouldEmit:!0})}return h}return d}var v=i.deviceList.getRawStoredDevicesForUser(e);if(!v||!v[t])throw new Error("Unknown device "+e+":"+t);var m=v[t],g=m.verified;if(o){if(l)for(var[f,y]of Object.entries(l))if(m.keys[f]!==y)throw new Error("Key did not match expected value: expected ".concat(y,", got ").concat(m.keys[f]));g=Pt.VERIFIED}else null!==o&&g==Pt.VERIFIED&&(g=Pt.UNVERIFIED);a?g=Pt.BLOCKED:null!==a&&g==Pt.BLOCKED&&(g=Pt.UNVERIFIED);var E,b=m.known;if(null!==s&&(b=s),m.verified===g&&m.known===b||(m.verified=g,m.known=b,i.deviceList.storeDevicesForUser(e,v),i.deviceList.saveIfDirty()),o&&e===i.userId&&(c.v.info("Own device "+t+" marked verified: signing"),i.checkDeviceTrust(e,t).isCrossSigningVerified()?c.v.log("Own device ".concat(t," already cross-signing verified")):E=yield i.crossSigningInfo.signDevice(e,_.V.fromStorage(m,t)),E)){var S=function(){var n=(0,r.A)((function*(n){var{shouldEmit:r=!1}=n;c.v.info("Uploading signature for "+t);var o=yield i.baseApis.uploadKeySignatures({[e]:{[t]:E}}),{failures:a}=o||{};if(Object.keys(a||[]).length>0)throw r&&i.baseApis.emit(Ft.KeySignatureUploadFailure,a,"setDeviceVerification",S),new At.b0("Key upload failed",{failures:a})}));return function(e){return n.apply(this,arguments)}}();yield S({shouldEmit:!0})}var C=_.V.fromStorage(m,t);return i.emit(Ft.DeviceVerificationChanged,e,t,C),C}))()}findVerificationRequestDMInProgress(e,t){return this.inRoomVerificationRequests.findRequestInProgress(e,t)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,t){var n=this.inRoomVerificationRequests.findRequestInProgress(t);if(n)return Promise.resolve(n);var r=new _t(this.baseApis,t,e);return this.requestVerificationWithChannel(e,r,this.inRoomVerificationRequests)}requestVerification(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));var n=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(n)return Promise.resolve(n);var r=new St(this.baseApis,e,t,St.makeTransactionId());return this.requestVerificationWithChannel(e,r,this.toDeviceVerificationRequests)}requestOwnUserVerification(){return this.requestVerification(this.userId)}requestDeviceVerification(e,t){return this.requestVerification(e,[t])}requestVerificationWithChannel(e,t,n){var i=this;return(0,r.A)((function*(){var e=new mt(t,i.verificationMethods,i.baseApis);t.transactionId&&n.setRequestByChannel(t,e),yield e.sendRequest();var r=n.getRequestByChannel(t);return r?e=r:(c.v.log("Crypto: adding new request to "+"requestsByTxnId with id ".concat(t.transactionId," ").concat(t.roomId)),n.setRequestByChannel(t,e)),e}))()}beginKeyVerification(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i){if(!(r=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,i)))throw new Error("No request found for user ".concat(t," with ")+"transactionId ".concat(i))}else{i=St.makeTransactionId();var o=new St(this.baseApis,t,[n],i,n);r=new mt(o,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,i,r)}return r.beginKeyVerification(e,{userId:t,deviceId:n})}legacyDeviceVerification(e,t,n){var i=this;return(0,r.A)((function*(){var r=St.makeTransactionId(),o=new St(i.baseApis,e,[t],r,t),a=new mt(o,i.verificationMethods,i.baseApis);i.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,r,a);var s=a.beginKeyVerification(n,{userId:e,deviceId:t});return yield Promise.race([s.verify(),a.waitFor((e=>e.started))]),a}))()}getOlmSessionsForUser(e){var t=this;return(0,r.A)((function*(){var n=t.getStoredDevicesForUser(e)||[],r={};for(var i of n){var o=i.getIdentityKey(),a=yield t.olmDevice.getSessionInfoForDevice(o);r[i.deviceId]={deviceIdKey:o,sessions:a}}return r}))()}getEventSenderDeviceInfo(e){var t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.isKeySourceUntrusted())return null;var r=this.deviceList.getDeviceByIdentityKey(n,t);if(null===r)return null;var i=e.getClaimedEd25519Key();return i?i!==r.getFingerprint()?(c.v.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+r.getFingerprint()),null):r:(c.v.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){var t,n,r={};if(r.senderKey=null!==(t=e.getSenderKey())&&void 0!==t?t:void 0,r.algorithm=e.getWireContent().algorithm,!r.senderKey||!r.algorithm)return r.encrypted=!1,r;r.encrypted=!0,e.isKeySourceUntrusted()?r.authenticated=!1:r.authenticated=!0,r.sender=null!==(n=this.deviceList.getDeviceByIdentityKey(r.algorithm,r.senderKey))&&void 0!==n?n:void 0;var i=e.getClaimedEd25519Key();return i||(c.v.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),r.mismatchedSender=!0),r.sender&&i!==r.sender.getFingerprint()&&(c.v.warn("Event "+e.getId()+" claims ed25519 key "+i+"but sender device has key "+r.sender.getFingerprint()),r.mismatchedSender=!0),r}getEncryptionInfoForEvent(e){var t=this;return(0,r.A)((function*(){var n=t.getEventEncryptionInfo(e);if(!n.encrypted)return null;var r=e.getSender();if(!r||n.mismatchedSender)return{shieldColour:u.EventShieldColour.RED,shieldReason:u.EventShieldReason.MISMATCHED_SENDER_KEY};if(!t.checkUserTrust(r).isCrossSigningVerified())return n.authenticated?{shieldColour:u.EventShieldColour.NONE,shieldReason:null}:{shieldColour:u.EventShieldColour.GREY,shieldReason:u.EventShieldReason.AUTHENTICITY_NOT_GUARANTEED};var i=r&&n.sender&&(yield t.getDeviceVerificationStatus(r,n.sender.deviceId));return i?i.isVerified()?n.authenticated?{shieldColour:u.EventShieldColour.NONE,shieldReason:null}:{shieldColour:u.EventShieldColour.GREY,shieldReason:u.EventShieldReason.AUTHENTICITY_NOT_GUARANTEED}:{shieldColour:u.EventShieldColour.RED,shieldReason:u.EventShieldReason.UNSIGNED_DEVICE}:{shieldColour:u.EventShieldColour.GREY,shieldReason:u.EventShieldReason.UNKNOWN_DEVICE}}))()}forceDiscardSession(e){var t=this.roomEncryptors.get(e);if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");return t.forceDiscardSession(),Promise.resolve()}setRoomEncryption(e,t,n){var i=this;return(0,r.A)((function*(){var r=i.clientStore.getRoom(e);if(!r)throw new Error("Unable to enable encryption tracking devices in unknown room ".concat(e));yield i.setRoomEncryptionImpl(r,t),i.lazyLoadMembers||n||i.deviceList.refreshOutdatedDeviceLists()}))()}setRoomEncryptionImpl(e,t){var n=this;return(0,r.A)((function*(){var r=e.roomId;if(t.algorithm){var i=n.roomList.getRoomEncryption(r);if(i&&JSON.stringify(i)!=JSON.stringify(t))c.v.error("Ignoring m.room.encryption event which requests a change of config in "+r);else if(!n.roomEncryptors.get(r)){var o=null;i||(o=n.roomList.setRoomEncryption(r,t));var a=U.get(t.algorithm);if(!a)throw new Error("Unable to encrypt with "+t.algorithm);var s=new a({userId:n.userId,deviceId:n.deviceId,crypto:n,olmDevice:n.olmDevice,baseApis:n.baseApis,roomId:r,config:t});if(n.roomEncryptors.set(r,s),o&&(yield o),c.v.log("Enabling encryption in ".concat(r)),e.membersLoaded())yield n.trackRoomDevicesImpl(e);else{var l=t=>{e.off(xt.f.Update,l),e.membersLoaded()&&n.trackRoomDevicesImpl(e).catch((e=>{c.v.error("Error enabling device tracking in ".concat(r),e)}))};e.on(xt.f.Update,l)}}}else c.v.log("Ignoring setRoomEncryption with no algorithm")}))()}trackRoomDevices(e){var t=this.clientStore.getRoom(e);if(!t)throw new Error("Unable to start tracking devices in unknown room ".concat(e));return this.trackRoomDevicesImpl(t)}trackRoomDevicesImpl(e){var t=this,n=e.roomId,i=function(){var i=(0,r.A)((function*(){t.roomEncryptors.has(n)&&(c.v.log("Starting to track devices for room ".concat(n," ...")),(yield e.getEncryptionTargetMembers()).forEach((e=>{t.deviceList.startTrackingDeviceList(e.userId)})))}));return function(){return i.apply(this,arguments)}}(),o=this.roomDeviceTrackingState[n];return o||(o=i(),this.roomDeviceTrackingState[n]=o.catch((e=>{throw delete this.roomDeviceTrackingState[n],e}))),o}ensureOlmSessionsForUsers(e,t){var n=new Map;for(var r of e){var i=[];n.set(r,i);var o=this.getStoredDevicesForUser(r)||[];for(var a of o)a.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&a.verified!=Pt.BLOCKED&&i.push(a)}return y.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,n,t)}exportRoomKeys(){var e=this;return(0,r.A)((function*(){var t=[];return yield e.cryptoStore.doTxn("readonly",[d.y.STORE_INBOUND_GROUP_SESSIONS],(n=>{e.cryptoStore.getAllEndToEndInboundGroupSessions(n,(n=>{if(null!==n){var r=e.olmDevice.exportInboundGroupSession(n.senderKey,n.sessionId,n.sessionData);delete r.first_known_index,r.algorithm=y.MEGOLM_ALGORITHM,t.push(r)}}))})),t}))()}exportRoomKeysAsJson(){var e=this;return(0,r.A)((function*(){return JSON.stringify(yield e.exportRoomKeys())}))()}importRoomKeys(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,r=0,i=e.length;function o(){var e;null===(e=t.progressCallback)||void 0===e||e.call(t,{stage:"load_keys",successes:n,failures:r,total:i})}return Promise.all(e.map((e=>e.room_id&&e.algorithm?this.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((()=>{n++,t.progressCallback&&o()})):(c.v.warn("ignoring room key entry with missing fields",e),r++,t.progressCallback&&o(),null)))).then()}importRoomKeysAsJson(e,t){var n=this;return(0,r.A)((function*(){return yield n.importRoomKeys(JSON.parse(e))}))()}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){var t=this.roomEncryptors.get(e.roomId);t&&t.prepareToEncrypt(e)}encryptEvent(e,t){var n=this;return(0,r.A)((function*(){var r=e.getRoomId(),i=n.roomEncryptors.get(r);if(!i)throw new Error("Room "+r+" was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");yield n.trackRoomDevicesImpl(t);var o=e.getContent(),a=o["m.relates_to"];a&&delete(o=Object.assign({},o))["m.relates_to"];var s=o["io.element.performance_metrics"];s&&delete(o=Object.assign({},o))["io.element.performance_metrics"];var l=yield i.encryptMessage(t,e.getType(),o);a&&(l["m.relates_to"]=a),s&&(l["io.element.performance_metrics"]=s),e.makeEncrypted("m.room.encrypted",l,n.olmDevice.deviceCurve25519Key,n.olmDevice.deviceEd25519Key)}))()}decryptEvent(e){var t=this;return(0,r.A)((function*(){if(e.isRedacted()){var n=new ne.kl(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({room_id:e.getRoomId()},e.getUnsigned().redacted_because)),r=e.getUnsigned().redacted_because;if(n.isEncrypted())try{r=(yield t.decryptEvent(n)).clearEvent}catch(e){c.v.warn("Decryption of redaction failed. Falling back to unencrypted event.",e)}return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:r}}}}var o=e.getWireContent();return t.getRoomDecryptor(e.getRoomId(),o.algorithm).decryptEvent(e)}))()}processDeviceLists(e){var t=this;return(0,r.A)((function*(){yield t.evalDeviceListChanges(e)}))()}requestRoomKey(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,n).then((()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{c.v.error("Error requesting key for event",e)}))}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{c.v.warn("Error clearing pending room key requests",e)}))}cancelAndResendAllOutgoingKeyRequests(){var e=this;return(0,r.A)((function*(){yield e.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}))()}onCryptoEvent(e,t){var n=this;return(0,r.A)((function*(){var r=t.getContent();yield n.setRoomEncryptionImpl(e,r)}))()}onSyncWillProcess(e){var t=this;return(0,r.A)((function*(){e.oldSyncToken||(c.v.log("Initial sync performed - resetting device tracking state"),t.deviceList.stopTrackingAllDeviceLists(),t.deviceList.startTrackingDeviceList(t.userId),t.roomDeviceTrackingState={}),t.sendKeyRequestsImmediately=!1}))()}onSyncCompleted(e){var t=this;return(0,r.A)((function*(){var n;t.deviceList.setSyncToken(null!==(n=e.nextSyncToken)&&void 0!==n?n:null),t.deviceList.saveIfDirty(),t.deviceList.startTrackingDeviceList(t.userId),t.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(t.maybeUploadOneTimeKeys(),t.processReceivedRoomKeyRequests(),t.outgoingRoomKeyRequestManager.sendQueuedRequests(),t.sendKeyRequestsImmediately=!0)}))()}evalDeviceListChanges(e){var t=this;return(0,r.A)((function*(){if(Array.isArray(null==e?void 0:e.changed)&&e.changed.forEach((e=>{t.deviceList.invalidateUserDeviceList(e)})),Array.isArray(null==e?void 0:e.left)&&e.left.length){var n=new Set(yield t.getTrackedE2eUsers());e.left.forEach((e=>{n.has(e)||t.deviceList.stopTrackingDeviceList(e)}))}}))()}getTrackedE2eUsers(){var e=this;return(0,r.A)((function*(){var t=[];for(var n of e.getTrackedE2eRooms()){var r=yield n.getEncryptionTargetMembers();for(var i of r)t.push(i.userId)}return t}))()}getTrackedE2eRooms(){return this.clientStore.getRooms().filter((e=>{if(!this.roomEncryptors.get(e.roomId))return!1;if(!this.roomDeviceTrackingState[e.roomId])return!1;var t=e.getMyMembership();return t===J.O.Join||t===J.O.Invite}))}encryptAndSendToDevices(e,t){var n=this;return(0,r.A)((function*(){try{var r=yield n.prepareToDeviceBatch(e,t);try{yield n.baseApis.queueToDevice(r)}catch(e){throw c.v.error("sendToDevice failed",e),e}}catch(e){throw c.v.error("encryptAndSendToDevices promises failed",e),e}}))()}prepareToDeviceBatch(e,t){var n=this;return(0,r.A)((function*(){var i={eventType:s.Bx.RoomMessageEncrypted,batch:[]};return yield Promise.all(e.map(function(){var e=(0,r.A)((function*(e){var{userId:r,deviceInfo:o}=e,l=o.deviceId,c={algorithm:y.OLM_ALGORITHM,sender_key:n.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};i.batch.push({userId:r,deviceId:l,payload:c}),yield y.ensureOlmSessionsForDevices(n.olmDevice,n.baseApis,new Map([[r,[o]]])),yield y.encryptMessageForDevice(c.ciphertext,n.userId,n.deviceId,n.olmDevice,r,o,t)}));return function(t){return e.apply(this,arguments)}}())),i.batch=i.batch.filter((e=>Object.keys(e.payload.ciphertext).length>0||(c.v.log("No ciphertext for device ".concat(e.userId,":").concat(e.deviceId,": pruning")),!1))),i}))()}encryptToDeviceMessages(e,t,n){var i=this;return(0,r.A)((function*(){var e=new Set(t.map((e=>{var{userId:t}=e;return t}))),r=yield i.downloadKeys(Array.from(e),!1),o=[];return t.forEach((e=>{var{userId:t,deviceId:n}=e,i=r.get(t);i?i.has(n)?o.push({userId:t,deviceInfo:i.get(n)}):c.v.warn("No device found for user ".concat(t," with id ").concat(n)):c.v.warn("No devices found for user ".concat(t))})),i.prepareToDeviceBatch(o,n)}))()}preprocessToDeviceMessages(e){return(0,r.A)((function*(){return e.filter((e=>{var t;return!(e.type===s.Bx.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes(null===(t=e.content)||void 0===t?void 0:t.algorithm)&&(c.v.log("Ignoring invalid encrypted to-device event from "+e.sender),1))}))}))()}updateOneTimeKeyCount(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}processKeyCounts(e,t){return void 0!==e&&this.updateOneTimeKeyCount(e.signed_curve25519||0),void 0!==t&&(this.needsNewFallback=!t.includes("signed_curve25519")),Promise.resolve()}onRoomKeyEvent(e){var t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):c.v.error("key event is missing fields")}onRoomKeyWithheldEvent(e){var t=e.getContent();if(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key){c.v.info("Got room key withheld event from ".concat(e.getSender()," ")+"for ".concat(t.algorithm," session ").concat(t.sender_key,"|").concat(t.session_id," ")+"in room ".concat(t.room_id," with code ").concat(t.code," (").concat(t.reason,")"));var n=this.getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){var r=this.getRoomDecryptors(t.algorithm);for(var i of r)i.retryDecryptionFromSender(t.sender_key)}}else c.v.error("key withheld event is missing fields")}onKeyVerificationMessage(e){St.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(e=>{if(St.canCreateRequest(St.getEventType(e))){var t=e.getContent(),n=t&&t.from_device;if(n){var r=e.getSender(),i=new St(this.baseApis,r,[n]);return new mt(i,this.verificationMethods,this.baseApis)}}}))}handleVerificationEvent(e,t,n){var i=arguments,o=this;return(0,r.A)((function*(){var r,a,s=!(i.length>3&&void 0!==i[3])||i[3];if(e.isSending()&&e.status!=ne.fb.SENT)try{yield new Promise(((t,n)=>{r=t,a=()=>{e.status==ne.fb.CANCELLED&&n(new Error("Event status set to CANCELLED."))},e.once(ne.OQ.LocalEventIdReplaced,r),e.on(ne.OQ.Status,a)}))}catch(e){return void c.v.error("error while waiting for the verification event to be sent: ",e)}finally{e.removeListener(ne.OQ.LocalEventIdReplaced,r),e.removeListener(ne.OQ.Status,a)}var l=t.getRequest(e),d=!1;if(!l){if(!(l=n(e)))return void c.v.log("Crypto: could not find VerificationRequest for "+"".concat(e.getType(),", and could not create one, so ignoring."));d=!0,t.setRequest(e,l)}e.setVerificationRequest(l);try{yield l.channel.handleEvent(e,l,s)}catch(e){c.v.error("error while handling verification event",e)}d&&!l.initiatedByMe&&!l.invalid&&!l.observeOnly&&(o.baseApis.emit(Ft.VerificationRequest,l),o.baseApis.emit(Ft.VerificationRequestReceived,l))}))()}onToDeviceBadEncrypted(e){var t=this;return(0,r.A)((function*(){var n=e.getWireContent(),r=e.getSender(),i=n.algorithm,o=n.sender_key;t.baseApis.emit(ie.AU.UndecryptableToDeviceEvent,e);var l=()=>{var e=t.getRoomDecryptors(y.MEGOLM_ALGORITHM);for(var n of e)n.retryDecryptionFromSender(o)};if(void 0!==r&&void 0!==o&&void 0!==o){var d=t.forceNewSessionRetryTime.getOrCreate(r),u=d.getOrCreate(o);if(u>Date.now())return c.v.debug("New session already forced with device ".concat(r,":").concat(o,": ")+"not forcing another until at least ".concat(new Date(u).toUTCString())),yield t.olmDevice.recordSessionProblem(o,"wedged",!0),void l();d.set(o,Date.now()+3e5);var h=t.deviceList.getDeviceByIdentityKey(i,o);if(!(h||(yield t.downloadKeys([r],!1),h=t.deviceList.getDeviceByIdentityKey(i,o))))return c.v.info("Couldn't find device for identity key "+o+": not re-establishing session"),yield t.olmDevice.recordSessionProblem(o,"wedged",!1),void l();var p=new Map([[r,[h]]]);yield y.ensureOlmSessionsForDevices(t.olmDevice,t.baseApis,p,!0),d.set(o,Date.now()+36e5);var v={algorithm:y.OLM_ALGORITHM,sender_key:t.olmDevice.deviceCurve25519Key,ciphertext:{},[s.wt]:(0,a.A)()};yield y.encryptMessageForDevice(v.ciphertext,t.userId,t.deviceId,t.olmDevice,r,h,{type:"m.dummy"}),yield t.olmDevice.recordSessionProblem(o,"wedged",!0),l(),yield t.baseApis.sendToDevice("m.room.encrypted",new Map([[r,new Map([[h.deviceId,v]])]]));var m=yield t.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,h.deviceId);for(var g of m)t.requestRoomKey(g.requestBody,g.recipients,!0)}}))()}onRoomMembership(e,t,n){var r,i=t.roomId,o=this.roomEncryptors.get(i);o&&(i in this.roomDeviceTrackingState&&(t.membership==J.O.Join?(c.v.log("Join event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId)):t.membership==J.O.Invite&&null!==(r=this.clientStore.getRoom(i))&&void 0!==r&&r.shouldEncryptForInvitedMembers()&&(c.v.log("Invite event for "+t.userId+" in "+i),this.deviceList.startTrackingDeviceList(t.userId))),o.onRoomMembership(e,t,n))}onRoomKeyRequestEvent(e){var t=e.getContent();if("request"===t.action){var n=new $t(e);this.receivedRoomKeyRequests.push(n)}else if("request_cancellation"===t.action){var r=new Vt(e);this.receivedRoomKeyRequestCancellations.push(r)}}processReceivedRoomKeyRequests(){var e=this;return(0,r.A)((function*(){if(!e.processingRoomKeyRequests){e.processingRoomKeyRequests=!0;try{var t=e.receivedRoomKeyRequests;e.receivedRoomKeyRequests=[];var n=e.receivedRoomKeyRequestCancellations;e.receivedRoomKeyRequestCancellations=[],yield Promise.all(t.map((t=>e.processReceivedRoomKeyRequest(t)))),yield Promise.all(n.map((t=>e.processReceivedRoomKeyRequestCancellation(t))))}catch(e){c.v.error("Error processing room key requsts: ".concat(e))}finally{e.processingRoomKeyRequests=!1}}}))()}processReceivedRoomKeyRequest(e){var t=this;return(0,r.A)((function*(){var n=e.userId,r=e.deviceId,i=e.requestBody,o=i.room_id,a=i.algorithm;if(c.v.log("m.room_key_request from ".concat(n,":").concat(r)+" for ".concat(o," / ").concat(i.session_id," (id ").concat(e.requestId,")")),n===t.userId)if(r!==t.deviceId)if(t.roomDecryptors.has(o)){var s=t.roomDecryptors.get(o).get(a);if(s)if(yield s.hasKeysForKeyRequest(e)){if(e.share=()=>{s.shareKeysWithDevice(e)},t.checkDeviceTrust(n,r).isVerified())return c.v.log("device is already verified: sharing keys"),void e.share();t.emit(Ft.RoomKeyRequest,e)}else c.v.log("room key request for unknown session ".concat(o," / ")+i.session_id);else c.v.log("room key request for unknown alg ".concat(a," in room ").concat(o))}else c.v.log("room key request for unencrypted room ".concat(o));else c.v.log("Ignoring room key request from ourselves");else{if(!t.roomEncryptors.get(o))return void c.v.debug("room key request for unencrypted room ".concat(o));var l=t.roomEncryptors.get(o),d=t.deviceList.getStoredDevice(n,r);if(!d)return void c.v.debug("Ignoring keyshare for unknown device ".concat(n,":").concat(r));try{yield l.reshareKeyWithDevice(i.sender_key,i.session_id,n,d)}catch(e){c.v.warn("Failed to re-share keys for session "+i.session_id+" with device "+n+":"+d.deviceId,e)}}}))()}processReceivedRoomKeyRequestCancellation(e){var t=this;return(0,r.A)((function*(){c.v.log("m.room_key_request cancellation for ".concat(e.userId,":")+"".concat(e.deviceId," (id ").concat(e.requestId,")")),t.emit(Ft.RoomKeyRequestCancellation,e)}))()}getRoomDecryptor(e,t){var n,r;if(e&&((n=this.roomDecryptors.get(e))||(n=new Map,this.roomDecryptors.set(e,n)),r=n.get(t)))return r;var i=F.get(t);if(!i)throw new h.O(u.DecryptionFailureCode.UNKNOWN_ENCRYPTION_ALGORITHM,'Unknown encryption algorithm "'+t+'".');return r=new i({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:null!=e?e:void 0}),n&&n.set(t,r),r}getRoomDecryptors(e){var t=[];for(var n of this.roomDecryptors.values())n.has(e)&&t.push(n.get(e));return t}signObject(e){var t=this;return(0,r.A)((function*(){var n=new Map(Object.entries(e.signatures||{})),r=e.unsigned;delete e.signatures,delete e.unsigned;var i=n.get(t.userId)||{};n.set(t.userId,i),i["ed25519:"+t.deviceId]=yield t.olmDevice.sign(o.stringify(e)),e.signatures=(0,O.HF)(n),void 0!==r&&(e.unsigned=r)}))()}isRoomEncrypted(e){return this.roomList.isRoomEncrypted(e)}isEncryptionEnabledInRoom(e){var t=this;return(0,r.A)((function*(){return t.isRoomEncrypted(e)}))()}getRoomEncryption(e){return this.roomList.getRoomEncryption(e)}isDehydrationSupported(){return(0,r.A)((function*(){return!1}))()}startDehydration(e){return(0,r.A)((function*(){throw new Error("Not implemented")}))()}restoreKeyBackup(e){throw new Error("Not implemented")}restoreKeyBackupWithPassphrase(e,t){throw new Error("Not implemented")}resetEncryption(){throw new Error("Not implemented")}}function Gt(e){if("string"!=typeof e||e.indexOf(",")<0)return null;var t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return(0,E.WG)(t)}class $t{constructor(e){(0,i.A)(this,"userId",void 0),(0,i.A)(this,"deviceId",void 0),(0,i.A)(this,"requestId",void 0),(0,i.A)(this,"requestBody",void 0),(0,i.A)(this,"share",void 0);var t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}class Vt{constructor(e){(0,i.A)(this,"userId",void 0),(0,i.A)(this,"deviceId",void 0),(0,i.A)(this,"requestId",void 0);var t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}},2824:(e,t,n)=>{"use strict";n.d(t,{SM:()=>s});var r=n(467),i=n(5942),o=n(8417),a=(n(4304),5e5);function s(e){return l.apply(this,arguments)}function l(){return(l=(0,r.A)((function*(e){var t=(0,i.US)(32);return{key:yield(0,o.deriveRecoveryKeyFromPassphrase)(e,t,a),salt:t,iterations:a}}))).apply(this,arguments)}},8197:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MEGOLM_ALGORITHM:()=>h,MEGOLM_BACKUP_ALGORITHM:()=>p,OLM_ALGORITHM:()=>u,encryptMessageForDevice:()=>v,ensureOlmSessionsForDevices:()=>y,getExistingOlmSessions:()=>g,isOlmEncrypted:()=>A,pkSign:()=>C,pkVerify:()=>w,verifySignature:()=>b});var r=n(4980),i=n(467),o=n(4069),a=n(3840),s=n(2986),l=n(3883);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var d=function(e){return e.Olm="m.olm.v1.curve25519-aes-sha2",e.Megolm="m.megolm.v1.aes-sha2",e.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2",e}(d||{}),u=d.Olm,h=d.Megolm,p=d.MegolmBackup;function v(e,t,n,r,i,o,a){return m.apply(this,arguments)}function m(){return m=(0,i.A)((function*(e,t,n,i,o,s,l){var d=s.getIdentityKey(),u=yield i.getSessionIdForDevice(d);if(null!==u){a.v.log("[olmlib.encryptMessageForDevice] Using Olm session ".concat(u," for device ")+"".concat(o,":").concat(s.deviceId));var h=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({sender:t,sender_device:n,keys:{ed25519:i.deviceEd25519Key},recipient:o,recipient_keys:{ed25519:s.getFingerprint()}},l);e[d]=yield i.encryptMessage(d,u,JSON.stringify(h))}else a.v.log("[olmlib.encryptMessageForDevice] Unable to find Olm session for device "+"".concat(o,":").concat(s.deviceId))})),m.apply(this,arguments)}function g(e,t,n){return f.apply(this,arguments)}function f(){return(f=(0,i.A)((function*(e,t,n){var r=new l.kG((()=>[])),o=new l.kG((()=>new Map)),a=[],s=function*(t){var n=function*(n){var s=n.deviceId,l=n.getIdentityKey();a.push((0,i.A)((function*(){var i=yield e.getSessionIdForDevice(l,!0);null===i?r.getOrCreate(t).push(n):o.getOrCreate(t).set(s,{device:n,sessionId:i})}))())};for(var s of d)yield*n(s)};for(var[c,d]of Object.entries(n))yield*s(c);return yield Promise.all(a),[r,o]}))).apply(this,arguments)}function y(e,t,n){return _.apply(this,arguments)}function _(){return _=(0,i.A)((function*(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.v,l=[],c=new Map,d=new Map;for(var u of n.values()){var h=function*(){var t=p.getIdentityKey();if(t===e.deviceCurve25519Key)return 1;e.sessionsInProgress[t]||(e.sessionsInProgress[t]=new Promise((n=>{d.set(t,(r=>{delete e.sessionsInProgress[t],n(r)}))})))};for(var p of u)yield*h()}for(var[v,m]of n){var g=new Map;for(var f of(c.set(v,g),m)){var y=f.deviceId,_=f.getIdentityKey();if(_!==e.deviceCurve25519Key){var b="for ".concat(_," (").concat(v,":").concat(y,")"),S=yield e.getSessionIdForDevice(_,!!d.get(_),s),C=d.get(_);null!==S&&C&&C(),(null===S||r)&&(r?s.info("Forcing new Olm session ".concat(b)):s.info("Making new Olm session ".concat(b)),l.push([v,y])),g.set(y,{device:f,sessionId:S})}else s.info("Attempted to start session with ourself! Ignoring"),g.set(y,{device:f,sessionId:null})}}if(0===l.length)return c;var w,A="signed_curve25519",T="one-time keys for ".concat(l.length," devices");try{s.debug("Claiming ".concat(T)),w=yield t.claimOneTimeKeys(l,A,i),s.debug("Claimed ".concat(T))}catch(e){for(var I of d.values())I();throw s.debug("Failed to claim ".concat(T),e,l),e}o&&"failures"in w&&o.push(...Object.keys(w.failures));var k=w.one_time_keys||{},O=[],R=function*(t){var n=k[t]||{},i=function*(){var i,a=o.deviceId,l=o.getIdentityKey();if(l===e.deviceCurve25519Key)return 0;if(null!==(i=c.get(t))&&void 0!==i&&null!==(i=i.get(a))&&void 0!==i&&i.sessionId&&!r)return 0;var u,h=n[a]||{},p=null;for(var v in h)0===v.indexOf(A+":")&&(p=h[v]);if(!p)return s.warn("No one-time keys (alg=".concat(A,") ")+"for device ".concat(t,":").concat(a)),null===(u=d.get(l))||void 0===u||u(),0;O.push(function(e,t,n,r){return E.apply(this,arguments)}(e,p,t,o).then((e=>{var n,r;null===(n=d.get(l))||void 0===n||n(null!=e?e:void 0);var i=null===(r=c.get(t))||void 0===r?void 0:r.get(a);i&&(i.sessionId=e)}),(e=>{var t;throw null===(t=d.get(l))||void 0===t||t(),e})))};for(var o of N)yield*i()};for(var[x,N]of n)yield*R(x);return T="Olm sessions for ".concat(O.length," devices"),s.debug("Starting ".concat(T)),yield Promise.all(O),s.debug("Started ".concat(T)),c})),_.apply(this,arguments)}function E(){return(E=(0,i.A)((function*(e,t,n,r){var i,o=r.deviceId;try{yield b(e,t,n,o,r.getFingerprint())}catch(e){return a.v.error("Unable to verify signature on one-time key for device "+n+":"+o+":",e),null}try{i=yield e.createOutboundSession(r.getIdentityKey(),t.key)}catch(e){return a.v.error("Error starting olm session with device "+n+":"+o+": "+e),null}return a.v.log("Started new olm sessionid "+i+" for device "+n+":"+o),i}))).apply(this,arguments)}function b(e,t,n,r,i){return S.apply(this,arguments)}function S(){return(S=(0,i.A)((function*(e,t,n,r,i){var a="ed25519:"+r,s=((t.signatures||{})[n]||{})[a];if(!s)throw Error("No signature");var l=Object.assign({},t);"unsigned"in l&&delete l.unsigned,delete l.signatures;var c=o.stringify(l);e.verifySignature(i,c,s)}))).apply(this,arguments)}function C(e,t,n,r){var i=!1;if(t instanceof Uint8Array){var a=new globalThis.Olm.PkSigning;r=a.init_with_seed(t),t=a,i=!0}var s=e.signatures||{};delete e.signatures;var l=e.unsigned;e.unsigned&&delete e.unsigned;try{var c=s[n]||{};return s[n]=c,c["ed25519:"+r]=t.sign(o.stringify(e))}finally{e.signatures=s,l&&(e.unsigned=l),i&&t.free()}}function w(e,t,n){var r="ed25519:"+t;if(!(e.signatures&&e.signatures[n]&&e.signatures[n][r]))throw new Error("No signature");var i=e.signatures[n][r],a=new globalThis.Olm.Utility,s=e.signatures;delete e.signatures;var l=e.unsigned;e.unsigned&&delete e.unsigned;try{a.ed25519_verify(t,o.stringify(e),i)}finally{e.signatures=s,l&&(e.unsigned=l),a.free()}}function A(e){return e.getSenderKey()?!(e.getWireType()!==s.Bx.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(e.getWireContent().algorithm))||(a.v.error("Event was not encrypted using an appropriate algorithm"),!1):(a.v.error("Event has no sender key (not encrypted?)"),!1)}},4303:(e,t,n)=>{"use strict";n.d(t,{Il:()=>i,Nv:()=>r,oT:()=>o});var r="migrationState",i=function(e){return e[e.NOT_STARTED=0]="NOT_STARTED",e[e.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",e[e.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",e[e.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",e[e.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",e[e.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",e}({}),o=50},5530:(e,t,n)=>{"use strict";n.d(t,{y:()=>f});var r=n(467),i=n(4980),o=n(3840),a=n(2642),s=n(7083),l=n(3883),c=n(4303);class d{constructor(e){this.db=e,(0,i.A)(this,"nextTxnId",0),e.onversionchange=()=>{o.v.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return(0,r.A)((function*(){throw Error("Not implemented for Backend")}))()}startup(){var e=this;return(0,r.A)((function*(){return e}))()}deleteAllData(){return(0,r.A)((function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}))()}getMigrationState(){var e=this;return(0,r.A)((function*(){var t=c.Il.NOT_STARTED;return yield e.doTxn("readonly",[f.STORE_ACCOUNT],(e=>{var n=e.objectStore(f.STORE_ACCOUNT).get(c.Nv);n.onsuccess=()=>{var e;t=null!==(e=n.result)&&void 0!==e?e:c.Il.NOT_STARTED}})),t}))()}setMigrationState(e){var t=this;return(0,r.A)((function*(){yield t.doTxn("readwrite",[f.STORE_ACCOUNT],(t=>{t.objectStore(f.STORE_ACCOUNT).put(e,c.Nv)}))}))()}getOrAddOutgoingRoomKeyRequest(e){var t=e.requestBody;return new Promise(((n,r)=>{var i=this.db.transaction("outgoingRoomKeyRequests","readwrite");i.onerror=r,this._getOutgoingRoomKeyRequest(i,t,(r=>{if(r)return o.v.log("already have key request outstanding for "+"".concat(t.room_id," / ").concat(t.session_id,": ")+"not sending another"),void n(r);o.v.log("enqueueing key request for ".concat(t.room_id," / ")+t.session_id),i.oncomplete=()=>{n(e)},i.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,n)=>{var r=this.db.transaction("outgoingRoomKeyRequests","readonly");r.onerror=n,this._getOutgoingRoomKeyRequest(r,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,n){var r=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);r.onsuccess=()=>{var e=r.result;if(e){var i=e.value;(0,l.ky)(i.requestBody,t)?n(i):e.continue()}else n(null)}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);var t,n=0,r=this.db.transaction("outgoingRoomKeyRequests","readonly"),i=r.objectStore("outgoingRoomKeyRequests"),o=e[n];return i.index("state").openCursor(o).onsuccess=function r(){var i=this.result;if(i)t=i.value;else if(!(++n>=e.length)){var o=e[n];this.source.openCursor(o).onsuccess=r}},v(r).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,n)=>{var r=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);r.onsuccess=()=>t(r.result),r.onerror=()=>n(r.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,n){var r=0,i=[],o=this.db.transaction("outgoingRoomKeyRequests","readonly"),a=o.objectStore("outgoingRoomKeyRequests"),s=n[r];return a.index("state").openCursor(s).onsuccess=function o(){var a=this.result;if(a){var s=a.value;s.recipients.some((n=>n.userId===e&&n.deviceId===t))&&i.push(s),a.continue()}else{if(++r>=n.length)return;var l=n[r];this.source.openCursor(l).onsuccess=o}},v(o).then((()=>i))}updateOutgoingRoomKeyRequest(e,t,n){var r=null,i=this.db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(){var e=this.result;if(e){var i=e.value;i.state==t?(Object.assign(i,n),e.update(i),r=i):o.v.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(i.state))}},v(i).then((()=>r))}deleteOutgoingRoomKeyRequest(e,t){var n=this.db.transaction("outgoingRoomKeyRequests","readwrite"),r=n.objectStore("outgoingRoomKeyRequests").openCursor(e);return r.onsuccess=()=>{var e=r.result;if(e){var n=e.value;n.state==t?e.delete():o.v.warn("Cannot delete room key request in state ".concat(n.state," ")+"(expected ".concat(t,")"))}},v(n)}getAccount(e,t){var n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){p(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){var n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){p(e,t)}}}getSecretStorePrivateKey(e,t,n){var r=e.objectStore("account").get("ssss_cache:".concat(n));r.onsuccess=function(){try{t(r.result||null)}catch(t){p(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,n){e.objectStore("account").put(n,"ssss_cache:".concat(t))}countEndToEndSessions(e,t){var n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(t){p(e,t)}}}getEndToEndSessions(e,t,n){var r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){var e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(e){p(t,e)}}}getEndToEndSession(e,t,n,r){var i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){p(n,e)}}}getAllEndToEndSessions(e,t){var n=e.objectStore("sessions").openCursor();n.onsuccess=function(){try{var r=n.result;r?(t(r.value),r.continue()):t(null)}catch(t){p(e,t)}}}storeEndToEndSession(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}storeEndToEndSessionProblem(e,t,n){var i=this;return(0,r.A)((function*(){var r=i.db.transaction("session_problems","readwrite");r.objectStore("session_problems").put({deviceKey:e,type:t,fixed:n,time:Date.now()}),yield v(r)}))()}getEndToEndSessionProblem(e,t){var n=this;return(0,r.A)((function*(){var r=null,i=n.db.transaction("session_problems","readwrite"),o=i.objectStore("session_problems").index("deviceKey").getAll(e);return o.onsuccess=()=>{var e=o.result;if(e.length){e.sort(((e,t)=>e.time-t.time));var n=e[e.length-1];for(var i of e)if(i.time>t)return void(r=Object.assign({},i,{fixed:n.fixed}));r=n.fixed?null:n}else r=null},yield v(i),r}))()}filterOutNotifiedErrorDevices(e){var t=this;return(0,r.A)((function*(){var n=t.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),r=[];return yield Promise.all(e.map((e=>new Promise((t=>{var{userId:i,deviceInfo:o}=e,a=n.get([i,o.deviceId]);a.onsuccess=function(){a.result||(n.put({userId:i,deviceId:o.deviceId}),r.push(e)),t()}}))))),r}))()}getEndToEndSessionsBatch(){var e=this;return(0,r.A)((function*(){var t=[];return yield e.doTxn("readonly",[f.STORE_SESSIONS],(e=>{var n=e.objectStore(f.STORE_SESSIONS).openCursor();n.onsuccess=function(){try{var r=n.result;r&&(t.push(r.value),t.length<c.oT&&r.continue())}catch(t){p(e,t)}}})),0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return(0,r.A)((function*(){yield t.doTxn("readwrite",[f.STORE_SESSIONS],function(){var t=(0,r.A)((function*(t){try{var n=t.objectStore(f.STORE_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise((t=>{e.onsuccess=t}))};for(var{deviceKey:i,sessionId:o}of e)yield*r()}catch(e){p(t,e)}}));return function(e){return t.apply(this,arguments)}}())}))()}getEndToEndInboundGroupSession(e,t,n,r){var i=!1,o=!1,a=n.objectStore("inbound_group_sessions").get([e,t]);a.onsuccess=function(){try{i=a.result?a.result.session:null,!1!==o&&r(i,o)}catch(e){p(n,e)}};var s=n.objectStore("inbound_group_sessions_withheld").get([e,t]);s.onsuccess=function(){try{o=s.result?s.result.session:null,!1!==i&&r(i,o)}catch(e){p(n,e)}}}getAllEndToEndInboundGroupSessions(e,t){var n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){var r=n.result;if(r){try{t({senderKey:r.value.senderCurve25519Key,sessionId:r.value.sessionId,sessionData:r.value.session})}catch(t){p(e,t)}r.continue()}else try{t(null)}catch(t){p(e,t)}}}addEndToEndInboundGroupSession(e,t,n,r){var i=r.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});i.onerror=n=>{var a,s;"ConstraintError"===(null===(a=i.error)||void 0===a?void 0:a.name)?(n.stopPropagation(),n.preventDefault(),o.v.log("Ignoring duplicate inbound group session: "+e+" / "+t)):p(r,new Error("Failed to add inbound group session: "+(null===(s=i.error)||void 0===s?void 0:s.name)))}}storeEndToEndInboundGroupSession(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){r.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}countEndToEndInboundGroupSessions(){var e=this;return(0,r.A)((function*(){var t=0;return yield e.doTxn("readonly",[f.STORE_INBOUND_GROUP_SESSIONS],(e=>{var n=e.objectStore(f.STORE_INBOUND_GROUP_SESSIONS).count();n.onsuccess=()=>{t=n.result}})),t}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return(0,r.A)((function*(){var t=[];return yield e.doTxn("readonly",[f.STORE_INBOUND_GROUP_SESSIONS,f.STORE_BACKUP],(e=>{var n=e.objectStore(f.STORE_INBOUND_GROUP_SESSIONS),r=e.objectStore(f.STORE_BACKUP),i=n.openCursor();i.onsuccess=function(){try{var n=i.result;if(n){var o=r.get(n.key);o.onsuccess=()=>{t.push({senderKey:n.value.senderCurve25519Key,sessionId:n.value.sessionId,sessionData:n.value.session,needsBackup:void 0!==o.result}),t.length<c.oT&&n.continue()}}}catch(t){p(e,t)}}})),0===t.length?null:t}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return(0,r.A)((function*(){yield t.doTxn("readwrite",[f.STORE_INBOUND_GROUP_SESSIONS],function(){var t=(0,r.A)((function*(t){try{var n=t.objectStore(f.STORE_INBOUND_GROUP_SESSIONS),r=function*(){var e=n.delete([i,o]);yield new Promise((t=>{e.onsuccess=t}))};for(var{senderKey:i,sessionId:o}of e)yield*r()}catch(e){p(t,e)}}));return function(e){return t.apply(this,arguments)}}())}))()}getEndToEndDeviceData(e,t){var n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){p(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,n){n.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){var n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){var i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(t){p(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,n)=>{var r=[],i=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");i.onerror=n,i.oncomplete=function(){t(r)};var o=i.objectStore("sessions_needing_backup"),a=i.objectStore("inbound_group_sessions"),s=o.openCursor();s.onsuccess=function(){var t=s.result;if(t){var n=a.get(t.key);n.onsuccess=function(){r.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||r.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));var t=e.objectStore("sessions_needing_backup");return new Promise(((e,n)=>{var r=t.count();r.onerror=n,r.onsuccess=()=>e(r.result)}))}unmarkSessionsNeedingBackup(e,t){var n=this;return(0,r.A)((function*(){t||(t=n.db.transaction("sessions_needing_backup","readwrite"));var r=t.objectStore("sessions_needing_backup");yield Promise.all(e.map((e=>new Promise(((t,n)=>{var i=r.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=n})))))}))()}markSessionsNeedingBackup(e,t){var n=this;return(0,r.A)((function*(){t||(t=n.db.transaction("sessions_needing_backup","readwrite"));var r=t.objectStore("sessions_needing_backup");yield Promise.all(e.map((e=>new Promise(((t,n)=>{var i=r.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=n})))))}))()}addSharedHistoryInboundGroupSession(e,t,n,r){r||(r=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));var i=r.objectStore("shared_history_inbound_group_sessions"),o=i.get([e]);o.onsuccess=()=>{var{sessions:r}=o.result||{sessions:[]};r.push([t,n]),i.put({roomId:e,sessions:r})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));var n=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise(((e,t)=>{n.onsuccess=()=>{var{sessions:t}=n.result||{sessions:[]};e(t)},n.onerror=t}))}addParkedSharedHistory(e,t,n){n||(n=this.db.transaction("parked_shared_history","readwrite"));var r=n.objectStore("parked_shared_history"),i=r.get([e]);i.onsuccess=()=>{var{parked:n}=i.result||{parked:[]};n.push(t),r.put({roomId:e,parked:n})}}takeParkedSharedHistory(e,t){t||(t=this.db.transaction("parked_shared_history","readwrite"));var n=t.objectStore("parked_shared_history").openCursor(e);return new Promise(((e,t)=>{n.onsuccess=()=>{var t=n.result;if(t){var r=t.value;t.delete(),e(r)}else e([])},n.onerror=t}))}doTxn(e,t,n){arguments.length>3&&void 0!==arguments[3]||o.v;var r=this.db.transaction(t,e),i=v(r),a=n(r);return i.then((()=>a))}}var u=[e=>{!function(e){var t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e)},e=>{e.createObjectStore("account")},e=>{e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},e=>{e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("device_data")},e=>{e.createObjectStore("rooms")},e=>{e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},e=>{e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},e=>{e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},e=>{e.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],h=u.length;function p(e,t){e._mx_abortexception=t;try{e.abort()}catch(e){}}function v(e){return new Promise(((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(o.v.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(o.v.log("Error performing indexeddb txn",t),n(e.error))}}))}var m=n(4575),g=n(7501);class f{static exists(e,t){return g.t(e,t)}static existsAndIsNotMigrated(e,t){return new Promise(((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{var a=o.result;if(i){var s=a.transaction([f.STORE_ACCOUNT],"readonly").objectStore(f.STORE_ACCOUNT).get(c.Nv);s.onsuccess=()=>{var e,t=null!==(e=s.result)&&void 0!==e?e:c.Il.NOT_STARTED;n(t===c.Il.NOT_STARTED)},s.onerror=()=>{r(s.error)},a.close()}else a.close(),e.deleteDatabase(t),n(!1)},o.onerror=()=>r(o.error)}))}constructor(e,t){this.indexedDB=e,this.dbName=t,(0,i.A)(this,"backendPromise",void 0),(0,i.A)(this,"backend",void 0)}containsData(){var e=this;return(0,r.A)((function*(){return f.exists(e.indexedDB,e.dbName)}))()}startup(){return this.backendPromise||(this.backendPromise=new Promise(((e,t)=>{if(this.indexedDB){o.v.log("connecting to indexeddb ".concat(this.dbName));var n=this.indexedDB.open(this.dbName,h);n.onupgradeneeded=e=>{var t,r;t=n.result,r=e.oldVersion,o.v.log("Upgrading IndexedDBCryptoStore from version ".concat(r)+" to ".concat(h)),u.forEach(((e,n)=>{r<=n&&e(t)}))},n.onblocked=()=>{o.v.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{o.v.log("Error connecting to indexeddb",e),t(n.error)},n.onsuccess=()=>{var t=n.result;o.v.log("connected to indexeddb ".concat(this.dbName)),e(new d(t))}}else t(new Error("no indexeddb support available"))})).then((e=>e.doTxn("readonly",[f.STORE_INBOUND_GROUP_SESSIONS,f.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw o.v.warn("Crypto DB is too new for us to use!",e),new m.E5(m.hP.TooNew);o.v.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{return new a.F(globalThis.localStorage)}catch(e){return o.v.warn("unable to open localStorage: falling back to in-memory store: ".concat(e)),new s._}})).then((e=>(this.backend=e,e)))),this.backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(this.indexedDB){o.v.log("Removing indexeddb instance: ".concat(this.dbName));var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{o.v.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{o.v.log("Error deleting data from indexeddb",e),t(n.error)},n.onsuccess=()=>{o.v.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}else t(new Error("no indexeddb support available"))})).catch((e=>{o.v.warn("unable to delete IndexedDBCryptoStore: ".concat(e))}))}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getOrAddOutgoingRoomKeyRequest(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this.backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,n){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}updateOutgoingRoomKeyRequest(e,t,n){return this.backend.updateOutgoingRoomKeyRequest(e,t,n)}deleteOutgoingRoomKeyRequest(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}storeCrossSigningKeys(e,t){this.backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,r){this.backend.getEndToEndSession(e,t,n,r)}getEndToEndSessions(e,t,n){this.backend.getEndToEndSessions(e,t,n)}getAllEndToEndSessions(e,t){this.backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,n,r){this.backend.storeEndToEndSession(e,t,n,r)}storeEndToEndSessionProblem(e,t,n){return this.backend.storeEndToEndSessionProblem(e,t,n)}getEndToEndSessionProblem(e,t){return this.backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.backend.filterOutNotifiedErrorDevices(e)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,t,n,r){this.backend.getEndToEndInboundGroupSession(e,t,n,r)}getAllEndToEndInboundGroupSessions(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,n,r){this.backend.addEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){this.backend.storeEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,r)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}storeEndToEndDeviceData(e,t){this.backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this.backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,n){this.backend.storeEndToEndRoom(e,t,n)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this.backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this.backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,n,r){this.backend.addSharedHistoryInboundGroupSession(e,t,n,r)}getSharedHistoryInboundGroupSessions(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}addParkedSharedHistory(e,t,n){this.backend.addParkedSharedHistory(e,t,n)}takeParkedSharedHistory(e,t){return this.backend.takeParkedSharedHistory(e,t)}doTxn(e,t,n,r){return this.backend.doTxn(e,t,n,r)}}(0,i.A)(f,"STORE_ACCOUNT","account"),(0,i.A)(f,"STORE_SESSIONS","sessions"),(0,i.A)(f,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,i.A)(f,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,i.A)(f,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,i.A)(f,"STORE_PARKED_SHARED_HISTORY","parked_shared_history"),(0,i.A)(f,"STORE_DEVICE_DATA","device_data"),(0,i.A)(f,"STORE_ROOMS","rooms"),(0,i.A)(f,"STORE_BACKUP","sessions_needing_backup")},2642:(e,t,n)=>{"use strict";n.d(t,{F:()=>C});var r=n(467),i=n(3840),o=n(7083),a=n(4303),s=n(3883),l="crypto.",c=l+"migration",d=l+"account",u=l+"cross_signing_keys",h=l+"notified_error_devices",p=l+"device_data",v=l+"inboundgroupsessions/",m=l+"inboundgroupsessions.withheld/",g=l+"rooms/",f=l+"sessionsneedingbackup";function y(e){return l+"sessions/"+e}function _(e){return l+"session.problems/"+e}function E(e,t){return v+e+"/"+t}function b(e,t){return m+e+"/"+t}function S(e){return g+e}class C extends o._{static exists(e){for(var t=e.length,n=0;n<t;n++){var r;if(null!==(r=e.key(n))&&void 0!==r&&r.startsWith(l))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return(0,r.A)((function*(){return C.exists(e.store)}))()}getMigrationState(){var e=this;return(0,r.A)((function*(){var t;return null!==(t=w(e.store,c))&&void 0!==t?t:a.Il.NOT_STARTED}))()}setMigrationState(e){var t=this;return(0,r.A)((function*(){A(t.store,c,e)}))()}countEndToEndSessions(e,t){for(var n=0,r=0;r<this.store.length;++r){var i=this.store.key(r);if(null!=i&&i.startsWith(y(""))){var o=w(this.store,i);n+=Object.keys(null!=o?o:{}).length}}t(n)}_getEndToEndSessions(e){var t=w(this.store,y(e)),n={};for(var[r,i]of Object.entries(t||{}))n[r]="string"==typeof i?{session:i}:i;return n}getEndToEndSession(e,t,n,r){var i;r(null!==(i=this._getEndToEndSessions(e)[t])&&void 0!==i?i:{})}getEndToEndSessions(e,t,n){var r;n(null!==(r=this._getEndToEndSessions(e))&&void 0!==r?r:{})}getAllEndToEndSessions(e,t){for(var n=0;n<this.store.length;++n){var r;if(null!==(r=this.store.key(n))&&void 0!==r&&r.startsWith(y(""))){var i=this.store.key(n).split("/")[1];for(var o of Object.values(this._getEndToEndSessions(i)))t(o)}}}storeEndToEndSession(e,t,n,r){var i=this._getEndToEndSessions(e)||{};i[t]=n,A(this.store,y(e),i)}storeEndToEndSessionProblem(e,t,n){var i=this;return(0,r.A)((function*(){var r=_(e),o=w(i.store,r)||[];o.push({type:t,fixed:n,time:Date.now()}),o.sort(((e,t)=>e.time-t.time)),A(i.store,r,o)}))()}getEndToEndSessionProblem(e,t){var n=this;return(0,r.A)((function*(){var r=_(e),i=w(n.store,r)||[];if(!i.length)return null;var o=i[i.length-1];for(var a of i)if(a.time>t)return Object.assign({},a,{fixed:o.fixed});return o.fixed?null:o}))()}filterOutNotifiedErrorDevices(e){var t=this;return(0,r.A)((function*(){var n=w(t.store,h)||{},r=[];for(var i of e){var{userId:o,deviceInfo:a}=i;o in n?a.deviceId in n[o]||(r.push(i),(0,s.C6)(n[o],a.deviceId,!0)):(r.push(i),(0,s.C6)(n,o,{[a.deviceId]:!0}))}return A(t.store,h,n),r}))()}getEndToEndSessionsBatch(){var e=this;return(0,r.A)((function*(){for(var t=[],n=0;n<e.store.length;++n){var r;if(null!==(r=e.store.key(n))&&void 0!==r&&r.startsWith(y(""))){var i=e.store.key(n).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(i)))if(t.push(o),t.length>=a.oT)return t}}return 0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return(0,r.A)((function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t._getEndToEndSessions(n)||{};delete i[r],0===Object.keys(i).length?t.store.removeItem(y(n)):A(t.store,y(n),i)}}))()}getEndToEndInboundGroupSession(e,t,n,r){r(w(this.store,E(e,t)),w(this.store,b(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(var n=0;n<this.store.length;++n){var r=this.store.key(n);null!=r&&r.startsWith(v)&&t({senderKey:r.slice(28,71),sessionId:r.slice(72),sessionData:w(this.store,r)})}t(null)}addEndToEndInboundGroupSession(e,t,n,r){w(this.store,E(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){A(this.store,E(e,t),n)}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){A(this.store,b(e,t),n)}countEndToEndInboundGroupSessions(){var e=this;return(0,r.A)((function*(){for(var t=0,n=0;n<e.store.length;++n){var r=e.store.key(n);null!=r&&r.startsWith(v)&&(t+=1)}return t}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return(0,r.A)((function*(){for(var t=w(e.store,f)||{},n=[],r=0;r<e.store.length;++r){var i=e.store.key(r);if(null!=i&&i.startsWith(v)){var o=i.slice(28);if(n.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:w(e.store,i),needsBackup:o in t}),n.length>=a.oT)return n}}return 0===n.length?null:n}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return(0,r.A)((function*(){for(var{senderKey:n,sessionId:r}of e){var i=E(n,r);t.store.removeItem(i)}}))()}getEndToEndDeviceData(e,t){t(w(this.store,p))}storeEndToEndDeviceData(e,t){A(this.store,p,e)}storeEndToEndRoom(e,t,n){A(this.store,S(e),t)}getEndToEndRooms(e,t){for(var n={},r=S(""),i=0;i<this.store.length;++i){var o=this.store.key(i);null!=o&&o.startsWith(r)&&(n[o.slice(r.length)]=w(this.store,o))}t(n)}getSessionsNeedingBackup(e){var t=this,n=w(this.store,f)||{},r=[],i=function(){if(Object.prototype.hasOwnProperty.call(n,o)){var i=o.slice(0,43),a=o.slice(44);if(t.getEndToEndInboundGroupSession(i,a,null,(e=>{r.push({senderKey:i,sessionId:a,sessionData:e})})),e&&r.length>=e)return 1}};for(var o in n)if(i())break;return Promise.resolve(r)}countSessionsNeedingBackup(){var e=w(this.store,f)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){var t=w(this.store,f)||{};for(var n of e)delete t[n.senderKey+"/"+n.sessionId];return A(this.store,f,t),Promise.resolve()}markSessionsNeedingBackup(e){var t=w(this.store,f)||{};for(var n of e)t[n.senderKey+"/"+n.sessionId]=!0;return A(this.store,f,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(d),Promise.resolve()}getAccount(e,t){t(w(this.store,d))}storeAccount(e,t){A(this.store,d,t)}getCrossSigningKeys(e,t){t(w(this.store,u))}getSecretStorePrivateKey(e,t,n){t(w(this.store,l+"ssss_cache.".concat(n)))}storeCrossSigningKeys(e,t){A(this.store,u,t)}storeSecretStorePrivateKey(e,t,n){A(this.store,l+"ssss_cache.".concat(t),n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function w(e,t){try{return JSON.parse(e.getItem(t))}catch(e){i.v.log("Error: Failed to get key %s: %s",t,e.message),i.v.log(e.stack)}return null}function A(e,t,n){e.setItem(t,JSON.stringify(n))}},7083:(e,t,n)=>{"use strict";n.d(t,{_:()=>h});var r=n(467),i=n(4980),o=n(3840),a=n(3883),s=n(4303);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){return encodeURIComponent(e)+"/"+encodeURIComponent(t)}function u(e){var t=e.split("/");return{senderKey:decodeURIComponent(t[0]),sessionId:decodeURIComponent(t[1])}}class h{constructor(){(0,i.A)(this,"migrationState",s.Il.NOT_STARTED),(0,i.A)(this,"outgoingRoomKeyRequests",[]),(0,i.A)(this,"account",null),(0,i.A)(this,"crossSigningKeys",null),(0,i.A)(this,"privateKeys",{}),(0,i.A)(this,"sessions",{}),(0,i.A)(this,"sessionProblems",{}),(0,i.A)(this,"notifiedErrorDevices",{}),(0,i.A)(this,"inboundGroupSessions",{}),(0,i.A)(this,"inboundGroupSessionsWithheld",{}),(0,i.A)(this,"deviceData",null),(0,i.A)(this,"rooms",{}),(0,i.A)(this,"sessionsNeedingBackup",{}),(0,i.A)(this,"sharedHistoryInboundGroupSessions",{}),(0,i.A)(this,"parkedSharedHistory",new Map)}containsData(){var e=this;return(0,r.A)((function*(){return null!==e.account}))()}startup(){var e=this;return(0,r.A)((function*(){return e}))()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return(0,r.A)((function*(){return e.migrationState}))()}setMigrationState(e){var t=this;return(0,r.A)((function*(){t.migrationState=e}))()}getOrAddOutgoingRoomKeyRequest(e){var t=e.requestBody;return(0,a.j0)((()=>{var n=this._getOutgoingRoomKeyRequest(t);return n?(o.v.log("already have key request outstanding for "+"".concat(t.room_id," / ").concat(t.session_id,": ")+"not sending another"),n):(o.v.log("enqueueing key request for ".concat(t.room_id," / ")+t.session_id),this.outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(var t of this.outgoingRoomKeyRequests)if((0,a.ky)(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(var t of this.outgoingRoomKeyRequests)for(var n of e)if(t.state===n)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,n){var r=[];for(var i of this.outgoingRoomKeyRequests)for(var o of n)i.state===o&&i.recipients.some((n=>n.userId===e&&n.deviceId===t))&&r.push(i);return Promise.resolve(r)}updateOutgoingRoomKeyRequest(e,t,n){for(var r of this.outgoingRoomKeyRequests)if(r.requestId===e)return r.state!==t?(o.v.warn("Cannot update room key request from ".concat(t," ")+"as it was already updated to ".concat(r.state)),Promise.resolve(null)):(Object.assign(r,n),Promise.resolve(r));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(var n=0;n<this.outgoingRoomKeyRequests.length;n++){var r=this.outgoingRoomKeyRequests[n];if(r.requestId===e)return r.state!=t?(o.v.warn("Cannot delete room key request in state ".concat(r.state," ")+"(expected ".concat(t,")")),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(n,1),Promise.resolve(r))}return Promise.resolve(null)}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,n){t(this.privateKeys[n]||null)}storeCrossSigningKeys(e,t){this.crossSigningKeys=t}storeSecretStorePrivateKey(e,t,n){this.privateKeys[t]=n}countEndToEndSessions(e,t){var n=0;for(var r of Object.values(this.sessions))n+=Object.keys(r).length;t(n)}getEndToEndSession(e,t,n,r){r((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this.sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this.sessions).forEach((e=>{var[n,r]=e;Object.entries(r).forEach((e=>{var[r,i]=e;t(c(c({},i),{},{deviceKey:n,sessionId:r}))}))}))}storeEndToEndSession(e,t,n,r){var i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),(0,a.C6)(i,t,n)}storeEndToEndSessionProblem(e,t,n){var i=this;return(0,r.A)((function*(){var r=i.sessionProblems[e]=i.sessionProblems[e]||[];r.push({type:t,fixed:n,time:Date.now()}),r.sort(((e,t)=>e.time-t.time))}))()}getEndToEndSessionProblem(e,t){var n=this;return(0,r.A)((function*(){var r=n.sessionProblems[e]||[];if(!r.length)return null;var i=r[r.length-1];for(var o of r)if(o.time>t)return Object.assign({},o,{fixed:i.fixed});return i.fixed?null:i}))()}filterOutNotifiedErrorDevices(e){var t=this;return(0,r.A)((function*(){var n=t.notifiedErrorDevices,r=[];for(var i of e){var{userId:o,deviceInfo:s}=i;o in n?s.deviceId in n[o]||(r.push(i),(0,a.C6)(n[o],s.deviceId,!0)):(r.push(i),(0,a.C6)(n,o,{[s.deviceId]:!0}))}return r}))()}getEndToEndSessionsBatch(){var e=this;return(0,r.A)((function*(){var t=[];for(var n of Object.values(e.sessions))for(var r of Object.values(n))if(t.push(r),t.length>=s.oT)return t;return 0===t.length?null:t}))()}deleteEndToEndSessionsBatch(e){var t=this;return(0,r.A)((function*(){for(var{deviceKey:n,sessionId:r}of e){var i=t.sessions[n]||{};delete i[r],0===Object.keys(i).length&&delete t.sessions[n]}}))()}getEndToEndInboundGroupSession(e,t,n,r){var i=d(e,t);r(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}getAllEndToEndInboundGroupSessions(e,t){for(var n of Object.keys(this.inboundGroupSessions))t(c(c({},u(n)),{},{sessionData:this.inboundGroupSessions[n]}));t(null)}addEndToEndInboundGroupSession(e,t,n,r){var i=d(e,t);void 0===this.inboundGroupSessions[i]&&(this.inboundGroupSessions[i]=n)}storeEndToEndInboundGroupSession(e,t,n,r){var i=d(e,t);this.inboundGroupSessions[i]=n}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){var i=d(e,t);this.inboundGroupSessionsWithheld[i]=n}countEndToEndInboundGroupSessions(){var e=this;return(0,r.A)((function*(){return Object.keys(e.inboundGroupSessions).length}))()}getEndToEndInboundGroupSessionsBatch(){var e=this;return(0,r.A)((function*(){var t=[];for(var[n,r]of Object.entries(e.inboundGroupSessions))if(t.push(c(c({},u(n)),{},{sessionData:r,needsBackup:n in e.sessionsNeedingBackup})),t.length>=s.oT)return t;return 0===t.length?null:t}))()}deleteEndToEndInboundGroupSessionsBatch(e){var t=this;return(0,r.A)((function*(){for(var{senderKey:n,sessionId:r}of e){var i=d(n,r);delete t.inboundGroupSessions[i]}}))()}getEndToEndDeviceData(e,t){t(this.deviceData)}storeEndToEndDeviceData(e,t){this.deviceData=e}storeEndToEndRoom(e,t,n){this.rooms[e]=t}getEndToEndRooms(e,t){t(this.rooms)}getSessionsNeedingBackup(e){var t=[];for(var n in this.sessionsNeedingBackup)if(this.inboundGroupSessions[n]&&(t.push(c(c({},u(n)),{},{sessionData:this.inboundGroupSessions[n]})),e&&n.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(var t of e){var n=d(t.senderKey,t.sessionId);delete this.sessionsNeedingBackup[n]}return Promise.resolve()}markSessionsNeedingBackup(e){for(var t of e){var n=d(t.senderKey,t.sessionId);this.sessionsNeedingBackup[n]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,n){var r=this.sharedHistoryInboundGroupSessions[e]||[];r.push([t,n]),this.sharedHistoryInboundGroupSessions[e]=r}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}addParkedSharedHistory(e,t){var n,r=null!==(n=this.parkedSharedHistory.get(e))&&void 0!==n?n:[];r.push(t),this.parkedSharedHistory.set(e,r)}takeParkedSharedHistory(e){var t,n=null!==(t=this.parkedSharedHistory.get(e))&&void 0!==t?t:[];return this.parkedSharedHistory.delete(e),Promise.resolve(n)}doTxn(e,t,n){return Promise.resolve(n(null))}}},5792:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});var r=n(467);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r.A)((function*(e){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var t=(new TextEncoder).encode(e),n=yield globalThis.crypto.subtle.digest("SHA-256",t);return new Uint8Array(n)}))).apply(this,arguments)}},4575:(e,t,n)=>{"use strict";n.d(t,{E5:()=>o,LA:()=>s,b0:()=>a,hP:()=>i});var r=n(4980),i=function(e){return e.TooNew="TOO_NEW",e}({});class o extends Error{constructor(e){super("Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again"),this.reason=e,this.name="InvalidCryptoStoreError"}}(0,r.A)(o,"TOO_NEW",i.TooNew);class a extends Error{constructor(e,t){super(e),this.value=t}}class s extends Error{constructor(){super("MatrixClient has been stopped")}}},8722:(e,t,n)=>{"use strict";function r(e){return null!=e}n.d(t,{c:()=>r})},8140:(e,t,n)=>{"use strict";n.d(t,{Tj:()=>i,Xj:()=>o,yk:()=>s});var r=n(467),i=function(e){return e[e.Stable=0]="Stable",e[e.Unstable=1]="Unstable",e[e.Unsupported=2]="Unsupported",e}({}),o=function(e){return e.Thread="Thread",e.ThreadUnreadNotifications="ThreadUnreadNotifications",e.LoginTokenRequest="LoginTokenRequest",e.RelationBasedRedactions="RelationBasedRedactions",e.AccountDataDeletion="AccountDataDeletion",e.RelationsRecursion="RelationsRecursion",e.IntentionalMentions="IntentionalMentions",e}({}),a={[o.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[o.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[o.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[o.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[o.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[o.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[o.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function s(e){return l.apply(this,arguments)}function l(){return(l=(0,r.A)((function*(e){var t=new Map;for(var[n,r]of Object.entries(a)){var o,s,l,c,d=null!==(o=null===(s=e.versions)||void 0===s?void 0:s.includes(r.matrixVersion||""))&&void 0!==o&&o,u=null!==(l=null===(c=r.unstablePrefixes)||void 0===c?void 0:c.every((t=>{var n;return!0===(null===(n=e.unstable_features)||void 0===n?void 0:n[t])})))&&void 0!==l&&l;d?t.set(n,i.Stable):u?t.set(n,i.Unstable):t.set(n,i.Unsupported)}return t}))).apply(this,arguments)}},310:(e,t,n)=>{"use strict";n.d(t,{d:()=>d});var r=n(4980),i=n(5155),o=n(441);class a{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,n,r=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},i=Object.keys(r),a=[];return this.userId&&null!=r&&null!==(n=r[o.RN.name])&&void 0!==n&&n.current_user_participated&&a.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,i,a)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[o.o1.name]:this.filterJson[o.o1.name]||[],[o.H.name]:this.filterJson[o.H.name]||[]}}checkFields(e,t,n,r,i,a){var s={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){var n=t.slice(0,-1);return e.slice(0,n.length)===n}return e===t}(n,e)}};for(var l in s){var c=s[l],d="not_"+l,u=this.filterJson[d];if(null!=u&&u.some(c))return!1;var h=this.filterJson[l];if(h&&!h.some(c))return!1}var p=this.filterJson.contains_url;if(void 0!==p&&p!==r)return!1;var v=this.filterJson[o.H.name];if(void 0!==v&&!this.arrayMatchesFilter(v,i))return!1;var m=this.filterJson[o.o1.name];return!(void 0!==m&&!this.arrayMatchesFilter(m,a))}arrayMatchesFilter(e,t){return t.length>0&&e.every((e=>t.includes(e)))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){for(var r=t.split("."),i=e,o=0;o<r.length-1;o++)i[r[o]]||(i[r[o]]={}),i=i[r[o]];i[r[r.length-1]]=n}class d{static fromJson(e,t,n){var r=new d(e,t);return r.setDefinition(n),r}constructor(e,t){this.userId=e,this.filterId=t,(0,r.A)(this,"definition",{}),(0,r.A)(this,"roomFilter",void 0),(0,r.A)(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new a(n,this.userId),this.roomTimelineFilter=new a((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){c(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var t,n;this.definition=l(l({},this.definition),{},{room:l(l({},null===(t=this.definition)||void 0===t?void 0:t.room),{},{timeline:l(l({},null===(n=this.definition)||void 0===n||null===(n=n.room)||void 0===n?void 0:n.timeline),{},{[i.a.name]:e})})})}setLazyLoadMembers(e){c(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){c(this.definition,"room.include_leave",e)}}(0,r.A)(d,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})},3719:(e,t,n)=>{"use strict";n.d(t,{Hl:()=>a,Rc:()=>c,eM:()=>l,up:()=>s});var r=n(4980);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class a extends Error{constructor(e,t,n){super(e),this.httpStatus=t,this.httpHeaders=n}isRateLimitError(){return 429===this.httpStatus}getRetryAfterMs(){var e,t=null===(e=this.httpHeaders)||void 0===e?void 0:e.get("Retry-After");if(null!=t){if(/^\d+$/.test(t)){var n=1e3*Number.parseInt(t);if(!Number.isFinite(n))throw new Error("Retry-After header integer value is too large");return n}var r=new Date(t);if(r.toUTCString()!==t)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return r.getTime()-Date.now()}return null}}class s extends a{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=e.error||"Unknown message";t&&(a="[".concat(t,"] ").concat(a)),n&&(a="".concat(a," (").concat(n,")")),super("MatrixError: ".concat(a),t,o),this.url=n,this.event=i,(0,r.A)(this,"errcode",void 0),(0,r.A)(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return"M_LIMIT_EXCEEDED"===this.errcode||("M_UNKNOWN"===this.errcode||void 0===this.errcode)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(null!==e)return e;if("M_LIMIT_EXCEEDED"===this.errcode&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,t,n,r,i={};if(this.httpHeaders)for(var[a,s]of this.httpHeaders)i[a]=s;return{http_status:null!==(e=this.httpStatus)&&void 0!==e?e:400,http_headers:i,url:null!==(t=this.url)&&void 0!==t?t:"",response:o({errcode:null!==(n=this.errcode)&&void 0!==n?n:"M_UNKNOWN",error:null!==(r=this.data.error)&&void 0!==r?r:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new s(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function l(e,t){if(!(e instanceof a&&e.isRateLimitError()))return t;try{var n;return null!==(n=e.getRetryAfterMs())&&void 0!==n?n:t}catch(e){return t}}class c extends Error{constructor(e,t){super(e+(t?": ".concat(t.message):""))}get name(){return"ConnectionError"}}},9521:(e,t,n)=>{"use strict";n.d(t,{iD:()=>S,Rc:()=>s.Rc,Hl:()=>s.Hl,XD:()=>l,Pw:()=>C,up:()=>s.up,ED:()=>D,zs:()=>w,IT:()=>a,JG:()=>h,fZ:()=>f,xy:()=>p,Y6:()=>m,eM:()=>s.eM,_:()=>u});var r=n(4980),i=n(467),o=n(3883),a=function(e){return e.Get="GET",e.Put="PUT",e.Post="POST",e.Delete="DELETE",e.Options="OPTIONS",e.Head="HEAD",e.Patch="PATCH",e}({}),s=n(3719),l=function(e){return e.SessionLoggedOut="Session.logged_out",e.NoConsent="no_consent",e}({}),c=n(8597),d=n(3840);function u(e){var t=new AbortController;return setTimeout((()=>{t.abort()}),e),t.signal}function h(e){var t=new AbortController;function n(){for(var t of e)t.removeEventListener("abort",r)}function r(){t.abort(),n()}for(var i of e){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:t.signal,cleanup:n}}function p(e,t){var n,r,i,o=v(e)?new Headers(e.getAllResponseHeaders().trim().split(/[\r\n]+/).map((e=>{var t=e.indexOf(":");return[e.substring(0,t),e.substring(t+1)]}))):e.headers;try{i=function(e){var t=e.get("Content-Type");if(null===t)return null;try{return(0,c.q)(t)}catch(e){throw new Error("Error parsing Content-Type '".concat(t,"': ").concat(e))}}(o)}catch(e){return e}return"application/json"===(null===(n=i)||void 0===n?void 0:n.type)&&t?new s.up(JSON.parse(t),e.status,v(e)?e.responseURL:e.url,void 0,o):"text/plain"===(null===(r=i)||void 0===r?void 0:r.type)?new s.Hl("Server returned ".concat(e.status," error: ").concat(t),e.status,o):new s.Hl("Server returned ".concat(e.status," error"),e.status,o)}function v(e){return"getResponseHeader"in e}function m(e,t){return g.apply(this,arguments)}function g(){return(g=(0,i.A)((function*(e,t){for(var n=0,r=null;n<e;)try{if(n>0){var i=1e3*Math.pow(2,n);d.v.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield(0,o.yy)(i)}return yield t()}catch(e){if(!(e instanceof s.Rc))throw e;n+=1,r=e}throw r}))).apply(this,arguments)}function f(e,t,n){return t>4||e instanceof s.Rc&&!n||e.httpStatus&&4===Math.floor(e.httpStatus/100)&&429!==e.httpStatus||"AbortError"===e.name||"M_TOO_LARGE"===e.name?-1:(0,s.eM)(e,1e3*Math.pow(2,t))}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class E{constructor(e,t){var n;this.eventEmitter=e,this.opts=t,(0,r.A)(this,"abortController",new AbortController),(0,o.UB)(t,["baseUrl","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=null===(n=t.useAuthorizationHeader)||void 0===n||n}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,t){return this.opts.fetchFn?this.opts.fetchFn(e,t):globalThis.fetch(e,t)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,t,n,r,i){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,s=void 0;e===a.Get?o=n:s=n;var l=this.getUrl(t,o,r,this.opts.idBaseUrl),c={json:!0,headers:{}};return i&&(c.headers.Authorization="Bearer ".concat(i)),this.requestOtherUrl(e,l,s,c)}authedRequest(e,t,n,r){var o=arguments,a=this;return(0,i.A)((function*(){var i=o.length>4&&void 0!==o[4]?o[4]:{};n||(n={});var s=_({},i);a.opts.accessToken&&(a.opts.useAuthorizationHeader?(s.headers||(s.headers={}),s.headers.Authorization||(s.headers.Authorization="Bearer "+a.opts.accessToken),n.access_token&&delete n.access_token):n.access_token||(n.access_token=a.opts.accessToken));try{return yield a.request(e,t,n,r,s)}catch(o){var c=o;if("M_UNKNOWN_TOKEN"===c.errcode&&!s.doNotAttemptTokenRefresh&&(yield a.tryRefreshToken()))return a.authedRequest(e,t,n,r,_(_({},i),{},{doNotAttemptTokenRefresh:!0}));throw"M_UNKNOWN_TOKEN"!=c.errcode||null!=s&&s.inhibitLogoutEmit?"M_CONSENT_NOT_GIVEN"==c.errcode&&a.eventEmitter.emit(l.NoConsent,c.message,c.data.consent_uri):a.eventEmitter.emit(l.SessionLoggedOut,c),c}}))()}tryRefreshToken(){var e=this;return(0,i.A)((function*(){if(!e.opts.refreshToken||!e.opts.tokenRefreshFunction)return!1;try{var{accessToken:t,refreshToken:n}=yield e.opts.tokenRefreshFunction(e.opts.refreshToken);return e.opts.accessToken=t,e.opts.refreshToken=n,!0}catch(t){var r;return null===(r=e.opts.logger)||void 0===r||r.warn("Failed to refresh token",t),!1}}))()}request(e,t,n,r,i){var o=this.getUrl(t,n,null==i?void 0:i.prefix,null==i?void 0:i.baseUrl);return this.requestOtherUrl(e,o,r,i)}requestOtherUrl(e,t,n){var r=arguments,o=this;return(0,i.A)((function*(){var i,a,l,c,d,v=r.length>3&&void 0!==r[3]?r[3]:{},m=o.sanitizeUrlForLogs(t);null===(i=o.opts.logger)||void 0===i||i.debug("FetchHttpApi: --\x3e ".concat(e," ").concat(m));var g=Object.assign({},v.headers||{}),f=null===(a=v.json)||void 0===a||a,y=f&&(null==n||null===(l=n.constructor)||void 0===l?void 0:l.name)===Object.name;f&&(y&&!g["Content-Type"]&&(g["Content-Type"]="application/json"),g.Accept||(g.Accept="application/json"));var _,E=null!==(c=v.localTimeoutMs)&&void 0!==c?c:o.opts.localTimeoutMs,b=null!==(d=v.keepAlive)&&void 0!==d&&d,S=[o.abortController.signal];void 0!==E&&S.push(u(E)),v.abortSignal&&S.push(v.abortSignal),_=y?JSON.stringify(n):n;var C,{signal:w,cleanup:A}=h(S),T=Date.now();try{var I;C=yield o.fetch(t,{signal:w,method:e,body:_,headers:g,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:b,priority:v.priority}),null===(I=o.opts.logger)||void 0===I||I.debug("FetchHttpApi: <-- ".concat(e," ").concat(m," [").concat(Date.now()-T,"ms ").concat(C.status,"]"))}catch(t){var k;if(null===(k=o.opts.logger)||void 0===k||k.debug("FetchHttpApi: <-- ".concat(e," ").concat(m," [").concat(Date.now()-T,"ms ").concat(t,"]")),"AbortError"===t.name)throw t;throw new s.Rc("fetch failed",t)}finally{A()}if(!C.ok)throw p(C,yield C.text());return o.opts.onlyData?f?C.json():C.text():C}))()}sanitizeUrlForLogs(e){try{var t;t="string"==typeof e?new URL(e):e;var n=new URLSearchParams;for(var r of t.searchParams.keys())n.append(r,"xxx");var i=n.toString(),o=i?"?".concat(i):"";return t.origin+t.pathname+o}catch(e){return"??"}}getUrl(e,t,n,r){var i=null!=r?r:this.opts.baseUrl,a=i.endsWith("/")?i.slice(0,-1):i,s=new URL(a+(null!=n?n:this.opts.prefix)+e);return t&&(0,o.hm)(t,s.searchParams),s}}var b,S=function(e){return e.V1="/_matrix/client/v1",e.V3="/_matrix/client/v3",e.Unstable="/_matrix/client/unstable",e}({}),C=function(e){return e.V2="/_matrix/identity/v2",e}({}),w=function(e){return e.V1="/_matrix/media/v1",e.V3="/_matrix/media/v3",e}({}),A=1e3,T=0,I=[],k=function(){};function O(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];(t=t||0)<0&&(t=0);var o=Date.now()+t,a=T++;k("setTimeout: scheduling cb",a,"at",o,"(delay",t,")");var s={runAt:o,func:e,params:r,key:a},l=function(e){for(var t=0,n=e.length;t<n;){var r=t+n>>1;e[r].runAt-o>0?n=r:t=r+1}return t}(I);return I.splice(l,0,s),x(),a}function R(e){if(0!==I.length){var t;for(t=0;t<I.length;t++)if(I[t].key==e){I.splice(t,1);break}0===t&&x()}}function x(){b&&globalThis.clearTimeout(b);var e=I[0];if(e){var t=Date.now(),n=Math.min(e.runAt-t,A);k("scheduleRealCallback: now:",t,"delay:",n),b=globalThis.setTimeout(N,n)}else k("scheduleRealCallback: no more callbacks, not rescheduling")}function N(){var e=Date.now();k("runCallbacks: now:",e);for(var t=[];;){var n=I[0];if(!n||n.runAt>e)break;var r=I.shift();k("runCallbacks: popping",r.key),t.push(r)}for(var i of(x(),t))try{i.func.apply(globalThis,i.params)}catch(e){d.v.error("Uncaught exception in callback function",e)}}class D extends E{constructor(){super(...arguments),(0,r.A)(this,"uploads",[])}uploadContent(e){var t,n,r,i,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=null===(t=l.includeFilename)||void 0===t||t,d=null!==(n=l.abortController)&&void 0!==n?n:new AbortController,u=(null!==(r=l.type)&&void 0!==r?r:e.type)||"application/octet-stream",h=null!==(i=l.name)&&void 0!==i?i:e.name,v={loaded:0,total:0,abortController:d},m=(0,o.v6)();if(globalThis.XMLHttpRequest){var g=new globalThis.XMLHttpRequest,f=function(){g.abort(),m.reject(new Error("Timeout"))},y=O(f,3e4);g.onreadystatechange=function(){if(g.readyState===globalThis.XMLHttpRequest.DONE){R(y);try{if(0===g.status)throw new DOMException(g.statusText,"AbortError");if(!g.responseText)throw new Error("No response body.");g.status>=400?m.reject(p(g,g.responseText)):m.resolve(JSON.parse(g.responseText))}catch(e){if("AbortError"===e.name)return void m.reject(e);m.reject(new s.Rc("request failed",e))}}},g.upload.onprogress=e=>{var t;R(y),v.loaded=e.loaded,v.total=e.total,y=O(f,3e4),null===(t=l.progressHandler)||void 0===t||t.call(l,{loaded:e.loaded,total:e.total})};var _=this.getUrl("/upload",void 0,w.V3);c&&h&&_.searchParams.set("filename",encodeURIComponent(h)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&_.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),g.open(a.Post,_.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&g.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),g.setRequestHeader("Content-Type",u),g.send(e),d.signal.addEventListener("abort",(()=>{g.abort()}))}else{var E={};c&&h&&(E.filename=h);var b={"Content-Type":u};this.authedRequest(a.Post,"/upload",E,e,{prefix:w.V3,headers:b,abortSignal:d.signal}).then((e=>this.opts.onlyData?e:e.json())).then(m.resolve,m.reject)}return v.promise=m.promise.finally((()=>{(0,o.Nz)(this.uploads,(e=>e===v))})),d.signal.addEventListener("abort",(()=>{(0,o.Nz)(this.uploads,(e=>e===v)),m.reject(new DOMException("Aborted","AbortError"))})),this.uploads.push(v),v.promise}cancelUpload(e){var t=this.uploads.find((t=>t.promise===e));return!!t&&(t.abortController.abort(),!0)}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:w.V3+"/upload",params:{access_token:this.opts.accessToken}}}}},7501:(e,t,n)=>{"use strict";function r(e,t){return new Promise(((n,r)=>{var i=!0,o=e.open(t);o.onupgradeneeded=()=>{i=!1},o.onblocked=()=>r(o.error),o.onsuccess=()=>{o.result.close(),i||e.deleteDatabase(t),n(i)},o.onerror=()=>r(o.error)}))}n.d(t,{t:()=>r})},3840:(e,t,n)=>{"use strict";n.d(t,{T:()=>s,v:()=>a});var r=n(4980),i=n(3065),o="matrix";i.methodFactory=function(e,t,n){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.prefix&&n.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e||"debug"===e?console[e](...n):console.log(...n)}};var a=i.getLogger(o);a.setLevel(i.levels.DEBUG,!1),function e(t){var n=t;n.getChild=n.withPrefix=function(t){return function(t){var n=i.getLogger("".concat(o,"-").concat(t));return n.prefix!==t&&(e(n),n.prefix=t,n.setLevel(i.levels.DEBUG,!1)),n}((this.prefix||"")+t)}}(a);class s{constructor(e,t){this.parent=e,(0,r.A)(this,"name",void 0),this.name=t+":"}trace(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.trace(this.name,...t)}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.debug(this.name,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.info(this.name,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.warn(this.name,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.parent.error(this.name,...t)}}},3337:(e,t,n)=>{"use strict";n.d(t,{HF:()=>d,JH:()=>s,M9:()=>c,ai:()=>l});var r=n(4980),i=n(2027),o=n(3883),a=n(6387),s=function(e){return e.New="Beacon.new",e.Update="Beacon.update",e.LivenessChange="Beacon.LivenessChange",e.Destroy="Beacon.Destroy",e.LocationUpdate="Beacon.LocationUpdate",e}({}),l=(e,t,n)=>n>=e&&e+t>=n,c=e=>"".concat(e.getRoomId(),"_").concat(e.getStateKey());class d extends a.X{constructor(e){super(),this.rootEvent=e,(0,r.A)(this,"roomId",void 0),(0,r.A)(this,"_beaconInfo",void 0),(0,r.A)(this,"_isLive",void 0),(0,r.A)(this,"livenessWatchTimeout",void 0),(0,r.A)(this,"_latestLocationEvent",void 0),(0,r.A)(this,"clearLatestLocation",(()=>{this._latestLocationEvent=void 0,this.emit(s.LocationUpdate,this.latestLocationState)})),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return c(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&(0,i.parseBeaconContent)(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(c(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(s.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(s.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout((()=>{this.monitorLiveness()}),this.beaconInfo.timestamp-Date.now()))}addLocations(e){var t;if(this.isLive){var n=null===(t=e.filter((e=>{var t=e.getContent(),n=(0,i.parseBeaconContent)(t);if(!n.uri||!n.timestamp)return!1;var{timestamp:r}=n;return this._beaconInfo.timestamp&&l(this._beaconInfo.timestamp,this._beaconInfo.timeout,r)&&(!this.latestLocationState||r>this.latestLocationState.timestamp)})).sort(o.Fq))||void 0===t?void 0:t[0];n&&(this._latestLocationEvent=n,this.emit(s.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=(0,i.parseBeaconInfoContent)(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var t=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!t&&l(t,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit(s.LivenessChange,this.isLive,this)}}}},7131:(e,t,n)=>{"use strict";n.d(t,{p:()=>o,u:()=>i});var r=n(4980),i=function(e){return e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified",e}({});class o{constructor(e){(0,r.A)(this,"deviceId",void 0),(0,r.A)(this,"userId",void 0),(0,r.A)(this,"algorithms",void 0),(0,r.A)(this,"keys",void 0),(0,r.A)(this,"verified",void 0),(0,r.A)(this,"signatures",void 0),(0,r.A)(this,"displayName",void 0),(0,r.A)(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||i.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}},9608:(e,t,n)=>{"use strict";n.d(t,{f:()=>r});var r=function(e){return e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled",e}({})},1200:(e,t,n)=>{"use strict";n.d(t,{m:()=>u,x:()=>d});var r,i=n(4980),o=n(8221),a=n(3840),s=n(4659),l=n(6387),c=n(2866);r=a.v.log.bind(a.v);var d=function(e){return e.Ignore="ignore",e.Replace="replace",e}({});class u extends l.X{constructor(e){var t,n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.room=e,this.thread=l,this.threadListType=d,(0,i.A)(this,"relations",void 0),(0,i.A)(this,"timelineSupport",void 0),(0,i.A)(this,"displayPendingEvents",void 0),(0,i.A)(this,"liveTimeline",void 0),(0,i.A)(this,"timelines",void 0),(0,i.A)(this,"_eventIdToTimeline",new Map),(0,i.A)(this,"filter",void 0),this.timelineSupport=Boolean(a.timelineSupport),this.liveTimeline=new o.q(this),this.displayPendingEvents=!1!==a.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=a.filter,this.relations=null!==(t=null===(n=this.room)||void 0===n?void 0:n.relations)&&void 0!==t?t:new c.t(null!==(r=null==e?void 0:e.client)&&void 0!==r?r:s)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return this.room&&this.displayPendingEvents?this.room.getPendingEvents():[]}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,t){var n=this._eventIdToTimeline.get(e);n&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(t,n))}resetLiveTimeline(e,t){var n=!this.timelineSupport||!t,r=this.liveTimeline,i=n?r.forkLive(o.q.FORWARDS):r.fork(o.q.FORWARDS);n?(this.timelines=[i],this._eventIdToTimeline=new Map):this.timelines.push(i),t&&r.setPaginationToken(t,o.q.FORWARDS),i.setPaginationToken(null!=e?e:null,o.q.BACKWARDS),this.liveTimeline=i,this.emit(s.u9.TimelineReset,this.room,this,n)}getTimelineForEvent(e){if(null==e)return null;var t=this._eventIdToTimeline.get(e);return void 0===t?null:t}findEventById(e){var t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new o.q(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,n,i,s){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!this.filter||(e=this.filter.filterRoomTimeline(e)).length){var l=t?o.q.BACKWARDS:o.q.FORWARDS,c=t?o.q.FORWARDS:o.q.BACKWARDS,d=!1,u=!1;for(var h of e){var p=h.getId(),v=this._eventIdToTimeline.get(p);if(v)if(u=!1,v!=i){var m=i.getNeighbouringTimeline(l);if(m)r(v==m?"Event "+p+" in neighbouring timeline - switching to "+v:"Event "+p+" already in a different timeline "+v),i=v;else{a.v.info("Already have timeline for "+p+" - joining timeline "+i+" to "+v);var g=v===this.liveTimeline,f=i===this.liveTimeline,y=l===o.q.BACKWARDS&&g,_=l===o.q.FORWARDS&&f;y||_?(y&&a.v.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+v+")"),_&&a.v.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")")):(i.setNeighbouringTimeline(v,l),v.setNeighbouringTimeline(i,c),i=v,d=!0)}}else r("Event "+p+" already in timeline "+i);else this.addEventToTimeline(h,i,{toStartOfTimeline:t,addToState:n}),u=!0,d=!0}if(u||!d){if(l===o.q.FORWARDS&&i===this.liveTimeline)return a.v.warn({lastEventWasNew:u,didUpdate:d}),void a.v.warn("Refusing to set forwards pagination token of live timeline "+"".concat(i," to ").concat(s));i.setPaginationToken(null!=s?s:null,l)}}}addLiveEvent(e,t){var{duplicateStrategy:n,fromCache:i,roomState:a,timelineWasEmpty:s,addToState:l}=t;if(!this.filter||this.filter.filterRoomTimeline([e]).length){var c=this._eventIdToTimeline.get(e.getId());if(c)if(n===d.Replace){r("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var u=c.getEvents(),h=0;h<u.length;h++)if(u[h].getId()===e.getId()){a||(a=c.getState(o.q.FORWARDS)),o.q.setEventMetadata(e,a,!1),u[h]=e;break}}else r("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:i,roomState:a,timelineWasEmpty:s,addToState:l})}}addEventToTimeline(e,t,n){var r,{toStartOfTimeline:i,fromCache:o=!1,roomState:l,timelineWasEmpty:c,addToState:d}=n;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(r=this.thread)||void 0===r?void 0:r.id,")"));var u=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var h,p="event=".concat(u);return e.threadRootId&&(p+="(belongs to thread=".concat(e.threadRootId,")")),void a.v.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(p," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(h=this.thread)||void 0===h?void 0:h.id,")"))}t.addEvent(e,{toStartOfTimeline:i,roomState:l,timelineWasEmpty:c,addToState:d}),this._eventIdToTimeline.set(u,t);var v={timeline:t,liveEvent:!i&&t==this.liveTimeline&&!o};this.emit(s.u9.Timeline,e,this.room,Boolean(i),!1,v)}insertEventIntoTimeline(e,t,n,r){var i;if(t.getTimelineSet()!==this)throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(t.toString(),' does not belong " +\n                "in timelineSet(threadId=').concat(null===(i=this.thread)||void 0===i?void 0:i.id,")"));var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var l,c="event=".concat(o);return e.threadRootId&&(c+="(belongs to thread=".concat(e.threadRootId,")")),void a.v.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(c," that does not belong ")+"in timeline=".concat(t.toString()," timelineSet(threadId=").concat(null===(l=this.thread)||void 0===l?void 0:l.id,")"))}var d=e.relationEventId;if(d){for(var u=this.findEventById(d),h=t.getEvents(),p=void 0!==u?h.indexOf(u):0;p<h.length&&!(h[p].getTs()>e.getTs());p++);t.insertEvent(e,p,n,r),this._eventIdToTimeline.set(o,t);var v={timeline:t,liveEvent:!1};this.emit(s.u9.Timeline,e,this.room,!1,!1,v)}else this.addEventToTimeline(e,t,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:n,addToState:r})}handleRemoteEcho(e,t,n){var r=this._eventIdToTimeline.get(t);r?(this._eventIdToTimeline.delete(t),this._eventIdToTimeline.set(n,r)):this.filter&&!this.filter.filterRoomTimeline([e]).length||this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var t=this._eventIdToTimeline.get(e);if(!t)return null;var n=t.removeEvent(e);if(n){this._eventIdToTimeline.delete(e);var r={timeline:t};this.emit(s.u9.Timeline,n,this.room,void 0,!0,r)}return n}compareEventOrdering(e,t){if(e==t)return 0;var n=this._eventIdToTimeline.get(e),r=this._eventIdToTimeline.get(t);if(void 0===n)return null;if(void 0===r)return null;if(n===r){for(var i=void 0,a=void 0,s=n.getEvents(),l=0;l<s.length&&(void 0===i||void 0===a);l++){var c=s[l].getId();c==e&&(i=l),c==t&&(a=l)}var d=i-a;return d<0?-1:d>0?1:0}for(var u=n;u;){if(u===r)return-1;u=u.getNeighbouringTimeline(o.q.FORWARDS)}for(u=n;u;){if(u===r)return 1;u=u.getNeighbouringTimeline(o.q.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var t,{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);return this.thread?this.thread.id===n:(r||i||a.v.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat(null===(t=this.room)||void 0===t?void 0:t.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId)),r)}}},8221:(e,t,n)=>{"use strict";n.d(t,{O:()=>a,q:()=>s});var r=n(4980),i=n(6122),o=n(2986),a=function(e){return e.Backward="b",e.Forward="f",e}({});class s{static setEventMetadata(e,t,n){e.setMetadata(t,n)}constructor(e){var t,n;this.eventTimelineSet=e,(0,r.A)(this,"roomId",void 0),(0,r.A)(this,"name",void 0),(0,r.A)(this,"events",[]),(0,r.A)(this,"baseIndex",0),(0,r.A)(this,"startState",void 0),(0,r.A)(this,"endState",void 0),(0,r.A)(this,"startToken",null),(0,r.A)(this,"endToken",null),(0,r.A)(this,"prevTimeline",null),(0,r.A)(this,"nextTimeline",null),(0,r.A)(this,"paginationRequests",{[a.Backward]:null,[a.Forward]:null}),this.roomId=null!==(t=null===(n=e.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null,this.roomId&&(this.startState=new i.H(this.roomId),this.endState=new i.H(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e){var t,n,{timelineWasEmpty:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");null===(t=this.startState)||void 0===t||t.setStateEvents(e,{timelineWasEmpty:r}),null===(n=this.endState)||void 0===n||n.setStateEvents(e,{timelineWasEmpty:r})}forkLive(e){var t=this.getState(e),n=new s(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=t,this.endState=null==t?void 0:t.clone(),n}fork(e){var t=this.getState(e),n=new s(this.eventTimelineSet);return n.startState=null==t?void 0:t.clone(),n.endState=null==t?void 0:t.clone(),n}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==s.BACKWARDS)return this.startState;if(e==s.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===a.Backward?this.startToken:this.endToken}setPaginationToken(e,t){this.roomId?this.getState(t).paginationToken=e:t===a.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==s.BACKWARDS)return this.prevTimeline;if(e==s.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==s.BACKWARDS)this.prevTimeline=e;else{if(t!=s.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t){var{toStartOfTimeline:n,roomState:r,timelineWasEmpty:i,addToState:a}=t;r||(r=n?this.startState:this.endState);var l,c,d=this.getTimelineSet();d.room&&(s.setEventMetadata(e,r,n),a&&e.isState()&&d.room.getUnfilteredTimelineSet()===d&&(null===(l=r)||void 0===l||l.setStateEvents([e],{timelineWasEmpty:i}),e.sender&&(e.getType()!==o.Bx.RoomMember||n)||s.setEventMetadata(e,r,n))),c=n?0:this.events.length,this.events.splice(c,0,e),n&&this.baseIndex++}insertEvent(e,t,n,r){var i=this.getTimelineSet();i.room&&(s.setEventMetadata(e,n,!1),r&&e.isState()&&i.room.getUnfilteredTimelineSet()===i&&(n.setStateEvents([e],{}),e.sender&&e.getType()!==o.Bx.RoomMember||s.setEventMetadata(e,n,!1))),this.events.splice(t,0,e)}removeEvent(e){for(var t=this.events.length-1;t>=0;t--){var n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}toString(){return this.name}}(0,r.A)(s,"BACKWARDS",a.Backward),(0,r.A)(s,"FORWARDS",a.Forward)},9561:(e,t,n)=>{"use strict";n.d(t,{OQ:()=>f,fb:()=>m.f,kl:()=>y});var r=n(467),i=n(4980),o=n(9787),a=n(3840),s=n(2986),l=n(3883),c=n(441),d=n(4831),u=n(6387),h=n(6215),p=n(8221),v=n(8417),m=n(9608),g=Object.freeze({visible:!0}),f=function(e){return e.Decrypted="Event.decrypted",e.BeforeRedaction="Event.beforeRedaction",e.VisibilityChange="Event.visibilityChange",e.LocalEventIdReplaced="Event.localEventIdReplaced",e.Status="Event.status",e.Replaced="Event.replaced",e.RelationsCreated="Event.relationsCreated",e.SentinelUpdated="Event.sentinelUpdated",e}({});class y extends u.X{setMetadata(e,t){var n,r,i=this.isState()&&this.getType()===s.Bx.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(i||null===(n=this.sender)||void 0===n||null===(n=n.events)||void 0===n||!n.member){var a=e.getSentinelMember(this.getSender());a!==this.sender&&(o=!0),this.sender=a}if(i||(null===(r=this.target)||void 0===r||null===(r=r.events)||void 0===r||!r.member)&&this.getType()===s.Bx.RoomMember){var l=e.getSentinelMember(this.getStateKey());l!==this.target&&(o=!0),this.target=l}this.isState()&&t&&(this.forwardLooking=!1),o&&this.emit(f.SentinelUpdated)}constructor(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.event=t,(0,i.A)(this,"pushDetails",{}),(0,i.A)(this,"_replacingEvent",null),(0,i.A)(this,"_localRedactionEvent",null),(0,i.A)(this,"_isCancelled",!1),(0,i.A)(this,"clearEvent",void 0),(0,i.A)(this,"visibility",g),(0,i.A)(this,"_hasCachedExtEv",!1),(0,i.A)(this,"_cachedExtEv",void 0),(0,i.A)(this,"_decryptionFailureReason",null),(0,i.A)(this,"senderCurve25519Key",null),(0,i.A)(this,"claimedEd25519Key",null),(0,i.A)(this,"forwardingCurve25519KeyChain",[]),(0,i.A)(this,"untrusted",null),(0,i.A)(this,"decryptionPromise",null),(0,i.A)(this,"retryDecryption",!1),(0,i.A)(this,"txnId",void 0),(0,i.A)(this,"thread",void 0),(0,i.A)(this,"threadId",void 0),(0,i.A)(this,"localTimestamp",void 0),(0,i.A)(this,"sender",null),(0,i.A)(this,"target",null),(0,i.A)(this,"status",null),(0,i.A)(this,"error",null),(0,i.A)(this,"forwardLooking",!0),(0,i.A)(this,"verificationRequest",void 0),(0,i.A)(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((e=>{"string"==typeof t[e]&&(t[e]=(0,l.yD)(t[e]))})),["membership","avatar_url","displayname"].forEach((e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n?void 0:n[e])&&(t.content[e]=(0,l.yD)(t.content[e]))})),["rel_type"].forEach((e=>{var n;"string"==typeof(null===(n=t.content)||void 0===n||null===(n=n["m.relates_to"])||void 0===n?void 0:n[e])&&(t.content["m.relates_to"][e]=(0,l.yD)(t.content["m.relates_to"][e]))})),this.txnId=t.txn_id;var n=this.getAge();this.localTimestamp=void 0!==n?Date.now()-n:null!==(e=this.getTs())&&void 0!==e?e:Date.now(),this.reEmitter=new d.Q(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=o.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===s.Bx.RoomMessageEncrypted)for(var[t,n]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=n);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e,t=this.getRoomId();if(t)return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(t," ts=").concat(null===(e=this.getDate())||void 0===e?void 0:e.toISOString());var n=this.getContent()[s.wt];return"msgid=".concat(n," type=").concat(this.getWireType()," sender=").concat(this.getSender())}getOriginalContent(){var e,t;return this._localRedactionEvent?{}:this.clearEvent?null!==(t=this.clearEvent.content)&&void 0!==t?t:{}:null!==(e=this.event.content)&&void 0!==e?e:{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?null!==(e=this._replacingEvent.getContent()["m.new_content"])&&void 0!==e?e:{}:this.getOriginalContent();var e}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];if((null==t?void 0:t.rel_type)===c.RN.name)return t.event_id;if(this.thread)return this.thread.id;if(void 0!==this.threadId)return this.threadId;var n=this.getUnsigned();return"string"==typeof n[s.Sr.name]?n[s.Sr.name]:void 0}}get isThreadRoot(){return!(this.isState()||!this.getServerAggregatedRelation(c.RN.name)&&this.threadRootId!==this.getId())}get replyEventId(){var e;return null===(e=this.getWireContent()["m.relates_to"])||void 0===e||null===(e=e["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e;return null===(e=this.getWireContent())||void 0===e||null===(e=e["m.relates_to"])||void 0===e?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}getMembershipAtEvent(){var e=this.getUnsigned();return s.SY.findIn(e)}makeEncrypted(e,t,n,r){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=r}isBeingDecrypted(){return null!=this.decryptionPromise}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return null!==this._decryptionFailureReason}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===v.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(!n.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var i=n.clearEvent&&!n.isDecryptionFailure(),o=r.forceRedecryptIfUntrusted&&n.isKeySourceUntrusted();if(i&&!o)throw new Error("Attempt to decrypt event which has already been decrypted");return n.decryptionPromise?(a.v.log("Event ".concat(n.getId()," already being decrypted; queueing a retry")),n.retryDecryption=!0,n.decryptionPromise):(n.decryptionPromise=n.decryptionLoop(e,r),n.decryptionPromise)}))()}cancelAndResendKeyRequest(e,t){var n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)}getKeyRequestRecipients(e){return[{userId:e,deviceId:"*"}]}decryptionLoop(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};for(yield Promise.resolve();;){n.retryDecryption=!1;var i=void 0;try{var o=yield e.decryptEvent(n);!0===r.isRetry&&a.v.info("Decrypted event on retry (".concat(n.getDetails(),")")),n.setClearData(o),n._decryptionFailureReason=null}catch(e){var s=e instanceof h.O?e.detailedString:String(e);if(i=e,n.retryDecryption){a.v.log("Error decrypting event (".concat(n.getDetails(),"), but retrying: ").concat(s));continue}a.v.warn("Error decrypting event (".concat(n.getDetails(),"): ").concat(s)),n.setClearDataForDecryptionFailure(String(e)),n._decryptionFailureReason=e instanceof h.O?e.code:v.DecryptionFailureCode.UNKNOWN_ERROR}return n.decryptionPromise=null,n.retryDecryption=!1,n.setPushDetails(),void(!1!==r.emit&&n.emit(f.Decrypted,n,i))}}))()}setClearData(e){var t,n;this.clearEvent=e.clearEvent,this.senderCurve25519Key=null!==(t=e.senderCurve25519Key)&&void 0!==t?t:null,this.claimedEd25519Key=null!==(n=e.claimedEd25519Key)&&void 0!==n?n:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:s.Bx.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===s.Bx.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(f.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var t,n,r=null===(t=null==e?void 0:e.visible)||void 0===t||t,i=null!==(n=null==e?void 0:e.reason)&&void 0!==n?n:null,o=!1;this.visibility.visible!==r?o=!0:this.visibility.visible||this.visibility.reason===i||(o=!0),o&&(this.visibility=r?g:Object.freeze({visible:!1,reason:i}),this.emit(f.VisibilityChange,this,r))}messageVisibility(){return this.visibility}makeRedacted(e,t){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");for(var n in this._localRedactionEvent=null,this.emit(f.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(n)&&!_.has(n)&&delete this.event[n];this.isEncrypted()&&(this.clearEvent=void 0);var r=this.getType()in E?E[this.getType()]:{},i=this.getContent();for(var o in i)i.hasOwnProperty(o)&&!r[o]&&delete i[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(t),e.moveToMainTimeline(t)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var t=this.thread;if(this.moveToMainTimeline(e),t)for(var n of t.events){var r;(null===(r=n.getRelation())||void 0===r?void 0:r.event_id)===this.getId()&&n.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var t;null===(t=this.thread)||void 0===t||t.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var n=e.getLiveTimeline();n.getTimelineSet().insertEventIntoTimeline(this,n,n.getState(p.q.FORWARDS),!1)}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return this.getType()===s.Bx.RoomRedaction}asVisibilityChange(){if(!s.Yg.matches(this.getType()))return null;var e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;var t=e.event_id;if(!t)return null;var n=this.getWireContent(),r=!!n.visible,i=n.reason;return i&&"string"!=typeof i?null:{visible:r,reason:i,eventId:t}}isVisibilityEvent(){return s.Yg.matches(this.getType())}getRedactionEvent(){var e,t,n,r;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null!==(n=null===(r=this.clearEvent)||void 0===r?void 0:r.unsigned.redacted_because)&&void 0!==n?n:null:null!==(t=this.event.unsigned)&&void 0!==t&&t.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,t){this.pushDetails={actions:e,rule:t}}handleRemoteEcho(e){var t,n=this.getUnsigned(),r=this.getId();this.event=e,n.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=n.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit(f.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(f.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(f.LocalEventIdReplaced,this)}isRelation(e){var t,n=null===(t=this.getWireContent())||void 0===t?void 0:t["m.relates_to"];return!(this.isState()&&null!=n&&n.rel_type&&[s.zZ.Replace,s.zZ.Thread].includes(n.rel_type)||null==n||!n.rel_type||!n.event_id||e&&n.rel_type!==e)}getRelation(){var e;return this.isRelation()&&null!==(e=this.getWireContent()["m.relates_to"])&&void 0!==e?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=null!=e?e:null,this.emit(f.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){var e=this.getServerAggregatedRelation(s.zZ.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(s.zZ.Replace);if(e){var t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent){var n;return null!==(n=this._replacingEvent.getDate())&&void 0!==n?n:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();return this.replyEventId?this.replyEventId:e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new y(JSON.parse(JSON.stringify(this.event)));for(var[t,n]of Object.entries(this))"event"!==t&&(e[t]=n);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var t=(0,l.hl)(this.event),n=(0,l.hl)(e.event);return JSON.stringify(t)===JSON.stringify(n)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[c.ju.Update]),this.thread=e,this.setThreadId(null==e?void 0:e.id),e&&this.reEmitter.reEmit(e,[c.ju.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}var _=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),E={[s.Bx.RoomMember]:{membership:1},[s.Bx.RoomJoinRules]:{join_rule:1},[s.Bx.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}}},3122:(e,t,n)=>{"use strict";n.d(t,{Jo:()=>s,NG:()=>o,Q5:()=>a,fx:()=>i});var r=n(9787),i=new r.UnstableValue("m.policies","org.matrix.msc3847.policies"),o=new r.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),a=function(e){return e.Ban="m.ban",e}({}),s=function(e){return e.User="m.policy.user",e.Room="m.policy.room",e.Server="m.policy.server",e}({})},1768:(e,t,n)=>{"use strict";n.d(t,{Wi:()=>h,sP:()=>u,sn:()=>c});var r=n(467),i=n(4980),o=n(9787),a=n(4744),s=n(9096),l=n(6387),c=function(e){return e.New="Poll.new",e.End="Poll.end",e.Update="Poll.update",e.Responses="Poll.Responses",e.Destroy="Poll.Destroy",e.UndecryptableRelations="Poll.UndecryptableRelations",e}({}),d=(e,t)=>({responseEvents:e.filter((e=>{if(!e.isDecryptionFailure())return a.qN.matches(e.getType())&&e.getTs()<=t}))});class u extends l.X{constructor(e,t,n){if(super(),this.rootEvent=e,this.matrixClient=t,this.room=n,(0,i.A)(this,"roomId",void 0),(0,i.A)(this,"pollEvent",void 0),(0,i.A)(this,"_isFetchingResponses",!1),(0,i.A)(this,"relationsNextBatch",void 0),(0,i.A)(this,"responses",null),(0,i.A)(this,"endEvent",void 0),(0,i.A)(this,"undecryptableRelationEventIds",new Set),(0,i.A)(this,"countUndecryptableEvents",(e=>{var t=e.filter((e=>e.isDecryptionFailure())).map((e=>e.getId())),n=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...t]),this.undecryptableRelationsCount!==n&&this.emit(c.UndecryptableRelations,this.undecryptableRelationsCount)})),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return null===(e=this.endEvent)||void 0===e?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return(0,r.A)((function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses}))()}onNewRelation(e){var t;if(a.cI.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(c.End)),this.responses){var n=(null===(t=this.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:r}=d([e],n);this.countUndecryptableEvents([e]),r.length&&(r.forEach((e=>{this.responses.addEvent(e)})),this.emit(c.Responses,this.responses))}}fetchResponses(){var e=this;return(0,r.A)((function*(){var t,n;e._isFetchingResponses=!0;var r=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(r.events.map((t=>e.matrixClient.decryptEventIfNeeded(t))));var i=e.responses||new s.s("m.reference",a.qN.name,e.matrixClient,[a.qN.altName]),o=r.events.find((e=>a.cI.matches(e.getType())));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(c.End));var l=(null===(t=e.endEvent)||void 0===t?void 0:t.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:u}=d(r.events,l);u.forEach((e=>{i.addEvent(e)})),e.relationsNextBatch=null!==(n=r.nextBatch)&&void 0!==n?n:void 0,e.responses=i,e.countUndecryptableEvents(r.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(c.Responses,e.responses)}))()}refilterResponsesOnEnd(){var e;if(this.responses){var t=(null===(e=this.endEvent)||void 0===e?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach((e=>{var n;e.getTs()>t&&(null===(n=this.responses)||void 0===n||n.removeEvent(e))})),this.emit(c.Responses,this.responses)}}validateEndEvent(e){if(!e)return!1;if(this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var t=this.room.currentState,n=e.getSender();return!!n&&(n===this.rootEvent.getSender()||t.maySendRedactionForEvent(this.rootEvent,n))}}var h=e=>{var t=e.getType();return o.M_POLL_START.matches(t)||a.qN.matches(t)||a.cI.matches(t)}},6600:(e,t,n)=>{"use strict";n.d(t,{D:()=>v,h:()=>m});var r=n(4980),i=n(6022),o=n(6387),a=n(3883),s=n(9561),l=n(2986),c=n(4659),d=n(3840),u=n(4792);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new s.kl({content:{[t.getId()]:{[n]:{[e]:p({ts:t.getTs()},!r&&{thread_id:(0,u.Xb)(t)})}}},type:l.Bx.Receipt,room_id:t.getRoomId()})}class m extends o.X{constructor(){super(...arguments),(0,r.A)(this,"receipts",new a.kG((()=>new Map))),(0,r.A)(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.L.Read,[a,s]=null!==(t=null===(n=this.receipts.get(o))||void 0===n?void 0:n.get(e))&&void 0!==t?t:[null,null];return r?a:null!=s?s:a}compareReceipts(e,t){var n;return null!==(n=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,t.eventId))&&void 0!==n?n:e.data.ts-t.data.ts}getEventReadUpTo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getLatestReceipt(e,t);return n&&this.receiptPointsAtConsistentEvent(n)?n.eventId:null}receiptPointsAtConsistentEvent(e){var t,n=this.findEventById(e.eventId);if(!n)return!1;if(null===(t=e.data)||void 0===t||!t.thread_id)return!0;if(e.data.thread_id===i.S){if((0,u.fN)(n))return!0}else if(n.threadRootId===e.data.thread_id)return!0;return d.v.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(n.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,t){var n,r,o,a=this.getReadReceiptForUserId(e,t,i.L.Read),s=this.getReadReceiptForUserId(e,t,i.L.ReadPrivate);return null!=a&&a.eventId&&null!=s&&s.eventId&&(o=this.compareReceipts(a,s)),o?null!==(r=o<0?s:a)&&void 0!==r?r:null:null!==(n=null!=s?s:a)&&void 0!==n?n:null}addReceiptToStructure(e,t,n,r,i){var o,a,s=this.receipts.getOrCreate(t),l=s.get(n);l||(l=[null,null],s.set(n,l));var c,d=l[0];i&&(d=null!==(c=l[1])&&void 0!==c?c:l[0]);var u={eventId:e,data:r};if(!(d&&this.compareReceipts(d,u)>=0)){var h=i?l[0]:u,p=i?u:l[1],v=null;h&&p&&(v=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,p.eventId));var m=null===v||v<0,g=null!==(o=l[1])&&void 0!==o?o:l[0];if(i&&m?l[1]=u:i||(l[0]=u,m||(l[1]=null)),g!==(null!==(a=l[1])&&void 0!==a?a:l[0])){if(g&&this.receiptCacheByEventId.get(g.eventId)){var f=g.eventId;this.receiptCacheByEventId.set(f,this.receiptCacheByEventId.get(f).filter((e=>e.type!==t||e.userId!==n))),this.receiptCacheByEventId.get(f).length<1&&this.receiptCacheByEventId.delete(f)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:n,type:t,data:r})}}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var t=this.getReadReceiptForUserId(e,!1),n=this.timeline[this.timeline.length-1];n&&(null==t?void 0:t.eventId)===n.getId()&&e===n.getSender()&&(this.setUnread(c.X5.Total,0),this.setUnread(c.X5.Highlight,0))}addLocalEchoReceipt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.addReceipt(v(e,t,n,r),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return(0,a.ll)(e.type)})).map((function(e){return e.userId}))}}},2866:(e,t,n)=>{"use strict";n.d(t,{t:()=>a});var r=n(4980),i=n(9096),o=n(9561);class a{constructor(e,t){this.client=e,this.room=t,(0,r.A)(this,"relations",new Map)}getChildEventsForEvent(e,t,n){var r;return null===(r=this.relations.get(e))||void 0===r||null===(r=r.get(t))||void 0===r?void 0:r.get(n)}getAllChildEventsForEvent(e){var t,n=null!==(t=this.relations.get(e))&&void 0!==t?t:new Map,r=[];for(var i of n.values())for(var o of i.values())r.push(...o.getRelations());return r}aggregateParentEvent(e){var t=this.relations.get(e.getId());if(t)for(var n of t.values())for(var r of n.values())r.setTargetEvent(e)}aggregateChildEvent(e,t){if(!e.isRedacted()&&e.status!==o.fb.CANCELLED){var n=e.getRelation();if(n){var r=()=>{e.isDecryptionFailure()?e.once(o.OQ.Decrypted,r):this.aggregateChildEvent(e,t)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption())e.once(o.OQ.Decrypted,r);else{var{event_id:a,rel_type:s}=n,l=e.getType(),c=this.relations.get(a);c||(c=new Map,this.relations.set(a,c));var d=c.get(s);d||(d=new Map,c.set(s,d));var u=d.get(l);if(!u){var h,p,v;u=new i.s(s,l,this.client),d.set(l,u);var m=null!==(h=this.room)&&void 0!==h?h:null==t?void 0:t.room,g=null!==(p=null!==(v=null==t?void 0:t.findEventById(a))&&void 0!==v?v:null==m?void 0:m.findEventById(a))&&void 0!==p?p:null==m?void 0:m.getPendingEvent(a);g&&u.setTargetEvent(g)}u.addEvent(e)}}}}}},9096:(e,t,n)=>{"use strict";n.d(t,{S:()=>d,s:()=>u});var r=n(467),i=n(4980),o=n(9561),a=n(3840),s=n(2986),l=n(6387),c=n(4659),d=function(e){return e.Add="Relations.add",e.Remove="Relations.remove",e.Redaction="Relations.redaction",e}({});class u extends l.X{constructor(e,t,n,a){var l;super(),l=this,this.relationType=e,this.eventType=t,this.altEventTypes=a,(0,i.A)(this,"relationEventIds",new Set),(0,i.A)(this,"relations",new Set),(0,i.A)(this,"annotationsByKey",{}),(0,i.A)(this,"annotationsBySender",{}),(0,i.A)(this,"sortedAnnotationsByKey",[]),(0,i.A)(this,"targetEvent",null),(0,i.A)(this,"creationEmitted",!1),(0,i.A)(this,"client",void 0),(0,i.A)(this,"onEventStatus",((e,t)=>{e.isSending()?t===o.fb.CANCELLED&&(e.removeListener(o.OQ.Status,this.onEventStatus),this.removeEvent(e)):e.removeListener(o.OQ.Status,this.onEventStatus)})),(0,i.A)(this,"onBeforeRedaction",function(){var e=(0,r.A)((function*(e){if(l.relations.has(e)){if(l.relations.delete(e),l.relationType===s.zZ.Annotation)l.removeAnnotationFromAggregation(e);else if(l.relationType===s.zZ.Replace&&l.targetEvent&&!l.targetEvent.isState()){var t=yield l.getLastReplacement();l.targetEvent.makeReplaced(t)}e.removeListener(o.OQ.BeforeRedaction,l.onBeforeRedaction),l.emit(d.Redaction,e)}}));return function(t){return e.apply(this,arguments)}}()),this.client=n instanceof c.Wv?n.client:n}addEvent(e){var t=this;return(0,r.A)((function*(){if(!t.relationEventIds.has(e.getId())){var n=e.getRelation();if(n){var r=n.rel_type,i=e.getType();if(t.relationType===r&&function(e,t){return[t,...arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]].includes(e)}(i,t.eventType,t.altEventTypes)){if(e.isSending()&&e.on(o.OQ.Status,t.onEventStatus),t.relations.add(e),t.relationEventIds.add(e.getId()),t.relationType===s.zZ.Annotation)t.addAnnotationToAggregation(e);else if(t.relationType===s.zZ.Replace&&t.targetEvent&&!t.targetEvent.isState()){var l=yield t.getLastReplacement();t.targetEvent.makeReplaced(l)}e.on(o.OQ.BeforeRedaction,t.onBeforeRedaction),t.emit(d.Add,e),t.maybeEmitCreated()}else a.v.error("Event relation info doesn't match this container")}else a.v.error("Event must have relation info")}}))()}removeEvent(e){var t=this;return(0,r.A)((function*(){if(t.relations.has(e)){if(t.relations.delete(e),t.relationType===s.zZ.Annotation)t.removeAnnotationFromAggregation(e);else if(t.relationType===s.zZ.Replace&&t.targetEvent&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();t.targetEvent.makeReplaced(n)}t.emit(d.Remove,e)}}))()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r||(r=this.annotationsByKey[n]=new Set,this.sortedAnnotationsByKey.push([n,r])),r.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{var n=e[1];return t[1].size-n.size}));var i=e.getSender(),o=this.annotationsBySender[i];o||(o=this.annotationsBySender[i]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var t,{key:n}=null!==(t=e.getRelation())&&void 0!==t?t:{};if(n){var r=this.annotationsByKey[n];r&&(r.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{var n=e[1];return t[1].size-n.size})));var i=e.getSender(),o=this.annotationsBySender[i];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==s.zZ.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==s.zZ.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return(0,r.A)((function*(){if(e.relationType!==s.zZ.Replace)return null;if(!e.targetEvent)return null;var t=e.targetEvent.getServerAggregatedRelation(s.zZ.Replace),n=null==t?void 0:t.origin_server_ts,r=e.getRelations().reduce(((t,r)=>r.getSender()!==e.targetEvent.getSender()||n&&n>r.getTs()||t&&t.getTs()>r.getTs()?t:r),null);return null!=r&&r.shouldAttemptDecryption()&&e.client.getCrypto()?yield r.attemptDecryption(e.client.getCrypto()):null!=r&&r.isBeingDecrypted()&&(yield r.getDecryptionPromise()),r}))()}setTargetEvent(e){var t=this;return(0,r.A)((function*(){if(!t.targetEvent){if(t.targetEvent=e,t.relationType===s.zZ.Replace&&!t.targetEvent.isState()){var n=yield t.getLastReplacement();n&&t.targetEvent.makeReplaced(n)}t.maybeEmitCreated()}}))()}maybeEmitCreated(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit(o.OQ.RelationsCreated,this.relationType,this.eventType))}}},6729:(e,t,n)=>{"use strict";n.d(t,{Y:()=>u,o:()=>d});var r=n(4980),i=n(6344),o=n(3883),a=n(3840),s=n(6387),l=n(2986),c=n(6560),d=function(e){return e.Membership="RoomMember.membership",e.Name="RoomMember.name",e.PowerLevel="RoomMember.powerLevel",e.Typing="RoomMember.typing",e}({});class u extends s.X{constructor(e,t){super(),this.roomId=e,this.userId=t,(0,r.A)(this,"_isOutOfBand",!1),(0,r.A)(this,"modified",-1),(0,r.A)(this,"requestedProfileInfo",!1),(0,r.A)(this,"typing",!1),(0,r.A)(this,"name",void 0),(0,r.A)(this,"rawDisplayName",void 0),(0,r.A)(this,"powerLevel",0),(0,r.A)(this,"powerLevelNorm",0),(0,r.A)(this,"user",void 0),(0,r.A)(this,"membership",void 0),(0,r.A)(this,"disambiguate",!1),(0,r.A)(this,"events",{}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){var n,r,i=null!==(n=e.getDirectionalContent().displayname)&&void 0!==n?n:"";if(e.getType()===l.Bx.RoomMember){this._isOutOfBand=!1,this.events.member=e;var s=this.membership;this.membership=e.getDirectionalContent().membership,void 0===this.membership&&a.v.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=function(e,t,n){if(!t||t===e)return!1;if(!n)return!1;var r=(0,o.Gp)(t);return!!r&&(!!h.test(r)||(!!p.test(t)||!!n.getUserIdsWithDisplayName(t).some((t=>t!==e))))}(this.userId,i,t);var c=this.name;this.name=function(e,t,n){return t&&t!==e?n?(0,o.d7)(t)+" ("+e+")":(0,o.Gp)(t)?(0,o.d7)(t):e:e}(this.userId,i,this.disambiguate),this.rawDisplayName=(0,o.d7)(null!==(r=e.getDirectionalContent().displayname)&&void 0!==r?r:""),this.rawDisplayName&&(0,o.Gp)(this.rawDisplayName)||(this.rawDisplayName=this.userId),s!==this.membership&&(this.updateModifiedTime(),this.emit(d.Membership,e,this,s)),c!==this.name&&(this.updateModifiedTime(),this.emit(d.Name,e,this,c))}}setPowerLevelEvent(e){if(e.getType()===l.Bx.RoomPowerLevels&&""===e.getStateKey()){var t=e.getDirectionalContent(),n=t.users_default||0,r=t.users||{};Object.values(r).forEach((e=>{n=Math.max(n,e)}));var i=this.powerLevel,o=this.powerLevelNorm;void 0!==r[this.userId]&&Number.isInteger(r[this.userId])?this.powerLevel=r[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),i===this.powerLevel&&o===this.powerLevelNorm||(this.updateModifiedTime(),this.emit(d.PowerLevel,e,this))}}setTypingEvent(e){if("m.typing"===e.getType()){var t=this.typing;this.typing=!1;var n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit(d.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===c.O.Leave&&void 0!==this.events.member&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,t=e.getContent(),n=e.getSender();if(t.membership===c.O.Join&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),t.membership===c.O.Invite&&t.is_direct)return n}}getAvatarUrl(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=this.getMxcAvatarUrl();return(l||o)&&(0,i.y)(e,l,t,n,r,a,void 0,s)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:void 0}}var h=/@.+:.+/,p=/[\u200E\u200F\u202A-\u202F]/},6122:(e,t,n)=>{"use strict";n.d(t,{H:()=>y,f:()=>f});var r=n(467),i=n(4980),o=n(6729),a=n(3840),s=n(3883),l=n(2986),c=n(9561),d=n(2114),u=n(6387),h=n(3337),p=n(4831),v=n(6412),m=n(6560),g=function(e){return e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished",e}(g||{}),f=function(e){return e.Events="RoomState.events",e.Members="RoomState.members",e.NewMember="RoomState.newMember",e.Update="RoomState.update",e.BeaconLiveness="RoomState.BeaconLiveness",e.Marker="RoomState.Marker",e}({});class y extends u.X{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{status:g.NotStarted};super(),this.roomId=e,this.oobMemberFlags=t,(0,i.A)(this,"reEmitter",new p.Q(this)),(0,i.A)(this,"sentinels",{}),(0,i.A)(this,"displayNameToUserIds",new Map),(0,i.A)(this,"userIdsToDisplayNames",{}),(0,i.A)(this,"tokenToInvite",{}),(0,i.A)(this,"joinedMemberCount",null),(0,i.A)(this,"summaryJoinedMemberCount",null),(0,i.A)(this,"invitedMemberCount",null),(0,i.A)(this,"summaryInvitedMemberCount",null),(0,i.A)(this,"modified",-1),(0,i.A)(this,"members",{}),(0,i.A)(this,"events",new Map),(0,i.A)(this,"paginationToken",null),(0,i.A)(this,"beacons",new Map),(0,i.A)(this,"_liveBeaconIds",[]),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>t.membership===m.O.Join?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>t.membership===m.O.Invite?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var t=this.sentinels[e];if(void 0===t){t=new o.Y(this.roomId,e);var n=this.members[e];null!=n&&n.events.member&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){return this.events.has(e)?void 0===t?Array.from(this.events.get(e).values()):this.events.get(e).get(t)||null:void 0===t?[]:null}get hasLiveBeacons(){var e;return!(null===(e=this.liveBeaconIds)||void 0===e||!e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new y(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=g.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==g.Finished&&this.getMembers().forEach((t=>{var n;t.isOutOfBand()&&(null===(n=e.getMember(t.userId))||void 0===n||n.markOutOfBand())})),e}setUnknownStateEvents(e){var t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e,t){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState()){v.E.matches(e.getType())&&this.setBeacon(e);var t,n=this.getStateEventMatching(e);this.setStateEvent(e),e.getType()===l.Bx.RoomMember&&(this.updateDisplayNameCache(e.getStateKey(),null!==(t=e.getContent().displayname)&&void 0!==t?t:""),this.updateThirdPartyTokenCache(e)),this.emit(f.Events,e,this,n)}})),this.onBeaconLivenessChange(),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===l.Bx.RoomMember){var n=e.getStateKey();e.getContent().membership!==m.O.Leave&&e.getContent().membership!==m.O.Ban||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);var r=this.getOrCreateMember(n,e);r.setMembershipEvent(e,this),this.updateMember(r),this.emit(f.Members,e,this,r)}else if(e.getType()===l.Bx.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{var n=t.getLastModifiedTime();t.setPowerLevelEvent(e),n!==t.getLastModifiedTime()&&this.emit(f.Members,e,this,t)})),this.sentinels={}}else l.ge.matches(e.getType())&&this.emit(f.Marker,e,t)})),this.emit(f.Update,this)}processBeaconEvents(e,t){var n=this;return(0,r.A)((function*(){if(e.length&&n.beacons.size){var i,o=[...n.beacons.values()].reduce(((e,t)=>(e[t.beaconInfoId]=t,e)),{}),a=(e,t)=>{if(v.z.matches(t.getType())){var n=o[e];n&&n.addLocations([t])}},s=function*(e){var n,i=null===(n=e.getRelation())||void 0===n?void 0:n.event_id;if(!i||!o[i])return{v:void 0};if(!v.z.matches(e.getType())&&!e.isEncrypted())return{v:void 0};try{yield t.decryptEventIfNeeded(e),a(i,e)}catch(t){e.isDecryptionFailure()&&e.once(c.OQ.Decrypted,(0,r.A)((function*(){a(i,e)})))}};for(var l of e)if(i=yield*s(l))return i.v}}))()}getOrCreateMember(e,t){var n=this.members[e];return n||(n=new o.Y(this.roomId,e),this.members[e]=n,this.emit(f.NewMember,t,this,n)),n}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var t=(0,h.M9)(e);if(this.beacons.has(t)){var n,r=this.beacons.get(t);return e.isRedacted()?void(r.beaconInfoId===(null===(n=e.getRedactionEvent())||void 0===n?void 0:n.redacts)&&(r.destroy(),this.beacons.delete(t))):r.update(e)}if(!e.isRedacted()){var i=new h.HF(e);this.reEmitter.reEmit(i,[h.JH.New,h.JH.Update,h.JH.Destroy,h.JH.LivenessChange]),this.emit(h.JH.New,e,i),i.on(h.JH.LivenessChange,this.onBeaconLivenessChange.bind(this)),i.on(h.JH.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(i.identifier,i)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter((e=>e.isLive)).map((e=>e.identifier)),this.emit(f.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var t,n;return null!==(t=null===(n=this.events.get(e.getType()))||void 0===n?void 0:n.get(e.getStateKey()))&&void 0!==t?t:null}updateMember(e){var t=this.getStateEvents(l.Bx.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===g.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===g.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===g.NotStarted&&(this.oobMemberFlags.status=g.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===g.InProgress&&(this.oobMemberFlags.status=g.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),a.v.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=g.NotStarted}setOutOfBandMembers(e){a.v.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===g.InProgress&&(a.v.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=g.Finished,e.forEach((e=>this.setOutOfBandMember(e))),this.emit(f.Update,this))}setOutOfBandMember(e){if(e.getType()===l.Bx.RoomMember){var t=e.getStateKey(),n=this.getMember(t);if(!n||n.isOutOfBand()){var r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),this.updateDisplayNameCache(r.userId,r.name),this.setStateEvent(e),this.updateMember(r),this.emit(f.Members,e,this,r)}}}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var t;return null!==(t=this.displayNameToUserIds.get((0,s.Gp)(e)))&&void 0!==t?t:[]}maySendRedactionForEvent(e,t){var n=this.getMember(t);return!(!n||n.membership===m.O.Leave)&&!e.status&&!e.isRedacted()&&!!this.maySendEvent(l.Bx.RoomRedaction,t)&&(e.getSender()===t||this.hasSufficientPowerLevelFor("redact",n.powerLevel))}hasSufficientPowerLevelFor(e,t){var n=this.getStateEvents(l.Bx.RoomPowerLevels,""),r={};n&&(r=n.getContent());var i=50;return(0,s.Et)(r[e])&&(i=r[e]),t>=i}maySendMessage(e){return this.maySendEventOfType(l.Bx.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!(t.isGuest()||!t.credentials.userId)&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,n){var r,i=this.getStateEvents(l.Bx.RoomPowerLevels,""),o={},a=0,s=0,c=0;if(i){o=(r=i.getContent()).events||{},a=Number.isSafeInteger(r.state_default)?r.state_default:50;var d=r.users&&r.users[t];Number.isSafeInteger(d)?c=d:Number.isSafeInteger(r.users_default)&&(c=r.users_default),Number.isSafeInteger(r.events_default)&&(s=r.events_default)}var u=n?a:s;return Number.isSafeInteger(o[e])&&(u=o[e]),c>=u}mayTriggerNotifOfType(e,t){var n=this.getMember(t);if(!n)return!1;var r=this.getStateEvents(l.Bx.RoomPowerLevels,""),i=50;return r&&r.getContent()&&r.getContent().notifications&&(0,s.Et)(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}getJoinRule(){var e,t=this.getStateEvents(l.Bx.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||d.dx.Invite}getHistoryVisibility(){var e,t=this.getStateEvents(l.Bx.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||d.Jv.Shared}getGuestAccess(){var e,t=this.getStateEvents(l.Bx.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||d.rF.Forbidden}findPredecessor(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var e=this.getStateEvents(l.Bx.RoomPredecessor,"");if(e){var t=e.getContent(),n=t.predecessor_room_id,r=t.last_known_event_id;"string"!=typeof r&&(r=void 0);var i=t.via_servers;if(Array.isArray(i)||(i=void 0),"string"==typeof n)return{roomId:n,eventId:r,viaServers:i}}}var o=this.getStateEvents(l.Bx.RoomCreate,"");if(o){var a=o.getContent().predecessor;if(a){var s=a.room_id;if("string"==typeof s){var c=a.event_id;return"string"==typeof c&&""!==c||(c=void 0),{roomId:s,eventId:c}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var t=(e.getContent().third_party_invite.signed||{}).token;t&&this.getStateEvents(l.Bx.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}}updateDisplayNameCache(e,t){var n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){var r=(0,s.Gp)(n),i=this.displayNameToUserIds.get(r);if(i){var o=i.filter((t=>t!==e));this.displayNameToUserIds.set(r,o)}}this.userIdsToDisplayNames[e]=t;var a=t&&(0,s.Gp)(t);if(a){var l,c=null!==(l=this.displayNameToUserIds.get(a))&&void 0!==l?l:[];c.push(e),this.displayNameToUserIds.set(a,c)}}}},4203:(e,t,n)=>{"use strict";n.d(t,{c:()=>r});class r{constructor(e,t){this.roomId=e}}},4659:(e,t,n)=>{"use strict";n.d(t,{vx:()=>G,X5:()=>V,Wv:()=>K,u9:()=>j,bx:()=>q});var r=n(467),i=n(4980),o=n(9787),a=n(1200),s=n(8221),l=n(6344),c=n(3883),d=n(9561),u=n(9608),h=n(6729),p=n(4203),v=n(3840),m=n(4831),g=n(2986),f=n(4792),y=n(310),_=n(6122),E=n(3337),b=n(441),S=n(6022),C=n(2866),w=n(6600),A=n(1768);class T{constructor(e){(0,i.A)(this,"room",void 0),(0,i.A)(this,"threadedReceipts",void 0),(0,i.A)(this,"unthreadedReceipts",void 0),(0,i.A)(this,"danglingReceipts",void 0),(0,i.A)(this,"onTimelineEvent",(e=>{var t=e.getId();if(t){var n=this.danglingReceipts.remove(t);null==n||n.forEach((e=>{e.receipt.thread_id?this.threadedReceipts.set(e.receipt.thread_id,e.eventId,e.receiptType,e.userId,e.receipt.ts,e.synthetic):this.unthreadedReceipts.set(t,e.receiptType,e.userId,e.receipt.ts,e.synthetic)}))}})),this.room=e,this.threadedReceipts=new x(e),this.unthreadedReceipts=new R(e),this.danglingReceipts=new N,e.on(j.Timeline,this.onTimelineEvent)}add(e,t){for(var[n,r]of Object.entries(e))for(var[i,o]of Object.entries(r))for(var[a,s]of Object.entries(o))this.room.findEventById(n)?s.thread_id?this.threadedReceipts.set(s.thread_id,n,i,a,s.ts,t):this.unthreadedReceipts.set(n,i,a,s.ts,t):this.danglingReceipts.add(new k(n,i,a,s,t))}hasUserReadEvent(e,t){var n=this.unthreadedReceipts.get(e);if(n&&L(n.eventId,t,this.room))return!0;var r=this.room.findEventById(t);if(!r)return v.v.warn("hasUserReadEvent event ID ".concat(t," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var i=(0,f.Xb)(r),o=this.threadedReceipts.get(i,e);return!(!o||!L(o.eventId,t,this.room))||!!this.userSentLatestEventInThread(i,e)}userSentLatestEventInThread(e,t){var n,r=e===S.S?this.room.getLiveTimeline().getEvents():null===(n=this.room.getThread(e))||void 0===n?void 0:n.timeline;return!!(r&&r.length>0&&r[r.length-1].getSender()===t)}}class I{constructor(e,t,n){this.eventId=e,this.receiptType=t,this.ts=n}}class k{constructor(e,t,n,r,i){this.eventId=e,this.receiptType=t,this.userId=n,this.receipt=r,this.synthetic=i}}class O{constructor(e){(0,i.A)(this,"room",void 0),(0,i.A)(this,"real",void 0),(0,i.A)(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,t){e?this.synthetic=t:this.real=t,this.synthetic&&this.real&&L(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return null!==(e=this.synthetic)&&void 0!==e?e:this.real}getByType(e){return e?this.synthetic:this.real}}class R{constructor(e){(0,i.A)(this,"room",void 0),(0,i.A)(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i){var o,a,s,l=D(this.data,n,(()=>new O(this.room))),c=l.getByType(i);c&&(o=c.eventId,a=e,null!==(s=this.room.compareEventOrdering(o,a))&&s>0)||l.set(i,new I(e,t,r))}get(e){var t;return null===(t=this.data.get(e))||void 0===t?void 0:t.get()}}class x{constructor(e){(0,i.A)(this,"room",void 0),(0,i.A)(this,"data",void 0),this.room=e,this.data=new Map}set(e,t,n,r,i,o){D(this.data,e,(()=>new R(this.room))).set(t,n,r,i,o)}get(e,t){var n;return null===(n=this.data.get(e))||void 0===n?void 0:n.get(t)}}class N{constructor(){(0,i.A)(this,"data",new Map)}add(e){D(this.data,e.eventId,(()=>[])).push(e)}remove(e){var t=this.data.get(e);return this.data.delete(e),t}}function D(e,t,n){var r=e.get(t);if(r)return r;var i=n();return e.set(t,i),i}function L(e,t,n){var r=n.compareEventOrdering(e,t);return null!==r&&r>=0}function P(e,t){var n=e.getTs(),r=t.getTs();return n<r?-1:n>r?1:0}var M=n(6560),U=n(7545);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G="10",$=["1","2","3","4","5","6","7","8","9","10"],V=function(e){return e.Highlight="highlight",e.Total="total",e}({}),j=function(e){return e.MyMembership="Room.myMembership",e.Tags="Room.tags",e.AccountData="Room.accountData",e.Receipt="Room.receipt",e.Name="Room.name",e.Redaction="Room.redaction",e.RedactionCancelled="Room.redactionCancelled",e.LocalEchoUpdated="Room.localEchoUpdated",e.Timeline="Room.timeline",e.TimelineReset="Room.timelineReset",e.TimelineRefresh="Room.TimelineRefresh",e.OldStateUpdated="Room.OldStateUpdated",e.CurrentStateUpdated="Room.CurrentStateUpdated",e.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",e.UnreadNotifications="Room.UnreadNotifications",e.Summary="Room.Summary",e}({});class K extends w.h{constructor(e,t,n){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),o=this,this.roomId=e,this.client=t,this.myUserId=n,this.opts=s,(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"txnToEvent",new Map),(0,i.A)(this,"notificationCounts",{}),(0,i.A)(this,"threadNotifications",new Map),(0,i.A)(this,"cachedThreadReadReceipts",new Map),(0,i.A)(this,"oldestThreadedReceiptTs",1/0),(0,i.A)(this,"unthreadedReceipts",new Map),(0,i.A)(this,"timelineSets",void 0),(0,i.A)(this,"polls",new Map),(0,i.A)(this,"threadsTimelineSets",[]),(0,i.A)(this,"filteredTimelineSets",{}),(0,i.A)(this,"timelineNeedsRefresh",!1),(0,i.A)(this,"pendingEventList",void 0),(0,i.A)(this,"blacklistUnverifiedDevices",void 0),(0,i.A)(this,"selfMembership",void 0),(0,i.A)(this,"summaryHeroes",null),(0,i.A)(this,"getTypeWarning",!1),(0,i.A)(this,"getVersionWarning",!1),(0,i.A)(this,"membersPromise",void 0),(0,i.A)(this,"name",void 0),(0,i.A)(this,"normalizedName",void 0),(0,i.A)(this,"tags",{}),(0,i.A)(this,"accountData",new Map),(0,i.A)(this,"summary",null),(0,i.A)(this,"oldState",void 0),(0,i.A)(this,"currentState",void 0),(0,i.A)(this,"relations",void 0),(0,i.A)(this,"threads",new Map),(0,i.A)(this,"visibilityEvents",new Map),(0,i.A)(this,"roomReceipts",new T(this)),(0,i.A)(this,"threadTimelineSetsPromise",null),(0,i.A)(this,"threadsReady",!1),(0,i.A)(this,"updateThreadRootEvents",((e,t,n)=>{var r,i;e.length&&(this.updateThreadRootEvent(null===(r=this.threadsTimelineSets)||void 0===r?void 0:r[0],e,t,n),e.hasCurrentUserParticipated&&this.updateThreadRootEvent(null===(i=this.threadsTimelineSets)||void 0===i?void 0:i[1],e,t,n))})),(0,i.A)(this,"updateThreadRootEvent",((e,t,n,r)=>{e&&t.rootEvent&&(r&&e.removeEvent(t.id),b.jV.hasServerSideSupport?e.addLiveEvent(t.rootEvent,{duplicateStrategy:a.x.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):e.addEventToTimeline(t.rootEvent,e.getLiveTimeline(),{toStartOfTimeline:n,addToState:!1}))})),(0,i.A)(this,"applyRedaction",(e=>{if(e.isRedaction()){var t=e.event.redacts,n=t?this.findEventById(t):void 0;if(n){var r=n.threadRootId;if(n.makeRedacted(e,this),n.isState()){var i=this.currentState.getStateEvents(n.getType(),n.getStateKey());(null==i?void 0:i.getId())===n.getId()&&this.currentState.setStateEvents([n])}this.emit(j.Redaction,e,this,r),this.visibilityEvents.delete(t),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}}})),this.setMaxListeners(100),this.reEmitter=new m.Q(this),s.pendingEventOrdering=s.pendingEventOrdering||f.eO.Chronological,this.name=e,this.normalizedName=e,this.relations=new C.t(this.client,this),this.on(j.Receipt,this.onReceipt),this.timelineSets=[new a.m(this,s)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[j.Timeline,j.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===f.eO.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then((e=>{var n=this.client.getEventMapper({toDevice:!1,decrypt:!1});e.forEach(function(){var e=(0,r.A)((function*(e){var r=n(e);yield t.decryptEventIfNeeded(r),r.setStatus(u.f.NOT_SENT),o.addPendingEvent(r,r.getTxnId())}));return function(t){return e.apply(this,arguments)}}())}))),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return(0,r.A)((function*(){var t;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if(null!==(t=e.client)&&void 0!==t&&t.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(b.x3.My)]);var n=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=n[0],e.threadsTimelineSets[1]=n[1],n}catch(t){return e.threadTimelineSetsPromise=null,null}return null}))()}decryptCriticalEvents(){var e=this;return(0,r.A)((function*(){if(e.client.getCrypto()){var t=e.getEventReadUpTo(e.client.getUserId(),!0),n=e.getLiveTimeline().getEvents(),r=n.findIndex((e=>e.event.event_id===t)),i=n.slice(r).reverse().map((t=>e.client.decryptEventIfNeeded(t)));yield Promise.allSettled(i)}}))()}decryptAllEvents(){var e=this;return(0,r.A)((function*(){if(e.client.getCrypto()){var t=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map((t=>e.client.decryptEventIfNeeded(t)));yield Promise.allSettled(t)}}))()}getCreator(){var e,t=this.currentState.getStateEvents(g.Bx.RoomCreate,"");return null!==(e=null==t?void 0:t.getSender())&&void 0!==e?e:null}getVersion(){var e,t=this.currentState.getStateEvents(g.Bx.RoomCreate,"");return t?null!==(e=t.getContent().room_version)&&void 0!==e?e:"1":(this.getVersionWarning||(v.v.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getRecommendedVersion(){var e=this;return(0,r.A)((function*(){var t={};try{t=yield e.client.getCapabilities()}catch(e){}var n=t["m.room_versions"];if(!n)for(var r of(n={default:G,available:{}},$))n.available[r]=U.L.Stable;var i=e.checkVersionAgainstCapability(n);if(i.urgent&&i.needsUpgrade){v.v.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{t=yield e.client.fetchCapabilities()}catch(e){v.v.warn("Failed to refresh room version capabilities",e)}if(!(n=t["m.room_versions"]))return v.v.warn("No room version capability - assuming upgrade required."),i;i=e.checkVersionAgainstCapability(n)}return i}))()}checkVersionAgainstCapability(e){var t=this.getVersion();v.v.log("[".concat(this.roomId,"] Current version: ").concat(t)),v.v.log("[".concat(this.roomId,"] Version capability: "),e);var n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?v.v.warn("URGENT upgrade required on ".concat(this.roomId)):v.v.warn("Non-urgent upgrade required on ".concat(this.roomId))),n}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(g.Bx.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var t=(0,c.Nz)(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.some((t=>t.getId()===e)))&&void 0!==t&&t}getPendingEvent(e){var t,n;return null!==(t=null===(n=this.pendingEventList)||void 0===n?void 0:n.find((t=>t.getId()===e)))&&void 0!==t?t:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,t,n=this.getLiveTimeline().getEvents(),r=n[n.length-1],i=this.getLastThread();if(!i)return r;var o=i.events[i.events.length-1];return(null!==(e=null==r?void 0:r.getTs())&&void 0!==e?e:0)>(null!==(t=null==o?void 0:o.getTs())&&void 0!==t?t:0)?r:o}getLastThread(){return this.getThreads().reduce(((e,t)=>{var n,r;if(!e)return t;var i=t.events[t.events.length-1],o=e.events[e.events.length-1];return(null!==(n=null==i?void 0:i.getTs())&&void 0!==n?n:0)>=(null!==(r=null==o?void 0:o.getTs())&&void 0!==r?r:0)?t:e}),void 0)}getMyMembership(){var e;return null!==(e=this.selfMembership)&&void 0!==e?e:M.O.Leave}getDMInviter(){var e,t=this.getMember(this.myUserId);return t?t.getDMInviter():this.selfMembership===M.O.Invite&&2===this.getInvitedAndJoinedMemberCount()?null===(e=this.summaryHeroes)||void 0===e?void 0:e[0]:void 0}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var t=e.getDMInviter();if(t)return t}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];var n=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return n?n.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(g.Ng.name,"");return Array.isArray(null==e?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,t=this.getFunctionalMembers(),n=0;if(this.getMembers().forEach((e=>{"join"!==e.membership&&"invite"!==e.membership||t.includes(e.userId)||n++})),!(n>2)){var r=null===(e=this.summaryHeroes)||void 0===e?void 0:e.filter((e=>!t.includes(e))),i=Array.isArray(r)&&r.length;if(i){var o=r.map((e=>this.getMember(e))).find((e=>!!e));if(o)return o}var a=this.getMembers(),s=null==a?void 0:a.filter((e=>!t.includes(e.userId)));if(s.length<=2){var l=s.find((e=>e.userId!==this.myUserId));if(l)return l}if(i){var c=r.map((e=>this.client.getUser(e))).find((e=>!!e));if(c){var d=new h.Y(this.roomId,c.userId);return d.user=c,d}}}}updateMyMembership(e){var t=this.selfMembership;this.selfMembership=e,t!==e&&(e===M.O.Leave&&this.cleanupAfterLeaving(),this.emit(j.MyMembership,this,e,t))}loadMembersFromServer(){var e=this;return(0,r.A)((function*(){var t=e.client.store.getSyncToken();return(yield e.client.members(e.roomId,void 0,M.O.Leave,null!=t?t:void 0)).chunk}))()}loadMembers(){var e=this;return(0,r.A)((function*(){var t=!1,n=yield e.client.store.getOutOfBandMembers(e.roomId);return(null===n||e.hasEncryptionStateEvent())&&(t=!0,n=yield e.loadMembersFromServer(),v.v.log("LL: got ".concat(n.length," ")+"members from server for room ".concat(e.roomId))),{memberEvents:n.filter(c.O5).map(e.client.getEventMapper()),fromServer:t}}))()}membersLoaded(){return!this.opts.lazyLoadMembers||this.currentState.outOfBandMembersReady()}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),e.fromServer))).catch((e=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){var t=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>{var t;return null===(t=e.events.member)||void 0===t?void 0:t.event}));return v.v.log("LL: telling store to write ".concat(t.length)+" members for room ".concat(this.roomId)),this.client.store.setOutOfBandMembers(this.roomId,t).catch((e=>{v.v.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{v.v.error(e)})),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return(0,r.A)((function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)}))()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{v.v.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),v.v.log(e)}))}refreshLiveTimeline(){var e=this;return(0,r.A)((function*(){var t=e.getLiveTimeline(),n=t.getPaginationToken(s.q.FORWARDS),r=t.getPaginationToken(s.q.BACKWARDS),i=t.getEvents(),o=i[i.length-1];v.v.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(t.toString()," ")+"forwardPaginationToken=".concat(n," ")+"backwardPaginationToken=".concat(r));var a,l=e.getUnfilteredTimelineSet();o?(e.resetLiveTimeline(null,null),e.emit(j.TimelineRefresh,e,l),a=yield e.client.getEventTimeline(l,o.getId())):a=yield e.client.getLatestTimeline(l);var c=l.getLiveTimeline();!c||null===c.getPaginationToken(s.O.Forward)&&null===c.getPaginationToken(s.O.Backward)&&0===c.getEvents().length?(v.v.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),a.setPaginationToken(n,s.q.FORWARDS),l.setLiveTimeline(a),e.fixUpLegacyTimelineFields()):v.v.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(j.TimelineRefresh,e,l)}))()}resetLiveTimeline(e,t){for(var n of this.timelineSets)n.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0);for(var r of this.threads.values())r.resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,t=this.currentState;this.oldState=this.getLiveTimeline().getState(s.q.BACKWARDS),this.currentState=this.getLiveTimeline().getState(s.q.FORWARDS),e!==this.oldState&&this.emit(j.OldStateUpdated,this,e,this.oldState),t!==this.currentState&&(this.emit(j.CurrentStateUpdated,this,t,this.currentState),this.reEmitter.stopReEmitting(t,[_.f.Events,_.f.Members,_.f.NewMember,_.f.Update,_.f.Marker,E.JH.New,E.JH.Update,E.JH.Destroy,E.JH.LivenessChange]),this.reEmitter.reEmit(this.currentState,[_.f.Events,_.f.Members,_.f.NewMember,_.f.Update,_.f.Marker,E.JH.New,E.JH.Update,E.JH.Destroy,E.JH.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var t=[],n=!1,r=e.getContent();for(var i of Object.values(r))for(var[o,a]of Object.entries(i))if(c.ll(o)&&a)for(var[s,l]of Object.entries(a))if(l&&"object"==typeof l){var d=l;s===this.client.getUserId()&&(void 0===d.thread_id?n=!0:"string"==typeof d.thread_id&&t.push(d.thread_id))}for(var u of(n&&(t=this.getThreads().filter((e=>this.getThreadUnreadNotificationCount(e.id,V.Total)>0||this.getThreadUnreadNotificationCount(e.id,V.Highlight)>0)).map((e=>e.id))).push("main"),t)){var h,p="main"===u?this.getLiveTimeline():null===(h=this.getThread(u))||void 0===h?void 0:h.liveTimeline;if(p){for(var m=p.getEvents(),g=0,f=m.length-1;f>=0;f--){var y;if(f===m.length-20)return;var _=m[f];if(this.hasUserReadEvent(this.client.getUserId(),_.getId()))break;var E=this.client.getPushActionsForEvent(_);g+=null!=E&&null!==(y=E.tweaks)&&void 0!==y&&y.highlight?1:0}"main"===u?this.setUnreadNotificationCount(V.Highlight,g):this.setThreadUnreadNotificationCount(u,V.Highlight,g)}else v.v.warn("Couldn't find timeline for thread ID ".concat(u," in room ").concat(this.roomId))}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var t=this.findEventById(e),n=this.findThreadForEvent(t);return n?n.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var t=this.getUnfilteredTimelineSet().findEventById(e);if(!t)for(var n=this.getThreads(),r=0;r<n.length;r++)if(t=n[r].findEventById(e))return t;return t}getUnreadNotificationCount(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.Total,t=this.getRoomUnreadNotificationCount(e);for(var n of this.threadNotifications.values()){var r;t+=null!==(r=n[e])&&void 0!==r?r:0}return t}getUnreadCountForEventContext(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.Total,n=arguments.length>1?arguments[1]:void 0;return null!==(e=n.threadRootId&&!n.isThreadRoot?this.getThreadUnreadNotificationCount(n.threadRootId,t):this.getRoomUnreadNotificationCount(t))&&void 0!==e?e:0}getRoomUnreadNotificationCount(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.Total;return null!==(e=this.notificationCounts[t])&&void 0!==e?e:0}getThreadUnreadNotificationCount(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.Total;return null!==(t=null===(n=this.threadNotifications.get(e))||void 0===n?void 0:n[r])&&void 0!==t?t:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var t,n;if((null!==(t=e.highlight)&&void 0!==t?t:0)>0||(null!==(n=e.total)&&void 0!==n?n:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,t,n){var r,i,o=B({highlight:null===(r=this.threadNotifications.get(e))||void 0===r?void 0:r.highlight,total:null===(i=this.threadNotifications.get(e))||void 0===i?void 0:i.total},{[t]:n});this.threadNotifications.set(e,o),this.emit(j.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var t of this.threadNotifications.values()){var n,r;if((null!==(n=t.highlight)&&void 0!==n?n:0)>0)return V.Highlight;(null!==(r=t.total)&&void 0!==r?r:0)>0&&!e&&(e=V.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.hasEncryptionStateEvent();for(var[n,r]of this.threadNotifications)e.includes(n)||(r.total=0,t||(r.highlight=0));this.emit(j.UnreadNotifications)}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t,this.emit(j.UnreadNotifications,this.notificationCounts)}setUnread(e,t){return this.setUnreadNotificationCount(e,t)}setSummary(e){var t=e["m.heroes"],n=e["m.joined_member_count"],r=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),Array.isArray(t)&&(this.summaryHeroes=t.filter((e=>e!==this.myUserId))),this.emit(j.Summary,e)}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return void 0===this.blacklistUnverifiedDevices?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=this.currentState.getStateEvents(g.Bx.RoomAvatar,"");if(!a&&!i)return null;var s=a?a.getContent().url:null;return s?(0,l.y)(e,s,t,n,r,void 0,void 0,o):null}getMxcAvatarUrl(){var e;return(null===(e=this.currentState.getStateEvents(g.Bx.RoomAvatar,""))||void 0===e||null===(e=e.getContent())||void 0===e?void 0:e.url)||null}getCanonicalAlias(){var e=this.currentState.getStateEvents(g.Bx.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){var e=this.currentState.getStateEvents(g.Bx.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,n,r,i){r.getTimelineSet().addEventsToTimeline(e,t,n,r,i)}getThread(e){var t;return null!==(t=this.threads.get(e))&&void 0!==t?t:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(M.O.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}getEncryptionTargetMembers(){var e=this;return(0,r.A)((function*(){yield e.loadMembersIfNeeded();var t=e.getMembersWithMembership(M.O.Join);return e.shouldEncryptForInvitedMembers()&&(t=t.concat(e.getMembersWithMembership(M.O.Invite))),t}))()}shouldEncryptForInvitedMembers(){var e,t=this.currentState.getStateEvents(g.Bx.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){var n=this.getMember(e);return!!n&&n.membership===t}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:t=!0,useSyncEvents:n=!0,pendingEvents:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var i=Object.assign({filter:e,pendingEvents:r},this.opts),o=new a.m(this,i);this.reEmitter.reEmit(o,[j.Timeline,j.TimelineReset]),n&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var l=this.getLiveTimeline();if(t){l.getEvents().forEach((function(e){o.addLiveEvent(e,{addToState:!1})}));for(var c=l;c.getNeighbouringTimeline(s.q.BACKWARDS);)c=c.getNeighbouringTimeline(s.q.BACKWARDS);o.getLiveTimeline().setPaginationToken(c.getPaginationToken(s.q.BACKWARDS),s.q.BACKWARDS)}else if(n){var d=l.getPaginationToken(s.O.Forward);o.getLiveTimeline().setPaginationToken(d,s.O.Backward)}return o}getThreadListFilter(){var e=arguments,t=this;return(0,r.A)((function*(){var n=e.length>0&&void 0!==e[0]?e[0]:b.x3.All,r=t.client.getUserId(),i=new y.d(r),o={room:{timeline:{[b.H.name]:[b.RN.name]}}};n===b.x3.My&&(o.room.timeline[b.o1.name]=[r]),i.setDefinition(o);var a=yield t.client.getOrCreateFilter("THREAD_PANEL_".concat(t.roomId,"_").concat(n),i);return i.filterId=a,i}))()}createThreadTimelineSet(e){var t=this;return(0,r.A)((function*(){var n;if(b.jV.hasServerSideListSupport)n=new a.m(t,B(B({},t.opts),{},{pendingEvents:!1}),void 0,void 0,null!=e?e:b.x3.All),t.reEmitter.reEmit(n,[j.Timeline,j.TimelineReset]);else if(b.jV.hasServerSideSupport){var r=yield t.getThreadListFilter(e);n=t.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else n=new a.m(t,{pendingEvents:!1}),Array.from(t.threads).forEach((r=>{var[,i]=r;if(0!==i.length){var o=i.timeline.some((e=>e.getSender()===t.client.getUserId()));(e!==b.x3.My||o)&&n.getLiveTimeline().addEvent(i.rootEvent,{toStartOfTimeline:!1,addToState:!1})}}));return n}))()}processThreadRoots(e,t){if(this.client.supportsThreads())for(var n of e)s.q.setEventMetadata(n,this.currentState,t),this.getThread(n.getId())||this.createThread(n.getId(),n,[],t)}fetchRoomThreads(){var e=this;return(0,r.A)((function*(){if(!e.threadsReady&&e.client.supportsThreads()){if(b.jV.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(b.x3.All),e.fetchRoomThreadList(b.x3.My)]);else{var t=yield e.getThreadListFilter(),{chunk:n}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,s.O.Backward,t);if(!n.length)return;var r,i=n.map(e.client.getEventMapper()).sort(((e,t)=>{var n=e.getServerAggregatedRelation(b.RN.name),r=t.getServerAggregatedRelation(b.RN.name);return n.latest_event.origin_server_ts-r.latest_event.origin_server_ts})),o=e.getLiveTimeline().getState(s.q.FORWARDS);for(var l of i){var c,d={duplicateStrategy:a.x.Ignore,fromCache:!1,addToState:!1,roomState:o};null===(c=e.threadsTimelineSets[0])||void 0===c||c.addLiveEvent(l,d);var u,h=l.getServerAggregatedRelation(b.RN.name);null!=h&&h.current_user_participated&&(null===(u=e.threadsTimelineSets[1])||void 0===u||u.addLiveEvent(l,d),r=l)}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),r&&e.client.decryptEventIfNeeded(r)}e.on(b.ju.NewReply,e.onThreadReply),e.on(b.ju.Update,e.onThreadUpdate),e.on(b.ju.Delete,e.onThreadDelete),e.threadsReady=!0}}))()}processPollEvents(e){var t=this;return(0,r.A)((function*(){for(var n of e)try{if(!n.isEncrypted()&&!(0,A.Wi)(n))continue;yield t.client.decryptEventIfNeeded(n),t.processPollEvent(n)}catch(e){v.v.warn("Error processing poll event",n.getId(),e)}}))()}processPollEvent(e){var t=this;return(0,r.A)((function*(){if(e.isDecryptionFailure())e.once(d.OQ.Decrypted,(e=>{t.processPollEvent(e)}));else if(o.M_POLL_START.matches(e.getType()))try{var n=new A.sP(e,t.client,t);t.polls.set(e.getId(),n),t.emit(A.sn.New,n),e.once(d.OQ.BeforeRedaction,(e=>{t.polls.delete(e.getId())}))}catch(e){}else{var r=e.relationEventId;if(r&&t.polls.has(r)){var i=t.polls.get(r);null==i||i.onNewRelation(e)}}}))()}fetchRoomThreadList(e){var t=this;return(0,r.A)((function*(){if(t.client.supportsThreads()&&0!==t.threadsTimelineSets.length){var n=e===b.x3.My?t.threadsTimelineSets[1]:t.threadsTimelineSets[0],{chunk:r,end:i}=yield t.client.createThreadListMessagesRequest(t.roomId,null,void 0,s.O.Backward,n.threadListType,n.getFilter());if(n.getLiveTimeline().setPaginationToken(null!=i?i:null,s.O.Backward),r.length){var o=r.map(t.client.getEventMapper());t.processThreadRoots(o,!0);var l=t.getLiveTimeline().getState(s.q.FORWARDS);for(var c of o)n.addLiveEvent(c,{duplicateStrategy:a.x.Replace,fromCache:!1,roomState:l,addToState:!1})}}}))()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var t;this.threads.delete(e.id);var n=this.getTimelineForEvent(e.id),r=null==n||null===(t=n.getEvents())||void 0===t?void 0:t.find((t=>t.getId()===e.id));for(var i of(r?e.clearEventMetadata(r):v.v.debug("onThreadDelete: Could not find root event in room timeline"),this.threadsTimelineSets))i.removeEvent(e.id)}removeFilteredTimelineSet(e){var t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}eventShouldLiveIn(e,t,n){var r;if(null===(r=this.client)||void 0===r||!r.supportsThreads())return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||null!=n&&n.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var i,o,a=e.isRelation(b.RN.name),s=e.getAssociatedId(),l=e.threadRootId;return s&&!a&&(l===s||null!=n&&n.has(s))?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:(s&&(i=null!==(o=this.findEventById(s))&&void 0!==o?o:null==t?void 0:t.find((e=>e.getId()===s))),i&&!a?this.eventShouldLiveIn(i,t,n):null!=l?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:l}:!s||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1})}findThreadForEvent(e){if(!e)return null;var{threadId:t}=this.eventShouldLiveIn(e);return t?this.getThread(t):null}addThreadedEvents(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getThread(e);if(r)r.addEvents(t,n);else{var i,o=null!==(i=this.findEventById(e))&&void 0!==i?i:t.find((t=>t.getId()===e));this.createThread(e,o,t,n)}}processThreadedEvents(e,t){e.forEach(this.applyRedaction);var n={};for(var r of e){var i,{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(r);a&&!n[o]&&(n[o]=[]),null===(i=n[o])||void 0===i||i.push(r)}Object.entries(n).map((e=>{var[n,r]=e;return this.addThreadedEvents(n,r,t)}))}createThread(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(t){var o=this.relations.getAllChildEventsForEvent(t.getId());null!=o&&o.length&&(r=r.concat(o.filter((e=>!e.isRelation(g.zZ.Replace)))))}var a=new b.jV(e,t,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:null!==(n=this.cachedThreadReadReceipts.get(e))&&void 0!==n?n:[]});return this.reEmitter.reEmit(a,[b.ju.Delete,b.ju.Update,b.ju.NewReply,j.Timeline,j.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(a.id,a),a.addEvents(r,!1),this.threadsReady&&a.initialEventsFetched&&this.updateThreadRootEvents(a,i,!1),this.emit(b.ju.New,a,i),a}processLiveEvent(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId)for(var[t,n]of this.txnToEvent)if(n.getId()===e.getId()){v.v.debug("processLiveEvent: found sent event without txn ID: ",t,e.getId());var r=e.getUnsigned();r.transaction_id=t,e.setUnsigned(r);break}}addLiveEvent(e,t){var{duplicateStrategy:n,timelineWasEmpty:r,fromCache:i,addToState:o}=t;for(var a of this.timelineSets)a.addLiveEvent(e,{duplicateStrategy:n,fromCache:i,timelineWasEmpty:r,addToState:o});e.sender&&e.getType()!==g.Bx.RoomRedaction&&this.addReceipt((0,w.D)(e.sender.userId,e,S.L.Read),!0)}addPendingEvent(e,t){if(e.status!==u.f.SENDING&&e.status!==u.f.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(t))throw new Error("addPendingEvent called on an event with known txnId "+t);if(s.q.setEventMetadata(e,this.getLiveTimeline().getState(s.q.FORWARDS),!1),this.txnToEvent.set(t,e),this.pendingEventList){if(this.pendingEventList.some((e=>e.status===u.f.NOT_SENT))&&(v.v.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(u.f.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var n=e.event.redacts,r=this.pendingEventList.find((e=>e.getId()===n));!r&&n&&(r=this.findEventById(n)),r&&(r.markLocallyRedacted(e),this.emit(j.Redaction,e,this,r.threadRootId))}}else for(var i of this.timelineSets)i.getFilter()?i.getFilter().filterRoomTimeline([e]).length&&i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):i.addEventToTimeline(e,i.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(j.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map((e=>B(B({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{var t=e.type===g.Bx.RoomMessageEncrypted,n=this.hasEncryptionStateEvent();return t||!n}));this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,t){var n=t.getId(),r=e.getId(),i=t.status;v.v.debug("Got remote echo for event ".concat(n," -> ").concat(r," old status ").concat(i)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),s=a?this.getThread(a):null;if(null==s||s.setEventMetadata(t),null==s||s.timelineSet.handleRemoteEcho(t,n,r),o)for(var l of this.timelineSets)l.handleRemoteEcho(t,n,r);this.emit(j.LocalEchoUpdated,t,this,n,i)}updatePendingEvent(e,t,n){if(v.v.log("setting pendingEvent status to ".concat(t," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(n)),t==u.f.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==u.f.SENT&&this.getTimelineForEvent(n)){var r=this.findEventById(n);if(!(null==r?void 0:r.getUnsigned().transaction_id)&&r){var i=r.getUnsigned();i.transaction_id=e.getTxnId(),r.setUnsigned(i),this.removeEvent(r.getId()),this.handleRemoteEcho(r,e)}}else{var o=e.status,a=e.getId();if(!o)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var s=W[o];if(null==s||!s.includes(t))throw new Error("Invalid EventStatus transition ".concat(o,"->").concat(t));if(e.setStatus(t),t==u.f.SENT){e.replaceLocalEventId(n);var{shouldLiveInRoom:l,threadId:c}=this.eventShouldLiveIn(e),d=c?this.getThread(c):void 0;if(null==d||d.setEventMetadata(e),null==d||d.timelineSet.replaceEventId(a,n),l)for(var h of this.timelineSets)h.replaceEventId(a,n)}else if(t==u.f.CANCELLED){if(this.pendingEventList){var p=this.getPendingEvent(a);this.removePendingEvent(a),null!=p&&p.isRedaction()&&this.revertRedactionLocalEcho(p)}this.removeEvent(a)}this.savePendingEvents(),this.emit(j.LocalEchoUpdated,e,this,a,o)}}revertRedactionLocalEcho(e){var t=e.event.redacts;if(t){var n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit(j.RedactionCancelled,e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var t=this.timelineSets[e].getLiveTimeline();if(t.getPaginationToken(s.q.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+t.getPaginationToken(s.q.FORWARDS)+")");if(t.getNeighbouringTimeline(s.q.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,t){var n=this;return(0,r.A)((function*(){var{duplicateStrategy:r,fromCache:i,timelineWasEmpty:o=!1,addToState:a}=t;if(r&&-1===["replace","ignore"].indexOf(r))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");n.assertTimelineSetsAreLive();var s=n.findThreadRoots(e),l={},c={duplicateStrategy:r,fromCache:i,timelineWasEmpty:o,addToState:a},u=[...e];for(var h of e){var p;if(n.processLiveEvent(h),h.getUnsigned().transaction_id){var m=n.txnToEvent.get(h.getUnsigned().transaction_id);if(m){n.handleRemoteEcho(h,m);continue}}var{shouldLiveInRoom:f,shouldLiveInThread:y,threadId:_=""}=n.eventShouldLiveIn(h,u,s);if(!y&&!f&&h.isRelation())try{var E=new d.kl(yield n.client.fetchRoomEvent(n.roomId,h.relationEventId));if(u.push(E),E.threadRootId){s.add(E.threadRootId);var b=h.getUnsigned();b[g.Sr.name]=E.threadRootId,h.setUnsigned(b)}({shouldLiveInRoom:f,shouldLiveInThread:y,threadId:_=""}=n.eventShouldLiveIn(h,u,s))}catch(e){v.v.error("Failed to load parent event of unhandled relation",e)}y&&!l[_]&&(l[_]=[]),null===(p=l[_])||void 0===p||p.push(h),f?n.addLiveEvent(h,c):!y&&h.isRelation()&&n.relations.aggregateChildEvent(h)}Object.entries(l).forEach((e=>{var[t,r]=e;n.addThreadedEvents(t,r,!1)}))}))()}partitionThreadedEvents(e){if(this.client.supportsThreads()){var t=this.findThreadRoots(e);return e.reduce(((n,r)=>{var{shouldLiveInRoom:i,shouldLiveInThread:o,threadId:a}=this.eventShouldLiveIn(r,e,t);return i&&n[0].push(r),o&&(r.setThreadId(null!=a?a:""),n[1].push(r)),o||i||n[2].push(r),n}),[[],[],[]])}return[e,[],[]]}findThreadRoots(e){var t=new Set;for(var n of e){var r=n.threadRootId;null!=r&&t.add(r)}return t}addReceipt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.getContent();this.roomReceipts.add(n,t),Object.keys(n).forEach((e=>{Object.keys(n[e]).forEach((r=>{Object.keys(n[e][r]).forEach((i=>{var o,a,s,l,c=n[e][r][i],d=!c.thread_id||c.thread_id===S.S,u=d?this:this.threads.get(null!==(o=c.thread_id)&&void 0!==o?o:"");if(u){if(u.addReceiptToStructure(e,r,i,c,t),!t&&this.client.isInitialSyncComplete()&&i===this.client.getUserId()){var h=u.timeline[u.timeline.length-1];h&&e===h.getId()&&i===h.getSender()&&(u.setUnread(V.Total,0),u.setUnread(V.Highlight,0))}}else this.cachedThreadReadReceipts.set(c.thread_id,[...null!==(l=this.cachedThreadReadReceipts.get(c.thread_id))&&void 0!==l?l:[],{eventId:e,receiptType:r,userId:i,receipt:c,synthetic:t}]);i===this.client.getUserId()&&!d&&c.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=c.ts),!c.thread_id&&c.ts>(null!==(a=null===(s=this.unthreadedReceipts.get(i))||void 0===s?void 0:s.ts)&&void 0!==a?a:0)&&this.unthreadedReceipts.set(i,c)}))}))})),this.emit(j.Receipt,e,this)}addEphemeralEvents(e){for(var t of e)t.getType()===g.Bx.Typing?this.currentState.setTypingEvent(t):t.getType()===g.Bx.Receipt&&this.addReceipt(t)}removeEvents(e){for(var t of e)this.removeEvent(t)}removeEvent(e){var t=!1;for(var n of this.timelineSets){var r=n.removeEvent(e);r&&(r.isRedaction()&&this.revertRedactionLocalEcho(r),t=!0)}return t}recalculate(){var e=this.currentState.getStateEvents(g.Bx.RoomMember,this.myUserId);if(e){var t=e.getContent().membership;this.updateMyMembership(t),t===M.O.Invite&&(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new d.kl({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])}))}var n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,c.S8)(this.name),this.summary=new p.c(this.roomId,{title:this.name}),n!==this.name&&this.emit(j.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(j.Tags,e,this)}addAccountData(e){for(var t of e){"m.tag"===t.getType()&&this.addTags(t);var n=t.getType(),r=this.accountData.get(n);this.accountData.set(n,t),this.emit(j.AccountData,t,this,r)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===M.O.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(g.Bx.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(g.Bx.RoomMessage,this.myUserId))}canInvite(e){var t=this.getMyMembership()===M.O.Join,n=this.currentState.getStateEvents(g.Bx.RoomPowerLevels,""),r=n&&n.getContent(),i=this.getMember(e);return r&&i&&r.invite>i.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(g.Bx.RoomCreate,"");if(e)return e.getContent()[g.Ct];this.getTypeWarning||(v.v.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===g.CJ.Space}isCallRoom(){return this.getType()===g.CJ.UnstableCall}isElementVideoRoom(){return this.getType()===g.CJ.ElementVideo}findPredecessor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getLiveTimeline().getState(s.q.FORWARDS);return t?t.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var t=this.client.roomNameGenerator(this.roomId,e);if(null!==t)return t}switch(e.type){case q.Actual:return e.name;case q.Generated:return"Inviting"===e.subtype?"Inviting ".concat(H(e.names,e.count)):H(e.names,e.count);case q.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){var t=this.currentState.getStateEvents(g.Bx.RoomName,"");if(null!=t&&t.getContent().name)return this.roomNameGenerator({type:q.Actual,name:t.getContent().name})}var n=this.getCanonicalAlias();if(n)return this.roomNameGenerator({type:q.Actual,name:n});var r=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,i=this.getFunctionalMembers(),o=[];if(this.summaryHeroes)this.summaryHeroes.forEach((e=>{if(i.includes(e))r--;else{var t=this.getMember(e);o.push(t?t.name:e)}}));else{var a=this.currentState.getMembers().filter((t=>t.userId!==e&&(t.membership===M.O.Invite||t.membership===M.O.Join)));a=a.filter((e=>{var{userId:t}=e;return!i.includes(t)||(r--,!1)}));var s=new Intl.Collator;a.sort(((e,t)=>s.compare(e.userId,t.userId))),a=a.slice(0,5),o=a.map((e=>e.name))}if(r)return this.roomNameGenerator({type:q.Generated,names:o,count:r});if(this.getMyMembership()==M.O.Join){var l=this.currentState.getStateEvents(g.Bx.RoomThirdPartyInvite);if(null!=l&&l.length){var c=l.map((e=>e.getContent().display_name));return this.roomNameGenerator({type:q.Generated,subtype:"Inviting",names:c,count:c.length+1})}}var d,u=o;return u.length||(u=this.currentState.getMembers().filter((t=>t.userId!==e&&t.membership!==M.O.Invite&&t.membership!==M.O.Join)).map((e=>e.name))),u.length&&(d=this.roomNameGenerator({type:q.Generated,names:u,count:u.length+1})),this.roomNameGenerator({type:q.EmptyRoom,oldName:d})}applyNewVisibilityEvent(e){var t=e.asVisibilityChange();if(t){var n=e.getSender();if(n&&(g.Yg.name&&this.currentState.maySendStateEvent(g.Yg.name,n)||g.Yg.altName&&this.currentState.maySendStateEvent(g.Yg.altName,n))){var r=this.visibilityEvents.get(t.eventId);if(r){for(var i=r.length-1,o=Math.max(0,r.length-30);i>=o&&!(r[i].getTs()<e.getTs());--i);-1===i?r.unshift(e):r.splice(i+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);var a=this.findEventById(t.eventId);a&&a.applyVisibilityEvent(t)}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var t=e.getRelation(),n=null==t?void 0:t.event_id,r=this.visibilityEvents.get(n);if(r){var i=r.findIndex((t=>t.getId()===e.getId()));if(-1!==i&&(r.splice(i,1),i===r.length)){var o=this.findEventById(n);if(!o)return;if(0===i)this.visibilityEvents.delete(n),o.applyVisibilityEvent();else{var a=r[r.length-1].asVisibilityChange();if(!a)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(a)}}}}applyPendingVisibilityEvents(e){var t=this.visibilityEvents.get(e.getId());if(t&&0!=t.length){var n=t[t.length-1],r=n.asVisibilityChange();r&&(r.visible,n.getTs()<e.getTs()||e.applyVisibilityEvent(r))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,t){return this.roomReceipts.hasUserReadEvent(e,t)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var t=this.getThreads().filter((e=>this.getThreadUnreadNotificationCount(e.id,V.Total)>0));for(var n of t)n.fixupNotifications(e)}compareEventOrdering(e,t){return function(e,t,n){var r=e.findEventById(t),i=e.findEventById(n);if(!r||!i)return null;var o=(0,f.fN)(r),a=(0,f.fN)(i);return o&&a?function(e,t,n,r,i){var o=e.getUnfilteredTimelineSet(),a=o.compareEventOrdering(t,n);return null!==a?a:o.getTimelineForEvent(t)===o.getLiveTimeline()?1:o.getTimelineForEvent(n)===o.getLiveTimeline()?-1:P(r,i)}(e,t,n,r,i):function(e,t,n,r){var i=(0,f.Xb)(n),o=(0,f.Xb)(r),a=n.getThread();return a&&i===o?a.timelineSet.compareEventOrdering(e,t):P(n,r)}(t,n,r,i)}(this,e,t)}hasEncryptionStateEvent(){var e;return Boolean(null===(e=this.getLiveTimeline().getState(s.q.FORWARDS))||void 0===e?void 0:e.getStateEvents(g.Bx.RoomEncryption,""))}}var W={[u.f.ENCRYPTING]:[u.f.SENDING,u.f.NOT_SENT,u.f.CANCELLED],[u.f.SENDING]:[u.f.ENCRYPTING,u.f.QUEUED,u.f.NOT_SENT,u.f.SENT],[u.f.QUEUED]:[u.f.SENDING,u.f.NOT_SENT,u.f.CANCELLED],[u.f.SENT]:[],[u.f.NOT_SENT]:[u.f.SENDING,u.f.QUEUED,u.f.CANCELLED],[u.f.CANCELLED]:[]},q=function(e){return e[e.EmptyRoom=0]="EmptyRoom",e[e.Generated=1]="Generated",e[e.Actual=2]="Actual",e}({});function H(e,t){var n=t-1;return e.length?1===e.length&&n<=1?e[0]:2===e.length&&n<=2?"".concat(e[0]," and ").concat(e[1]):n>1?"".concat(e[0]," and ").concat(n," others"):"".concat(e[0]," and 1 other"):"Empty room"}},1128:(e,t,n)=>{"use strict";n.d(t,{q:()=>a});var r=n(4980),i=n(8221);class o{constructor(e){this.ourEvent=e,(0,r.A)(this,"timeline",void 0),(0,r.A)(this,"ourEventIndex",0),(0,r.A)(this,"paginateTokens",{[i.O.Backward]:null,[i.O.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.paginateTokens[e?i.O.Backward:i.O.Forward]}setPaginateToken(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.paginateTokens[t?i.O.Backward:i.O.Forward]=null!=e?e:null}addEvents(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class a{static fromJson(e,t){var n=e.context||{},r=(n.events_before||[]).map(t),i=(n.events_after||[]).map(t),s=new o(t(e.result)),l=s.ourEvent.threadRootId;return r=r.filter((e=>e.threadRootId===l)),i=i.filter((e=>e.threadRootId===l)),s.setPaginateToken(n.start,!0),s.addEvents(r,!0),s.addEvents(i,!1),s.setPaginateToken(n.end,!1),new a(e.rank,s)}constructor(e,t){this.rank=e,this.context=t}}},441:(e,t,n)=>{"use strict";n.d(t,{FD:()=>b,H:()=>A,RN:()=>T,UR:()=>k,c1:()=>E,jV:()=>S,ju:()=>_,o1:()=>w,x3:()=>I});var r=n(467),i=n(4980),o=n(4792),a=n(4831),s=n(2986),l=n(9561),c=n(8221),d=n(1200),u=n(4659),h=n(2340),p=n(3840),v=n(6600),m=n(6022),g=n(8140);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(e){return e.New="Thread.new",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thread.viewThread",e.Delete="Thread.delete",e}({}),E=function(e){return e[e.None=0]="None",e[e.Experimental=1]="Experimental",e[e.Stable=2]="Stable",e}({});function b(e,t){return e?E.Stable:t?E.Experimental:E.None}class S extends v.h{constructor(e,t,n){var s,c;if(super(),s=this,this.id=e,this.rootEvent=t,(0,i.A)(this,"timelineSet",void 0),(0,i.A)(this,"_currentUserParticipated",!1),(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"lastEvent",void 0),(0,i.A)(this,"replyCount",0),(0,i.A)(this,"lastPendingEvent",void 0),(0,i.A)(this,"pendingReplyCount",0),(0,i.A)(this,"room",void 0),(0,i.A)(this,"client",void 0),(0,i.A)(this,"pendingEventOrdering",void 0),(0,i.A)(this,"processRootEventPromise",void 0),(0,i.A)(this,"initialEventsFetched",!S.hasServerSideSupport),(0,i.A)(this,"initalEventFetchProm",void 0),(0,i.A)(this,"replayEvents",[]),(0,i.A)(this,"onTimelineReset",(0,r.A)((function*(){yield s.processRootEventPromise,s.processRootEventPromise=void 0}))),(0,i.A)(this,"onBeforeRedaction",((e,t)=>{null!=e&&e.isRelation(T.name)&&this.room.eventShouldLiveIn(e).threadId===this.id&&e.getId()!==this.id&&!t.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(_.Update,this))})),(0,i.A)(this,"onRedaction",function(){var e=(0,r.A)((function*(e,t,n){if(n===s.id)if(s.replyCount<=0){for(var r of s.timeline)s.clearEventMetadata(r);s.lastEvent=s.rootEvent,s._currentUserParticipated=!1,s.emit(_.Delete,s)}else{var i;(null===(i=s.lastEvent)||void 0===i?void 0:i.getId())===e.getAssociatedId()&&(yield s.processRootEventPromise,s.processRootEventPromise=void 0),yield s.updateThreadMetadata()}}));return function(t,n,r){return e.apply(this,arguments)}}()),(0,i.A)(this,"onTimelineEvent",((e,t,n)=>{if(!n){var r=e.getSender();r&&t&&this.shouldSendLocalEchoReceipt(r,e)&&t.addLocalEchoReceipt(r,e,m.L.Read),e.getId()!==this.id&&e.isRelation(T.name)&&this.replyCount++}this.onEcho(e,null!=n&&n)})),(0,i.A)(this,"onLocalEcho",(e=>{this.onEcho(e,!1)})),(0,i.A)(this,"onEcho",function(){var e=(0,r.A)((function*(e,t){e.threadRootId===s.id&&s.lastEvent!==e&&(yield s.updateThreadMetadata(),e.isRelation(T.name)&&(t||(s.lastEvent=void 0,s.emit(_.NewReply,s,e))))}));return function(t,n){return e.apply(this,arguments)}}()),this.setMaxListeners(1e3),null==n||!n.room)throw new Error("element-web#22141: A thread requires a room in order to function");this.room=n.room,this.client=n.client,this.pendingEventOrdering=null!==(c=n.pendingEventOrdering)&&void 0!==c?c:o.eO.Chronological,this.timelineSet=new d.m(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new a.Q(this),this.reEmitter.reEmit(this.timelineSet,[u.u9.Timeline,u.u9.TimelineReset]),this.room.on(l.OQ.BeforeRedaction,this.onBeforeRedaction),this.room.on(u.u9.Redaction,this.onRedaction),this.room.on(u.u9.LocalEchoUpdated,this.onLocalEcho),this.room.on(u.u9.TimelineReset,this.onTimelineReset),this.timelineSet.on(u.u9.Timeline,this.onTimelineEvent),this.processReceipts(n.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return(0,r.A)((function*(){try{var t=yield e.client.fetchRoomEvent(e.roomId,e.id),n=e.client.getEventMapper();e.rootEvent=n(t)}catch(e){p.v.error("Failed to fetch thread root to construct thread with",e)}yield e.processEvent(e.rootEvent)}))()}static setServerSideSupport(e){S.hasServerSideSupport=e,e!==E.Stable&&(w.setPreferUnstable(!0),A.setPreferUnstable(!0),T.setPreferUnstable(!0))}static setServerSideListSupport(e){S.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){S.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,t){var n;if((null!==(n=this.client.canSupport.get(g.Xj.RelationsRecursion))&&void 0!==n?n:g.Tj.Unsupported)===g.Tj.Unsupported){var r,i=null===(r=this.getReadReceiptForUserId(e))||void 0===r?void 0:r.eventId;if(i){var o=this.findEventById(i);if(o&&o.getTs()>t.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(c.q.FORWARDS)}addEventToTimeline(e,t){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:t,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var t=e.getId();t&&(this.findEventById(t)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,t){e.forEach((e=>this.addEvent(e,t,!1))),this.updateThreadMetadata()}addEvent(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setEventMetadata(e);var r=this.lastReply(),i=!r||e.localTimestamp>=r.localTimestamp;if(S.hasServerSideSupport){if(e.isRelation(s.zZ.Annotation)||e.isRelation(s.zZ.Replace))return void this.addRelatedThreadEvent(e,t);!t&&i?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):t?this.addEventToTimeline(e,t):this.insertEventIntoTimeline(e)}else this.addEventToTimeline(e,t),this.client.decryptEventIfNeeded(e);e.getId()!==this.id&&e.isRelation(T.name)&&!t&&i&&(this.lastEvent=void 0),n&&(this.emit(_.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,t){var n,r,i,o;this.initialEventsFetched?(null!==(i=this.client.canSupport.get(g.Xj.RelationsRecursion))&&void 0!==i?i:g.Tj.Unsupported)===g.Tj.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,t):null===(o=this.replayEvents)||void 0===o||o.push(e),null===(n=this.timelineSet.relations)||void 0===n||n.aggregateParentEvent(e),null===(r=this.timelineSet.relations)||void 0===r||r.aggregateChildEvent(e,this.timelineSet)}processEvent(e){var t=this;return(0,r.A)((function*(){e&&(t.setEventMetadata(e),yield t.fetchEditsWhereNeeded(e))}))()}processReceipts(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var{eventId:t,receiptType:n,userId:r,receipt:i,synthetic:o}of e)this.addReceiptToStructure(t,n,r,i,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rootEvent;return null==e?void 0:e.getServerAggregatedRelation(T.name)}processRootEvent(){var e=this;return(0,r.A)((function*(){var t=e.getRootEventBundledRelationship();if(S.hasServerSideSupport&&t){e.replyCount=t.count,e._currentUserParticipated=!!t.current_user_participated;var n=e.client.getEventMapper();e.lastEvent=n(y(y({},t.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}}))()}updatePendingReplyCount(){var e=(this.pendingEventOrdering===o.eO.Detached?this.room.getPendingEvents():this.events).filter((e=>{var t;return e.threadRootId===this.id&&e.isRelation(T.name)&&null!==e.status&&e.getId()!==(null===(t=this.lastEvent)||void 0===t?void 0:t.getId())}));this.lastPendingEvent=e.length?e[e.length-1]:void 0,this.pendingReplyCount=e.length}resetLiveTimeline(e,t){var n=this;return(0,r.A)((function*(){var r=n.liveTimeline;n.timelineSet.resetLiveTimeline(null!=e?e:void 0,null!=t?t:void 0);var i,o,a,s,l=n.liveTimeline;e&&(i=(yield n.client.createMessagesRequest(n.roomId,e,1,c.O.Forward)).end),t&&(o=(yield n.client.createMessagesRequest(n.roomId,t,1,c.O.Backward)).start),t&&r.getPaginationToken(c.O.Forward)===t&&r.setPaginationToken(null!==(a=o)&&void 0!==a?a:null,c.O.Forward),e&&l.getPaginationToken(c.O.Backward)===e&&l.setPaginationToken(null!==(s=i)&&void 0!==s?s:null,c.O.Backward)}))()}updateThreadFromRootEvent(){var e=this;return(0,r.A)((function*(){S.hasServerSideSupport&&(e.initialEventsFetched||e.lastEvent||(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()}))()}updateThreadMetadata(){var e=this;return(0,r.A)((function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{for(var t of(e.timelineSet.resetLiveTimeline(),0===e.replyCount&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,c.O.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0,e.replayEvents))e.addEvent(t,!1);e.replayEvents=null,e.emit(u.u9.TimelineReset,e.room,e.timelineSet,!0)}catch(t){p.v.error("Failed to load start of newly created thread: ",t),e.initialEventsFetched=!1}e.emit(_.Update,e)}))()}fetchEditsWhereNeeded(){var e=arguments,t=this;return(0,r.A)((function*(){var n;if((null!==(n=t.client.canSupport.get(g.Xj.RelationsRecursion))&&void 0!==n?n:g.Tj.Unsupported)===g.Tj.Unsupported){for(var i=e.length,o=new Array(i),a=0;a<i;a++)o[a]=e[a];return Promise.all(o.filter(C).map(function(){var e=(0,r.A)((function*(e){try{var n=yield t.client.relations(t.roomId,e.getId(),s.zZ.Replace,e.getType(),{limit:1});if(n.events.length){var r=n.events[0];e.makeReplaced(r),t.insertEventIntoTimeline(r)}}catch(e){p.v.error("Failed to load edits for encrypted thread event",e)}}));return function(t){return e.apply(this,arguments)}}()))}}))()}setEventMetadata(e){e&&(c.q.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var t;e&&(e.setThread(void 0),null===(t=e.event)||void 0===t||null===(t=t.unsigned)||void 0===t||null===(t=t["m.relations"])||void 0===t||delete t[T.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e.isRelation(T.name),t=this.timeline.length-1;t>=0;t--){var n=this.timeline[t];if(e(n))return n}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,t;return null!==(e=null!==(t=this.lastPendingEvent)&&void 0!==t?t:this.lastEvent)&&void 0!==e?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof l.kl}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,t){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,t){var n=e===this.client.getUserId(),r=this.timeline[this.timeline.length-1];if(n&&r){var i=r.getTs()<this.room.getOldestThreadedReceiptTs(),o=r.getId();if(i&&o)return o}var a=super.getEventReadUpTo(e,t);if(r){var s=this.room.getLastUnthreadedReceiptFor(e);if(!s)return a;for(var l=(null===(c=this.timeline)||void 0===c?void 0:c.length)-1;l>=0;--l){var c,d,u=this.timeline[l];if(u.getId()===a)return a;if(u.getTs()<s.ts)return null!==(d=u.getId())&&void 0!==d?d:a}}return a}hasUserReadEvent(e,t){if(e===this.client.getUserId()){var n,r,i,o,a,s,l=(null!==(n=null===(r=this.lastReply())||void 0===r?void 0:r.getTs())&&void 0!==n?n:0)<this.room.getOldestThreadedReceiptTs(),c=null!==(i=null===(o=this.room.getLastUnthreadedReceiptFor(e))||void 0===o?void 0:o.ts)&&void 0!==i?i:0,d=(null!==(a=null==this||null===(s=this.lastReply())||void 0===s?void 0:s.getTs())&&void 0!==a?a:0)<c;if(l||d)return!0}return this.room.hasUserReadEvent(e,t)}setUnread(e,t){return this.room.setThreadUnreadNotificationCount(this.id,e,t)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}function C(e){return e.isEncrypted()&&(e.isRelation(T.name)||e.isThreadRoot)}(0,i.A)(S,"hasServerSideSupport",E.None),(0,i.A)(S,"hasServerSideListSupport",E.None),(0,i.A)(S,"hasServerSideFwdPaginationSupport",E.None);var w=new h.M6("related_by_senders","io.element.relation_senders"),A=new h.M6("related_by_rel_types","io.element.relation_types"),T=new h.M6("m.thread","io.element.thread"),I=function(e){return e[e.My=0]="My",e[e.All=1]="All",e}({});function k(e){return e===I.My?"participated":"all"}},6387:(e,t,n)=>{"use strict";n.d(t,{X:()=>a,u:()=>o});var r=n(467),i=n(7007),o=function(e){return e.NewListener="newListener",e.RemoveListener="removeListener",e.Error="error",e}({});class a extends i.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return super.emit(e,...n)}emitPromised(e){var t=arguments,n=this;return(0,r.A)((function*(){for(var r=t.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=t[o];var a=n.listeners(e);return Promise.allSettled(a.map((e=>e(...i)))).then((()=>a.length>0))}))()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return void 0===e?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}},8230:(e,t,n)=>{"use strict";n.d(t,{K:()=>a,U:()=>o});var r=n(4980),i=n(6387),o=function(e){return e.DisplayName="User.displayName",e.AvatarUrl="User.avatarUrl",e.Presence="User.presence",e.CurrentlyActive="User.currentlyActive",e.LastPresenceTs="User.lastPresenceTs",e}({});class a extends i.X{constructor(e){super(),this.userId=e,(0,r.A)(this,"modified",-1),(0,r.A)(this,"displayName",void 0),(0,r.A)(this,"rawDisplayName",void 0),(0,r.A)(this,"avatarUrl",void 0),(0,r.A)(this,"presenceStatusMsg",void 0),(0,r.A)(this,"presence","offline"),(0,r.A)(this,"lastActiveAgo",0),(0,r.A)(this,"lastPresenceTs",0),(0,r.A)(this,"currentlyActive",!1),(0,r.A)(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,t){var n=new a(e);return t.reEmitter.reEmit(n,[o.AvatarUrl,o.DisplayName,o.Presence,o.CurrentlyActive,o.LastPresenceTs]),n}setPresenceEvent(e){if("m.presence"===e.getType()){var t=null===this.events.presence;this.events.presence=e;var n=[];for(var r of((e.getContent().presence!==this.presence||t)&&n.push(o.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push(o.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push(o.DisplayName),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push(o.CurrentlyActive),this.presence=e.getContent().presence,n.push(o.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime(),n))this.emit(r,e,this)}}setDisplayName(e){var t=this.displayName;this.displayName=e,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}},4047:(e,t,n)=>{"use strict";n.d(t,{AO:()=>ye,uv:()=>W,db:()=>Ee,SU:()=>he,Rh:()=>Q,k8:()=>ge,P3:()=>ce,cJ:()=>de,R2:()=>ue,oE:()=>se,aT:()=>_e,EZ:()=>X,Pl:()=>fe,eC:()=>ne,rm:()=>Z,K8:()=>ee});var r=n(4980),i=n(467);class o extends Error{}function a(e,t){if("string"!=typeof e)throw new o("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new o(`Invalid token specified: missing part #${n+1}`);let i;try{i=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return atob(t)}}(r)}catch(e){throw new o(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(i)}catch(e){throw new o(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}o.prototype.name="InvalidTokenError";var s,l,c,d={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},u=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(u||{});(c=u||(u={})).reset=function(){s=3,l=d},c.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");s=e},c.setLogger=function(e){l=e};var h=class e{constructor(e){this._name=e}debug(...t){s>=4&&l.debug(e._format(this._name,this._method),...t)}info(...t){s>=3&&l.info(e._format(this._name,this._method),...t)}warn(...t){s>=2&&l.warn(e._format(this._name,this._method),...t)}error(...t){s>=1&&l.error(e._format(this._name,this._method),...t)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(t,n){const r=new e(`${t}.${n}`);return r.debug("begin"),r}static _format(e,t){const n=`[${e}]`;return t?`${n} ${t}:`:n}static debug(t,...n){s>=4&&l.debug(e._format(t),...n)}static info(t,...n){s>=3&&l.info(e._format(t),...n)}static warn(t,...n){s>=2&&l.warn(e._format(t),...n)}static error(t,...n){s>=1&&l.error(e._format(t),...n)}};u.reset();var p=class{static decode(e){try{return a(e)}catch(e){throw h.error("JwtUtils.decode",e),e}}static async generateSignedJwt(e,t,n){const r=`${g.encodeBase64Url((new TextEncoder).encode(JSON.stringify(e)))}.${g.encodeBase64Url((new TextEncoder).encode(JSON.stringify(t)))}`,i=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,(new TextEncoder).encode(r));return`${r}.${g.encodeBase64Url(new Uint8Array(i))}`}},v=e=>btoa([...new Uint8Array(e)].map((e=>String.fromCharCode(e))).join("")),m=class e{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(+t^e._randomWord()&15>>+t/4).toString(16))).replace(/-/g,"")}static generateCodeVerifier(){return e.generateUUIDv4()+e.generateUUIDv4()+e.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return v(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw h.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const n=(new TextEncoder).encode([e,t].join(":"));return v(n)}static async hash(e,t){const n=(new TextEncoder).encode(t),r=await crypto.subtle.digest(e,n);return new Uint8Array(r)}static async customCalculateJwkThumbprint(t){let n;switch(t.kty){case"RSA":n={e:t.e,kty:t.kty,n:t.n};break;case"EC":n={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":n={crv:t.crv,kty:t.kty,x:t.x};break;case"oct":n={crv:t.k,kty:t.kty};break;default:throw new Error("Unknown jwk type")}const r=await e.hash("SHA-256",JSON.stringify(n));return e.encodeBase64Url(r)}static async generateDPoPProof({url:t,accessToken:n,httpMethod:r,keyPair:i,nonce:o}){let a,s;const l={jti:window.crypto.randomUUID(),htm:null!=r?r:"GET",htu:t,iat:Math.floor(Date.now()/1e3)};n&&(a=await e.hash("SHA-256",n),s=e.encodeBase64Url(a),l.ath=s),o&&(l.nonce=o);try{const e=await crypto.subtle.exportKey("jwk",i.publicKey),t={alg:"ES256",typ:"dpop+jwt",jwk:{crv:e.crv,kty:e.kty,x:e.x,y:e.y}};return await p.generateSignedJwt(t,l,i.privateKey)}catch(e){throw e instanceof TypeError?new Error(`Error exporting dpop public key: ${e.message}`):e}}static async generateDPoPJkt(t){try{const n=await crypto.subtle.exportKey("jwk",t.publicKey);return await e.customCalculateJwkThumbprint(n)}catch(e){throw e instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${e.message}`):e}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};m.encodeBase64Url=e=>v(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var g=m,f=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new h(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}async raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)await t(...e)}},y=class e extends f{constructor(){super(...arguments),this._logger=new h(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const t=this._expiration-e.getEpochTime();this._logger.debug("timer completes in",t),this._expiration<=e.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(t){const n=this._logger.create("init");t=Math.max(Math.floor(t),1);const r=e.getEpochTime()+t;if(this.expiration===r&&this._timerHandle)return void n.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),n.debug("using duration",t),this._expiration=r;const i=Math.min(t,5);this._timerHandle=setInterval(this._callback,1e3*i)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},_=class{static readParams(e,t="query"){if(!e)throw new TypeError("Invalid URL");const n=new URL(e,"http://127.0.0.1")["fragment"===t?"hash":"search"];return new URLSearchParams(n.slice(1))}},E=class extends Error{constructor(e,t){var n,r,i;if(super(e.error_description||e.error||""),this.form=t,this.name="ErrorResponse",!e.error)throw h.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=e.error,this.error_description=null!=(n=e.error_description)?n:null,this.error_uri=null!=(r=e.error_uri)?r:null,this.state=e.userState,this.session_state=null!=(i=e.session_state)?i:null,this.url_state=e.url_state}},b=class extends Error{constructor(e){super(e),this.name="ErrorTimeout"}},S=class{constructor(){this._logger=new h("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(e){return this._logger.create(`getItem('${e}')`),this._data[e]}setItem(e,t){this._logger.create(`setItem('${e}')`),this._data[e]=t}removeItem(e){this._logger.create(`removeItem('${e}')`),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},C=class extends Error{constructor(e,t){super(t),this.name="ErrorDPoPNonce",this.nonce=e}},w=class{constructor(e=[],t=null,n={}){this._jwtHandler=t,this._extraHeaders=n,this._logger=new h("JsonService"),this._contentTypes=[],this._contentTypes.push(...e,"application/json"),t&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(e,t={}){const{timeoutInSeconds:n,...r}=t;if(!n)return await fetch(e,r);const i=new AbortController,o=setTimeout((()=>i.abort()),1e3*n);try{return await fetch(e,{...t,signal:i.signal})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)throw new b("Network timed out");throw e}finally{clearTimeout(o)}}async getJson(e,{token:t,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),o={Accept:this._contentTypes.join(", ")};let a;t&&(i.debug("token passed, setting Authorization header"),o.Authorization="Bearer "+t),this.appendExtraHeaders(o);try{i.debug("url:",e),a=await this.fetchWithTimeout(e,{method:"GET",headers:o,timeoutInSeconds:r,credentials:n})}catch(e){throw i.error("Network Error"),e}i.debug("HTTP response received, status",a.status);const s=a.headers.get("Content-Type");if(s&&!this._contentTypes.find((e=>s.startsWith(e)))&&i.throw(new Error(`Invalid response Content-Type: ${null!=s?s:"undefined"}, from URL: ${e}`)),a.ok&&this._jwtHandler&&(null==s?void 0:s.startsWith("application/jwt")))return await this._jwtHandler(await a.text());let l;try{l=await a.json()}catch(e){if(i.error("Error parsing JSON response",e),a.ok)throw e;throw new Error(`${a.statusText} (${a.status})`)}if(!a.ok){if(i.error("Error from server:",l),l.error)throw new E(l);throw new Error(`${a.statusText} (${a.status}): ${JSON.stringify(l)}`)}return l}async postForm(e,{body:t,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:o}){const a=this._logger.create("postForm"),s={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...o};let l;void 0!==n&&(s.Authorization="Basic "+n),this.appendExtraHeaders(s);try{a.debug("url:",e),l=await this.fetchWithTimeout(e,{method:"POST",headers:s,body:t,timeoutInSeconds:r,credentials:i})}catch(e){throw a.error("Network error"),e}a.debug("HTTP response received, status",l.status);const c=l.headers.get("Content-Type");if(c&&!this._contentTypes.find((e=>c.startsWith(e))))throw new Error(`Invalid response Content-Type: ${null!=c?c:"undefined"}, from URL: ${e}`);const d=await l.text();let u={};if(d)try{u=JSON.parse(d)}catch(e){if(a.error("Error parsing JSON response",e),l.ok)throw e;throw new Error(`${l.statusText} (${l.status})`)}if(!l.ok){if(a.error("Error from server:",u),l.headers.has("dpop-nonce")){const e=l.headers.get("dpop-nonce");throw new C(e,`${JSON.stringify(u)}`)}if(u.error)throw new E(u,t);throw new Error(`${l.statusText} (${l.status}): ${JSON.stringify(u)}`)}return u}appendExtraHeaders(e){const t=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];0!==n.length&&n.forEach((n=>{if(r.includes(n.toLocaleLowerCase()))return void t.warn("Protected header could not be overridden",n,r);const i="function"==typeof this._extraHeaders[n]?this._extraHeaders[n]():this._extraHeaders[n];i&&""!==i&&(e[n]=i)}))}},A=class{constructor(e){this._settings=e,this._logger=new h("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new w(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const e=this._logger.create("getMetadata");if(this._metadata)return e.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw e.throw(new Error("No authority or metadataUrl configured on settings")),null;e.debug("getting metadata from",this._metadataUrl);const t=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,t),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(e=!0){return this._getMetadataProperty("revocation_endpoint",e)}getKeysEndpoint(e=!0){return this._getMetadataProperty("jwks_uri",e)}async _getMetadataProperty(e,t=!1){const n=this._logger.create(`_getMetadataProperty('${e}')`),r=await this.getMetadata();if(n.debug("resolved"),void 0===r[e]){if(!0===t)return void n.warn("Metadata does not contain optional property");n.throw(new Error("Metadata does not contain property "+e))}return r[e]}async getSigningKeys(){const e=this._logger.create("getSigningKeys");if(this._signingKeys)return e.debug("returning signingKeys from cache"),this._signingKeys;const t=await this.getKeysEndpoint(!1);e.debug("got jwks_uri",t);const n=await this._jsonService.getJson(t,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(e.debug("got key set",n),!Array.isArray(n.keys))throw e.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},T=class{constructor({prefix:e="oidc.",store:t=localStorage}={}){this._logger=new h("WebStorageStateStore"),this._store=t,this._prefix=e}async set(e,t){this._logger.create(`set('${e}')`),e=this._prefix+e,await this._store.setItem(e,t)}async get(e){return this._logger.create(`get('${e}')`),e=this._prefix+e,await this._store.getItem(e)}async remove(e){this._logger.create(`remove('${e}')`),e=this._prefix+e;const t=await this._store.getItem(e);return await this._store.removeItem(e),t}async getAllKeys(){this._logger.create("getAllKeys");const e=await this._store.length,t=[];for(let n=0;n<e;n++){const e=await this._store.key(n);e&&0===e.indexOf(this._prefix)&&t.push(e.substr(this._prefix.length))}return t}},I=class{constructor({authority:e,metadataUrl:t,metadata:n,signingKeys:r,metadataSeed:i,client_id:o,client_secret:a,response_type:s="code",scope:l="openid",redirect_uri:c,post_logout_redirect_uri:d,client_authentication:u="client_secret_post",prompt:h,display:p,max_age:v,ui_locales:m,acr_values:g,resource:f,response_mode:y,filterProtocolClaims:_=!0,loadUserInfo:E=!1,requestTimeoutInSeconds:b,staleStateAgeInSeconds:C=900,mergeClaimsStrategy:w={array:"replace"},disablePKCE:A=!1,stateStore:I,revokeTokenAdditionalContentTypes:k,fetchRequestCredentials:O,refreshTokenAllowedScope:R,extraQueryParams:x={},extraTokenParams:N={},extraHeaders:D={},dpop:L,omitScopeWhenRequesting:P=!1}){var M;if(this.authority=e,t?this.metadataUrl=t:(this.metadataUrl=e,e&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=o,this.client_secret=a,this.response_type=s,this.scope=l,this.redirect_uri=c,this.post_logout_redirect_uri=d,this.client_authentication=u,this.prompt=h,this.display=p,this.max_age=v,this.ui_locales=m,this.acr_values=g,this.resource=f,this.response_mode=y,this.filterProtocolClaims=null==_||_,this.loadUserInfo=!!E,this.staleStateAgeInSeconds=C,this.mergeClaimsStrategy=w,this.omitScopeWhenRequesting=P,this.disablePKCE=!!A,this.revokeTokenAdditionalContentTypes=k,this.fetchRequestCredentials=O||"same-origin",this.requestTimeoutInSeconds=b,I)this.stateStore=I;else{const e="undefined"!=typeof window?window.localStorage:new S;this.stateStore=new T({store:e})}if(this.refreshTokenAllowedScope=R,this.extraQueryParams=x,this.extraTokenParams=N,this.extraHeaders=D,this.dpop=L,this.dpop&&!(null==(M=this.dpop)?void 0:M.store))throw new Error("A DPoPStore is required when dpop is enabled")}},k=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new h("UserInfoService"),this._getClaimsFromJwt=async e=>{const t=this._logger.create("_getClaimsFromJwt");try{const n=p.decode(e);return t.debug("JWT decoding successful"),n}catch(e){throw t.error("Error parsing JWT response"),e}},this._jsonService=new w(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(e){const t=this._logger.create("getClaims");e||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();t.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:e,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("got claims",r),r}},O=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new h("TokenClient"),this._jsonService=new w(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:e="authorization_code",redirect_uri:t=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...o}){const a=this._logger.create("exchangeCode");n||a.throw(new Error("A client_id is required")),t||a.throw(new Error("A redirect_uri is required")),o.code||a.throw(new Error("A code is required"));const s=new URLSearchParams({grant_type:e,redirect_uri:t});for(const[e,t]of Object.entries(o))null!=t&&s.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw a.throw(new Error("A client_secret is required")),null;l=g.generateBasicAuth(n,r);break;case"client_secret_post":s.append("client_id",n),r&&s.append("client_secret",r)}const c=await this._metadataService.getTokenEndpoint(!1);a.debug("got token endpoint");const d=await this._jsonService.postForm(c,{body:s,basicAuth:l,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return a.debug("got response"),d}async exchangeCredentials({grant_type:e="password",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const o=this._logger.create("exchangeCredentials");t||o.throw(new Error("A client_id is required"));const a=new URLSearchParams({grant_type:e});this._settings.omitScopeWhenRequesting||a.set("scope",r);for(const[e,t]of Object.entries(i))null!=t&&a.set(e,t);let s;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;s=g.generateBasicAuth(t,n);break;case"client_secret_post":a.append("client_id",t),n&&a.append("client_secret",n)}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const c=await this._jsonService.postForm(l,{body:a,basicAuth:s,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return o.debug("got response"),c}async exchangeRefreshToken({grant_type:e="refresh_token",client_id:t=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...o}){const a=this._logger.create("exchangeRefreshToken");t||a.throw(new Error("A client_id is required")),o.refresh_token||a.throw(new Error("A refresh_token is required"));const s=new URLSearchParams({grant_type:e});for(const[e,t]of Object.entries(o))Array.isArray(t)?t.forEach((t=>s.append(e,t))):null!=t&&s.set(e,t);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw a.throw(new Error("A client_secret is required")),null;l=g.generateBasicAuth(t,n);break;case"client_secret_post":s.append("client_id",t),n&&s.append("client_secret",n)}const c=await this._metadataService.getTokenEndpoint(!1);a.debug("got token endpoint");const d=await this._jsonService.postForm(c,{body:s,basicAuth:l,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return a.debug("got response"),d}async revoke(e){var t;const n=this._logger.create("revoke");e.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${null!=(t=e.token_type_hint)?t:"default token type"}`);const i=new URLSearchParams;for(const[t,n]of Object.entries(e))null!=n&&i.set(t,n);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},R=class{constructor(e,t,n){this._settings=e,this._metadataService=t,this._claimsService=n,this._logger=new h("ResponseValidator"),this._userInfoService=new k(this._settings,this._metadataService),this._tokenClient=new O(this._settings,this._metadataService)}async validateSigninResponse(e,t,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(e,t),r.debug("state processed"),await this._processCode(e,t,n),r.debug("code processed"),e.isOpenId&&this._validateIdTokenAttributes(e),r.debug("tokens validated"),await this._processClaims(e,null==t?void 0:t.skipUserInfo,e.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(e,t){const n=this._logger.create("validateCredentialsResponse");e.isOpenId&&e.id_token&&this._validateIdTokenAttributes(e),n.debug("tokens validated"),await this._processClaims(e,t,e.isOpenId),n.debug("claims processed")}async validateRefreshResponse(e,t){const n=this._logger.create("validateRefreshResponse");e.userState=t.data,null!=e.session_state||(e.session_state=t.session_state),null!=e.scope||(e.scope=t.scope),e.isOpenId&&e.id_token&&(this._validateIdTokenAttributes(e,t.id_token),n.debug("ID Token validated")),e.id_token||(e.id_token=t.id_token,e.profile=t.profile);const r=e.isOpenId&&!!e.id_token;await this._processClaims(e,!1,r),n.debug("claims processed")}validateSignoutResponse(e,t){const n=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&n.throw(new Error("State does not match")),n.debug("state validated"),e.userState=t.data,e.error)throw n.warn("Response was error",e.error),new E(e)}_processSigninState(e,t){const n=this._logger.create("_processSigninState");if(t.id!==e.state&&n.throw(new Error("State does not match")),t.client_id||n.throw(new Error("No client_id on state")),t.authority||n.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&n.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&n.throw(new Error("client_id mismatch on settings vs. signin state")),n.debug("state validated"),e.userState=t.data,e.url_state=t.url_state,null!=e.scope||(e.scope=t.scope),e.error)throw n.warn("Response was error",e.error),new E(e);t.code_verifier&&!e.code&&n.throw(new Error("Expected code in response"))}async _processClaims(e,t=!1,n=!0){const r=this._logger.create("_processClaims");if(e.profile=this._claimsService.filterProtocolClaims(e.profile),t||!this._settings.loadUserInfo||!e.access_token)return void r.debug("not loading user info");r.debug("loading user info");const i=await this._userInfoService.getClaims(e.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==e.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),e.profile=this._claimsService.mergeClaims(e.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",e.profile)}async _processCode(e,t,n){const r=this._logger.create("_processCode");if(e.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:t.client_id,client_secret:t.client_secret,code:e.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier,extraHeaders:n,...t.extraTokenParams});Object.assign(e,i)}else r.debug("No code to process")}_validateIdTokenAttributes(e,t){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=p.decode(null!=(n=e.id_token)?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),t){const e=p.decode(t);i.sub!==e.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==e.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==e.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&e.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=i}},x=class e{constructor(e){this.id=e.id||g.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=y.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new h("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(t){return h.createStatic("State","fromStorageString"),Promise.resolve(new e(JSON.parse(t)))}static async clearStaleState(t,n){const r=h.createStatic("State","clearStaleState"),i=y.getEpochTime()-n,o=await t.getAllKeys();r.debug("got keys",o);for(let n=0;n<o.length;n++){const a=o[n],s=await t.get(a);let l=!1;if(s)try{const t=await e.fromStorageString(s);r.debug("got item from key:",a,t.created),t.created<=i&&(l=!0)}catch(e){r.error("Error parsing state for key:",a,e),l=!0}else r.debug("no item in storage for key:",a),l=!0;l&&(r.debug("removed item for key:",a),t.remove(a))}}},N=class e extends x{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(t){const n=!0===t.code_verifier?g.generateCodeVerifier():t.code_verifier||void 0,r=n?await g.generateCodeChallenge(n):void 0;return new e({...t,code_verifier:n,code_challenge:r})}toStorageString(){return new h("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(t){h.createStatic("SigninState","fromStorageString");const n=JSON.parse(t);return e.create(n)}},D=class e{constructor(e){this.url=e.url,this.state=e.state}static async create({url:t,authority:n,client_id:r,redirect_uri:i,response_type:o,scope:a,state_data:s,response_mode:l,request_type:c,client_secret:d,nonce:u,url_state:h,resource:p,skipUserInfo:v,extraQueryParams:m,extraTokenParams:g,disablePKCE:f,dpopJkt:y,omitScopeWhenRequesting:_,...E}){if(!t)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!o)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!a)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const b=await N.create({data:s,request_type:c,url_state:h,code_verifier:!f,client_id:r,authority:n,redirect_uri:i,response_mode:l,client_secret:d,scope:a,extraTokenParams:g,skipUserInfo:v}),S=new URL(t);S.searchParams.append("client_id",r),S.searchParams.append("redirect_uri",i),S.searchParams.append("response_type",o),_||S.searchParams.append("scope",a),u&&S.searchParams.append("nonce",u),y&&S.searchParams.append("dpop_jkt",y);let C=b.id;h&&(C=`${C};${h}`),S.searchParams.append("state",C),b.code_challenge&&(S.searchParams.append("code_challenge",b.code_challenge),S.searchParams.append("code_challenge_method","S256")),p&&(Array.isArray(p)?p:[p]).forEach((e=>S.searchParams.append("resource",e)));for(const[e,t]of Object.entries({response_mode:l,...E,...m}))null!=t&&S.searchParams.append(e,t.toString());return new e({url:S.href,state:b})}};D._logger=new h("SigninRequest");var L=D,P=class{constructor(e){if(this.access_token="",this.token_type="",this.profile={},this.state=e.get("state"),this.session_state=e.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(";");this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(";"))}this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri"),this.code=e.get("code")}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-y.getEpochTime()}set expires_in(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+y.getEpochTime())}get isOpenId(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes("openid"))||!!this.id_token}},M=class{constructor({url:e,state_data:t,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:o,client_id:a}){if(this._logger=new h("SignoutRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");const s=new URL(e);n&&s.searchParams.append("id_token_hint",n),a&&s.searchParams.append("client_id",a),r&&(s.searchParams.append("post_logout_redirect_uri",r),t&&(this.state=new x({data:t,request_type:o}),s.searchParams.append("state",this.state.id)));for(const[e,t]of Object.entries({...i}))null!=t&&s.searchParams.append(e,t.toString());this.url=s.href}},U=class{constructor(e){this.state=e.get("state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri")}},F=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],B=["sub","iss","aud","exp","iat"],G=class{constructor(e){this._settings=e,this._logger=new h("ClaimsService")}filterProtocolClaims(e){const t={...e};if(this._settings.filterProtocolClaims){let e;e=Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:F;for(const n of e)B.includes(n)||delete t[n]}return t}mergeClaims(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(n[e]!==r)if(Array.isArray(n[e])||Array.isArray(r))if("replace"==this._settings.mergeClaimsStrategy.array)n[e]=r;else{const t=Array.isArray(n[e])?n[e]:[n[e]];for(const e of Array.isArray(r)?r:[r])t.includes(e)||t.push(e);n[e]=t}else"object"==typeof n[e]&&"object"==typeof r?n[e]=this.mergeClaims(n[e],r):n[e]=r;return n}},$=class{constructor(e,t){this.keys=e,this.nonce=t}},V=class{constructor(e,t){this._logger=new h("OidcClient"),this.settings=e instanceof I?e:new I(e),this.metadataService=null!=t?t:new A(this.settings),this._claimsService=new G(this.settings),this._validator=new R(this.settings,this.metadataService,this._claimsService),this._tokenClient=new O(this.settings,this.metadataService)}async createSigninRequest({state:e,request:t,request_uri:n,request_type:r,id_token_hint:i,login_hint:o,skipUserInfo:a,nonce:s,url_state:l,response_type:c=this.settings.response_type,scope:d=this.settings.scope,redirect_uri:u=this.settings.redirect_uri,prompt:h=this.settings.prompt,display:p=this.settings.display,max_age:v=this.settings.max_age,ui_locales:m=this.settings.ui_locales,acr_values:g=this.settings.acr_values,resource:f=this.settings.resource,response_mode:y=this.settings.response_mode,extraQueryParams:_=this.settings.extraQueryParams,extraTokenParams:E=this.settings.extraTokenParams,dpopJkt:b,omitScopeWhenRequesting:S=this.settings.omitScopeWhenRequesting}){const C=this._logger.create("createSigninRequest");if("code"!==c)throw new Error("Only the Authorization Code flow (with PKCE) is supported");const w=await this.metadataService.getAuthorizationEndpoint();C.debug("Received authorization endpoint",w);const A=await L.create({url:w,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:u,response_type:c,scope:d,state_data:e,url_state:l,prompt:h,display:p,max_age:v,ui_locales:m,id_token_hint:i,login_hint:o,acr_values:g,dpopJkt:b,resource:f,request:t,request_uri:n,extraQueryParams:_,extraTokenParams:E,request_type:r,response_mode:y,client_secret:this.settings.client_secret,skipUserInfo:a,nonce:s,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:S});await this.clearStaleState();const T=A.state;return await this.settings.stateStore.set(T.id,T.toStorageString()),A}async readSigninResponseState(e,t=!1){const n=this._logger.create("readSigninResponseState"),r=new P(_.readParams(e,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await N.fromStorageString(i),response:r}}async processSigninResponse(e,t){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(e,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);t={...t,DPoP:e}}try{await this._validator.validateSigninResponse(i,r,t)}catch(e){if(!(e instanceof C&&this.settings.dpop))throw e;{const n=await this.getDpopProof(this.settings.dpop.store,e.nonce);t.DPoP=n,await this._validator.validateSigninResponse(i,r,t)}}return i}async getDpopProof(e,t){let n,r;return(await e.getAllKeys()).includes(this.settings.client_id)?(r=await e.get(this.settings.client_id),r.nonce!==t&&t&&(r.nonce=t,await e.set(this.settings.client_id,r))):(n=await g.generateDPoPKeys(),r=new $(n,t),await e.set(this.settings.client_id,r)),await g.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:e,password:t,...r}),o=new P(new URLSearchParams);return Object.assign(o,i),await this._validator.validateCredentialsResponse(o,n),o}async useRefreshToken({state:e,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:o}){var a;const s=this._logger.create("useRefreshToken");let l,c;if(void 0===this.settings.refreshTokenAllowedScope)l=e.scope;else{const t=this.settings.refreshTokenAllowedScope.split(" ");l=((null==(a=e.scope)?void 0:a.split(" "))||[]).filter((e=>t.includes(e))).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const e=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:e}}try{c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}catch(a){if(!(a instanceof C&&this.settings.dpop))throw a;i.DPoP=await this.getDpopProof(this.settings.dpop.store,a.nonce),c=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:l,redirect_uri:t,resource:n,timeoutInSeconds:r,extraHeaders:i,...o})}const d=new P(new URLSearchParams);return Object.assign(d,c),s.debug("validating response",d),await this._validator.validateRefreshResponse(d,{...e,scope:l}),d}async createSignoutRequest({state:e,id_token_hint:t,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:o=this.settings.extraQueryParams}={}){const a=this._logger.create("createSignoutRequest"),s=await this.metadataService.getEndSessionEndpoint();if(!s)throw a.throw(new Error("No end session endpoint")),null;a.debug("Received end session endpoint",s),n||!i||t||(n=this.settings.client_id);const l=new M({url:s,id_token_hint:t,client_id:n,post_logout_redirect_uri:i,state_data:e,extraQueryParams:o,request_type:r});await this.clearStaleState();const c=l.state;return c&&(a.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),l}async readSignoutResponseState(e,t=!1){const n=this._logger.create("readSignoutResponseState"),r=new U(_.readParams(e,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new E(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[t?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await x.fromStorageString(i),response:r}}async processSignoutResponse(e){const t=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(e,!0);return n?(t.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):t.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),x.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(e,t){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:e,token_type_hint:t})}},j=n(3840),K=n(5942),W=function(e){return e.NotSupported="OIDC authentication not supported",e.Misconfigured="OIDC is misconfigured",e.General="Something went wrong with OIDC discovery",e.OpSupport="Configured OIDC OP does not support required functions",e.DynamicRegistrationNotSupported="Dynamic registration not supported",e.DynamicRegistrationFailed="Dynamic registration failed",e.DynamicRegistrationInvalid="Dynamic registration invalid response",e.CodeExchangeFailed="Failed to exchange code for token",e.InvalidBearerTokenResponse="Invalid bearer token response",e.InvalidIdToken="Invalid ID token",e.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",e}({}),q=e=>!!e&&"object"==typeof e&&!Array.isArray(e),H=(e,t)=>!(!e[t]||!Y(e,t))||(j.v.error("Missing or invalid property: ".concat(t)),!1),Y=(e,t)=>!e[t]||"string"==typeof e[t]||(j.v.error("Invalid property: ".concat(t)),!1),z=(e,t)=>!!(!e[t]||Array.isArray(e[t])&&e[t].every((e=>"string"==typeof e)))||(j.v.error("Invalid property: ".concat(t)),!1),J=(e,t,n)=>{var r=e[t];return!!(r&&Array.isArray(r)&&r.includes(n))||(j.v.error("Invalid property: ".concat(t,". ").concat(n," is required.")),!1)},X=e=>{if(!q(e))throw j.v.error("Issuer configuration not found or malformed"),new Error(W.OpSupport);if(![H(e,"issuer"),H(e,"authorization_endpoint"),H(e,"token_endpoint"),H(e,"revocation_endpoint"),Y(e,"registration_endpoint"),Y(e,"account_management_uri"),Y(e,"device_authorization_endpoint"),z(e,"account_management_actions_supported"),J(e,"response_types_supported","code"),J(e,"grant_types_supported","authorization_code"),J(e,"code_challenge_methods_supported","S256"),z(e,"prompt_values_supported")].some((e=>!e)))return e;throw j.v.error("Issuer configuration not valid"),new Error(W.OpSupport)},Q=e=>{try{return a(e)}catch(e){throw j.v.error("Could not decode id_token",e),e}},Z=(e,t,n,r)=>{try{if(!e)throw new Error("No ID token");var i=Q(e);if(i.iss!==t)throw new Error("Invalid issuer");if(!("string"==typeof i.aud?[i.aud]:i.aud).includes(n))throw new Error("Invalid audience");if(void 0!==r&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>1e3*i.exp)throw new Error("Invalid expiry")}catch(e){throw j.v.error("Invalid ID token",e),new Error(W.InvalidIdToken)}};function ee(e){if(!q(e))throw j.v.error("Stored user state not found"),new Error(W.MissingOrInvalidStoredState);if([H(e,"homeserverUrl"),H(e,"nonce"),Y(e,"identityServerUrl")].some((e=>!e)))throw new Error(W.MissingOrInvalidStoredState)}var te=e=>q(e)&&H(e,"token_type")&&"bearer"===e.token_type.toLowerCase()&&H(e,"access_token")&&H(e,"refresh_token")&&(!("expires_in"in e)||"number"==typeof e.expires_in);function ne(e){if(!te(e))throw new Error(W.InvalidBearerTokenResponse)}var re=n(5792),ie=n(7723);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se=e=>{var t=null!=e?e:(0,K.US)(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(t)},le=function(){var e=(0,i.A)((function*(e){if(!globalThis.crypto.subtle)return j.v.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e;var t=yield(0,re.s)(e);return(0,ie.A4)(t)}));return function(t){return e.apply(this,arguments)}}(),ce=e=>{var{redirectUri:t}=e;return{scope:se(),redirectUri:t,state:(0,K.US)(8),nonce:(0,K.US)(8),codeVerifier:(0,K.US)(64)}},de=function(){var e=(0,i.A)((function*(e,t,n){var{scope:r,redirectUri:i,state:o,nonce:a,codeVerifier:s}=n,l=new URL(e);return l.searchParams.append("response_mode","query"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",i),l.searchParams.append("client_id",t),l.searchParams.append("state",o),l.searchParams.append("scope",r),l.searchParams.append("nonce",a),l.searchParams.append("code_challenge_method","S256"),l.searchParams.append("code_challenge",yield le(s)),l.toString()}));return function(t,n,r){return e.apply(this,arguments)}}(),ue=function(){var e=(0,i.A)((function*(e){var{metadata:t,redirectUri:n,clientId:r,homeserverUrl:i,identityServerUrl:o,nonce:a,prompt:s,urlState:l}=e,c=se(),d=new V(ae(ae({},t),{},{client_id:r,redirect_uri:n,authority:t.issuer,response_mode:"query",response_type:"code",scope:c,stateStore:new T({prefix:"mx_oidc_",store:window.sessionStorage})})),u={homeserverUrl:i,nonce:a,identityServerUrl:o};return(yield d.createSigninRequest({state:u,nonce:a,prompt:s,url_state:l})).url}));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=(0,i.A)((function*(e,t){var n=new URL(window.location.origin);n.searchParams.append("code",e),n.searchParams.append("state",t),u.setLogger(j.v);try{var r=new P(n.searchParams),i=new T({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield i.get(r.state);if(!o)throw new Error(W.MissingOrInvalidStoredState);var a=yield N.fromStorageString(o),s=new V(ae(ae({},a),{},{stateStore:i})),l=yield s.processSigninResponse(n.href),c=l.userState;ee(c),ne(l),Z(l.id_token,s.settings.authority,s.settings.client_id,c.nonce);var d=(e=>({id_token:e.id_token,scope:e.scope,expires_at:e.expires_at,refresh_token:e.refresh_token,access_token:e.access_token,token_type:"Bearer"}))(l);return{oidcClientSettings:{clientId:s.settings.client_id,issuer:s.settings.authority},tokenResponse:d,homeserverUrl:c.homeserverUrl,identityServerUrl:c.identityServerUrl,idTokenClaims:l.profile}}catch(e){j.v.error("Oidc login failed",e);var h=e.message;if(Object.values(W).includes(h))throw e;throw new Error(W.CodeExchangeFailed)}}));return function(t,n){return e.apply(this,arguments)}}(),pe=n(9521);function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=function(){var e=(0,i.A)((function*(e){var t=new URL(".well-known/openid-configuration",e),n=yield fetch(t,{method:pe.IT.Get,signal:(0,pe._)(5e3)}),r=yield n.json();return fe(r)}));return function(t){return e.apply(this,arguments)}}(),fe=function(){var e=(0,i.A)((function*(e){var t=X(e),n=new I({authority:t.issuer,metadata:t,redirect_uri:"",client_id:""}),r=new A(n);return me(me({},t),{},{signingKeys:yield r.getSigningKeys()})}));return function(t){return e.apply(this,arguments)}}(),ye="urn:ietf:params:oauth:grant-type:device_code",_e=function(){var e=(0,i.A)((function*(e,t){if(!e.registration_endpoint)throw new Error(W.DynamicRegistrationNotSupported);var n=["authorization_code","refresh_token"];if(n.some((t=>!e.grant_types_supported.includes(t))))throw new Error(W.DynamicRegistrationNotSupported);var r={client_name:t.clientName,client_uri:t.clientUri,response_types:["code"],grant_types:n,redirect_uris:t.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:t.applicationType,logo_uri:t.logoUri,contacts:t.contacts,policy_uri:t.policyUri,tos_uri:t.tosUri};try{var i=yield fetch(e.registration_endpoint,{method:pe.IT.Post,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)});if(i.status>=400)throw new Error(W.DynamicRegistrationFailed);var o=(yield i.json()).client_id;if(!o||"string"!=typeof o)throw new Error(W.DynamicRegistrationInvalid);return o}catch(e){throw Object.values(W).includes(e.message)?e:(j.v.error("Dynamic registration request failed",e),new Error(W.DynamicRegistrationFailed))}}));return function(t,n){return e.apply(this,arguments)}}();class Ee{constructor(e,t,n,i,o){this.idTokenClaims=o,(0,r.A)(this,"oidcClientReady",void 0),(0,r.A)(this,"oidcClient",void 0),(0,r.A)(this,"inflightRefreshRequest",void 0),this.oidcClientReady=this.initialiseOidcClient(e,t,i,n)}initialiseOidcClient(e,t,n,r){var o=this;return(0,i.A)((function*(){try{var i,a=yield ge(e),s=se(n);o.oidcClient=new V({metadata:a,signingKeys:null!==(i=a.signingKeys)&&void 0!==i?i:void 0,client_id:t,scope:s,redirect_uri:r,authority:a.issuer,stateStore:new T({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(e){throw j.v.error("Failed to initialise OIDC client.",e),new Error("Failed to initialise OIDC client.")}}))()}doRefreshAccessToken(e){var t=this;return(0,i.A)((function*(){t.inflightRefreshRequest||(t.inflightRefreshRequest=t.getNewTokens(e));try{return yield t.inflightRefreshRequest}finally{t.inflightRefreshRequest=void 0}}))()}persistTokens(e){return(0,i.A)((function*(){}))()}getNewTokens(e){var t=this;return(0,i.A)((function*(){if(!t.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var n={refresh_token:e,session_state:"test",data:void 0,profile:t.idTokenClaims},r=yield t.oidcClient.useRefreshToken({state:n,timeoutInSeconds:300}),i={accessToken:r.access_token,refreshToken:r.refresh_token};return yield t.persistTokens(i),i}))()}}},5942:(e,t,n)=>{"use strict";n.d(t,{US:()=>l,rl:()=>s});var r=n(7723),i="abcdefghijklmnopqrstuvwxyz",o="ABCDEFGHIJKLMNOPQRSTUVWXYZ",a="0123456789";function s(e){var t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),(0,r.A4)(t)}function l(e){return function(e,t){if(t.length<2||t.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(e<1||e>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%t.length,r=new Uint8Array(Math.floor(1.3*e)),i=r.length,o=[];o.length<e;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var a=r[i++];a<n&&o.push(t[a%t.length])}return o.join("")}(e,o+i+a)}},15:(e,t,n)=>{"use strict";n.d(t,{b:()=>l});var r=n(4980),i=n(3840),o=n(2986),a=n(3883),s=n(9521);class l{static RETRY_BACKOFF_RATELIMIT(e,t,n){return(0,s.fZ)(n,t,!1)}static QUEUE_MESSAGES(e){return e.getType()===o.Bx.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.RETRY_BACKOFF_RATELIMIT,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=t,(0,r.A)(this,"queues",{}),(0,r.A)(this,"activeQueues",[]),(0,r.A)(this,"procFn",null),(0,r.A)(this,"processQueue",(e=>{var t=this.peekNextEvent(e);t?(c(this.queues[e].length),Promise.resolve().then((()=>this.procFn(t.event))).then((n=>{this.removeNextEvent(e),c(t.event.getId()),t.defer.resolve(n),this.processQueue(e)}),(n=>{t.attempts+=1;var r=this.retryAlgorithm(t.event,t.attempts,n);c(t.attempts,t.event.getId()),-1===r?(i.v.info("Queue '%s' giving up on event %s",e,t.event.getId()),this.clearQueue(e,n)):setTimeout(this.processQueue,r,e)}))):this.disableQueue(e)}))}getQueueForEvent(e){var t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}removeEventFromQueue(e){var t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;var n=!1;return(0,a.Nz)(this.queues[t],(t=>t.event.getId()===e.getId()&&(n=!0,!0))),n}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);var n=(0,a.v6)();return this.queues[t].push({event:e,defer:n,attempts:0}),c(e.getId()),this.startProcessingQueues(),n.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter((e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0)).forEach((e=>{this.activeQueues.push(e),c(),this.processQueue(e)}))}disableQueue(e){var t=this.activeQueues.indexOf(e);t>=0&&this.activeQueues.splice(t,1),i.v.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,t){var n;for(i.v.info("clearing queue '%s'",e);n=this.removeNextEvent(e);)n.defer.reject(t);this.disableQueue(e)}peekNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t[0]}removeNextEvent(e){var t=this.queues[e];if(Array.isArray(t))return t.shift()}}function c(){}},6900:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SECRET_STORAGE_ALGORITHM_V1_AES:()=>c,ServerSideSecretStorageImpl:()=>d,calculateKeyCheck:()=>p,trimTrailingEquals:()=>u});var r=n(467),i=n(4792),o=n(5942),a=n(3840),s=n(1630),l=n(5542),c="m.secret_storage.v1.aes-hmac-sha2";class d{constructor(e,t){this.accountDataAdapter=e,this.callbacks=t}getDefaultKeyId(){var e=this;return(0,r.A)((function*(){var t,n=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return n&&null!==(t=n.key)&&void 0!==t?t:null}))()}setDefaultKeyId(e){return new Promise(((t,n)=>{var r=n=>{if("m.secret_storage.default_key"===n.getType()){var o=n.getContent();(null===e?0===Object.keys(o).length:o.key===e)&&(this.accountDataAdapter.removeListener(i.AU.AccountData,r),t())}};this.accountDataAdapter.on(i.AU.AccountData,r);var o=null===e?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",o).catch((e=>{this.accountDataAdapter.removeListener(i.AU.AccountData,r),n(e)}))}))}addKey(e,t,n){var i=this;return(0,r.A)((function*(){if(e!==c)throw new Error("Unknown key algorithm ".concat(e));var r={algorithm:e};t.name&&(r.name=t.name),t.passphrase&&(r.passphrase=t.passphrase);var{iv:a,mac:s}=yield p(t.key);if(r.iv=a,r.mac=s,!n)do{n=(0,o.US)(32)}while(yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(n)));return yield i.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(n),r),{keyId:n,keyInfo:r}}))()}getKey(e){var t=this;return(0,r.A)((function*(){if(e||(e=yield t.getDefaultKeyId()),!e)return null;var n=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return n?[e,n]:null}))()}hasKey(e){var t=this;return(0,r.A)((function*(){var n=yield t.getKey(e);return Boolean(n)}))()}checkKey(e,t){return(0,r.A)((function*(){if(t.algorithm===c){if(t.mac){var{mac:n}=yield p(e,t.iv);return u(t.mac)===u(n)}return!0}throw new Error("Unknown algorithm")}))()}store(e,t,n){var i=this;return(0,r.A)((function*(){var r={};if(!n){var o=yield i.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");n=[o]}if(0===n.length)throw new Error("Zero keys given to encrypt with!");for(var s of n){var l=yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(!l)throw new Error("Unknown key: "+s);if(l.algorithm===c){var d={[s]:l},[,u]=yield i.getSecretStorageKey(d,e);r[s]=yield u.encrypt(t)}else a.v.warn("unknown algorithm for secret storage key "+s+": "+l.algorithm)}yield i.accountDataAdapter.setAccountData(e,{encrypted:r})}))()}get(e){var t=this;return(0,r.A)((function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(n){if(!n.encrypted)throw new Error("Content is not encrypted!");var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i)),a=n.encrypted[i];(null==o?void 0:o.algorithm)===c&&a.iv&&a.ciphertext&&a.mac&&(r[i]=o)}if(0===Object.keys(r).length)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[s,l]=yield t.getSecretStorageKey(r,e),d=n.encrypted[s];return l.decrypt(d)}}))()}isStored(e){var t=this;return(0,r.A)((function*(){var n=yield t.accountDataAdapter.getAccountDataFromServer(e);if(null==n||!n.encrypted)return null;var r={};for(var i of Object.keys(n.encrypted)){var o=yield t.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(i));if(o){var a=n.encrypted[i];o.algorithm===c&&a.iv&&a.ciphertext&&a.mac&&(r[i]=o)}}return Object.keys(r).length?r:null}))()}getSecretStorageKey(e,t){var n=this;return(0,r.A)((function*(){if(!n.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var r=yield n.callbacks.getSecretStorageKey({keys:e},t);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[i,o]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===c)return[i,{encrypt:function(e){return(0,s.A)(e,o,t)},decrypt:function(e){return(0,l.A)(e,o,t)}}];throw new Error("Unknown key type: "+e[i].algorithm)}))()}}function u(e){for(var t=e.length;t>=1&&61==e.charCodeAt(t-1);)t--;return t<e.length?e.substring(0,t):e}var h="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function p(e,t){return(0,s.A)(h,e,"",t)}},7545:(e,t,n)=>{"use strict";n.d(t,{K:()=>l,L:()=>s});var r=n(467),i=n(4980),o=n(9521),a=n(3840),s=function(e){return e.Stable="stable",e.Unstable="unstable",e}({});class l{constructor(e){var t=this;this.http=e,(0,i.A)(this,"capabilities",void 0),(0,i.A)(this,"retryTimeout",void 0),(0,i.A)(this,"refreshTimeout",void 0),(0,i.A)(this,"fetchCapabilities",(0,r.A)((function*(){var e=yield t.http.authedRequest(o.IT.Get,"/capabilities");return t.capabilities=e.capabilities,t.capabilities}))),(0,i.A)(this,"poll",(0,r.A)((function*(){try{yield t.fetchCapabilities(),t.clearTimeouts(),t.refreshTimeout=setTimeout(t.poll,216e5),a.v.debug("Fetched new server capabilities")}catch(n){t.clearTimeouts();var e=Math.floor(3e4+5e3*Math.random());t.retryTimeout=setTimeout(t.poll,e),a.v.warn("Failed to refresh capabilities: retrying in ".concat(e,"ms"),n)}})))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}},8425:(e,t,n)=>{"use strict";n.d(t,{S:()=>r});var r=function(e){return e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM",e}({})},4787:(e,t,n)=>{"use strict";n.d(t,{m:()=>S});var r=n(4980),i=n(467),o=n(4659),a=n(3840),s=n(3883),l=n(8221),c=n(4792),d=n(6459),u=n(9521),h=n(6806),p=n(2986),v=n(6122),m=n(6729),g=n(6560);class f{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return h.HY.PreProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){var t=this;return(0,i.A)((function*(){e.device_lists&&(yield t.crypto.processDeviceLists(e.device_lists)),yield t.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),t.crypto.onSyncCompleted({})}))()}}class y{constructor(e,t){this.client=e,this.cryptoCallbacks=t,(0,r.A)(this,"nextBatch",null)}name(){return"to_device"}when(){return h.HY.PreProcess}onRequest(e){var t={since:null!==this.nextBatch?this.nextBatch:void 0};return e&&(t.limit=100,t.enabled=!0),t}onResponse(e){var t=this;return(0,i.A)((function*(){var n=[],r=e.events||[];r.length>0&&t.cryptoCallbacks&&(r=yield t.cryptoCallbacks.preprocessToDeviceMessages(r)),r.map(t.client.getEventMapper()).map((e=>{if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&n.push(t)}return e})).forEach((e=>{var r=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=r.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var i=r.transaction_id;n.includes(i)&&e.flagCancelled()}t.client.emit(c.AU.ToDeviceEvent,e)}else a.v.log("Ignoring undecryptable to-device event from "+e.getSender())})),t.nextBatch=e.next_batch}))()}}class _{constructor(e){this.client=e}name(){return"account_data"}when(){return h.HY.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){var t=this;return(0,i.A)((function*(){for(var n in e.global&&e.global.length>0&&t.processGlobalAccountData(e.global),e.rooms){var r=C(t.client,n,e.rooms[n]),i=t.client.getRoom(n);i?(i.addAccountData(r),r.forEach((e=>{t.client.emit(c.AU.Event,e)}))):a.v.warn("got account data for room but room doesn't exist on client:",n)}}))()}processGlobalAccountData(e){var t=C(this.client,void 0,e),n=t.reduce(((e,t)=>(e[t.getType()]=this.client.store.getAccountData(t.getType()),e)),{});this.client.store.storeAccountDataEvents(t),t.forEach((e=>{if(e.getType()===p.Bx.PushRules){var t=e.getContent();this.client.setPushRules(t)}var r=n[e.getType()];return this.client.emit(c.AU.AccountData,e,r),e}))}}class E{constructor(e){this.client=e}name(){return"typing"}when(){return h.HY.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){var t=this;return(0,i.A)((function*(){if(null!=e&&e.rooms)for(var n in e.rooms)w(t.client,n,[e.rooms[n]])}))()}}class b{constructor(e){this.client=e}name(){return"receipts"}when(){return h.HY.PostProcess}onRequest(e){if(e)return{enabled:!0}}onResponse(e){var t=this;return(0,i.A)((function*(){if(null!=e&&e.rooms)for(var n in e.rooms)w(t.client,n,[e.rooms[n]])}))()}}class S{constructor(e,t,n,i){this.slidingSync=e,this.client=t,(0,r.A)(this,"opts",void 0),(0,r.A)(this,"syncOpts",void 0),(0,r.A)(this,"syncState",null),(0,r.A)(this,"syncStateData",void 0),(0,r.A)(this,"lastPos",null),(0,r.A)(this,"failCount",0),(0,r.A)(this,"notifEvents",[]),this.opts=(0,d.Bn)(n),this.syncOpts=(0,d.Fe)(i),t.getNotifTimelineSet()&&t.reEmitter.reEmit(t.getNotifTimelineSet(),[o.u9.Timeline,o.u9.TimelineReset]),this.slidingSync.on(h.cQ.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(h.cQ.RoomData,this.onRoomData.bind(this));var a=[new y(this.client,this.syncOpts.cryptoCallbacks),new _(this.client),new E(this.client),new b(this.client)];this.syncOpts.cryptoCallbacks&&a.push(new f(this.syncOpts.cryptoCallbacks)),a.forEach((e=>{this.slidingSync.registerExtension(e)}))}onRoomData(e,t){var n=this;return(0,i.A)((function*(){var r=n.client.store.getRoom(e);if(!r){if(!t.initial)return void a.v.debug("initial flag not set but no stored room exists for room ",e,t);r=(0,d.M)(n.client,e,n.opts)}yield n.processRoomData(n.client,r,t)}))()}onLifecycle(e,t,n){switch(n&&a.v.debug("onLifecycle",e,n),e){case h.ns.Complete:if(this.purgeNotifications(),!t)break;this.lastPos||this.updateSyncState(d.Lm.Prepared,{oldSyncToken:void 0,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(d.Lm.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:t.pos,catchingUp:!1,fromCache:!1}),this.lastPos=t.pos;break;case h.ns.RequestFinished:if(n){if(this.failCount+=1,this.updateSyncState(this.failCount>3?d.Lm.Error:d.Lm.Reconnecting,{error:new u.up(n)}),this.shouldAbortSync(new u.up(n)))return}else this.failCount=0}}syncLeftRooms(){return(0,i.A)((function*(){return[]}))()}peek(e){return(0,i.A)((function*(){return null}))()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}createRoom(e){var{timelineSupport:t}=this.client,n=new o.Wv(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:t});return this.client.reEmitter.reEmit(n,[o.u9.Name,o.u9.Redaction,o.u9.RedactionCancelled,o.u9.Receipt,o.u9.Tags,o.u9.LocalEchoUpdated,o.u9.AccountData,o.u9.MyMembership,o.u9.Timeline,o.u9.TimelineReset]),this.registerStateListeners(n),n}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[v.f.Events,v.f.Members,v.f.NewMember,v.f.Update]),e.currentState.on(v.f.NewMember,((e,t,n)=>{var r;n.user=null!==(r=this.client.getUser(n.userId))&&void 0!==r?r:void 0,this.client.reEmitter.reEmit(n,[m.o.Name,m.o.Typing,m.o.PowerLevel,m.o.Membership])}))}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(a.v.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(d.Lm.Error,{error:e}),!0)}processRoomData(e,t,n){var r=this;return(0,i.A)((function*(){n=function(e,t,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===p.Bx.RoomName&&""===r.state_key)return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+t,state_key:"",type:p.Bx.RoomName,content:{name:n.name},sender:e.getUserId(),origin_server_ts:(new Date).getTime()}),n}(e,t.roomId,n);var a=C(r.client,t.roomId,n.required_state),d=C(r.client,t.roomId,n.timeline,!1),u=[];if(n.initial){var h=new Set;t.getLiveTimeline().getEvents().forEach((e=>{h.add(e.getId())}));for(var v=[],m=[],f=!1,y=d.length-1;y>=0;y--){var _=d[y];h.has(_.getId())?f=!0:f?v.push(_):m.unshift(_)}d=m,v.length>0&&t.addEventsToTimeline(v,!0,!1,t.getLiveTimeline(),n.prev_batch)}var E,b=t.hasEncryptionStateEvent();if(null!=n.notification_count&&t.setUnreadNotificationCount(o.X5.Total,n.notification_count),null!=n.highlight_count&&(!b||b&&t.getUnreadNotificationCount(o.X5.Highlight)<=0)&&t.setUnreadNotificationCount(o.X5.Highlight,n.highlight_count),Number.isInteger(n.invited_count)&&t.currentState.setInvitedMemberCount(n.invited_count),Number.isInteger(n.joined_count)&&t.currentState.setJoinedMemberCount(n.joined_count),n.invite_state){var S=C(r.client,t.roomId,n.invite_state);return yield r.injectRoomEvents(t,S),n.initial&&(t.recalculate(),r.client.store.storeRoom(t),r.client.emit(c.AU.Room,t)),S.forEach((e=>{r.client.emit(c.AU.Event,e)})),void t.updateMyMembership(g.O.Invite)}n.initial&&t.getLiveTimeline().setPaginationToken(null!==(E=n.prev_batch)&&void 0!==E?E:null,l.q.BACKWARDS),yield r.injectRoomEvents(t,a,d,n.num_live),t.addEphemeralEvents(u),t.updateMyMembership(g.O.Join),t.recalculate(),n.initial&&(e.store.storeRoom(t),e.emit(c.AU.Room,t)),r.addNotifications(d);var w=function(){var n=(0,i.A)((function*(n){e.emit(c.AU.Event,n),n.isState()&&n.getType()==p.Bx.RoomEncryption&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(t,n))}));return function(e){return n.apply(this,arguments)}}();yield(0,s.d8)(a,w),yield(0,s.d8)(d,w),u.forEach((function(t){e.emit(c.AU.Event,t)})),t.decryptCriticalEvents()}))()}injectRoomEvents(e,t){var n=arguments,r=this;return(0,i.A)((function*(){var i=n.length>2&&void 0!==n[2]?n[2]:[],o=n.length>3&&void 0!==n[3]?n[3]:0,a=e.getLiveTimeline(),s=0==a.getEvents().length;if(s){for(var l of t)r.client.getPushActionsForEvent(l);a.initialiseState(t)}s||(e.oldState.setStateEvents(t),e.currentState.setStateEvents(t));var c=[];o>0&&(c=i.slice(-1*o),i=i.slice(0,-1*c.length)),yield e.addLiveEvents(i,{fromCache:!0,addToState:!1}),c.length>0&&(yield e.addLiveEvents(c,{fromCache:!1,addToState:!1})),e.recalculate(),r.resolveInvites(e)}))()}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(g.O.Invite).forEach((function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;r.getContent().membership===g.O.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}}retryImmediately(){return!0}sync(){var e=this;return(0,i.A)((function*(){for(a.v.debug("Sliding sync init loop");!e.client.isGuest();)try{a.v.debug("Getting push rules...");var t=yield e.client.getPushRules();a.v.debug("Got push rules"),e.client.pushRules=t;break}catch(t){if(a.v.error("Getting push rules failed",t),e.shouldAbortSync(t))return}yield e.slidingSync.start()}))()}stop(){a.v.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(c.AU.Sync,this.syncState,n,t)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var t of e){var n=this.client.getPushActionsForEvent(t);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this.notifEvents.push(t)}}purgeNotifications(){this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((e=>{var t;null===(t=this.client.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!1})})),this.notifEvents=[]}}function C(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=e.getEventMapper({decrypt:r});return n.map((function(e){return e.room_id=t,i(e)}))}function w(e,t,n){var r=C(e,t,n),i=e.getRoom(t);i?(i.addEphemeralEvents(r),r.forEach((t=>{e.emit(c.AU.Event,t)}))):a.v.warn("got ephemeral events for room but room doesn't exist on client:",t)}},6806:(e,t,n)=>{"use strict";n.d(t,{HY:()=>o,cQ:()=>a,ns:()=>i}),n(467),n(4980),n(3840);var r=n(6387);n(3883);var i=function(e){return e.RequestFinished="FINISHED",e.Complete="COMPLETE",e}({}),o=function(e){return e.PreProcess="ExtState.PreProcess",e.PostProcess="ExtState.PostProcess",e}({}),a=function(e){return e.RoomData="SlidingSync.RoomData",e.Lifecycle="SlidingSync.Lifecycle",e.List="SlidingSync.List",e}({});r.X},6459:(e,t,n)=>{"use strict";n.d(t,{Bn:()=>I,Fe:()=>k,IU:()=>T,Lm:()=>S,M:()=>R,w_:()=>O});var r=n(467),i=n(4980),o=n(8230),a=n(4659),s=n(3883),l=n(310),c=n(8221),d=n(3840),u=n(4792),h=n(9521),p=n(2986),v=n(6122),m=n(6729),g=n(3337),f=n(5155),y=n(8140),_=n(6560);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(e){return e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING",e}({}),C=["org.matrix.msc2716v3"];function w(e,t){return"FILTER_SYNC_".concat(e)+(t?"_"+t:"")}function A(){d.v.log(...arguments)}var T=function(e){return e.Offline="offline",e.Online="online",e.Unavailable="unavailable",e}({});function I(e){return b({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:3e4,pendingEventOrdering:u.eO.Chronological,threadSupport:!1},e)}function k(e){return b({canResetEntireTimeline:e=>!1},e)}class O{constructor(e,t,n){var o=this;this.client=e,(0,i.A)(this,"opts",void 0),(0,i.A)(this,"syncOpts",void 0),(0,i.A)(this,"_peekRoom",null),(0,i.A)(this,"currentSyncRequest",void 0),(0,i.A)(this,"abortController",void 0),(0,i.A)(this,"syncState",null),(0,i.A)(this,"syncStateData",void 0),(0,i.A)(this,"catchingUp",!1),(0,i.A)(this,"running",!1),(0,i.A)(this,"keepAliveTimer",void 0),(0,i.A)(this,"connectionReturnedDefer",void 0),(0,i.A)(this,"notifEvents",[]),(0,i.A)(this,"failedSyncCount",0),(0,i.A)(this,"storeIsInvalid",!1),(0,i.A)(this,"presence",void 0),(0,i.A)(this,"getPushRules",(0,r.A)((function*(){try{A("Getting push rules...");var e=yield o.client.getPushRules();A("Got push rules"),o.client.pushRules=e}catch(e){if(d.v.error("Getting push rules failed",e),o.shouldAbortSync(e))return;return A("Waiting for saved sync before retrying push rules..."),yield o.recoverFromSyncStartupError(o.savedSyncPromise,e),o.getPushRules()}}))),(0,i.A)(this,"buildDefaultFilter",(()=>{var e=new l.d(this.client.credentials.userId);return this.client.canSupport.get(y.Xj.ThreadUnreadNotifications)!==y.Tj.Unsupported&&e.setUnreadThreadNotifications(!0),e})),(0,i.A)(this,"prepareLazyLoadingForSync",(0,r.A)((function*(){var e;A("Prepare lazy loading for sync..."),o.client.isGuest()&&(o.opts.lazyLoadMembers=!1),o.opts.lazyLoadMembers&&(A("Enabling lazy load on sync filter..."),o.opts.filter||(o.opts.filter=o.buildDefaultFilter()),o.opts.filter.setLazyLoadMembers(!0)),o.opts.lazyLoadMembers&&(null===(e=o.syncOpts.crypto)||void 0===e||e.enableLazyLoading())}))),(0,i.A)(this,"storeClientOptions",(0,r.A)((function*(){try{A("Storing client options..."),yield o.client.storeClientOptions(),A("Stored client options")}catch(e){throw d.v.error("Storing client options failed",e),e}}))),(0,i.A)(this,"getFilter",(0,r.A)((function*(){var e,t;A("Getting filter..."),e=o.opts.filter?o.opts.filter:o.buildDefaultFilter();try{t=yield o.client.getOrCreateFilter(w(o.client.credentials.userId),e)}catch(e){return d.v.error("Getting filter failed",e),o.shouldAbortSync(e)?{}:(A("Waiting for saved sync before retrying filter..."),yield o.recoverFromSyncStartupError(o.savedSyncPromise,e),o.getFilter())}return{filter:e,filterId:t}}))),(0,i.A)(this,"savedSyncPromise",void 0),(0,i.A)(this,"onOnline",(()=>{A("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts=I(t),this.syncOpts=k(n),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[a.u9.Timeline,a.u9.TimelineReset])}createRoom(e){var t=R(this.client,e,this.opts);return t.on(v.f.Marker,((e,n)=>{this.onMarkerStateEvent(t,e,n)})),t}onMarkerStateEvent(e,t){var{timelineWasEmpty:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n?d.v.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh."):C.includes(e.getVersion())||t.getSender()===e.getCreator()?(d.v.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(t.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(a.u9.HistoryImportedWithinTimeline,t,e)):d.v.debug("MarkerState: Ignoring markerEventId=".concat(t.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return(0,r.A)((function*(){var t,n=e.client,i=new l.d(e.client.credentials.userId);i.setTimelineLimit(1),i.setIncludeLeaveRooms(!0);var o=e.opts.pollTimeout+8e4,a={timeout:0,filter:yield n.getOrCreateFilter(w(n.credentials.userId,"LEFT_ROOMS"),i),"org.matrix.msc4222.use_state_after":!0},s=yield n.http.authedRequest(h.IT.Get,"/sync",a,void 0,{localTimeoutMs:o}),d=[];null!==(t=s.rooms)&&void 0!==t&&t.leave&&(d=e.mapSyncResponseToRoomArray(s.rooms.leave));var p=yield Promise.all(d.map(function(){var t=(0,r.A)((function*(t){var r=t.room;if(t.isBrandNewRoom){t.timeline=t.timeline||{prev_batch:null,events:[]},r.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,c.q.BACKWARDS);var{timelineEvents:i}=yield e.mapAndInjectRoomEvents(t);return r.recalculate(),n.store.storeRoom(r),n.emit(u.AU.Room,r),e.processEventsForNotifs(r,i),r}}));return function(e){return t.apply(this,arguments)}}()));return p.filter(Boolean)}))()}peek(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if((null===(t=this._peekRoom)||void 0===t?void 0:t.roomId)===e)return Promise.resolve(this._peekRoom);var r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,n).then((t=>{var n;if((null===(n=this._peekRoom)||void 0===n?void 0:n.roomId)!==e)throw new Error("Peeking aborted");t.messages=t.messages||{chunk:[]},t.messages.chunk=t.messages.chunk||[],t.state=t.state||[];var i=(0,s.A4)(t.state).map(r.getEventMapper()),a=t.state.map(r.getEventMapper()),l=t.messages.chunk.map(r.getEventMapper());return Array.isArray(t.presence)&&t.presence.map(r.getEventMapper()).forEach((function(e){var t=r.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=o.K.createUser(e.getContent().user_id,r)).setPresenceEvent(e),r.store.storeUser(t)),r.emit(u.AU.Event,e)})),t.messages.start&&(this._peekRoom.oldState.paginationToken=t.messages.start),this._peekRoom.oldState.setStateEvents(i),this._peekRoom.currentState.setStateEvents(a),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(l.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),t.messages.start),r.store.storeRoom(this._peekRoom),r.emit(u.AU.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){var n,i=this;this._peekRoom===e?this.client.http.authedRequest(h.IT.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,{localTimeoutMs:5e4,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal}).then(function(){var t=(0,r.A)((function*(t){if(i._peekRoom===e){t.chunk.filter((function(e){return"m.presence"===e.type})).map(i.client.getEventMapper()).forEach((e=>{var t=i.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):((t=o.K.createUser(e.getContent().user_id,i.client)).setPresenceEvent(e),i.client.store.storeUser(t)),i.client.emit(u.AU.Event,e)}));var n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(i.client.getEventMapper());yield e.addLiveEvents(n,{addToState:!0}),i.peekPoll(e,t.end)}else A("Stopped peeking in room %s",e.roomId)}));return function(e){return t.apply(this,arguments)}}(),(n=>{d.v.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):A("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){var e;return null!==(e=this.syncStateData)&&void 0!==e?e:null}recoverFromSyncStartupError(e,t){var n=this;return(0,r.A)((function*(){yield e;var r=n.startKeepAlives();n.updateSyncState(S.Error,{error:t}),yield r}))()}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(d.v.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(S.Error,{error:e}),!0)}sync(){var e=this;return(0,r.A)((function*(){var t,n;if(e.running=!0,e.abortController=new AbortController,null===(t=globalThis.window)||void 0===t||null===(n=t.addEventListener)||void 0===n||n.call(t,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});A("Getting saved sync token...");var r=e.client.store.getSavedSyncToken().then((e=>(A("Got saved sync token"),e)));e.savedSyncPromise=e.client.store.getSavedSync().then((t=>{if(A("Got reply from saved sync, exists? ".concat(!!t)),t)return e.syncFromCache(t)})).catch((e=>{d.v.error("Getting saved sync failed",e)})),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:i,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var a=i,s=yield r;if(s)A("Sending first sync request...");else{A("Sending initial sync request...");var l=e.buildDefaultFilter();l.setDefinition(o.getDefinition()),l.setTimelineLimit(e.opts.initialSyncLimit),a=JSON.stringify(l.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:a},s)}return A("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:i})}}))()}stop(){var e,t,n;A("SyncApi.stop"),null===(e=globalThis.window)||void 0===e||null===(t=e.removeEventListener)||void 0===t||t.call(e,"online",this.onOnline,!1),this.running=!1,null===(n=this.abortController)||void 0===n||n.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}syncFromCache(e){var t=this;return(0,r.A)((function*(){A("sync(): not doing HTTP hit, instead returning stored /sync data");var n=e.nextBatch;t.client.store.setSyncToken(n);var r={nextSyncToken:n,catchingUp:!1,fromCache:!0},i={next_batch:n,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield t.processSyncResponse(r,i)}catch(e){d.v.error("Error processing cached sync",e)}t.storeIsInvalid||t.updateSyncState(S.Prepared,r)}))()}doSync(e){var t=this;return(0,r.A)((function*(){for(;t.running;){var n=t.client.store.getSyncToken(),r=void 0;try{t.currentSyncRequest||(t.currentSyncRequest=t.doSyncRequest(e,n)),r=yield t.currentSyncRequest}catch(e){if(yield t.onSyncError(e))return;continue}finally{t.currentSyncRequest=void 0}t.client.store.setSyncToken(r.next_batch),t.failedSyncCount=0;var i={oldSyncToken:null!=n?n:void 0,nextSyncToken:r.next_batch,catchingUp:t.catchingUp};t.syncOpts.crypto&&(yield t.syncOpts.crypto.onSyncWillProcess(i));try{yield t.processSyncResponse(i,r)}catch(e){d.v.error("Caught /sync error",e),t.client.emit(u.AU.SyncUnexpectedError,e)}yield t.client.store.setSyncData(r),i.catchingUp=t.catchingUp,e.hasSyncedBefore||(t.updateSyncState(S.Prepared,i),e.hasSyncedBefore=!0),t.syncOpts.cryptoCallbacks&&(yield t.syncOpts.cryptoCallbacks.onSyncCompleted(i)),t.updateSyncState(S.Syncing,i),t.client.store.wantsSave()&&(t.syncOpts.crypto&&(yield t.syncOpts.crypto.saveDeviceList(0)),yield t.client.store.save())}t.running||(A("Sync no longer running: exiting."),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(S.Stopped))}))()}doSyncRequest(e,t){var n,r=this.getSyncParams(e,t);return this.client.http.authedRequest(h.IT.Get,"/sync",r,void 0,{localTimeoutMs:r.timeout+8e4,abortSignal:null===(n=this.abortController)||void 0===n?void 0:n.signal})}getSyncParams(e,t){var n=this.opts.pollTimeout;(this.getSyncState()!==S.Syncing||this.catchingUp)&&(this.catchingUp=!0,n=0);var r=e.filter;this.client.isGuest()&&!r&&(r=this.getGuestFilter());var i={filter:r,timeout:n,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?i.set_presence=T.Offline:void 0!==this.presence&&(i.set_presence=this.presence),t?i.since=t:i._cacheBuster=Date.now(),[S.Reconnecting,S.Error].includes(this.getSyncState())&&(i.timeout=0),i}setPresence(e){this.presence=e}onSyncError(e){var t=this;return(0,r.A)((function*(){if(!t.running)return A("Sync no longer running: exiting"),t.connectionReturnedDefer&&(t.connectionReturnedDefer.reject(),t.connectionReturnedDefer=void 0),t.updateSyncState(S.Stopped),!0;if(d.v.error("/sync error %s",e),t.shouldAbortSync(e))return!0;t.failedSyncCount++,d.v.log("Number of consecutive failed sync requests:",t.failedSyncCount),A("Starting keep-alive");var n=t.startKeepAlives();return t.currentSyncRequest=void 0,t.updateSyncState(t.failedSyncCount>=3?S.Error:S.Reconnecting,{error:e}),(yield n)&&t.getSyncState()===S.Error&&t.updateSyncState(S.Catchup,{catchingUp:!0}),!1}))()}processSyncResponse(e,t){var n=this;return(0,r.A)((function*(){var i,l,h,v,m=n.client;if(Array.isArray(null===(i=t.presence)||void 0===i?void 0:i.events)&&t.presence.events.filter(s.O5).map(m.getEventMapper()).forEach((function(e){var t=m.store.getUser(e.getSender());t?t.setPresenceEvent(e):((t=o.K.createUser(e.getSender(),m)).setPresenceEvent(e),m.store.storeUser(t)),m.emit(u.AU.Event,e)})),Array.isArray(null===(l=t.account_data)||void 0===l?void 0:l.events)){var g=t.account_data.events.filter(s.O5).map(m.getEventMapper()),y=g.reduce(((e,t)=>(e[t.getType()]=m.store.getAccountData(t.getType()),e)),{});m.store.storeAccountDataEvents(g),g.forEach((function(e){if(e.getType()===p.Bx.PushRules){var t=e.getContent();m.setPushRules(t)}var n=y[e.getType()];return m.emit(u.AU.AccountData,e,n),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){var _=t.to_device.events.filter(s.O5);n.syncOpts.cryptoCallbacks&&(_=yield n.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(_));var E=[];_.map(m.getEventMapper({toDevice:!0})).map((e=>{if("m.key.verification.cancel"===e.getType()){var t=e.getContent().transaction_id;t&&E.push(t)}return e})).forEach((function(e){var t=e.getContent();if("m.room.message"!=e.getType()||"m.bad.encrypted"!=t.msgtype){if("m.key.verification.start"===e.getType()||"m.key.verification.request"===e.getType()){var n=t.transaction_id;E.includes(n)&&e.flagCancelled()}m.emit(u.AU.ToDeviceEvent,e)}else d.v.log("Ignoring undecryptable to-device event from "+e.getSender())}))}else n.catchingUp=!1;var b=[],S=[],C=[],w=[];t.rooms&&(t.rooms.invite&&(b=n.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(S=n.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(C=n.mapSyncResponseToRoomArray(t.rooms.leave)),t.rooms.knock&&(w=n.mapSyncResponseToRoomArray(t.rooms.knock))),n.notifEvents=[],yield(0,s.d8)(b,function(){var e=(0,r.A)((function*(e){var t,r=e.room,i=n.mapSyncEventsFormat(e.invite_state,r);yield n.injectRoomEvents(r,i,void 0);var o=null===(t=r.currentState.getStateEvents(p.Bx.RoomMember,m.getUserId()))||void 0===t?void 0:t.getSender(),a=m.crypto;if(a){var s=yield a.cryptoStore.takeParkedSharedHistory(r.roomId);for(var l of s)l.senderId===o&&(yield a.olmDevice.addInboundGroupSession(r.roomId,l.senderKey,l.forwardingCurve25519KeyChain,l.sessionId,l.sessionKey,l.keysClaimed,!0,{sharedHistory:!0,untrusted:!0}))}e.isBrandNewRoom?(r.recalculate(),m.store.storeRoom(r),m.emit(u.AU.Room,r)):r.recalculate(),i.forEach((function(e){m.emit(u.AU.Event,e)}))}));return function(t){return e.apply(this,arguments)}}()),yield(0,s.d8)(S,function(){var t=(0,r.A)((function*(t){var r,i,o,s=t.room,l=n.mapSyncEventsFormat(t.state,s),h=n.mapSyncEventsFormat(t["org.matrix.msc4222.state_after"],s),v=n.mapSyncEventsFormat(t.timeline,s,!1),g=n.mapSyncEventsFormat(t.ephemeral),y=n.mapSyncEventsFormat(t.account_data),_=t["org.matrix.msc4222.state_after"]?h:l.concat(v),E=n.isRoomEncrypted(s,_);t.unread_notifications&&(E&&0!==t.unread_notifications.notification_count||s.setUnreadNotificationCount(a.X5.Total,null!==(i=t.unread_notifications.notification_count)&&void 0!==i?i:0),(!E||s.getUnreadNotificationCount(a.X5.Highlight)<=0)&&s.setUnreadNotificationCount(a.X5.Highlight,null!==(o=t.unread_notifications.highlight_count)&&void 0!==o?o:0));var b=null!==(r=t[f.a.name])&&void 0!==r?r:t[f.a.altName];if(b)for(var[S,C]of(s.resetThreadUnreadNotificationCountFromSync(Object.keys(b)),Object.entries(b))){var w;E&&0!==C.notification_count||s.setThreadUnreadNotificationCount(S,a.X5.Total,null!==(w=C.notification_count)&&void 0!==w?w:0);var T,I=s.getThreadUnreadNotificationCount(S,a.X5.Highlight)<=0;(!E||E&&I)&&s.setThreadUnreadNotificationCount(S,a.X5.Highlight,null!==(T=C.highlight_count)&&void 0!==T?T:0)}else s.resetThreadUnreadNotificationCountFromSync();if(t.timeline=t.timeline||{},t.isBrandNewRoom)null!==t.timeline.prev_batch&&s.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,c.q.BACKWARDS);else if(t.timeline.limited){for(var k,O=!0,R=v.length-1;R>=0;R--){var x=v[R].getId();if(s.getTimelineForEvent(x)){A("Already have event ".concat(x," in limited sync - not resetting")),O=!1,v.splice(0,R);break}}O&&(s.resetLiveTimeline(t.timeline.prev_batch,n.syncOpts.canResetEntireTimeline(s.roomId)?null:null!==(k=e.oldSyncToken)&&void 0!==k?k:null),m.resetNotifTimelineSet())}if(n.syncOpts.cryptoCallbacks)for(var N of _)N.isState()&&N.getType()===p.Bx.RoomEncryption&&""===N.getStateKey()&&(yield n.syncOpts.cryptoCallbacks.onCryptoEvent(s,N));try{"org.matrix.msc4222.state_after"in t?yield n.injectRoomEvents(s,void 0,h,v,e.fromCache):yield n.injectRoomEvents(s,l,void 0,v,e.fromCache)}catch(N){d.v.error("Failed to process events on room ".concat(s.roomId,":"),N)}t.summary&&s.setSummary(t.summary),s.addEphemeralEvents(g),s.addAccountData(y),s.recalculate(),t.isBrandNewRoom&&(m.store.storeRoom(s),m.emit(u.AU.Room,s)),n.processEventsForNotifs(s,v);var D=e=>m.emit(u.AU.Event,e);l.forEach(D),v.forEach(D),g.forEach(D),y.forEach(D),s.decryptCriticalEvents()}));return function(e){return t.apply(this,arguments)}}()),yield(0,s.d8)(C,function(){var e=(0,r.A)((function*(e){var t=e.room,{timelineEvents:r,stateEvents:i,stateAfterEvents:o}=yield n.mapAndInjectRoomEvents(e),a=n.mapSyncEventsFormat(e.account_data);t.addAccountData(a),t.recalculate(),e.isBrandNewRoom&&(m.store.storeRoom(t),m.emit(u.AU.Room,t)),n.processEventsForNotifs(t,r),null==i||i.forEach((function(e){m.emit(u.AU.Event,e)})),null==o||o.forEach((function(e){m.emit(u.AU.Event,e)})),r.forEach((function(e){m.emit(u.AU.Event,e)})),a.forEach((function(e){m.emit(u.AU.Event,e)}))}));return function(t){return e.apply(this,arguments)}}()),yield(0,s.d8)(w,function(){var e=(0,r.A)((function*(e){var t=e.room,r=n.mapSyncEventsFormat(e.knock_state,t);yield n.injectRoomEvents(t,r,void 0),e.isBrandNewRoom?(t.recalculate(),m.store.storeRoom(t),m.emit(u.AU.Room,t)):t.recalculate(),r.forEach((function(e){m.emit(u.AU.Event,e)}))}));return function(t){return e.apply(this,arguments)}}()),e.oldSyncToken&&n.notifEvents.length&&(n.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),n.notifEvents.forEach((function(e){var t;null===(t=m.getNotifTimelineSet())||void 0===t||t.addLiveEvent(e,{addToState:!0})}))),t.device_lists&&n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.processDeviceLists(t.device_lists)),yield null===(h=n.syncOpts.cryptoCallbacks)||void 0===h?void 0:h.processKeyCounts(t.device_one_time_keys_count,null!==(v=t.device_unused_fallback_key_types)&&void 0!==v?v:t["org.matrix.msc2732.device_unused_fallback_key_types"])}))()}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=(0,s.v6)()),this.connectionReturnedDefer.promise}pokeKeepAlive(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.running)return clearTimeout(this.keepAliveTimer),void(this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject("SyncApi.stop() was called"),this.connectionReturnedDefer=void 0));var n=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(t),this.connectionReturnedDefer=void 0)};this.client.http.request(h.IT.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3,abortSignal:null===(e=this.abortController)||void 0===e?void 0:e.signal}).then((()=>{n()}),(e=>{400==e.httpStatus||404==e.httpStatus?this.keepAliveTimer=setTimeout(n,2e3):(t=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,t),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(S.Error,{error:e}))}))}mapSyncResponseToRoomArray(e){var t=this.client;return Object.keys(e).filter((e=>!(0,s.YY)(e))).map((n=>{var r=t.store.getRoom(n),i=!1;return r||(r=this.createRoom(n),i=!0),b(b({},e[n]),{},{room:r,isBrandNewRoom:i})}))}mapSyncEventsFormat(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!Array.isArray(e.events))return[];var r=this.client.getEventMapper({decrypt:n});return e.events.filter(s.O5).map((function(e){return t&&(e.room_id=t.roomId),r(e)}))}resolveInvites(e){if(e&&this.opts.resolveInvitesToProfiles){var t=this.client;e.getMembersWithMembership(_.O.Invite).forEach((function(n){if(!n.requestedProfileInfo){n.requestedProfileInfo=!0;var r=t.getUser(n.userId);(r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId)).then((function(t){var r=n.events.member;(null==r?void 0:r.getContent().membership)===_.O.Invite&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}}))}}findEncryptionEvent(e){return null==e?void 0:e.find((e=>e.getType()===p.Bx.RoomEncryption&&""===e.getStateKey()))}isRoomEncrypted(e,t){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(t)}mapAndInjectRoomEvents(e){var t=this;return(0,r.A)((function*(){var n=t.mapSyncEventsFormat(e.state,e.room),r=t.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),i=t.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield t.injectRoomEvents(e.room,void 0,r,i):yield t.injectRoomEvents(e.room,n,void 0,i),{timelineEvents:i,stateEvents:n,stateAfterEvents:r}}))()}injectRoomEvents(e,t,n,i){var o=arguments,a=this;return(0,r.A)((function*(){var r=o.length>4&&void 0!==o[4]&&o[4],s=null!=n?n:t,l=e.getLiveTimeline(),c=0==l.getEvents().length;if(c){for(var d of s)a.client.getPushActionsForEvent(d);l.initialiseState(s,{timelineWasEmpty:c})}a.resolveInvites(e),e.recalculate(),c||(e.oldState.setStateEvents(s),e.currentState.setStateEvents(s)),yield e.addLiveEvents(i||[],{fromCache:r,timelineWasEmpty:c,addToState:void 0===n}),a.client.processBeaconEvents(e,i)}))()}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(var n of t){var r,i=this.client.getPushActionsForEvent(n);null!=i&&i.notify&&null!==(r=i.tweaks)&&void 0!==r&&r.highlight&&this.notifEvents.push(n)}}getGuestFilter(){return"{}"}updateSyncState(e,t){var n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit(u.AU.Sync,this.syncState,n,t)}}function R(e,t,n){var{timelineSupport:r}=e,i=new a.Wv(t,e,e.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return e.reEmitter.reEmit(i,[a.u9.Name,a.u9.Redaction,a.u9.RedactionCancelled,a.u9.Receipt,a.u9.Tags,a.u9.LocalEchoUpdated,a.u9.AccountData,a.u9.MyMembership,a.u9.Timeline,a.u9.TimelineReset,v.f.Events,v.f.Members,v.f.NewMember,v.f.Update,g.JH.New,g.JH.Update,g.JH.Destroy,g.JH.LivenessChange]),i.on(v.f.NewMember,((t,n,r)=>{var i;r.user=null!==(i=e.getUser(r.userId))&&void 0!==i?i:void 0,e.reEmitter.reEmit(r,[m.o.Name,m.o.Typing,m.o.PowerLevel,m.o.Membership])})),i}},9255:(e,t,n)=>{"use strict";n.d(t,{V:()=>r}),n(6560);var r=function(e){return e.Sas="m.sas.v1",e.ShowQrCode="m.qr_code.show.v1",e.ScanQrCode="m.qr_code.scan.v1",e.Reciprocate="m.reciprocate.v1",e}({})},3883:(e,t,n)=>{"use strict";n.d(t,{$9:()=>q,A4:()=>y,Ab:()=>v,Bi:()=>z,C6:()=>re,CC:()=>G,Et:()=>b,Fq:()=>X,Gp:()=>S,HF:()=>te,Mf:()=>$,NQ:()=>R,Nt:()=>T,Nz:()=>g,O5:()=>ie,RR:()=>m,S8:()=>w,UB:()=>f,YY:()=>ne,aw:()=>Y,d7:()=>C,d8:()=>P,dn:()=>I,hX:()=>D,hc:()=>k,hl:()=>E,hm:()=>p,iH:()=>N,iK:()=>F,j0:()=>U,kG:()=>oe,kg:()=>Z,ky:()=>_,ll:()=>Q,sy:()=>W,v6:()=>L,yD:()=>h,yy:()=>O,zR:()=>H});var r=n(467),i=n(4980),o=n(5395),a=n(4116),s=n(4867),l=n(6022);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=new Map;function h(e){return e instanceof String&&(e=e.toString()),u.has(e)||u.set(e,e),u.get(e)}function p(e,t){var n=null!=t?t:new URLSearchParams,r=function(e){null!=o&&(Array.isArray(o)?o.forEach((t=>{n.append(e,String(t))})):n.append(e,String(o)))};for(var[i,o]of Object.entries(e))r(i);return n}function v(e,t,n){var r=d(d({},n),{},{[t]:n[e]});return delete r[e],r}function m(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];null!=r&&(e=e.replace(n,encodeURIComponent(r)))}return e}function g(e,t,n){var r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e.splice(r,1),!0}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e.splice(r,1),!0;return!1}function f(e,t){for(var n of t)if(!e.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function y(e){return JSON.parse(JSON.stringify(e))}function _(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(t))return!0;if(null===e||null===t)return e===t;if(!(e instanceof Object))return!1;if(e.constructor!==t.constructor||e.prototype!==t.prototype)return!1;if(e instanceof RegExp||e instanceof Date)return e.toString()===t.toString();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!_(e[n],t[n]))return!1}else{for(var r in t)if(t.hasOwnProperty(r)!==e.hasOwnProperty(r))return!1;for(var i in e)if(t.hasOwnProperty(i)!==e.hasOwnProperty(i)||!_(e[i],t[i]))return!1}return!0}function E(e){if("object"!=typeof e)return e;if(null==e||Array.isArray(e))return e;var t=[];for(var[n,r]of Object.entries(e))t.push([n,E(r)]);return t.sort(((e,t)=>Y(e[0],t[0]))),t}function b(e){return"number"==typeof e&&isFinite(e)}function S(e){return"string"==typeof e?o(e.normalize("NFD").replace(A,"")):""}function C(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""}function w(e){return S(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var A=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function T(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(e){return T(e).replace(/\\\*/g,".*").replace(/\?/g,".")}function k(e){return null!=e&&e.endsWith("/")?e.slice(0,-1):e}function O(e,t){return new Promise((n=>{setTimeout(n,e,t)}))}function R(e,t,n){return x.apply(this,arguments)}function x(){return(x=(0,r.A)((function*(e,t,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();e.debug("[Perf]: ".concat(t," took ").concat(i-r,"ms"))}}))).apply(this,arguments)}function N(){return new Promise((e=>setTimeout(e)))}function D(e){return null==e}function L(){var e,t,n=new Promise(((n,r)=>{e=n,t=r}));return{resolve:e,reject:t,promise:n}}function P(e,t){return M.apply(this,arguments)}function M(){return(M=(0,r.A)((function*(e,t){for(var n of e)yield t(yield n)}))).apply(this,arguments)}function U(e){return Promise.resolve(e())}function F(e,t){return B.apply(this,arguments)}function B(){return(B=(0,r.A)((function*(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(...yield Promise.all(e.slice(r,r+t).map((e=>e()))));return n}))).apply(this,arguments)}function G(e){return a((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var $=(()=>{for(var e="",t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function V(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$;return e.padEnd(t,n[0])}function j(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,r=BigInt(n.length);if(e<=r)return null!==(t=n[Number(e)-1])&&void 0!==t?t:"";var i=e/r,o=Number(e%r)-1;return o<0&&(i-=BigInt(Math.abs(o)),o=Number(r)-1),j(i,n)+n[o]}function K(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=BigInt(t.length),r=BigInt(0),i=e.length-1,o=BigInt(0);i>=0;i--,o++){var a=e.charCodeAt(i)-t.charCodeAt(0);r+=BigInt(1+a)*n**o}return r}function W(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$,r=Math.max(e.length,t.length),i=K(V(e,r,n),n),o=K(V(t,r,n),n),a=(i+o)/BigInt(2);return a===i||a==o?j(a,n)+n[0]:j(a,n)}function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;return j(K(e,t)+BigInt(1),t)}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;return j(K(e,t)-BigInt(1),t)}function Y(e,t){return e<t?-1:e>t?1:0}function z(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var[r,i]of Object.entries(t))e[r]instanceof Object&&i?z(e[r],i):null==i&&n||re(e,r,i);return e}function J(e){var t;return null!==(t=s.vo.findIn(e.getContent()))&&void 0!==t?t:-1}function X(e,t){return J(t)-J(e)}function Q(e){return[l.L.Read,l.L.ReadPrivate].includes(e)}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e.size!==t.size)return!1;for(var[r,i]of e){var o=t.get(r);if(void 0===o||!n(i,o))return!1}return!0}function ee(e){return e instanceof Map?te(e):Array.isArray(e)?e.map((e=>ee(e))):e}function te(e){var t=new Map;for(var[n,r]of e)t.set(n,ee(r));return Object.fromEntries(t.entries())}function ne(e){return"__proto__"===e||"prototype"===e||"constructor"===e}function re(e,t,n){if(ne(t))throw new Error("Trying to modify prototype or constructor");e[t]=n}function ie(e){return!(ne(e.room_id)||ne(e.sender)||ne(e.event_id))}class oe extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}},5542:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(467),i=n(7723),o=n(6617);function a(e,t,n){return s.apply(this,arguments)}function s(){return(s=(0,r.A)((function*(e,t,n){var[r,a]=yield(0,o.C)(t,n),s=(0,i.y4)(e.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},a,(0,i.y4)(e.mac),s)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var l=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:(0,i.y4)(e.iv),length:64},r,s);return(new TextDecoder).decode(new Uint8Array(l))}))).apply(this,arguments)}},1630:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(467),i=n(7723),o=n(6617);function a(e,t,n,r){return s.apply(this,arguments)}function s(){return(s=(0,r.A)((function*(e,t,n,r){var a;r?a=(0,i.y4)(r):(a=new Uint8Array(16),globalThis.crypto.getRandomValues(a),a[8]&=127);var[s,l]=yield(0,o.C)(t,n),c=(new TextEncoder).encode(e),d=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:a,length:64},s,c),u=yield globalThis.crypto.subtle.sign({name:"HMAC"},l,d);return{iv:(0,i.WG)(a),ciphertext:(0,i.WG)(new Uint8Array(d)),mac:(0,i.WG)(new Uint8Array(u))}}))).apply(this,arguments)}},6617:(e,t,n)=>{"use strict";n.d(t,{C:()=>o});var r=n(467),i=new Uint8Array(8);function o(e,t){return a.apply(this,arguments)}function a(){return(a=(0,r.A)((function*(e,t){var n=yield globalThis.crypto.subtle.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:i,info:(new TextEncoder).encode(t),hash:"SHA-256"},n,512),o=r.slice(0,32),a=r.slice(32),s=globalThis.crypto.subtle.importKey("raw",o,{name:"AES-CTR"},!1,["encrypt","decrypt"]),l=globalThis.crypto.subtle.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([s,l])}))).apply(this,arguments)}},2228:(e,t,n)=>{"use strict";n.d(t,{Hr:()=>r,Uv:()=>o,eD:()=>i});var r=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],i=r[0],o=r[r.length-1]},2188:(e,t,n)=>{"use strict";n.d(t,{$E:()=>C,Il:()=>w,QO:()=>b,RA:()=>T,WE:()=>I,iP:()=>_,ms:()=>x,sj:()=>N,sv:()=>D});var r=n(467),i=n(4980),o=n(7045),a=n(7363),s=n(3840),l=n(3883),c=n(2986),d=n(5942),u=n(2173),h=n(9456),p=n(6387),v=n(446),m=n(2958),g=n(9521);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(e){return e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended",e}({}),E=function(e){return e.Voice="voice",e.Video="video",e}({}),b=function(e){return e.Inbound="inbound",e.Outbound="outbound",e}({}),S=function(e){return e.Local="local",e.Remote="remote",e}({}),C=function(e){return e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel",e.SendVoipEvent="send_voip_event",e.PeerConnectionCreated="peer_connection_created",e}({}),w=function(e){return e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.CreateOffer="create_offer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transferred="transferred",e.NewSession="new_session",e}({}),A=6e4;class T extends Error{constructor(e,t,n){super(t+": "+n),(0,i.A)(this,"code",void 0),this.code=e}}function I(){return Date.now().toString()+(0,d.US)(16)}function k(e){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:e?12e3:void 0}]}function O(e,t){return e+":"+t}class R extends p.X{constructor(e){var t,n;if(super(),t=this,(0,i.A)(this,"roomId",void 0),(0,i.A)(this,"callId",void 0),(0,i.A)(this,"invitee",void 0),(0,i.A)(this,"hangupParty",void 0),(0,i.A)(this,"hangupReason",void 0),(0,i.A)(this,"direction",void 0),(0,i.A)(this,"ourPartyId",void 0),(0,i.A)(this,"peerConn",void 0),(0,i.A)(this,"toDeviceSeq",0),(0,i.A)(this,"isPtt",!1),(0,i.A)(this,"_state",_.Fledgling),(0,i.A)(this,"client",void 0),(0,i.A)(this,"forceTURN",void 0),(0,i.A)(this,"turnServers",void 0),(0,i.A)(this,"candidateSendQueue",[]),(0,i.A)(this,"candidateSendTries",0),(0,i.A)(this,"candidatesEnded",!1),(0,i.A)(this,"feeds",[]),(0,i.A)(this,"transceivers",new Map),(0,i.A)(this,"inviteOrAnswerSent",!1),(0,i.A)(this,"waitForLocalAVStream",!1),(0,i.A)(this,"successor",void 0),(0,i.A)(this,"opponentMember",void 0),(0,i.A)(this,"opponentVersion",void 0),(0,i.A)(this,"opponentPartyId",void 0),(0,i.A)(this,"opponentCaps",void 0),(0,i.A)(this,"iceDisconnectedTimeout",void 0),(0,i.A)(this,"iceReconnectionTimeOut",void 0),(0,i.A)(this,"inviteTimeout",void 0),(0,i.A)(this,"removeTrackListeners",new Map),(0,i.A)(this,"remoteOnHold",!1),(0,i.A)(this,"callStatsAtEnd",void 0),(0,i.A)(this,"makingOffer",!1),(0,i.A)(this,"ignoreOffer",!1),(0,i.A)(this,"isSettingRemoteAnswerPending",!1),(0,i.A)(this,"responsePromiseChain",void 0),(0,i.A)(this,"remoteCandidateBuffer",new Map),(0,i.A)(this,"remoteAssertedIdentity",void 0),(0,i.A)(this,"remoteSDPStreamMetadata",void 0),(0,i.A)(this,"callLengthInterval",void 0),(0,i.A)(this,"callStartTime",void 0),(0,i.A)(this,"opponentDeviceId",void 0),(0,i.A)(this,"opponentDeviceInfo",void 0),(0,i.A)(this,"opponentSessionId",void 0),(0,i.A)(this,"groupCallId",void 0),(0,i.A)(this,"stopVideoTrackTimer",void 0),(0,i.A)(this,"isOnlyDataChannelAllowed",void 0),(0,i.A)(this,"stats",void 0),(0,i.A)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(this.candidatesEnded&&s.v.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),s.v.debug("Call ".concat(this.callId," got local ICE ").concat(e.candidate.sdpMid," ").concat(e.candidate.candidate)),this.callHasEnded())return;""===e.candidate.candidate?this.queueCandidate(null):this.queueCandidate(e.candidate)}})),(0,i.A)(this,"onIceGatheringStateChange",(e=>{var t;s.v.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),"complete"===(null===(t=this.peerConn)||void 0===t?void 0:t.iceGatheringState)&&(this.queueCandidate(null),s.v.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))})),(0,i.A)(this,"getLocalOfferFailed",(e=>{s.v.error("Call ".concat(this.callId," getLocalOfferFailed() running"),e),this.emit(C.Error,new T(w.LocalOfferFailed,"Failed to get local offer!",e),this),this.terminate(S.Local,w.LocalOfferFailed,!1)})),(0,i.A)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(s.v.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),e),this.emit(C.Error,new T(w.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e),this),this.terminate(S.Local,w.NoUserMedia,!1))})),(0,i.A)(this,"placeCallFailed",(e=>{this.successor?this.successor.placeCallFailed(e):(s.v.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),e),this.emit(C.Error,new T(w.IceFailed,"Couldn't start call! Invalid ICE server configuration.",e),this),this.terminate(S.Local,w.IceFailed,!1))})),(0,i.A)(this,"onIceConnectionStateChanged",(()=>{var e,t,n,r,i,o;if(!this.callHasEnded()){if(s.v.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),["connected","completed"].includes(null!==(n=null===(r=this.peerConn)||void 0===r?void 0:r.iceConnectionState)&&void 0!==n?n:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=_.Connected,this.callLengthInterval||this.callStartTime||(this.callStartTime=Date.now(),this.callLengthInterval=setInterval((()=>{this.emit(C.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)}),1e3));else if("failed"==(null===(i=this.peerConn)||void 0===i?void 0:i.iceConnectionState)){var a,l;this.candidatesEnded=!1,null!==(a=this.peerConn)&&void 0!==a&&a.restartIce?(this.candidatesEnded=!1,s.v.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat(null===(l=this.peerConn)||void 0===l?void 0:l.iceConnectionState,")")),this.peerConn.restartIce()):(s.v.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(w.IceFailed,!1))}else"disconnected"==(null===(o=this.peerConn)||void 0===o?void 0:o.iceConnectionState)&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout((()=>{var e,t,n;s.v.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.iceConnectionState,", conn=").concat(null===(t=this.peerConn)||void 0===t?void 0:t.connectionState,")")),null!==(n=this.peerConn)&&void 0!==n&&n.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0}),2e3),this.iceDisconnectedTimeout=setTimeout((()=>{s.v.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(w.IceFailed,!1)}),3e4),this.state=_.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var c of this.getRemoteFeeds())c.setAudioVideoMuted(!0,!0)}})),(0,i.A)(this,"onSignallingStateChanged",(()=>{var e;s.v.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat(null===(e=this.peerConn)||void 0===e?void 0:e.signalingState,")"))})),(0,i.A)(this,"onTrack",(e=>{if(0!==e.streams.length){var t=e.streams[0];if(this.pushRemoteFeed(t),!this.removeTrackListeners.has(t)){var n=()=>{0===t.getTracks().length&&(s.v.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(t.id,")")),this.deleteFeedByStream(t),t.removeEventListener("removetrack",n),this.removeTrackListeners.delete(t))};t.addEventListener("removetrack",n),this.removeTrackListeners.set(t,n)}}else s.v.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(e.track.kind,")"))})),(0,i.A)(this,"onDataChannel",(e=>{this.emit(C.DataChannel,e.channel,this)})),(0,i.A)(this,"onNegotiationNeeded",(0,r.A)((function*(){s.v.info("Call ".concat(t.callId," onNegotiationNeeded() negotiation is needed!")),t.state===_.CreateOffer||0!==t.opponentVersion?t.queueGotLocalOffer():s.v.info("Call ".concat(t.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"))}))),(0,i.A)(this,"onHangupReceived",(e=>{s.v.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(e)||this.state===_.Ringing?this.terminate(S.Remote,e.reason||w.UserHangup,!0):s.v.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(e.party_id,": our partner is ").concat(this.opponentPartyId))})),(0,i.A)(this,"onRejectReceived",(e=>{s.v.debug("Call ".concat(this.callId," onRejectReceived() running")),[_.InviteSent,_.Ringing].includes(this.state)||this.state===_.Fledgling&&this.direction===b.Inbound?this.terminate(S.Remote,e.reason||w.UserHangup,!0):s.v.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))})),(0,i.A)(this,"onAnsweredElsewhere",(e=>{s.v.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(S.Remote,w.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");for(var o of(this.forceTURN=null!==(n=e.forceTURN)&&void 0!==n&&n,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]}),this.turnServers))(0,l.UB)(o,["urls"]);this.callId=I(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return(0,r.A)((function*(){yield e.placeCall(!0,!1)}))()}placeVideoCall(){var e=this;return(0,r.A)((function*(){yield e.placeCall(!0,!0)}))()}createDataChannel(e,t){var n=this.peerConn.createDataChannel(e,t);return this.emit(C.DataChannel,n,this),n}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var t=this._state;this._state=e,this.emit(C.State,e,t,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?E.Video:E.Voice}get hasLocalUserMediaVideoTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===u.h.Usermedia&&(null===(t=e.stream)||void 0===t?void 0:t.getVideoTracks().length)}))}get hasLocalUserMediaAudioTrack(){var e;return!(null===(e=this.localUsermediaStream)||void 0===e||!e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some((e=>{var t;return e.purpose===u.h.Usermedia&&!(null===(t=e.stream)||void 0===t||!t.getAudioTracks().length)}))}get hasUserMediaAudioSender(){var e;return Boolean(null===(e=this.transceivers.get(O(u.h.Usermedia,"audio")))||void 0===e?void 0:e.sender)}get hasUserMediaVideoSender(){var e;return Boolean(null===(e=this.transceivers.get(O(u.h.Usermedia,"video")))||void 0===e?void 0:e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find((e=>e.purpose===u.h.Usermedia))}get localScreensharingFeed(){return this.getLocalFeeds().find((e=>e.purpose===u.h.Screenshare))}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find((e=>e.purpose===u.h.Usermedia))}get remoteScreensharingFeed(){return this.getRemoteFeeds().find((e=>e.purpose===u.h.Screenshare))}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find((t=>t.stream.id===e))}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}initOpponentCrypto(){var e=this;return(0,r.A)((function*(){var t,n;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall())if(e.client.isCryptoEnabled()){if(!e.client.crypto)throw new Error("Crypto is not initialised.");var r=e.invitee||(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId);if(!r)throw new Error("Couldn't find opponent user ID to init crypto");var i=yield e.client.crypto.deviceList.downloadKeys([r],!1);if(e.opponentDeviceInfo=null===(n=i.get(r))||void 0===n?void 0:n.get(e.opponentDeviceId),void 0===e.opponentDeviceInfo)throw new m.Iy(r)}else e.opponentDeviceInfo=new v.V(e.opponentDeviceId)}))()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={};for(var n of this.getLocalFeeds())e&&(n.sdpMetadataStreamId=n.stream.id),t[n.sdpMetadataStreamId]={purpose:n.purpose,audio_muted:n.isAudioMuted(),video_muted:n.isVideoMuted()};return t}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushRemoteFeed(e){if(this.opponentSupportsSDPStreamMetadata()){var t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,r=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;n?this.getFeedByStreamId(e.id)?s.v.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new h.Hh({client:this.client,call:this,roomId:this.roomId,userId:t,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n,audioMuted:r,videoMuted:i})),this.emit(C.FeedsChanged,this.feeds,this),s.v.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(n,")"))):s.v.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"))}else this.pushRemoteFeedWithoutMetadata(e)}pushRemoteFeedWithoutMetadata(e){var t,n=this.getOpponentMember().userId,r=u.h.Usermedia,i=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;i&&e.id!==i.id?s.v.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")")):this.getFeedByStreamId(e.id)?s.v.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):(this.feeds.push(new h.Hh({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r})),this.emit(C.FeedsChanged,this.feeds,this),s.v.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")")))}pushNewLocalFeed(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.client.getUserId();x(e.getAudioTracks(),!0),x(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)?s.v.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")")):this.pushLocalFeed(new h.Hh({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:t}),n)}pushLocalFeed(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.feeds.some((t=>e.stream.id===t.stream.id)))s.v.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));else{if(this.feeds.push(e),n){var r=function(){s.v.info("Call ".concat(t.callId," pushLocalFeed() adding track to peer connection (id=").concat(i.id,", kind=").concat(i.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(i.enabled,")"));var n=O(e.purpose,i.kind);if(t.transceivers.has(n)){var r=t.transceivers.get(n);r.sender.replaceTrack(i),r.direction="inactive"===r.direction?"sendonly":"sendrecv"}else{var o=t.peerConn.addTrack(i,e.stream),a=t.peerConn.getTransceivers().find((e=>e.sender===o));a?t.transceivers.set(n,a):s.v.warn("Call ".concat(t.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var i of e.stream.getTracks())r()}s.v.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(C.FeedsChanged,this.feeds,this)}}removeLocalFeed(e){var t=O(e.purpose,"audio"),n=O(e.purpose,"video");for(var r of[t,n])if(this.transceivers.has(r)){var i=this.transceivers.get(r);i.sender&&this.peerConn.removeTrack(i.sender)}e.purpose===u.h.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)e.isLocal()&&this.groupCallId||e.dispose();this.feeds=[],this.emit(C.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var t=this.getFeedByStreamId(e.id);t?this.deleteFeed(t):s.v.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"))}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(C.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return(0,r.A)((function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()}))()}collectCallStats(){var e=this;return(0,r.A)((function*(){if(e.peerConn){var t=yield e.peerConn.getStats(),n=[];return t.forEach((e=>{n.push(e)})),n}}))()}initWithInvite(e){var t=this;return(0,r.A)((function*(){var n,r=e.getContent();t.direction=b.Inbound,(yield t.client.checkTurnServers())||s.v.warn("Call ".concat(t.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var i=r[u.A];i?t.updateRemoteSDPStreamMetadata(i):s.v.debug("Call ".concat(t.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),t.peerConn=t.createPeerConnection(),t.emit(C.PeerConnectionCreated,t.peerConn,t),t.chooseOpponent(e),yield t.initOpponentCrypto();try{yield t.peerConn.setRemoteDescription(r.offer),s.v.debug("Call ".concat(t.callId," initWithInvite() set remote description: ").concat(r.offer.type)),yield t.addBufferedIceCandidates()}catch(e){return s.v.debug("Call ".concat(t.callId," initWithInvite() failed to set remote description"),e),void t.terminate(S.Local,w.SetRemoteDescription,!1)}var o=null===(n=t.feeds.find((e=>!e.isLocal())))||void 0===n?void 0:n.stream;if(!(t.isOnlyDataChannelAllowed||o&&0!==o.getTracks().length))return s.v.error("Call ".concat(t.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),void t.terminate(S.Local,w.SetRemoteDescription,!1);if(t.state=_.Ringing,e.getLocalAge()){var a=setTimeout((()=>{var e;t.state==_.Ringing&&(s.v.debug("Call ".concat(t.callId," initWithInvite() invite has expired. Hanging up.")),t.hangupParty=S.Remote,t.state=_.Ended,t.stopAllMedia(),"closed"!=t.peerConn.signalingState&&t.peerConn.close(),null===(e=t.stats)||void 0===e||e.removeStatsReportGatherer(t.callId),t.emit(C.Hangup,t))}),r.lifetime-e.getLocalAge()),l=e=>{e!==_.Ringing&&(clearTimeout(a),t.off(C.State,l))};t.on(C.State,l)}}))()}initWithHangup(e){this.state=_.Ended}shouldAnswerWithMediaType(e,t,n){return e&&!t?(s.v.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n," because the other side isn't sending it either.")),!1):(0,l.hX)(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!=e?e:t:(s.v.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(n,"=").concat(e," because the other side doesn't support it. Answering with ").concat(n,"=").concat(t,".")),t)}answer(e,t){var n=this;return(0,r.A)((function*(){if(!n.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(n.localUsermediaStream||n.waitForLocalAVStream)n.waitForLocalAVStream&&(n.state=_.WaitLocalMedia);else{var r=n.state,i=n.shouldAnswerWithMediaType(e,n.hasRemoteUserMediaAudioTrack,"audio"),o=n.shouldAnswerWithMediaType(t,n.hasRemoteUserMediaVideoTrack,"video");n.state=_.WaitLocalMedia,n.waitForLocalAVStream=!0;try{var a,l=yield n.client.getMediaHandler().getUserMediaStream(i,o);n.waitForLocalAVStream=!1;var c=[new h.Hh({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(a=n.client.getDeviceId())&&void 0!==a?a:void 0,stream:l,purpose:u.h.Usermedia,audioMuted:!1,videoMuted:!1})];n.localScreensharingFeed&&c.push(n.localScreensharingFeed),n.answerWithCallFeeds(c)}catch(e){if(!o)return void n.getUserMediaFailed(e);s.v.warn("Call ".concat(n.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),n.state=r,n.waitForLocalAVStream=!1,yield n.answer(i,!1)}}}}))()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){s.v.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===_.WaitLocalMedia?(s.v.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[_.CreateOffer,_.InviteSent].includes(this.state)&&(e.direction===b.Outbound?e.queueGotCallFeedsForAnswer([]):(s.v.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map((e=>e.clone()))))),this.successor=e,this.emit(C.Replaced,e,this),this.hangup(w.Replaced,!0)}hangup(e,t){if(!this.callHasEnded()&&(s.v.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(S.Local,e,!t),![_.Fledgling,_.WaitLocalMedia].includes(this.state))){var n={};(this.opponentVersion&&0!==this.opponentVersion||e!==w.UserHangup)&&(n.reason=e),this.sendVoipEvent(c.Bx.CallHangup,n)}}reject(){if(this.state!==_.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(0===this.opponentVersion)return s.v.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),void this.hangup(w.UserHangup,!0);s.v.debug("Rejecting call: "+this.callId),this.terminate(S.Local,w.UserHangup,!0),this.sendVoipEvent(c.Bx.CallReject,{})}upgradeCall(e,t){var n=this;return(0,r.A)((function*(){if((e||t)&&n.opponentSupportsSDPStreamMetadata())try{s.v.debug("Call ".concat(n.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(t,")"));var r=e||n.hasLocalUserMediaAudioTrack,i=t||n.hasLocalUserMediaVideoTrack,o=yield n.client.getMediaHandler().getUserMediaStream(r,i,!1);yield n.updateLocalUsermediaStream(o,e,t)}catch(e){s.v.error("Call ".concat(n.callId," upgradeCall() failed to upgrade the call"),e),n.emit(C.Error,new T(w.NoUserMedia,"Failed to get camera access: ",e),n)}}))()}opponentSupportsSDPStreamMetadata(){return Boolean(this.remoteSDPStreamMetadata)}isScreensharing(){return Boolean(this.localScreensharingStream)}setScreensharingEnabled(e,t){var n=this;return(0,r.A)((function*(){if(e&&n.isScreensharing())return s.v.warn("Call ".concat(n.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!n.isScreensharing())return s.v.warn("Call ".concat(n.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!n.opponentSupportsSDPStreamMetadata())return n.setScreensharingEnabledWithoutMetadataSupport(e,t);if(s.v.debug("Call ".concat(n.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),!e){var r=n.transceivers.get(O(u.h.Screenshare,"audio")),i=n.transceivers.get(O(u.h.Screenshare,"video"));for(var o of[r,i])o&&o.sender&&n.peerConn.removeTrack(o.sender);return n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var a=yield n.client.getMediaHandler().getScreensharingStream(t);return!!a&&(n.pushNewLocalFeed(a,u.h.Screenshare),!0)}catch(e){return s.v.error("Call ".concat(n.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),e),!1}}))()}setScreensharingEnabledWithoutMetadataSupport(e,t){var n=this;return(0,r.A)((function*(){if(s.v.debug("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),!e){var r,i,o=null===(r=n.localUsermediaStream)||void 0===r?void 0:r.getTracks().find((e=>"video"===e.kind)),a=null===(i=n.transceivers.get(O(u.h.Usermedia,"video")))||void 0===i?void 0:i.sender;return null==a||a.replaceTrack(null!=o?o:null),n.client.getMediaHandler().stopScreensharingStream(n.localScreensharingStream),n.deleteFeedByStream(n.localScreensharingStream),!1}try{var l,c=yield n.client.getMediaHandler().getScreensharingStream(t);if(!c)return!1;var d=c.getTracks().find((e=>"video"===e.kind)),h=null===(l=n.transceivers.get(O(u.h.Usermedia,"video")))||void 0===l?void 0:l.sender;return null==h||h.replaceTrack(null!=d?d:null),n.pushNewLocalFeed(c,u.h.Screenshare,!1),!0}catch(e){return s.v.error("Call ".concat(n.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),e),!1}}))()}updateLocalUsermediaStream(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1],i=t.length>2&&void 0!==t[2]&&t[2],o=n.localUsermediaFeed,a=r||!o.isAudioMuted()&&!n.remoteOnHold,l=i||!o.isVideoMuted()&&!n.remoteOnHold;for(var c of(s.v.log("Call ".concat(n.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(a,", video=").concat(l,")")),x(e.getAudioTracks(),a),x(e.getVideoTracks(),l),n.localUsermediaStream.getTracks()))n.localUsermediaStream.removeTrack(c),c.stop();for(var d of e.getTracks())n.localUsermediaStream.addTrack(d);var h=function*(){var t=O(u.h.Usermedia,p.kind),r=n.transceivers.get(t),i=null==r?void 0:r.sender,a=!1;if(i)try{s.v.info("Call ".concat(n.callId," updateLocalUsermediaStream() replacing track (id=").concat(p.id,", kind=").concat(p.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield i.replaceTrack(p),r.direction="inactive"===r.direction?"sendonly":"sendrecv",a=!0}catch(e){s.v.warn("Call ".concat(n.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),e)}if(!a){s.v.info("Call ".concat(n.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(p.id,", kind=").concat(p.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var l=n.peerConn.addTrack(p,n.localUsermediaStream),c=n.peerConn.getTransceivers().find((e=>e.sender===l));c?n.transceivers.set(t,c):s.v.warn("Call ".concat(n.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var p of e.getTracks())yield*h()}))()}setLocalVideoMuted(e){var t=this;return(0,r.A)((function*(){var n,r;if(s.v.log("Call ".concat(t.callId," setLocalVideoMuted() running ").concat(e)),e||void 0===t.stopVideoTrackTimer||(clearTimeout(t.stopVideoTrackTimer),t.stopVideoTrackTimer=void 0),!(yield t.client.getMediaHandler().hasVideoDevice()))return t.isLocalVideoMuted();if(!t.hasUserMediaVideoSender&&!e)return null===(r=t.localUsermediaFeed)||void 0===r||r.setAudioVideoMuted(null,e),yield t.upgradeCall(!1,!0),t.isLocalVideoMuted();if(!e&&0===t.localUsermediaStream.getVideoTracks().length){var i=yield t.client.getMediaHandler().getUserMediaStream(!0,!0);yield t.updateLocalUsermediaStream(i)}return null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(null,e),t.updateMuteStatus(),yield t.sendMetadataUpdate(),e&&(t.stopVideoTrackTimer=setTimeout((()=>{for(var e of t.localUsermediaStream.getVideoTracks())e.stop(),t.localUsermediaStream.removeTrack(e)}),120)),t.isLocalVideoMuted()}))()}isLocalVideoMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())&&void 0!==e&&e}setMicrophoneMuted(e){var t=this;return(0,r.A)((function*(){var n;return s.v.log("Call ".concat(t.callId," setMicrophoneMuted() running ").concat(e)),(yield t.client.getMediaHandler().hasAudioDevice())?e||t.hasUserMediaAudioSender&&t.hasLocalUserMediaAudioTrack?(null===(n=t.localUsermediaFeed)||void 0===n||n.setAudioVideoMuted(e,null),t.updateMuteStatus(),yield t.sendMetadataUpdate(),t.isMicrophoneMuted()):(yield t.upgradeCall(!0,!1),t.isMicrophoneMuted()):t.isMicrophoneMuted()}))()}isMicrophoneMuted(){var e,t;return null!==(e=null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isAudioMuted())&&void 0!==e&&e}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){for(var t of(this.remoteOnHold=e,this.peerConn.getTransceivers()))t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(C.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==_.Connected)return!1;var e=!0;for(var t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){for(var t of this.peerConn.getSenders()){var n;if("audio"===(null===(n=t.track)||void 0===n?void 0:n.kind)&&t.dtmf)return void t.dtmf.insertDTMF(e)}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,t=this.isLocalVideoMuted()||this.remoteOnHold;s.v.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(t)),x(this.localUsermediaStream.getAudioTracks(),!e),x(this.localUsermediaStream.getVideoTracks(),!t)}sendMetadataUpdate(){var e=this;return(0,r.A)((function*(){yield e.sendVoipEvent(c.Bx.CallSDPStreamMetadataChangedPrefix,{[u.A]:e.getLocalSDPStreamMetadata()})}))()}gotCallFeedsForInvite(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.successor)this.successor.queueGotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(var n of e)this.pushLocalFeed(n);t&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=_.CreateOffer,s.v.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}}sendAnswer(){var e=this;return(0,r.A)((function*(){var t={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[u.A]:e.getLocalSDPStreamMetadata(!0)};t.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var n=e.discardDuplicateCandidates();s.v.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(n," candidates that will be sent in answer"));try{yield e.sendVoipEvent(c.Bx.CallAnswer,t),e.inviteOrAnswerSent=!0}catch(t){e.state=_.Ringing,t instanceof g.up&&t.event&&e.client.cancelPendingEvent(t.event);var r=w.SendAnswer,i="Failed to send answer";throw"UnknownDeviceError"==t.name&&(r=w.UnknownDevices,i="Unknown devices present in the room"),e.emit(C.Error,new T(r,i,t),e),t}e.sendCandidateQueue()}))()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.gotCallFeedsForAnswer(e))):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,t){var n=(0,a.qg)(e.sdp);n.media.forEach((e=>{var n=new Map,r=new Map;for(var i of e.rtp)n.set(i.payload,i.codec),r.set(i.codec,i.payload);for(var o of t)if(o.mediaType===e.type)if(r.has(o.codec)){var a=[];void 0!==o.enableDtx&&a.push("usedtx=".concat(o.enableDtx?"1":"0")),void 0!==o.maxAverageBitrate&&a.push("maxaveragebitrate=".concat(o.maxAverageBitrate));var l=!1;for(var c of e.fmtp)n.get(c.payload)===o.codec&&(l=!0,c.config+=";"+a.join(";"));l||e.fmtp.push({payload:r.get(o.codec),config:a.join(";")})}else s.v.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(o.codec," as it's not present."))})),e.sdp=(0,a.M9)(n)}createOffer(){var e=this;return(0,r.A)((function*(){var t=yield e.peerConn.createOffer();return e.mungeSdp(t,k(e.isPtt)),t}))()}createAnswer(){var e=this;return(0,r.A)((function*(){var t=yield e.peerConn.createAnswer();return e.mungeSdp(t,k(e.isPtt)),t}))()}gotCallFeedsForAnswer(e){var t=this;return(0,r.A)((function*(){if(!t.callHasEnded()){for(var n of(t.waitForLocalAVStream=!1,e))t.pushLocalFeed(n);var r;t.state=_.CreateAnswer;try{t.getRidOfRTXCodecs(),r=yield t.createAnswer()}catch(e){return s.v.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() failed to create answer: "),e),void t.terminate(S.Local,w.CreateAnswer,!0)}try{if(yield t.peerConn.setLocalDescription(r),t.callHasEnded())return;if(t.state=_.Connecting,yield new Promise((e=>{setTimeout(e,200)})),t.callHasEnded())return;t.sendAnswer()}catch(e){return s.v.debug("Call ".concat(t.callId," gotCallFeedsForAnswer() error setting local description!"),e),void t.terminate(S.Local,w.SetLocalDescription,!0)}}}))()}onRemoteIceCandidatesReceived(e){var t=this;return(0,r.A)((function*(){if(!t.callHasEnded()){var n=e.getContent(),r=n.candidates;if(r){var i=0===n.version?null:n.party_id||null;if(void 0!==t.opponentPartyId)t.partyIdMatches(n)?yield t.addIceCandidates(r):s.v.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(n.party_id,": we have chosen party ID ").concat(t.opponentPartyId));else if(i){s.v.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() buffering ").concat(r.length," candidates until we pick an opponent"));var o=t.remoteCandidateBuffer.get(i)||[];o.push(...r),t.remoteCandidateBuffer.set(i,o)}}else s.v.info("Call ".concat(t.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"))}}))()}onAnswerReceived(e){var t=this;return(0,r.A)((function*(){var n=e.getContent();if(s.v.debug("Call ".concat(t.callId," onAnswerReceived() running (hangupParty=").concat(n.party_id,")")),t.callHasEnded())s.v.debug("Call ".concat(t.callId," onAnswerReceived() ignoring answer because call has ended"));else if(void 0===t.opponentPartyId){t.chooseOpponent(e),yield t.addBufferedIceCandidates(),t.state=_.Connecting;var r=n[u.A];r?t.updateRemoteSDPStreamMetadata(r):s.v.warn("Call ".concat(t.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{t.isSettingRemoteAnswerPending=!0,yield t.peerConn.setRemoteDescription(n.answer),t.isSettingRemoteAnswerPending=!1,s.v.debug("Call ".concat(t.callId," onAnswerReceived() set remote description: ").concat(n.answer.type))}catch(e){return t.isSettingRemoteAnswerPending=!1,s.v.debug("Call ".concat(t.callId," onAnswerReceived() failed to set remote description"),e),void t.terminate(S.Local,w.SetRemoteDescription,!1)}if(null!==t.opponentPartyId)try{yield t.sendVoipEvent(c.Bx.CallSelectAnswer,{selected_party_id:t.opponentPartyId})}catch(e){s.v.warn("Call ".concat(t.callId," onAnswerReceived() failed to send select_answer event"),e)}}else s.v.info("Call ".concat(t.callId," onAnswerReceived() ignoring answer from party ID ").concat(n.party_id,": we already have an answer/reject from ").concat(t.opponentPartyId))}))()}onSelectAnswerReceived(e){var t=this;return(0,r.A)((function*(){if(t.direction===b.Inbound){var n=e.getContent().selected_party_id;null!=n?n!==t.ourPartyId&&(s.v.info("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(n,": we are party ID ").concat(t.ourPartyId,".")),yield t.terminate(S.Remote,w.AnsweredElsewhere,!0)):s.v.warn("Call ".concat(t.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"))}else s.v.warn("Call ".concat(t.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"))}))()}onNegotiateReceived(e){var t=this;return(0,r.A)((function*(){var n=e.getContent(),r=n.description;if(r&&r.sdp&&r.type){var i=t.direction===b.Inbound,o=!t.makingOffer&&("stable"===t.peerConn.signalingState||t.isSettingRemoteAnswerPending),a="offer"===r.type&&!o;if(t.ignoreOffer=!i&&a,t.ignoreOffer)s.v.info("Call ".concat(t.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));else{var l=t.isLocalOnHold(),d=n[u.A];d?t.updateRemoteSDPStreamMetadata(d):s.v.warn("Call ".concat(t.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(t.isSettingRemoteAnswerPending="answer"==r.type,yield t.peerConn.setRemoteDescription(r),t.isSettingRemoteAnswerPending=!1,s.v.debug("Call ".concat(t.callId," onNegotiateReceived() set remote description: ").concat(r.type)),"offer"===r.type){var h,p;try{t.getRidOfRTXCodecs(),p=yield t.createAnswer()}catch(e){return s.v.debug("Call ".concat(t.callId," onNegotiateReceived() failed to create answer: "),e),void t.terminate(S.Local,w.CreateAnswer,!0)}yield t.peerConn.setLocalDescription(p),s.v.debug("Call ".concat(t.callId," onNegotiateReceived() create an answer")),t.sendVoipEvent(c.Bx.CallNegotiate,{lifetime:A,description:null===(h=t.peerConn.localDescription)||void 0===h?void 0:h.toJSON(),[u.A]:t.getLocalSDPStreamMetadata(!0)})}}catch(e){t.isSettingRemoteAnswerPending=!1,s.v.warn("Call ".concat(t.callId," onNegotiateReceived() failed to complete negotiation"),e)}var v=t.isLocalOnHold();l!==v&&(t.emit(C.LocalHoldUnhold,v,t),t.emit(C.HoldUnhold,v))}}else s.v.info("Call ".concat(t.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"))}))()}updateRemoteSDPStreamMetadata(e){for(var t of(this.remoteSDPStreamMetadata=(0,l.Bi)(this.remoteSDPStreamMetadata||{},e,!0),this.getRemoteFeeds())){var n,r=t.stream.id,i=this.remoteSDPStreamMetadata[r];t.setAudioVideoMuted(null==i?void 0:i.audio_muted,null==i?void 0:i.video_muted),t.purpose=null===(n=this.remoteSDPStreamMetadata[r])||void 0===n?void 0:n.purpose}}onSDPStreamMetadataChangedReceived(e){var t=e.getContent()[u.A];this.updateRemoteSDPStreamMetadata(t)}onAssertedIdentityReceived(e){var t=this;return(0,r.A)((function*(){var n=e.getContent();n.asserted_identity&&(t.remoteAssertedIdentity={id:n.asserted_identity.id,displayName:n.asserted_identity.display_name},t.emit(C.AssertedIdentityChanged,t))}))()}callHasEnded(){return this.state===_.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then((()=>this.wrappedGotLocalOffer())):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return(0,r.A)((function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(t){return void e.getLocalOfferFailed(t)}finally{e.makingOffer=!1}}))()}gotLocalOffer(){var e=this;return(0,r.A)((function*(){if(s.v.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded())s.v.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));else{var t;try{e.getRidOfRTXCodecs(),t=yield e.createOffer()}catch(t){return s.v.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),t),void e.terminate(S.Local,w.CreateOffer,!0)}try{yield e.peerConn.setLocalDescription(t)}catch(t){return s.v.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),t),void e.terminate(S.Local,w.SetLocalDescription,!0)}if("gathering"===e.peerConn.iceGatheringState&&(yield new Promise((e=>{setTimeout(e,200)}))),!e.callHasEnded()){var n,r,i=e.state===_.CreateOffer?c.Bx.CallInvite:c.Bx.CallNegotiate,o={lifetime:A};i===c.Bx.CallInvite&&e.invitee&&(o.invitee=e.invitee),e.state===_.CreateOffer?o.offer=null===(n=e.peerConn.localDescription)||void 0===n?void 0:n.toJSON():o.description=null===(r=e.peerConn.localDescription)||void 0===r?void 0:r.toJSON(),o.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},o[u.A]=e.getLocalSDPStreamMetadata(!0);var a=e.discardDuplicateCandidates();s.v.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(a," candidates that will be sent in offer"));try{yield e.sendVoipEvent(i,o)}catch(t){s.v.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),t),t instanceof g.up&&t.event&&e.client.cancelPendingEvent(t.event);var l=w.SignallingFailed,d="Signalling failed";return e.state===_.CreateOffer&&(l=w.SendInvite,d="Failed to send invite"),"UnknownDeviceError"==t.name&&(l=w.UnknownDevices,d="Unknown devices present in the room"),e.emit(C.Error,new T(l,d,t),e),void e.terminate(S.Local,l,!1)}e.sendCandidateQueue(),e.state===_.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=_.InviteSent,e.inviteTimeout=setTimeout((()=>{e.inviteTimeout=void 0,e.state===_.InviteSent&&e.hangup(w.InviteTimeout,!1)}),A))}}}))()}getRidOfRTXCodecs(){if(RTCRtpReceiver.getCapabilities&&RTCRtpSender.getCapabilities){var e=this.transceivers.get(O(u.h.Screenshare,"video"));if(e&&e.setCodecPreferences){var t=RTCRtpReceiver.getCapabilities("video").codecs,n=RTCRtpSender.getCapabilities("video").codecs,r=[];for(var i of[...t,...n])if("video/rtx"!==i.mimeType){r.push(i);try{e.setCodecPreferences(r)}catch(e){s.v.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",i,e),r.pop()}}}}}sendVoipEvent(e,t){var n=this;return(0,r.A)((function*(){var r=y(y({},t),{},{version:"1",call_id:n.callId,party_id:n.ourPartyId,conf_id:n.groupCallId});if(n.opponentDeviceId){var i,a=n.toDeviceSeq++,l=y(y({},r),{},{device_id:n.client.deviceId,sender_session_id:n.client.getSessionId(),dest_session_id:n.opponentSessionId,seq:a,[c.wt]:(0,o.A)()});n.emit(C.SendVoipEvent,{type:"toDevice",eventType:e,userId:n.invitee||(null===(i=n.getOpponentMember())||void 0===i?void 0:i.userId),opponentDeviceId:n.opponentDeviceId,content:l},n);var d=n.invitee||n.getOpponentMember().userId;if(n.client.getUseE2eForGroupCall()){if(!n.opponentDeviceInfo)return void s.v.warn("Call ".concat(n.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));yield n.client.encryptAndSendToDevices([{userId:d,deviceInfo:n.opponentDeviceInfo}],{type:e,content:l})}else yield n.client.sendToDevice(e,new Map([[d,new Map([[n.opponentDeviceId,l]])]]))}else{var u;n.emit(C.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:n.roomId,content:r,userId:n.invitee||(null===(u=n.getOpponentMember())||void 0===u?void 0:u.userId)},n),yield n.client.sendEvent(n.roomId,e,r)}}))()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state!==_.Ringing&&this.inviteOrAnswerSent){var t=this.direction===b.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}}discardDuplicateCandidates(){for(var e=0,t=[],n=0;n<this.candidateSendQueue.length;n++){var r=this.candidateSendQueue[n];""===r.candidate?t.push(r):e++}return this.candidateSendQueue=t,e}transfer(e){var t=this;return(0,r.A)((function*(){var n=yield t.client.getProfileInfo(e),r=I(),i={replacement_id:I(),target_user:{id:e,display_name:n.displayname,avatar_url:n.avatar_url},create_call:r};yield t.sendVoipEvent(c.Bx.CallReplaces,i),yield t.terminate(S.Local,w.Transferred,!0)}))()}transferToCall(e){var t=this;return(0,r.A)((function*(){var n,r,i=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId,o=i?yield t.client.getProfileInfo(i):void 0,a=null===(r=t.getOpponentMember())||void 0===r?void 0:r.userId,s=a?yield t.client.getProfileInfo(a):void 0,l=I(),d={replacement_id:I(),target_user:{id:a,display_name:null==s?void 0:s.displayname,avatar_url:null==s?void 0:s.avatar_url},await_call:l};yield e.sendVoipEvent(c.Bx.CallReplaces,d);var u={replacement_id:I(),target_user:{id:i,display_name:null==o?void 0:o.displayname,avatar_url:null==o?void 0:o.avatar_url},create_call:l};yield t.sendVoipEvent(c.Bx.CallReplaces,u),yield t.terminate(S.Local,w.Transferred,!0),yield e.terminate(S.Local,w.Transferred,!0)}))()}terminate(e,t,n){var i=this;return(0,r.A)((function*(){var r;if(!i.callHasEnded()){for(var[o,a]of(i.hangupParty=e,i.hangupReason=t,i.state=_.Ended,i.inviteTimeout&&(clearTimeout(i.inviteTimeout),i.inviteTimeout=void 0),void 0!==i.iceDisconnectedTimeout&&(clearTimeout(i.iceDisconnectedTimeout),i.iceDisconnectedTimeout=void 0),i.callLengthInterval&&(clearInterval(i.callLengthInterval),i.callLengthInterval=void 0),void 0!==i.stopVideoTrackTimer&&(clearTimeout(i.stopVideoTrackTimer),i.stopVideoTrackTimer=void 0),i.removeTrackListeners))o.removeEventListener("removetrack",a);i.removeTrackListeners.clear(),i.callStatsAtEnd=yield i.collectCallStats(),i.stopAllMedia(),i.deleteAllFeeds(),i.peerConn&&"closed"!==i.peerConn.signalingState&&i.peerConn.close(),null===(r=i.stats)||void 0===r||r.removeStatsReportGatherer(i.callId),n&&i.emit(C.Hangup,i),i.client.callEventHandler.calls.delete(i.callId)}}))()}stopAllMedia(){for(var e of(s.v.debug("Call ".concat(this.callId," stopAllMedia() running")),this.feeds))if(e.isLocal()&&e.purpose===u.h.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===u.h.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal())for(var t of(s.v.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")")),e.stream.getTracks()))t.stop()}checkForErrorListener(){if(0===this.listeners(p.u.Error).length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return(0,r.A)((function*(){if(0!==e.candidateSendQueue.length&&!e.callHasEnded()){var t=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var n={candidates:t.map((e=>e.toJSON()))};e.candidatesEnded&&n.candidates.push({candidate:""}),s.v.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(t.length," candidates"));try{yield e.sendVoipEvent(c.Bx.CallCandidates,n),e.candidateSendTries=0,e.sendCandidateQueue()}catch(n){if(n instanceof g.up&&n.event&&e.client.cancelPendingEvent(n.event),e.candidateSendQueue.push(...t),e.candidateSendTries>5){s.v.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),n);var r=w.SignallingFailed;return e.emit(C.Error,new T(r,"Signalling failed",n),e),void e.hangup(r,!1)}var i=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,s.v.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(i,"ms"),n),setTimeout((()=>{e.sendCandidateQueue()}),i)}}}))()}placeCall(e,t){var n=this;return(0,r.A)((function*(){if(!e)throw new Error("You CANNOT start a call without audio");var r;n.state=_.WaitLocalMedia;try{var i,o=yield n.client.getMediaHandler().getUserMediaStream(e,t);x(o.getAudioTracks(),!0),x(o.getVideoTracks(),!0),r=new h.Hh({client:n.client,roomId:n.roomId,userId:n.client.getUserId(),deviceId:null!==(i=n.client.getDeviceId())&&void 0!==i?i:void 0,stream:o,purpose:u.h.Usermedia,audioMuted:!1,videoMuted:!1})}catch(e){return void n.getUserMediaFailed(e)}try{yield n.placeCallWithCallFeeds([r])}catch(e){return void n.placeCallFailed(e)}}))()}placeCallWithCallFeeds(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];n.checkForErrorListener(),n.direction=b.Outbound,yield n.initOpponentCrypto(),n.client.callEventHandler.calls.set(n.callId,n),(yield n.client.checkTurnServers())||s.v.warn("Call ".concat(n.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),n.peerConn=n.createPeerConnection(),n.emit(C.PeerConnectionCreated,n.peerConn,n),n.gotCallFeedsForInvite(e,r)}))()}createPeerConnection(){var e,t=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),t.addEventListener("signalingstatechange",this.onSignallingStateChanged),t.addEventListener("icecandidate",this.gotLocalIceCandidate),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t.addEventListener("track",this.onTrack),t.addEventListener("negotiationneeded",this.onNegotiationNeeded),t.addEventListener("datachannel",this.onDataChannel);var n=this.getOpponentMember(),r=n?n.userId:"unknown";return null===(e=this.stats)||void 0===e||e.addStatsReportGatherer(this.callId,r,t),t}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var t,n,r=e.getContent();s.v.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=null!==(t=this.client.getRoom(this.roomId).getMember(e.getSender()))&&void 0!==t?t:void 0,this.opponentMember&&(null===(n=this.stats)||void 0===n||n.updateOpponentMember(this.callId,this.opponentMember.userId))}addBufferedIceCandidates(){var e=this;return(0,r.A)((function*(){var t=e.remoteCandidateBuffer.get(e.opponentPartyId);t&&(s.v.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(t.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(t)),e.remoteCandidateBuffer.clear()}))()}addIceCandidates(e){var t=this;return(0,r.A)((function*(){for(var n of e){null!==n.sdpMid&&void 0!==n.sdpMid||null!==n.sdpMLineIndex&&void 0!==n.sdpMLineIndex?s.v.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(n.sdpMid,", candidate=").concat(n.candidate,")")):s.v.debug("Call ".concat(t.callId," addIceCandidates() got remote ICE end-of-candidates"));try{yield t.peerConn.addIceCandidate(n)}catch(e){t.ignoreOffer?s.v.debug("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),e):s.v.info("Call ".concat(t.callId," addIceCandidates() failed to add remote ICE candidate"),e)}}}))()}get hasPeerConnection(){return Boolean(this.peerConn)}initStats(e){this.stats=e,this.stats.start()}}function x(e,t){for(var n of e)n.enabled=t}function N(){if("undefined"==typeof window||"undefined"==typeof document)return!1;try{var e,t,n;if(!Boolean(null!==(e=null!==(t=null!==(n=window.RTCPeerConnection)&&void 0!==n?n:window.RTCSessionDescription)&&void 0!==t?t:window.RTCIceCandidate)&&void 0!==e?e:navigator.mediaDevices))return s.v.error("WebRTC is not supported in this browser / environment"),!1}catch(e){return s.v.error("Exception thrown when trying to access WebRTC",e),!1}return!0}function D(e,t,n){if(!N())return null;var r=!!n&&n.forceTURN,i={client:e,roomId:t,invitee:null==n?void 0:n.invitee,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||r,opponentDeviceId:null==n?void 0:n.opponentDeviceId,opponentSessionId:null==n?void 0:n.opponentSessionId,groupCallId:null==n?void 0:n.groupCallId},o=new R(i);return e.reEmitter.reEmit(o,Object.values(C)),o}},7016:(e,t,n)=>{"use strict";n.d(t,{B:()=>u,N:()=>h});var r=n(467),i=n(4980),o=n(3840),a=n(2188),s=n(2986),l=n(4792),c=n(2958),d=n(4659),u=function(e){return e.Incoming="Call.incoming",e}({});class h{constructor(e){(0,i.A)(this,"calls",void 0),(0,i.A)(this,"callEventBuffer",void 0),(0,i.A)(this,"nextSeqByCall",new Map),(0,i.A)(this,"toDeviceEventBuffers",new Map),(0,i.A)(this,"client",void 0),(0,i.A)(this,"candidateEventsByCall",void 0),(0,i.A)(this,"eventBufferPromiseChain",void 0),(0,i.A)(this,"onSync",(()=>{var e=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then((()=>this.evaluateEventBuffer(e))):this.eventBufferPromiseChain=this.evaluateEventBuffer(e)})),(0,i.A)(this,"onRoomTimeline",(e=>{this.callEventBuffer.push(e)})),(0,i.A)(this,"onToDeviceEvent",(e=>{var t=e.getContent();if(t.call_id)if(this.nextSeqByCall.has(t.call_id)||this.nextSeqByCall.set(t.call_id,0),void 0!==t.seq){var n=this.nextSeqByCall.get(t.call_id)||0;if(t.seq!==n){this.toDeviceEventBuffers.has(t.call_id)||this.toDeviceEventBuffers.set(t.call_id,[]);var r=this.toDeviceEventBuffers.get(t.call_id),i=r.findIndex((e=>e.getContent().seq>t.seq));-1===i?r.push(e):r.splice(i,0,e)}else{var o=t.call_id;this.callEventBuffer.push(e),this.nextSeqByCall.set(o,t.seq+1);for(var a=this.toDeviceEventBuffers.get(o),s=a&&a.shift();s&&s.getContent().seq===this.nextSeqByCall.get(o);)this.callEventBuffer.push(s),this.nextSeqByCall.set(o,s.getContent().seq+1),s=a.shift()}}else this.callEventBuffer.push(e);else this.callEventBuffer.push(e)})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(l.AU.Sync,this.onSync),this.client.on(d.u9.Timeline,this.onRoomTimeline),this.client.on(l.AU.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(l.AU.Sync,this.onSync),this.client.removeListener(d.u9.Timeline,this.onRoomTimeline),this.client.removeListener(l.AU.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var t=this;return(0,r.A)((function*(){yield Promise.all(e.map((e=>t.client.decryptEventIfNeeded(e))));var n=e.filter((e=>{var t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")})),r=new Set;for(var i of n){var a=i.getType();a!==s.Bx.CallAnswer&&a!==s.Bx.CallHangup||r.add(i.getContent().call_id)}for(var l of n){var c=l.getType(),d=l.getContent().call_id;if(c!==s.Bx.CallInvite||!r.has(d))try{yield t.handleCallEvent(l)}catch(e){o.v.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",e)}}}))()}handleCallEvent(e){var t=this;return(0,r.A)((function*(){var n;t.client.emit(l.AU.ReceivedVoipEvent,e);var r,i,d=e.getContent(),h=e.getRoomId()||(null===(n=t.client.groupCallEventHandler.getGroupCallById(d.conf_id))||void 0===n||null===(n=n.room)||void 0===n?void 0:n.roomId),p=d.conf_id,v=e.getType(),m=e.getSender(),g=d.call_id?t.calls.get(d.call_id):void 0;if(p){if(!(i=t.client.groupCallEventHandler.getGroupCallById(p)))return void o.v.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(p,", type=").concat(v,")"));if(!(r=d.device_id))return o.v.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(m,")")),void i.emit(c.AZ.Error,new c.Iy(m));if(d.dest_session_id!==t.client.getSessionId())return void o.v.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring")}var f=m===t.client.credentials.userId&&(void 0===r||r===t.client.getDeviceId());if(h)if(v!==s.Bx.CallInvite)if(v!==s.Bx.CallCandidates){var y;if([s.Bx.CallHangup,s.Bx.CallReject].includes(v))g?g.state!==a.iP.Ended&&(v===s.Bx.CallHangup?g.onHangupReceived(d):g.onRejectReceived(d),g.state===a.iP.Ended&&t.calls.delete(d.call_id)):(g=null!==(y=(0,a.sv)(t.client,h,{opponentDeviceId:r,opponentSessionId:d.sender_session_id}))&&void 0!==y?y:void 0)&&(g.callId=d.call_id,g.initWithHangup(e),t.calls.set(d.call_id,g));else if(g&&g.hasPeerConnection){if(e.getContent().party_id!==g.ourPartyId)switch(v){case s.Bx.CallAnswer:f?g.state===a.iP.Ringing&&g.onAnsweredElsewhere(d):g.onAnswerReceived(e);break;case s.Bx.CallSelectAnswer:g.onSelectAnswerReceived(e);break;case s.Bx.CallNegotiate:g.onNegotiateReceived(e);break;case s.Bx.CallAssertedIdentity:case s.Bx.CallAssertedIdentityPrefix:g.onAssertedIdentityReceived(e);break;case s.Bx.CallSDPStreamMetadataChanged:case s.Bx.CallSDPStreamMetadataChangedPrefix:g.onSDPStreamMetadataChangedReceived(e)}}else o.v.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(v,")"))}else{if(f)return;g?g.onRemoteIceCandidatesReceived(e):(t.candidateEventsByCall.has(d.call_id)||t.candidateEventsByCall.set(d.call_id,[]),t.candidateEventsByCall.get(d.call_id).push(e))}else{var _,E,b;if(f)return;if(e.getLocalAge()>d.lifetime-3e3)return;if(g&&g.state===a.iP.Ended)return;if(g&&o.v.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(d.call_id,")")),d.invitee&&d.invitee!==t.client.getUserId())return;var S=(null!==(_=t.client.getTurnServersExpiry())&&void 0!==_?_:0)-Date.now();if(o.v.info("CallEventHandler handleCallEvent() current turn creds expire in "+S+" ms"),!(g=null!==(E=(0,a.sv)(t.client,h,{forceTURN:t.client.forceTURN,opponentDeviceId:r,groupCallId:p,opponentSessionId:d.sender_session_id}))&&void 0!==E?E:void 0))return void o.v.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(d.call_id,")"));g.callId=d.call_id;var C,w=null===(b=i)||void 0===b?void 0:b.getGroupCallStats();w&&g.initStats(w);try{yield g.initWithInvite(e)}catch(e){var A;e instanceof a.RA&&(e.code===c.BF.UnknownDevice?null===(A=i)||void 0===A||A.emit(c.AZ.Error,e):o.v.error(e))}if(t.calls.set(g.callId,g),t.candidateEventsByCall.get(g.callId))for(var T of t.candidateEventsByCall.get(g.callId))g.onRemoteIceCandidatesReceived(T);for(var I of t.calls.values()){var k,O=[a.iP.WaitLocalMedia,a.iP.CreateOffer,a.iP.InviteSent].includes(I.state);if(g.roomId===I.roomId&&I.direction===a.QO.Outbound&&(null===(k=g.getOpponentMember())||void 0===k?void 0:k.userId)===I.invitee&&O){C=I;break}}C?C.callId>g.callId?(o.v.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(g.callId,", outgoingId=").concat(C.callId,")")),C.replacedBy(g)):(o.v.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(g.callId,", outgoingId=").concat(C.callId,")")),g.hangup(a.Il.Replaced,!0)):t.client.emit(u.Incoming,g)}}))()}}},2173:(e,t,n)=>{"use strict";n.d(t,{A:()=>r,h:()=>i});var r="org.matrix.msc3077.sdp_stream_metadata",i=function(e){return e.Usermedia="m.usermedia",e.Screenshare="m.screenshare",e}({})},9456:(e,t,n)=>{"use strict";n.d(t,{Hh:()=>h,BL:()=>u,Tw:()=>d});var r=n(4980),i=n(2173),o=null,a=0,s=n(3840),l=n(6387),c=n(2188),d=-60,u=function(e){return e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.LocalVolumeChanged="local_volume_changed",e.VolumeChanged="volume_changed",e.ConnectedChanged="connected_changed",e.Speaking="speaking",e.Disposed="disposed",e}({});class h extends l.X{constructor(e){super(),(0,r.A)(this,"stream",void 0),(0,r.A)(this,"sdpMetadataStreamId",void 0),(0,r.A)(this,"userId",void 0),(0,r.A)(this,"deviceId",void 0),(0,r.A)(this,"purpose",void 0),(0,r.A)(this,"speakingVolumeSamples",void 0),(0,r.A)(this,"client",void 0),(0,r.A)(this,"call",void 0),(0,r.A)(this,"roomId",void 0),(0,r.A)(this,"audioMuted",void 0),(0,r.A)(this,"videoMuted",void 0),(0,r.A)(this,"localVolume",1),(0,r.A)(this,"measuringVolumeActivity",!1),(0,r.A)(this,"audioContext",void 0),(0,r.A)(this,"analyser",void 0),(0,r.A)(this,"frequencyBinCount",void 0),(0,r.A)(this,"speakingThreshold",d),(0,r.A)(this,"speaking",!1),(0,r.A)(this,"volumeLooperTimeout",void 0),(0,r.A)(this,"_disposed",!1),(0,r.A)(this,"_connected",!1),(0,r.A)(this,"onAddTrack",(()=>{this.emit(u.NewStream,this.stream)})),(0,r.A)(this,"onCallState",(e=>{e===c.iP.Connected?this.connected=!0:e===c.iP.Connecting&&(this.connected=!1)})),(0,r.A)(this,"volumeLooper",(()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var e=-1/0;for(var t of this.frequencyBinCount)t>e&&(e=t);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(u.VolumeChanged,e);var n=!1;for(var r of this.speakingVolumeSamples)if(r>this.speakingThreshold){n=!0;break}this.speaking!==n&&(this.speaking=n,this.emit(u.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,200)}})),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(8).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(c.$E.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(u.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){if(t!==e){var n=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),n&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(u.NewStream,this.stream)}}initVolumeMeasuring(){this.hasAudioTrack&&(this.audioContext||(this.audioContext=(null===o&&(o=new AudioContext),a++,o)),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){var e,t=this.client.getRoom(this.roomId);return null!==(e=null==t?void 0:t.getMember(this.userId))&&void 0!==e?e:null}isLocal(){return this.userId===this.client.getUserId()&&(void 0===this.deviceId||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,t){null!==e&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),null!==t&&(this.videoMuted=t),this.emit(u.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(u.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),t=this.stream.clone();return s.v.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(t.id,")")),this.purpose===i.h.Usermedia?e.userMediaStreams.push(t):e.screensharingStreams.push(t),new h({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:t,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,t,n;clearTimeout(this.volumeLooperTimeout),null===(e=this.stream)||void 0===e||e.removeEventListener("addtrack",this.onAddTrack),null===(t=this.call)||void 0===t||t.removeListener(c.$E.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,0==--a&&(null===(n=o)||void 0===n||n.close(),o=null)),this._disposed=!0,this.emit(u.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(u.LocalVolumeChanged,e)}}},2958:(e,t,n)=>{"use strict";n.d(t,{eO:()=>Y,BF:()=>j,AZ:()=>$,MC:()=>F,F_:()=>q,xt:()=>V,Ad:()=>B,Iy:()=>W});var r=n(467),i=n(4980),o=n(6387),a=n(9456),s=n(2188),l=n(6122),c=n(3840),d=n(4831),u=n(2173),h=n(2986),p=n(7016),v=n(4377),m=n(3883);class g{constructor(){(0,i.A)(this,"bandwidth",{}),(0,i.A)(this,"bitrate",{}),(0,i.A)(this,"packetLoss",{}),(0,i.A)(this,"transport",[])}}class f{static buildBandwidthReport(e){var t=e.availableIncomingBitrate,n=e.availableOutgoingBitrate;return{download:t?Math.round(t/1e3):0,upload:n?Math.round(n/1e3):0}}}class y{static buildReport(e,t,n,r){var i=null==e?void 0:e.get(t.localCandidateId),o=null==e?void 0:e.get(t.remoteCandidateId);if(o&&i){var a=void 0!==o.ip?o.ip:o.address,s=o.port,l="".concat(a,":").concat(s),c=void 0!==i.ip?i.ip:i.address,d=i.port,u="".concat(c,":").concat(d),h=o.protocol;n.some((e=>e.ip===l&&e.type===h&&e.localIp===u))||n.push({ip:l,type:h,localIp:u,isFocus:r,localCandidateType:i.candidateType,remoteCandidateType:o.candidateType,networkType:i.networkType,rtt:t.currentRoundTripTime?1e3*t.currentRoundTripTime:NaN})}return n}}var _=n(7363);class E{constructor(){(0,i.A)(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,t){var n;return this.ssrcToMid[t].forEach(((t,r)=>{t.find((t=>t==e))&&(n=r)})),n}parse(e,t){var n=(0,_.qg)(e),r=new Map;n.media.forEach((e=>{if(e.mid&&"video"===e.type||"audio"===e.type){var t,n=[];null===(t=e.ssrcs)||void 0===t||t.forEach((e=>{"cname"===e.attribute&&n.push("".concat(e.id))})),r.set("".concat(e.mid),n)}})),this.ssrcToMid[t]=r}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class b{constructor(e){this.pc=e}getLocalTracks(e){return this.pc.getTransceivers().filter((e=>"sendonly"===e.currentDirection||"sendrecv"===e.currentDirection)).filter((e=>null!==e.sender)).map((e=>e.sender)).map((e=>e.track)).filter((t=>null!==t&&t.kind===e))}getTackById(e){return this.pc.getTransceivers().map((t=>null!==(null==t?void 0:t.sender.track)&&t.sender.track.id===e?t.sender.track:null!==(null==t?void 0:t.receiver.track)&&t.receiver.track.id===e?t.receiver.track:void 0)).find((e=>void 0!==e))}getLocalTrackIdByMid(e){var t,n=this.pc.getTransceivers().find((t=>t.mid===e));return null==n||null===(t=n.sender)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getRemoteTrackIdByMid(e){var t,n=this.pc.getTransceivers().find((t=>t.mid===e));return null==n||null===(t=n.receiver)||void 0===t||null===(t=t.track)||void 0===t?void 0:t.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find((t=>t.receiver.track.id===e||null!==t.sender.track&&t.sender.track.id===e))}}class S{constructor(e,t,n){this.trackId=e,this.type=t,this.kind=n,(0,i.A)(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),(0,i.A)(this,"bitrate",{download:0,upload:0}),(0,i.A)(this,"resolution",{width:-1,height:-1}),(0,i.A)(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),(0,i.A)(this,"framerate",0),(0,i.A)(this,"jitter",0),(0,i.A)(this,"codec",""),(0,i.A)(this,"isAlive",!0),(0,i.A)(this,"isMuted",!1),(0,i.A)(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,t){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=t}getAudioConcealment(){return this.audioConcealment}}class C{constructor(e,t){this.mediaSsrcHandler=e,this.mediaTrackHandler=t,(0,i.A)(this,"track2stats",new Map)}findTrack2Stats(e,t){var n;if(e.trackIdentifier)n=e.trackIdentifier;else if(e.mid)n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){if(!this.mediaSsrcHandler.findMidBySsrc(e.ssrc,t))return;n="remote"===t?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(n){var r=this.track2stats.get(n);if(!r){var i=this.mediaTrackHandler.getTackById(n);if(void 0===i)return;var o="audio"===i.kind?i.kind:"video";r=new S(n,t,o),this.track2stats.set(n,r)}return r}}findLocalVideoTrackStats(e){if(0!==this.mediaTrackHandler.getLocalTracks("video").length)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class w{static getNonNegativeValue(e){var t=e;return"number"!=typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)}}class A{static buildFramerateResolution(e,t){var n={height:t.frameHeight,width:t.frameWidth},r=t.framesPerSecond;n.height&&n.width&&e.setResolution(n),e.setFramerate(Math.round(r||0))}static calculateSimulcastFramerate(e,t,n,r){var i=e.getFramerate();if(!i){if(n){var o=t.timestamp-n.timestamp;o>0&&t.framesSent&&(i=(t.framesSent-n.framesSent)/o*1e3)}if(!i)return}i=r?Math.round(i/r):0,e.setFramerate(i)}static buildCodec(e,t,n){var r=null==e?void 0:e.get(n.codecId);if(r){var i=r.mimeType.split("/")[1];i&&t.setCodec(i)}}static buildBitrateReceived(e,t,n){e.setBitrate({download:A.calculateBitrate(t.bytesReceived,n.bytesReceived,t.timestamp,n.timestamp),upload:0})}static buildBitrateSend(e,t,n){e.setBitrate({download:0,upload:this.calculateBitrate(t.bytesSent,n.bytesSent,t.timestamp,n.timestamp)})}static buildPacketsLost(e,t,n){var r="outbound-rtp"===t.type?"packetsSent":"packetsReceived",i=t[r];(!i||i<0)&&(i=0);var o=w.getNonNegativeValue(n[r]),a=Math.max(0,i-o),s=w.getNonNegativeValue(t.packetsLost),l=w.getNonNegativeValue(n.packetsLost),c=Math.max(0,s-l);e.setLoss({packetsTotal:a+c,packetsLost:c,isDownloadStream:"outbound-rtp"!==t.type})}static calculateBitrate(e,t,n,r){var i=w.getNonNegativeValue(e),o=w.getNonNegativeValue(t),a=Math.max(0,i-o),s=n-r,l=0;return s>0&&(l=Math.round(8*a/s)),l}static setTrackStatsState(e,t){var n;if(void 0!==t){var r="remote"===e.getType()?t.receiver.track:null==t||null===(n=t.sender)||void 0===n?void 0:n.track;null!=r&&"ended"!==r.readyState?(e.muted=r.muted,e.enabled=r.enabled,e.alive=!0):e.alive=!1}else e.alive=!1}static buildTrackSummary(e){var t={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r=e.filter((e=>"remote"===e.getType())),i=r.filter((e=>"audio"===e.kind));return r.forEach((e=>{var r,o,a="video"===e.kind?t:n;a.count++,e.alive&&e.muted&&a.muted++,a.maxJitter<e.getJitter()&&(a.maxJitter=e.getJitter()),a.maxPacketLoss<e.getLoss().packetsLost&&(a.maxPacketLoss=e.getLoss().packetsLost),i.length>0&&(a.concealedAudio+=null===(r=e.getAudioConcealment())||void 0===r?void 0:r.concealedAudio,a.totalAudio+=null===(o=e.getAudioConcealment())||void 0===o?void 0:o.totalAudioDuration)})),{audioTrackSummary:n,videoTrackSummary:t}}static buildJitter(e,t){if("inbound-rtp"===t.type){var n=null==t?void 0:t.jitter;if(void 0!==n){var r=w.getNonNegativeValue(n);e.setJitter(Math.round(1e3*r))}else e.setJitter(-1)}}static buildAudioConcealment(e,t){if("inbound-rtp"===t.type){var n=1e3*(null==t?void 0:t.totalSamplesDuration)/(null==t?void 0:t.totalSamplesReceived)*(null==t?void 0:t.concealedSamples),r=1e3*(null==t?void 0:t.totalSamplesDuration);e.setAudioConcealment(n,r)}}}class T{static build(e){var t={},n={download:0,upload:0},r={download:0,upload:0},i=0,o=0,a={local:new Map,remote:new Map},s={local:new Map,remote:new Map},l={local:new Map,remote:new Map},c=new Map,d=new Map,u=0,h=0,p=0,v=0,m=0,g=0;for(var[f,y]of e){var _=y.getLoss(),E=_.isDownloadStream?"download":"upload";if(n[E]+=_.packetsTotal,r[E]+=_.packetsLost,i+=y.getBitrate().download,o+=y.getBitrate().upload,"audio"===y.kind){var b=y.getAudioConcealment();m+=b.concealedAudio,g+=b.totalAudioDuration,u+=y.getBitrate().download,h+=y.getBitrate().upload}else p+=y.getBitrate().download,v+=y.getBitrate().upload;a[y.getType()].set(f,y.getResolution()),s[y.getType()].set(f,y.getFramerate()),l[y.getType()].set(f,y.getCodec()),"remote"===y.getType()&&(c.set(f,y.getJitter()),"audio"===y.kind&&d.set(f,y.getAudioConcealment())),y.resetBitrate()}return t.bitrate={upload:o,download:i},t.bitrate.audio={upload:h,download:u},t.bitrate.video={upload:v,download:p},t.packetLoss={total:T.calculatePacketLoss(r.download+r.upload,n.download+n.upload),download:T.calculatePacketLoss(r.download,n.download),upload:T.calculatePacketLoss(r.upload,n.upload)},t.audioConcealment=d,t.totalAudioConcealment={concealedAudio:m,totalAudioDuration:g},t.framerate=s,t.resolution=a,t.codec=l,t.jitter=c,t}static calculatePacketLoss(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}}class I{static buildCallFeedReport(e,t,n){var r=n.getTransceivers(),i=[];return r.forEach((e=>{var t,n=null!==(t=e.sender)&&void 0!==t&&t.track?I.buildTrackStats(e.sender.track,"sender"):null,r=I.buildTrackStats(e.receiver.track,"receiver");i.push({mid:null==e.mid?"null":e.mid,direction:e.direction,currentDirection:null==e.currentDirection?"null":e.currentDirection,sender:n,receiver:r})})),{callId:e,opponentMemberId:t,transceiver:i,callFeeds:[]}}static buildTrackStats(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--",i=null===(t=e.getSettings())||void 0===t?void 0:t.deviceId,o=null===(n=e.getConstraints())||void 0===n?void 0:n.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:null!=i?i:"unknown",constrainDeviceId:null!=o?o:"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:r}}static expandCallFeedReport(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return t.forEach((t=>{var r=t.stream.getAudioTracks(),i=t.stream.getVideoTracks(),o=r.length>0?I.buildTrackStats(t.stream.getAudioTracks()[0],t.purpose):null,a=i.length>0?I.buildTrackStats(t.stream.getVideoTracks()[0],t.purpose):null,s={stream:t.stream.id,type:t.isLocal()?"local":"remote",audio:o,video:a,purpose:t.purpose,prefix:n,isVideoMuted:t.isVideoMuted(),isAudioMuted:t.isAudioMuted()};e.callFeeds.push(s)})),e}}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class R{constructor(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.callId=e,this.opponentMemberId=t,this.pc=n,this.emitter=r,this.isFocus=o,(0,i.A)(this,"isActive",!0),(0,i.A)(this,"previousStatsReport",void 0),(0,i.A)(this,"currentStatsReport",void 0),(0,i.A)(this,"connectionStats",new g),(0,i.A)(this,"trackStats",void 0),n.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new C(new E,new b(n))}processStats(e,t){var n=this;return(0,r.A)((function*(){var r={isFirstCollection:void 0===n.previousStatsReport,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(n.isActive){var i=n.pc.getStats();if("function"==typeof(null==i?void 0:i.then))return i.then((i=>{var o,a;n.currentStatsReport="function"==typeof(null==i?void 0:i.result)?i.result():i;try{n.processStatsReport(e,t)}catch(e){return n.handleError(e),r}n.previousStatsReport=n.currentStatsReport,r.receivedMedia=n.connectionStats.bitrate.download,r.receivedAudioMedia=(null===(o=n.connectionStats.bitrate.audio)||void 0===o?void 0:o.download)||0,r.receivedVideoMedia=(null===(a=n.connectionStats.bitrate.video)||void 0===a?void 0:a.download)||0;var s=A.buildTrackSummary(Array.from(n.trackStats.getTrack2stats().values()));return O(O({},r),{},{audioTrackSummary:s.audioTrackSummary,videoTrackSummary:s.videoTrackSummary})})).catch((e=>(n.handleError(e),r)));n.isActive=!1}return Promise.resolve(r)}))()}processStatsReport(e,t){var n,r=new Map;r.callId=this.callId,r.opponentMemberId=this.opponentMemberId,null===(n=this.currentStatsReport)||void 0===n||n.forEach((e=>{var t=this.previousStatsReport?this.previousStatsReport.get(e.id):null;if("candidate-pair"===e.type&&e.nominated&&"succeeded"===e.state)this.connectionStats.bandwidth=f.buildBandwidthReport(e),this.connectionStats.transport=y.buildReport(this.currentStatsReport,e,this.connectionStats.transport,this.isFocus);else if("inbound-rtp"===e.type||"outbound-rtp"===e.type){var n=this.trackStats.findTrack2Stats(e,"inbound-rtp"===e.type?"remote":"local");if(!n)return;if(t&&A.buildPacketsLost(n,e,t),"inbound-rtp"===e.type){A.buildFramerateResolution(n,e),t&&A.buildBitrateReceived(n,e,t);var i=this.trackStats.findTransceiverByTrackId(n.trackId);A.setTrackStatsState(n,i),A.buildJitter(n,e),A.buildAudioConcealment(n,e)}else t&&(r.set(n.trackId,w.getNonNegativeValue(e.bytesSent)),A.buildBitrateSend(n,e,t));A.buildCodec(this.currentStatsReport,n,e)}else if("track"===e.type&&"video"===e.kind&&!e.remoteSource){var o=this.trackStats.findLocalVideoTrackStats(e);if(!o)return;A.buildFramerateResolution(o,e),A.calculateSimulcastFramerate(o,e,t,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}})),this.emitter.emitByteSendReport(r),this.emitter.emitCallFeedReport(I.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,c.v.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=T.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(O(O({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){"stable"===this.pc.signalingState&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var x=n(6695);class N extends o.X{emitByteSendReport(e){this.emit(x.I.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(x.I.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(x.I.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(x.I.SUMMARY_STATS,e)}}class D{constructor(e){this.emitter=e}build(e){var t=e.filter((e=>!e.isFirstCollection)),n=t.length,r=e.length;if(0!==n){var i={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,a=0;t.forEach((e=>{this.countTrackListReceivedMedia(i,e),this.countConcealedAudio(i,e),o=this.buildMaxJitter(o,e),a=this.buildMaxPacketLoss(a,e)}));var s={percentageReceivedMedia:Number((i.receivedMedia/n).toFixed(5)),percentageReceivedVideoMedia:Number((i.receivedVideo/n).toFixed(5)),percentageReceivedAudioMedia:Number((i.receivedAudio/n).toFixed(5)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(i.totalAudio>0?(i.concealedAudio/i.totalAudio).toFixed(5):0),peerConnections:r};this.emitter.emitSummaryStatsReport(s)}}static extendSummaryReport(e,t){var n=[],r=[];for(var i of t)for(var o of(r.push(i),i[1]))n.push(o);e.opponentDevicesInCall=Math.max(0,n.length-1),e.opponentUsersInCall=Math.max(0,r.length-1),e.diffDevicesToPeerConnections=Math.max(0,n.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=0==Math.max(0,n.length-1)?0:e.peerConnections/(n.length-1)}countTrackListReceivedMedia(e,t){var n=!1,r=!1;(t.receivedAudioMedia>0||0===t.audioTrackSummary.count)&&(e.receivedAudio++,n=!0),(t.receivedVideoMedia>0||0===t.videoTrackSummary.count||t.videoTrackSummary.muted>0&&t.videoTrackSummary.muted===t.videoTrackSummary.count)&&(e.receivedVideo++,r=!0),r&&n&&e.receivedMedia++}buildMaxJitter(e,t){return e<t.videoTrackSummary.maxJitter&&(e=t.videoTrackSummary.maxJitter),e<t.audioTrackSummary.maxJitter&&(e=t.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,t){return e<t.videoTrackSummary.maxPacketLoss&&(e=t.videoTrackSummary.maxPacketLoss),e<t.audioTrackSummary.maxPacketLoss&&(e=t.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,t){e.concealedAudio+=t.audioTrackSummary.concealedAudio,e.totalAudio+=t.audioTrackSummary.totalAudio}}class L{constructor(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;this.groupCallId=e,this.userId=t,this.interval=n,(0,i.A)(this,"timer",void 0),(0,i.A)(this,"gatherers",new Map),(0,i.A)(this,"reports",new N),(0,i.A)(this,"summaryStatsReportGatherer",new D(this.reports))}start(){void 0===this.timer&&this.interval>0&&(this.timer=setInterval((()=>{this.processStats()}),this.interval))}stop(){void 0!==this.timer&&(clearInterval(this.timer),this.gatherers.forEach((e=>e.stopProcessingStats())))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,t,n){return!this.hasStatsReportGatherer(e)&&(this.gatherers.set(e,new R(e,t,n,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,t){var n;null===(n=this.getStatsReportGatherer(e))||void 0===n||n.setOpponentMemberId(t)}processStats(){var e=[];this.gatherers.forEach((t=>{e.push(t.processStats(this.groupCallId,this.userId))})),Promise.all(e).then((e=>this.summaryStatsReportGatherer.build(e))).catch((e=>{c.v.error("Could not build summary stats report",e)}))}setInterval(e){this.interval=e}}var P=n(6560);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var F=function(e){return e.Ring="m.ring",e.Prompt="m.prompt",e.Room="m.room",e}({}),B=function(e){return e.Video="m.video",e.Voice="m.voice",e}({}),G=function(e){return e.CallEnded="call_ended",e}({}),$=function(e){return e.GroupCallStateChanged="group_call_state_changed",e.ActiveSpeakerChanged="active_speaker_changed",e.CallsChanged="calls_changed",e.UserMediaFeedsChanged="user_media_feeds_changed",e.ScreenshareFeedsChanged="screenshare_feeds_changed",e.LocalScreenshareStateChanged="local_screenshare_state_changed",e.LocalMuteStateChanged="local_mute_state_changed",e.ParticipantsChanged="participants_changed",e.Error="group_call_error",e}({}),V=function(e){return e.ConnectionStats="GroupCall.connection_stats",e.ByteSentStats="GroupCall.byte_sent_stats",e.SummaryStats="GroupCall.summary_stats",e.CallFeedStats="GroupCall.call_feed_stats",e}({}),j=function(e){return e.NoUserMedia="no_user_media",e.UnknownDevice="unknown_device",e.PlaceCallFailed="place_call_failed",e}({});class K extends Error{constructor(e,t,n){n?(super(t+": "+n),(0,i.A)(this,"code",void 0)):(super(t),(0,i.A)(this,"code",void 0)),this.code=e}}class W extends K{constructor(e){super(j.UnknownDevice,"No device found for "+e),this.userId=e}}Error;var q=function(e){return e.LocalCallFeedUninitialized="local_call_feed_uninitialized",e.InitializingLocalCallFeed="initializing_local_call_feed",e.LocalCallFeedInitialized="local_call_feed_initialized",e.Entered="entered",e.Ended="ended",e}({});function H(e){var t;return(null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId)||e.invitee||null}class Y extends o.X{constructor(e,t,n,r,o,u,p,v,m){var g,f,y=arguments.length>9&&void 0!==arguments[9]&&arguments[9],_=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=t,this.type=n,this.isPtt=r,this.intent=o,this.dataChannelsEnabled=p,this.dataChannelOptions=v,this.useLivekit=y,(0,i.A)(this,"activeSpeakerInterval",1e3),(0,i.A)(this,"retryCallInterval",5e3),(0,i.A)(this,"participantTimeout",15e3),(0,i.A)(this,"pttMaxTransmitTime",2e4),(0,i.A)(this,"activeSpeaker",void 0),(0,i.A)(this,"localCallFeed",void 0),(0,i.A)(this,"localScreenshareFeed",void 0),(0,i.A)(this,"localDesktopCapturerSourceId",void 0),(0,i.A)(this,"userMediaFeeds",[]),(0,i.A)(this,"screenshareFeeds",[]),(0,i.A)(this,"groupCallId",void 0),(0,i.A)(this,"allowCallWithoutVideoAndAudio",void 0),(0,i.A)(this,"calls",new Map),(0,i.A)(this,"callHandlers",new Map),(0,i.A)(this,"activeSpeakerLoopInterval",void 0),(0,i.A)(this,"retryCallLoopInterval",void 0),(0,i.A)(this,"retryCallCounts",new Map),(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"transmitTimer",null),(0,i.A)(this,"participantsExpirationTimer",null),(0,i.A)(this,"resendMemberStateTimer",null),(0,i.A)(this,"initWithAudioMuted",!1),(0,i.A)(this,"initWithVideoMuted",!1),(0,i.A)(this,"initCallFeedPromise",void 0),(0,i.A)(this,"_livekitServiceURL",void 0),(0,i.A)(this,"stats",void 0),(0,i.A)(this,"statsCollectIntervalTime",0),(0,i.A)(this,"onConnectionStats",(e=>{this.emit(V.ConnectionStats,{report:e})})),(0,i.A)(this,"onByteSentStats",(e=>{this.emit(V.ByteSentStats,{report:e})})),(0,i.A)(this,"onSummaryStats",(e=>{D.extendSummaryReport(e,this.participants),this.emit(V.SummaryStats,{report:e})})),(0,i.A)(this,"onCallFeedReport",(e=>{this.localCallFeed&&(e=I.expandCallFeedReport(e,[this.localCallFeed],"from-local-feed"));var t=[];this.forEachCall((n=>{n.callId===e.callId&&n.getFeeds().forEach((e=>t.push(e)))})),e=I.expandCallFeedReport(e,t,"from-call-feed"),this.emit(V.CallFeedStats,{report:e})})),(0,i.A)(this,"_state",q.LocalCallFeedUninitialized),(0,i.A)(this,"_participants",new Map),(0,i.A)(this,"_creationTs",null),(0,i.A)(this,"_enteredViaAnotherSession",!1),(0,i.A)(this,"onIncomingCall",(e=>{var t,n;if(e.roomId===this.room.roomId)if(e.state===s.iP.Ringing){if(!e.groupCallId||e.groupCallId!==this.groupCallId)return c.v.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),void e.reject();var r=null===(t=e.getOpponentMember())||void 0===t?void 0:t.userId;if(void 0!==r)if(this.useLivekit)c.v.info("Received incoming call whilst in signaling-only mode! Ignoring.");else{var i=null!==(n=this.calls.get(r))&&void 0!==n?n:new Map,o=i.get(e.getOpponentDeviceId());if((null==o?void 0:o.callId)!==e.callId){c.v.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(r,", callId=").concat(e.callId,")")),o&&o.hangup(s.Il.Replaced,!1),i.set(e.getOpponentDeviceId(),e),this.calls.set(r,i),this.initCall(e);var a=this.getLocalFeeds().map((e=>e.clone()));if(!this.callExpected(e))for(var l of a)(0,s.ms)(l.stream.getAudioTracks(),!1),(0,s.ms)(l.stream.getVideoTracks(),!1);e.answerWithCallFeeds(a),this.emit($.CallsChanged,this.calls)}}else c.v.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"))}else c.v.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"))})),(0,i.A)(this,"onRetryCallLoop",(()=>{var e=!1;for(var[{userId:t},n]of this.participants){var r=this.calls.get(t),i=this.retryCallCounts.get(t);for(var[o,a]of n){var s,l,c=null==r?void 0:r.get(o),d=null!==(s=null===(l=i)||void 0===l?void 0:l.get(o))&&void 0!==s?s:0;(null==c?void 0:c.getOpponentSessionId())!==a.sessionId&&this.wantsOutgoingCall(t,o)&&d<3&&(void 0===i&&(i=new Map,this.retryCallCounts.set(t,i)),i.set(o,d+1),e=!0)}}e&&this.placeOutgoingCalls()})),(0,i.A)(this,"onCallFeedsChanged",(e=>{var t=H(e),n=e.getOpponentDeviceId();if(!t)throw new Error("Cannot change call feeds without user id");var r=this.getUserMediaFeed(t,n),i=e.remoteUsermediaFeed,o=i!==r,a=this.calls.get(t),s=null==a?void 0:a.get(n);if((null==s?void 0:s.callId)===e.callId){o&&(!r&&i?this.addUserMediaFeed(i):r&&i?this.replaceUserMediaFeed(r,i):r&&!i&&this.removeUserMediaFeed(r));var l=this.getScreenshareFeed(t,n),c=e.remoteScreensharingFeed;c!==l&&(!l&&c?this.addScreenshareFeed(c):l&&c?this.replaceScreenshareFeed(l,c):l&&!c&&this.removeScreenshareFeed(l))}})),(0,i.A)(this,"onCallStateChanged",((e,t,n)=>{var r;if(t!==s.iP.Ended){var i=this.localCallFeed.isAudioMuted();e.localUsermediaStream&&e.isMicrophoneMuted()!==i&&e.setMicrophoneMuted(i);var o=this.localCallFeed.isVideoMuted();e.localUsermediaStream&&e.isLocalVideoMuted()!==o&&e.setLocalVideoMuted(o);var a=null===(r=e.getOpponentMember())||void 0===r?void 0:r.userId;if(t===s.iP.Connected&&a){var l=this.retryCallCounts.get(a);null==l||l.delete(e.getOpponentDeviceId()),0===(null==l?void 0:l.size)&&this.retryCallCounts.delete(a)}}})),(0,i.A)(this,"onCallHangup",(e=>{var t,n;if(e.hangupReason!==s.Il.Replaced){var r=null!==(t=null===(n=e.getOpponentMember())||void 0===n?void 0:n.userId)&&void 0!==t?t:this.room.getMember(e.invitee).userId,i=this.calls.get(r);(null==i?void 0:i.get(e.getOpponentDeviceId()))===e&&(this.disposeCall(e,e.hangupReason),i.delete(e.getOpponentDeviceId()),0===i.size&&this.calls.delete(r),this.emit($.CallsChanged,this.calls))}})),(0,i.A)(this,"onCallReplaced",((e,t)=>{var n=e.getOpponentMember().userId,r=this.calls.get(n);void 0===r&&(r=new Map,this.calls.set(n,r)),e.hangup(s.Il.Replaced,!1),this.initCall(t),r.set(e.getOpponentDeviceId(),t),this.emit($.CallsChanged,this.calls)})),(0,i.A)(this,"onActiveSpeakerLoop",(()=>{var e=void 0,t=void 0;for(var n of this.userMediaFeeds)if(!(n.isLocal()&&this.userMediaFeeds.length>1)){var r=n.speakingVolumeSamples.reduce(((e,t)=>e+Math.max(t,a.Tw)))/n.speakingVolumeSamples.length;(!e||r>e)&&(e=r,t=n)}t&&this.activeSpeaker!==t&&e&&e>a.Tw&&(this.activeSpeaker=t,this.emit($.ActiveSpeakerChanged,this.activeSpeaker))})),(0,i.A)(this,"onRoomState",(()=>this.updateParticipants())),(0,i.A)(this,"onParticipantsChanged",(()=>{this.forEachCall((e=>{var t=this.callExpected(e);for(var n of e.getLocalFeeds())(0,s.ms)(n.stream.getAudioTracks(),!n.isAudioMuted()&&t),(0,s.ms)(n.stream.getVideoTracks(),!n.isVideoMuted()&&t)})),this.state!==q.Entered||this.useLivekit||this.placeOutgoingCalls()})),(0,i.A)(this,"onStateChanged",((e,t)=>{e!==q.Entered&&t!==q.Entered&&e!==q.Ended||(this.updateParticipants(),this.updateMemberState().catch((e=>c.v.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),e))))})),(0,i.A)(this,"onLocalFeedsChanged",(()=>{this.state===q.Entered&&this.updateMemberState().catch((e=>c.v.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),e)))})),this.reEmitter=new d.K(this),this.groupCallId=null!=u?u:(0,s.WE)(),this._livekitServiceURL=_,this.creationTs=null!==(g=null===(f=t.currentState.getStateEvents(h.Bx.GroupCallPrefix,this.groupCallId))||void 0===f?void 0:f.getTs())&&void 0!==g?g:null,this.updateParticipants(),t.on(l.f.Update,this.onRoomState),this.on($.ParticipantsChanged,this.onParticipantsChanged),this.on($.GroupCallStateChanged,this.onStateChanged),this.on($.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!m}create(){var e=this;return(0,r.A)((function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(v.o.Outgoing,e),yield e.sendCallStateEvent(),e}))()}sendCallStateEvent(){var e=this;return(0,r.A)((function*(){var t={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(t["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,h.Bx.GroupCallPrefix,t,e.groupCallId)}))()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var t=this._state;e!==t&&(this._state=e,this.emit($.GroupCallStateChanged,e,t))}get participants(){return this._participants}set participants(e){var t=this._participants,n=(e,t)=>e.sessionId===t.sessionId&&e.screensharing===t.screensharing;(0,m.kg)(e,t,((e,t)=>(0,m.kg)(e,t,n)))||(this._participants=e,this.emit($.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var t of this.calls.values())for(var n of t.values())e(n)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,t;return null!==(e=null===(t=this.participants.get(this.room.getMember(this.client.getUserId())))||void 0===t?void 0:t.has(this.client.getDeviceId()))&&void 0!==e&&e}callExpected(e){var t,n=H(e),r=null===n?null:this.room.getMember(n),i=e.getOpponentDeviceId();return null!==r&&void 0!==i&&void 0!==(null===(t=this.participants.get(r))||void 0===t?void 0:t.get(i))}initLocalCallFeed(){var e=this;return(0,r.A)((function*(){if(e.useLivekit)c.v.info("Livekit group call: not starting local call feed.");else{if(e.state!==q.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=q.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}}}))()}initLocalCallFeedInternal(){var e=this;return(0,r.A)((function*(){var t;c.v.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));try{t=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===B.Video)}catch(n){if(!e.allowCallWithoutVideoAndAudio)throw e.state=q.LocalCallFeedUninitialized,n;t=new MediaStream}if(e._state!==q.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(t),new Error("Group call disposed while gathering media stream");var n=new a.Hh({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:t,purpose:u.h.Usermedia,audioMuted:e.initWithAudioMuted||0===t.getAudioTracks().length||e.isPtt,videoMuted:e.initWithVideoMuted||0===t.getVideoTracks().length});(0,s.ms)(t.getAudioTracks(),!n.isAudioMuted()),(0,s.ms)(t.getVideoTracks(),!n.isVideoMuted()),e.localCallFeed=n,e.addUserMediaFeed(n),e.state=q.LocalCallFeedInitialized}))()}updateLocalUsermediaStream(e){var t=this;return(0,r.A)((function*(){if(t.localCallFeed){var n=t.localCallFeed.stream;t.localCallFeed.setNewStream(e);var r=t.localCallFeed.isAudioMuted(),i=t.localCallFeed.isVideoMuted();c.v.log("GroupCall ".concat(t.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(n.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(r,", vidShouldBeMuted=").concat(i,")")),(0,s.ms)(e.getAudioTracks(),!r),(0,s.ms)(e.getVideoTracks(),!i),t.client.getMediaHandler().stopUserMediaStream(n)}}))()}enter(){var e=this;return(0,r.A)((function*(){if(e.state===q.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==q.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));for(var t of(c.v.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=q.Entered,e.client.on(p.B.Incoming,e.onIncomingCall),e.client.callEventHandler.calls.values()))e.onIncomingCall(t);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))}))()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),null!==this.transmitTimer&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),void 0!==this.retryCallLoopInterval&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===q.Entered&&(this.forEachCall((e=>e.hangup(s.Il.UserHangup,!1))),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(p.B.Incoming,this.onIncomingCall),null===(e=this.stats)||void 0===e||e.stop())}leave(){this.dispose(),this.state=q.LocalCallFeedUninitialized}terminate(){var e=arguments,t=this;return(0,r.A)((function*(){var n=!(e.length>0&&void 0!==e[0])||e[0];if(t.dispose(),t.room.off(l.f.Update,t.onRoomState),t.client.groupCallEventHandler.groupCalls.delete(t.room.roomId),t.client.emit(v.o.Ended,t),t.state=q.Ended,n){var r=t.room.currentState.getStateEvents(h.Bx.GroupCallPrefix,t.groupCallId);yield t.client.sendStateEvent(t.room.roomId,h.Bx.GroupCallPrefix,U(U({},r.getContent()),{},{"m.terminated":G.CallEnded}),t.groupCallId)}}))()}isLocalVideoMuted(){return!this.localCallFeed||this.localCallFeed.isVideoMuted()}isMicrophoneMuted(){return!this.localCallFeed||this.localCallFeed.isAudioMuted()}setMicrophoneMuted(e){var t=this;return(0,r.A)((function*(){if(!e&&!(yield t.client.getMediaHandler().hasAudioDevice()))return!1;var n=!e&&t.isPtt;t.isPtt&&(!e&&t.isMicrophoneMuted()?t.transmitTimer=setTimeout((()=>{t.setMicrophoneMuted(!0)}),t.pttMaxTransmitTime):e&&!t.isMicrophoneMuted()&&(null!==t.transmitTimer&&clearTimeout(t.transmitTimer),t.transmitTimer=null)),t.forEachCall((t=>{var n;return null===(n=t.localUsermediaFeed)||void 0===n?void 0:n.setAudioVideoMuted(e,null)}));var i=function(){var e=(0,r.A)((function*(){var e=[];t.forEachCall((t=>e.push(t.sendMetadataUpdate()))),yield Promise.all(e).catch((e=>c.v.info("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),e)))}));return function(){return e.apply(this,arguments)}}();if(n&&(yield i()),t.localCallFeed){if(c.v.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() (streamId=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")")),!(yield t.checkAudioPermissionIfNecessary(e)))return!1;t.localCallFeed.setAudioVideoMuted(e,null),(0,s.ms)(t.localCallFeed.stream.getAudioTracks(),!e)}else c.v.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),t.initWithAudioMuted=e;return t.forEachCall((n=>(0,s.ms)(n.localUsermediaFeed.stream.getAudioTracks(),!e&&t.callExpected(n)))),t.emit($.LocalMuteStateChanged,e,t.isLocalVideoMuted()),n||(yield i()),!0}))()}checkAudioPermissionIfNecessary(e){var t=this;return(0,r.A)((function*(){try{if(!e&&t.localCallFeed&&!t.localCallFeed.hasAudioTrack){var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!t.localCallFeed.isVideoMuted());if(0===(null==n?void 0:n.getTracks().length))return c.v.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch(n){return c.v.log("GroupCall ".concat(t.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0}))()}setLocalVideoMuted(e){var t=this;return(0,r.A)((function*(){if(!e&&!(yield t.client.getMediaHandler().hasVideoDevice()))return!1;if(t.localCallFeed){c.v.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() (stream=").concat(t.localCallFeed.stream.id,", muted=").concat(e,")"));try{var n=yield t.client.getMediaHandler().getUserMediaStream(!0,!e);yield t.updateLocalUsermediaStream(n),t.localCallFeed.setAudioVideoMuted(null,e),(0,s.ms)(t.localCallFeed.stream.getVideoTracks(),!e)}catch(n){return c.v.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else c.v.log("GroupCall ".concat(t.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),t.initWithVideoMuted=e;var r=[];return t.forEachCall((t=>r.push(t.setLocalVideoMuted(e)))),yield Promise.all(r),t.forEachCall((n=>(0,s.ms)(n.localUsermediaFeed.stream.getVideoTracks(),!e&&t.callExpected(n)))),t.emit($.LocalMuteStateChanged,t.isMicrophoneMuted(),e),!0}))()}setScreensharingEnabled(e){var t=arguments,n=this;return(0,r.A)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{};if(e===n.isScreensharing())return e;if(!e)return n.forEachCall((e=>{e.localScreensharingFeed&&e.removeLocalFeed(e.localScreensharingFeed)})),n.client.getMediaHandler().stopScreensharingStream(n.localScreenshareFeed.stream),n.removeScreenshareFeed(n.localScreenshareFeed),n.localScreenshareFeed=void 0,n.localDesktopCapturerSourceId=void 0,n.emit($.LocalScreenshareStateChanged,!1,void 0,void 0),!1;try{c.v.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var i=yield n.client.getMediaHandler().getScreensharingStream(r),o=function*(e){var t=()=>{n.setScreensharingEnabled(!1),e.removeEventListener("ended",t)};e.addEventListener("ended",t)};for(var s of i.getTracks())yield*o(s);return c.v.log("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),n.localDesktopCapturerSourceId=r.desktopCapturerSourceId,n.localScreenshareFeed=new a.Hh({client:n.client,roomId:n.room.roomId,userId:n.client.getUserId(),deviceId:n.client.getDeviceId(),stream:i,purpose:u.h.Screenshare,audioMuted:!1,videoMuted:!1}),n.addScreenshareFeed(n.localScreenshareFeed),n.emit($.LocalScreenshareStateChanged,!0,n.localScreenshareFeed,n.localDesktopCapturerSourceId),n.forEachCall((e=>e.pushLocalFeed(n.localScreenshareFeed.clone()))),!0}catch(e){if(r.throwOnFail)throw e;return c.v.error("GroupCall ".concat(n.groupCallId," setScreensharingEnabled() enabling screensharing error"),e),n.emit($.Error,new K(j.NoUserMedia,"Failed to get screen-sharing stream: ",e)),!1}}))()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,t){var n=this.client.getUserId(),r=this.client.getDeviceId();return e>=n&&(e!==n||t>r)}placeOutgoingCalls(){var e=this,t=!1,n=function(n){var r,o=null!==(r=e.calls.get(n))&&void 0!==r?r:new Map,a=function(r){var i=o.get(r);if((null==i?void 0:i.getOpponentSessionId())!==d.sessionId&&e.wantsOutgoingCall(n,r)){t=!0,void 0!==i&&(c.v.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(n,", deviceId=").concat(r,", callId=").concat(i.callId,")")),i.hangup(s.Il.NewSession,!1));var a=(0,s.sv)(e.client,e.room.roomId,{invitee:n,opponentDeviceId:r,opponentSessionId:d.sessionId,groupCallId:e.groupCallId});null===a?(c.v.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(n,", device=").concat(r,")")),o.delete(r)):(e.initCall(a),o.set(r,a),c.v.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(n,", deviceId=").concat(r,", sessionId=").concat(d.sessionId,")")),a.placeCallWithCallFeeds(e.getLocalFeeds().map((e=>e.clone())),d.screensharing).then((()=>{e.dataChannelsEnabled&&a.createDataChannel("datachannel",e.dataChannelOptions)})).catch((t=>{c.v.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(n,")"),t),t instanceof s.RA&&t.code===j.UnknownDevice?e.emit($.Error,t):e.emit($.Error,new K(j.PlaceCallFailed,"Failed to place call to ".concat(n))),a.hangup(s.Il.SignallingFailed,!1),o.get(r)===a&&o.delete(r)})))}};for(var[l,d]of i)a(l);o.size>0?e.calls.set(n,o):e.calls.delete(n)};for(var[{userId:r},i]of this.participants)n(r);t&&this.emit($.CallsChanged,this.calls)}getMemberStateEvents(e){return void 0===e?this.room.currentState.getStateEvents(h.Bx.GroupCallMemberPrefix):this.room.currentState.getStateEvents(h.Bx.GroupCallMemberPrefix,e)}initCall(e){var t=H(e);if(!t)throw new Error("Cannot init call without user id");var n=()=>this.onCallFeedsChanged(e),r=(t,n)=>this.onCallStateChanged(e,t,n),i=this.onCallHangup,o=t=>this.onCallReplaced(e,t),a=this.callHandlers.get(t);void 0===a&&(a=new Map,this.callHandlers.set(t,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:n,onCallStateChanged:r,onCallHangup:i,onCallReplaced:o}),e.on(s.$E.FeedsChanged,n),e.on(s.$E.State,r),e.on(s.$E.Hangup,i),e.on(s.$E.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(s.$E)),e.initStats(this.getGroupCallStats()),n()}disposeCall(e,t){var n=H(e),r=e.getOpponentDeviceId();if(!n)throw new Error("Cannot dispose call without user id");var i=this.callHandlers.get(n),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:l,onCallReplaced:c}=i.get(r);if(e.removeListener(s.$E.FeedsChanged,o),e.removeListener(s.$E.State,a),e.removeListener(s.$E.Hangup,l),e.removeListener(s.$E.Replaced,c),i.delete(n),0===i.size&&this.callHandlers.delete(n),e.hangupReason!==s.Il.Replaced){var d=this.getUserMediaFeed(n,r);d&&this.removeUserMediaFeed(d);var u=this.getScreenshareFeed(n,r);u&&this.removeScreenshareFeed(u)}}getUserMediaFeed(e,t){return this.userMediaFeeds.find((n=>n.userId===e&&n.deviceId===t))}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit($.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,t){var n=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===n)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(n,1,t),e.dispose(),t.measureVolumeActivity(!0),this.emit($.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var t=this.userMediaFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(t,1),e.dispose(),this.emit($.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit($.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,t){return this.screenshareFeeds.find((n=>n.userId===e&&n.deviceId===t))}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit($.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,t){var n=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===n)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(n,1,t),e.dispose(),this.emit($.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var t=this.screenshareFeeds.findIndex((t=>t.userId===e.userId&&t.deviceId===e.deviceId));if(-1===t)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(t,1),e.dispose(),this.emit($.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(e)if(null!==this.participantsExpirationTimer&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state!==q.Ended){var t=new Map,n=Date.now(),r=this.state===q.Entered||this.enteredViaAnotherSession,i=1/0;for(var o of this.getMemberStateEvents()){var a=this.room.getMember(o.getStateKey()),s=o.getContent(),l=(Array.isArray(s["m.calls"])?s["m.calls"]:[]).find((e=>e["m.call_id"]===this.groupCallId)),d=(Array.isArray(null==l?void 0:l["m.devices"])?l["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>n&&Array.isArray(e.feeds)));if(r||(null==a?void 0:a.userId)!==this.client.getUserId()||(d=d.filter((e=>e.device_id!==this.client.getDeviceId()))),d.length>0&&(null==a?void 0:a.membership)===P.O.Join){var h=new Map;for(var p of(t.set(a,h),d))h.set(p.device_id,{sessionId:p.session_id,screensharing:p.feeds.some((e=>e.purpose===u.h.Screenshare))}),p.expires_ts<i&&(i=p.expires_ts)}}if(r){var v=t.get(e);void 0===v&&(v=new Map,t.set(e,v)),v.has(this.client.getDeviceId())||v.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some((e=>e.purpose===u.h.Screenshare))})}this.participants=t,i<1/0&&(this.participantsExpirationTimer=setTimeout((()=>this.updateParticipants()),i-n))}else this.participants=new Map;else c.v.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"))}updateDevices(e){var t=arguments,n=this;return(0,r.A)((function*(){var r,i=t.length>1&&void 0!==t[1]&&t[1],o=Date.now(),a=n.client.getUserId(),s=n.getMemberStateEvents(a),l=null!==(r=null==s?void 0:s.getContent())&&void 0!==r?r:{},c=Array.isArray(l["m.calls"])?l["m.calls"]:[],d=null,u=[];for(var p of c)p["m.call_id"]===n.groupCallId?d=p:u.push(p);null===d&&(d={});var v=(Array.isArray(d["m.devices"])?d["m.devices"]:[]).filter((e=>"string"==typeof e.device_id&&"string"==typeof e.session_id&&"number"==typeof e.expires_ts&&e.expires_ts>o&&Array.isArray(e.feeds))),m=e(v);if(null!==m){var g=[...u];m.length>0&&g.push(U(U({},d),{},{"m.call_id":n.groupCallId,"m.devices":m}));var f={"m.calls":g};yield n.client.sendStateEvent(n.room.roomId,h.Bx.GroupCallMemberPrefix,f,a,{keepAlive:i})}}))()}addDeviceToMemberState(){var e=this;return(0,r.A)((function*(){yield e.updateDevices((t=>[...t.filter((t=>t.device_id!==e.client.getDeviceId())),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+36e5,feeds:e.getLocalFeeds().map((e=>({purpose:e.purpose})))}]))}))()}updateMemberState(){var e=this;return(0,r.A)((function*(){null!==e.resendMemberStateTimer&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===q.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval((0,r.A)((function*(){c.v.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(t){c.v.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),t)}})),27e5)):yield e.updateDevices((t=>t.filter((t=>t.device_id!==e.client.getDeviceId()))),!0)}))()}cleanMemberState(){var e=this;return(0,r.A)((function*(){var{devices:t}=yield e.client.getDevices(),n=new Map(t.map((e=>[e.device_id,e])));yield e.updateDevices((t=>{var r=t.filter((t=>{var r=n.get(t.device_id);return void 0!==(null==r?void 0:r.last_seen_ts)&&!(t.device_id===e.client.getDeviceId()&&e.state!==q.Entered&&!e.enteredViaAnotherSession)}));return r.length===t.length?null:r}))}))()}getGroupCallStats(){if(void 0===this.stats){var e=this.client.getUserId()||"unknown";this.stats=new L(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(x.I.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(x.I.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(x.I.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(x.I.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,void 0!==this.stats&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}},4377:(e,t,n)=>{"use strict";n.d(t,{e:()=>h,o:()=>u});var r=n(467),i=n(4980),o=n(4792),a=n(2958),s=n(6122),l=n(3840),c=n(2986),d=n(6459),u=function(e){return e.Incoming="GroupCall.incoming",e.Outgoing="GroupCall.outgoing",e.Ended="GroupCall.ended",e.Participants="GroupCall.participants",e}({});class h{constructor(e){this.client=e,(0,i.A)(this,"groupCalls",new Map),(0,i.A)(this,"roomDeferreds",new Map),(0,i.A)(this,"onRoomsChanged",(e=>{this.createGroupCallForRoom(e)})),(0,i.A)(this,"onRoomStateChanged",((e,t)=>{if(e.getType()===c.Bx.GroupCallPrefix){var n=e.getStateKey(),r=e.getContent(),i=this.groupCalls.get(t.roomId);i||r["m.terminated"]||e.isRedacted()?i&&i.groupCallId===n?r["m.terminated"]||e.isRedacted()?i.terminate(!1):r["m.type"]!==i.type&&l.v.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(t.roomId,")")):i&&i.groupCallId!==n&&l.v.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(t.roomId,")")):this.createGroupCallFromRoomStateEvent(e)}}))}start(){var e=this;return(0,r.A)((function*(){e.client.getSyncState()!==d.Lm.Syncing&&(l.v.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise((t=>{var n=()=>{if(e.client.getSyncState()===d.Lm.Syncing)return e.client.off(o.AU.Sync,n),t()};e.client.on(o.AU.Sync,n)})));var t=e.client.getRooms();for(var n of t)e.createGroupCallForRoom(n);e.client.on(o.AU.Room,e.onRoomsChanged),e.client.on(s.f.Events,e.onRoomStateChanged)}))()}stop(){this.client.removeListener(o.AU.Room,this.onRoomsChanged),this.client.removeListener(s.f.Events,this.onRoomStateChanged)}getRoomDeferred(e){var t,n=this.roomDeferreds.get(e);return void 0===n&&((n={prom:new Promise((e=>{t=e}))}).resolve=t,this.roomDeferreds.set(e,n)),n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find((t=>t.groupCallId===e))}createGroupCallForRoom(e){var t=e.currentState.getStateEvents(c.Bx.GroupCallPrefix),n=t.sort(((e,t)=>t.getTs()-e.getTs()));for(var r of n)if(!r.getContent()["m.terminated"]&&!r.isRedacted()){l.v.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(r.getStateKey(),", ts=").concat(r.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(t.length,")")),this.createGroupCallFromRoomStateEvent(r);break}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var t=e.getRoomId(),n=e.getContent(),r=this.client.getRoom(t);if(r){var i=e.getStateKey(),o=n["m.type"];if(Object.values(a.Ad).includes(o)){var s=n["m.intent"];if(Object.values(a.MC).includes(s)){var c,d=Boolean(n["io.element.ptt"]);if(null!=n&&n.dataChannelsEnabled&&null!=n&&n.dataChannelOptions){var{ordered:h,maxPacketLifeTime:p,maxRetransmits:v,protocol:m}=n.dataChannelOptions;c={ordered:h,maxPacketLifeTime:p,maxRetransmits:v,protocol:m}}var g=new a.eO(this.client,r,o,d,s,i,(null==n?void 0:n.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,c,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,n["io.element.livekit_service_url"]);return this.groupCalls.set(r.roomId,g),this.client.emit(u.Incoming,g),g}l.v.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(t,")"))}else l.v.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(t,")"))}else l.v.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(t,")"))}}},9372:(e,t,n)=>{"use strict";n.d(t,{L:()=>c,d:()=>l});var r=n(467),i=n(4980),o=n(6387),a=n(2958),s=n(3840),l=function(e){return e.LocalStreamsChanged="local_streams_changed",e}({});class c extends o.X{constructor(e){super(),this.client=e,(0,i.A)(this,"audioInput",void 0),(0,i.A)(this,"audioSettings",void 0),(0,i.A)(this,"videoInput",void 0),(0,i.A)(this,"localUserMediaStream",void 0),(0,i.A)(this,"userMediaStreams",[]),(0,i.A)(this,"screensharingStreams",[]),(0,i.A)(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,t){this.audioInput=e,this.videoInput=t}setAudioInput(e){var t=this;return(0,r.A)((function*(){s.v.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),t.audioInput!==e&&(t.audioInput=e,yield t.updateLocalUsermediaStreams())}))()}setAudioSettings(e){var t=this;return(0,r.A)((function*(){s.v.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),t.audioSettings=Object.assign({},e),yield t.updateLocalUsermediaStreams()}))()}setVideoInput(e){var t=this;return(0,r.A)((function*(){s.v.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),t.videoInput!==e&&(t.videoInput=e,yield t.updateLocalUsermediaStreams())}))()}setMediaInputs(e,t){var n=this;return(0,r.A)((function*(){s.v.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(t,")")),n.audioInput=e,n.videoInput=t,yield n.updateLocalUsermediaStreams()}))()}updateLocalUsermediaStreams(){var e=this;return(0,r.A)((function*(){if(0!==e.userMediaStreams.length){var t=new Map;for(var n of e.client.callEventHandler.calls.values())t.set(n.callId,{audio:n.hasLocalUserMediaAudioTrack,video:n.hasLocalUserMediaVideoTrack});for(var r of e.userMediaStreams)for(var i of(s.v.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(r.id,")")),r.getTracks()))i.stop();for(var o of(e.userMediaStreams=[],e.localUserMediaStream=void 0,e.client.callEventHandler.calls.values()))if(!o.callHasEnded()&&t.has(o.callId)){var{audio:c,video:d}=t.get(o.callId);s.v.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var u=yield e.getUserMediaStream(c,d);o.callHasEnded()||(yield o.updateLocalUsermediaStream(u))}for(var h of e.client.groupCallEventHandler.groupCalls.values())if(h.localCallFeed){s.v.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(h.groupCallId,")"));var p=yield e.getUserMediaStream(!0,h.type===a.Ad.Video);h.state!==a.F_.Ended&&(yield h.updateLocalUsermediaStream(p))}e.emit(l.LocalStreamsChanged)}}))()}hasAudioDevice(){return(0,r.A)((function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)).length>0}catch(e){return s.v.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}))()}hasVideoDevice(){return(0,r.A)((function*(){try{return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}catch(e){return s.v.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}))()}getUserMediaStream(e,t){var n=arguments,i=this;return(0,r.A)((function*(){var r=!(n.length>2&&void 0!==n[2])||n[2];return i.getMediaStreamPromise?i.getMediaStreamPromise=i.getMediaStreamPromise.then((()=>i.getUserMediaStreamInternal(e,t,r))):i.getMediaStreamPromise=i.getUserMediaStreamInternal(e,t,r),i.getMediaStreamPromise}))()}getUserMediaStreamInternal(e,t,n){var i=this;return(0,r.A)((function*(){var r,o,a,c=e&&(yield i.hasAudioDevice()),d=t&&(yield i.hasVideoDevice()),u=!0;if(i.localUserMediaStream?(c!==i.localUserMediaStream.getAudioTracks().length>0&&(u=!1),d!==i.localUserMediaStream.getVideoTracks().length>0&&(u=!1),c&&(null===(o=i.localUserMediaStream.getAudioTracks()[0])||void 0===o||null===(o=o.getSettings())||void 0===o?void 0:o.deviceId)!==i.audioInput&&(u=!1),d&&(null===(a=i.localUserMediaStream.getVideoTracks()[0])||void 0===a||null===(a=a.getSettings())||void 0===a?void 0:a.deviceId)!==i.videoInput&&(u=!1)):u=!1,u){var h;if(r=i.localUserMediaStream.clone(),s.v.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat(null===(h=i.localUserMediaStream)||void 0===h?void 0:h.id," newStreamId=").concat(r.id," shouldRequestAudio=").concat(c," shouldRequestVideo=").concat(d,")")),!c)for(var p of r.getAudioTracks())r.removeTrack(p);if(!d)for(var v of r.getVideoTracks())r.removeTrack(v)}else{var m=i.getUserMediaContraints(c,d);for(var g of(r=yield navigator.mediaDevices.getUserMedia(m),s.v.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(r.id,", shouldRequestAudio=").concat(c,", shouldRequestVideo=").concat(d,", constraints=").concat(JSON.stringify(m),")")),r.getTracks())){var f=g.getSettings();"audio"===g.kind?i.audioInput=f.deviceId:"video"===g.kind&&(i.videoInput=f.deviceId)}n&&(i.localUserMediaStream=r)}return n&&i.userMediaStreams.push(r),i.emit(l.LocalStreamsChanged),r}))()}stopUserMediaStream(e){for(var t of(s.v.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.userMediaStreams.indexOf(e);if(-1!==n&&(s.v.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(n,1)),this.emit(l.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var r of e.getTracks()){var i;if(null!==(i=this.localUserMediaStream)&&void 0!==i&&i.getTrackById(r.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,t=this;return(0,r.A)((function*(){var n,r=e.length>0&&void 0!==e[0]?e[0]:{},i=!(e.length>1&&void 0!==e[1])||e[1];if(0===t.screensharingStreams.length){var o=t.getScreenshareContraints(r);r.desktopCapturerSourceId?(s.v.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getUserMedia(o)):(s.v.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),n=yield navigator.mediaDevices.getDisplayMedia(o))}else{var a=t.screensharingStreams[t.screensharingStreams.length-1];s.v.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(a.id,")")),n=a.clone()}return i&&t.screensharingStreams.push(n),t.emit(l.LocalStreamsChanged),n}))()}stopScreensharingStream(e){for(var t of(s.v.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")")),e.getTracks()))t.stop();var n=this.screensharingStreams.indexOf(e);-1!==n&&(s.v.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(n,1)),this.emit(l.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams)for(var t of(s.v.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")")),e.getTracks()))t.stop();for(var n of this.screensharingStreams)for(var r of n.getTracks())r.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(l.LocalStreamsChanged)}getUserMediaContraints(e,t){var n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){var{desktopCapturerSourceId:t,audio:n}=e;return t?{audio:null!=n&&n,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t}}}:{audio:null!=n&&n,video:!0}}}},6695:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});var r=function(e){return e.CONNECTION_STATS="StatsReport.connection_stats",e.CALL_FEED_REPORT="StatsReport.call_feed_report",e.BYTE_SENT_STATS="StatsReport.byte_sent_stats",e.SUMMARY_STATS="StatsReport.summary_stats",e}({})},7045:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});const r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i;const o=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));const s=function(e,t,n){if(r.randomUUID&&!t&&!e)return r.randomUUID();const s=(e=e||{}).random??e.rng?.()??function(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(o)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=s[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(s)}},144:e=>{"use strict";e.exports=JSON.parse('{"0":"O","1":"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ","ﱞ":"ﹲّ","ࣲ":"ٍ","ﱟ":"ﹴّ","ﳲ":"ﹷّ","ﱠ":"ﹶّ","ﳳ":"ﹹّ","ﱡ":"ﹸّ","ؚ":"ِ","̗":"ِ","ﳴ":"ﹻّ","ﱢ":"ﹺّ","ﱣ":"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\\u2028":" ","\\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":","ː":":","ꓽ":":","⩴":"::=","⧴":":→","！":"!","ǃ":"!","ⵑ":"!","‼":"!!","⁉":"!?","ʔ":"?","Ɂ":"?","ॽ":"?","Ꭾ":"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·","ᐧ":"·","⋯":"···","ⵈ":"···","ᑄ":"·<","⋗":"·>","ᐷ":"·>","ᑀ":"·>","ᔯ":"·4","ᑾ":"·b","ᒀ":"·ḃ","ᑺ":"·d","ᒘ":"·J","ᒶ":"·L","ᑶ":"·P","ᑗ":"·U","ᐺ":"·V","ᐼ":"·Ʌ","ᒮ":"·Γ","ᐎ":"·Δ","ᑙ":"·Ո","ᐌ":"·ᐁ","ᐐ":"·ᐄ","ᐒ":"·ᐅ","ᐔ":"·ᐆ","ᐗ":"·ᐊ","ᐙ":"·ᐋ","ᐾ":"·ᐲ","ᑂ":"·ᐴ","ᑆ":"·ᐹ","ᑛ":"·ᑏ","ᑔ":"·ᑐ","ᑝ":"·ᑐ","ᑟ":"·ᑑ","ᑡ":"·ᑕ","ᑣ":"·ᑖ","ᑴ":"·ᑫ","ᑸ":"·ᑮ","ᑼ":"·ᑰ","ᒒ":"·ᒉ","ᒔ":"·ᒋ","ᒖ":"·ᒌ","ᒚ":"·ᒎ","ᒜ":"·ᒐ","ᒞ":"·ᒑ","ᒬ":"·ᒣ","ᒰ":"·ᒦ","ᒲ":"·ᒧ","ᒴ":"·ᒨ","ᒸ":"·ᒫ","ᓉ":"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ","ᓋ":"·ᓇ","ᓍ":"·ᓈ","ᓜ":"·ᓓ","ᓞ":"·ᓕ","ᓠ":"·ᓖ","ᓢ":"·ᓗ","ᓤ":"·ᓘ","ᓦ":"·ᓚ","ᓨ":"·ᓛ","ᓶ":"·ᓭ","ᓸ":"·ᓯ","ᓺ":"·ᓰ","ᓼ":"·ᓱ","ᓾ":"·ᓲ","ᔀ":"·ᓴ","ᔂ":"·ᓵ","ᔗ":"·ᔐ","ᔙ":"·ᔑ","ᔛ":"·ᔒ","ᔝ":"·ᔓ","ᔟ":"·ᔔ","ᔡ":"·ᔕ","ᔣ":"·ᔖ","ᔱ":"·ᔨ","ᔳ":"·ᔩ","ᔵ":"·ᔪ","ᔷ":"·ᔫ","ᔹ":"·ᔭ","ᔻ":"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ","ᕎ":"·ᕌ","ᕛ":"·ᕚ","ᕨ":"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"\'","＇":"\'","‘":"\'","’":"\'","‛":"\'","′":"\'","‵":"\'","՚":"\'","׳":"\'","`":"\'","`":"\'","｀":"\'","´":"\'","΄":"\'","´":"\'","᾽":"\'","᾿":"\'","῾":"\'","ʹ":"\'","ʹ":"\'","ˈ":"\'","ˊ":"\'","ˋ":"\'","˴":"\'","ʻ":"\'","ʽ":"\'","ʼ":"\'","ʾ":"\'","ꞌ":"\'","י":"\'","ߴ":"\'","ߵ":"\'","ᑊ":"\'","ᛌ":"\'","𖽑":"\'","𖽒":"\'","᳓":"\'\'","\\"":"\'\'","＂":"\'\'","“":"\'\'","”":"\'\'","‟":"\'\'","″":"\'\'","‶":"\'\'","〃":"\'\'","״":"\'\'","˝":"\'\'","ʺ":"\'\'","˶":"\'\'","ˮ":"\'\'","ײ":"\'\'","‴":"\'\'\'","‷":"\'\'\'","⁗":"\'\'\'\'","Ɓ":"\'B","Ɗ":"\'D","ŉ":"\'n","Ƥ":"\'P","Ƭ":"\'T","Ƴ":"\'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬","く":"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/","〳":"/","Ⳇ":"/","ノ":"/","丿":"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\\\","﹨":"\\\\","∖":"\\\\","⟍":"\\\\","⧵":"\\\\","⧹":"\\\\","𝈏":"\\\\","𝈻":"\\\\","㇔":"\\\\","丶":"\\\\","⼂":"\\\\","⳹":"\\\\\\\\","⑊":"\\\\\\\\","⟈":"\\\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ","ъ":"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵","ð":"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<","ᐸ":"<","ᚲ":"<","⋖":"<·","Ⲵ":"<·","ᑅ":"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">","ᐳ":">","𖼿":">","ᑁ":">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー","ᅳ":"ー","ㅡ":"ー","一":"ー","⼀":"ー","ᆖ":"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ","ᆕ":"ーᅮ","ᅴ":"ー丨","ㅢ":"ー丨","ᆗ":"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2","Ƨ":"2","Ϩ":"2","Ꙅ":"2","ᒿ":"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁","ƻ":"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3","Ȝ":"3","Ʒ":"3","Ꝫ":"3","Ⳍ":"3","З":"3","Ӡ":"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂","Ҙ":"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4","Ꮞ":"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.","ᔰ":"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5","Ƽ":"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6","б":"6","Ꮾ":"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8","ȣ":"8","Ȣ":"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a","ａ":"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a","ɑ":"a","α":"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a","а":"a","ⷶ":"ͣ","Ａ":"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A","Α":"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A","А":"A","Ꭺ":"A","ᗅ":"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲","ǎ":"ă","Ǎ":"Ă","ȧ":"å","Ȧ":"Å","ẚ":"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA","æ":"ae","ӕ":"ae","Æ":"AE","Ӕ":"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ","ᗄ":"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b","Ƅ":"b","Ь":"b","Ꮟ":"b","ᑲ":"b","ᖯ":"b","Ｂ":"B","ℬ":"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B","Β":"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B","В":"B","Ᏼ":"B","ᗷ":"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B","ɓ":"b̔","ᑳ":"ḃ","ƃ":"b̄","Ƃ":"b̄","Б":"b̄","ƀ":"b̵","ҍ":"b̵","Ҍ":"b̵","ѣ":"b̵","Ѣ":"b̵","ᑿ":"b·","ᒁ":"ḃ·","ᒈ":"b\'","Ы":"bl","в":"ʙ","ᏼ":"ʙ","ｃ":"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c","ϲ":"c","ⲥ":"c","с":"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C","Ｃ":"C","Ⅽ":"C","ℂ":"C","ℭ":"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C","С":"C","Ꮯ":"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠","ç":"c̦","ҫ":"c̦","Ç":"C̦","Ҫ":"C̦","Ƈ":"C\'","℅":"c/o","℆":"c/u","🅭":"㏄\\t⃝","⋴":"ꞓ","ɛ":"ꞓ","ε":"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ","є":"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ","Є":"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d","Ꮷ":"d","ᑯ":"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D","Ꭰ":"D","ᗞ":"D","ᗪ":"D","ꓓ":"D","ɗ":"d̔","ɖ":"d̨","ƌ":"d̄","đ":"d̵","Đ":"D̵","Ð":"D̵","Ɖ":"D̵","₫":"ḏ̵","ꝺ":"Ꝺ","ᑻ":"d·","ᒇ":"d\'","ʤ":"dȝ","ǳ":"dz","ʣ":"dz","ǲ":"Dz","Ǳ":"DZ","ǆ":"dž","ǅ":"Dž","Ǆ":"DŽ","ʥ":"dʑ","ꭰ":"ᴅ","⸹":"ẟ","δ":"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ","ծ":"ẟ","ᕷ":"ẟ","℮":"e","ｅ":"e","ℯ":"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e","е":"e","ҽ":"e","ⷷ":"ͤ","⋿":"E","Ｅ":"E","ℰ":"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E","Ε":"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E","Е":"E","ⴹ":"E","Ꭼ":"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E","ě":"ĕ","Ě":"Ĕ","ɇ":"e̸","Ɇ":"E̸","ҿ":"ę","ꭼ":"ᴇ","ə":"ǝ","ә":"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ","ɚ":"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵","Ә":"Ə","𝈡":"Ɛ","ℇ":"Ɛ","Ԑ":"Ɛ","Ꮛ":"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ","з":"ɜ","ҙ":"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f","ſ":"f","ẝ":"f","ք":"f","𝈓":"F","ℱ":"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F","Ϝ":"F","𝟊":"F","ᖴ":"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F","ƒ":"f̦","Ƒ":"F̦","ᵮ":"f̴","℻":"FAX","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ʩ":"fŋ","ᖵ":"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ","ᖷ":"ꟻ","ｇ":"g","ℊ":"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g","ɡ":"g","ᶃ":"g","ƍ":"g","ց":"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G","Ꮐ":"G","Ᏻ":"G","ꓖ":"G","ᶢ":"ᵍ","ɠ":"g̔","ǧ":"ğ","Ǧ":"Ğ","ǵ":"ģ","ǥ":"g̵","Ǥ":"G̵","Ɠ":"G\'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ","ｈ":"h","ℎ":"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h","һ":"h","հ":"h","Ꮒ":"h","Ｈ":"H","ℋ":"H","ℌ":"H","ℍ":"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H","Η":"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H","Н":"H","Ꮋ":"H","ᕼ":"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ","ɦ":"h̔","ꚕ":"h̔","Ᏺ":"h̔","Ⱨ":"H̩","Ң":"H̩","ħ":"h̵","ℏ":"h̵","ћ":"h̵","Ħ":"H̵","Ӊ":"H̦","Ӈ":"H̦","н":"ʜ","ꮋ":"ʜ","ң":"ʜ̩","ӊ":"ʜ̦","ӈ":"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ","Ꭸ":"Ⱶ","Ꮀ":"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i","ｉ":"i","ⅰ":"i","ℹ":"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i","ı":"i","𝚤":"i","ɪ":"i","ɩ":"i","ι":"i","ι":"i","ͺ":"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i","і":"i","ꙇ":"i","ӏ":"i","ꭵ":"i","Ꭵ":"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲","ǐ":"ĭ","Ǐ":"Ĭ","ɨ":"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii","ĳ":"ij","ⅳ":"iv","ⅸ":"ix","ｊ":"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j","ϳ":"j","ј":"j","Ｊ":"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J","Ј":"J","Ꭻ":"J","ᒍ":"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵","ᒙ":"J·","𝚥":"ȷ","յ":"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k","K":"K","Ｋ":"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K","Κ":"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K","К":"K","Ꮶ":"K","ᛕ":"K","ꓗ":"K","𐔘":"K","ƙ":"k̔","Ⱪ":"K̩","Қ":"K̩","₭":"K̵","Ꝁ":"K̵","Ҟ":"K̵","Ƙ":"K\'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l","I":"l","Ｉ":"l","Ⅰ":"l","ℐ":"l","ℑ":"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l","Ɩ":"l","ｌ":"l","ⅼ":"l","ℓ":"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l","ǀ":"l","Ι":"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l","І":"l","Ӏ":"l","ו":"l","ן":"l","ا":"l","𞸀":"l","𞺀":"l","ﺎ":"l","ﺍ":"l","ߊ":"l","ⵏ":"l","ᛁ":"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L","ℒ":"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L","Ꮮ":"L","ᒪ":"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L","ﴼ":"l̋","ﴽ":"l̋","ł":"l̸","Ł":"L̸","ɭ":"l̨","Ɨ":"l̵","ƚ":"l̵","ɫ":"l̴","إ":"lٕ","ﺈ":"lٕ","ﺇ":"lٕ","ٳ":"lٕ","ŀ":"l·","Ŀ":"l·","ᒷ":"l·","🄂":"l,","⒈":"l.","ױ":"l\'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点","ǉ":"lj","Ĳ":"lJ","ǈ":"Lj","Ǉ":"LJ","‖":"ll","∥":"ll","Ⅱ":"ll","ǁ":"ll","װ":"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点","Ю":"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点","ʪ":"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX","ɮ":"lȝ","ʫ":"lz","أ":"lٴ","ﺄ":"lٴ","ﺃ":"lٴ","ٲ":"lٴ","ٵ":"lٴ","ﷳ":"lكبر","ﷲ":"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ","Ｍ":"M","Ⅿ":"M","ℳ":"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M","Μ":"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M","М":"M","Ꮇ":"M","ᗰ":"M","ᛖ":"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n","ո":"n","ռ":"n","Ｎ":"N","ℕ":"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N","Ν":"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊","ɳ":"n̨","ƞ":"n̩","η":"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩","Ɲ":"N̦","ᵰ":"n̴","ǌ":"nj","ǋ":"Nj","Ǌ":"NJ","№":"No","ͷ":"ᴎ","и":"ᴎ","𐑍":"ᴎ","ņ":"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o","ｏ":"o","ℴ":"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o","ο":"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o","σ":"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o","о":"o","ჿ":"o","օ":"o","ס":"o","ه":"o","𞸤":"o","𞹤":"o","𞺄":"o","ﻫ":"o","ﻬ":"o","ﻪ":"o","ﻩ":"o","ھ":"o","ﮬ":"o","ﮭ":"o","ﮫ":"o","ﮪ":"o","ہ":"o","ﮨ":"o","ﮩ":"o","ﮧ":"o","ﮦ":"o","ە":"o","ഠ":"o","ဝ":"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O","Ｏ":"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O","Ο":"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O","О":"O","Օ":"O","ⵔ":"O","ዐ":"O","ଠ":"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º","ǒ":"ŏ","Ǒ":"Ŏ","ۿ":"ô","Ő":"Ö","ø":"o̸","ꬾ":"o̸","Ø":"O̸","ⵁ":"O̸","Ǿ":"Ó̸","ɵ":"o̵","ꝋ":"o̵","ө":"o̵","ѳ":"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵","Ɵ":"O̵","Ꝋ":"O̵","θ":"O̵","ϑ":"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵","Θ":"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵","Ө":"O̵","Ѳ":"O̵","ⴱ":"O̵","Ꮎ":"O̵","Ꮻ":"O̵","ꭴ":"ơ","ﳙ":"oٰ","🄁":"O,","🄀":"O.","ơ":"o\'","Ơ":"O\'","Ꭴ":"O\'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀","œ":"oe","Œ":"OE","ɶ":"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO","ﳗ":"oج","ﱑ":"oج","ﳘ":"oم","ﱒ":"oم","ﶓ":"oمج","ﶔ":"oمم","ﱓ":"oى","ﱔ":"oى","ൟ":"oരo","တ":"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p","ｐ":"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p","ρ":"p","ϱ":"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p","р":"p","Ｐ":"P","ℙ":"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P","Ρ":"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P","Р":"P","Ꮲ":"P","ᑭ":"P","ꓑ":"P","𐊕":"P","ƥ":"p̔","ᵽ":"p̵","ᑷ":"p·","ᒆ":"P\'","ᴩ":"ᴘ","ꮲ":"ᴘ","φ":"ɸ","ϕ":"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ","ф":"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q","գ":"q","զ":"q","ℚ":"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q","ʠ":"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ","κ":"ĸ","ϰ":"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ","к":"ĸ","ꮶ":"ĸ","қ":"ĸ̩","ҟ":"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r","г":"r","ꮁ":"r","𝈖":"R","ℛ":"R","ℜ":"R","ℝ":"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R","Ʀ":"R","Ꭱ":"R","Ꮢ":"R","𐒴":"R","ᖇ":"R","ꓣ":"R","𖼵":"R","ɽ":"r̨","ɼ":"r̩","ɍ":"r̵","ғ":"r̵","ᵲ":"r̴","ґ":"r\'","𑣣":"rn","m":"rn","ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸","ɱ":"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ","я":"ᴙ","ᵳ":"ɾ̴","℩":"ɿ","ｓ":"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s","ƽ":"s","ѕ":"s","ꮪ":"s","𑣁":"s","𐑈":"s","Ｓ":"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S","Ѕ":"S","Տ":"S","Ꮥ":"S","Ꮪ":"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S","ʂ":"s̨","ᵴ":"s̴","ꞵ":"ß","β":"ß","ϐ":"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß","Ᏸ":"ß","🝜":"sss","ﬆ":"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ","Σ":"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T","Ｔ":"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T","Τ":"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T","Т":"T","Ꭲ":"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T","ƭ":"t̔","⍡":"T̈","Ⱦ":"T̸","Ț":"Ţ","Ʈ":"T̨","Ҭ":"T̩","₮":"T⃫","ŧ":"t̵","Ŧ":"T̵","ᵵ":"t̴","Ⴀ":"Ꞇ","Ꜩ":"T3","ʨ":"tɕ","℡":"TEL","ꝷ":"tf","ʦ":"ts","ʧ":"tʃ","ꜩ":"tȝ","τ":"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ","т":"ᴛ","ꭲ":"ᴛ","ҭ":"ᴛ̩","ţ":"ƫ","ț":"ƫ","Ꮏ":"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u","ʋ":"u","υ":"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u","ս":"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U","Ս":"U","ሀ":"U","𐓎":"U","ᑌ":"U","ꓴ":"U","𖽂":"U","𑢸":"U","ǔ":"ŭ","Ǔ":"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵","Ꮜ":"U̵","ᑘ":"U·","ᑧ":"U\'","ᵫ":"ue","ꭣ":"uo","ṃ":"ꭑ","պ":"ɰ","ሣ":"ɰ","℧":"Ʊ","ᘮ":"Ʊ","ᘴ":"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v","ｖ":"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v","ν":"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v","ѵ":"v","ט":"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V","Ѵ":"V","ⴸ":"V","Ꮩ":"V","ᐯ":"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵","ᐻ":"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ","Λ":"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ","Л":"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ","ᐱ":"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦","ᐽ":"Ʌ·","ɯ":"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w","ѡ":"w","ԝ":"w","ա":"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W","Ꮃ":"W","Ꮤ":"W","ꓪ":"W","ѽ":"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ","м":"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x","ｘ":"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x","х":"x","ᕁ":"x","ᕽ":"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X","Ｘ":"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X","Χ":"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X","Х":"X","ⵝ":"X","ᚷ":"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ","Ҳ":"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll","ɣ":"y","ᶌ":"y","ｙ":"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y","ʏ":"y","ỿ":"y","ꭚ":"y","γ":"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y","у":"y","ү":"y","ყ":"y","𑣜":"y","Ｙ":"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y","Υ":"Y","ϒ":"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y","У":"Y","Ү":"Y","Ꭹ":"Y","Ꮍ":"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y","ƴ":"y̔","ɏ":"y̵","ұ":"y̵","¥":"Y̵","Ɏ":"Y̵","Ұ":"Y̵","ʒ":"ȝ","ꝫ":"ȝ","ⳍ":"ȝ","ӡ":"ȝ","ჳ":"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z","Ｚ":"Z","ℤ":"Z","ℨ":"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z","Ζ":"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z","Ꮓ":"Z","ꓜ":"Z","𑢩":"Z","ʐ":"z̨","ƶ":"z̵","Ƶ":"Z̵","ȥ":"z̦","Ȥ":"Z̦","ᵶ":"z̴","ƿ":"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ","ϩ":"ƨ","ꙅ":"ƨ","ь":"ƅ","ꮟ":"ƅ","ы":"ƅi","ꭾ":"ɂ","ˤ":"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ","Г":"Γ","Ꮁ":"Γ","ᒥ":"Γ","𖼇":"Γ","Ғ":"Γ̵","ᒯ":"Γ·","Ґ":"Γ\'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ","ᐃ":"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲","ᐏ":"Δ·","ᐬ":"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ","µ":"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ","ϖ":"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π","п":"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π","П":"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ","ϛ":"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ","Ф":"Φ","Փ":"Φ","ቀ":"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ","ѱ":"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ","Ѱ":"Ψ","𐓑":"Ψ","ᛘ":"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω","Ω":"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω","ᘯ":"Ω","ᘵ":"Ω","𐊶":"Ω","⍹":"ω̲","ώ":"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ","җ":"ж̩","Җ":"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И","Й":"Ѝ","Ҋ":"Ѝ̦","ѝ":"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ","Ꮗ":"Ѡ","ᗯ":"Ѡ","Ѽ":"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ","ӌ":"ҷ","Ӌ":"Ҷ","Ҿ":"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ","և":"եւ","ኔ":"ձ","ﬔ":"մե","ﬕ":"մի","ﬗ":"մխ","ﬓ":"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո","በ":"Ո","ᑎ":"Ո","ꓵ":"Ո","ᑚ":"Ո·","ᑨ":"Ո\'","ﬖ":"վն","₽":"Ք","˓":"ՙ","ʿ":"ՙ","ℵ":"א","ﬡ":"א","אָ":"אַ","אּ":"אַ","ﭏ":"אל","ℶ":"ב","ℷ":"ג","ℸ":"ד","ﬢ":"ד","ﬣ":"ה","יּ":"יִ","ﬤ":"כ","ﬥ":"ל","ﬦ":"ם","ﬠ":"ע","ﬧ":"ר","שׂ":"שׁ","שּ":"שׁ","שּׂ":"שּׁ","ﬨ":"ת","ﺀ":"ء","۽":"ء͈","ﺂ":"آ","ﺁ":"آ","ﭑ":"ٱ","ﭐ":"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب","ﺑ":"ب","ﺒ":"ب","ﺐ":"ب","ﺏ":"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ","ﲠ":"بo","ﳢ":"بo","ﲜ":"بج","ﰅ":"بج","ﲝ":"بح","ﰆ":"بح","ﷂ":"بحى","ﲞ":"بخ","ﰇ":"بخ","ﳒ":"بخ","ﱋ":"بخ","ﶞ":"بخى","ﱪ":"بر","ﱫ":"بز","ﲟ":"بم","ﳡ":"بم","ﱬ":"بم","ﰈ":"بم","ﱭ":"بن","ﱮ":"بى","ﰉ":"بى","ﱯ":"بى","ﰊ":"بى","ﭔ":"ٻ","ﭕ":"ٻ","ﭓ":"ٻ","ﭒ":"ٻ","ې":"ٻ","ﯦ":"ٻ","ﯧ":"ٻ","ﯥ":"ٻ","ﯤ":"ٻ","ﭜ":"ڀ","ﭝ":"ڀ","ﭛ":"ڀ","ﭚ":"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة","ö":"ة","ﺔ":"ة","ﺓ":"ة","ۃ":"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت","ﺗ":"ت","ﺘ":"ت","ﺖ":"ت","ﺕ":"ت","ﲥ":"تo","ﳤ":"تo","ﲡ":"تج","ﰋ":"تج","ﵐ":"تجم","ﶠ":"تجى","ﶟ":"تجى","ﲢ":"تح","ﰌ":"تح","ﵒ":"تحج","ﵑ":"تحج","ﵓ":"تحم","ﲣ":"تخ","ﰍ":"تخ","ﵔ":"تخم","ﶢ":"تخى","ﶡ":"تخى","ﱰ":"تر","ﱱ":"تز","ﲤ":"تم","ﳣ":"تم","ﱲ":"تم","ﰎ":"تم","ﵕ":"تمج","ﵖ":"تمح","ﵗ":"تمخ","ﶤ":"تمى","ﶣ":"تمى","ﱳ":"تن","ﱴ":"تى","ﰏ":"تى","ﱵ":"تى","ﰐ":"تى","ﭠ":"ٺ","ﭡ":"ٺ","ﭟ":"ٺ","ﭞ":"ٺ","ﭤ":"ٿ","ﭥ":"ٿ","ﭣ":"ٿ","ﭢ":"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج","ﺟ":"ج","ﺠ":"ج","ﺞ":"ج","ﺝ":"ج","ﲧ":"جح","ﰕ":"جح","ﶦ":"جحى","ﶾ":"جحى","ﷻ":"جل جلlلo","ﲨ":"جم","ﰖ":"جم","ﵙ":"جمح","ﵘ":"جمح","ﶧ":"جمى","ﶥ":"جمى","ﴝ":"جى","ﴁ":"جى","ﴞ":"جى","ﴂ":"جى","ﭸ":"ڃ","ﭹ":"ڃ","ﭷ":"ڃ","ﭶ":"ڃ","ﭴ":"ڄ","ﭵ":"ڄ","ﭳ":"ڄ","ﭲ":"ڄ","ﭼ":"چ","ﭽ":"چ","ﭻ":"چ","ﭺ":"چ","ﮀ":"ڇ","ﮁ":"ڇ","ﭿ":"ڇ","ﭾ":"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح","ﺣ":"ح","ﺤ":"ح","ﺢ":"ح","ﺡ":"ح","څ":"حۛ","ځ":"حٔ","ݲ":"حٔ","ﲩ":"حج","ﰗ":"حج","ﶿ":"حجى","ﲪ":"حم","ﰘ":"حم","ﵛ":"حمى","ﵚ":"حمى","ﴛ":"حى","ﳿ":"حى","ﴜ":"حى","ﴀ":"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ","ﺧ":"خ","ﺨ":"خ","ﺦ":"خ","ﺥ":"خ","ﲫ":"خج","ﰙ":"خج","ﰚ":"خح","ﲬ":"خم","ﰛ":"خم","ﴟ":"خى","ﴃ":"خى","ﴠ":"خى","ﴄ":"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د","ﺪ":"د","ﺩ":"د","ڈ":"دؕ","ﮉ":"دؕ","ﮈ":"دؕ","ڎ":"دۛ","ﮇ":"دۛ","ﮆ":"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ","ﺬ":"ذ","ﺫ":"ذ","ﱛ":"ذٰ","ڋ":"ڊؕ","ﮅ":"ڌ","ﮄ":"ڌ","ﮃ":"ڍ","ﮂ":"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر","ﺮ":"ر","ﺭ":"ر","ڑ":"رؕ","ﮍ":"رؕ","ﮌ":"رؕ","ژ":"رۛ","ﮋ":"رۛ","ﮊ":"رۛ","ڒ":"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ","ﱜ":"رٰ","ﷶ":"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز","ﺰ":"ز","ﺯ":"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س","ﺳ":"س","ﺴ":"س","ﺲ":"س","ﺱ":"س","ش":"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ","ﺷ":"سۛ","ﺸ":"سۛ","ﺶ":"سۛ","ﺵ":"سۛ","ݾ":"س̂","ﴱ":"سo","ﳨ":"سo","ﴲ":"سۛo","ﳪ":"سۛo","ﲭ":"سج","ﴴ":"سج","ﰜ":"سج","ﴭ":"سۛج","ﴷ":"سۛج","ﴥ":"سۛج","ﴉ":"سۛج","ﵝ":"سجح","ﵞ":"سجى","ﵩ":"سۛجى","ﲮ":"سح","ﴵ":"سح","ﰝ":"سح","ﴮ":"سۛح","ﴸ":"سۛح","ﴦ":"سۛح","ﴊ":"سۛح","ﵜ":"سحج","ﵨ":"سۛحم","ﵧ":"سۛحم","ﶪ":"سۛحى","ﲯ":"سخ","ﴶ":"سخ","ﰞ":"سخ","ﴯ":"سۛخ","ﴹ":"سۛخ","ﴧ":"سۛخ","ﴋ":"سۛخ","ﶨ":"سخى","ﷆ":"سخى","ﴪ":"سر","ﴎ":"سر","ﴩ":"سۛر","ﴍ":"سۛر","ﲰ":"سم","ﳧ":"سم","ﰟ":"سم","ﴰ":"سۛم","ﳩ":"سۛم","ﴨ":"سۛم","ﴌ":"سۛم","ﵡ":"سمج","ﵠ":"سمح","ﵟ":"سمح","ﵫ":"سۛمخ","ﵪ":"سۛمخ","ﵣ":"سمم","ﵢ":"سمم","ﵭ":"سۛمم","ﵬ":"سۛمم","ﴗ":"سى","ﳻ":"سى","ﴘ":"سى","ﳼ":"سى","ﴙ":"سۛى","ﳽ":"سۛى","ﴚ":"سۛى","ﳾ":"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص","ﺻ":"ص","ﺼ":"ص","ﺺ":"ص","ﺹ":"ص","ڞ":"صۛ","ࢯ":"ص̤̣","ﲱ":"صح","ﰠ":"صح","ﵥ":"صحح","ﵤ":"صحح","ﶩ":"صحى","ﲲ":"صخ","ﴫ":"صر","ﴏ":"صر","ﷵ":"صلعم","ﷹ":"صلى","ﷰ":"صلى","ﷺ":"صلى lللo علىo وسلم","ﲳ":"صم","ﰡ":"صم","ﷅ":"صمم","ﵦ":"صمم","ﴡ":"صى","ﴅ":"صى","ﴢ":"صى","ﴆ":"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض","ﺿ":"ض","ﻀ":"ض","ﺾ":"ض","ﺽ":"ض","ﲴ":"ضج","ﰢ":"ضج","ﲵ":"ضح","ﰣ":"ضح","ﵮ":"ضحى","ﶫ":"ضحى","ﲶ":"ضخ","ﰤ":"ضخ","ﵰ":"ضخم","ﵯ":"ضخم","ﴬ":"ضر","ﴐ":"ضر","ﲷ":"ضم","ﰥ":"ضم","ﴣ":"ضى","ﴇ":"ضى","ﴤ":"ضى","ﴈ":"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط","ﻃ":"ط","ﻄ":"ط","ﻂ":"ط","ﻁ":"ط","ڟ":"طۛ","ﲸ":"طح","ﰦ":"طح","ﴳ":"طم","ﴺ":"طم","ﰧ":"طم","ﵲ":"طمح","ﵱ":"طمح","ﵳ":"طمم","ﵴ":"طمى","ﴑ":"طى","ﳵ":"طى","ﴒ":"طى","ﳶ":"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ","ﻇ":"ظ","ﻈ":"ظ","ﻆ":"ظ","ﻅ":"ظ","ﲹ":"ظم","ﴻ":"ظم","ﰨ":"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع","ﻋ":"ع","ﻌ":"ع","ﻊ":"ع","ﻉ":"ع","ﲺ":"عج","ﰩ":"عج","ﷄ":"عجم","ﵵ":"عجم","ﷷ":"علىo","ﲻ":"عم","ﰪ":"عم","ﵷ":"عمم","ﵶ":"عمم","ﵸ":"عمى","ﶶ":"عمى","ﴓ":"عى","ﳷ":"عى","ﴔ":"عى","ﳸ":"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ","ﻏ":"غ","ﻐ":"غ","ﻎ":"غ","ﻍ":"غ","ﲼ":"غج","ﰫ":"غج","ﲽ":"غم","ﰬ":"غم","ﵹ":"غمم","ﵻ":"غمى","ﵺ":"غمى","ﴕ":"غى","ﳹ":"غى","ﴖ":"غى","ﳺ":"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف","ﻓ":"ف","ﻔ":"ف","ﻒ":"ف","ﻑ":"ف","ڧ":"ف","ﲾ":"فج","ﰭ":"فج","ﲿ":"فح","ﰮ":"فح","ﳀ":"فخ","ﰯ":"فخ","ﵽ":"فخم","ﵼ":"فخم","ﳁ":"فم","ﰰ":"فم","ﷁ":"فمى","ﱼ":"فى","ﰱ":"فى","ﱽ":"فى","ﰲ":"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ","ڤ":"ڡۛ","ﭬ":"ڡۛ","ﭭ":"ڡۛ","ﭫ":"ڡۛ","ﭪ":"ڡۛ","ڨ":"ڡۛ","ࢤ":"ڢۛ","ﭰ":"ڦ","ﭱ":"ڦ","ﭯ":"ڦ","ﭮ":"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق","ﻗ":"ق","ﻘ":"ق","ﻖ":"ق","ﻕ":"ق","ﳂ":"قح","ﰳ":"قح","ﷱ":"قلى","ﳃ":"قم","ﰴ":"قم","ﶴ":"قمح","ﵾ":"قمح","ﵿ":"قمم","ﶲ":"قمى","ﱾ":"قى","ﰵ":"قى","ﱿ":"قى","ﰶ":"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك","ﻛ":"ك","ﻜ":"ك","ﻚ":"ك","ﻙ":"ك","ک":"ك","ﮐ":"ك","ﮑ":"ك","ﮏ":"ك","ﮎ":"ك","ڪ":"ك","ڭ":"كۛ","ﯕ":"كۛ","ﯖ":"كۛ","ﯔ":"كۛ","ﯓ":"كۛ","ݣ":"كۛ","ﲀ":"كl","ﰷ":"كl","ﳄ":"كج","ﰸ":"كج","ﳅ":"كح","ﰹ":"كح","ﳆ":"كخ","ﰺ":"كخ","ﳇ":"كل","ﳫ":"كل","ﲁ":"كل","ﰻ":"كل","ﳈ":"كم","ﳬ":"كم","ﲂ":"كم","ﰼ":"كم","ﷃ":"كمم","ﶻ":"كمم","ﶷ":"كمى","ﲃ":"كى","ﰽ":"كى","ﲄ":"كى","ﰾ":"كى","ݢ":"ڬ","ﮔ":"گ","ﮕ":"گ","ﮓ":"گ","ﮒ":"گ","ࢰ":"گ","ڴ":"گۛ","ﮜ":"ڱ","ﮝ":"ڱ","ﮛ":"ڱ","ﮚ":"ڱ","ﮘ":"ڳ","ﮙ":"ڳ","ﮗ":"ڳ","ﮖ":"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل","ﻟ":"ل","ﻠ":"ل","ﻞ":"ل","ﻝ":"ل","ڷ":"لۛ","ڵ":"ل̆","ﻼ":"لl","ﻻ":"لl","ﻺ":"لlٕ","ﻹ":"لlٕ","ﻸ":"لlٴ","ﻷ":"لlٴ","ﳍ":"لo","ﻶ":"لآ","ﻵ":"لآ","ﳉ":"لج","ﰿ":"لج","ﶃ":"لجج","ﶄ":"لجج","ﶺ":"لجم","ﶼ":"لجم","ﶬ":"لجى","ﳊ":"لح","ﱀ":"لح","ﶵ":"لحم","ﶀ":"لحم","ﶂ":"لحى","ﶁ":"لحى","ﳋ":"لخ","ﱁ":"لخ","ﶆ":"لخم","ﶅ":"لخم","ﳌ":"لم","ﳭ":"لم","ﲅ":"لم","ﱂ":"لم","ﶈ":"لمح","ﶇ":"لمح","ﶭ":"لمى","ﲆ":"لى","ﱃ":"لى","ﲇ":"لى","ﱄ":"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م","ﻣ":"م","ﻤ":"م","ﻢ":"م","ﻡ":"م","ࢧ":"مۛ","۾":"م͈","ﲈ":"مl","ﳎ":"مج","ﱅ":"مج","ﶌ":"مجح","ﶒ":"مجخ","ﶍ":"مجم","ﷀ":"مجى","ﳏ":"مح","ﱆ":"مح","ﶉ":"محج","ﶊ":"محم","ﷴ":"محمد","ﶋ":"محى","ﳐ":"مخ","ﱇ":"مخ","ﶎ":"مخج","ﶏ":"مخم","ﶹ":"مخى","ﳑ":"مم","ﲉ":"مم","ﱈ":"مم","ﶱ":"ممى","ﱉ":"مى","ﱊ":"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن","ﻧ":"ن","ﻨ":"ن","ﻦ":"ن","ﻥ":"ن","ݨ":"نؕ","ݩ":"ن̆","ﳖ":"نo","ﳯ":"نo","ﶸ":"نجح","ﶽ":"نجح","ﶘ":"نجم","ﶗ":"نجم","ﶙ":"نجى","ﷇ":"نجى","ﳓ":"نح","ﱌ":"نح","ﶕ":"نحم","ﶖ":"نحى","ﶳ":"نحى","ﳔ":"نخ","ﱍ":"نخ","ﲊ":"نر","ﲋ":"نز","ﳕ":"نم","ﳮ":"نم","ﲌ":"نم","ﱎ":"نم","ﶛ":"نمى","ﶚ":"نمى","ﲍ":"نن","ﲎ":"نى","ﱏ":"نى","ﲏ":"نى","ﱐ":"نى","ۂ":"ۀ","ﮥ":"ۀ","ﮤ":"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و","ﻮ":"و","ﻭ":"و","ࢱ":"و","ۋ":"وۛ","ﯟ":"وۛ","ﯞ":"وۛ","ۇ":"و̓","ﯘ":"و̓","ﯗ":"و̓","ۆ":"و̆","ﯚ":"و̆","ﯙ":"و̆","ۉ":"و̂","ﯣ":"و̂","ﯢ":"و̂","ۈ":"وٰ","ﯜ":"وٰ","ﯛ":"وٰ","ؤ":"وٴ","ﺆ":"وٴ","ﺅ":"وٴ","ٶ":"وٴ","ٷ":"و̓ٴ","ﯝ":"و̓ٴ","ﷸ":"وسلم","ﯡ":"ۅ","ﯠ":"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى","ں":"ى","𞸝":"ى","𞹝":"ى","ﮟ":"ى","ﮞ":"ى","ࢽ":"ى","ﯨ":"ى","ﯩ":"ى","ﻰ":"ى","ﻯ":"ى","ي":"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى","ﻳ":"ى","ﻴ":"ى","ﻲ":"ى","ﻱ":"ى","ی":"ى","ﯾ":"ى","ﯿ":"ى","ﯽ":"ى","ﯼ":"ى","ے":"ى","ﮯ":"ى","ﮮ":"ى","ٹ":"ىؕ","ﭨ":"ىؕ","ﭩ":"ىؕ","ﭧ":"ىؕ","ﭦ":"ىؕ","ڻ":"ىؕ","ﮢ":"ىؕ","ﮣ":"ىؕ","ﮡ":"ىؕ","ﮠ":"ىؕ","پ":"ىۛ","ﭘ":"ىۛ","ﭙ":"ىۛ","ﭗ":"ىۛ","ﭖ":"ىۛ","ث":"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ","ﺛ":"ىۛ","ﺜ":"ىۛ","ﺚ":"ىۛ","ﺙ":"ىۛ","ڽ":"ىۛ","ۑ":"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆","ێ":"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ","ﲐ":"ىٰ","ﱝ":"ىٰ","ﳞ":"ىo","ﳱ":"ىo","ﳦ":"ىۛo","ئ":"ىٴ","ﺋ":"ىٴ","ﺌ":"ىٴ","ﺊ":"ىٴ","ﺉ":"ىٴ","ٸ":"ىٴ","ﯫ":"ىٴl","ﯪ":"ىٴl","ﲛ":"ىٴo","ﳠ":"ىٴo","ﯭ":"ىٴo","ﯬ":"ىٴo","ﯸ":"ىٴٻ","ﯷ":"ىٴٻ","ﯶ":"ىٴٻ","ﲗ":"ىٴج","ﰀ":"ىٴج","ﲘ":"ىٴح","ﰁ":"ىٴح","ﲙ":"ىٴخ","ﱤ":"ىٴر","ﱥ":"ىٴز","ﲚ":"ىٴم","ﳟ":"ىٴم","ﱦ":"ىٴم","ﰂ":"ىٴم","ﱧ":"ىٴن","ﯯ":"ىٴو","ﯮ":"ىٴو","ﯱ":"ىٴو̓","ﯰ":"ىٴو̓","ﯳ":"ىٴو̆","ﯲ":"ىٴو̆","ﯵ":"ىٴوٰ","ﯴ":"ىٴوٰ","ﯻ":"ىٴى","ﯺ":"ىٴى","ﱨ":"ىٴى","ﯹ":"ىٴى","ﰃ":"ىٴى","ﱩ":"ىٴى","ﰄ":"ىٴى","ﳚ":"ىج","ﱕ":"ىج","ﰑ":"ىۛج","ﶯ":"ىجى","ﳛ":"ىح","ﱖ":"ىح","ﶮ":"ىحى","ﳜ":"ىخ","ﱗ":"ىخ","ﲑ":"ىر","ﱶ":"ىۛر","ﲒ":"ىز","ﱷ":"ىۛز","ﳝ":"ىم","ﳰ":"ىم","ﲓ":"ىم","ﱘ":"ىم","ﲦ":"ىۛم","ﳥ":"ىۛم","ﱸ":"ىۛم","ﰒ":"ىۛم","ﶝ":"ىمم","ﶜ":"ىمم","ﶰ":"ىمى","ﲔ":"ىن","ﱹ":"ىۛن","ﲕ":"ىى","ﱙ":"ىى","ﲖ":"ىى","ﱚ":"ىى","ﱺ":"ىۛى","ﰓ":"ىۛى","ﱻ":"ىۛى","ﰔ":"ىۛى","ﮱ":"ۓ","ﮰ":"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ","Մ":"ሆ","Ռ":"ቡ","Ի":"ኮ","Պ":"ጣ","आ":"अा","ऒ":"अाॆ","ओ":"अाे","औ":"अाै","ऄ":"अॆ","ऑ":"अॉ","ऍ":"एॅ","ऎ":"एॆ","ऐ":"एे","ई":"र्इ","ઽ":"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्","আ":"অা","ৠ":"ঋৃ","ৡ":"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ","ਉ":"ੳੁ","ਊ":"ੳੂ","ਆ":"ਅਾ","ਐ":"ਅੈ","ਔ":"ਅੌ","ਇ":"ੲਿ","ਈ":"ੲੀ","ਏ":"ੲੇ","આ":"અા","ઑ":"અાૅ","ઓ":"અાે","ઔ":"અાૈ","ઍ":"અૅ","એ":"અે","ઐ":"અૈ","ଆ":"ଅା","௮":"அ","ர":"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ","ഉ":"உ","ஊ":"உள","ഊ":"உൗ","௭":"எ","௷":"எவ","ஜ":"ஐ","ജ":"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி","ണ":"ண","௺":"நீ","௴":"மீ","௰":"ய","ഴ":"ழ","ௗ":"ள","ை":"ன","ശ":"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ","ಅ":"అ","ಆ":"ఆ","ಇ":"ఇ","ౠ":"ఋా","ౡ":"ఌా","ಒ":"ఒ","ఔ":"ఒౌ","ಔ":"ఒౌ","ఓ":"ఒౕ","ಓ":"ఒౕ","ಜ":"జ","ಞ":"ఞ","ఢ":"డ̣","ಣ":"ణ","థ":"ధּ","భ":"బ̣","ಯ":"య","ఠ":"రּ","ಱ":"ఱ","ಲ":"ల","ష":"వ̣","హ":"వా","మ":"వు","ూ":"ుా","ౄ":"ృా","ೡ":"ಌಾ","ഈ":"ഇൗ","ഐ":"എെ","ഓ":"ഒാ","ഔ":"ഒൗ","ൡ":"ഞ","൫":"ദ്ര","൹":"നു","ഌ":"നു","ങ":"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ","റ":"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳","ฃ":"ข","ด":"ค","ต":"ค","ม":"ฆ","ຈ":"จ","ซ":"ช","ฏ":"ฎ","ท":"ฑ","ບ":"บ","ປ":"ป","ຝ":"ฝ","ພ":"พ","ຟ":"ฟ","ฦ":"ภ","ຍ":"ย","។":"ฯ","ๅ":"า","ำ":"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู","แ":"เเ","ໜ":"ຫນ","ໝ":"ຫມ","ຳ":"̊າ","༂":"འུྂཿ","༃":"འུྂ༔","ཪ":"ར","ༀ":"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ","က":"ဂာ","ၰ":"ဃှ","ၦ":"ပှ","ဟ":"ပာ","ၯ":"ပာှ","ၾ":"ၽှ","ဩ":"သြ","ဪ":"သြော်","႞":"ႃ̊","ឣ":"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ","ᢖ":"ᡜ","ᡕ":"ᠵ","ῶ":"Ꮿ","ᐍ":"ᐁ·","ᐫ":"ᐁᐠ","ᐑ":"ᐄ·","ᐓ":"ᐅ·","ᐭ":"ᐅᐠ","ᐕ":"ᐆ·","ᐘ":"ᐊ·","ᐮ":"ᐊᐠ","ᐚ":"ᐋ·","ᣝ":"ᐞᣟ","ᓑ":"ᐡ","ᕀ":"ᐩ","ᐿ":"ᐲ·","ᑃ":"ᐴ·","⍩":"ᐵ","ᑇ":"ᐹ·","ᑜ":"ᑏ·","⸧":"ᑐ","⊃":"ᑐ","ᑞ":"ᑐ·","ᑩ":"ᑐ\'","⟉":"ᑐ/","⫗":"ᑐᑕ","ᑠ":"ᑑ·","⸦":"ᑕ","⊂":"ᑕ","ᑢ":"ᑕ·","ᑪ":"ᑕ\'","ᑤ":"ᑖ·","ᑵ":"ᑫ·","ᒅ":"ᑫ\'","ᑹ":"ᑮ·","ᑽ":"ᑰ·","ᘃ":"ᒉ","ᒓ":"ᒉ·","ᒕ":"ᒋ·","ᒗ":"ᒌ·","ᒛ":"ᒎ·","ᘂ":"ᒐ","ᒝ":"ᒐ·","ᒟ":"ᒑ·","ᒭ":"ᒣ·","ᒱ":"ᒦ·","ᒳ":"ᒧ·","ᒵ":"ᒨ·","ᒹ":"ᒫ·","ᓊ":"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·","ᓌ":"ᓇ·","ᓎ":"ᓈ·","ᘄ":"ᓓ","ᓝ":"ᓓ·","ᓟ":"ᓕ·","ᓡ":"ᓖ·","ᓣ":"ᓗ·","ᓥ":"ᓘ·","ᘇ":"ᓚ","ᓧ":"ᓚ·","ᓩ":"ᓛ·","ᓷ":"ᓭ·","ᓹ":"ᓯ·","ᓻ":"ᓰ·","ᓽ":"ᓱ·","ᓿ":"ᓲ·","ᔁ":"ᓴ·","ᔃ":"ᓵ·","ᔌ":"ᔋ<","ᔎ":"ᔋb","ᔍ":"ᔋᑕ","ᔏ":"ᔋᒐ","ᔘ":"ᔐ·","ᔚ":"ᔑ·","ᔜ":"ᔒ·","ᔞ":"ᔓ·","ᔠ":"ᔔ·","ᔢ":"ᔕ·","ᔤ":"ᔖ·","ᔲ":"ᔨ·","ᔴ":"ᔩ·","ᔶ":"ᔪ·","ᔸ":"ᔫ·","ᔺ":"ᔭ·","ᔼ":"ᔮ·","ᘢ":"ᕃ","ᣠ":"ᕃ·","ᘣ":"ᕆ","ᘤ":"ᕊ","ᕏ":"ᕌ·","ᖃ":"ᕐb","ᖄ":"ᕐḃ","ᖁ":"ᕐd","ᕿ":"ᕐP","ᙯ":"ᕐᑫ","ᕾ":"ᕐᑬ","ᖀ":"ᕐᑮ","ᖂ":"ᕐᑰ","ᖅ":"ᕐᒃ","ᕜ":"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·","ᕩ":"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·","ᖑ":"ᖕJ","ᙰ":"ᖕᒉ","ᖎ":"ᖕᒊ","ᖏ":"ᖕᒋ","ᖐ":"ᖕᒌ","ᖒ":"ᖕᒎ","ᖓ":"ᖕᒐ","ᖔ":"ᖕᒑ","ᙳ":"ᖖJ","ᙱ":"ᖖᒋ","ᙲ":"ᖖᒌ","ᙴ":"ᖖᒎ","ᙵ":"ᖖᒐ","ᙶ":"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ","ˡ":"ᣳ","ʳ":"ᣴ","ˢ":"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ","ᛡ":"ᚼ","⍿":"ᚽ","ᛂ":"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥","ㄱ":"ᄀ","ᆨ":"ᄀ","ᄁ":"ᄀᄀ","ㄲ":"ᄀᄀ","ᆩ":"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ","ᇃ":"ᄀᄅ","ᇻ":"ᄀᄇ","ᆪ":"ᄀᄉ","ㄳ":"ᄀᄉ","ᇄ":"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ","ㄴ":"ᄂ","ᆫ":"ᄂ","ᄓ":"ᄂᄀ","ᇅ":"ᄂᄀ","ᄔ":"ᄂᄂ","ㅥ":"ᄂᄂ","ᇿ":"ᄂᄂ","ᄕ":"ᄂᄃ","ㅦ":"ᄂᄃ","ᇆ":"ᄂᄃ","ퟋ":"ᄂᄅ","ᄖ":"ᄂᄇ","ᅛ":"ᄂᄉ","ᇇ":"ᄂᄉ","ㅧ":"ᄂᄉ","ᅜ":"ᄂᄌ","ᆬ":"ᄂᄌ","ㄵ":"ᄂᄌ","ퟌ":"ᄂᄎ","ᇉ":"ᄂᄐ","ᅝ":"ᄂᄒ","ᆭ":"ᄂᄒ","ㄶ":"ᄂᄒ","ᇈ":"ᄂᅀ","ㅨ":"ᄂᅀ","ㄷ":"ᄃ","ᆮ":"ᄃ","ᄗ":"ᄃᄀ","ᇊ":"ᄃᄀ","ᄄ":"ᄃᄃ","ㄸ":"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ","ᇋ":"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ","ㄹ":"ᄅ","ᆯ":"ᄅ","ꥤ":"ᄅᄀ","ᆰ":"ᄅᄀ","ㄺ":"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ","ᇌ":"ᄅᄀᄉ","ㅩ":"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ","ᄘ":"ᄅᄂ","ᇍ":"ᄅᄂ","ꥦ":"ᄅᄃ","ᇎ":"ᄅᄃ","ㅪ":"ᄅᄃ","ꥧ":"ᄅᄃᄃ","ᇏ":"ᄅᄃᄒ","ᄙ":"ᄅᄅ","ᇐ":"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ","ᆱ":"ᄅᄆ","ㄻ":"ᄅᄆ","ᇑ":"ᄅᄆᄀ","ᇒ":"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ","ᆲ":"ᄅᄇ","ㄼ":"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ","ᇓ":"ᄅᄇᄉ","ㅫ":"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ","ᇕ":"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ","ᇔ":"ᄅᄇᄒ","ꥬ":"ᄅᄉ","ᆳ":"ᄅᄉ","ㄽ":"ᄅᄉ","ᇖ":"ᄅᄉᄉ","ᄛ":"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ","ᇘ":"ᄅᄏ","ᆴ":"ᄅᄐ","ㄾ":"ᄅᄐ","ᆵ":"ᄅᄑ","ㄿ":"ᄅᄑ","ᄚ":"ᄅᄒ","ㅀ":"ᄅᄒ","ᄻ":"ᄅᄒ","ᆶ":"ᄅᄒ","ퟲ":"ᄅᄒ","ᇗ":"ᄅᅀ","ㅬ":"ᄅᅀ","ퟛ":"ᄅᅌ","ᇙ":"ᄅᅙ","ㅭ":"ᄅᅙ","ퟜ":"ᄅᅙᄒ","ㅁ":"ᄆ","ᆷ":"ᄆ","ꥯ":"ᄆᄀ","ᇚ":"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ","ᇛ":"ᄆᄅ","ퟠ":"ᄆᄆ","ᄜ":"ᄆᄇ","ㅮ":"ᄆᄇ","ᇜ":"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ","ᇝ":"ᄆᄉ","ㅯ":"ᄆᄉ","ᇞ":"ᄆᄉᄉ","ᄝ":"ᄆᄋ","ㅱ":"ᄆᄋ","ᇢ":"ᄆᄋ","ퟢ":"ᄆᄌ","ᇠ":"ᄆᄎ","ᇡ":"ᄆᄒ","ᇟ":"ᄆᅀ","ㅰ":"ᄆᅀ","ㅂ":"ᄇ","ᆸ":"ᄇ","ᄞ":"ᄇᄀ","ㅲ":"ᄇᄀ","ᄟ":"ᄇᄂ","ᄠ":"ᄇᄃ","ㅳ":"ᄇᄃ","ퟣ":"ᄇᄃ","ᇣ":"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ","ᄈ":"ᄇᄇ","ㅃ":"ᄇᄇ","ퟦ":"ᄇᄇ","ᄬ":"ᄇᄇᄋ","ㅹ":"ᄇᄇᄋ","ᄡ":"ᄇᄉ","ㅄ":"ᄇᄉ","ᆹ":"ᄇᄉ","ᄢ":"ᄇᄉᄀ","ㅴ":"ᄇᄉᄀ","ᄣ":"ᄇᄉᄃ","ㅵ":"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ","ᄤ":"ᄇᄉᄇ","ᄥ":"ᄇᄉᄉ","ᄦ":"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ","ᄫ":"ᄇᄋ","ㅸ":"ᄇᄋ","ᇦ":"ᄇᄋ","ᄧ":"ᄇᄌ","ㅶ":"ᄇᄌ","ퟨ":"ᄇᄌ","ᄨ":"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ","ᄩ":"ᄇᄐ","ㅷ":"ᄇᄐ","ᄪ":"ᄇᄑ","ᇤ":"ᄇᄑ","ꥴ":"ᄇᄒ","ᇥ":"ᄇᄒ","ㅅ":"ᄉ","ᆺ":"ᄉ","ᄭ":"ᄉᄀ","ㅺ":"ᄉᄀ","ᇧ":"ᄉᄀ","ᄮ":"ᄉᄂ","ㅻ":"ᄉᄂ","ᄯ":"ᄉᄃ","ㅼ":"ᄉᄃ","ᇨ":"ᄉᄃ","ᄰ":"ᄉᄅ","ᇩ":"ᄉᄅ","ᄱ":"ᄉᄆ","ퟪ":"ᄉᄆ","ᄲ":"ᄉᄇ","ㅽ":"ᄉᄇ","ᇪ":"ᄉᄇ","ᄳ":"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ","ᄊ":"ᄉᄉ","ㅆ":"ᄉᄉ","ᆻ":"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ","ᄴ":"ᄉᄉᄉ","ᄵ":"ᄉᄋ","ᄶ":"ᄉᄌ","ㅾ":"ᄉᄌ","ퟯ":"ᄉᄌ","ᄷ":"ᄉᄎ","ퟰ":"ᄉᄎ","ᄸ":"ᄉᄏ","ᄹ":"ᄉᄐ","ퟱ":"ᄉᄐ","ᄺ":"ᄉᄑ","ퟮ":"ᄉᅀ","ㅇ":"ᄋ","ᆼ":"ᄋ","ᅁ":"ᄋᄀ","ᇬ":"ᄋᄀ","ᇭ":"ᄋᄀᄀ","ᅂ":"ᄋᄃ","ꥶ":"ᄋᄅ","ᅃ":"ᄋᄆ","ᅄ":"ᄋᄇ","ᅅ":"ᄋᄉ","ᇱ":"ᄋᄉ","ㆂ":"ᄋᄉ","ᅇ":"ᄋᄋ","ㆀ":"ᄋᄋ","ᇮ":"ᄋᄋ","ᅈ":"ᄋᄌ","ᅉ":"ᄋᄎ","ᇯ":"ᄋᄏ","ᅊ":"ᄋᄐ","ᅋ":"ᄋᄑ","ꥷ":"ᄋᄒ","ᅆ":"ᄋᅀ","ᇲ":"ᄋᅀ","ㆃ":"ᄋᅀ","ㅈ":"ᄌ","ᆽ":"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ","ᅍ":"ᄌᄋ","ᄍ":"ᄌᄌ","ㅉ":"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ","ㅊ":"ᄎ","ᆾ":"ᄎ","ᅒ":"ᄎᄏ","ᅓ":"ᄎᄒ","ㅋ":"ᄏ","ᆿ":"ᄏ","ㅌ":"ᄐ","ᇀ":"ᄐ","ꥹ":"ᄐᄐ","ㅍ":"ᄑ","ᇁ":"ᄑ","ᅖ":"ᄑᄇ","ᇳ":"ᄑᄇ","ퟺ":"ᄑᄉ","ᅗ":"ᄑᄋ","ㆄ":"ᄑᄋ","ᇴ":"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ","ㅎ":"ᄒ","ᇂ":"ᄒ","ᇵ":"ᄒᄂ","ᇶ":"ᄒᄅ","ᇷ":"ᄒᄆ","ᇸ":"ᄒᄇ","ꥻ":"ᄒᄉ","ᅘ":"ᄒᄒ","ㆅ":"ᄒᄒ","ᄽ":"ᄼᄼ","ᄿ":"ᄾᄾ","ㅿ":"ᅀ","ᇫ":"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ","ㆁ":"ᅌ","ᇰ":"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ","ᅏ":"ᅎᅎ","ᅑ":"ᅐᅐ","ㆆ":"ᅙ","ᇹ":"ᅙ","ꥼ":"ᅙᅙ","ㅤ":"ᅠ","ㅏ":"ᅡ","ᆣ":"ᅡー","ᅶ":"ᅡᅩ","ᅷ":"ᅡᅮ","ᅢ":"ᅡ丨","ㅐ":"ᅡ丨","ㅑ":"ᅣ","ᅸ":"ᅣᅩ","ᅹ":"ᅣᅭ","ᆤ":"ᅣᅮ","ᅤ":"ᅣ丨","ㅒ":"ᅣ丨","ㅓ":"ᅥ","ᅼ":"ᅥー","ᅺ":"ᅥᅩ","ᅻ":"ᅥᅮ","ᅦ":"ᅥ丨","ㅔ":"ᅥ丨","ㅕ":"ᅧ","ᆥ":"ᅧᅣ","ᅽ":"ᅧᅩ","ᅾ":"ᅧᅮ","ᅨ":"ᅧ丨","ㅖ":"ᅧ丨","ㅗ":"ᅩ","ᅪ":"ᅩᅡ","ㅘ":"ᅩᅡ","ᅫ":"ᅩᅡ丨","ㅙ":"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨","ᅿ":"ᅩᅥ","ᆀ":"ᅩᅥ丨","ힰ":"ᅩᅧ","ᆁ":"ᅩᅧ丨","ᆂ":"ᅩᅩ","ힱ":"ᅩᅩ丨","ᆃ":"ᅩᅮ","ᅬ":"ᅩ丨","ㅚ":"ᅩ丨","ㅛ":"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨","ᆄ":"ᅭᅣ","ㆇ":"ᅭᅣ","ᆆ":"ᅭᅣ","ᆅ":"ᅭᅣ丨","ㆈ":"ᅭᅣ丨","ힴ":"ᅭᅥ","ᆇ":"ᅭᅩ","ᆈ":"ᅭ丨","ㆉ":"ᅭ丨","ㅜ":"ᅮ","ᆉ":"ᅮᅡ","ᆊ":"ᅮᅡ丨","ᅯ":"ᅮᅥ","ㅝ":"ᅮᅥ","ᆋ":"ᅮᅥー","ᅰ":"ᅮᅥ丨","ㅞ":"ᅮᅥ丨","ힵ":"ᅮᅧ","ᆌ":"ᅮᅧ丨","ᆍ":"ᅮᅮ","ᅱ":"ᅮ丨","ㅟ":"ᅮ丨","ힶ":"ᅮ丨丨","ㅠ":"ᅲ","ᆎ":"ᅲᅡ","ힷ":"ᅲᅡ丨","ᆏ":"ᅲᅥ","ᆐ":"ᅲᅥ丨","ᆑ":"ᅲᅧ","ㆊ":"ᅲᅧ","ᆒ":"ᅲᅧ丨","ㆋ":"ᅲᅧ丨","ힸ":"ᅲᅩ","ᆓ":"ᅲᅮ","ᆔ":"ᅲ丨","ㆌ":"ᅲ丨","ㆍ":"ᆞ","ퟅ":"ᆞᅡ","ᆟ":"ᆞᅥ","ퟆ":"ᆞᅥ丨","ᆠ":"ᆞᅮ","ᆢ":"ᆞᆞ","ᆡ":"ᆞ丨","ㆎ":"ᆞ丨","ヘ":"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄","不":"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨","ᅵ":"丨","ㅣ":"丨","⼁":"丨","ᆜ":"丨ー","ᆘ":"丨ᅡ","ᆙ":"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨","ᆚ":"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ","ᆛ":"丨ᅮ","ퟃ":"丨ᅲ","ᆝ":"丨ᆞ","ퟄ":"丨丨","串":"串","丸":"丸","丹":"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀","亂":"亂","㇚":"亅","⼅":"亅","了":"了","ニ":"二","⼆":"二","𠄢":"𠄢","⼇":"亠","亮":"亮","⼈":"人","イ":"亻","⺅":"亻","什":"什","仌":"仌","令":"令","你":"你","倂":"併","倂":"併","侀":"侀","來":"來","例":"例","侮":"侮","侮":"侮","侻":"侻","便":"便","值":"値","倫":"倫","偺":"偺","備":"備","像":"像","僚":"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿","兀":"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全","兩":"兩","ハ":"八","⼋":"八","六":"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况","冷":"冷","凉":"凉","凌":"凌","凜":"凜","凞":"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃","切":"切","切":"切","列":"列","利":"利","㓟":"㓟","刺":"刺","刻":"刻","剆":"剆","割":"割","剷":"剷","劉":"劉","𠠄":"𠠄","カ":"力","力":"力","⼒":"力","劣":"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉","勒":"勒","勞":"勞","勤":"勤","勤":"勤","勵":"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕","北":"北","北":"北","⼕":"匚","⼖":"匸","匿":"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博","ト":"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即","卵":"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶","參":"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣","ロ":"口","⼝":"口","囗":"口","⼞":"口","句":"句","叫":"叫","叱":"叱","吆":"吆","吏":"吏","吝":"吝","吸":"吸","呂":"呂","呈":"呈","周":"周","咞":"咞","咢":"咢","咽":"咽","䎛":"㖈","哶":"哶","唐":"唐","啓":"啓","啟":"啓","啕":"啕","啣":"啣","善":"善","善":"善","喇":"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳","嗀":"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器","囹":"囹","圖":"圖","圗":"圗","⼟":"土","士":"土","⼠":"土","型":"型","城":"城","㦳":"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀","塚":"塚","塚":"塚","塞":"塞","填":"塡","壿":"墫","墬":"墬","墳":"墳","壘":"壘","壟":"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊","タ":"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄","奈":"奈","契":"契","奔":"奔","奢":"奢","女":"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦","嬀":"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀","宅":"宅","𡧈":"𡧈","寃":"寃","寘":"寘","寧":"寧","寧":"寧","寧":"寧","寮":"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸","尿":"尿","屠":"屠","屢":"屢","層":"層","履":"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦","崙":"崙","嵃":"嵃","嵐":"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲","嶺":"嶺","⼮":"巛","巢":"巢","エ":"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾","帲":"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干","年":"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广","度":"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶","廊":"廊","廊":"廊","廉":"廉","廒":"廒","廓":"廓","廙":"廙","廬":"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱","弄":"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳","律":"律","㣣":"㣣","徚":"徚","復":"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志","念":"念","忹":"忹","怒":"怒","怜":"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘","惡":"惡","𢛔":"𢛔","愈":"愈","慨":"慨","慄":"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎","憐":"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲","懶":"懶","懶":"懶","戀":"戀","⼽":"戈","成":"成","戛":"戛","戮":"戮","戴":"戴","⼾":"戶","戸":"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱","拉":"拉","拏":"拏","拓":"拓","拔":"拔","拼":"拼","拾":"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨","捻":"捻","掃":"掃","掠":"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮","搉":"㩁","撚":"撚","撝":"撝","擄":"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬","數":"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗","料":"料","⽄":"斤","⽅":"方","旅":"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日","易":"易","曶":"㫚","㫤":"㫤","晉":"晉","晩":"晚","晴":"晴","晴":"晴","暑":"暑","暑":"暑","暈":"暈","㬈":"㬈","暜":"暜","暴":"暴","曆":"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰","更":"更","書":"書","⽉":"月","𣍟":"𣍟","肦":"朌","胐":"朏","胊":"朐","脁":"朓","胶":"㬵","朗":"朗","朗":"朗","朗":"朗","脧":"朘","望":"望","望":"望","幐":"㬺","䐠":"㬻","𣎓":"𣎓","膧":"朣","𣎜":"𣎜","⽊":"木","李":"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃","柿":"杮","杻":"杻","枅":"枅","林":"林","㭉":"㭉","𣏕":"𣏕","柳":"柳","柺":"柺","栗":"栗","栟":"栟","桒":"桒","𣑭":"𣑭","梁":"梁","梅":"梅","梅":"梅","梎":"梎","梨":"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝","槩":"㮣","樧":"榝","榣":"榣","槪":"槪","樂":"樂","樂":"樂","樂":"樂","樓":"樓","𣚣":"𣚣","檨":"檨","櫓":"櫓","櫛":"櫛","欄":"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲","歷":"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟","殮":"殮","⽎":"殳","殺":"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧","沈":"沈","沿":"沿","泌":"泌","泍":"泍","泥":"泥","𣲼":"𣲼","洛":"洛","洞":"洞","洴":"洴","派":"派","流":"流","流":"流","流":"流","洖":"洖","浩":"浩","浪":"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞","淋":"淋","淚":"淚","淪":"淪","淹":"淹","渚":"渚","港":"港","湮":"湮","潙":"溈","滋":"滋","滋":"滋","溜":"溜","溺":"溺","滇":"滇","滑":"滑","滛":"滛","㴳":"㴳","漏":"漏","漢":"漢","漢":"漢","漣":"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆","濫":"濫","濾":"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災","炙":"炙","炭":"炭","烈":"烈","烙":"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅","煉":"煉","𤋮":"𤋮","熜":"熜","燎":"燎","燐":"燐","𤎫":"𤎫","爐":"爐","爛":"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛","牢":"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯","狀":"狀","𤜵":"𤜵","狼":"狼","猪":"猪","猪":"猪","𤠔":"𤠔","獵":"獵","獺":"獺","⽞":"玄","率":"率","率":"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥","玲":"玲","㺸":"㺸","㺸":"㺸","珞":"珞","琉":"琉","理":"理","琢":"琢","瑇":"瑇","瑜":"瑜","瑩":"瑩","瑱":"瑱","瑱":"瑱","璅":"璅","璉":"璉","璘":"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶","留":"留","略":"略","異":"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒","痢":"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝","療":"療","癩":"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼","益":"益","益":"益","盛":"盛","盧":"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳","省":"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹","晣":"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝","硏":"研","硎":"硎","硫":"硫","碌":"碌","碌":"碌","碑":"碑","磊":"磊","磌":"磌","磌":"磌","磻":"磻","䃣":"䃣","礪":"礪","⽰":"示","⺭":"礻","礼":"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝","神":"神","祥":"祥","視":"視","視":"視","祿":"祿","𥚚":"𥚚","禍":"禍","禎":"禎","福":"福","福":"福","𥛅":"𥛅","禮":"禮","⽱":"禸","⽲":"禾","秊":"秊","䄯":"䄯","秫":"秫","稜":"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱","立":"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹","笠":"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐","簾":"簾","籠":"籠","⽶":"米","类":"类","粒":"粒","精":"精","糒":"糒","糖":"糖","糨":"糨","䊠":"䊠","糣":"糣","糧":"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀","紐":"紐","索":"索","累":"累","絶":"絕","絣":"絣","絛":"絛","綠":"綠","綾":"綾","緇":"緇","練":"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉","縷":"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙","罹":"罹","罺":"罺","羅":"羅","𦌾":"𦌾","⽺":"羊","羕":"羕","羚":"羚","羽":"羽","⽻":"羽","翺":"翺","老":"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳","聆":"聆","聠":"聠","𦖨":"𦖨","聯":"聯","聰":"聰","聾":"聾","⾀":"聿","⺺":"肀","⾁":"肉","肋":"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙","腁":"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵","朦":"䑃","臘":"臘","⾂":"臣","臨":"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮","良":"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽","若":"若","若":"若","苦":"苦","𦬼":"𦬼","茶":"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓","菉":"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華","菱":"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭","落":"落","葉":"葉","蔿":"蒍","𦳕":"𦳕","𦵫":"𦵫","蓮":"蓮","蓱":"蓱","蓳":"蓳","蓼":"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬","藍":"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡","藺":"藺","蘆":"蘆","䕫":"䕫","蘒":"蘒","蘭":"蘭","𧃒":"𧃒","虁":"蘷","蘿":"蘿","⾌":"虍","⻁":"虎","虐":"虐","虜":"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊","螺":"螺","蠁":"蠁","䗹":"䗹","蠟":"蠟","⾎":"血","行":"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤","裂":"裂","𧙧":"𧙧","裏":"裏","裗":"裗","裞":"裞","裡":"裡","裸":"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁","襤":"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆","見":"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦","詽":"訮","訞":"䚶","䚾":"䚾","䛇":"䛇","誠":"誠","說":"說","說":"說","調":"調","請":"請","諒":"諒","論":"論","諭":"諭","諭":"諭","諸":"諸","諸":"諸","諾":"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹","識":"識","讀":"讀","讏":"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆","豈":"豈","豕":"豕","⾗":"豕","豣":"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁","賂":"賂","賈":"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起","趆":"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼","跺":"跥","路":"路","跰":"跰","躛":"躗","⾝":"身","車":"車","⾞":"車","軔":"軔","輧":"軿","輦":"輦","輪":"輪","輸":"輸","輸":"輸","輻":"輻","轢":"轢","⻋":"车","⾟":"辛","辞":"辞","辰":"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡","連":"連","逸":"逸","逸":"逸","遲":"遲","遼":"遼","𨗒":"𨗒","𨗭":"𨗭","邏":"邏","⾢":"邑","邔":"邔","郎":"郎","郞":"郎","郞":"郎","郱":"郱","都":"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉","酪":"酪","醙":"醙","醴":"醴","⾤":"釆","里":"里","⾥":"里","量":"量","金":"金","⾦":"金","鈴":"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼","錄":"錄","鍊":"鍊","鎮":"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕","閭":"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝","阮":"阮","陋":"陋","降":"降","陵":"陵","陸":"陸","陼":"陼","隆":"隆","隣":"隣","䧦":"䧦","⾪":"隶","隷":"隷","隸":"隷","隸":"隷","⾫":"隹","雃":"雃","離":"離","難":"難","難":"難","⾬":"雨","零":"零","雷":"雷","霣":"霣","𩅅":"𩅅","露":"露","靈":"靈","⾭":"靑","⻘":"青","靖":"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋","領":"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻","類":"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢","飯":"飯","飼":"飼","䬳":"䬳","館":"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂","駱":"駱","駾":"駾","驪":"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚","魯":"魯","鱀":"鱀","鱗":"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎","鶴":"鶴","𪄅":"𪄅","䳸":"䳸","鷺":"鷺","𪈎":"𪈎","鸞":"鸞","鹃":"鹂","⿄":"鹵","鹿":"鹿","⿅":"鹿","𪊑":"𪊑","麗":"麗","麟":"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍","黎":"黎","䵖":"䵖","⿊":"黑","黒":"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿","龍":"龍","⿓":"龍","龎":"龎","⻰":"龙","龜":"龜","龜":"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"}')}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return o[e].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=o,s.amdD=function(){throw new Error("define cannot be used indirect")},s.amdO={},e=[],s.O=(t,n,r,i)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,r,i]=e[d],a=!0,l=0;l<n.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,i<o&&(o=i));if(a){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},s.F={},s.E=e=>{Object.keys(s.F).map((t=>{s.F[t](e)}))},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);s.r(i);var o={};t=t||[null,n({}),n([]),n(n)];for(var a=2&r&&e;"object"==typeof a&&!~t.indexOf(a);a=n(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,s.d(i,o),i},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>(({133:"hls.js",384:"jspdf",526:"html2canvas"}[e]||e)+".bundle.js"),s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},i="asterics-grid:",s.l=(e,t,n,o)=>{if(r[e])r[e].push(t);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==i+n){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",i+n),a.src=e),r[e]=[t];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var i=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.p="app/build/",(()=>{s.b=document.baseURI||self.location.href;var e={792:0};s.f.j=(t,n)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var o=s.p+s.u(t),a=new Error;s.l(o,(n=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,r[1](a)}}),"chunk-"+t,t)}},s.F.j=t=>{if(!s.o(e,t)||void 0===e[t]){e[t]=null;var n=document.createElement("link");s.nc&&n.setAttribute("nonce",s.nc),n.rel="prefetch",n.as="script",n.href=s.p+s.u(t),document.head.appendChild(n)}},s.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[o,a,l]=n,c=0;if(o.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var d=l(s)}for(t&&t(n);c<o.length;c++)i=o[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},n=self.webpackChunkasterics_grid=self.webpackChunkasterics_grid||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),s.nc=void 0,s.O(0,[792],(()=>{s.E(819)}),5);var l={};(()=>{"use strict";var e={};s.r(e),s.d(e,{AuthType:()=>Gp,AutoDiscovery:()=>gp.MN,AutoDiscoveryAction:()=>gp.iz,AutoDiscoveryError:()=>gp.gc,Beacon:()=>wp.HF,BeaconEvent:()=>wp.JH,CRYPTO_ENABLED:()=>Zh.Kn,CallEvent:()=>wv.$E,CallFeedEvent:()=>Ov.BL,Category:()=>_p,ClientEvent:()=>Zh.AU,ClientPrefix:()=>mp.iD,ClientStoppedError:()=>Sp.LA,ConditionKind:()=>ov.wp,ConditionOperator:()=>ov.CD,ConnectionError:()=>mp.Rc,ContentHelpers:()=>Sv,Crypto:()=>Mv,CryptoEvent:()=>Tv.cr,DELEGATED_OIDC_COMPATIBILITY:()=>pv,DEVICE_CODE_SCOPE:()=>Lp.AO,DMMemberCountCondition:()=>ov.IJ,Device:()=>Np.p,DeviceVerification:()=>Np.u,Direction:()=>Tp.O,DuplicateStrategy:()=>Ip.x,EVENT_VISIBILITY_CHANGE_TYPE:()=>np.Yg,EventEmitterEvents:()=>xp.u,EventStatus:()=>tp.fb,EventTimeline:()=>Tp.q,EventTimelineSet:()=>Ip.m,EventType:()=>np.Bx,FILTER_RELATED_BY_REL_TYPES:()=>Rp.H,FILTER_RELATED_BY_SENDERS:()=>Rp.o1,FeatureSupport:()=>Rp.c1,Filter:()=>Pp.d,GET_LOGIN_TOKEN_CAPABILITY:()=>Zh.hx,GroupCall:()=>Av.eO,GroupCallEvent:()=>Av.AZ,GroupCallIntent:()=>Av.MC,GroupCallState:()=>Av.F_,GroupCallStatsReportEvent:()=>Av.xt,GroupCallType:()=>Av.Ad,GuestAccess:()=>av.rF,HTTPError:()=>mp.Hl,HistoryVisibility:()=>av.Jv,HttpApiEvent:()=>mp.XD,IdentityPrefix:()=>mp.Pw,IdentityProviderBrand:()=>vv,IndexedDBCryptoStore:()=>rv.y,IndexedDBStore:()=>ev,InteractiveAuth:()=>Vp,InvalidCryptoStoreError:()=>Sp.E5,InvalidCryptoStoreState:()=>Sp.hP,JoinRule:()=>av.dx,KNOWN_SAFE_ROOM_VERSION:()=>Ap.vx,KeySignatureUploadError:()=>Sp.b0,KnownMembership:()=>zh.O,LOCAL_NOTIFICATION_SETTINGS_PREFIX:()=>np.Xs,LocalStorageCryptoStore:()=>nv.F,LocalStorageErrors:()=>Nv,LocationAssetType:()=>uv.Yg,MAIN_ROOM_TIMELINE:()=>fv.S,MAXIMUM_MATRIX_VERSION:()=>jp.Uv,MINIMUM_MATRIX_VERSION:()=>jp.eD,MSC3912_RELATION_BASED_REDACTIONS_PROP:()=>np.Z3,M_ASSET:()=>uv.J1,M_BEACON:()=>cv.z,M_BEACON_INFO:()=>cv.E,M_HTML:()=>yv.Et,M_LOCATION:()=>uv.M6,M_MESSAGE:()=>yv.K0,M_POLL_END:()=>gv.cI,M_POLL_KIND_DISCLOSED:()=>gv.ms,M_POLL_KIND_UNDISCLOSED:()=>gv.li,M_POLL_RESPONSE:()=>gv.qN,M_POLL_START:()=>gv.$S,M_TEXT:()=>yv.yB,M_TIMESTAMP:()=>uv.vo,M_TOPIC:()=>dv.s,MatrixClient:()=>Zh.pB,MatrixError:()=>mp.up,MatrixEvent:()=>tp.kl,MatrixEventEvent:()=>tp.OQ,MatrixHttpApi:()=>mp.ED,MatrixScheduler:()=>Qh.b,MediaHandlerEvent:()=>kv.d,MediaPrefix:()=>mp.zs,MemoryCryptoStore:()=>Kh._,MemoryStore:()=>Xh,Method:()=>mp.IT,MsgType:()=>np.Wr,NoAuthFlowFoundError:()=>$p,NotificationCountType:()=>Ap.X5,OidcError:()=>Lp.uv,OidcTokenRefresher:()=>Lp.db,PUSHER_DEVICE_ID:()=>np.VT,PUSHER_ENABLED:()=>np.cr,PendingEventOrdering:()=>Zh.eO,Poll:()=>kp.sP,PollEvent:()=>kp.sn,Preset:()=>av.k,ProfileKeyMSC4175Timezone:()=>Ev,PushRuleActionName:()=>ov.YU,PushRuleKind:()=>ov.Ji,REFERENCE_RELATION:()=>yv.BJ,ReceiptType:()=>fv.L,RelatedRelations:()=>bv,RelationType:()=>np.zZ,Relations:()=>xv.s,RelationsEvent:()=>xv.S,RestrictedAllowType:()=>av.D7,Room:()=>Ap.Wv,RoomCreateTypeField:()=>np.Ct,RoomEvent:()=>Ap.u9,RoomMember:()=>Op.Y,RoomMemberEvent:()=>Op.o,RoomNameType:()=>Ap.bx,RoomState:()=>Hh.H,RoomStateEvent:()=>Hh.f,RoomSummary:()=>_v.c,RoomType:()=>np.CJ,RoomVersionStability:()=>vp.L,RoomWidgetClient:()=>hp,RoomWidgetClientEvent:()=>up,RuleId:()=>ov.kq,SERVICE_TYPES:()=>Kp.S,SSOAction:()=>mv,SUPPORTED_MATRIX_VERSIONS:()=>jp.Hr,SearchOrderBy:()=>lv.g,SearchResult:()=>Dp.q,SecretStorage:()=>Cv,ServerCapabilities:()=>vp.K,SetPresence:()=>ip.IU,SlidingSyncEvent:()=>Iv.cQ,StatsReport:()=>Rv.I,SyncAccumulator:()=>Ep,SyncState:()=>ip.Lm,THREAD_RELATION_TYPE:()=>Rp.RN,Thread:()=>Rp.jV,ThreadEvent:()=>Rp.ju,ThreadFilterType:()=>Rp.x3,ThreepidMedium:()=>hv,TimelineIndex:()=>Up,TimelineWindow:()=>Mp,ToDeviceMessageId:()=>np.wt,TweakName:()=>ov.QN,TypedEventEmitter:()=>xp.X,UNSIGNED_MEMBERSHIP_FIELD:()=>np.SY,UNSIGNED_THREAD_ID_FIELD:()=>np.Sr,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:()=>np.Ng,UNSTABLE_MSC2666_MUTUAL_ROOMS:()=>Zh.NB,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:()=>Zh.A0,UNSTABLE_MSC2666_SHARED_ROOMS:()=>Zh.uD,UNSTABLE_MSC2716_MARKER:()=>np.ge,UNSTABLE_MSC3088_ENABLED:()=>np.ud,UNSTABLE_MSC3088_PURPOSE:()=>np.D7,UNSTABLE_MSC3089_BRANCH:()=>np.iK,UNSTABLE_MSC3089_LEAF:()=>np.ID,UNSTABLE_MSC3089_TREE_SUBTYPE:()=>np.nN,UNSTABLE_MSC3852_LAST_SEEN_UA:()=>Zh.HF,UNSTABLE_MSC4133_EXTENDED_PROFILES:()=>Zh.jB,UNSTABLE_MSC4140_DELAYED_EVENTS:()=>Zh.rG,UpdateDelayedEventAction:()=>sv.e,User:()=>sp.K,UserEvent:()=>sp.U,Visibility:()=>av.bv,anySignal:()=>mp.JG,calculateRetryBackoff:()=>mp.fZ,completeAuthorizationCodeGrant:()=>Lp.SU,createClient:()=>Gv,createNewMatrixCall:()=>wv.sv,createRoomWidgetClient:()=>$v,decodeBase64:()=>Cp.y4,decodeIdToken:()=>Lp.Rh,determineFeatureSupport:()=>Rp.FD,discoverAndValidateOIDCIssuerWellKnown:()=>Lp.k8,encodeBase64:()=>Cp.WG,encodeUnpaddedBase64:()=>Cp.PP,encodeUnpaddedBase64Url:()=>Cp.A4,fixNotificationCountOnDecryption:()=>Zh.mD,generateAuthorizationParams:()=>Lp.P3,generateAuthorizationUrl:()=>Lp.cJ,generateOidcAuthorizationUrl:()=>Lp.R2,generateScope:()=>Lp.oE,getBeaconInfoIdentifier:()=>wp.M9,getHttpUriForMxc:()=>iv.y,inMainTimelineForReceipt:()=>Zh.fN,isDmMemberCountCondition:()=>ov.WM,isEventTypeSame:()=>yv.NY,isPollEvent:()=>kp.Wi,isTimestampInDuration:()=>wp.ai,localStorageErrorsEventsEmitter:()=>Pv,parseErrorResponse:()=>mp.xy,registerOidcClient:()=>Lp.aT,retryNetworkOperation:()=>mp.Y6,safeGetRetryAfterMs:()=>mp.eM,setCryptoStoreFactory:()=>Fv,threadFilterTypeToFilter:()=>Rp.UR,threadIdForReceipt:()=>Zh.Xb,timeoutSignal:()=>mp._,validateAuthMetadata:()=>Lp.EZ,validateAuthMetadataAndKeys:()=>Lp.Pl,validateBearerTokenResponse:()=>Lp.eC,validateIdToken:()=>Lp.rm,validateStoredUserState:()=>Lp.K8});var t=s(5921),n=s(4041),r=s(4623),i=s.n(r),o=s(3313),a=s(1936),l=s.n(a),c=s(7732),d=s(8312),u=s(4962);let h={params:{PARAM_DEMO_MODE:"demo",PARAM_SCANNING:"scanning",PARAM_HUFFMAN:"huffman",PARAM_DIR_INPUT:"direction",PARAM_RESET_DATABASE:"reset",PARAM_USE_GRIDSET_FILENAME:"gridset_filename",PARAM_USE_GRIDSET_URL:"gridset_url",PARAM_ELEMENT_HIGHLIGHT_IDS:"highlightIds",PARAM_LOCKED:"locked",PARAM_FULLSCREEN:"fullscreen"}},p=!1,v=!1;function m(e){let t=e.size>0?"?":"";history.replaceState(null,null,`${location.pathname}${t}${e.toString()}${location.hash}`)}function g(e){return new URLSearchParams(window.location.search).has(e)}function f(e){return new URLSearchParams(window.location.search).get(e)}function y(e){return"false"===f(e)}function _(e,t){let n=g(e),r=n&&!y(e);return t&&n&&h.removeParam(e),r}h.setParamsToSearchQuery=function(e={}){let t=new URLSearchParams(location.search);for(let n of Object.keys(e))e[n]?t.set(n,JSON.stringify(e[n])):t.delete(n);m(t)},h.getSearchQueryParams=function(e={}){let t=new URLSearchParams(location.search);Object.fromEntries||(Object.fromEntries=function(e){for(var t={},n=0;n<e.length;n++)t[e[n][0]]=e[n][1];return t});let n=Object.fromEntries(t);for(let e of Object.keys(n))try{n[e]=JSON.parse(n[e])}catch(e){}return Object.assign(n,e)},h.isDemoMode=function(){return p=p||g(h.params.PARAM_DEMO_MODE),function(e){if(!g(e))return;let t=new URLSearchParams(window.location.search);if(t.delete(e),history.replaceState){let e=t.toString().length>0?"?"+t.toString():"",n=window.location.protocol+"//"+window.location.host+window.location.pathname+e+window.location.hash;history.replaceState(null,"",n)}}(h.params.PARAM_DEMO_MODE),p},h.isFullscreen=function(e){return _(h.params.PARAM_FULLSCREEN,e)},h.isLocked=function(e){return _(h.params.PARAM_LOCKED,e)},h.isScanningEnabled=function(){return g(h.params.PARAM_SCANNING)&&!y(h.params.PARAM_SCANNING)},h.isDirectionEnabled=function(){return g(h.params.PARAM_DIR_INPUT)&&!y(h.params.PARAM_DIR_INPUT)},h.isHuffmanEnabled=function(){return g(h.params.PARAM_HUFFMAN)&&!y(h.params.PARAM_HUFFMAN)},h.shouldResetDatabase=function(){let e=!v&&(h.isDemoMode()||"true"===f(h.params.PARAM_RESET_DATABASE));return v=!0,e},h.getParam=function(e){return f(e)},h.removeParam=function(e){let t=new URLSearchParams(window.location.search);t.delete(e),m(t)};var E=s(8033);const b=PouchDB;var S=s.n(b),C=s(3734),w=s(9557),A=s(3866),T=s(583),I=s(5855),k=s(6152),O=s(1964),R=s(1540),x=s(4666),N=s(1683),D=s(367),L=s(2872);let P={},M=[];function U(e){let t=B(e);return t.push(E.H.encryptObject),t}function F(e){let t=B(e);return e.major&&t.unshift(E.H.decryptObjects),t}function B(e){if(e.major===u.S.getLatestModelVersion().major)return[];let t=[];switch(e.major){case 1:t.push((function(e,t){if(e){if(e.modelName===d.e.getModelName()){w.R.info("converting model version from V1 to V2: "+e.modelName);let t=e.inputConfig;t.dirInputs=A.R.DEFAULT_DIR_INPUTS,t.huffInputs=A.R.DEFAULT_HUFF_INPUTS,t.scanInputs=A.R.DEFAULT_SCAN_INPUTS,t.scanKey&&(t.scanInputs=[],t.scanInputs.push(new T.O({label:A.R.SELECT,keyCode:t.scanKey,keyName:t.scanKeyName})),t.scanEnabled=t.scanAutostart,t.scanAuto=t.scanAutostart,delete t.scanKey,delete t.scanKeyName,delete t.scanAutostart,delete t.areEvents,delete t.areURL)}return e.modelVersion=u.S.getModelVersionString(),e}}));case 2:t.push((function(e,t){if(e){if(e.modelName===c.D.getModelName()){w.R.debug("converting model version from V2 to V3: "+e.modelName);let t=e.locale||o.A.getContentLang();if("string"==typeof e.label){let n=e.label;e.label={},e.label[t]=n}else e.label={};e.gridElements.forEach((e=>{if("string"==typeof e.label){let n=e.label;e.label={},e.label[t]=n}else e.label={};e.actions.forEach((e=>{if(e.modelName===I.m.getModelName()){let n=e.speakText;e.speakText={},e.speakText[t]=n,e.speakLanguage=void 0}else e.modelName===k.v.getModelName()&&(e.speakLanguage=void 0)}))}))}return e.modelVersion=u.S.getModelVersionString(),e}}));case 3:t.push((function(e,t){if(e){if(e.modelName===c.D.getModelName()){w.R.debug("converting model version from V3 to V4: "+(e.label?e.label.de:""));for(let t=0;t<e.gridElements.length;t++){let n=e.gridElements[t];if(n.type===O.V.ELEMENT_TYPE_COLLECT){let r=new R.$;n.imageHeightPercentage=n.imageHeightPercentage?parseInt(n.imageHeightPercentage):85,Object.assign(r,n),r.actions=[new x.z({action:x.z.COLLECT_ACTION_SPEAK}),new N.G({suggestOnChange:!0})],e.gridElements[t]=r}}}return e.modelVersion=u.S.getModelVersionString(),e}}));case 4:t.push((function(e,t){if(e){if(e.modelName===c.D.getModelName())for(let t of e.gridElements)for(let e of t.actions)e.modelName!==D.g.getModelName()||e.navType||(e.modelVersion=u.S.getModelVersionString(),e.toHomeGrid?e.navType=D.g.NAV_TYPES.TO_HOME:e.toLastGrid?e.navType=D.g.NAV_TYPES.TO_LAST:e.navType=D.g.NAV_TYPES.TO_GRID);return e.modelVersion=u.S.getModelVersionString(),e}}));case 5:t.push((function(e,t){if(e){if(e.modelName===d.e.getModelName()){let t=e.localeConfig||{},r=new L.r(t),i=n.w.getUserSettings(),o=n.w.getAutologinUser()||n.w.getLastActiveUser();0!==Object.keys(i.voiceConfig).length||M.includes(o)||(M.push(o),i.voiceConfig=r,i.contentLang=i.contentLang||e.localeConfig.contentLang,n.w.saveUserSettings(i))}return e.modelVersion=u.S.getModelVersionString(),e}}))}return t}function G(e,r,i,o,a){let s=this,l=null,c=null,d=null,u=!0,h=C.A.DB_SYNC_STATE_FAIL,p=!1,v=null,m={};function g(e,t){let n=new(S())(e,{auto_compaction:!0});return n.info().then((function(t){return log.debug(e+" info:"),log.debug(t),Promise.resolve(n)}))}function f(){return c&&l?new Promise((async r=>{let i=(new Date).getTime();if(s.wasCurrentDatabaseSynced()||o)a(),r();else{log.debug("database wasn't synced before, so temporarily use remote db until sync is done..."),u=!1;let e=(await c.allDocs()).rows.map((e=>e.id));d=l.sync(c,{live:!1,retry:!1,style:"main_only",doc_ids:e}).on("active",(function(e){y(C.A.DB_SYNC_STATE_SYNCINC)})).on("paused",(function(){y(C.A.DB_SYNC_STATE_SYNCED)})).on("error",(function(e){log.info("couchdb error"),log.error(e),_()})).on("complete",(async function(e){log.debug("sync complete event"),log.debug(e);let n=e&&e.pull?e.pull.status:e&&e.push?e.push.status:null;"cancelled"===n?log.debug("sync cancelled!"):"complete"===n&&(log.info("couchdb sync complete! setting up live sync and using local db now..."),log.debug("initial sync took: "+((new Date).getTime()-i)+"ms"),u=!0,a((await c.changes({style:"main_only",limit:1,descending:!0})).results[0].seq),(0,t.A)(document).trigger(C.A.EVENT_DB_INITIAL_SYNC_COMPLETE))})),r()}function a(t){n.w.markSyncedDatabase(e),d=l.sync(c,{live:!0,retry:!1,style:"main_only",pull:{since:t||void 0}}).on("paused",(function(e){log.debug("sync paused"),log.debug(e),y(C.A.DB_SYNC_STATE_SYNCED)})).on("active",(function(e){log.debug("sync active"),log.debug(e),y(C.A.DB_SYNC_STATE_SYNCINC)})).on("change",(function(e){b(e)})).on("error",(function(e){log.info("couchdb error"),log.info(e),_()}))}})):(log.error("trying to setupSync() but remoteDb or db is not specified! Aborting..."),Promise.reject())}function y(e){if(!p)try{h=e,(0,t.A)(document).trigger(C.A.EVENT_DB_SYNC_STATE_CHANGE,e)}catch(e){log.error(e)}}function _(){p||(s.cancelSync(),c&&(c.close(),c=null),(0,t.A)(document).trigger(C.A.EVENT_DB_CONNECTION_LOST),y(C.A.DB_SYNC_STATE_FAIL))}function b(e){if(a)try{log.debug(e);let t=[],n=[];w(e.change?e.change.docs:null),e.direction&&"pull"===e.direction?(e.change&&e.change.docs&&e.change.docs.length>0&&(n=e.change.docs.filter((e=>!!T(e)&&!function(e){return m[T(e)]&&A(e)<m[T(e)]}(e))),t=n.map((e=>T(e)))),e.change.docs.length>0&&0===t.length?log.info("ignoring pull because of outdated revision"):log.info("pouchdb pulled updates...")):e.direction?log.info("pouchdb pushed updates..."):!e.direction&&e.id&&(log.info("change from remote database..."),t.push(e.id),e.doc&&n.push(e.doc)),!p&&(t.length>0||n.length>0)&&a(t,n)}catch(e){log.error(e)}}function w(e){e&&e.length>0&&e.forEach((e=>{let t=T(e),n=A(e);(!m[t]||m[t]<n)&&(m[t]=n)}))}function A(e){try{let t=function(e){return e._rev||e.rev}(e);return Number.parseInt(t.substring(0,t.indexOf("-")))}catch(e){return 0}}function T(e){return e._id||e.id}s.init=function(){if(!e)return Promise.reject();y(C.A.DB_SYNC_STATE_FAIL),i&&y(C.A.DB_SYNC_STATE_ONLINEONLY),log.debug("initializing database: "+e);let n=[];(!r||r&&!i)&&(v=g(e).then((e=>(l=e,Promise.resolve()))),n.push(v)),r&&n.push(g(r).then((e=>(c=e,i?(c.changes({since:"now",live:!0,include_docs:!0}).on("change",(function(e){b(e)})),Promise.resolve()):v.then((()=>f()))))));let o=Promise.all(n);return o.then((()=>{(0,t.A)(document).trigger(C.A.EVENT_DB_INITIALIZED)})),o},s.put=function(e){let t=s.getDbToUse().put(e);return t.then((e=>{w([e])})),t},s.bulkDocs=function(e){let t=s.getDbToUse().bulkDocs(e);return t.then((e=>{w([e])})),t},s.startSync=function(e){if(!c&&v)return v.then((()=>g(e))).then((e=>(c=e,f())));log.warn("startSync() is not possible if remote database is already open, or local database not opened")},s.getDbToUse=function(){let e=u&&!i?l:c;if(!e||p)throw"Using pouchDbService uninitialized is not possible. First initialize a database by using pouchDbService.initDatabase().";return e},s.close=function(){if(p)return Promise.resolve();let e=[];p=!0,E.H.resetEncryptionProperties(),s.cancelSync(),l&&e.push(l.close()),c&&e.push(c.close()),l=null,c=null;let n=Promise.all(e);return n.then((()=>{(0,t.A)(document).trigger(C.A.EVENT_DB_CLOSED)})),n},s.destroyDb=function(e){return s.close().then((()=>new(S())(e).destroy()))},s.getOpenedDatabaseName=function(){return e},s.wasCurrentDatabaseSynced=function(){return n.w.isDatabaseSynced(e)},s.isUsingLocalDb=function(){return u},s.getSyncState=function(){return h},s.isSyncEnabled=function(){return!!d},s.cancelSync=function(){d&&(log.debug("canceling sync ..."),y(C.A.DB_SYNC_STATE_STOPPED),d.cancel(),d=null)},s.resumeSync=function(e){return c||d||!e?i||d||!c?void 0:(log.debug("resuming sync..."),f()):s.startSync(e)}}P.convertLiveToDatabaseObjects=function(e,t){w.R.trace("conversion to database - before filters:",e);let n=u.S.convertObjects(e,U,t);return w.R.trace("conversion to database - after filters:",n),n},P.convertDatabaseToLiveObjects=function(e,t){w.R.trace("conversion to live - before filters:",e);let n=u.S.convertObjects(e,F,t);return w.R.trace("conversion to live - after filters:",n),n},P.updateDataModel=function(e){return u.S.convertObjects(e,B)};var V=s(4843);let j={},K=null,W=new V.X,q=null,H=!1,Y=null;function z(){return J().getDbToUse()}function J(){if(!K||!K.getDbToUse())throw"Using pouchDbService uninitialized is not possible. First initialize a database by using pouchDbService.initDatabase() or pouchDbService.createDatabase().";return K}function X(){q&&(clearTimeout(q),q=null),J().isUsingLocalDb()&&J().getSyncState()!==C.A.DB_SYNC_STATE_SYNCINC||J().cancelSync()}function Q(){if(H)return;let e=J().wasCurrentDatabaseSynced()?0:2e3;q=setTimeout((()=>{J().resumeSync()}),e)}function Z(e,r){r.forEach((e=>{e._deleted?W.clearAll():(W.set(e.id,e),W.clear(d.e.getIdPrefix()),W.clear(c.D.getIdPrefix()))}));let i=r.filter((e=>e._deleted)).map((e=>e._id));e=(r=r.filter((e=>!e._deleted))).map((e=>e.id));let o=r.map((e=>P.convertDatabaseToLiveObjects(e))),a=j.getOpenedDatabaseName(),s=n.w.getUserMajorModelVersion(a);o.forEach((e=>{n.w.setUserModelVersion(a,e.modelVersion)})),s===n.w.getUserMajorModelVersion(a)?((0,t.A)(document).trigger(C.A.EVENT_DB_PULL_UPDATED,[e,o,i]),serviceWorkerService.cacheImagesOfGrids(o)):(0,t.A)(document).trigger(C.A.EVENT_DB_DATAMODEL_UPDATE,[e,o,i])}j.initDatabase=function(e,n,r){return K&&K.getOpenedDatabaseName()===e&&n?H?(Y=n,(0,t.A)(document).trigger(C.A.EVENT_DB_SYNC_STATE_CHANGE,C.A.DB_SYNC_STATE_STOPPED),Promise.resolve()):K.startSync(n):(W.clearAll(),j.closeCurrentDatabase(),K=new G(e,n,r,!1,Z),K.init())},j.createDatabase=function(e,t,n){return W.clearAll(),j.closeCurrentDatabase(),K=new G(e,t,n,!0,Z),K.init()},j.all=function(e,t){if(t&&W.has(t))return log.debug("using cache for retrieving id: "+t),W.getAsPromise(t);if(!t&&e&&W.has(e))return log.debug("using cache for retrieving bulk with id-prefix: "+e),W.getAsPromise(e);let n=z();return X(),new Promise(((r,i)=>{let o={include_docs:!0,attachments:!1};t?o.key=t:e&&(o.startkey=e,o.endkey=e+"￿"),n.allDocs(o).then((function(n){let i=function(e){let t=[];return e.docs&&e.docs.length>0?e.docs.forEach((e=>{t.push(e)})):e.rows&&e.rows.length>0&&e.rows.forEach((e=>{e.doc&&e.doc.modelName&&t.push(e.doc)})),0===t.length?null:1===t.length?t[0]:t}(n);t&&i?W.set(t,i):!t&&e&&i&&W.set(e,i),r(i)})).catch((function(e){log.error(e),i()})).finally((()=>{Q()}))}))},j.allArray=async function(e,t){let n=await j.all(e,t);return Array.isArray(n)?n:n?[n]:[]},j.save=function(e,t){return log.debug("saving "+e+"..."),X(),t.id&&(W.clear(t.id,t),W.clear(e)),new Promise(((n,r)=>{if(!(t&&t._id&&e&&t.encryptedDataBase64))return log.error('did not specify needed parameter "idPrefix" or "_id" or data is not encrypted! aborting.'),r();K.put(t).then((r=>{t._rev=r.rev,W.set(t.id,t),log.debug("updated "+e+", id: "+t._id),n()})).catch((function(e){t.id&&W.clear(t.id),"conflict"===e.error?(log.warn("conflict with remote version updating document with id: "+t.id),n()):(log.error(e),r(e)),r()})).finally((()=>{Q()}))}))},j.bulkDocs=function(e){if(!(e&&e instanceof Array&&0!==e.length))return log.warn("bulkSave: no valid dataList"),Promise.reject();X(),W.clearAll();let t=K.bulkDocs(e);return t.finally((()=>{Q()})),t},j.remove=function(e){let t=z();return j.all(null,e).then((e=>(W.clearAll(),log.debug("deleted object from db! id: "+e.id),t.remove(e))))},j.resetDatabase=function(e){return j.isUsingLocalDb()&&j.getOpenedDatabaseName()===C.A.LOCAL_DEMO_USERNAME?(W.clearAll(),new Promise((t=>{K.destroyDb(e).then((function(){K=null,j.initDatabase(e).then((()=>t()))})).catch((function(e){log.error("error destroying database: "+e)}))}))):Promise.reject("do not destroy!")},j.deleteDatabase=function(e){if(j.getOpenedDatabaseName()===e&&!j.isUsingLocalDb()||!e)return log.warn("won't delete database since using remote db or databaseName not specified..."),Promise.reject();W.clearAll();let t=[];return j.getOpenedDatabaseName()===e&&t.push(j.closeCurrentDatabase()),Promise.all(t).then((()=>new(S())(e).destroy()))},j.closeCurrentDatabase=function(){if(!K)return Promise.resolve();X();let e=K.close();return K=null,e},j.getOpenedDatabaseName=function(){return K?K.getOpenedDatabaseName():null},j.isUsingLocalDb=function(){return K?K.isUsingLocalDb():null},j.getSyncState=function(){return K?K.getSyncState():null},j.isSyncEnabled=function(){return K?K.isSyncEnabled():null},j.pauseSync=function(){H=!0,J().cancelSync()},j.resumeSync=function(){H=!1,J().resumeSync(Y)};var ee=s(1547);let te={},ne=null,re=null;function ie(e,n,r){return ne=Promise.resolve().then((()=>{let e=[];return h.shouldResetDatabase()&&e.push(j.resetDatabase(n)),Promise.all(e)})).then((()=>j.allArray(d.e.getIdPrefix()))).then((t=>{let n=[];if(0===t.length){let i=new d.e;t=[i],E.H.setEncryptionProperties(e,i.id,r),n.push(oe(d.e.getIdPrefix(),i))}t.sort(((e,t)=>e.id.localeCompare(t.id)));let i=t.map((e=>e.id));return E.H.setEncryptionProperties(e,i,r),t.length&&t.length>1&&log.warn("found duplicated metadata!"),Promise.all(n)})),ne.then((()=>{re=null,(0,t.A)(document).trigger(C.A.EVENT_USER_CHANGED)})),ne}function oe(e,t){return new Promise(((n,r)=>{let i=P.convertLiveToDatabaseObjects(t);j.save(e,i).then((()=>{log.debug("saved "+e+", id: "+t.id),n()})).catch((function(e){r(e)}))}))}te.getObject=function(e,t,r){return ne?new Promise(((i,o)=>{ne.then((()=>{if(!e.getIdPrefix)return log.warn("missing method getIdPrefix() in allObjects()"),o();j.all(e.getIdPrefix(),t).then((t=>{let o={objectType:e,onlyShortVersion:r},a=P.convertDatabaseToLiveObjects(t,o),s=(l=a)?l.modelVersion?l.modelVersion:l[0]&&l[0].modelVersion?l[0].modelVersion:null:null;var l;s&&re!==s&&(re=s,n.w.setUserModelVersion(j.getOpenedDatabaseName(),s)),i(a)})).catch((e=>{o(e)}))}))})):Promise.resolve(null)},te.getSingleObject=function(e,t,n){return te.getObject(e,t,n).then((e=>Promise.resolve(e instanceof Array?e[0]:e)))},te.saveObject=function(e,t,n){return ne.then((()=>t&&e&&e.getModelName?t.isShortVersion?(log.warn("short versions of objects cannot be saved/updated! aborting."),Promise.reject()):(log.debug("saving "+e.getModelName()+"..."),te.getObject(e,t.id)):(log.error('did not specify needed parameter "objectType"!'),Promise.reject()))).then((r=>{if(r){log.debug(e.getModelName()+" already existing, doing update. id: "+r.id);let n=new e(t,r),i=JSON.parse(JSON.stringify(n));return i._id=r._id,i._rev=r._rev,oe(e.getIdPrefix(),i)}if(n)return log.warn("no existing "+e.getModelName()+" found to update, aborting."),Promise.reject();{let n=JSON.parse(JSON.stringify(t));return n._id=n.id,oe(e.getIdPrefix(),n)}}))},te.bulkSave=function(e){if(!e||0===e.length)return Promise.resolve();if(e[0].isShortVersion)return log.warn("not saving short version!"),Promise.resolve();let t=e.reduce(((e,t)=>e+(t.gridElements?t.gridElements.length:0)),0),n=Math.floor(t/e.length),r=P.convertLiveToDatabaseObjects(e),i=[];if(r.forEach((e=>{e._id=e.id})),t>1e3){let e=Math.floor(1e3/n);i=ee.Z.splitInChunks(r,e)}else i=[e];return function e(t){let n=JSON.parse(JSON.stringify(t.shift()));return j.bulkDocs(n).then((()=>t.length>0?e(t):Promise.resolve()))}(i)},te.bulkDelete=function(e){if(!e||0===e.length)return Promise.resolve();let t=e.map((e=>({_id:e.id,_rev:e._rev,_deleted:!0})));return j.bulkDocs(t)},te.removeObject=function(e){return j.remove(e)},te.initForUser=function(e,r,i,o){let a=i&&!o||!1,s=j.getOpenedDatabaseName()===e,l=-1!==n.w.getSavedLocalUsers().indexOf(e);return s&&a===j.isSyncEnabled()?Promise.resolve():((0,t.A)(document).trigger(C.A.EVENT_USER_CHANGING),j.initDatabase(e,i,o).then((()=>s?Promise.resolve():ie(r,e,l))))},te.registerForUser=function(e,t,r,i){let o=r&&!i,a=-1!==n.w.getSavedLocalUsers().indexOf(e);return j.getOpenedDatabaseName()===e&&o===j.isSyncEnabled()?Promise.resolve():j.createDatabase(e,r,i).then((()=>ie(t,e,a)))},te.deleteDatabase=function(e){if(e)return j.deleteDatabase(e)},te.closeCurrentDatabase=function(){return j.closeCurrentDatabase()},te.getCurrentUsedDatabase=function(){return j.getOpenedDatabaseName()};var ae=s(2867),se=s(1345);class le extends((0,se.K)({id:String,modelName:String,modelVersion:String,dictionaryKey:String,lang:[String],data:[String],isDefault:[Boolean]})){constructor(e,t){super(e=u.S.setDefaults(e,t,le)),this.id=this.id||u.S.generateId(le.getIdPrefix())}clone(){let e=new le(this);return delete e._id,delete e._rev,e.id=u.S.generateId("dictionary"),e.dictionaryKey=this.dictionaryKey+" (Copy)",e}static getModelName(){return"Dictionary"}static getIdPrefix(){return"dictionary"}}le.defaults({id:"",modelName:le.getModelName(),modelVersion:C.A.MODEL_VERSION,data:JSON.stringify({})});var ce=s(2649);let de={readZip:async function(e,t={}){t.jsonFileExtensions=t.jsonFileExtensions||[],t.progressFn=t.progressFn||(()=>{});let n={};const r=(await s.e(710).then(s.t.bind(s,1710,23))).default;let i=await r.loadAsync(e),o=[],a=Object.keys(i.files),l=0;for(let e of a){let r=i.files[e],s=t.defaultEncoding||"base64",c=t.jsonFileExtensions.some((t=>e.endsWith(`.${t}`)));s=c?"binarystring":s,o.push(Promise.resolve().then((async()=>{let i=await r.async(s);if(l++,t.progressFn(l/a.length*100),c)try{i=JSON.parse(i)}catch(t){log.warn("couldn't parse json from zip!",e),i=null}n[e]=i})))}return await Promise.all(o),n},createZip:async function(e={},t={}){t.progressFn=t.progressFn||(()=>{});let n=new(0,(await s.e(710).then(s.t.bind(s,1710,23))).default);for(let t of Object.keys(e)){let r=e[t];ee.Z.isString(r)||ArrayBuffer.isView(r)||(r=JSON.stringify(r)),n.file(t,r,{binary:!0})}return n.generateAsync({type:"blob"},(e=>{t.progressFn(e.percent)}))},readFileContent:function(e){return e?new Promise((t=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.onerror=e=>{log.warn("error reading file"),t(e.target.result)},n.readAsText(e,"UTF-8")})):Promise.resolve()},getFilename:function(e){return e&&e.name?e.name||"":e||""},getFileExtension:function(e){let t=de.getFilename(e);return t.substring(t.lastIndexOf(".")).toLowerCase()},isGrdFile:function(e){let t=de.getFilename(e);return".grd"===de.getFileExtension(e)||".txt"===de.getFileExtension(e)||t.endsWith(".grd.json")},isObfFile:function(e){return".obf"===de.getFileExtension(e)},isObzFile:function(e){return".obz"===de.getFileExtension(e)||".zip"===de.getFileExtension(e)},downloadFile:function(e,t={}){return new Promise((n=>{$.ajax({url:e,method:"GET",xhrFields:t.isBytes?{responseType:"blob"}:{},dataType:t.isBytes?void 0:"json"}).done((e=>{n(e)})).fail(((e,t,r)=>{console.warn(`Download failed: ${r}`),n(null)}))}))}};var ue=s(7410);let he={},pe="open-board-0.1",ve="boards/",me=".obf",ge="manifest.json";function fe(e,t){let n={id:e.id,label:o.A.getTranslation(e.label),background_color:e.backgroundColor},r=function(e){if(!e||!e.data&&!e.url)return null;let t={id:e.id||u.S.generateId(ce.q.getIdPrefix())};return e.data?t.data=e.data:e.url&&(t.url=e.url),t}(e.image);r&&(n.image_id=r.id,t.images.push(r));for(let t of e.actions)t.modelName===D.g.getModelName()&&(n.load_board={path:`${ve}${t.toGridId}${me}`});return n}he.gridDataToOBF=function(e,t){let n=new c.D(e).getWidthWithBounds(),r={format:pe,id:e.id,name:o.A.getTranslation(e.label),locale:o.A.getContentLang(),buttons:[],grid:{rows:e.rowCount,columns:n,order:new Array(e.rowCount).fill(null)},images:[]};r.grid.order=r.grid.order.map((()=>new Array(n).fill(null)));for(let t of e.gridElements){let e=fe(t,r);r.buttons.push(e),r.grid.order[t.y][t.x]=t.id}return r},he.backupDataToOBZ=async function(e,t={}){if(!e||!e.grids)return null;let n=e.metadata||await xg.getMetadata(),r={format:pe,root:n.homeGridId?`${ve}${n.homeGridId}${me}`:void 0,paths:{boards:{},images:{},sounds:{}}},i=[],o={};for(let t of e.grids){let e=he.gridDataToOBF(t,r);i.push(e)}for(let e of i)for(let t of e.buttons){let n=e.images.find((e=>e.id===t.image_id));if(n&&n.data){let e=ue.M.dataStringToFileSuffix(n.data),t=`images/${n.id}.${e}`;o[t]=ee.Z.base64ToBytes(ue.M.dataStringToBase64(n.data)),r.paths.images[n.id]=t,delete n.data,n.path=t}}for(let e of i){let t=`${ve}${e.id}${me}`;o[t]=e,r.paths.boards[e.id]=t}return o[ge]=r,de.createZip(o,t)},he.OBFToGridData=function(e,t){if(!e)return Promise.resolve(null);let n=[],r=e.locale?e.locale.toLowerCase():o.A.getContentLang(),i=o.A.getBaseLang(r);r=o.A.getAllLangCodes().includes(r)?r:o.A.getAllLangCodes().includes(i)?i:o.A.getContentLang(),e.grid=e.grid||{rows:1,columns:1,order:[]};let a=new c.D({obfId:e.id,label:o.A.getTranslationObject(e.name,r),rowCount:e.grid.rows,minColumnCount:e.grid.columns,gridElements:[]});return e.buttons.forEach((i=>{let s=function(e,t){let n=t.grid.order,r=null;return n.forEach(((t,n)=>{t.forEach(((t,i)=>{t===e&&(r={x:i,y:n})}))})),r}(i.id,e);if(s){let l=new O.V({width:1,height:1,label:o.A.getTranslationObject(i.label,r),x:s.x||0,y:s.y||0,backgroundColor:i.background_color,hidden:i.hidden});l=function(e,t,n,r){if(t.vocalization&&(e.actions=e.actions.filter((e=>e.modelName!==k.v.getModelName())),e.actions.push(new I.m({speakText:t.vocalization,speakLanguage:n.locale}))),t.load_board&&t.load_board.path){let n=function(e,t){if(!t)return null;let n=t[ge].paths.boards,r=null;return Object.keys(n).forEach((t=>{n[t]===e&&(r=t)})),r}(t.load_board.path,r);n&&e.actions.push(new D.g({navType:D.g.NAV_TYPES.TO_GRID,toGridId:n}))}return e}(l,i,e,t),l.actions.filter((e=>e.modelName===k.v.getModelName())).forEach((t=>{t.speakLanguage=e.locale})),n.push(function(e,t,n){let r=t.images.filter((t=>t.id===e))[0];if(!r)return Promise.resolve(null);let i=new ce.q;if(r.license&&(i.author=r.license.author_name,i.authorURL=r.license.author_url),r.url)return i.url=r.url,Promise.resolve(i);if(r.data)return i.data=r.data,Promise.resolve(i);if(r.path){let e=r.path.substring(r.path.lastIndexOf(".")),t=r.content_type||"image/png";t=".svg"===e?"image/svg+xml":t;let o=`data:${t};base64,`,a=n[r.path];return i.data=o+a,Promise.resolve(i)}return Promise.resolve(null)}(i.image_id,e,t).then((e=>(l.image=e,Promise.resolve())))),a.gridElements.push(l)}})),Promise.all(n).then((()=>Promise.resolve(a)))},he.OBZToImportData=async function(e){let t=[],n=e[ge],r=new d.e;for(let n of Object.keys(e))if(-1!==n.indexOf(".obf")){let r=await he.OBFToGridData(e[n],e);r&&t.push(r)}let i=t.reduce(((e,t)=>(e[t.obfId]=t.id,e)),{}),o=Object.keys(n.paths.boards),a=o.find((e=>n.paths.boards[e]===n.root));a=a||o[0],r.homeGridId=i[a];for(let e of t)for(let t of e.gridElements)for(let e of t.actions)if(e.modelName===D.g.getModelName()){let n=i[e.toGridId];n?e.toGridId=n:t.actions=t.actions.filter((t=>t.id!==e.id))}for(let e of t)delete e.obfId;return{grids:t,metadata:JSON.parse(JSON.stringify(r))}};let ye={createItem:function(e,t){if(!e)throw'parameter "word" must be specified.';let n=parseInt(t),r={w:e,f:0,t:{}};var i;return(i=n)==parseInt(i)&&(r.r=n),r}};const _e=ye,Ee=function(){let e=this,t={},n=null,r=null;function i(e){if(!e)return[];let n=[];return t[e]&&n.push(t[e]),t[e.toLowerCase()]&&-1===n.indexOf(t[e.toLowerCase()])&&n.push(t[e.toLowerCase()]),t[e.toUpperCase()]&&-1===n.indexOf(t[e.toUpperCase()])&&n.push(t[e.toUpperCase()]),t[a(e)]&&-1===n.indexOf(t[a(e)])&&n.push(t[a(e)]),n}function o(e){let t=i(e);return t.length>0?t[0]:null}function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.load=function(e){let n=JSON.parse(e);Object.keys(n).forEach((e=>{n[e].w=e})),t=n},e.toJSON=function(){let e=JSON.parse(JSON.stringify(t));return Object.keys(e).forEach((t=>{delete e[t].w})),JSON.stringify(e)},e.addWord=function(e,n){e&&(t[e]||(t[e]=_e.createItem(e,n)))},e.addWords=function(t){if(!(t instanceof Array)||0===t.length)throw"words to add must be an array with at least one element.";t.forEach((t=>{e.addWord(t)}))},e.deleteWord=function(e,n){Object.keys(t).forEach((r=>{if(n?e.toUpperCase()===r.toUpperCase():e===r)delete t[r];else{let i=t[r];Object.keys(i.t).forEach((t=>{(n?e.toUpperCase()===t.toUpperCase():e===t)&&delete i.t[t]}))}}))},e.contains=function(e,n){return n?!!t[e]:!!o(e)},e.predictCompleteWord=function(i,o){i=i||"",o=o||{};let a=[];if(Object.keys(t).forEach((e=>{0===e.toLowerCase().indexOf(i.toLowerCase())&&a.push(t[e])})),0===a.length&&i.length>1){let t=null;return t=n&&r&&0===i.indexOf(n)?r:e.predictCompleteWord(i.substring(0,i.length-1),o),t.forEach((e=>{e.fuzzyMatch=!0})),t}return n=i,r=a.map((e=>({word:e.w,frequency:e.f,rank:e.r}))),r},e.predictNextWord=function(e,t){let n=i(e),r=[];return n.forEach((e=>{Object.keys(e.t).forEach((t=>{r.push({word:t,frequency:e.t[t]})}))})),r},e.learn=function(t,n,r){if(!t||!e.contains(t)&&!r)return;r&&t&&!e.contains(t)&&e.addWord(t),r&&n&&!e.contains(n)&&e.addWord(n);let i=o(n),a=o(t);a.f++,i&&i.t&&(i.t[a.w]?i.t[a.w]++:i.t[a.w]=1)},e.getWords=function(){return Object.keys(t)}};let be="[\\s\\.\\?!,]";function Se(){this.DEFAULT_DICTIONARY_KEY="DEFAULT_DICTIONARY_KEY";let e=this,t="PREDICT_METHOD_COMPLETE_WORD",n="PREDICT_METHOD_NEXT_WORD",r={},i=null;function o(i,o,a){let s=[];(o=o||{}).maxPredictions=o.maxPredictions||o.maxPredicitons||10,o.applyToInput=o.applyToInput||!1,Object.keys(r).forEach((e=>{let l=r[e];if(!l.disabled){let e=a===n?l.predictNextWord:a===t?l.predictCompleteWord:null;e=e||(we(i)?l.predictNextWord:l.predictCompleteWord),s=s.concat(e(Ce(i),o))}})),s.sort(((e,t)=>e.fuzzyMatch!==t.fuzzyMatch?e.fuzzyMatch?1:-1:e.frequency!==t.frequency?e.frequency<t.frequency?1:-1:e.rank!==t.rank?e.rank&&void 0===t.rank?-1:t.rank&&void 0===e.rank?1:e.rank<t.rank?-1:1:0));let l=[];for(let t=0;t<s.length&&l.length<o.maxPredictions;t++)-1===l.indexOf(s[t].word)&&(o.applyToInput?l.push(e.applyPrediction(i,s[t].word,{dontLearn:!0})):l.push(s[t].word));return l}this.loadDictionary=function(t,n){if(!t)throw"dictionaryJSON must be specified.";n=n||e.DEFAULT_DICTIONARY_KEY;let i=new Ee;i.load(t),r[n]=i},this.loadDictionaries=function(t){if(!t)throw"dictionariesJSON must be specified.";r={},JSON.parse(t).forEach((t=>{e.loadDictionary(t.json,t.key)}))},this.dictionaryToJSON=function(t){t=t||e.DEFAULT_DICTIONARY_KEY;let n=r[t];return n?n.toJSON():null},this.dictionariesToJSON=function(){let e=[];return Object.keys(r).forEach((t=>{e.push({key:t,json:r[t].toJSON()})})),JSON.stringify(e)},this.useDictionary=function(e){if(!e)throw"dictionaryKey must be specified.";Object.keys(r).forEach((t=>{r[t].disabled=e!==t}))},this.useDictionaries=function(t){if(!(t instanceof Array))throw"dictionaryKeys must be specified and of type Array.";Object.keys(r).forEach((n=>{r[n].disabled=-1===t.indexOf(n)&&n!==e.DEFAULT_DICTIONARY_KEY}))},this.useAllDictionaries=function(){Object.keys(r).forEach((e=>{r[e].disabled=!1}))},this.addDictionary=function(t,n){if(!t)throw"dictionaryKey must be specified.";if(r[t])throw"dictionary already existing.";r[t]=new Ee,n&&n instanceof Array&&n.forEach((n=>{e.addWord(n,t)}))},this.addWord=function(t,n){if(n=n||e.DEFAULT_DICTIONARY_KEY,!t)throw"element to add not specified.";r[n]||e.addDictionary(n);let i=r[n];"string"==typeof t?i.addWord(Ae(t)):t.word&&"string"==typeof t.word&&i.addWord(Ae(t.word),t.rank)},this.addWords=function(t,n){if(!(t instanceof Array))throw"elements to add must be instance of array specified.";t.forEach((t=>{e.addWord(t,n)}))},this.delete=function(t,n){let i=Ce(t);n=n||{},i&&(n.dictionaryKey?r[n.dictionaryKey]&&r[n.dictionaryKey].deleteWord(i,n.ignoreCase):e.getDictionaryKeys().forEach((e=>{r[e].deleteWord(i,n.ignoreCase)})))},this.parseWords=function(t,n){let r=(n=n||{}).elementSeparator||";",i=n.rankSeparator||" ",o=n.wordPosition||0,a=n.wordPosition2,s=n.rankPosition,l=!!n.rankIsIndex,c=n.addToDictionary||e.DEFAULT_DICTIONARY_KEY;t.split(r).forEach(((t,n)=>{let r=t.split(i),d=l?n+1:parseInt(r[s]);if(void 0!==o&&void 0!==a){let t=r[o],n=r[a];t&&n&&e.learn(n,t,c)}else if(r[o]){let t={word:r[o].trim()};isNaN(d)||(t.rank=d),e.addWord(t,c)}}))},this.getWords=function(t){let n=[];return t?r[t]&&(n=r[t].getWords()):e.getDictionaryKeys().forEach((e=>{n=n.concat(r[e].getWords())})),n},this.hasWord=function(t,n,r){let i=" "+e.getWords(n).join(" ")+" ";return new RegExp(" "+t+" ",r?"":"i").test(i)},this.predict=function(e,t){return o(e,t)},this.predictCompleteWord=function(e,n){return o(e,n,t)},this.predictNextWord=function(e,t){return o(e,t,n)},this.applyPrediction=function(t,n,r){let i=(r=r||{}).addToDictionary||(e.isUsingOnlyDefaultDictionary()?e.DEFAULT_DICTIONARY_KEY:null),o=void 0!==r.shouldCompleteLastWord?r.shouldCompleteLastWord:!we(t),a=r.dontLearn,s=Ce(t),l=Ce(t,2),c=o?t.substring(0,t.lastIndexOf(s)):t;return c.length>0&&(!we(c)||new RegExp("[\\.\\?!,]").test(c[c.length-1]))&&(c+=" "),a||e.learn(n,o?l:s,i),c+n+" "},this.learn=function(t,n,i){t=Ae(t),n=Ae(n);let o=e.getDictionaryKeys(!0);if(i=1===o.length?o[0]:i,o.length>0&&(!i||!r[i])){let r=0;o.forEach((o=>{let a=0;e.hasWord(t,o)&&(a+=2),e.hasWord(n,o)&&a++,a>0&&a>=r&&(r=a,i=o)}))}i=i||e.DEFAULT_DICTIONARY_KEY,r[i]||e.addDictionary(i),Object.keys(r).forEach((e=>{let o=r[e];o.disabled||o.learn(t,n,i===e)}))},this.learnFromInput=function(t,n){if(we(t)){let r=Ce(t,2),o=Ce(t,3);if(r&&r!==i)return i=r,e.learn(r,o,n),!0}return!1},this.learnFromText=function(e,t){(e=e.replace(/\s\s/g," ")).split(new RegExp("[\\.\\?!]")).forEach((e=>{let n=e.split(" ");for(let e=0;e<n.length-1;e++)this.learn(n[e+1],n[e],t)}))},this.getDictionaryKeys=function(e){return e?Object.keys(r).filter((e=>!r[e].disabled)):Object.keys(r)},this.isUsingOnlyDefaultDictionary=function(){let t=e.getDictionaryKeys();return 0===t.length||1===t.length&&t[0]===e.DEFAULT_DICTIONARY_KEY}}function Ce(e,t){t=t||1;let n=e.trim().split(new RegExp(be)).filter((e=>!!e));return(n[n.length-t]||"").replace(new RegExp(be,"g"),"")}function we(e){return new RegExp(be).test(e[e.length-1])}function Ae(e){return(e=e||"").replace(/[!?,;.:\n]/gim,"").trim()}Se.instance=function(){return new Se};const Te=Se;let Ie={},ke=null,Oe=[],Re=[],xe=!1,Ne=[],De=null,Le=null,Pe=null,Me=null,Ue={};function Fe(){xe&&ke&&(xe=!1,Ne.forEach((e=>{let t=Re.filter((t=>t.dictionaryKey===e))[0]||new le({dictionaryKey:e});t.data=ke.dictionaryToJSON(e),xg.saveDictionary(t)})))}async function Be(){let e=await xg.getMetadata();Pe=e.textConfig.convertMode}Ie.predict=function(e,n){if(void 0===e||0===Oe.length||!ke)return;if(n===N.G.USE_DICTIONARY_CURRENT_LANG){let e=Re.filter((e=>e.lang===o.A.getContentLang())).map((e=>e.dictionaryKey));ke.useDictionaries(e),Ne=e}else n?(ke.useDictionary(n),-1===Ne.indexOf(n)&&Ne.push(n)):(ke.useAllDictionaries(),Ne=ke.getDictionaryKeys());let r=ke.predict(e,{maxPredicitons:Oe.length});0===r.length&&(r=ke.predict("",{maxPredicitons:Oe.length}));for(let e=0;e<Oe.length;e++){let n=r[e]?r[e]:"";n=ee.Z.convertLowerUppercase(n,Pe),(0,t.A)(document).trigger(C.A.EVENT_ELEM_TEXT_CHANGED,[Oe[e].id,n]),Ue[Oe[e].id]=n,(0,t.A)(`#${Oe[e].id}`).attr("aria-label",`${n}, ${o.A.t("ELEMENT_TYPE_PREDICTION")}`)}},Ie.learnFromInput=function(e,t){e&&e.trim()&&0!==Oe.length&&ke&&(xe=ke.learnFromInput(e,t)||xe)},Ie.initWithElements=async function(e){Oe=[],Ue={},e.forEach((e=>{e&&e.type===O.V.ELEMENT_TYPE_PREDICTION&&Oe.push(JSON.parse(JSON.stringify(e)))})),Oe=Oe.sort(((e,t)=>e.y!==t.y?e.y<t.y?-1:1:e.x!==t.x?e.x<t.x?-1:1:0)),Oe.length>0&&await Ie.initIfNewUser(),Fe()},Ie.applyPrediction=function(e,t,n){if(0!==Oe.length&&ke)return xe=!0,Me=t,ke.applyPrediction(e,t,{addToDictionary:n})},Ie.getLastAppliedPrediction=function(){return Me},Ie.doAction=function(e){if(!ke)return;let n=Oe.filter((t=>t.id===e))[0];if(n){let e=(0,t.A)(`#${n.id} .text-container span`).text();ke.learn(e),xe=!0}},Ie.getDictionaryKeys=function(){return ke?ke.getDictionaryKeys():[]},Ie.init=async function(){return log.debug("init prediction service"),Le=n.w.getAutologinUser()||n.w.getLastActiveUser(),clearInterval(De),xe=!1,ke=Te.instance(),xg.getDictionaries().then((e=>(Re=e,e.forEach((e=>{ke.loadDictionary(e.data,e.dictionaryKey)})),De=setInterval(Fe,6e5),Promise.resolve())))},Ie.initIfNewUser=async function(){let e=n.w.getAutologinUser()||n.w.getLastActiveUser();Le!==e&&await Ie.init()},Ie.stopAutosave=function(){clearInterval(De)},Ie.getCurrentValue=function(e){return Ue[e]},(0,t.A)(document).on(C.A.EVENT_DB_PULL_UPDATED,((e,t,n)=>{n.map((e=>e.modelName)).indexOf(le.getModelName())>-1&&Ie.init()})),(0,t.A)(document).on(C.A.EVENT_USER_CHANGING,(()=>{Ie.stopAutosave()})),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Be),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,Be);var Ge=s(8923),$e=s(5888),Ve=Object.freeze({}),je=Array.isArray;function Ke(e){return null==e}function We(e){return null!=e}function qe(e){return!0===e}function He(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function Ye(e){return"function"==typeof e}function ze(e){return null!==e&&"object"==typeof e}var Je=Object.prototype.toString;function Xe(e){return"[object Object]"===Je.call(e)}function Qe(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function Ze(e){return We(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function et(e){return null==e?"":Array.isArray(e)||Xe(e)&&e.toString===Je?JSON.stringify(e,tt,2):String(e)}function tt(e,t){return t&&t.__v_isRef?t.value:t}function nt(e){var t=parseFloat(e);return isNaN(t)?e:t}function rt(e,t){for(var n=Object.create(null),r=e.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}var it=rt("slot,component",!0),ot=rt("key,ref,slot,slot-scope,is");function at(e,t){var n=e.length;if(n){if(t===e[n-1])return void(e.length=n-1);var r=e.indexOf(t);if(r>-1)return e.splice(r,1)}}var st=Object.prototype.hasOwnProperty;function lt(e,t){return st.call(e,t)}function ct(e){var t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}var dt=/-(\w)/g,ut=ct((function(e){return e.replace(dt,(function(e,t){return t?t.toUpperCase():""}))})),ht=ct((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})),pt=/\B([A-Z])/g,vt=ct((function(e){return e.replace(pt,"-$1").toLowerCase()})),mt=Function.prototype.bind?function(e,t){return e.bind(t)}:function(e,t){function n(n){var r=arguments.length;return r?r>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n};function gt(e,t){t=t||0;for(var n=e.length-t,r=new Array(n);n--;)r[n]=e[n+t];return r}function ft(e,t){for(var n in t)e[n]=t[n];return e}function yt(e){for(var t={},n=0;n<e.length;n++)e[n]&&ft(t,e[n]);return t}function _t(e,t,n){}var Et=function(e,t,n){return!1},bt=function(e){return e};function St(e,t){if(e===t)return!0;var n=ze(e),r=ze(t);if(!n||!r)return!n&&!r&&String(e)===String(t);try{var i=Array.isArray(e),o=Array.isArray(t);if(i&&o)return e.length===t.length&&e.every((function(e,n){return St(e,t[n])}));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(i||o)return!1;var a=Object.keys(e),s=Object.keys(t);return a.length===s.length&&a.every((function(n){return St(e[n],t[n])}))}catch(e){return!1}}function Ct(e,t){for(var n=0;n<e.length;n++)if(St(e[n],t))return n;return-1}function wt(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var At="data-server-rendered",Tt=["component","directive","filter"],It=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],kt={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:Et,isReservedAttr:Et,isUnknownElement:Et,getTagNamespace:_t,parsePlatformTagName:bt,mustUseProp:Et,async:!0,_lifecycleHooks:It},Ot=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function Rt(e){var t=(e+"").charCodeAt(0);return 36===t||95===t}function xt(e,t,n,r){Object.defineProperty(e,t,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var Nt=new RegExp("[^".concat(Ot.source,".$_\\d]")),Dt="__proto__"in{},Lt="undefined"!=typeof window,Pt=Lt&&window.navigator.userAgent.toLowerCase(),Mt=Pt&&/msie|trident/.test(Pt),Ut=Pt&&Pt.indexOf("msie 9.0")>0,Ft=Pt&&Pt.indexOf("edge/")>0;Pt&&Pt.indexOf("android");var Bt=Pt&&/iphone|ipad|ipod|ios/.test(Pt);Pt&&/chrome\/\d+/.test(Pt),Pt&&/phantomjs/.test(Pt);var Gt,$t=Pt&&Pt.match(/firefox\/(\d+)/),Vt={}.watch,jt=!1;if(Lt)try{var Kt={};Object.defineProperty(Kt,"passive",{get:function(){jt=!0}}),window.addEventListener("test-passive",null,Kt)}catch(e){}var Wt=function(){return void 0===Gt&&(Gt=!Lt&&void 0!==s.g&&s.g.process&&"server"===s.g.process.env.VUE_ENV),Gt},qt=Lt&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function Ht(e){return"function"==typeof e&&/native code/.test(e.toString())}var Yt,zt="undefined"!=typeof Symbol&&Ht(Symbol)&&"undefined"!=typeof Reflect&&Ht(Reflect.ownKeys);Yt="undefined"!=typeof Set&&Ht(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var Jt=null;function Xt(e){void 0===e&&(e=null),e||Jt&&Jt._scope.off(),Jt=e,e&&e._scope.on()}var Qt=function(){function e(e,t,n,r,i,o,a,s){this.tag=e,this.data=t,this.children=n,this.text=r,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(e.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),e}(),Zt=function(e){void 0===e&&(e="");var t=new Qt;return t.text=e,t.isComment=!0,t};function en(e){return new Qt(void 0,void 0,void 0,String(e))}function tn(e){var t=new Qt(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}"function"==typeof SuppressedError&&SuppressedError;var nn=0,rn=[],on=function(){for(var e=0;e<rn.length;e++){var t=rn[e];t.subs=t.subs.filter((function(e){return e})),t._pending=!1}rn.length=0},an=function(){function e(){this._pending=!1,this.id=nn++,this.subs=[]}return e.prototype.addSub=function(e){this.subs.push(e)},e.prototype.removeSub=function(e){this.subs[this.subs.indexOf(e)]=null,this._pending||(this._pending=!0,rn.push(this))},e.prototype.depend=function(t){e.target&&e.target.addDep(this)},e.prototype.notify=function(e){for(var t=this.subs.filter((function(e){return e})),n=0,r=t.length;n<r;n++)t[n].update()},e}();an.target=null;var sn=[];function ln(e){sn.push(e),an.target=e}function cn(){sn.pop(),an.target=sn[sn.length-1]}var dn=Array.prototype,un=Object.create(dn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(e){var t=dn[e];xt(un,e,(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i,o=t.apply(this,n),a=this.__ob__;switch(e){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2)}return i&&a.observeArray(i),a.dep.notify(),o}))}));var hn=Object.getOwnPropertyNames(un),pn={},vn=!0;function mn(e){vn=e}var gn={notify:_t,depend:_t,addSub:_t,removeSub:_t},fn=function(){function e(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),this.value=e,this.shallow=t,this.mock=n,this.dep=n?gn:new an,this.vmCount=0,xt(e,"__ob__",this),je(e)){if(!n)if(Dt)e.__proto__=un;else for(var r=0,i=hn.length;r<i;r++)xt(e,a=hn[r],un[a]);t||this.observeArray(e)}else{var o=Object.keys(e);for(r=0;r<o.length;r++){var a;_n(e,a=o[r],pn,void 0,t,n)}}}return e.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)yn(e[t],!1,this.mock)},e}();function yn(e,t,n){return e&&lt(e,"__ob__")&&e.__ob__ instanceof fn?e.__ob__:!vn||!n&&Wt()||!je(e)&&!Xe(e)||!Object.isExtensible(e)||e.__v_skip||An(e)||e instanceof Qt?void 0:new fn(e,t,n)}function _n(e,t,n,r,i,o,a){void 0===a&&(a=!1);var s=new an,l=Object.getOwnPropertyDescriptor(e,t);if(!l||!1!==l.configurable){var c=l&&l.get,d=l&&l.set;c&&!d||n!==pn&&2!==arguments.length||(n=e[t]);var u=i?n&&n.__ob__:yn(n,!1,o);return Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=c?c.call(e):n;return an.target&&(s.depend(),u&&(u.dep.depend(),je(t)&&Sn(t))),An(t)&&!i?t.value:t},set:function(t){var r,a,l=c?c.call(e):n;if((r=l)===(a=t)?0===r&&1/r!=1/a:r==r||a==a){if(d)d.call(e,t);else{if(c)return;if(!i&&An(l)&&!An(t))return void(l.value=t);n=t}u=i?t&&t.__ob__:yn(t,!1,o),s.notify()}}}),s}}function En(e,t,n){if(!wn(e)){var r=e.__ob__;return je(e)&&Qe(t)?(e.length=Math.max(e.length,t),e.splice(t,1,n),r&&!r.shallow&&r.mock&&yn(n,!1,!0),n):t in e&&!(t in Object.prototype)?(e[t]=n,n):e._isVue||r&&r.vmCount?n:r?(_n(r.value,t,n,void 0,r.shallow,r.mock),r.dep.notify(),n):(e[t]=n,n)}}function bn(e,t){if(je(e)&&Qe(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||wn(e)||lt(e,t)&&(delete e[t],n&&n.dep.notify())}}function Sn(e){for(var t=void 0,n=0,r=e.length;n<r;n++)(t=e[n])&&t.__ob__&&t.__ob__.dep.depend(),je(t)&&Sn(t)}function Cn(e){return function(e,t){wn(e)||yn(e,t,Wt())}(e,!0),xt(e,"__v_isShallow",!0),e}function wn(e){return!(!e||!e.__v_isReadonly)}function An(e){return!(!e||!0!==e.__v_isRef)}function Tn(e,t,n){Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(){var e=t[n];if(An(e))return e.value;var r=e&&e.__ob__;return r&&r.dep.depend(),e},set:function(e){var r=t[n];An(r)&&!An(e)?r.value=e:t[n]=e}})}var In=ct((function(e){var t="&"===e.charAt(0),n="~"===(e=t?e.slice(1):e).charAt(0),r="!"===(e=n?e.slice(1):e).charAt(0);return{name:e=r?e.slice(1):e,once:n,capture:r,passive:t}}));function kn(e,t){function n(){var e=n.fns;if(!je(e))return Fr(e,null,arguments,t,"v-on handler");for(var r=e.slice(),i=0;i<r.length;i++)Fr(r[i],null,arguments,t,"v-on handler")}return n.fns=e,n}function On(e,t,n,r,i,o){var a,s,l,c;for(a in e)s=e[a],l=t[a],c=In(a),Ke(s)||(Ke(l)?(Ke(s.fns)&&(s=e[a]=kn(s,o)),qe(c.once)&&(s=e[a]=i(c.name,s,c.capture)),n(c.name,s,c.capture,c.passive,c.params)):s!==l&&(l.fns=s,e[a]=l));for(a in t)Ke(e[a])&&r((c=In(a)).name,t[a],c.capture)}function Rn(e,t,n){var r;e instanceof Qt&&(e=e.data.hook||(e.data.hook={}));var i=e[t];function o(){n.apply(this,arguments),at(r.fns,o)}Ke(i)?r=kn([o]):We(i.fns)&&qe(i.merged)?(r=i).fns.push(o):r=kn([i,o]),r.merged=!0,e[t]=r}function xn(e,t,n,r,i){if(We(t)){if(lt(t,n))return e[n]=t[n],i||delete t[n],!0;if(lt(t,r))return e[n]=t[r],i||delete t[r],!0}return!1}function Nn(e){return He(e)?[en(e)]:je(e)?Ln(e):void 0}function Dn(e){return We(e)&&We(e.text)&&!1===e.isComment}function Ln(e,t){var n,r,i,o,a=[];for(n=0;n<e.length;n++)Ke(r=e[n])||"boolean"==typeof r||(o=a[i=a.length-1],je(r)?r.length>0&&(Dn((r=Ln(r,"".concat(t||"","_").concat(n)))[0])&&Dn(o)&&(a[i]=en(o.text+r[0].text),r.shift()),a.push.apply(a,r)):He(r)?Dn(o)?a[i]=en(o.text+r):""!==r&&a.push(en(r)):Dn(r)&&Dn(o)?a[i]=en(o.text+r.text):(qe(e._isVList)&&We(r.tag)&&Ke(r.key)&&We(t)&&(r.key="__vlist".concat(t,"_").concat(n,"__")),a.push(r)));return a}var Pn=1,Mn=2;function Un(e,t,n,r,i,o){return(je(n)||He(n))&&(i=r,r=n,n=void 0),qe(o)&&(i=Mn),function(e,t,n,r,i){if(We(n)&&We(n.__ob__))return Zt();if(We(n)&&We(n.is)&&(t=n.is),!t)return Zt();var o,a;if(je(r)&&Ye(r[0])&&((n=n||{}).scopedSlots={default:r[0]},r.length=0),i===Mn?r=Nn(r):i===Pn&&(r=function(e){for(var t=0;t<e.length;t++)if(je(e[t]))return Array.prototype.concat.apply([],e);return e}(r)),"string"==typeof t){var s=void 0;a=e.$vnode&&e.$vnode.ns||kt.getTagNamespace(t),o=kt.isReservedTag(t)?new Qt(kt.parsePlatformTagName(t),n,r,void 0,void 0,e):n&&n.pre||!We(s=Ri(e.$options,"components",t))?new Qt(t,n,r,void 0,void 0,e):Ei(s,n,e,r,t)}else o=Ei(t,n,e,r);return je(o)?o:We(o)?(We(a)&&Fn(o,a),We(n)&&function(e){ze(e.style)&&Zr(e.style),ze(e.class)&&Zr(e.class)}(n),o):Zt()}(e,t,n,r,i)}function Fn(e,t,n){if(e.ns=t,"foreignObject"===e.tag&&(t=void 0,n=!0),We(e.children))for(var r=0,i=e.children.length;r<i;r++){var o=e.children[r];We(o.tag)&&(Ke(o.ns)||qe(n)&&"svg"!==o.tag)&&Fn(o,t,n)}}function Bn(e,t){var n,r,i,o,a=null;if(je(e)||"string"==typeof e)for(a=new Array(e.length),n=0,r=e.length;n<r;n++)a[n]=t(e[n],n);else if("number"==typeof e)for(a=new Array(e),n=0;n<e;n++)a[n]=t(n+1,n);else if(ze(e))if(zt&&e[Symbol.iterator]){a=[];for(var s=e[Symbol.iterator](),l=s.next();!l.done;)a.push(t(l.value,a.length)),l=s.next()}else for(i=Object.keys(e),a=new Array(i.length),n=0,r=i.length;n<r;n++)o=i[n],a[n]=t(e[o],o,n);return We(a)||(a=[]),a._isVList=!0,a}function Gn(e,t,n,r){var i,o=this.$scopedSlots[e];o?(n=n||{},r&&(n=ft(ft({},r),n)),i=o(n)||(Ye(t)?t():t)):i=this.$slots[e]||(Ye(t)?t():t);var a=n&&n.slot;return a?this.$createElement("template",{slot:a},i):i}function $n(e){return Ri(this.$options,"filters",e)||bt}function Vn(e,t){return je(e)?-1===e.indexOf(t):e!==t}function jn(e,t,n,r,i){var o=kt.keyCodes[t]||n;return i&&r&&!kt.keyCodes[t]?Vn(i,r):o?Vn(o,e):r?vt(r)!==t:void 0===e}function Kn(e,t,n,r,i){if(n&&ze(n)){je(n)&&(n=yt(n));var o=void 0,a=function(a){if("class"===a||"style"===a||ot(a))o=e;else{var s=e.attrs&&e.attrs.type;o=r||kt.mustUseProp(t,s,a)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var l=ut(a),c=vt(a);l in o||c in o||(o[a]=n[a],i&&((e.on||(e.on={}))["update:".concat(a)]=function(e){n[a]=e}))};for(var s in n)a(s)}return e}function Wn(e,t){var n=this._staticTrees||(this._staticTrees=[]),r=n[e];return r&&!t||Hn(r=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,this._c,this),"__static__".concat(e),!1),r}function qn(e,t,n){return Hn(e,"__once__".concat(t).concat(n?"_".concat(n):""),!0),e}function Hn(e,t,n){if(je(e))for(var r=0;r<e.length;r++)e[r]&&"string"!=typeof e[r]&&Yn(e[r],"".concat(t,"_").concat(r),n);else Yn(e,t,n)}function Yn(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function zn(e,t){if(t&&Xe(t)){var n=e.on=e.on?ft({},e.on):{};for(var r in t){var i=n[r],o=t[r];n[r]=i?[].concat(i,o):o}}return e}function Jn(e,t,n,r){t=t||{$stable:!n};for(var i=0;i<e.length;i++){var o=e[i];je(o)?Jn(o,t,n):o&&(o.proxy&&(o.fn.proxy=!0),t[o.key]=o.fn)}return r&&(t.$key=r),t}function Xn(e,t){for(var n=0;n<t.length;n+=2){var r=t[n];"string"==typeof r&&r&&(e[t[n]]=t[n+1])}return e}function Qn(e,t){return"string"==typeof e?t+e:e}function Zn(e){e._o=qn,e._n=nt,e._s=et,e._l=Bn,e._t=Gn,e._q=St,e._i=Ct,e._m=Wn,e._f=$n,e._k=jn,e._b=Kn,e._v=en,e._e=Zt,e._u=Jn,e._g=zn,e._d=Xn,e._p=Qn}function er(e,t){if(!e||!e.length)return{};for(var n={},r=0,i=e.length;r<i;r++){var o=e[r],a=o.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,o.context!==t&&o.fnContext!==t||!a||null==a.slot)(n.default||(n.default=[])).push(o);else{var s=a.slot,l=n[s]||(n[s]=[]);"template"===o.tag?l.push.apply(l,o.children||[]):l.push(o)}}for(var c in n)n[c].every(tr)&&delete n[c];return n}function tr(e){return e.isComment&&!e.asyncFactory||" "===e.text}function nr(e){return e.isComment&&e.asyncFactory}function rr(e,t,n,r){var i,o=Object.keys(n).length>0,a=t?!!t.$stable:!o,s=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==Ve&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var l in i={},t)t[l]&&"$"!==l[0]&&(i[l]=ir(e,n,l,t[l]))}else i={};for(var c in n)c in i||(i[c]=or(n,c));return t&&Object.isExtensible(t)&&(t._normalized=i),xt(i,"$stable",a),xt(i,"$key",s),xt(i,"$hasNormal",o),i}function ir(e,t,n,r){var i=function(){var t=Jt;Xt(e);var n=arguments.length?r.apply(null,arguments):r({}),i=(n=n&&"object"==typeof n&&!je(n)?[n]:Nn(n))&&n[0];return Xt(t),n&&(!i||1===n.length&&i.isComment&&!nr(i))?void 0:n};return r.proxy&&Object.defineProperty(t,n,{get:i,enumerable:!0,configurable:!0}),i}function or(e,t){return function(){return e[t]}}function ar(e,t,n,r,i){var o=!1;for(var a in t)a in e?t[a]!==n[a]&&(o=!0):(o=!0,sr(e,a,r,i));for(var a in e)a in t||(o=!0,delete e[a]);return o}function sr(e,t,n,r){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return n[r][t]}})}function lr(e,t){for(var n in t)e[n]=t[n];for(var n in e)n in t||delete e[n]}var cr,dr,ur=null;function hr(e,t){return(e.__esModule||zt&&"Module"===e[Symbol.toStringTag])&&(e=e.default),ze(e)?t.extend(e):e}function pr(e){if(je(e))for(var t=0;t<e.length;t++){var n=e[t];if(We(n)&&(We(n.componentOptions)||nr(n)))return n}}function vr(e,t){cr.$on(e,t)}function mr(e,t){cr.$off(e,t)}function gr(e,t){var n=cr;return function r(){null!==t.apply(null,arguments)&&n.$off(e,r)}}function fr(e,t,n){cr=e,On(t,n||{},vr,mr,gr,e),cr=void 0}var yr=function(){function e(e){void 0===e&&(e=!1),this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=dr,!e&&dr&&(this.index=(dr.scopes||(dr.scopes=[])).push(this)-1)}return e.prototype.run=function(e){if(this.active){var t=dr;try{return dr=this,e()}finally{dr=t}}},e.prototype.on=function(){dr=this},e.prototype.off=function(){dr=this.parent},e.prototype.stop=function(e){if(this.active){var t=void 0,n=void 0;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].teardown();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){var r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0,this.active=!1}},e}(),_r=null;function Er(e){var t=_r;return _r=e,function(){_r=t}}function br(e){for(;e&&(e=e.$parent);)if(e._inactive)return!0;return!1}function Sr(e,t){if(t){if(e._directInactive=!1,br(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)Sr(e.$children[n]);wr(e,"activated")}}function Cr(e,t){if(!(t&&(e._directInactive=!0,br(e))||e._inactive)){e._inactive=!0;for(var n=0;n<e.$children.length;n++)Cr(e.$children[n]);wr(e,"deactivated")}}function wr(e,t,n,r){void 0===r&&(r=!0),ln();var i=Jt,o=dr;r&&Xt(e);var a=e.$options[t],s="".concat(t," hook");if(a)for(var l=0,c=a.length;l<c;l++)Fr(a[l],e,n||null,e,s);e._hasHookEvent&&e.$emit("hook:"+t),r&&(Xt(i),o&&o.on()),cn()}var Ar=[],Tr=[],Ir={},kr=!1,Or=!1,Rr=0,xr=0,Nr=Date.now;if(Lt&&!Mt){var Dr=window.performance;Dr&&"function"==typeof Dr.now&&Nr()>document.createEvent("Event").timeStamp&&(Nr=function(){return Dr.now()})}var Lr=function(e,t){if(e.post){if(!t.post)return 1}else if(t.post)return-1;return e.id-t.id};function Pr(){var e,t;for(xr=Nr(),Or=!0,Ar.sort(Lr),Rr=0;Rr<Ar.length;Rr++)(e=Ar[Rr]).before&&e.before(),t=e.id,Ir[t]=null,e.run();var n=Tr.slice(),r=Ar.slice();Rr=Ar.length=Tr.length=0,Ir={},kr=Or=!1,function(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,Sr(e[t],!0)}(n),function(e){for(var t=e.length;t--;){var n=e[t],r=n.vm;r&&r._watcher===n&&r._isMounted&&!r._isDestroyed&&wr(r,"updated")}}(r),on(),qt&&kt.devtools&&qt.emit("flush")}var Mr="watcher";function Ur(e,t,n){ln();try{if(t)for(var r=t;r=r.$parent;){var i=r.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{if(!1===i[o].call(r,e,t,n))return}catch(e){Br(e,r,"errorCaptured hook")}}Br(e,t,n)}finally{cn()}}function Fr(e,t,n,r,i){var o;try{(o=n?e.apply(t,n):e.call(t))&&!o._isVue&&Ze(o)&&!o._handled&&(o.catch((function(e){return Ur(e,r,i+" (Promise/async)")})),o._handled=!0)}catch(e){Ur(e,r,i)}return o}function Br(e,t,n){if(kt.errorHandler)try{return kt.errorHandler.call(null,e,t,n)}catch(t){t!==e&&Gr(t)}Gr(e)}function Gr(e,t,n){if(!Lt||"undefined"==typeof console)throw e;console.error(e)}"".concat(Mr," callback"),"".concat(Mr," getter"),"".concat(Mr," cleanup");var $r,Vr=!1,jr=[],Kr=!1;function Wr(){Kr=!1;var e=jr.slice(0);jr.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!=typeof Promise&&Ht(Promise)){var qr=Promise.resolve();$r=function(){qr.then(Wr),Bt&&setTimeout(_t)},Vr=!0}else if(Mt||"undefined"==typeof MutationObserver||!Ht(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())$r="undefined"!=typeof setImmediate&&Ht(setImmediate)?function(){setImmediate(Wr)}:function(){setTimeout(Wr,0)};else{var Hr=1,Yr=new MutationObserver(Wr),zr=document.createTextNode(String(Hr));Yr.observe(zr,{characterData:!0}),$r=function(){Hr=(Hr+1)%2,zr.data=String(Hr)},Vr=!0}function Jr(e,t){var n;if(jr.push((function(){if(e)try{e.call(t)}catch(e){Ur(e,t,"nextTick")}else n&&n(t)})),Kr||(Kr=!0,$r()),!e&&"undefined"!=typeof Promise)return new Promise((function(e){n=e}))}function Xr(e){return function(t,n){if(void 0===n&&(n=Jt),n)return function(e,t,n){var r=e.$options;r[t]=Ti(r[t],n)}(n,e,t)}}Xr("beforeMount"),Xr("mounted"),Xr("beforeUpdate"),Xr("updated"),Xr("beforeDestroy"),Xr("destroyed"),Xr("activated"),Xr("deactivated"),Xr("serverPrefetch"),Xr("renderTracked"),Xr("renderTriggered"),Xr("errorCaptured");var Qr=new Yt;function Zr(e){return ei(e,Qr),Qr.clear(),e}function ei(e,t){var n,r,i=je(e);if(!(!i&&!ze(e)||e.__v_skip||Object.isFrozen(e)||e instanceof Qt)){if(e.__ob__){var o=e.__ob__.dep.id;if(t.has(o))return;t.add(o)}if(i)for(n=e.length;n--;)ei(e[n],t);else if(An(e))ei(e.value,t);else for(n=(r=Object.keys(e)).length;n--;)ei(e[r[n]],t)}}var ti=0,ni=function(){function e(e,t,n,r,i){var o;void 0===(o=dr&&!dr._vm?dr:e?e._scope:void 0)&&(o=dr),o&&o.active&&o.effects.push(this),(this.vm=e)&&i&&(e._watcher=this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++ti,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new Yt,this.newDepIds=new Yt,this.expression="",Ye(t)?this.getter=t:(this.getter=function(e){if(!Nt.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}(t),this.getter||(this.getter=_t)),this.value=this.lazy?void 0:this.get()}return e.prototype.get=function(){var e;ln(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Ur(e,t,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Zr(e),cn(),this.cleanupDeps()}return e},e.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},e.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},e.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(e){var t=e.id;if(null==Ir[t]&&(e!==an.target||!e.noRecurse)){if(Ir[t]=!0,Or){for(var n=Ar.length-1;n>Rr&&Ar[n].id>e.id;)n--;Ar.splice(n+1,0,e)}else Ar.push(e);kr||(kr=!0,Jr(Pr))}}(this)},e.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||ze(e)||this.deep){var t=this.value;if(this.value=e,this.user){var n='callback for watcher "'.concat(this.expression,'"');Fr(this.cb,this.vm,[e,t],this.vm,n)}else this.cb.call(this.vm,e,t)}}},e.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},e.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},e.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&at(this.vm._scope.effects,this),this.active){for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},e}(),ri={enumerable:!0,configurable:!0,get:_t,set:_t};function ii(e,t,n){ri.get=function(){return this[t][n]},ri.set=function(e){this[t][n]=e},Object.defineProperty(e,n,ri)}function oi(e){var t=e.$options;if(t.props&&function(e,t){var n=e.$options.propsData||{},r=e._props=Cn({}),i=e.$options._propKeys=[];!e.$parent||mn(!1);var o=function(o){i.push(o);var a=xi(o,t,n,e);_n(r,o,a,void 0,!0),o in e||ii(e,"_props",o)};for(var a in t)o(a);mn(!0)}(e,t.props),function(e){var t=e.$options,n=t.setup;if(n){var r=e._setupContext=function(e){return{get attrs(){if(!e._attrsProxy){var t=e._attrsProxy={};xt(t,"_v_attr_proxy",!0),ar(t,e.$attrs,Ve,e,"$attrs")}return e._attrsProxy},get listeners(){return e._listenersProxy||ar(e._listenersProxy={},e.$listeners,Ve,e,"$listeners"),e._listenersProxy},get slots(){return function(e){return e._slotsProxy||lr(e._slotsProxy={},e.$scopedSlots),e._slotsProxy}(e)},emit:mt(e.$emit,e),expose:function(t){t&&Object.keys(t).forEach((function(n){return Tn(e,t,n)}))}}}(e);Xt(e),ln();var i=Fr(n,null,[e._props||Cn({}),r],e,"setup");if(cn(),Xt(),Ye(i))t.render=i;else if(ze(i))if(e._setupState=i,i.__sfc){var o=e._setupProxy={};for(var a in i)"__sfc"!==a&&Tn(o,i,a)}else for(var a in i)Rt(a)||Tn(e,i,a)}}(e),t.methods&&function(e,t){for(var n in e.$options.props,t)e[n]="function"!=typeof t[n]?_t:mt(t[n],e)}(e,t.methods),t.data)!function(e){var t=e.$options.data;Xe(t=e._data=Ye(t)?function(e,t){ln();try{return e.call(t,t)}catch(e){return Ur(e,t,"data()"),{}}finally{cn()}}(t,e):t||{})||(t={});for(var n=Object.keys(t),r=e.$options.props,i=(e.$options.methods,n.length);i--;){var o=n[i];r&&lt(r,o)||Rt(o)||ii(e,"_data",o)}var a=yn(t);a&&a.vmCount++}(e);else{var n=yn(e._data={});n&&n.vmCount++}t.computed&&function(e,t){var n=e._computedWatchers=Object.create(null),r=Wt();for(var i in t){var o=t[i],a=Ye(o)?o:o.get;r||(n[i]=new ni(e,a||_t,_t,ai)),i in e||si(e,i,o)}}(e,t.computed),t.watch&&t.watch!==Vt&&function(e,t){for(var n in t){var r=t[n];if(je(r))for(var i=0;i<r.length;i++)di(e,n,r[i]);else di(e,n,r)}}(e,t.watch)}var ai={lazy:!0};function si(e,t,n){var r=!Wt();Ye(n)?(ri.get=r?li(t):ci(n),ri.set=_t):(ri.get=n.get?r&&!1!==n.cache?li(t):ci(n.get):_t,ri.set=n.set||_t),Object.defineProperty(e,t,ri)}function li(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),an.target&&t.depend(),t.value}}function ci(e){return function(){return e.call(this,this)}}function di(e,t,n,r){return Xe(n)&&(r=n,n=n.handler),"string"==typeof n&&(n=e[n]),e.$watch(t,n,r)}function ui(e,t){if(e){for(var n=Object.create(null),r=zt?Reflect.ownKeys(e):Object.keys(e),i=0;i<r.length;i++){var o=r[i];if("__ob__"!==o){var a=e[o].from;if(a in t._provided)n[o]=t._provided[a];else if("default"in e[o]){var s=e[o].default;n[o]=Ye(s)?s.call(t):s}}}return n}}var hi=0;function pi(e){var t=e.options;if(e.super){var n=pi(e.super);if(n!==e.superOptions){e.superOptions=n;var r=function(e){var t,n=e.options,r=e.sealedOptions;for(var i in n)n[i]!==r[i]&&(t||(t={}),t[i]=n[i]);return t}(e);r&&ft(e.extendOptions,r),(t=e.options=Oi(n,e.extendOptions)).name&&(t.components[t.name]=e)}}return t}function vi(e,t,n,r,i){var o,a=this,s=i.options;lt(r,"_uid")?(o=Object.create(r))._original=r:(o=r,r=r._original);var l=qe(s._compiled),c=!l;this.data=e,this.props=t,this.children=n,this.parent=r,this.listeners=e.on||Ve,this.injections=ui(s.inject,r),this.slots=function(){return a.$slots||rr(r,e.scopedSlots,a.$slots=er(n,r)),a.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return rr(r,e.scopedSlots,this.slots())}}),l&&(this.$options=s,this.$slots=this.slots(),this.$scopedSlots=rr(r,e.scopedSlots,this.$slots)),s._scopeId?this._c=function(e,t,n,i){var a=Un(o,e,t,n,i,c);return a&&!je(a)&&(a.fnScopeId=s._scopeId,a.fnContext=r),a}:this._c=function(e,t,n,r){return Un(o,e,t,n,r,c)}}function mi(e,t,n,r,i){var o=tn(e);return o.fnContext=n,o.fnOptions=r,t.slot&&((o.data||(o.data={})).slot=t.slot),o}function gi(e,t){for(var n in t)e[ut(n)]=t[n]}function fi(e){return e.name||e.__name||e._componentTag}Zn(vi.prototype);var yi={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var n=e;yi.prepatch(n,n)}else{var r=e.componentInstance=function(e,t){var n={_isComponent:!0,_parentVnode:e,parent:t},r=e.data.inlineTemplate;return We(r)&&(n.render=r.render,n.staticRenderFns=r.staticRenderFns),new e.componentOptions.Ctor(n)}(e,_r);r.$mount(t?e.elm:void 0,t)}},prepatch:function(e,t){var n=t.componentOptions;!function(e,t,n,r,i){var o=r.data.scopedSlots,a=e.$scopedSlots,s=!!(o&&!o.$stable||a!==Ve&&!a.$stable||o&&e.$scopedSlots.$key!==o.$key||!o&&e.$scopedSlots.$key),l=!!(i||e.$options._renderChildren||s),c=e.$vnode;e.$options._parentVnode=r,e.$vnode=r,e._vnode&&(e._vnode.parent=r),e.$options._renderChildren=i;var d=r.data.attrs||Ve;e._attrsProxy&&ar(e._attrsProxy,d,c.data&&c.data.attrs||Ve,e,"$attrs")&&(l=!0),e.$attrs=d,n=n||Ve;var u=e.$options._parentListeners;if(e._listenersProxy&&ar(e._listenersProxy,n,u||Ve,e,"$listeners"),e.$listeners=e.$options._parentListeners=n,fr(e,n,u),t&&e.$options.props){mn(!1);for(var h=e._props,p=e.$options._propKeys||[],v=0;v<p.length;v++){var m=p[v],g=e.$options.props;h[m]=xi(m,g,t,e)}mn(!0),e.$options.propsData=t}l&&(e.$slots=er(i,r.context),e.$forceUpdate())}(t.componentInstance=e.componentInstance,n.propsData,n.listeners,t,n.children)},insert:function(e){var t,n=e.context,r=e.componentInstance;r._isMounted||(r._isMounted=!0,wr(r,"mounted")),e.data.keepAlive&&(n._isMounted?((t=r)._inactive=!1,Tr.push(t)):Sr(r,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?Cr(t,!0):t.$destroy())}},_i=Object.keys(yi);function Ei(e,t,n,r,i){if(!Ke(e)){var o=n.$options._base;if(ze(e)&&(e=o.extend(e)),"function"==typeof e){var a;if(Ke(e.cid)&&(e=function(e,t){if(qe(e.error)&&We(e.errorComp))return e.errorComp;if(We(e.resolved))return e.resolved;var n=ur;if(n&&We(e.owners)&&-1===e.owners.indexOf(n)&&e.owners.push(n),qe(e.loading)&&We(e.loadingComp))return e.loadingComp;if(n&&!We(e.owners)){var r=e.owners=[n],i=!0,o=null,a=null;n.$on("hook:destroyed",(function(){return at(r,n)}));var s=function(e){for(var t=0,n=r.length;t<n;t++)r[t].$forceUpdate();e&&(r.length=0,null!==o&&(clearTimeout(o),o=null),null!==a&&(clearTimeout(a),a=null))},l=wt((function(n){e.resolved=hr(n,t),i?r.length=0:s(!0)})),c=wt((function(t){We(e.errorComp)&&(e.error=!0,s(!0))})),d=e(l,c);return ze(d)&&(Ze(d)?Ke(e.resolved)&&d.then(l,c):Ze(d.component)&&(d.component.then(l,c),We(d.error)&&(e.errorComp=hr(d.error,t)),We(d.loading)&&(e.loadingComp=hr(d.loading,t),0===d.delay?e.loading=!0:o=setTimeout((function(){o=null,Ke(e.resolved)&&Ke(e.error)&&(e.loading=!0,s(!1))}),d.delay||200)),We(d.timeout)&&(a=setTimeout((function(){a=null,Ke(e.resolved)&&c(null)}),d.timeout)))),i=!1,e.loading?e.loadingComp:e.resolved}}(a=e,o),void 0===e))return function(e,t,n,r,i){var o=Zt();return o.asyncFactory=e,o.asyncMeta={data:t,context:n,children:r,tag:i},o}(a,t,n,r,i);t=t||{},pi(e),We(t.model)&&function(e,t){var n=e.model&&e.model.prop||"value",r=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[n]=t.model.value;var i=t.on||(t.on={}),o=i[r],a=t.model.callback;We(o)?(je(o)?-1===o.indexOf(a):o!==a)&&(i[r]=[a].concat(o)):i[r]=a}(e.options,t);var s=function(e,t){var n=t.options.props;if(!Ke(n)){var r={},i=e.attrs,o=e.props;if(We(i)||We(o))for(var a in n){var s=vt(a);xn(r,o,a,s,!0)||xn(r,i,a,s,!1)}return r}}(t,e);if(qe(e.options.functional))return function(e,t,n,r,i){var o=e.options,a={},s=o.props;if(We(s))for(var l in s)a[l]=xi(l,s,t||Ve);else We(n.attrs)&&gi(a,n.attrs),We(n.props)&&gi(a,n.props);var c=new vi(n,a,i,r,e),d=o.render.call(null,c._c,c);if(d instanceof Qt)return mi(d,n,c.parent,o);if(je(d)){for(var u=Nn(d)||[],h=new Array(u.length),p=0;p<u.length;p++)h[p]=mi(u[p],n,c.parent,o);return h}}(e,s,t,n,r);var l=t.on;if(t.on=t.nativeOn,qe(e.options.abstract)){var c=t.slot;t={},c&&(t.slot=c)}!function(e){for(var t=e.hook||(e.hook={}),n=0;n<_i.length;n++){var r=_i[n],i=t[r],o=yi[r];i===o||i&&i._merged||(t[r]=i?bi(o,i):o)}}(t);var d=fi(e.options)||i;return new Qt("vue-component-".concat(e.cid).concat(d?"-".concat(d):""),t,void 0,void 0,void 0,n,{Ctor:e,propsData:s,listeners:l,tag:i,children:r},a)}}}function bi(e,t){var n=function(n,r){e(n,r),t(n,r)};return n._merged=!0,n}var Si=_t,Ci=kt.optionMergeStrategies;function wi(e,t,n){if(void 0===n&&(n=!0),!t)return e;for(var r,i,o,a=zt?Reflect.ownKeys(t):Object.keys(t),s=0;s<a.length;s++)"__ob__"!==(r=a[s])&&(i=e[r],o=t[r],n&&lt(e,r)?i!==o&&Xe(i)&&Xe(o)&&wi(i,o):En(e,r,o));return e}function Ai(e,t,n){return n?function(){var r=Ye(t)?t.call(n,n):t,i=Ye(e)?e.call(n,n):e;return r?wi(r,i):i}:t?e?function(){return wi(Ye(t)?t.call(this,this):t,Ye(e)?e.call(this,this):e)}:t:e}function Ti(e,t){var n=t?e?e.concat(t):je(t)?t:[t]:e;return n?function(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}(n):n}function Ii(e,t,n,r){var i=Object.create(e||null);return t?ft(i,t):i}Ci.data=function(e,t,n){return n?Ai(e,t,n):t&&"function"!=typeof t?e:Ai(e,t)},It.forEach((function(e){Ci[e]=Ti})),Tt.forEach((function(e){Ci[e+"s"]=Ii})),Ci.watch=function(e,t,n,r){if(e===Vt&&(e=void 0),t===Vt&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var i={};for(var o in ft(i,e),t){var a=i[o],s=t[o];a&&!je(a)&&(a=[a]),i[o]=a?a.concat(s):je(s)?s:[s]}return i},Ci.props=Ci.methods=Ci.inject=Ci.computed=function(e,t,n,r){if(!e)return t;var i=Object.create(null);return ft(i,e),t&&ft(i,t),i},Ci.provide=function(e,t){return e?function(){var n=Object.create(null);return wi(n,Ye(e)?e.call(this):e),t&&wi(n,Ye(t)?t.call(this):t,!1),n}:t};var ki=function(e,t){return void 0===t?e:t};function Oi(e,t,n){if(Ye(t)&&(t=t.options),function(e){var t=e.props;if(t){var n,r,i={};if(je(t))for(n=t.length;n--;)"string"==typeof(r=t[n])&&(i[ut(r)]={type:null});else if(Xe(t))for(var o in t)r=t[o],i[ut(o)]=Xe(r)?r:{type:r};e.props=i}}(t),function(e){var t=e.inject;if(t){var n=e.inject={};if(je(t))for(var r=0;r<t.length;r++)n[t[r]]={from:t[r]};else if(Xe(t))for(var i in t){var o=t[i];n[i]=Xe(o)?ft({from:i},o):{from:o}}}}(t),function(e){var t=e.directives;if(t)for(var n in t){var r=t[n];Ye(r)&&(t[n]={bind:r,update:r})}}(t),!t._base&&(t.extends&&(e=Oi(e,t.extends,n)),t.mixins))for(var r=0,i=t.mixins.length;r<i;r++)e=Oi(e,t.mixins[r],n);var o,a={};for(o in e)s(o);for(o in t)lt(e,o)||s(o);function s(r){var i=Ci[r]||ki;a[r]=i(e[r],t[r],n,r)}return a}function Ri(e,t,n,r){if("string"==typeof n){var i=e[t];if(lt(i,n))return i[n];var o=ut(n);if(lt(i,o))return i[o];var a=ht(o);return lt(i,a)?i[a]:i[n]||i[o]||i[a]}}function xi(e,t,n,r){var i=t[e],o=!lt(n,e),a=n[e],s=Pi(Boolean,i.type);if(s>-1)if(o&&!lt(i,"default"))a=!1;else if(""===a||a===vt(e)){var l=Pi(String,i.type);(l<0||s<l)&&(a=!0)}if(void 0===a){a=function(e,t,n){if(lt(t,"default")){var r=t.default;return e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n]?e._props[n]:Ye(r)&&"Function"!==Di(t.type)?r.call(e):r}}(r,i,e);var c=vn;mn(!0),yn(a),mn(c)}return a}var Ni=/^\s*function (\w+)/;function Di(e){var t=e&&e.toString().match(Ni);return t?t[1]:""}function Li(e,t){return Di(e)===Di(t)}function Pi(e,t){if(!je(t))return Li(t,e)?0:-1;for(var n=0,r=t.length;n<r;n++)if(Li(t[n],e))return n;return-1}function Mi(e){this._init(e)}function Ui(e){return e&&(fi(e.Ctor.options)||e.tag)}function Fi(e,t){return je(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:(n=e,!("[object RegExp]"!==Je.call(n))&&e.test(t));var n}function Bi(e,t){var n=e.cache,r=e.keys,i=e._vnode,o=e.$vnode;for(var a in n){var s=n[a];if(s){var l=s.name;l&&!t(l)&&Gi(n,a,r,i)}}o.componentOptions.children=void 0}function Gi(e,t,n,r){var i=e[t];!i||r&&i.tag===r.tag||i.componentInstance.$destroy(),e[t]=null,at(n,t)}!function(e){e.prototype._init=function(e){var t=this;t._uid=hi++,t._isVue=!0,t.__v_skip=!0,t._scope=new yr(!0),t._scope.parent=void 0,t._scope._vm=!0,e&&e._isComponent?function(e,t){var n=e.$options=Object.create(e.constructor.options),r=t._parentVnode;n.parent=t.parent,n._parentVnode=r;var i=r.componentOptions;n.propsData=i.propsData,n._parentListeners=i.listeners,n._renderChildren=i.children,n._componentTag=i.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}(t,e):t.$options=Oi(pi(t.constructor),e||{},t),t._renderProxy=t,t._self=t,function(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._provided=n?n._provided:Object.create(null),e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}(t),function(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&fr(e,t)}(t),function(e){e._vnode=null,e._staticTrees=null;var t=e.$options,n=e.$vnode=t._parentVnode,r=n&&n.context;e.$slots=er(t._renderChildren,r),e.$scopedSlots=n?rr(e.$parent,n.data.scopedSlots,e.$slots):Ve,e._c=function(t,n,r,i){return Un(e,t,n,r,i,!1)},e.$createElement=function(t,n,r,i){return Un(e,t,n,r,i,!0)};var i=n&&n.data;_n(e,"$attrs",i&&i.attrs||Ve,null,!0),_n(e,"$listeners",t._parentListeners||Ve,null,!0)}(t),wr(t,"beforeCreate",void 0,!1),function(e){var t=ui(e.$options.inject,e);t&&(mn(!1),Object.keys(t).forEach((function(n){_n(e,n,t[n])})),mn(!0))}(t),oi(t),function(e){var t=e.$options.provide;if(t){var n=Ye(t)?t.call(e):t;if(!ze(n))return;for(var r=function(e){var t=e._provided,n=e.$parent&&e.$parent._provided;return n===t?e._provided=Object.create(n):t}(e),i=zt?Reflect.ownKeys(n):Object.keys(n),o=0;o<i.length;o++){var a=i[o];Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(n,a))}}}(t),wr(t,"created"),t.$options.el&&t.$mount(t.$options.el)}}(Mi),function(e){Object.defineProperty(e.prototype,"$data",{get:function(){return this._data}}),Object.defineProperty(e.prototype,"$props",{get:function(){return this._props}}),e.prototype.$set=En,e.prototype.$delete=bn,e.prototype.$watch=function(e,t,n){var r=this;if(Xe(t))return di(r,e,t,n);(n=n||{}).user=!0;var i=new ni(r,e,t,n);if(n.immediate){var o='callback for immediate watcher "'.concat(i.expression,'"');ln(),Fr(t,r,[i.value],r,o),cn()}return function(){i.teardown()}}}(Mi),function(e){var t=/^hook:/;e.prototype.$on=function(e,n){var r=this;if(je(e))for(var i=0,o=e.length;i<o;i++)r.$on(e[i],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function r(){n.$off(e,r),t.apply(n,arguments)}return r.fn=t,n.$on(e,r),n},e.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(je(e)){for(var r=0,i=e.length;r<i;r++)n.$off(e[r],t);return n}var o,a=n._events[e];if(!a)return n;if(!t)return n._events[e]=null,n;for(var s=a.length;s--;)if((o=a[s])===t||o.fn===t){a.splice(s,1);break}return n},e.prototype.$emit=function(e){var t=this,n=t._events[e];if(n){n=n.length>1?gt(n):n;for(var r=gt(arguments,1),i='event handler for "'.concat(e,'"'),o=0,a=n.length;o<a;o++)Fr(n[o],t,r,t,i)}return t}}(Mi),function(e){e.prototype._update=function(e,t){var n=this,r=n.$el,i=n._vnode,o=Er(n);n._vnode=e,n.$el=i?n.__patch__(i,e):n.__patch__(n.$el,e,t,!1),o(),r&&(r.__vue__=null),n.$el&&(n.$el.__vue__=n);for(var a=n;a&&a.$vnode&&a.$parent&&a.$vnode===a.$parent._vnode;)a.$parent.$el=a.$el,a=a.$parent},e.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){wr(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||at(t.$children,e),e._scope.stop(),e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),wr(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}(Mi),function(e){Zn(e.prototype),e.prototype.$nextTick=function(e){return Jr(e,this)},e.prototype._render=function(){var e=this,t=e.$options,n=t.render,r=t._parentVnode;r&&e._isMounted&&(e.$scopedSlots=rr(e.$parent,r.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&lr(e._slotsProxy,e.$scopedSlots)),e.$vnode=r;var i,o=Jt,a=ur;try{Xt(e),ur=e,i=n.call(e._renderProxy,e.$createElement)}catch(t){Ur(t,e,"render"),i=e._vnode}finally{ur=a,Xt(o)}return je(i)&&1===i.length&&(i=i[0]),i instanceof Qt||(i=Zt()),i.parent=r,i}}(Mi);var $i=[String,RegExp,Array],Vi={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:$i,exclude:$i,max:[String,Number]},methods:{cacheVNode:function(){var e=this,t=e.cache,n=e.keys,r=e.vnodeToCache,i=e.keyToCache;if(r){var o=r.tag,a=r.componentInstance,s=r.componentOptions;t[i]={name:Ui(s),tag:o,componentInstance:a},n.push(i),this.max&&n.length>parseInt(this.max)&&Gi(t,n[0],n,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)Gi(this.cache,e,this.keys)},mounted:function(){var e=this;this.cacheVNode(),this.$watch("include",(function(t){Bi(e,(function(e){return Fi(t,e)}))})),this.$watch("exclude",(function(t){Bi(e,(function(e){return!Fi(t,e)}))}))},updated:function(){this.cacheVNode()},render:function(){var e=this.$slots.default,t=pr(e),n=t&&t.componentOptions;if(n){var r=Ui(n),i=this.include,o=this.exclude;if(i&&(!r||!Fi(i,r))||o&&r&&Fi(o,r))return t;var a=this.cache,s=this.keys,l=null==t.key?n.Ctor.cid+(n.tag?"::".concat(n.tag):""):t.key;a[l]?(t.componentInstance=a[l].componentInstance,at(s,l),s.push(l)):(this.vnodeToCache=t,this.keyToCache=l),t.data.keepAlive=!0}return t||e&&e[0]}}};!function(e){var t={get:function(){return kt}};Object.defineProperty(e,"config",t),e.util={warn:Si,extend:ft,mergeOptions:Oi,defineReactive:_n},e.set=En,e.delete=bn,e.nextTick=Jr,e.observable=function(e){return yn(e),e},e.options=Object.create(null),Tt.forEach((function(t){e.options[t+"s"]=Object.create(null)})),e.options._base=e,ft(e.options.components,Vi),function(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=gt(arguments,1);return n.unshift(this),Ye(e.install)?e.install.apply(e,n):Ye(e)&&e.apply(null,n),t.push(e),this}}(e),function(e){e.mixin=function(e){return this.options=Oi(this.options,e),this}}(e),function(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,r=n.cid,i=e._Ctor||(e._Ctor={});if(i[r])return i[r];var o=fi(e)||fi(n.options),a=function(e){this._init(e)};return(a.prototype=Object.create(n.prototype)).constructor=a,a.cid=t++,a.options=Oi(n.options,e),a.super=n,a.options.props&&function(e){var t=e.options.props;for(var n in t)ii(e.prototype,"_props",n)}(a),a.options.computed&&function(e){var t=e.options.computed;for(var n in t)si(e.prototype,n,t[n])}(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,Tt.forEach((function(e){a[e]=n[e]})),o&&(a.options.components[o]=a),a.superOptions=n.options,a.extendOptions=e,a.sealedOptions=ft({},a.options),i[r]=a,a}}(e),function(e){Tt.forEach((function(t){e[t]=function(e,n){return n?("component"===t&&Xe(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&Ye(n)&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}}))}(e)}(Mi),Object.defineProperty(Mi.prototype,"$isServer",{get:Wt}),Object.defineProperty(Mi.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Mi,"FunctionalRenderContext",{value:vi}),Mi.version="2.7.16";var ji=rt("style,class"),Ki=rt("input,textarea,option,select,progress"),Wi=function(e,t,n){return"value"===n&&Ki(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},qi=rt("contenteditable,draggable,spellcheck"),Hi=rt("events,caret,typing,plaintext-only"),Yi=function(e,t){return Zi(t)||"false"===t?"false":"contenteditable"===e&&Hi(t)?t:"true"},zi=rt("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),Ji="http://www.w3.org/1999/xlink",Xi=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Qi=function(e){return Xi(e)?e.slice(6,e.length):""},Zi=function(e){return null==e||!1===e};function eo(e,t){return{staticClass:to(e.staticClass,t.staticClass),class:We(e.class)?[e.class,t.class]:t.class}}function to(e,t){return e?t?e+" "+t:e:t||""}function no(e){return Array.isArray(e)?function(e){for(var t,n="",r=0,i=e.length;r<i;r++)We(t=no(e[r]))&&""!==t&&(n&&(n+=" "),n+=t);return n}(e):ze(e)?function(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}(e):"string"==typeof e?e:""}var ro={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},io=rt("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),oo=rt("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),ao=function(e){return io(e)||oo(e)};function so(e){return oo(e)?"svg":"math"===e?"math":void 0}var lo=Object.create(null),co=rt("text,number,password,search,email,tel,url");function uo(e){return"string"==typeof e?document.querySelector(e)||document.createElement("div"):e}var ho=Object.freeze({__proto__:null,createElement:function(e,t){var n=document.createElement(e);return"select"!==e||t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n},createElementNS:function(e,t){return document.createElementNS(ro[e],t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},setStyleScope:function(e,t){e.setAttribute(t,"")}}),po={create:function(e,t){vo(t)},update:function(e,t){e.data.ref!==t.data.ref&&(vo(e,!0),vo(t))},destroy:function(e){vo(e,!0)}};function vo(e,t){var n=e.data.ref;if(We(n)){var r=e.context,i=e.componentInstance||e.elm,o=t?null:i,a=t?void 0:i;if(Ye(n))Fr(n,r,[o],r,"template ref function");else{var s=e.data.refInFor,l="string"==typeof n||"number"==typeof n,c=An(n),d=r.$refs;if(l||c)if(s){var u=l?d[n]:n.value;t?je(u)&&at(u,i):je(u)?u.includes(i)||u.push(i):l?(d[n]=[i],mo(r,n,d[n])):n.value=[i]}else if(l){if(t&&d[n]!==i)return;d[n]=a,mo(r,n,o)}else if(c){if(t&&n.value!==i)return;n.value=o}}}}function mo(e,t,n){var r=e._setupState;r&&lt(r,t)&&(An(r[t])?r[t].value=n:r[t]=n)}var go=new Qt("",{},[]),fo=["create","activate","update","remove","destroy"];function yo(e,t){return e.key===t.key&&e.asyncFactory===t.asyncFactory&&(e.tag===t.tag&&e.isComment===t.isComment&&We(e.data)===We(t.data)&&function(e,t){if("input"!==e.tag)return!0;var n,r=We(n=e.data)&&We(n=n.attrs)&&n.type,i=We(n=t.data)&&We(n=n.attrs)&&n.type;return r===i||co(r)&&co(i)}(e,t)||qe(e.isAsyncPlaceholder)&&Ke(t.asyncFactory.error))}function _o(e,t,n){var r,i,o={};for(r=t;r<=n;++r)We(i=e[r].key)&&(o[i]=r);return o}var Eo={create:bo,update:bo,destroy:function(e){bo(e,go)}};function bo(e,t){(e.data.directives||t.data.directives)&&function(e,t){var n,r,i,o=e===go,a=t===go,s=Co(e.data.directives,e.context),l=Co(t.data.directives,t.context),c=[],d=[];for(n in l)r=s[n],i=l[n],r?(i.oldValue=r.value,i.oldArg=r.arg,Ao(i,"update",t,e),i.def&&i.def.componentUpdated&&d.push(i)):(Ao(i,"bind",t,e),i.def&&i.def.inserted&&c.push(i));if(c.length){var u=function(){for(var n=0;n<c.length;n++)Ao(c[n],"inserted",t,e)};o?Rn(t,"insert",u):u()}if(d.length&&Rn(t,"postpatch",(function(){for(var n=0;n<d.length;n++)Ao(d[n],"componentUpdated",t,e)})),!o)for(n in s)l[n]||Ao(s[n],"unbind",e,e,a)}(e,t)}var So=Object.create(null);function Co(e,t){var n,r,i=Object.create(null);if(!e)return i;for(n=0;n<e.length;n++){if((r=e[n]).modifiers||(r.modifiers=So),i[wo(r)]=r,t._setupState&&t._setupState.__sfc){var o=r.def||Ri(t,"_setupState","v-"+r.name);r.def="function"==typeof o?{bind:o,update:o}:o}r.def=r.def||Ri(t.$options,"directives",r.name)}return i}function wo(e){return e.rawName||"".concat(e.name,".").concat(Object.keys(e.modifiers||{}).join("."))}function Ao(e,t,n,r,i){var o=e.def&&e.def[t];if(o)try{o(n.elm,e,n,r,i)}catch(r){Ur(r,n.context,"directive ".concat(e.name," ").concat(t," hook"))}}var To=[po,Eo];function Io(e,t){var n=t.componentOptions;if(!(We(n)&&!1===n.Ctor.options.inheritAttrs||Ke(e.data.attrs)&&Ke(t.data.attrs))){var r,i,o=t.elm,a=e.data.attrs||{},s=t.data.attrs||{};for(r in(We(s.__ob__)||qe(s._v_attr_proxy))&&(s=t.data.attrs=ft({},s)),s)i=s[r],a[r]!==i&&ko(o,r,i,t.data.pre);for(r in(Mt||Ft)&&s.value!==a.value&&ko(o,"value",s.value),a)Ke(s[r])&&(Xi(r)?o.removeAttributeNS(Ji,Qi(r)):qi(r)||o.removeAttribute(r))}}function ko(e,t,n,r){r||e.tagName.indexOf("-")>-1?Oo(e,t,n):zi(t)?Zi(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):qi(t)?e.setAttribute(t,Yi(t,n)):Xi(t)?Zi(n)?e.removeAttributeNS(Ji,Qi(t)):e.setAttributeNS(Ji,t,n):Oo(e,t,n)}function Oo(e,t,n){if(Zi(n))e.removeAttribute(t);else{if(Mt&&!Ut&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==n&&!e.__ieph){var r=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",r)};e.addEventListener("input",r),e.__ieph=!0}e.setAttribute(t,n)}}var Ro={create:Io,update:Io};function xo(e,t){var n=t.elm,r=t.data,i=e.data;if(!(Ke(r.staticClass)&&Ke(r.class)&&(Ke(i)||Ke(i.staticClass)&&Ke(i.class)))){var o=function(e){for(var t=e.data,n=e,r=e;We(r.componentInstance);)(r=r.componentInstance._vnode)&&r.data&&(t=eo(r.data,t));for(;We(n=n.parent);)n&&n.data&&(t=eo(t,n.data));return i=t.staticClass,o=t.class,We(i)||We(o)?to(i,no(o)):"";var i,o}(t),a=n._transitionClasses;We(a)&&(o=to(o,no(a))),o!==n._prevClass&&(n.setAttribute("class",o),n._prevClass=o)}}var No,Do,Lo,Po,Mo,Uo,Fo={create:xo,update:xo},Bo=/[\w).+\-_$\]]/;function Go(e){var t,n,r,i,o,a=!1,s=!1,l=!1,c=!1,d=0,u=0,h=0,p=0;for(r=0;r<e.length;r++)if(n=t,t=e.charCodeAt(r),a)39===t&&92!==n&&(a=!1);else if(s)34===t&&92!==n&&(s=!1);else if(l)96===t&&92!==n&&(l=!1);else if(c)47===t&&92!==n&&(c=!1);else if(124!==t||124===e.charCodeAt(r+1)||124===e.charCodeAt(r-1)||d||u||h){switch(t){case 34:s=!0;break;case 39:a=!0;break;case 96:l=!0;break;case 40:h++;break;case 41:h--;break;case 91:u++;break;case 93:u--;break;case 123:d++;break;case 125:d--}if(47===t){for(var v=r-1,m=void 0;v>=0&&" "===(m=e.charAt(v));v--);m&&Bo.test(m)||(c=!0)}}else void 0===i?(p=r+1,i=e.slice(0,r).trim()):g();function g(){(o||(o=[])).push(e.slice(p,r).trim()),p=r+1}if(void 0===i?i=e.slice(0,r).trim():0!==p&&g(),o)for(r=0;r<o.length;r++)i=$o(i,o[r]);return i}function $o(e,t){var n=t.indexOf("(");if(n<0)return'_f("'.concat(t,'")(').concat(e,")");var r=t.slice(0,n),i=t.slice(n+1);return'_f("'.concat(r,'")(').concat(e).concat(")"!==i?","+i:i)}function Vo(e,t){console.error("[Vue compiler]: ".concat(e))}function jo(e,t){return e?e.map((function(e){return e[t]})).filter((function(e){return e})):[]}function Ko(e,t,n,r,i){(e.props||(e.props=[])).push(Zo({name:t,value:n,dynamic:i},r)),e.plain=!1}function Wo(e,t,n,r,i){(i?e.dynamicAttrs||(e.dynamicAttrs=[]):e.attrs||(e.attrs=[])).push(Zo({name:t,value:n,dynamic:i},r)),e.plain=!1}function qo(e,t,n,r){e.attrsMap[t]=n,e.attrsList.push(Zo({name:t,value:n},r))}function Ho(e,t,n,r,i,o,a,s){(e.directives||(e.directives=[])).push(Zo({name:t,rawName:n,value:r,arg:i,isDynamicArg:o,modifiers:a},s)),e.plain=!1}function Yo(e,t,n){return n?"_p(".concat(t,',"').concat(e,'")'):e+t}function zo(e,t,n,r,i,o,a,s){var l;(r=r||Ve).right?s?t="(".concat(t,")==='click'?'contextmenu':(").concat(t,")"):"click"===t&&(t="contextmenu",delete r.right):r.middle&&(s?t="(".concat(t,")==='click'?'mouseup':(").concat(t,")"):"click"===t&&(t="mouseup")),r.capture&&(delete r.capture,t=Yo("!",t,s)),r.once&&(delete r.once,t=Yo("~",t,s)),r.passive&&(delete r.passive,t=Yo("&",t,s)),r.native?(delete r.native,l=e.nativeEvents||(e.nativeEvents={})):l=e.events||(e.events={});var c=Zo({value:n.trim(),dynamic:s},a);r!==Ve&&(c.modifiers=r);var d=l[t];Array.isArray(d)?i?d.unshift(c):d.push(c):l[t]=d?i?[c,d]:[d,c]:c,e.plain=!1}function Jo(e,t,n){var r=Xo(e,":"+t)||Xo(e,"v-bind:"+t);if(null!=r)return Go(r);if(!1!==n){var i=Xo(e,t);if(null!=i)return JSON.stringify(i)}}function Xo(e,t,n){var r;if(null!=(r=e.attrsMap[t]))for(var i=e.attrsList,o=0,a=i.length;o<a;o++)if(i[o].name===t){i.splice(o,1);break}return n&&delete e.attrsMap[t],r}function Qo(e,t){for(var n=e.attrsList,r=0,i=n.length;r<i;r++){var o=n[r];if(t.test(o.name))return n.splice(r,1),o}}function Zo(e,t){return t&&(null!=t.start&&(e.start=t.start),null!=t.end&&(e.end=t.end)),e}function ea(e,t,n){var r=n||{},i=r.number,o="$$v",a=o;r.trim&&(a="(typeof ".concat(o," === 'string'")+"? ".concat(o,".trim()")+": ".concat(o,")")),i&&(a="_n(".concat(a,")"));var s=ta(t,a);e.model={value:"(".concat(t,")"),expression:JSON.stringify(t),callback:"function (".concat(o,") {").concat(s,"}")}}function ta(e,t){var n=function(e){if(e=e.trim(),No=e.length,e.indexOf("[")<0||e.lastIndexOf("]")<No-1)return(Po=e.lastIndexOf("."))>-1?{exp:e.slice(0,Po),key:'"'+e.slice(Po+1)+'"'}:{exp:e,key:null};for(Do=e,Po=Mo=Uo=0;!ra();)ia(Lo=na())?aa(Lo):91===Lo&&oa(Lo);return{exp:e.slice(0,Mo),key:e.slice(Mo+1,Uo)}}(e);return null===n.key?"".concat(e,"=").concat(t):"$set(".concat(n.exp,", ").concat(n.key,", ").concat(t,")")}function na(){return Do.charCodeAt(++Po)}function ra(){return Po>=No}function ia(e){return 34===e||39===e}function oa(e){var t=1;for(Mo=Po;!ra();)if(ia(e=na()))aa(e);else if(91===e&&t++,93===e&&t--,0===t){Uo=Po;break}}function aa(e){for(var t=e;!ra()&&(e=na())!==t;);}var sa,la="__r",ca="__c";function da(e,t,n){var r=sa;return function i(){null!==t.apply(null,arguments)&&pa(e,i,n,r)}}var ua=Vr&&!($t&&Number($t[1])<=53);function ha(e,t,n,r){if(ua){var i=xr,o=t;t=o._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=i||e.timeStamp<=0||e.target.ownerDocument!==document)return o.apply(this,arguments)}}sa.addEventListener(e,t,jt?{capture:n,passive:r}:n)}function pa(e,t,n,r){(r||sa).removeEventListener(e,t._wrapper||t,n)}function va(e,t){if(!Ke(e.data.on)||!Ke(t.data.on)){var n=t.data.on||{},r=e.data.on||{};sa=t.elm||e.elm,function(e){if(We(e[la])){var t=Mt?"change":"input";e[t]=[].concat(e[la],e[t]||[]),delete e[la]}We(e[ca])&&(e.change=[].concat(e[ca],e.change||[]),delete e[ca])}(n),On(n,r,ha,pa,da,t.context),sa=void 0}}var ma,ga={create:va,update:va,destroy:function(e){return va(e,go)}};function fa(e,t){if(!Ke(e.data.domProps)||!Ke(t.data.domProps)){var n,r,i=t.elm,o=e.data.domProps||{},a=t.data.domProps||{};for(n in(We(a.__ob__)||qe(a._v_attr_proxy))&&(a=t.data.domProps=ft({},a)),o)n in a||(i[n]="");for(n in a){if(r=a[n],"textContent"===n||"innerHTML"===n){if(t.children&&(t.children.length=0),r===o[n])continue;1===i.childNodes.length&&i.removeChild(i.childNodes[0])}if("value"===n&&"PROGRESS"!==i.tagName){i._value=r;var s=Ke(r)?"":String(r);ya(i,s)&&(i.value=s)}else if("innerHTML"===n&&oo(i.tagName)&&Ke(i.innerHTML)){(ma=ma||document.createElement("div")).innerHTML="<svg>".concat(r,"</svg>");for(var l=ma.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;l.firstChild;)i.appendChild(l.firstChild)}else if(r!==o[n])try{i[n]=r}catch(e){}}}}function ya(e,t){return!e.composing&&("OPTION"===e.tagName||function(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}(e,t)||function(e,t){var n=e.value,r=e._vModifiers;if(We(r)){if(r.number)return nt(n)!==nt(t);if(r.trim)return n.trim()!==t.trim()}return n!==t}(e,t))}var _a={create:fa,update:fa},Ea=ct((function(e){var t={},n=/:(.+)/;return e.split(/;(?![^(]*\))/g).forEach((function(e){if(e){var r=e.split(n);r.length>1&&(t[r[0].trim()]=r[1].trim())}})),t}));function ba(e){var t=Sa(e.style);return e.staticStyle?ft(e.staticStyle,t):t}function Sa(e){return Array.isArray(e)?yt(e):"string"==typeof e?Ea(e):e}var Ca,wa=/^--/,Aa=/\s*!important$/,Ta=function(e,t,n){if(wa.test(t))e.style.setProperty(t,n);else if(Aa.test(n))e.style.setProperty(vt(t),n.replace(Aa,""),"important");else{var r=ka(t);if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++)e.style[r]=n[i];else e.style[r]=n}},Ia=["Webkit","Moz","ms"],ka=ct((function(e){if(Ca=Ca||document.createElement("div").style,"filter"!==(e=ut(e))&&e in Ca)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<Ia.length;n++){var r=Ia[n]+t;if(r in Ca)return r}}));function Oa(e,t){var n=t.data,r=e.data;if(!(Ke(n.staticStyle)&&Ke(n.style)&&Ke(r.staticStyle)&&Ke(r.style))){var i,o,a=t.elm,s=r.staticStyle,l=r.normalizedStyle||r.style||{},c=s||l,d=Sa(t.data.style)||{};t.data.normalizedStyle=We(d.__ob__)?ft({},d):d;var u=function(e){for(var t,n={},r=e;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(t=ba(r.data))&&ft(n,t);(t=ba(e.data))&&ft(n,t);for(var i=e;i=i.parent;)i.data&&(t=ba(i.data))&&ft(n,t);return n}(t);for(o in c)Ke(u[o])&&Ta(a,o,"");for(o in u)i=u[o],Ta(a,o,null==i?"":i)}}var Ra={create:Oa,update:Oa},xa=/\s+/;function Na(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(xa).forEach((function(t){return e.classList.add(t)})):e.classList.add(t);else{var n=" ".concat(e.getAttribute("class")||""," ");n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function Da(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(xa).forEach((function(t){return e.classList.remove(t)})):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var n=" ".concat(e.getAttribute("class")||""," "),r=" "+t+" ";n.indexOf(r)>=0;)n=n.replace(r," ");(n=n.trim())?e.setAttribute("class",n):e.removeAttribute("class")}}function La(e){if(e){if("object"==typeof e){var t={};return!1!==e.css&&ft(t,Pa(e.name||"v")),ft(t,e),t}return"string"==typeof e?Pa(e):void 0}}var Pa=ct((function(e){return{enterClass:"".concat(e,"-enter"),enterToClass:"".concat(e,"-enter-to"),enterActiveClass:"".concat(e,"-enter-active"),leaveClass:"".concat(e,"-leave"),leaveToClass:"".concat(e,"-leave-to"),leaveActiveClass:"".concat(e,"-leave-active")}})),Ma=Lt&&!Ut,Ua="transition",Fa="animation",Ba="transition",Ga="transitionend",$a="animation",Va="animationend";Ma&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Ba="WebkitTransition",Ga="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&($a="WebkitAnimation",Va="webkitAnimationEnd"));var ja=Lt?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function Ka(e){ja((function(){ja(e)}))}function Wa(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),Na(e,t))}function qa(e,t){e._transitionClasses&&at(e._transitionClasses,t),Da(e,t)}function Ha(e,t,n){var r=za(e,t),i=r.type,o=r.timeout,a=r.propCount;if(!i)return n();var s=i===Ua?Ga:Va,l=0,c=function(){e.removeEventListener(s,d),n()},d=function(t){t.target===e&&++l>=a&&c()};setTimeout((function(){l<a&&c()}),o+1),e.addEventListener(s,d)}var Ya=/\b(transform|all)(,|$)/;function za(e,t){var n,r=window.getComputedStyle(e),i=(r[Ba+"Delay"]||"").split(", "),o=(r[Ba+"Duration"]||"").split(", "),a=Ja(i,o),s=(r[$a+"Delay"]||"").split(", "),l=(r[$a+"Duration"]||"").split(", "),c=Ja(s,l),d=0,u=0;return t===Ua?a>0&&(n=Ua,d=a,u=o.length):t===Fa?c>0&&(n=Fa,d=c,u=l.length):u=(n=(d=Math.max(a,c))>0?a>c?Ua:Fa:null)?n===Ua?o.length:l.length:0,{type:n,timeout:d,propCount:u,hasTransform:n===Ua&&Ya.test(r[Ba+"Property"])}}function Ja(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max.apply(null,t.map((function(t,n){return Xa(t)+Xa(e[n])})))}function Xa(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function Qa(e,t){var n=e.elm;We(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var r=La(e.data.transition);if(!Ke(r)&&!We(n._enterCb)&&1===n.nodeType){for(var i=r.css,o=r.type,a=r.enterClass,s=r.enterToClass,l=r.enterActiveClass,c=r.appearClass,d=r.appearToClass,u=r.appearActiveClass,h=r.beforeEnter,p=r.enter,v=r.afterEnter,m=r.enterCancelled,g=r.beforeAppear,f=r.appear,y=r.afterAppear,_=r.appearCancelled,E=r.duration,b=_r,S=_r.$vnode;S&&S.parent;)b=S.context,S=S.parent;var C=!b._isMounted||!e.isRootInsert;if(!C||f||""===f){var w=C&&c?c:a,A=C&&u?u:l,T=C&&d?d:s,I=C&&g||h,k=C&&Ye(f)?f:p,O=C&&y||v,R=C&&_||m,x=nt(ze(E)?E.enter:E),N=!1!==i&&!Ut,D=ts(k),L=n._enterCb=wt((function(){N&&(qa(n,T),qa(n,A)),L.cancelled?(N&&qa(n,w),R&&R(n)):O&&O(n),n._enterCb=null}));e.data.show||Rn(e,"insert",(function(){var t=n.parentNode,r=t&&t._pending&&t._pending[e.key];r&&r.tag===e.tag&&r.elm._leaveCb&&r.elm._leaveCb(),k&&k(n,L)})),I&&I(n),N&&(Wa(n,w),Wa(n,A),Ka((function(){qa(n,w),L.cancelled||(Wa(n,T),D||(es(x)?setTimeout(L,x):Ha(n,o,L)))}))),e.data.show&&(t&&t(),k&&k(n,L)),N||D||L()}}}function Za(e,t){var n=e.elm;We(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var r=La(e.data.transition);if(Ke(r)||1!==n.nodeType)return t();if(!We(n._leaveCb)){var i=r.css,o=r.type,a=r.leaveClass,s=r.leaveToClass,l=r.leaveActiveClass,c=r.beforeLeave,d=r.leave,u=r.afterLeave,h=r.leaveCancelled,p=r.delayLeave,v=r.duration,m=!1!==i&&!Ut,g=ts(d),f=nt(ze(v)?v.leave:v),y=n._leaveCb=wt((function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[e.key]=null),m&&(qa(n,s),qa(n,l)),y.cancelled?(m&&qa(n,a),h&&h(n)):(t(),u&&u(n)),n._leaveCb=null}));p?p(_):_()}function _(){y.cancelled||(!e.data.show&&n.parentNode&&((n.parentNode._pending||(n.parentNode._pending={}))[e.key]=e),c&&c(n),m&&(Wa(n,a),Wa(n,l),Ka((function(){qa(n,a),y.cancelled||(Wa(n,s),g||(es(f)?setTimeout(y,f):Ha(n,o,y)))}))),d&&d(n,y),m||g||y())}}function es(e){return"number"==typeof e&&!isNaN(e)}function ts(e){if(Ke(e))return!1;var t=e.fns;return We(t)?ts(Array.isArray(t)?t[0]:t):(e._length||e.length)>1}function ns(e,t){!0!==t.data.show&&Qa(t)}var rs=function(e){var t,n,r={},i=e.modules,o=e.nodeOps;for(t=0;t<fo.length;++t)for(r[fo[t]]=[],n=0;n<i.length;++n)We(i[n][fo[t]])&&r[fo[t]].push(i[n][fo[t]]);function a(e){var t=o.parentNode(e);We(t)&&o.removeChild(t,e)}function s(e,t,n,i,a,s,u){if(We(e.elm)&&We(s)&&(e=s[u]=tn(e)),e.isRootInsert=!a,!function(e,t,n,i){var o=e.data;if(We(o)){var a=We(e.componentInstance)&&o.keepAlive;if(We(o=o.hook)&&We(o=o.init)&&o(e,!1),We(e.componentInstance))return l(e,t),c(n,e.elm,i),qe(a)&&function(e,t,n,i){for(var o,a=e;a.componentInstance;)if(We(o=(a=a.componentInstance._vnode).data)&&We(o=o.transition)){for(o=0;o<r.activate.length;++o)r.activate[o](go,a);t.push(a);break}c(n,e.elm,i)}(e,t,n,i),!0}}(e,t,n,i)){var v=e.data,m=e.children,g=e.tag;We(g)?(e.elm=e.ns?o.createElementNS(e.ns,g):o.createElement(g,e),p(e),d(e,m,t),We(v)&&h(e,t),c(n,e.elm,i)):qe(e.isComment)?(e.elm=o.createComment(e.text),c(n,e.elm,i)):(e.elm=o.createTextNode(e.text),c(n,e.elm,i))}}function l(e,t){We(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,u(e)?(h(e,t),p(e)):(vo(e),t.push(e))}function c(e,t,n){We(e)&&(We(n)?o.parentNode(n)===e&&o.insertBefore(e,t,n):o.appendChild(e,t))}function d(e,t,n){if(je(t))for(var r=0;r<t.length;++r)s(t[r],n,e.elm,null,!0,t,r);else He(e.text)&&o.appendChild(e.elm,o.createTextNode(String(e.text)))}function u(e){for(;e.componentInstance;)e=e.componentInstance._vnode;return We(e.tag)}function h(e,n){for(var i=0;i<r.create.length;++i)r.create[i](go,e);We(t=e.data.hook)&&(We(t.create)&&t.create(go,e),We(t.insert)&&n.push(e))}function p(e){var t;if(We(t=e.fnScopeId))o.setStyleScope(e.elm,t);else for(var n=e;n;)We(t=n.context)&&We(t=t.$options._scopeId)&&o.setStyleScope(e.elm,t),n=n.parent;We(t=_r)&&t!==e.context&&t!==e.fnContext&&We(t=t.$options._scopeId)&&o.setStyleScope(e.elm,t)}function v(e,t,n,r,i,o){for(;r<=i;++r)s(n[r],o,e,t,!1,n,r)}function m(e){var t,n,i=e.data;if(We(i))for(We(t=i.hook)&&We(t=t.destroy)&&t(e),t=0;t<r.destroy.length;++t)r.destroy[t](e);if(We(t=e.children))for(n=0;n<e.children.length;++n)m(e.children[n])}function g(e,t,n){for(;t<=n;++t){var r=e[t];We(r)&&(We(r.tag)?(f(r),m(r)):a(r.elm))}}function f(e,t){if(We(t)||We(e.data)){var n,i=r.remove.length+1;for(We(t)?t.listeners+=i:t=function(e,t){function n(){0==--n.listeners&&a(e)}return n.listeners=t,n}(e.elm,i),We(n=e.componentInstance)&&We(n=n._vnode)&&We(n.data)&&f(n,t),n=0;n<r.remove.length;++n)r.remove[n](e,t);We(n=e.data.hook)&&We(n=n.remove)?n(e,t):t()}else a(e.elm)}function y(e,t,n,r){for(var i=n;i<r;i++){var o=t[i];if(We(o)&&yo(e,o))return i}}function _(e,t,n,i,a,l){if(e!==t){We(t.elm)&&We(i)&&(t=i[a]=tn(t));var c=t.elm=e.elm;if(qe(e.isAsyncPlaceholder))We(t.asyncFactory.resolved)?S(e.elm,t,n):t.isAsyncPlaceholder=!0;else if(qe(t.isStatic)&&qe(e.isStatic)&&t.key===e.key&&(qe(t.isCloned)||qe(t.isOnce)))t.componentInstance=e.componentInstance;else{var d,h=t.data;We(h)&&We(d=h.hook)&&We(d=d.prepatch)&&d(e,t);var p=e.children,m=t.children;if(We(h)&&u(t)){for(d=0;d<r.update.length;++d)r.update[d](e,t);We(d=h.hook)&&We(d=d.update)&&d(e,t)}Ke(t.text)?We(p)&&We(m)?p!==m&&function(e,t,n,r,i){for(var a,l,c,d=0,u=0,h=t.length-1,p=t[0],m=t[h],f=n.length-1,E=n[0],b=n[f],S=!i;d<=h&&u<=f;)Ke(p)?p=t[++d]:Ke(m)?m=t[--h]:yo(p,E)?(_(p,E,r,n,u),p=t[++d],E=n[++u]):yo(m,b)?(_(m,b,r,n,f),m=t[--h],b=n[--f]):yo(p,b)?(_(p,b,r,n,f),S&&o.insertBefore(e,p.elm,o.nextSibling(m.elm)),p=t[++d],b=n[--f]):yo(m,E)?(_(m,E,r,n,u),S&&o.insertBefore(e,m.elm,p.elm),m=t[--h],E=n[++u]):(Ke(a)&&(a=_o(t,d,h)),Ke(l=We(E.key)?a[E.key]:y(E,t,d,h))?s(E,r,e,p.elm,!1,n,u):yo(c=t[l],E)?(_(c,E,r,n,u),t[l]=void 0,S&&o.insertBefore(e,c.elm,p.elm)):s(E,r,e,p.elm,!1,n,u),E=n[++u]);d>h?v(e,Ke(n[f+1])?null:n[f+1].elm,n,u,f,r):u>f&&g(t,d,h)}(c,p,m,n,l):We(m)?(We(e.text)&&o.setTextContent(c,""),v(c,null,m,0,m.length-1,n)):We(p)?g(p,0,p.length-1):We(e.text)&&o.setTextContent(c,""):e.text!==t.text&&o.setTextContent(c,t.text),We(h)&&We(d=h.hook)&&We(d=d.postpatch)&&d(e,t)}}}function E(e,t,n){if(qe(n)&&We(e.parent))e.parent.data.pendingInsert=t;else for(var r=0;r<t.length;++r)t[r].data.hook.insert(t[r])}var b=rt("attrs,class,staticClass,staticStyle,key");function S(e,t,n,r){var i,o=t.tag,a=t.data,s=t.children;if(r=r||a&&a.pre,t.elm=e,qe(t.isComment)&&We(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(We(a)&&(We(i=a.hook)&&We(i=i.init)&&i(t,!0),We(i=t.componentInstance)))return l(t,n),!0;if(We(o)){if(We(s))if(e.hasChildNodes())if(We(i=a)&&We(i=i.domProps)&&We(i=i.innerHTML)){if(i!==e.innerHTML)return!1}else{for(var c=!0,u=e.firstChild,p=0;p<s.length;p++){if(!u||!S(u,s[p],n,r)){c=!1;break}u=u.nextSibling}if(!c||u)return!1}else d(t,s,n);if(We(a)){var v=!1;for(var m in a)if(!b(m)){v=!0,h(t,n);break}!v&&a.class&&Zr(a.class)}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,t,n,i){if(!Ke(t)){var a,l=!1,c=[];if(Ke(e))l=!0,s(t,c);else{var d=We(e.nodeType);if(!d&&yo(e,t))_(e,t,c,null,null,i);else{if(d){if(1===e.nodeType&&e.hasAttribute(At)&&(e.removeAttribute(At),n=!0),qe(n)&&S(e,t,c))return E(t,c,!0),e;a=e,e=new Qt(o.tagName(a).toLowerCase(),{},[],void 0,a)}var h=e.elm,p=o.parentNode(h);if(s(t,c,h._leaveCb?null:p,o.nextSibling(h)),We(t.parent))for(var v=t.parent,f=u(t);v;){for(var y=0;y<r.destroy.length;++y)r.destroy[y](v);if(v.elm=t.elm,f){for(var b=0;b<r.create.length;++b)r.create[b](go,v);var C=v.data.hook.insert;if(C.merged)for(var w=C.fns.slice(1),A=0;A<w.length;A++)w[A]()}else vo(v);v=v.parent}We(p)?g([e],0,0):We(e.tag)&&m(e)}}return E(t,c,l),t.elm}We(e)&&m(e)}}({nodeOps:ho,modules:[Ro,Fo,ga,_a,Ra,Lt?{create:ns,activate:ns,remove:function(e,t){!0!==e.data.show?Za(e,t):t()}}:{}].concat(To)});Ut&&document.addEventListener("selectionchange",(function(){var e=document.activeElement;e&&e.vmodel&&us(e,"input")}));var is={inserted:function(e,t,n,r){"select"===n.tag?(r.elm&&!r.elm._vOptions?Rn(n,"postpatch",(function(){is.componentUpdated(e,t,n)})):os(e,t,n.context),e._vOptions=[].map.call(e.options,ls)):("textarea"===n.tag||co(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",cs),e.addEventListener("compositionend",ds),e.addEventListener("change",ds),Ut&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){os(e,t,n.context);var r=e._vOptions,i=e._vOptions=[].map.call(e.options,ls);i.some((function(e,t){return!St(e,r[t])}))&&(e.multiple?t.value.some((function(e){return ss(e,i)})):t.value!==t.oldValue&&ss(t.value,i))&&us(e,"change")}}};function os(e,t,n){as(e,t),(Mt||Ft)&&setTimeout((function(){as(e,t)}),0)}function as(e,t,n){var r=t.value,i=e.multiple;if(!i||Array.isArray(r)){for(var o,a,s=0,l=e.options.length;s<l;s++)if(a=e.options[s],i)o=Ct(r,ls(a))>-1,a.selected!==o&&(a.selected=o);else if(St(ls(a),r))return void(e.selectedIndex!==s&&(e.selectedIndex=s));i||(e.selectedIndex=-1)}}function ss(e,t){return t.every((function(t){return!St(t,e)}))}function ls(e){return"_value"in e?e._value:e.value}function cs(e){e.target.composing=!0}function ds(e){e.target.composing&&(e.target.composing=!1,us(e.target,"input"))}function us(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function hs(e){return!e.componentInstance||e.data&&e.data.transition?e:hs(e.componentInstance._vnode)}var ps={model:is,show:{bind:function(e,t,n){var r=t.value,i=(n=hs(n)).data&&n.data.transition,o=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;r&&i?(n.data.show=!0,Qa(n,(function(){e.style.display=o}))):e.style.display=r?o:"none"},update:function(e,t,n){var r=t.value;!r!=!t.oldValue&&((n=hs(n)).data&&n.data.transition?(n.data.show=!0,r?Qa(n,(function(){e.style.display=e.__vOriginalDisplay})):Za(n,(function(){e.style.display="none"}))):e.style.display=r?e.__vOriginalDisplay:"none")},unbind:function(e,t,n,r,i){i||(e.style.display=e.__vOriginalDisplay)}}},vs={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function ms(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?ms(pr(t.children)):e}function gs(e){var t={},n=e.$options;for(var r in n.propsData)t[r]=e[r];var i=n._parentListeners;for(var r in i)t[ut(r)]=i[r];return t}function fs(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}var ys=function(e){return e.tag||nr(e)},_s=function(e){return"show"===e.name},Es={name:"transition",props:vs,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(ys)).length){var r=this.mode,i=n[0];if(function(e){for(;e=e.parent;)if(e.data.transition)return!0}(this.$vnode))return i;var o=ms(i);if(!o)return i;if(this._leaving)return fs(e,i);var a="__transition-".concat(this._uid,"-");o.key=null==o.key?o.isComment?a+"comment":a+o.tag:He(o.key)?0===String(o.key).indexOf(a)?o.key:a+o.key:o.key;var s=(o.data||(o.data={})).transition=gs(this),l=this._vnode,c=ms(l);if(o.data.directives&&o.data.directives.some(_s)&&(o.data.show=!0),c&&c.data&&!function(e,t){return t.key===e.key&&t.tag===e.tag}(o,c)&&!nr(c)&&(!c.componentInstance||!c.componentInstance._vnode.isComment)){var d=c.data.transition=ft({},s);if("out-in"===r)return this._leaving=!0,Rn(d,"afterLeave",(function(){t._leaving=!1,t.$forceUpdate()})),fs(e,i);if("in-out"===r){if(nr(o))return l;var u,h=function(){u()};Rn(s,"afterEnter",h),Rn(s,"enterCancelled",h),Rn(d,"delayLeave",(function(e){u=e}))}}return i}}},bs=ft({tag:String,moveClass:String},vs);delete bs.mode;var Ss={props:bs,beforeMount:function(){var e=this,t=this._update;this._update=function(n,r){var i=Er(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,i(),t.call(e,n,r)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),r=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],a=gs(this),s=0;s<i.length;s++)(d=i[s]).tag&&null!=d.key&&0!==String(d.key).indexOf("__vlist")&&(o.push(d),n[d.key]=d,(d.data||(d.data={})).transition=a);if(r){var l=[],c=[];for(s=0;s<r.length;s++){var d;(d=r[s]).data.transition=a,d.data.pos=d.elm.getBoundingClientRect(),n[d.key]?l.push(d):c.push(d)}this.kept=e(t,null,l),this.removed=c}return e(t,null,o)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(Cs),e.forEach(ws),e.forEach(As),this._reflow=document.body.offsetHeight,e.forEach((function(e){if(e.data.moved){var n=e.elm,r=n.style;Wa(n,t),r.transform=r.WebkitTransform=r.transitionDuration="",n.addEventListener(Ga,n._moveCb=function e(r){r&&r.target!==n||r&&!/transform$/.test(r.propertyName)||(n.removeEventListener(Ga,e),n._moveCb=null,qa(n,t))})}})))},methods:{hasMove:function(e,t){if(!Ma)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach((function(e){Da(n,e)})),Na(n,t),n.style.display="none",this.$el.appendChild(n);var r=za(n);return this.$el.removeChild(n),this._hasMove=r.hasTransform}}};function Cs(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function ws(e){e.data.newPos=e.elm.getBoundingClientRect()}function As(e){var t=e.data.pos,n=e.data.newPos,r=t.left-n.left,i=t.top-n.top;if(r||i){e.data.moved=!0;var o=e.elm.style;o.transform=o.WebkitTransform="translate(".concat(r,"px,").concat(i,"px)"),o.transitionDuration="0s"}}var Ts={Transition:Es,TransitionGroup:Ss};Mi.config.mustUseProp=Wi,Mi.config.isReservedTag=ao,Mi.config.isReservedAttr=ji,Mi.config.getTagNamespace=so,Mi.config.isUnknownElement=function(e){if(!Lt)return!0;if(ao(e))return!1;if(e=e.toLowerCase(),null!=lo[e])return lo[e];var t=document.createElement(e);return e.indexOf("-")>-1?lo[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:lo[e]=/HTMLUnknownElement/.test(t.toString())},ft(Mi.options.directives,ps),ft(Mi.options.components,Ts),Mi.prototype.__patch__=Lt?rs:_t,Mi.prototype.$mount=function(e,t){return function(e,t,n){var r;e.$el=t,e.$options.render||(e.$options.render=Zt),wr(e,"beforeMount"),r=function(){e._update(e._render(),n)},new ni(e,r,_t,{before:function(){e._isMounted&&!e._isDestroyed&&wr(e,"beforeUpdate")}},!0),n=!1;var i=e._preWatchers;if(i)for(var o=0;o<i.length;o++)i[o].run();return null==e.$vnode&&(e._isMounted=!0,wr(e,"mounted")),e}(this,e=e&&Lt?uo(e):void 0,t)},Lt&&setTimeout((function(){kt.devtools&&qt&&qt.emit("init",Mi)}),0);var Is,ks=/\{\{((?:.|\r?\n)+?)\}\}/g,Os=/[-.*+?^${}()|[\]\/\\]/g,Rs=ct((function(e){var t=e[0].replace(Os,"\\$&"),n=e[1].replace(Os,"\\$&");return new RegExp(t+"((?:.|\\n)+?)"+n,"g")})),xs={staticKeys:["staticClass"],transformNode:function(e,t){t.warn;var n=Xo(e,"class");n&&(e.staticClass=JSON.stringify(n.replace(/\s+/g," ").trim()));var r=Jo(e,"class",!1);r&&(e.classBinding=r)},genData:function(e){var t="";return e.staticClass&&(t+="staticClass:".concat(e.staticClass,",")),e.classBinding&&(t+="class:".concat(e.classBinding,",")),t}},Ns={staticKeys:["staticStyle"],transformNode:function(e,t){t.warn;var n=Xo(e,"style");n&&(e.staticStyle=JSON.stringify(Ea(n)));var r=Jo(e,"style",!1);r&&(e.styleBinding=r)},genData:function(e){var t="";return e.staticStyle&&(t+="staticStyle:".concat(e.staticStyle,",")),e.styleBinding&&(t+="style:(".concat(e.styleBinding,"),")),t}},Ds=rt("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),Ls=rt("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"),Ps=rt("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),Ms=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,Us=/^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+?\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,Fs="[a-zA-Z_][\\-\\.0-9_a-zA-Z".concat(Ot.source,"]*"),Bs="((?:".concat(Fs,"\\:)?").concat(Fs,")"),Gs=new RegExp("^<".concat(Bs)),$s=/^\s*(\/?)>/,Vs=new RegExp("^<\\/".concat(Bs,"[^>]*>")),js=/^<!DOCTYPE [^>]+>/i,Ks=/^<!\--/,Ws=/^<!\[/,qs=rt("script,style,textarea",!0),Hs={},Ys={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},zs=/&(?:lt|gt|quot|amp|#39);/g,Js=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,Xs=rt("pre,textarea",!0),Qs=function(e,t){return e&&Xs(e)&&"\n"===t[0]};function Zs(e,t){var n=t?Js:zs;return e.replace(n,(function(e){return Ys[e]}))}var el,tl,nl,rl,il,ol,al,sl,ll=/^@|^v-on:/,cl=/^v-|^@|^:|^#/,dl=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,ul=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,hl=/^\(|\)$/g,pl=/^\[.*\]$/,vl=/:(.*)$/,ml=/^:|^\.|^v-bind:/,gl=/\.[^.\]]+(?=[^\]]*$)/g,fl=/^v-slot(:|$)|^#/,yl=/[\r\n]/,_l=/[ \f\t\r\n]+/g,El=ct((function(e){return(Is=Is||document.createElement("div")).innerHTML=e,Is.textContent})),bl="_empty_";function Sl(e,t,n){return{type:1,tag:e,attrsList:t,attrsMap:Ol(t),rawAttrsMap:{},parent:n,children:[]}}function Cl(e,t){el=t.warn||Vo,ol=t.isPreTag||Et,al=t.mustUseProp||Et,sl=t.getTagNamespace||Et;t.isReservedTag;nl=jo(t.modules,"transformNode"),rl=jo(t.modules,"preTransformNode"),il=jo(t.modules,"postTransformNode"),tl=t.delimiters;var n,r,i=[],o=!1!==t.preserveWhitespace,a=t.whitespace,s=!1,l=!1;function c(e){if(d(e),s||e.processed||(e=wl(e,t)),i.length||e===n||n.if&&(e.elseif||e.else)&&Tl(n,{exp:e.elseif,block:e}),r&&!e.forbidden)if(e.elseif||e.else)a=e,c=function(e){for(var t=e.length;t--;){if(1===e[t].type)return e[t];e.pop()}}(r.children),c&&c.if&&Tl(c,{exp:a.elseif,block:a});else{if(e.slotScope){var o=e.slotTarget||'"default"';(r.scopedSlots||(r.scopedSlots={}))[o]=e}r.children.push(e),e.parent=r}var a,c;e.children=e.children.filter((function(e){return!e.slotScope})),d(e),e.pre&&(s=!1),ol(e.tag)&&(l=!1);for(var u=0;u<il.length;u++)il[u](e,t)}function d(e){if(!l)for(var t=void 0;(t=e.children[e.children.length-1])&&3===t.type&&" "===t.text;)e.children.pop()}return function(e,t){for(var n,r,i=[],o=t.expectHTML,a=t.isUnaryTag||Et,s=t.canBeLeftOpenTag||Et,l=0,c=function(){if(n=e,r&&qs(r)){var c=0,h=r.toLowerCase(),p=Hs[h]||(Hs[h]=new RegExp("([\\s\\S]*?)(</"+h+"[^>]*>)","i"));S=e.replace(p,(function(e,n,r){return c=r.length,qs(h)||"noscript"===h||(n=n.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),Qs(h,n)&&(n=n.slice(1)),t.chars&&t.chars(n),""})),l+=e.length-S.length,e=S,u(h,l-c,l)}else{var v=e.indexOf("<");if(0===v){if(Ks.test(e)){var m=e.indexOf("--\x3e");if(m>=0)return t.shouldKeepComment&&t.comment&&t.comment(e.substring(4,m),l,l+m+3),d(m+3),"continue"}if(Ws.test(e)){var g=e.indexOf("]>");if(g>=0)return d(g+2),"continue"}var f=e.match(js);if(f)return d(f[0].length),"continue";var y=e.match(Vs);if(y){var _=l;return d(y[0].length),u(y[1],_,l),"continue"}var E=function(){var t=e.match(Gs);if(t){var n={tagName:t[1],attrs:[],start:l};d(t[0].length);for(var r=void 0,i=void 0;!(r=e.match($s))&&(i=e.match(Us)||e.match(Ms));)i.start=l,d(i[0].length),i.end=l,n.attrs.push(i);if(r)return n.unarySlash=r[1],d(r[0].length),n.end=l,n}}();if(E)return function(e){var n=e.tagName,l=e.unarySlash;o&&("p"===r&&Ps(n)&&u(r),s(n)&&r===n&&u(n));for(var c=a(n)||!!l,d=e.attrs.length,h=new Array(d),p=0;p<d;p++){var v=e.attrs[p],m=v[3]||v[4]||v[5]||"",g="a"===n&&"href"===v[1]?t.shouldDecodeNewlinesForHref:t.shouldDecodeNewlines;h[p]={name:v[1],value:Zs(m,g)}}c||(i.push({tag:n,lowerCasedTag:n.toLowerCase(),attrs:h,start:e.start,end:e.end}),r=n),t.start&&t.start(n,h,c,e.start,e.end)}(E),Qs(E.tagName,e)&&d(1),"continue"}var b=void 0,S=void 0,C=void 0;if(v>=0){for(S=e.slice(v);!(Vs.test(S)||Gs.test(S)||Ks.test(S)||Ws.test(S)||(C=S.indexOf("<",1))<0);)v+=C,S=e.slice(v);b=e.substring(0,v)}v<0&&(b=e),b&&d(b.length),t.chars&&b&&t.chars(b,l-b.length,l)}if(e===n)return t.chars&&t.chars(e),"break"};e&&"break"!==c(););function d(t){l+=t,e=e.substring(t)}function u(e,n,o){var a,s;if(null==n&&(n=l),null==o&&(o=l),e)for(s=e.toLowerCase(),a=i.length-1;a>=0&&i[a].lowerCasedTag!==s;a--);else a=0;if(a>=0){for(var c=i.length-1;c>=a;c--)t.end&&t.end(i[c].tag,n,o);i.length=a,r=a&&i[a-1].tag}else"br"===s?t.start&&t.start(e,[],!0,n,o):"p"===s&&(t.start&&t.start(e,[],!1,n,o),t.end&&t.end(e,n,o))}u()}(e,{warn:el,expectHTML:t.expectHTML,isUnaryTag:t.isUnaryTag,canBeLeftOpenTag:t.canBeLeftOpenTag,shouldDecodeNewlines:t.shouldDecodeNewlines,shouldDecodeNewlinesForHref:t.shouldDecodeNewlinesForHref,shouldKeepComment:t.comments,outputSourceRange:t.outputSourceRange,start:function(e,o,a,d,u){var h=r&&r.ns||sl(e);Mt&&"svg"===h&&(o=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Rl.test(r.name)||(r.name=r.name.replace(xl,""),t.push(r))}return t}(o));var p,v=Sl(e,o,r);h&&(v.ns=h),"style"!==(p=v).tag&&("script"!==p.tag||p.attrsMap.type&&"text/javascript"!==p.attrsMap.type)||Wt()||(v.forbidden=!0);for(var m=0;m<rl.length;m++)v=rl[m](v,t)||v;s||(function(e){null!=Xo(e,"v-pre")&&(e.pre=!0)}(v),v.pre&&(s=!0)),ol(v.tag)&&(l=!0),s?function(e){var t=e.attrsList,n=t.length;if(n)for(var r=e.attrs=new Array(n),i=0;i<n;i++)r[i]={name:t[i].name,value:JSON.stringify(t[i].value)},null!=t[i].start&&(r[i].start=t[i].start,r[i].end=t[i].end);else e.pre||(e.plain=!0)}(v):v.processed||(Al(v),function(e){var t=Xo(e,"v-if");if(t)e.if=t,Tl(e,{exp:t,block:e});else{null!=Xo(e,"v-else")&&(e.else=!0);var n=Xo(e,"v-else-if");n&&(e.elseif=n)}}(v),function(e){null!=Xo(e,"v-once")&&(e.once=!0)}(v)),n||(n=v),a?c(v):(r=v,i.push(v))},end:function(e,t,n){var o=i[i.length-1];i.length-=1,r=i[i.length-1],c(o)},chars:function(e,t,n){if(r&&(!Mt||"textarea"!==r.tag||r.attrsMap.placeholder!==e)){var i,c=r.children;if(e=l||e.trim()?"script"===(i=r).tag||"style"===i.tag?e:El(e):c.length?a?"condense"===a&&yl.test(e)?"":" ":o?" ":"":""){l||"condense"!==a||(e=e.replace(_l," "));var d=void 0,u=void 0;!s&&" "!==e&&(d=function(e,t){var n=t?Rs(t):ks;if(n.test(e)){for(var r,i,o,a=[],s=[],l=n.lastIndex=0;r=n.exec(e);){(i=r.index)>l&&(s.push(o=e.slice(l,i)),a.push(JSON.stringify(o)));var c=Go(r[1].trim());a.push("_s(".concat(c,")")),s.push({"@binding":c}),l=i+r[0].length}return l<e.length&&(s.push(o=e.slice(l)),a.push(JSON.stringify(o))),{expression:a.join("+"),tokens:s}}}(e,tl))?u={type:2,expression:d.expression,tokens:d.tokens,text:e}:" "===e&&c.length&&" "===c[c.length-1].text||(u={type:3,text:e}),u&&c.push(u)}}},comment:function(e,t,n){if(r){var i={type:3,text:e,isComment:!0};r.children.push(i)}}}),n}function wl(e,t){var n;!function(e){var t=Jo(e,"key");t&&(e.key=t)}(e),e.plain=!e.key&&!e.scopedSlots&&!e.attrsList.length,function(e){var t=Jo(e,"ref");t&&(e.ref=t,e.refInFor=function(e){for(var t=e;t;){if(void 0!==t.for)return!0;t=t.parent}return!1}(e))}(e),function(e){var t;"template"===e.tag?(t=Xo(e,"scope"),e.slotScope=t||Xo(e,"slot-scope")):(t=Xo(e,"slot-scope"))&&(e.slotScope=t);var n,r=Jo(e,"slot");if(r&&(e.slotTarget='""'===r?'"default"':r,e.slotTargetDynamic=!(!e.attrsMap[":slot"]&&!e.attrsMap["v-bind:slot"]),"template"===e.tag||e.slotScope||Wo(e,"slot",r,function(e,t){return e.rawAttrsMap[":"+t]||e.rawAttrsMap["v-bind:"+t]||e.rawAttrsMap[t]}(e,"slot"))),"template"===e.tag){if(n=Qo(e,fl)){var i=Il(n),o=i.name,a=i.dynamic;e.slotTarget=o,e.slotTargetDynamic=a,e.slotScope=n.value||bl}}else if(n=Qo(e,fl)){var s=e.scopedSlots||(e.scopedSlots={}),l=Il(n),c=l.name,d=(a=l.dynamic,s[c]=Sl("template",[],e));d.slotTarget=c,d.slotTargetDynamic=a,d.children=e.children.filter((function(e){if(!e.slotScope)return e.parent=d,!0})),d.slotScope=n.value||bl,e.children=[],e.plain=!1}}(e),"slot"===(n=e).tag&&(n.slotName=Jo(n,"name")),function(e){var t;(t=Jo(e,"is"))&&(e.component=t),null!=Xo(e,"inline-template")&&(e.inlineTemplate=!0)}(e);for(var r=0;r<nl.length;r++)e=nl[r](e,t)||e;return function(e){var t,n,r,i,o,a,s,l,c=e.attrsList;for(t=0,n=c.length;t<n;t++)if(r=i=c[t].name,o=c[t].value,cl.test(r))if(e.hasBindings=!0,(a=kl(r.replace(cl,"")))&&(r=r.replace(gl,"")),ml.test(r))r=r.replace(ml,""),o=Go(o),(l=pl.test(r))&&(r=r.slice(1,-1)),a&&(a.prop&&!l&&"innerHtml"===(r=ut(r))&&(r="innerHTML"),a.camel&&!l&&(r=ut(r)),a.sync&&(s=ta(o,"$event"),l?zo(e,'"update:"+('.concat(r,")"),s,null,!1,0,c[t],!0):(zo(e,"update:".concat(ut(r)),s,null,!1,0,c[t]),vt(r)!==ut(r)&&zo(e,"update:".concat(vt(r)),s,null,!1,0,c[t])))),a&&a.prop||!e.component&&al(e.tag,e.attrsMap.type,r)?Ko(e,r,o,c[t],l):Wo(e,r,o,c[t],l);else if(ll.test(r))r=r.replace(ll,""),(l=pl.test(r))&&(r=r.slice(1,-1)),zo(e,r,o,a,!1,0,c[t],l);else{var d=(r=r.replace(cl,"")).match(vl),u=d&&d[1];l=!1,u&&(r=r.slice(0,-(u.length+1)),pl.test(u)&&(u=u.slice(1,-1),l=!0)),Ho(e,r,i,o,u,l,a,c[t])}else Wo(e,r,JSON.stringify(o),c[t]),!e.component&&"muted"===r&&al(e.tag,e.attrsMap.type,r)&&Ko(e,r,"true",c[t])}(e),e}function Al(e){var t;if(t=Xo(e,"v-for")){var n=function(e){var t=e.match(dl);if(t){var n={};n.for=t[2].trim();var r=t[1].trim().replace(hl,""),i=r.match(ul);return i?(n.alias=r.replace(ul,"").trim(),n.iterator1=i[1].trim(),i[2]&&(n.iterator2=i[2].trim())):n.alias=r,n}}(t);n&&ft(e,n)}}function Tl(e,t){e.ifConditions||(e.ifConditions=[]),e.ifConditions.push(t)}function Il(e){var t=e.name.replace(fl,"");return t||"#"!==e.name[0]&&(t="default"),pl.test(t)?{name:t.slice(1,-1),dynamic:!0}:{name:'"'.concat(t,'"'),dynamic:!1}}function kl(e){var t=e.match(gl);if(t){var n={};return t.forEach((function(e){n[e.slice(1)]=!0})),n}}function Ol(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n].name]=e[n].value;return t}var Rl=/^xmlns:NS\d+/,xl=/^NS\d+:/;function Nl(e){return Sl(e.tag,e.attrsList.slice(),e.parent)}var Dl,Ll,Pl={preTransformNode:function(e,t){if("input"===e.tag){var n=e.attrsMap;if(!n["v-model"])return;var r=void 0;if((n[":type"]||n["v-bind:type"])&&(r=Jo(e,"type")),n.type||r||!n["v-bind"]||(r="(".concat(n["v-bind"],").type")),r){var i=Xo(e,"v-if",!0),o=i?"&&(".concat(i,")"):"",a=null!=Xo(e,"v-else",!0),s=Xo(e,"v-else-if",!0),l=Nl(e);Al(l),qo(l,"type","checkbox"),wl(l,t),l.processed=!0,l.if="(".concat(r,")==='checkbox'")+o,Tl(l,{exp:l.if,block:l});var c=Nl(e);Xo(c,"v-for",!0),qo(c,"type","radio"),wl(c,t),Tl(l,{exp:"(".concat(r,")==='radio'")+o,block:c});var d=Nl(e);return Xo(d,"v-for",!0),qo(d,":type",r),wl(d,t),Tl(l,{exp:i,block:d}),a?l.else=!0:s&&(l.elseif=s),l}}}},Ml=[xs,Ns,Pl],Ul={expectHTML:!0,modules:Ml,directives:{model:function(e,t,n){var r=t.value,i=t.modifiers,o=e.tag,a=e.attrsMap.type;if(e.component)return ea(e,r,i),!1;if("select"===o)!function(e,t,n){var r=n&&n.number,i='Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;'+"return ".concat(r?"_n(val)":"val","})"),o="var $$selectedVal = ".concat(i,";");zo(e,"change",o="".concat(o," ").concat(ta(t,"$event.target.multiple ? $$selectedVal : $$selectedVal[0]")),null,!0)}(e,r,i);else if("input"===o&&"checkbox"===a)!function(e,t,n){var r=n&&n.number,i=Jo(e,"value")||"null",o=Jo(e,"true-value")||"true",a=Jo(e,"false-value")||"false";Ko(e,"checked","Array.isArray(".concat(t,")")+"?_i(".concat(t,",").concat(i,")>-1")+("true"===o?":(".concat(t,")"):":_q(".concat(t,",").concat(o,")"))),zo(e,"change","var $$a=".concat(t,",")+"$$el=$event.target,"+"$$c=$$el.checked?(".concat(o,"):(").concat(a,");")+"if(Array.isArray($$a)){"+"var $$v=".concat(r?"_n("+i+")":i,",")+"$$i=_i($$a,$$v);"+"if($$el.checked){$$i<0&&(".concat(ta(t,"$$a.concat([$$v])"),")}")+"else{$$i>-1&&(".concat(ta(t,"$$a.slice(0,$$i).concat($$a.slice($$i+1))"),")}")+"}else{".concat(ta(t,"$$c"),"}"),null,!0)}(e,r,i);else if("input"===o&&"radio"===a)!function(e,t,n){var r=n&&n.number,i=Jo(e,"value")||"null";i=r?"_n(".concat(i,")"):i,Ko(e,"checked","_q(".concat(t,",").concat(i,")")),zo(e,"change",ta(t,i),null,!0)}(e,r,i);else if("input"===o||"textarea"===o)!function(e,t,n){var r=e.attrsMap.type,i=n||{},o=i.lazy,a=i.number,s=i.trim,l=!o&&"range"!==r,c=o?"change":"range"===r?la:"input",d="$event.target.value";s&&(d="$event.target.value.trim()"),a&&(d="_n(".concat(d,")"));var u=ta(t,d);l&&(u="if($event.target.composing)return;".concat(u)),Ko(e,"value","(".concat(t,")")),zo(e,c,u,null,!0),(s||a)&&zo(e,"blur","$forceUpdate()")}(e,r,i);else if(!kt.isReservedTag(o))return ea(e,r,i),!1;return!0},text:function(e,t){t.value&&Ko(e,"textContent","_s(".concat(t.value,")"),t)},html:function(e,t){t.value&&Ko(e,"innerHTML","_s(".concat(t.value,")"),t)}},isPreTag:function(e){return"pre"===e},isUnaryTag:Ds,mustUseProp:Wi,canBeLeftOpenTag:Ls,isReservedTag:ao,getTagNamespace:so,staticKeys:function(e){return e.reduce((function(e,t){return e.concat(t.staticKeys||[])}),[]).join(",")}(Ml)},Fl=ct((function(e){return rt("type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap"+(e?","+e:""))}));function Bl(e,t){e&&(Dl=Fl(t.staticKeys||""),Ll=t.isReservedTag||Et,Gl(e),$l(e,!1))}function Gl(e){if(e.static=function(e){return 2!==e.type&&(3===e.type||!(!e.pre&&(e.hasBindings||e.if||e.for||it(e.tag)||!Ll(e.tag)||function(e){for(;e.parent;){if("template"!==(e=e.parent).tag)return!1;if(e.for)return!0}return!1}(e)||!Object.keys(e).every(Dl))))}(e),1===e.type){if(!Ll(e.tag)&&"slot"!==e.tag&&null==e.attrsMap["inline-template"])return;for(var t=0,n=e.children.length;t<n;t++){var r=e.children[t];Gl(r),r.static||(e.static=!1)}if(e.ifConditions)for(t=1,n=e.ifConditions.length;t<n;t++){var i=e.ifConditions[t].block;Gl(i),i.static||(e.static=!1)}}}function $l(e,t){if(1===e.type){if((e.static||e.once)&&(e.staticInFor=t),e.static&&e.children.length&&(1!==e.children.length||3!==e.children[0].type))return void(e.staticRoot=!0);if(e.staticRoot=!1,e.children)for(var n=0,r=e.children.length;n<r;n++)$l(e.children[n],t||!!e.for);if(e.ifConditions)for(n=1,r=e.ifConditions.length;n<r;n++)$l(e.ifConditions[n].block,t)}}var Vl=/^([\w$_]+|\([^)]*?\))\s*=>|^function(?:\s+[\w$]+)?\s*\(/,jl=/\([^)]*?\);*$/,Kl=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Wl={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},ql={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]},Hl=function(e){return"if(".concat(e,")return null;")},Yl={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:Hl("$event.target !== $event.currentTarget"),ctrl:Hl("!$event.ctrlKey"),shift:Hl("!$event.shiftKey"),alt:Hl("!$event.altKey"),meta:Hl("!$event.metaKey"),left:Hl("'button' in $event && $event.button !== 0"),middle:Hl("'button' in $event && $event.button !== 1"),right:Hl("'button' in $event && $event.button !== 2")};function zl(e,t){var n=t?"nativeOn:":"on:",r="",i="";for(var o in e){var a=Jl(e[o]);e[o]&&e[o].dynamic?i+="".concat(o,",").concat(a,","):r+='"'.concat(o,'":').concat(a,",")}return r="{".concat(r.slice(0,-1),"}"),i?n+"_d(".concat(r,",[").concat(i.slice(0,-1),"])"):n+r}function Jl(e){if(!e)return"function(){}";if(Array.isArray(e))return"[".concat(e.map((function(e){return Jl(e)})).join(","),"]");var t=Kl.test(e.value),n=Vl.test(e.value),r=Kl.test(e.value.replace(jl,""));if(e.modifiers){var i="",o="",a=[],s=function(t){if(Yl[t])o+=Yl[t],Wl[t]&&a.push(t);else if("exact"===t){var n=e.modifiers;o+=Hl(["ctrl","shift","alt","meta"].filter((function(e){return!n[e]})).map((function(e){return"$event.".concat(e,"Key")})).join("||"))}else a.push(t)};for(var l in e.modifiers)s(l);a.length&&(i+=function(e){return"if(!$event.type.indexOf('key')&&"+"".concat(e.map(Xl).join("&&"),")return null;")}(a)),o&&(i+=o);var c=t?"return ".concat(e.value,".apply(null, arguments)"):n?"return (".concat(e.value,").apply(null, arguments)"):r?"return ".concat(e.value):e.value;return"function($event){".concat(i).concat(c,"}")}return t||n?e.value:"function($event){".concat(r?"return ".concat(e.value):e.value,"}")}function Xl(e){var t=parseInt(e,10);if(t)return"$event.keyCode!==".concat(t);var n=Wl[e],r=ql[e];return"_k($event.keyCode,"+"".concat(JSON.stringify(e),",")+"".concat(JSON.stringify(n),",")+"$event.key,"+"".concat(JSON.stringify(r))+")"}var Ql={on:function(e,t){e.wrapListeners=function(e){return"_g(".concat(e,",").concat(t.value,")")}},bind:function(e,t){e.wrapData=function(n){return"_b(".concat(n,",'").concat(e.tag,"',").concat(t.value,",").concat(t.modifiers&&t.modifiers.prop?"true":"false").concat(t.modifiers&&t.modifiers.sync?",true":"",")")}},cloak:_t},Zl=function(e){this.options=e,this.warn=e.warn||Vo,this.transforms=jo(e.modules,"transformCode"),this.dataGenFns=jo(e.modules,"genData"),this.directives=ft(ft({},Ql),e.directives);var t=e.isReservedTag||Et;this.maybeComponent=function(e){return!!e.component||!t(e.tag)},this.onceId=0,this.staticRenderFns=[],this.pre=!1};function ec(e,t){var n=new Zl(t),r=e?"script"===e.tag?"null":tc(e,n):'_c("div")';return{render:"with(this){return ".concat(r,"}"),staticRenderFns:n.staticRenderFns}}function tc(e,t){if(e.parent&&(e.pre=e.pre||e.parent.pre),e.staticRoot&&!e.staticProcessed)return nc(e,t);if(e.once&&!e.onceProcessed)return rc(e,t);if(e.for&&!e.forProcessed)return ac(e,t);if(e.if&&!e.ifProcessed)return ic(e,t);if("template"!==e.tag||e.slotTarget||t.pre){if("slot"===e.tag)return function(e,t){var n=e.slotName||'"default"',r=dc(e,t),i="_t(".concat(n).concat(r?",function(){return ".concat(r,"}"):""),o=e.attrs||e.dynamicAttrs?pc((e.attrs||[]).concat(e.dynamicAttrs||[]).map((function(e){return{name:ut(e.name),value:e.value,dynamic:e.dynamic}}))):null,a=e.attrsMap["v-bind"];return!o&&!a||r||(i+=",null"),o&&(i+=",".concat(o)),a&&(i+="".concat(o?"":",null",",").concat(a)),i+")"}(e,t);var n=void 0;if(e.component)n=function(e,t,n){var r=t.inlineTemplate?null:dc(t,n,!0);return"_c(".concat(e,",").concat(sc(t,n)).concat(r?",".concat(r):"",")")}(e.component,e,t);else{var r=void 0,i=t.maybeComponent(e);(!e.plain||e.pre&&i)&&(r=sc(e,t));var o=void 0,a=t.options.bindings;i&&a&&!1!==a.__isScriptSetup&&(o=function(e,t){var n=ut(t),r=ht(n),i=function(i){return e[t]===i?t:e[n]===i?n:e[r]===i?r:void 0},o=i("setup-const")||i("setup-reactive-const");if(o)return o;var a=i("setup-let")||i("setup-ref")||i("setup-maybe-ref");return a||void 0}(a,e.tag)),o||(o="'".concat(e.tag,"'"));var s=e.inlineTemplate?null:dc(e,t,!0);n="_c(".concat(o).concat(r?",".concat(r):"").concat(s?",".concat(s):"",")")}for(var l=0;l<t.transforms.length;l++)n=t.transforms[l](e,n);return n}return dc(e,t)||"void 0"}function nc(e,t){e.staticProcessed=!0;var n=t.pre;return e.pre&&(t.pre=e.pre),t.staticRenderFns.push("with(this){return ".concat(tc(e,t),"}")),t.pre=n,"_m(".concat(t.staticRenderFns.length-1).concat(e.staticInFor?",true":"",")")}function rc(e,t){if(e.onceProcessed=!0,e.if&&!e.ifProcessed)return ic(e,t);if(e.staticInFor){for(var n="",r=e.parent;r;){if(r.for){n=r.key;break}r=r.parent}return n?"_o(".concat(tc(e,t),",").concat(t.onceId++,",").concat(n,")"):tc(e,t)}return nc(e,t)}function ic(e,t,n,r){return e.ifProcessed=!0,oc(e.ifConditions.slice(),t,n,r)}function oc(e,t,n,r){if(!e.length)return r||"_e()";var i=e.shift();return i.exp?"(".concat(i.exp,")?").concat(o(i.block),":").concat(oc(e,t,n,r)):"".concat(o(i.block));function o(e){return n?n(e,t):e.once?rc(e,t):tc(e,t)}}function ac(e,t,n,r){var i=e.for,o=e.alias,a=e.iterator1?",".concat(e.iterator1):"",s=e.iterator2?",".concat(e.iterator2):"";return e.forProcessed=!0,"".concat(r||"_l","((").concat(i,"),")+"function(".concat(o).concat(a).concat(s,"){")+"return ".concat((n||tc)(e,t))+"})"}function sc(e,t){var n="{",r=function(e,t){var n=e.directives;if(n){var r,i,o,a,s="directives:[",l=!1;for(r=0,i=n.length;r<i;r++){o=n[r],a=!0;var c=t.directives[o.name];c&&(a=!!c(e,o,t.warn)),a&&(l=!0,s+='{name:"'.concat(o.name,'",rawName:"').concat(o.rawName,'"').concat(o.value?",value:(".concat(o.value,"),expression:").concat(JSON.stringify(o.value)):"").concat(o.arg?",arg:".concat(o.isDynamicArg?o.arg:'"'.concat(o.arg,'"')):"").concat(o.modifiers?",modifiers:".concat(JSON.stringify(o.modifiers)):"","},"))}return l?s.slice(0,-1)+"]":void 0}}(e,t);r&&(n+=r+","),e.key&&(n+="key:".concat(e.key,",")),e.ref&&(n+="ref:".concat(e.ref,",")),e.refInFor&&(n+="refInFor:true,"),e.pre&&(n+="pre:true,"),e.component&&(n+='tag:"'.concat(e.tag,'",'));for(var i=0;i<t.dataGenFns.length;i++)n+=t.dataGenFns[i](e);if(e.attrs&&(n+="attrs:".concat(pc(e.attrs),",")),e.props&&(n+="domProps:".concat(pc(e.props),",")),e.events&&(n+="".concat(zl(e.events,!1),",")),e.nativeEvents&&(n+="".concat(zl(e.nativeEvents,!0),",")),e.slotTarget&&!e.slotScope&&(n+="slot:".concat(e.slotTarget,",")),e.scopedSlots&&(n+="".concat(function(e,t,n){var r=e.for||Object.keys(t).some((function(e){var n=t[e];return n.slotTargetDynamic||n.if||n.for||lc(n)})),i=!!e.if;if(!r)for(var o=e.parent;o;){if(o.slotScope&&o.slotScope!==bl||o.for){r=!0;break}o.if&&(i=!0),o=o.parent}var a=Object.keys(t).map((function(e){return cc(t[e],n)})).join(",");return"scopedSlots:_u([".concat(a,"]").concat(r?",null,true":"").concat(!r&&i?",null,false,".concat(function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(a)):"",")")}(e,e.scopedSlots,t),",")),e.model&&(n+="model:{value:".concat(e.model.value,",callback:").concat(e.model.callback,",expression:").concat(e.model.expression,"},")),e.inlineTemplate){var o=function(e,t){var n=e.children[0];if(n&&1===n.type){var r=ec(n,t.options);return"inlineTemplate:{render:function(){".concat(r.render,"},staticRenderFns:[").concat(r.staticRenderFns.map((function(e){return"function(){".concat(e,"}")})).join(","),"]}")}}(e,t);o&&(n+="".concat(o,","))}return n=n.replace(/,$/,"")+"}",e.dynamicAttrs&&(n="_b(".concat(n,',"').concat(e.tag,'",').concat(pc(e.dynamicAttrs),")")),e.wrapData&&(n=e.wrapData(n)),e.wrapListeners&&(n=e.wrapListeners(n)),n}function lc(e){return 1===e.type&&("slot"===e.tag||e.children.some(lc))}function cc(e,t){var n=e.attrsMap["slot-scope"];if(e.if&&!e.ifProcessed&&!n)return ic(e,t,cc,"null");if(e.for&&!e.forProcessed)return ac(e,t,cc);var r=e.slotScope===bl?"":String(e.slotScope),i="function(".concat(r,"){")+"return ".concat("template"===e.tag?e.if&&n?"(".concat(e.if,")?").concat(dc(e,t)||"undefined",":undefined"):dc(e,t)||"undefined":tc(e,t),"}"),o=r?"":",proxy:true";return"{key:".concat(e.slotTarget||'"default"',",fn:").concat(i).concat(o,"}")}function dc(e,t,n,r,i){var o=e.children;if(o.length){var a=o[0];if(1===o.length&&a.for&&"template"!==a.tag&&"slot"!==a.tag){var s=n?t.maybeComponent(a)?",1":",0":"";return"".concat((r||tc)(a,t)).concat(s)}var l=n?function(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r];if(1===i.type){if(uc(i)||i.ifConditions&&i.ifConditions.some((function(e){return uc(e.block)}))){n=2;break}(t(i)||i.ifConditions&&i.ifConditions.some((function(e){return t(e.block)})))&&(n=1)}}return n}(o,t.maybeComponent):0,c=i||hc;return"[".concat(o.map((function(e){return c(e,t)})).join(","),"]").concat(l?",".concat(l):"")}}function uc(e){return void 0!==e.for||"template"===e.tag||"slot"===e.tag}function hc(e,t){return 1===e.type?tc(e,t):3===e.type&&e.isComment?function(e){return"_e(".concat(JSON.stringify(e.text),")")}(e):"_v(".concat(2===(n=e).type?n.expression:vc(JSON.stringify(n.text)),")");var n}function pc(e){for(var t="",n="",r=0;r<e.length;r++){var i=e[r],o=vc(i.value);i.dynamic?n+="".concat(i.name,",").concat(o,","):t+='"'.concat(i.name,'":').concat(o,",")}return t="{".concat(t.slice(0,-1),"}"),n?"_d(".concat(t,",[").concat(n.slice(0,-1),"])"):t}function vc(e){return e.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function mc(e,t){try{return new Function(e)}catch(n){return t.push({err:n,code:e}),_t}}function gc(e){var t=Object.create(null);return function(n,r,i){(r=ft({},r)).warn,delete r.warn;var o=r.delimiters?String(r.delimiters)+n:n;if(t[o])return t[o];var a=e(n,r),s={},l=[];return s.render=mc(a.render,l),s.staticRenderFns=a.staticRenderFns.map((function(e){return mc(e,l)})),t[o]=s}}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b")+"\\b"),new RegExp("\\b"+"delete,typeof,void".split(",").join("\\s*\\([^\\)]*\\)|\\b")+"\\s*\\([^\\)]*\\)");var fc,yc,_c=(fc=function(e,t){var n=Cl(e.trim(),t);!1!==t.optimize&&Bl(n,t);var r=ec(n,t);return{ast:n,render:r.render,staticRenderFns:r.staticRenderFns}},function(e){function t(t,n){var r=Object.create(e),i=[],o=[];if(n)for(var a in n.modules&&(r.modules=(e.modules||[]).concat(n.modules)),n.directives&&(r.directives=ft(Object.create(e.directives||null),n.directives)),n)"modules"!==a&&"directives"!==a&&(r[a]=n[a]);r.warn=function(e,t,n){(n?o:i).push(e)};var s=fc(t.trim(),r);return s.errors=i,s.tips=o,s}return{compile:t,compileToFunctions:gc(t)}}),Ec=_c(Ul).compileToFunctions;function bc(e){return(yc=yc||document.createElement("div")).innerHTML=e?'<a href="\n"/>':'<div a="\n"/>',yc.innerHTML.indexOf("&#10;")>0}var Sc=!!Lt&&bc(!1),Cc=!!Lt&&bc(!0),wc=ct((function(e){var t=uo(e);return t&&t.innerHTML})),Ac=Mi.prototype.$mount;Mi.prototype.$mount=function(e,t){if((e=e&&uo(e))===document.body||e===document.documentElement)return this;var n=this.$options;if(!n.render){var r=n.template;if(r)if("string"==typeof r)"#"===r.charAt(0)&&(r=wc(r));else{if(!r.nodeType)return this;r=r.innerHTML}else e&&(r=function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}(e));if(r){var i=Ec(r,{outputSourceRange:!1,shouldDecodeNewlines:Sc,shouldDecodeNewlinesForHref:Cc,delimiters:n.delimiters,comments:n.comments},this),o=i.render,a=i.staticRenderFns;n.render=o,n.staticRenderFns=a}}return Ac.call(this,e,t)},Mi.compile=Ec;var Tc=s(4765),Ic=s(9410),kc={},Oc={},Rc=null,xc=!1;function Nc(e){null!==Oc[e]&&(Oc[e].close(),Oc[e]=null,log.debug("SSE closed."))}function Dc(e){for(var t="",n=0;n<e.length;n++)t+=e.charCodeAt(n).toString()+"-";return t}kc.sendDataToInputPort=function(e,n,r,i){if(e&&n&&r)return new Promise(((o,a)=>{t.A.ajax({type:"PUT",beforeSend:function(e){e.setRequestHeader("Content-Type","text/plain")},url:kc.getRestURL(i)+"runtime/model/components/"+Dc(e)+"/ports/"+Dc(n)+"/data",datatype:"text",crossDomain:!0,data:r,success:function(e,t,n){o(n.responseText,t)},error:function(e,t,n){a(n,e.responseText)}})}))},kc.triggerEvent=function(e,n,r){if(e&&n)return new Promise(((i,o)=>{t.A.ajax({type:"PUT",url:kc.getRestURL(r)+"runtime/model/components/"+Dc(e)+"/events/"+Dc(n),datatype:"text",crossDomain:!0,success:function(e,t,n){i(n.responseText,t)},error:function(e,t,n){o(n,e.responseText)}})}))},kc.getRuntimeComponentIds=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"GET",url:kc.getRestURL(e)+"runtime/model/components/ids",datatype:"application/json",crossDomain:!0,success:function(e,t,r){n(JSON.parse(r.responseText),t)},error:function(e,t,n){r(n,e.responseText)}})}))},kc.uploadModelBase64=function(e,n){return new Promise(((r,i)=>{e?t.A.ajax({type:"PUT",url:kc.getRestURL(n)+"runtime/model",contentType:"text/xml",data:window.atob(e),datatype:"text",crossDomain:!0,success:function(e,t,n){r(n.responseText,t)},error:function(e,t,n){i(n,e.responseText)}}):i()}))},kc.uploadAndStartModel=function(e,t,n){return new Promise(((r,i)=>{kc.getModelName(t).then((i=>{i!==n?kc.uploadModelBase64(e,t).then((()=>{kc.startModel(t).then((()=>{r()}))})):kc.startModel(t).then((()=>{r()}))})).catch((()=>{r(!1)}))}))},kc.downloadDeployedModelBase64=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"GET",url:kc.getRestURL(e)+"runtime/model",datatype:"text/xml",crossDomain:!0,success:function(e,t,r){n(window.btoa(r.responseText),t)},error:function(e,t,n){r(n,e.responseText)}})}))},kc.startModel=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"PUT",url:kc.getRestURL(e)+"runtime/model/state/start",datatype:"text",crossDomain:!0,success:function(e,t,r){n(r.responseText,t)},error:function(e,t,n){r(n,e.responseText)}})}))},kc.getModelName=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"GET",url:kc.getRestURL(e)+"runtime/model/name",datatype:"text",crossDomain:!0,success:function(e,t,r){var i=r.responseText;-1!=(i=(i=i.substring(i.lastIndexOf("\\")+1)).substring(i.lastIndexOf("/")+1)).indexOf(".acs")&&(i=i.substring(0,i.indexOf(".acs")+4)),n(i,t)},error:function(e,t,n){log.info("couldn't get ARE model name"),r(n,e.responseText)}})}))},kc.getRuntimeComponentIds=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"GET",url:kc.getRestURL(e)+"runtime/model/components/ids",datatype:"application/json",crossDomain:!0,success:function(e,t,r){n(JSON.parse(r.responseText),t)},error:function(e,t,n){r(n,e.responseText)}})}))},kc.getComponentInputPortIds=function(e,n){return new Promise(((r,i)=>{e?t.A.ajax({type:"GET",url:kc.getRestURL(n)+"runtime/model/components/"+Dc(e)+"/ports/input/ids",datatype:"application/json",crossDomain:!0,success:function(e,t,n){r(JSON.parse(n.responseText),t)},error:function(e,t,n){i(n,e.responseText)}}):r([])}))},kc.getComponentEventPortIds=function(e,n){return new Promise(((r,i)=>{e?t.A.ajax({type:"GET",url:kc.getRestURL(n)+"runtime/model/components/"+Dc(e)+"/channels/event/ids",datatype:"application/json",crossDomain:!0,success:function(e,t,n){r(JSON.parse(n.responseText),t)},error:function(e,t,n){i(n,e.responseText)}}):r([])}))},kc.getRestURL=function(e){e||(e=window.location.hostname.indexOf("grid.asterics.eu")>-1?"http://127.0.0.1:8081":"http://"+window.location.hostname+":8081"),-1===e.indexOf("http")&&(e="http://"+e);var t=document.createElement("a");return t.href=e,t.pathname="/rest/",t.port||(t.port=8081),t.href},kc.getTypeId=function(e,n){let r=window.atob(n);return(0,t.A)(r).find('components component[id="'+e+'"]').attr("type_id")},kc.getComponentDescriptorsAsXml=function(e){return new Promise(((n,r)=>{t.A.ajax({type:"GET",url:kc.getRestURL(e)+"storage/components/descriptors/xml",datatype:"text/xml",crossDomain:!0,success:function(e,t,r){n(e,t)},error:function(e,t,n){r(n,e.responseText)}})}))},kc.getPossibleEvents=function(e,n,r){return new Promise((i=>{kc.getComponentDescriptorsAsXml(r).then((r=>{let o=kc.getTypeId(e,n),a=(0,t.A)(r).find('componentType[id="'+o+'"] eventListenerPort').map((function(){return this.id})).get();i(a)}))}))},kc.subscribeEvents=function(e,t,n){if("undefined"==typeof EventSource)return void log.warn("SSE not supported by browser");let r=kc.getRestURL(e);Oc[r]||(Oc[r]=new EventSource(r+"runtime/model/channels/event/listener"),Oc[r].onopen=function(e){log.debug("SSE opened."),xc=!0},Oc[r].onerror=function(i){Nc(r),n&&n(i),xc&&(log.info("SSE error occured, trying to reconnect in 10 seconds..."),Rc=setTimeout((function(){Rc=null,kc.subscribeEvents(e,t,n)}),3e3))}),Oc[r].addEventListener("event",(function(e){t(e.data,200)}),!1)},kc.unsubscribeEvents=function(e){Rc&&clearTimeout(Rc),xc=!1,e?Nc(e):Object.keys(Oc).forEach((e=>{Nc(e)}))};var Lc=s(3766);let Pc={},Mc=!1,Uc=null,Fc=null,Bc=!1,Gc=!1,$c=null,Vc=null,jc=null,Kc=null,Wc=null,qc=[];Pc.record=async function(e){if(!e)return;if(Uc||(Uc=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})),!Uc)return log.warn("no access to audio stream!"),Promise.reject();let t=["audio/webm","audio/ogg","audio/mp4"].filter((e=>MediaRecorder.isTypeSupported(e)));if(0===t.length)return void log.warn("recorder supports no mimeType");const n=[];Pc.stopRecording(),Fc=new MediaRecorder(Uc,{mimeType:t[0]}),Fc.addEventListener("dataavailable",(function(e){e.data.size>0&&n.push(e.data)})),Fc.addEventListener("stop",(async function(){let r=new Blob(n),i=await function(e){return new Promise(((t,n)=>{const r=new FileReader;r.onloadend=()=>{log.debug(r.result);let e=r.result.substring(r.result.indexOf(",")+1);t(e)},r.readAsDataURL(e)}))}(r);e({base64:i,mimeType:t[0]})})),Bc=!0,Fc.start()},Pc.stopRecording=function(){Fc&&(Bc=!1,Fc.stop(),Uc.getTracks().forEach((e=>{e.stop()})),Uc=null,Fc=null)},Pc.isRecording=function(){return Bc},Pc.addMicVolumeCallback=async function(e){e&&(qc.includes(e)||qc.push(e),await async function(){if(Gc)return;if(Gc=!0,Uc||(Uc=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})),!Uc)return log.warn("no access to audio stream!"),Promise.reject();Wc=new AudioContext,Kc=Wc.createMediaStreamSource(Uc);let e=Wc.sampleRate;jc=Wc.createAnalyser(),jc.fftSize=2048,Kc.connect(jc);const t=new Uint8Array(jc.fftSize),n=new Uint8Array(jc.frequencyBinCount);Vc=setInterval((()=>{jc.getByteTimeDomainData(t),jc.getByteFrequencyData(n);let r=0;for(const e of t)r+=Math.abs(128-e);let i=ee.Z.mapRange(r/t.length,0,128,0,100),o=-1/0,a=0;for(let t=0;t<n.length;t++)n[t]>o&&(o=n[t],a=ee.Z.mapRange(t,0,n.length-1,0,e/2));for(let e of qc)e(i,a)}),43)}())},Pc.removeMicVolumeCallback=function(e){qc=qc.filter((t=>t!==e)),0===qc.length&&Pc.stopRecordMicVolume()},Pc.stopRecordMicVolume=function(){clearInterval(Vc),Kc&&(Kc.disconnect(),Kc=null),Wc&&(Wc.close(),Wc=null),Uc&&(Uc.getTracks().forEach((e=>{e.stop()})),Uc=null),qc=[],Gc=!1},Pc.playAudio=function(e,t){t=t||{};let n=null;try{n=atob(e)}catch(e){return log.warn("error decoding base64 audio",e),Promise.resolve()}let r=Uint8Array.from(n,(e=>e.charCodeAt(0)));return Pc.playAudioUint8(r,t)},Pc.playAudioUint8=function(e,t){return t=t||{},new Promise((n=>{let r=new AudioContext;$c=r.createBufferSource(),$c.connect(r.destination),$c.start(0),r.decodeAudioData(e.buffer,(function(e){$c.buffer=e,n(),$c.onended=()=>{t.onended&&t.onended()}}),(e=>{log.warn("error decoding audio",e)}))}))},Pc.waitForAudioEnded=async function(){await new Promise((e=>{$c?$c.addEventListener("ended",(()=>{e()})):e()}))},Pc.stopAudio=function(){$c&&($c.stop(),$c=null)},Pc.beep=function(e,t,n,r,i){if(Mc)return;Mc=!0;let o=new(window.AudioContext||window.webkitAudioContext||window.audioContext),a=o.createOscillator(),s=o.createGain();a.connect(s),s.connect(o.destination),s.gain.value=n||s.gain.value,a.frequency.value=e||800,a.type=r||a.type,a.onended=function(){Mc=!1,i&&i()},a.start(o.currentTime),a.stop(o.currentTime+(t||50)/1e3),setTimeout((()=>{Mc=!1}),1e3)},Pc.beepHigh=function(){Pc.beep(1600)},Pc.beepHighDouble=function(){Pc.beep(1600),setTimeout((()=>{Pc.beep(1600)}),100)};let Hc={},Yc=[],zc={},Jc=0;function Xc(){let e={},t=100,n=null,r=null,i=[],o=[],a=[],s=[],l=[],c=[],d=[],u=[],h=[],p=[],v={},m=[],g=document.body,f=!1,y={},_=Jc++;function E(e,t){for(let n of m)n.lastTriggerTime=n.lastTriggerTime||0,n.debounceMs=n.debounceMs||100,e>n.volThresholdHigh&&t>n.freqThresholdLow&&t<n.freqThresholdHigh&&!n.aboveThreshold&&(new Date).getTime()-n.lastTriggerTime>n.debounceMs&&(n.lastTriggerTime=(new Date).getTime(),n.aboveThreshold=!0,n.handler()),e<n.volThresholdLow&&(n.aboveThreshold=!1)}function b(e,t){kc.subscribeEvents(e.areURL,(n=>{e.eventNames.indexOf(n)>-1&&t()}))}function S(t,n){if(!t||!t.keyCode||!n)return;let r=t.keyCode+"",i=v[r]?v[r]:[];return v[r]=i,i.push(function(e,t){return{handler:e,inputEvent:t,lastKeydown:null,lastAction:null,counter:0,timeoutHandler:null}}(n,t)),e}function C(e){(e.clientY<5||e.clientX<5)&&U(i)}function w(e){R({keyCode:T.O.KEY_MOUSE_PREFIX+e.button,preventDefault:()=>{}})}function A(e){x({keyCode:T.O.KEY_MOUSE_PREFIX+e.button,preventDefault:()=>{}})}function I(e){U(c,[e],!0),r&&n?e.touches[0].clientY>r+t?(log.debug("swipe down."),r=null,U(a)):e.touches[0].clientY<r-t?(log.debug("swipe up."),r=null,U(o)):e.touches[0].clientX>n+t?(log.debug("swipe right."),n=null,U(l)):e.touches[0].clientX<n-t&&(log.debug("swipe left."),n=null,U(s)):(r=e.touches[0].clientY,n=e.touches[0].clientX)}function k(e){x({keyCode:T.O.KEY_TAP,preventDefault:()=>{}}),U(u,[e],!0),n=null,r=null}function O(e){R({keyCode:T.O.KEY_TAP,preventDefault:()=>{}}),U(d,[e],!0)}function R(e){let t=e.which||e.keyCode;h.length>0&&!e.repeat&&h.forEach((n=>{n(t,e.code,e)}));let n=t+"";if(v[n]){if(e.preventDefault(),e.repeat)return;let r=v[n];function i(e){e.lastAction=(new Date).getTime(),e.handler(),L(r)}r=r.sort(((e,t)=>e.counter-t.counter||e.inputEvent.repeat-t.inputEvent.repeat)),r.forEach((e=>{e.inputEvent.timeout=e.inputEvent.repeat>1?e.inputEvent.timeout||500:e.inputEvent.timeout,P(e.lastKeydown,e.inputEvent.timeout)&&(e.counter=0)})),r.forEach((e=>{let t=e.inputEvent;if(t.repeat&&1!==t.repeat||t.holdDuration||!P(e.lastAction,t.timeout))if(t.repeat>1){if(e.counter++,e.counter===t.repeat){let n=r.filter((n=>n!==e&&n.inputEvent.repeat>t.repeat)).length>0?t.timeout:0;e.counter=0,function(e){e.forEach((e=>clearTimeout(e.timeoutHandler)))}(r),e.timeoutHandler=setTimeout((()=>{i(e)}),n)}}else t.holdDuration&&(e.timeoutHandler=setTimeout((()=>{i(e)}),t.holdDuration));else{let t=r.filter((t=>t!==e&&t.inputEvent.holdDuration)).length>0,n=r.filter((t=>t!==e&&t.inputEvent.repeat>1)),o=n.length>0,a=Math.max.apply(null,n.map((e=>e.counter)));if(t)e.doOnKeyup=()=>{i(e)};else if(o&&a<1){let t=Math.max(...n.map((e=>e.inputEvent.timeout)));e.timeoutHandler=setTimeout((()=>{i(e)}),t+10)}else o||i(e)}e.lastKeydown=(new Date).getTime()}))}}function x(e){if(e.repeat)return;let t=(e.which||e.keyCode)+"";if(v[t]){let e=v[t];e.forEach((t=>{t.doOnKeyup&&(t.doOnKeyup(),L(e)),t.inputEvent.holdDuration&&D(t)}))}}function N(){document.fullscreenElement||U(p)}function D(e){clearTimeout(e.timeoutHandler),e.timeoutHandler=null,e.doOnKeyup=null,e.counter=0}function L(e){e.forEach((e=>D(e)))}function P(e,t){return!e||!t||(new Date).getTime()-e>t}function M(t,n){return t&&n.push(t),e}function U(e,t,n){e.forEach((e=>{e.apply?n?e.apply(null,t):ee.Z.throttle((()=>{e.apply(null,t)})):log.warn("handler seems to be not a function!")}))}return e.startListening=function(){f||(f=!0,Object.keys(y).forEach((e=>{let t=y[e];b(t.inputEvent,t.fn)})),document.addEventListener("mousemove",C),document.addEventListener("mousedown",w),document.addEventListener("mouseup",A),document.addEventListener("keydown",R),document.addEventListener("keyup",x),document.addEventListener("fullscreenchange",N),g.addEventListener("touchmove",I,{passive:!1}),g.addEventListener("touchstart",O),g.addEventListener("touchend",k),m.length>0&&Pc.addMicVolumeCallback(E))},e.stopListening=function(){f=!1,Object.keys(y).forEach((e=>{let t=y[e];kc.unsubscribeEvents(t.areURL)})),document.removeEventListener("mousemove",C),document.removeEventListener("mousedown",w),document.removeEventListener("mouseup",A),document.removeEventListener("keydown",R),document.removeEventListener("keyup",x),document.removeEventListener("fullscreenchange",N),g.removeEventListener("touchmove",I),g.removeEventListener("touchstart",O),g.removeEventListener("touchend",k),Pc.removeMicVolumeCallback(E),Pc.stopRecordMicVolume()},e.destroy=function(){e.stopListening(),Yc=Yc.filter((t=>t.getID()!==e.getID()))},e.isListening=function(){return f},e.getID=function(){return _},e.onMouseUpperOrLeftBorder=function(e){return M(e,i)},e.onSwipedDown=function(e){return M(e,a)},e.onSwipedUp=function(e){return M(e,o)},e.onSwipedRight=function(e){return M(e,l)},e.onSwipedLeft=function(e){return M(e,s)},e.onEscape=function(e){return S(new T.O({keyCode:27}),e)},e.onAnyKey=function(e){return M(e,h)},e.onTouchMove=function(e){return M(e,c)},e.onTouchStart=function(e){return M(e,d)},e.onTouchEnd=function(e){return M(e,u)},e.onExitFullscreen=function(e){return M(e,p)},e.onMicVolumeThreshold=async function(e,t){return await Pc.addMicVolumeCallback(E),M({handler:e,volThresholdHigh:t.volThresholdHigh,volThresholdLow:t.volThresholdLow,freqThresholdHigh:t.freqThresholdHigh,freqThresholdLow:t.freqThresholdLow,debounceMs:t.debounceMs,aboveThreshold:!0},m)},e.off=function(e){let t=t=>t!==e;i=i.filter(t),o=o.filter(t),a=a.filter(t),s=s.filter(t),l=l.filter(t),c=c.filter(t),d=d.filter(t),u=u.filter(t),h=h.filter(t)},e.onInputEvent=function(t,n){if(t&&n)switch(t.modelName){case T.O.getModelName():return S(t,n);case Ic.L.getModelName():y[t.id]={inputEvent:t,fn:n},f&&b(t,n);break;case Lc.n.getModelName():return e.onMicVolumeThreshold(n,t)}},e}Hc.instance=function(){let e=new Xc;return Yc.push(e),e},Hc.pauseAll=function(){Yc.forEach((e=>{zc[e.getID()]=e.isListening(),e.stopListening()}))},Hc.resumeAll=function(){Yc.forEach((e=>{zc[e.getID()]&&e.startListening()}))},Hc.global=Hc.instance();let Qc={},Zc="#asterics-grid-user-documentation",ed="",td=Zc,nd=ed,rd=td;Qc.setHelpLocation=function(e,t){nd=ed,rd=td,ed=e,td=t||""},Qc.setHelpLocationIndex=function(){Qc.setHelpLocation("",Zc)},Qc.revertToLastLocation=function(){Qc.setHelpLocation(nd,rd)},Qc.openHelp=function(){let e="https://www.asterics.eu/manuals/asterics-grid/"+(ed?ed+".html"+td:td);window.open(e,"_blank")},window.onhelp=function(){return!1},window.addEventListener("keydown",(function(e){112!==(e.keyCode||e.which)&&"F1"!==e.key||(e.preventDefault(),Qc.openHelp())}));var id=function(){var e=this,t=e._self._c;return e.tooltipHTML?t("div",{staticStyle:{display:"flex"},attrs:{id:"notificationBar"}},[t("img",{directives:[{name:"show",rawName:"v-show",value:e.tooltipImageUrl,expression:"tooltipImageUrl"}],attrs:{id:"notificationBarImg",src:e.tooltipImageUrl,alt:""}}),e._v(" "),e.tooltipOptions.faIcon?t("i",{class:e.tooltipOptions.faIcon}):e._e(),e._v(" "),t("div",{staticStyle:{"padding-left":"0.5em"}},[t("span",{domProps:{innerHTML:e._s(e.tooltipHTML)}}),e._v(" "),e.tooltipOptions.actionLinkFn||e.tooltipOptions.actionLinkFn2||e.tooltipOptions.actionLinkUrl?t("div",{staticClass:"d-block d-md-flex justify-content-between"},[e.tooltipOptions.actionLinkFn?t("a",{staticClass:"d-block",staticStyle:{color:"#44a8f1"},attrs:{href:"javascript:;"},on:{click:e.onActionLink}},[e._v(e._s(e._f("translate")(e.actionLink)))]):e._e(),e._v(" "),e.tooltipOptions.actionLinkFn2?t("a",{staticClass:"d-block",staticStyle:{color:"#44a8f1"},attrs:{href:"javascript:;"},on:{click:function(t){return e.tooltipOptions.actionLinkFn2()}}},[e._v(e._s(e._f("translate")(e.tooltipOptions.actionLink2)))]):e._e(),e._v(" "),e.tooltipOptions.actionLinkUrl?t("a",{staticClass:"d-block",staticStyle:{color:"#44a8f1"},attrs:{href:e.tooltipOptions.actionLinkUrl,target:"_blank"}},[e._v(e._s(e._f("translate")(e.actionLink)))]):e._e()]):e._e()]),e._v(" "),t("button",{staticStyle:{position:"absolute",top:"0",right:"10px",padding:"0 10px"},attrs:{label:e.$t("close")},on:{click:function(t){e.tooltipHTML=""}}},[e._v("X")])]):e._e()};id._withStripped=!0;let od=null,ad={closeOnNavigate:!0,timeout:0,revertOnClose:!1,actionLink:"",actionLink2:"",actionLinkFn:null,actionLinkFn2:null,imageUrl:null,faIcon:null,msgType:null};const sd={data:()=>({tooltipHTML:null,actionLink:null,tooltipImageUrl:null,lastTooltipOptions:null,lastTooltipHTML:null,tooltipTimeoutHandler:null,tooltipOptions:ad,currentToolTipID:null}),methods:{setTooltip:function(e,t){let n=this;switch(n.tooltipOptions.revertOnClose||(n.lastTooltipHTML=this.tooltipHTML,n.lastTooltipOptions=n.tooltipOptions),n.tooltipOptions=Object.assign(JSON.parse(JSON.stringify(ad)),t),clearTimeout(n.tooltipTimeoutHandler),n.tooltipOptions.timeout>0&&(n.tooltipTimeoutHandler=setTimeout((()=>{n.clearTooltip()}),n.tooltipOptions.timeout)),n.tooltipOptions.msgType){case"warn":n.tooltipOptions.faIcon="fas fa-exclamation-triangle fa-2x";break;case"info":n.tooltipOptions.faIcon="fas fa-info-circle fa-2x";break;case"success":n.tooltipOptions.faIcon="fas fa-check-circle fa-2x"}return this.tooltipHTML=e,this.tooltipImageUrl=n.tooltipOptions.imageUrl,this.actionLink=n.tooltipOptions.actionLink,this.currentToolTipID=(new Date).getTime(),this.currentToolTipID},clearTooltip:function(e){if(e&&e!==this.currentToolTipID)return;let t=this;t.tooltipOptions.revertOnClose&&this.tooltipHTML?t.setTooltip(t.lastTooltipHTML,t.lastTooltipOptions):(this.tooltipHTML=null,this.actionLink=null,this.tooltipImageUrl=null),t.lastTooltipOptions={},t.lastTooltipHTML=null},onActionLink(){this.tooltipOptions.actionLinkFn&&this.tooltipOptions.actionLinkFn()}},mounted(){od=this},beforeDestroy(){}},ld=sd;var cd=s(5072),dd=s.n(cd),ud=s(7825),hd=s.n(ud),pd=s(7659),vd=s.n(pd),md=s(5056),gd=s.n(md),fd=s(540),yd=s.n(fd),_d=s(1113),Ed=s.n(_d),bd=s(2778),Sd={};function Cd(e,t,n,r,i,o,a,s){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):i&&(l=s?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:c}}Sd.styleTagTransform=Ed(),Sd.setAttributes=gd(),Sd.insert=vd().bind(null,"head"),Sd.domAPI=hd(),Sd.insertStyleElement=yd(),dd()(bd.A,Sd),bd.A&&bd.A.locals&&bd.A.locals;const wd=Cd(ld,id,[],!1,null,"77616307",null).exports;var Ad=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:function(t){return t.type.indexOf("key")||27===t.keyCode?e.close():null}}},[e.options.closable?t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.close()}}},[t("i",{staticClass:"fas fa-times"})]):e._e(),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v(e._s(e.options.header))])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"biggerFont"},[e._v(e._s(e.options.text)+" ...")]),e._v(" "),t("div",{staticStyle:{border:"1px solid","border-radius":"3px",width:"100%",height:"50px",margin:"0.5em 0"},attrs:{id:"progressWrapper"}},[t("div",{style:`width: ${e.progressPercentage}%; height: 100%; background-color: green`,attrs:{id:"progressBar"}})]),e._v(" "),t("div",{staticClass:"biggerFont",staticStyle:{"text-align":"right",width:"100%"}},[e._v(e._s(Math.round(e.progressPercentage))+"%")])]),e._v(" "),t("div",{staticClass:"modal-footer"},[e.options.closable?t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"four columns offset-by-eight",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.close()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])])]):e._e()])])])])])};Ad._withStripped=!0;var Td=s(9108),Id={};Id.styleTagTransform=Ed(),Id.setAttributes=gd(),Id.insert=vd().bind(null,"head"),Id.domAPI=hd(),Id.insertStyleElement=yd(),dd()(Td.A,Id),Td.A&&Td.A.locals&&Td.A.locals;let kd={header:"",closable:!1,cancelFn:null,text:""};const Od={props:[],data:function(){return{progressPercentage:0,options:JSON.parse(JSON.stringify(kd))}},methods:{setProgress(e,t){this.progressPercentage=Math.min(e,100),Object.keys(this.options).forEach((e=>{t&&void 0!==t[e]&&(this.options[e]=t[e])})),Math.abs(this.progressPercentage-100)<.001&&setTimeout((()=>{this.options=JSON.parse(JSON.stringify(kd)),this.$emit("close")}),200)},close(){this.options.closable&&(this.$emit("close"),this.options.cancelFn&&this.options.cancelFn(),this.options=JSON.parse(JSON.stringify(kd)))}},mounted(){}},Rd=Od;var xd=s(7582),Nd={};Nd.styleTagTransform=Ed(),Nd.setAttributes=gd(),Nd.insert=vd().bind(null,"head"),Nd.domAPI=hd(),Nd.insertStyleElement=yd(),dd()(xd.A,Nd),xd.A&&xd.A.locals&&xd.A.locals;const Dd=Cd(Rd,Ad,[],!1,null,"739279ab",null).exports;var Ld=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask",staticStyle:{"z-index":"9999"}},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$emit("close")}}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",[e._v(e._s(e.$t("searchElement")))])]),e._v(" "),t("div",{staticClass:"modal-body mt-5 row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"},{name:"focus",rawName:"v-focus"}],staticClass:"col-8 col-sm-10",attrs:{type:"text",placeholder:e.$t("searchElement")+"..."},domProps:{value:e.searchTerm},on:{input:[function(t){t.target.composing||(e.searchTerm=t.target.value)},function(t){return e.search()}],keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.goToFirstResult()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.goToFirstResult(!0):null}]}}),e._v(" "),t("div",{staticClass:"col-sm-2 col-4"},[t("button",{staticClass:"col-12 mb-0",attrs:{title:e.$t("search")}},[t("i",{staticClass:"fas fa-search"})])])]),e._v(" "),t("div",[e.results&&!e.homeGridId?t("div",{staticClass:"warn mt-5"},[t("i",{staticClass:"fas fa-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t("infoPleaseDefineAHomeGridInManageGrids")))])]):e._e(),e._v(" "),e.results&&e.results.length>0?t("ul",{staticClass:"mt-5",staticStyle:{"list-style-type":"none"}},e._l(e.results,(function(n,r){return t("li",{staticClass:"d-flex align-items-center",staticStyle:{"flex-direction":"row","min-height":"40px"}},[t("a",{staticClass:"d-flex align-items-center",attrs:{href:"javascript:;",title:0===r?`${e.$t("showElement")} ${e.$t("keyboardEnter")}`:e.$t("showElement")},on:{click:function(t){return e.toResult(n)}}},[n.elem.image?t("img",{staticStyle:{"margin-right":"1em"},attrs:{src:n.elem.image.data||n.elem.image.url,width:"40"}}):e._e()]),e._v(" "),t("a",{staticClass:"d-flex align-items-center",attrs:{href:"javascript:;",title:0===r?`${e.$t("showPathToElement")} ${e.$t("keyboardCtrlEnter")}`:e.$t("showPathToElement")},on:{click:function(t){return e.toResult(n,!0)}}},[t("div",{staticClass:"d-flex align-items-center"},[t("div",[e._l(n.path,(function(n,r){return t("span",[0===r?t("span",[e._v(e._s(e.$t("homeGrid"))),t("span",{staticClass:"fas fa-arrow-right mx-2"})]):e._e(),e._v(" "),n.toNextElementLabel?t("span",[e._v(e._s(e._f("extractTranslation")(n.toNextElementLabel))),t("span",{staticClass:"fas fa-arrow-right mx-2"})]):e._e()])})),e._v(" "),e.i18nService.getContentLang()===n.matchLang?t("span",{domProps:{innerHTML:e._s(e.highlightSearch(n.matchLabel))}}):e._e(),e._v(" "),e.i18nService.getContentLang()!==n.matchLang?t("span",[t("span",[e._v(e._s(e.i18nService.getTranslation(n.elem.label)))]),e._v(" "),t("span",[e._v("( "+e._s(e.i18nService.t(`lang.${n.matchLang}`))+": "),t("span",{domProps:{innerHTML:e._s(e.highlightSearch(n.matchLabel))}}),e._v(" )")])]):e._e()],2)])])])})),0):e._e(),e._v(" "),t("div",{staticClass:"mt-5"},[null===e.results?t("div",[e._v("\n                            "+e._s(e.$t("searching"))+"\n                        ")]):e._e(),e._v(" "),e.results&&0===e.results.length&&e.searchTerm?t("div",[e._v("\n                            "+e._s(e.$t("noSearchResults"))+"\n                        ")]):e._e(),e._v(" "),e.overflow?t("div",[e._v("\n                            "+e._s(e.$t("notShowingAllResultsTryALongerSearchTerm"))+"\n                        ")]):e._e()])]),e._v(" "),t("div",{staticClass:"modal-footer"})])])])])};Ld._withStripped=!0;var Pd=s(4310);let Md={},Ud={},Fd={},Bd=null,Gd=null,$d=[],Vd={},jd={},Kd=null;function Wd(e){if(!Bd||!e)return null;let t=Gd?Gd.gridElements:[];return Bd.gridElements.filter((t=>t.id===e))[0]||t.filter((t=>t.id===e))[0]}function qd(e,n){n=ee.Z.convertLowerUppercase(n,Kd),(0,t.A)(document).trigger(C.A.EVENT_ELEM_TEXT_CHANGED,[e,n])}async function Hd(){let e=await xg.getMetadata();Kd=e.textConfig.convertMode}Md.setCurrentGrid=function(e){Bd=e},Md.setGlobalGrid=function(e){Gd=e},Md.hasGlobalGridElement=function(e){return!!Gd&&Gd.gridElements.some((t=>t.id===e))},Md.addWordFormTags=function(e,t){$d=Md.mergeTags($d,e,t),Md.applyWordFormsToUI()},Md.mergeTags=function(e,t,n){for(let r of t)n&&e.includes(r)?e=e.filter((e=>e!==r)):e.push(r);return e},Md.resetWordForms=function(){$d=[],jd={},Vd={},Md.applyWordFormsToUI()},Md.resetWordFormTags=function(){$d=[]},Md.resetWordFormIds=function(e){let t=null;var n,r;e&&(n=e,r=Pd.N.getModelName(),n?n.actions.filter((e=>e.modelName===r)):[]).some((e=>e.type===Pd.N.WORDFORM_MODE_NEXT_FORM))&&(t=Vd[e.id]),Vd={},t&&(Vd[e.id]=t)},Md.applyWordFormsToUI=function(){let e=Bd.gridElements;e=Gd?e.concat(Gd.gridElements):e;for(let t of e)t.type===O.V.ELEMENT_TYPE_NORMAL&&qd(t.id,Md.getDisplayText(t.id))},Md.getCurrentWordFormTags=function(){return JSON.parse(JSON.stringify($d))},Md.getWordForm=function(e,t){let n=Md.getWordFormObject(e,t);return n?n.value:null},Md.getWordFormObject=function(e,t){t.wordFormId=void 0===t.wordFormId?Vd[e.id]:t.wordFormId,t.searchTags=t.searchTags?t.searchTags:$d,t.searchTags=JSON.parse(JSON.stringify(t.searchTags)),t.lang=t.lang||o.A.getContentLang();let n=Md.getWordFormsForLang(e,t.lang);if(void 0!==t.wordFormId)return n[t.wordFormId];if(!t.searchTags||0===t.searchTags.length||0===e.wordForms.length)return null;for(;t.searchTags.length>0;){for(let r of n)if(t.searchTags.every((e=>r.tags.includes(e))))return jd[e.id]=t.searchTags,r;if(!t.searchSubTags)return null;t.searchTags.shift()}return null},Md.getWordFormsForLang=function(e,t=""){t=t||o.A.getContentLang();let n=e.wordForms.filter((e=>!e.lang||e.lang===t)),r=e.wordForms.filter((e=>!e.lang||o.A.getBaseLang(e.lang)===o.A.getBaseLang(t)));return n.length>0?n:r},Md.getFirstForm=function(e,t){let n=Md.getFirstFormObject(e,t);return n?n.value:null},Md.getFirstFormObject=function(e,t){let n=Md.getWordFormsForLang(e,t);return n.length>0?n[0]:null},Md.getDisplayText=function(e){let t=Wd(e);return t?Md.getWordForm(t,{searchTags:$d,searchSubTags:!0})||Md.getFirstForm(t)||o.A.getTranslation(t.label):""},Md.getSpeakText=function(e,t){let n=e.id?e:Wd(e);if(!n)return"";(t=t||{}).searchSubTags=!0;let r=Md.getWordFormObject(n,t)||{};if(r.pronunciation||r.value)return r.pronunciation||r.value;let i=Md.getFirstFormObject(n,t.lang)||{};return i.pronunciation||i.value||o.A.getTranslation(n.label,{lang:t.lang})||o.A.getTranslation(n.label)},Md.getSpeakTextAllLangs=function(e){let t={},n=Wd(e);if(!n)return"";let r=n.wordForms.map((e=>e.lang)),i=su.getSecondaryVoiceLang();i&&r.push(i),r=ee.Z.deduplicateArray(r);for(let e of r)t[e]=Md.getSpeakText(n,{lang:e});return t[o.A.getContentLang()]||(t[o.A.getContentLang()]=Md.getSpeakText(n)),t},Md.nextWordForm=function(e){let t=Wd(e);if(!t)return;let n=Md.getWordFormsForLang(t),r=n.map(((e,t)=>t));if(0===n.length)return;let i=this.getWordFormObject(t,{searchTags:$d,searchSubTags:!0}),o=jd[t.id]||[];r=r.filter((e=>o.every((t=>n[e].tags.includes(t)))));let a=n.indexOf(i);a=a>=0?a:null;let s=Vd[t.id]||a||r[0],l=[],c=[];for(let e of r)e!==s&&c.includes(n[e].value)||(c.push(n[e].value),l.push(e));r=l;let d=r.indexOf(s);d=d>=0?d:0;let u=r[d<r.length-1?d+1:0];return qd(t.id,n[u].value),Vd[t.id]=u,s},Md.setState=function(e,t){Ud[e]!==t&&(Ud[e]=t,Fd[e]=Fd[e]||[],Fd[e].forEach((e=>{e(t)})))},Md.getState=function(e){return Ud[e]},Md.onStateChanged=function(e,t){Fd[e]=Fd[e]||[],Fd[e].push(t)},Md.clearListeners=function(e){e?Fd[e]=[]:Fd={}},(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,Hd),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Hd);let Yd={},zd=n.w.getAppSettings().externalSpeechServiceUrl,Jd=!1,Xd=0,Qd=0,Zd=null,eu=!1,tu=!1,nu=!1,ru=new AbortController,iu=ru.signal;async function ou(e,t){let n=null;if((t=t||{}).timeout){let e=new AbortController;t.signal=e.signal,setTimeout((()=>e.abort()),t.timeout)}try{n=await fetch(e,t)}catch(n){t.noLogErrorNames=t.noLogErrorNames||[],t.noLogErrorNames.includes(n.name)||log.warn("failed fetch for external speech:",n.message,e)}return n&&!n.ok?(log.warn("error on fetch for external speech:",n.status,e),null):n}Yd.speak=async function(e,t,n){if(!zd)return;tu=!0,e=encodeURIComponent(e),t=encodeURIComponent(t);let r=encodeURIComponent(n.id);if(n.type===C.A.VOICE_TYPE_EXTERNAL_PLAYING)ou(`${zd}/speak/${e}/${t}/${r}`);else if(n.type===C.A.VOICE_TYPE_EXTERNAL_DATA){ru.abort(),ru=new AbortController,iu=ru.signal;let n=await ou(`${zd}/speakdata/${e}/${t}/${r}`,{signal:iu,noLogErrorNames:["AbortError"]});if(!n||!n.ok)return;let i=await n.blob(),o=new Uint8Array(await i.arrayBuffer());if(0===o.length)return void log.warn("got no data from external speech service.");await Pc.playAudioUint8(o,{onended:()=>{eu=!1}}),eu=!0}},Yd.getVoices=async function(e){if(!(e=e||zd))return[];if((new Date).getTime()-Qd<1e3)return Zd;let t=await ou(`${e}/voices`,{timeout:3e3});return Zd=t?await t.json():[],Qd=(new Date).getTime(),Zd},Yd.stop=function(){zd&&tu&&(ou(`${zd}/stop`),eu&&(Pc.stopAudio(),eu=!1))},Yd.isSpeaking=async function(){if(!zd||!tu)return!1;if(eu)return!0;if((new Date).getTime()-Xd<200)return Jd;let e=await ou(`${zd}/speaking`),t=!!e&&await e.json();return Xd=(new Date).getTime(),Jd=t,t},Yd.cacheAll=async function(e,t,n){if(!zd||nu)return void log.info("not starting caching, because no external provider defined or caching already in progress.");nu=!0,n(0);let r=t.ref.providerId,i=t.id;n=n||(()=>{});let a=[],s=[];for(let t of e)a=a.concat(t.gridElements);let l=0;for(let e of a){let t=o.A.getTranslation(e.label);t&&s.push(t);let n=e.actions.filter((e=>e.modelName===I.m.getModelName()))||[];for(let e of n){let t=o.A.getTranslation(e.speakText);s.push(t)}}for(let e of s){let t=Math.round(l/s.length*100);log.info(`[${t}%] caching tts value: '${e}'`),n(t),e=encodeURIComponent(e),r=encodeURIComponent(r),i=encodeURIComponent(i),await ou(`${zd}/cache/${e}/${r}/${i}`),l++}nu=!1,n(100),log.info("cached all tts values!")},Yd.validateUrl=async function(e){return!!e&&(await Yd.getVoices(e)).length>0},(0,t.A)(document).on(C.A.EVENT_APPSETTINGS_UPDATED,((e,t)=>{zd=t.externalSpeechServiceUrl}));let au,su={},lu=null,cu=null,du=1,uu=1,hu=!1,pu=[],vu=JSON.parse('[{"name":"UK English Female","lang":"en-GB"},{"name":"UK English Male","lang":"en-GB"},{"name":"US English Female","lang":"en-US"},{"name":"US English Male","lang":"en-US"},{"name":"Arabic Male","lang":"ar-SA"},{"name":"Arabic Female","lang":"ar-SA"},{"name":"Armenian Male","lang":"hy-AM"},{"name":"Australian Female","lang":"en-AU"},{"name":"Australian Male","lang":"en-AU"},{"name":"Bangla Bangladesh Female","lang":"bn-BD"},{"name":"Bangla Bangladesh Male","lang":"bn-BD"},{"name":"Bangla India Female","lang":"bn-IN"},{"name":"Bangla India Male","lang":"bn-IN"},{"name":"Brazilian Portuguese Female","lang":"pt-BR"},{"name":"Chinese Female","lang":"zh-CN"},{"name":"Chinese Male","lang":"zh-CN"},{"name":"Chinese (Hong Kong) Female","lang":"zh-HK"},{"name":"Chinese (Hong Kong) Male","lang":"zh-HK"},{"name":"Chinese Taiwan Female","lang":"zh-TW"},{"name":"Chinese Taiwan Male","lang":"zh-TW"},{"name":"Czech Female","lang":"cs-CZ"},{"name":"Danish Female","lang":"da-DK"},{"name":"Deutsch Female","lang":"de-DE"},{"name":"Deutsch Male","lang":"de-DE"},{"name":"Dutch Female","lang":"nl-NL"},{"name":"Dutch Male","lang":"nl-NL"},{"name":"Estonian Male","lang":"et-EE"},{"name":"Filipino Female","lang":"fil-PH"},{"name":"Finnish Female","lang":"fi-FI"},{"name":"French Female","lang":"fr-FR"},{"name":"French Male","lang":"fr-FR"},{"name":"French Canadian Female","lang":"fr-CA"},{"name":"French Canadian Male","lang":"fr-CA"},{"name":"Greek Female","lang":"el-GR"},{"name":"Hindi Female","lang":"hi-IN"},{"name":"Hindi Male","lang":"hi-IN"},{"name":"Hungarian Female","lang":"hu-HU"},{"name":"Indonesian Female","lang":"id-ID"},{"name":"Indonesian Male","lang":"id-ID"},{"name":"Italian Female","lang":"it-IT"},{"name":"Italian Male","lang":"it-IT"},{"name":"Japanese Female","lang":"ja-JP"},{"name":"Japanese Male","lang":"ja-JP"},{"name":"Korean Female","lang":"ko-KR"},{"name":"Korean Male","lang":"ko-KR"},{"name":"Latin Male","lang":"la"},{"name":"Nepali","lang":"ne-NP"},{"name":"Norwegian Female","lang":"nb-NO"},{"name":"Norwegian Male","lang":"nb-NO"},{"name":"Polish Female","lang":"pl-PL"},{"name":"Polish Male","lang":"pl-PL"},{"name":"Portuguese Female","lang":"pt-BR"},{"name":"Portuguese Male","lang":"pt-BR"},{"name":"Romanian Female","lang":"ro-RO"},{"name":"Russian Female","lang":"ru-RU"},{"name":"Sinhala","lang":"si-LK"},{"name":"Slovak Female","lang":"sk-SK"},{"name":"Spanish Female","lang":"es-ES"},{"name":"Spanish Latin American Female","lang":"es-MX"},{"name":"Spanish Latin American Male","lang":"es-MX"},{"name":"Swedish Female","lang":"sv-SE"},{"name":"Swedish Male","lang":"sv-SE"},{"name":"Tamil Female","lang":"hi-IN"},{"name":"Tamil Male","lang":"hi-IN"},{"name":"Thai Female","lang":"th-TH"},{"name":"Thai Male","lang":"th-TH"},{"name":"Turkish Female","lang":"tr-TR"},{"name":"Turkish Male","lang":"tr-TR"},{"name":"Ukrainian Female","lang":"uk-UA"},{"name":"Vietnamese Female","lang":"vi-VN"},{"name":"Vietnamese Male","lang":"vi-VN"},{"name":"Afrikaans Male","lang":"af-ZA"},{"name":"Albanian Male","lang":"sq-AL"},{"name":"Bosnian Male","lang":"bs"},{"name":"Catalan Male","lang":"ca-ES"},{"name":"Croatian Male","lang":"hr-HR"},{"name":"Esperanto Male","lang":"eo"},{"name":"Icelandic Male","lang":"is-IS"},{"name":"Latvian Male","lang":"lv-LV"},{"name":"Macedonian Male","lang":"mk-MK"},{"name":"Moldavian Female","lang":"md"},{"name":"Montenegrin Male","lang":"me"},{"name":"Serbian Male","lang":"sr-RS"},{"name":"Serbo-Croatian Male","lang":"hr-HR"},{"name":"Swahili Male","lang":"sw-KE"},{"name":"Welsh Male","lang":"cy"},{"name":"Fallback UK Female","lang":"en-GB"}]'),mu=[],gu=null,fu=0,yu=["com.apple.speech.synthesis.voice"],_u=["com.apple.eloquence"],Eu=!1,bu=!1,Su=!1,Cu=new Promise((e=>{au=e})),wu={};function Au(e){let t=pu.filter((t=>t.langFull!==t.lang&&t.langFull===e)),n=pu.filter((t=>t.lang===o.A.getBaseLang(e)));return t.length>0?t:n}function Tu(e){let t=pu.filter((t=>t.id===e));return 0===t.length&&(t=pu.filter((t=>t.name===e))),t.length>0?t:null}function Iu(e,t,n,r,i,a){if(n=n||"en",yu.some((t=>e.includes(t))))return;if(-1!==pu.map((e=>e.id)).indexOf(e))return;let s=pu.map((e=>e.name)).indexOf(t);if(-1!==s){t=`${t} (${n})`;let e=pu[s];e.name=`${e.name} (${e.langFull})`}pu.push({id:e,name:t,lang:o.A.getBaseLang(n).toLowerCase(),langFull:n.toLowerCase(),type:r,ref:a,local:i})}async function ku(e){e.forEach((e=>{Iu(e.voiceURI,e.name,e.lang,C.A.VOICE_TYPE_NATIVE,e.localService,e)}))}async function Ou(){su.nativeSpeechSupported()&&(await ku(window.speechSynthesis.getVoices()),window.speechSynthesis.onvoiceschanged=function(){ku(window.speechSynthesis.getVoices())}),Iu(C.A.VOICE_DEVICE_DEFAULT,await o.A.tLoad("defaultDeviceVoice"),o.A.getBrowserLang(),C.A.VOICE_TYPE_NATIVE,!0,void 0),vu.forEach((e=>{Iu(e.name,e.name,e.lang,C.A.VOICE_TYPE_RESPONSIVEVOICE,!1,e)}));let e=await Yd.getVoices();for(let t of e)Iu(t.id,t.name,t.lang,t.type,t.local||!1,t);au()}function Ru(){let e=n.w.getUserSettings().voiceConfig||{};lu=e.preferredVoice||null,du=e.voicePitch||1,uu=e.voiceRate||1,cu=e.secondVoice||null,hu=e.voiceLangIsTextLang||!1}su.speak=function(e,t={}){(t=t||{}).voiceLangIsTextLang=t.voiceLangIsTextLang||hu;let r=n.w.getUserSettings(),i=null,a="string"==typeof e;if(!e||!a&&0===Object.keys(e).length)return;if(0===r.systemVolume||r.systemVolumeMuted)return;su.resetSpeakAfterFinished();let s=t.preferredVoice||lu,l=su.getVoiceLang(s),c=t.voiceLangIsTextLang&&l?l:o.A.getContentLang(),d=t.lang||c;if(a?i=e:(i=o.A.getTranslation(e,{lang:d}),t.voiceLangIsTextLang&&s&&l!==d&&Au(d).length>0&&(s=null)),!i)return;if(i=i.toLowerCase(),i===gu&&(new Date).getTime()-fu<t.minEqualPause)return;gu=i,fu=(new Date).getTime(),t.dontStop||su.stopSpeaking();let u=Tu(s)||Au(d),h=u.filter((e=>e.type===C.A.VOICE_TYPE_NATIVE)),p=u.filter((e=>e.type===C.A.VOICE_TYPE_RESPONSIVEVOICE)),v=u.filter((e=>e.type===C.A.VOICE_TYPE_EXTERNAL_PLAYING||e.type===C.A.VOICE_TYPE_EXTERNAL_DATA));if(su.nativeSpeechSupported()&&h.length>0){var m=new SpeechSynthesisUtterance(i);m.voice=h[0].ref;let e=h[0].id===s;m.pitch=e&&!t.useStandardRatePitch?du:1,m.rate=t.rate||(e&&!t.useStandardRatePitch?uu:1),m.volume=r.systemVolume/100,log.debug("speak volume",r.systemVolume),t.progressFn&&(m.addEventListener("boundary",t.progressFn),m.addEventListener("end",t.progressFn)),window.speechSynthesis.speak(m),m.addEventListener("start",(()=>{Eu=!0,bu=!0})),m.addEventListener("end",(()=>{bu=!1}))}else if(p.length>0){let e=p[0].id===s;responsiveVoice.speak(i,p[0].name,{rate:t.rate||(e&&!t.useStandardRatePitch?uu:1),pitch:e&&!t.useStandardRatePitch?du:1}),Su=!0,Eu=!0}else v.length>0&&Yd.speak(i,v[0].ref.providerId,v[0]);async function g(){await su.isSpeaking()&&Md.setState(C.A.STATE_ACTIVATED_TTS,!0)}g(),setTimeout((()=>{g()}),700),cu&&t.speakSecondary&&su.speakAfterFinished(e,{preferredVoice:cu,useStandardRatePitch:!0,voiceLangIsTextLang:!0})},su.speakAfterFinished=function(e,t){wu.txtOrObject=e,wu.options=t,wu.waiting||(wu.waiting=!0,su.doAfterFinishedSpeaking((()=>{su.speak(wu.txtOrObject,wu.options),wu.waiting=!1,su.resetSpeakAfterFinished()})))},su.resetSpeakAfterFinished=function(){wu.txtOrObject="",wu.options=void 0},su.speakArray=async function(e,t,n){if(await su.isSpeaking()&&su.stopSpeaking(),n=n||0,t=t||(()=>{}),!(e=JSON.parse(JSON.stringify(e)))||0===e.length)return void t(null,!0);t(n),mu=JSON.parse(JSON.stringify(e));let r=mu.shift();r.text?(su.speak(r.text,{dontStop:!0}),await su.waitForFinishedSpeaking()):r.base64Sound&&(await Pc.playAudio(r.base64Sound),await Pc.waitForAudioEnded()),su.speakArray(mu,t,n+1)},su.stopSpeaking=function(){mu=[],bu=!1,Su=!1,su.nativeSpeechSupported()&&window.speechSynthesis.cancel(),responsiveVoice.cancel(),Yd.stop()},su.isSpeaking=async function(){let e=Su&&responsiveVoice.isPlaying();return!(!bu&&!e)||await Yd.isSpeaking()},su.doAfterFinishedSpeaking=async function(e){await su.waitForFinishedSpeaking(),(e=e||(()=>{}))()},su.waitForFinishedSpeaking=async function(){let e=0;for(;!await su.isSpeaking()&&e<1e4;)e+=100,await ee.Z.sleep(100);e=0;let t=new Promise((t=>{let n=setInterval((async()=>{if(e+=50,e>1e4)return t();await su.isSpeaking()||(clearInterval(n),t())}),50)}));await t},su.testSpeak=function(e,t,n){if(!e)return;let r=su.getVoiceLang(e);n=n||r,t=t||o.A.tl("thisIsAnEnglishSentence",null,o.A.getBaseLang(n)),su.speak(t,{preferredVoice:e,useStandardRatePitch:!0})},su.getVoicesLangs=function(){let e=pu.map((e=>e.langFull)).concat(pu.map((e=>e.lang)));return o.A.getAllLanguages().filter((t=>-1!==e.indexOf(t.code)))},su.getVoices=function(){return pu.sort(su.voiceSortFn),pu},su.getVoicesInitialized=async function(){return await Cu,su.getVoices()},su.voiceSortFn=function(e,t){if(e.lang!==t.lang){let n=o.A.te(`lang.${e.lang}`)?o.A.t(`lang.${e.lang}`):e.langFull,r=o.A.te(`lang.${t.lang}`)?o.A.t(`lang.${t.lang}`):t.langFull;return n.localeCompare(r)}if(e.type!==t.type){if(e.type===C.A.VOICE_TYPE_NATIVE)return-1;if(t.type===C.A.VOICE_TYPE_NATIVE)return 1}if(e.local!==t.local){if(e.local)return-1;if(t.local)return 1}let n=_u.some((t=>e.id.toLowerCase().includes(t.toLowerCase()))),r=_u.some((e=>t.id.toLowerCase().includes(e.toLowerCase())));return n&&!r?1:!n&&r?-1:e.id===C.A.VOICE_DEVICE_DEFAULT?1:t.id===C.A.VOICE_DEVICE_DEFAULT?-1:e.name.localeCompare(t.name)},su.nativeSpeechSupported=function(){return!("undefined"==typeof SpeechSynthesisUtterance||!window.speechSynthesis||!window.speechSynthesis.getVoices)},su.getVoiceLang=function(e){let t=Tu(e);return t&&t[0]?t[0].langFull:null},su.getPreferredVoiceLang=function(){return su.getVoiceLang(lu)},su.getSecondaryVoiceLang=function(){return cu?su.getVoiceLang(cu):null},su.isVoiceLangLinkedToTextLang=function(){return hu},su.hasSpoken=function(){return Eu},su.getExternalVoice=function(e){return!!e&&(Tu(e)||[]).filter((e=>e.type===C.A.VOICE_TYPE_EXTERNAL_PLAYING||e.type===C.A.VOICE_TYPE_EXTERNAL_DATA))[0]},su.reinit=async function(){pu=[],await Ou()},Ou(),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Ru),(0,t.A)(document).on(C.A.EVENT_USERSETTINGS_UPDATED,Ru);var xu={},Nu="20px";function Du(e,t){return window.getComputedStyle(e,null).getPropertyValue(t)}xu.getFontSizePx=function(e,t){let n=function(e){return e.attr("data-label")?e.attr("data-label").trim():$(e).find(".text-container span").text().trim()?$(e).find(".text-container span").text().trim():$(e).find(".collect-container").text().trim()?$(e).find(".collect-container").text().trim():""}(e),r=e.attr("data-type"),i=e.attr("data-img-id");if(!n)return"10px";var o=e[0].getBoundingClientRect(),a=o.height*o.width/(i?2:1),s=Math.floor(Math.sqrt(.5*a/Math.max(15,n.length))),l=t?n.length:Math.max.apply(null,n.split(" ").map((e=>e.length))),c=1.4*o.width/l;return c=t?Math.min(c,30):c,(Nu=Math.min(s,c))>o.height/3&&(Nu=.3*o.height),1===n.length&&"ELEMENT_TYPE_NORMAL"===r&&(Nu*=2),Nu+"px"},xu.adaptFontSize=function(e){for(var t=0;t<e.length;t++){let i=!1;var n=e[t],r=$(n).find(".text-container")[0];r&&(r.style.fontSize=xu.getFontSizePx($(n),i));let o=$(n).find(".element-hint"),a=Math.min($(n).width()/10,30);a=a<5?0:a,o.css("fontSize",a+"px")}},xu.adaptFontSizeForGridElements=function(){xu.adaptFontSize($("#grid-container .item"))},xu.getLastFontSize=function(){return Nu+"px"},xu.getTextWidth=function(e,t,n,r={}){r.fontWeight=r.fontWeight||"bold";let i=function(e=document.body,t,n){return`${n||Du(e,"font-weight")||"normal"} ${t=t||Du(e,"font-size")||"16px"} ${Du(e,"font-family")||"Times New Roman"}`}(t=t||document.body,n="number"==typeof n?n+"px":n,r.fontWeight);const o=(xu.getTextWidth.canvas||(xu.getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");return o.font=i,o.measureText(e).width},xu.getFittingFontSize=function(e,t,n={}){if(!t||!e)return 0;n.padding=void 0===n.padding?5:n.padding,n.maxLines=n.maxLines||1,n.containerPct=n.containerPct||100,n.maxSize=n.maxSize||Number.MAX_SAFE_INTEGER,n.lineHeight=n.lineHeight||1;let r,i=14,o=xu.getTextWidth(e,t,i),a=Math.max(o,i),s=n.containerSize||t.getBoundingClientRect(),l=Math.max(0,s.width*(n.containerPct/100)-2*n.padding)*n.maxLines;if(n.maxLines>1){let r=e.split(" "),i=r.map((e=>e.length)),o=Math.max.apply(null,i),a=r.find((e=>e.length===o)),s=JSON.parse(JSON.stringify(n));s.maxLines=1,n.maxSize=Math.min(n.maxSize,xu.getFittingFontSize(a,t,s)),l*=.9}for(r=0;r<5&&Math.abs(a-l)>1;r++)i/=a/l,o=xu.getTextWidth(e,t,i),a=Math.max(o,i);return a>l&&(i-=.5,i=Math.floor(i)),Math.min(n.maxSize,i,s.height*n.containerPct/100/n.lineHeight)},xu.pctToPx=function(e,t){return(t=t||{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}).height*e/100},xu.getHighContrastColor=function(e,t,n){if(!e||!e.startsWith("#"))return"";t=t||"#ffffff",n=n||"#000000";let r=function(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e);return xu.getHighContrastColorRgb(r,t,n)},xu.getHighContrastColorRgb=function(e,t,n){return t=t||[255,255,255],n=n||[0,0,0],e?(void 0===e.r&&e.length&&(e={r:e[0],g:e[1],b:e[2]}),.299*e.r+.587*e.g+.114*e.b>149?n:t):t};var Lu=s(3647);let Pu={},Mu=!1,Uu=null,Fu="player",Bu=n.w.getUserSettings(),Gu=!1,$u=null,Vu=null,ju=null;function Ku(e,t){return void 0!==e?e:Bu.ytState.lastTimes[t]}function Wu(e,t){let n=null;try{n=new URL(e)}catch(e){}return n?n.searchParams.get(t):null}function qu(){if(Uu&&Uu.getPlaylistIndex){let e=Pu.getCurrentVideoId(),t=Uu.getPlaylistIndex();e&&(Bu.ytState.lastTimes[e]=Uu.getCurrentTime()),t>=0&&Bu.ytState.lastPlayType!==Lu.a.playTypes.YT_PLAY_VIDEO&&(Bu.ytState.lastPlaylistIndexes[Bu.ytState.lastData]=t)}JSON.stringify(Bu.ytState).length>1048576&&(Bu.ytState.lastPlaylistIndexes={},Bu.ytState.lastTimes={},Bu.ytState.dataApiCalls={}),n.w.saveUserSettings({ytState:Bu.ytState})}function Hu(){ju=fg.setTooltip(o.A.t("errorPlayingYoutube"),{timeout:3e4,msgType:"warn"})}function Yu(){Bu=n.w.getUserSettings(),Pu.setVolume(null,!0)}Pu.doAction=function(e){if(e.performAfterNav)Pu.setActionAfterNavigate(e);else switch(e.action){case Lu.a.actions.YT_PLAY:Pu.play(e);break;case Lu.a.actions.YT_PAUSE:Pu.pause();break;case Lu.a.actions.YT_TOGGLE:Pu.toggle(e);break;case Lu.a.actions.YT_RESTART:Pu.restart(e);break;case Lu.a.actions.YT_STOP:Pu.stop();break;case Lu.a.actions.YT_STEP_FORWARD:Pu.seekToRelative(e.stepSeconds);break;case Lu.a.actions.YT_STEP_BACKWARD:Pu.seekToRelative(-e.stepSeconds);break;case Lu.a.actions.YT_NEXT_VIDEO:Pu.nextVideo();break;case Lu.a.actions.YT_PREV_VIDEO:Pu.previousVideo();break;case Lu.a.actions.YT_ENTER_FULLSCREEN:Pu.enterFullscreen();break;case Lu.a.actions.YT_VOLUME_UP:Pu.volumeUp(e.stepVolume);break;case Lu.a.actions.YT_VOLUME_DOWN:Pu.volumeDown(e.stepVolume);break;case Lu.a.actions.YT_VOLUME_MUTE:Pu.volumeToggleMute()}},Pu.play=function(e,n){let r=Promise.resolve();fg.clearTooltip(ju),Mu||(r=function(){if(Mu)return Promise.resolve();(0,t.A)(document).on(C.A.EVENT_GRID_RESIZE,(()=>{Uu&&setTimeout((()=>{let e=(0,t.A)(".yt-container")[0].getBoundingClientRect();Uu.setSize(e.width,e.height)}),400)})),window.addEventListener("beforeunload",(e=>{qu()}));let e=document.createElement("script"),n=document.createElement("script");document.body.appendChild(e),document.body.appendChild(n),e.onerror=function(e){log.warn("error on loading YouTube Iframe API script"),Hu()},n.onerror=function(e){log.warn("error on loading YouTube data API script")};let r=new Promise((e=>{window.onYouTubeIframeAPIReady=function(){Mu=!0,e()}})),i=new Promise((e=>{n.addEventListener("load",(function(){e()}))})).then((()=>new Promise((e=>{gapi.load("client",e)})))).then((()=>(gapi.client.setApiKey("AIzaSyCDOUROr3UWS8K-WJNlAG21yBTOsveWQn8"),gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")))).catch((e=>(log.error("Error loading GAPI client for API",e),Promise.resolve())));return e.src="https://www.youtube.com/iframe_api",n.src="https://apis.google.com/js/api.js",Promise.all([i,r])}()),r.then((()=>{function r(){switch(e.playType){case Lu.a.playTypes.YT_PLAY_VIDEO:let o=Pu.getVideoId(e.data);if(!o)return;if(o===Pu.getCurrentVideoId())return void Uu.playVideo();Bu.ytState.lastVideoId=o,Uu.loadVideoById(o,Ku(n,o));break;case Lu.a.playTypes.YT_PLAY_SEARCH:Gu=!0,(t="gapi.client.youtube.search.list",r={maxResults:100,q:e.data,type:"video",videoEmbeddable:!0},new Promise((e=>{i=i||9e5;let n=t.split("."),o=window;if(n.forEach((e=>{o&&(o=o[e])})),o){Bu.ytState.dataApiCalls=Bu.ytState.dataApiCalls||{};let n=t+JSON.stringify(r),a=Bu.ytState.dataApiCalls[n];if(a&&(new Date).getTime()-a.time<i)return e(JSON.parse(a.response));o(r).then((t=>(Bu.ytState.dataApiCalls[n]={time:(new Date).getTime(),response:JSON.stringify(t)},qu(),e(t))),(t=>(log.error("Execute Google API call error",t),e(null))))}}))).then((t=>{let n=t.result.items.map((e=>e.id.videoId)).filter((e=>!!e));Uu.loadPlaylist(n,Bu.ytState.lastPlaylistIndexes[e.data]),setTimeout((()=>{Uu&&(Pu.isPlaying()||Uu.loadPlaylist(n,Bu.ytState.lastPlaylistIndexes[e.data]))}),500)}));break;case Lu.a.playTypes.YT_PLAY_PLAYLIST:let a=Pu.getPlaylistId(e.data);Gu=!0,Uu.loadPlaylist({list:a,listType:"playlist",index:Bu.ytState.lastPlaylistIndexes[e.data]});break;case Lu.a.playTypes.YT_PLAY_CHANNEL:let s=Pu.getChannelId(e.data),l=Pu.getChannelPlaylist(s);Gu=!0,Uu.loadPlaylist({list:l,listType:"playlist",index:Bu.ytState.lastPlaylistIndexes[e.data]});case Lu.a.playTypes.YT_PLAY_RELATED:}var t,r,i;qu()}e.data||(e.playType=Bu.ytState.lastPlayType,e.data=Bu.ytState.lastData),Bu.ytState.lastPlayType=e.playType,Bu.ytState.lastData=e.data,Uu?r():Uu=new YT.Player(Fu,{height:(0,t.A)(".yt-container")[0].getBoundingClientRect().height,width:(0,t.A)(".yt-container")[0].getBoundingClientRect().width,playerVars:{mute:e.playMuted?1:0,cc_load_policy:e.showCC?1:0,cc_lang_pref:o.A.getContentLang(),rel:0,iv_load_policy:3},events:{onReady:function(e){Vu=(0,t.A)("#"+Fu)[0],Pu.setVolume(Bu.ytState.volume,!0),Bu.ytState.muted&&Uu.mute(),r()},onStateChange:e=>{(Gu&&1===e.data||2===e.data)&&(Gu=!1,function(){Uu.setLoop(!0),Bu.ytState.lastVideoId=Pu.getCurrentVideoId();let e=Ku(n,Pu.getCurrentVideoId());e&&Uu.seekTo(e,!0),qu()}())},onError:()=>{log.warn("error on playing YouTube video"),Hu()}}})}))},Pu.pause=function(){Uu&&(Uu.pauseVideo(),qu())},Pu.stop=function(){Uu&&(Uu.seekTo(0),Pu.pause())},Pu.toggle=function(e){Pu.isPaused()?Uu.playVideo():Pu.isPlaying()?Pu.pause():Pu.play(e)},Pu.restart=function(e){Uu&&Uu.seekTo(0),qu(),Pu.isPaused()?Uu.playVideo():Pu.isPlaying()||Pu.play(e,0)},Pu.nextVideo=function(){Uu&&Uu.nextVideo()},Pu.previousVideo=function(){Uu&&Uu.previousVideo()},Pu.seekToRelative=function(e){Uu&&(Uu.seekTo(Uu.getCurrentTime()+e),qu())},Pu.enterFullscreen=function(){if(Uu&&Vu){let e=Vu.requestFullScreen||Vu.mozRequestFullScreen||Vu.webkitRequestFullScreen||Vu.msRequestFullscreen;e&&(e.bind(Vu)(),Hc.global.onAnyKey(Pu.exitFullscreen))}},Pu.exitFullscreen=function(){let e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.bind(document)(),Hc.global.off(Pu.exitFullscreen)},Pu.volumeUp=function(e){Pu.setVolume(Math.min(Bu.ytState.volume+ +e,100))},Pu.volumeDown=function(e){Pu.setVolume(Math.max(Bu.ytState.volume-+e,0))},Pu.setVolume=function(e,t){if(Uu){let t=(e=null!==e?e:Bu.ytState.volume)*(Bu.systemVolume/100);(Bu.systemVolumeMuted||Bu.ytState.muted)&&(t=0),Uu.setVolume(t),!Uu.isMuted&&Bu.ytState.muted||Uu.unMute(),0===t&&Uu.mute(),log.debug("yt volumes (system, yt, result)",Bu.systemVolume,e,t)}t||(fg.setTooltip(o.A.t("youTubeVolume",e),{revertOnClose:!0,timeout:5e3}),Bu.ytState.volume=e,qu())},Pu.volumeToggleMute=function(){let e=Bu.ytState.muted;Bu.ytState.muted=!e,qu(),Uu&&(e?(Pu.setVolume(null,!0),Uu.unMute()):(Pu.setVolume(0,!0),Uu.mute()))},Pu.setActionAfterNavigate=function(e){e.performAfterNav=!1,$u=e},Pu.isPlaying=function(){return Uu&&1===Uu.getPlayerState()},Pu.isPaused=function(){return Uu&&2===Uu.getPlayerState()},Pu.getCurrentVideoId=function(){if(Uu&&Uu.getVideoUrl){let e=Uu.getVideoUrl();if(e&&-1!==e.indexOf("v="))return Pu.getVideoId(Uu.getVideoUrl())}return""},Pu.getVideoId=function(e){if(!e)return null;let t=Wu(e,"v"),n="youtu.be/";if(t)return t;if(-1!==e.indexOf(n)){let t=e.indexOf(n)+9,r=-1!==e.indexOf("?")?e.indexOf("?"):void 0;return e.substring(t,r)}return e},Pu.getPlaylistId=function(e){if(!e)return null;return Wu(e,"list")||e},Pu.getChannelId=function(e){if(!e)return null;let t=["channel/"];for(let n=0;n<t.length;n++)if(-1!==e.indexOf(t[n])){let r=e.indexOf(t[n])+t[n].length,i=e.substring(r);if(i=-1===i.indexOf("/")?i:i.substring(0,i.indexOf("/")),i)return i}return e},Pu.getChannelPlaylist=function(e){return 0===e.indexOf("UC")&&(e=e.replace("UC","UU")),e},Pu.destroy=function(){Uu&&(qu(),Uu.destroy()),Uu=null},(0,t.A)(document).on(C.A.EVENT_GRID_LOADED,(()=>{$u&&(Pu.doAction($u),$u=null)})),(0,t.A)(document).on(C.A.EVENT_NAVIGATE,Pu.destroy),(0,t.A)(document).on(C.A.EVENT_NAVIGATE_GRID_IN_VIEWMODE,Pu.destroy),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Yu),(0,t.A)(document).on(C.A.EVENT_USERSETTINGS_UPDATED,Yu);var zu=s(1612);let Ju={},Xu=1,Qu=null,Zu=null,eh=!1,th=null,nh=null,rh=["es"],ih="https://api.arasaac.org";Ju.SEARCH_PROVIDER_NAME="ARASAAC";let oh={name:Ju.SEARCH_PROVIDER_NAME,url:"https://arasaac.org/",searchLangs:["an","ar","bg","br","ca","de","el","en","es","et","eu","fa","fr","gl","he","hr","hu","it","ko","lt","lv","mk","nl","pl","pt","ro","ru","sk","sq","sv","sr","val","uk","zh"],options:[{name:"plural",type:C.A.OPTION_TYPES.BOOLEAN,value:!1},{name:"color",type:C.A.OPTION_TYPES.BOOLEAN,value:!0},{name:"action",type:C.A.OPTION_TYPES.SELECT,value:void 0,options:["past","future"]},{name:"skin",type:C.A.OPTION_TYPES.SELECT_COLORS,value:void 0,options:["white","black","assian","mulatto","aztec"],colors:["#F5E5DE","#A65C17","#F4ECAD","#E3AB72","#CF9D7C"]},{name:"hair",type:C.A.OPTION_TYPES.SELECT_COLORS,value:void 0,options:["blonde","brown","darkBrown","gray","darkGray","red","black"],colors:["#FDD700","#A65E26","#6A2703","#EFEFEF","#AAABAB","#ED4120","#020100"]},{name:"identifier",type:C.A.OPTION_TYPES.SELECT,value:void 0,options:["classroom","health","library","office"]},{name:"identifierPosition",type:C.A.OPTION_TYPES.SELECT,value:void 0,options:["left","right"]}]};function ah(e,t){let n="";return t.forEach((e=>{void 0!==e.value&&(n+=`&${e.name}=${encodeURIComponent(e.value)}`)})),`${ih}/api/pictograms/${e}?download=false${n}`}function sh(e,t,n,r){r=r||20,n=n||1;let i=[];return new Promise((async(a,s)=>{if(!e)return a([]);if(Qu!==e||nh!==t){t=t||o.A.getContentLangBase(),nh=t;try{Zu=await async function(e,t){e=e||[o.A.getContentLangBase()],e=[...new Set(e)];let n=[];for(let r of e){try{n=await lh(r,t)}catch(e){return Promise.reject(e)}if(n.length>0)return n}return n}([t,o.A.getContentLangBase(),o.A.getBrowserLang(),"en","es"],e)}catch(e){s(e)}}Zu&&Zu.length&&0!==Zu.length||(Zu=[]);let l=n*r-r,c=l+r-1;eh=Zu.length>c+1;for(let e=l;e<=c;e++)if(Zu[e]){let t={},n=JSON.parse(JSON.stringify(Zu[e]));t.url=ah(n._id,th),t.author=C.A.ARASAAC_AUTHOR,t.authorURL=C.A.ARASAAC_LICENSE_URL,t.searchProviderName=Ju.SEARCH_PROVIDER_NAME,t.searchProviderOptions=JSON.parse(JSON.stringify(th)),i.push(t)}Qu=e,a(i)}))}function lh(e,n){let r=`${ih}/api/pictograms/${e}/search/${n}`;return new Promise(((e,n)=>{t.A.get(r,null,(function(t){e(t)}),"json").fail((t=>{if(404===t.status)return e([]);n("no internet")}))}))}Ju.getSearchProviderInfo=function(){let e=JSON.parse(JSON.stringify(oh));return e.service=Ju,e},Ju.getGridImageById=function(e){return e?new ce.q({url:`${ih}/api/pictograms/${e}?download=false&plural=false&color=true`,author:C.A.ARASAAC_AUTHOR,authorURL:C.A.ARASAAC_LICENSE_URL,searchProviderName:Ju.SEARCH_PROVIDER_NAME}):null},Ju.query=function(e,t,n){return th=t,Xu=1,eh=!1,sh(e,n,1,20)},Ju.nextChunk=function(){return Xu++,sh(Qu,nh,Xu,20)},Ju.hasNextChunk=function(){return eh},Ju.getUpdatedUrl=function(e,t){return ah(e.substring(e.lastIndexOf("/")+1,e.indexOf("?")),t)},Ju.getCorrectGrammar=async function(e){if(!e||!rh.includes(o.A.getContentLangBase()))return e;e=e.trim();let t=o.A.getContentLangBase(),n=`${ih}/api/phrases/flex/${t}/${e}`,r=await ee.Z.fetchWithTimeout(n,1500).catch((e=>console.error(e)));if(!r||200!==r.status)return e;let i=await r.json();return i?i.msg+"":e},Ju.getSupportedGrammarLangs=function(e){let t=rh;return e&&(t=t.map((e=>o.A.getTranslation(`lang.${e}`)))),JSON.parse(JSON.stringify(t))};class ch extends(O.V.extend({mode:[String],updateSeconds:[Number],liveAction:[Object],dateTimeFormat:[String],appState:[String],extractMode:[String],extractSelector:[String,Number,void 0],extractIndex:[String,Number,void 0],extractMappings:[Object],chooseValues:[String]})){constructor(e){e=e||{};let t=JSON.parse(JSON.stringify(ch.DEFAULTS));super(Object.assign(t,e))}}ch.MODE_ACTION_RESULT="MODE_ACTION_RESULT",ch.MODE_DATETIME="MODE_DATETIME",ch.MODE_APP_STATE="MODE_APP_STATE",ch.MODE_RANDOM="MODE_RANDOM",ch.MODES=[ch.MODE_DATETIME,ch.MODE_APP_STATE,ch.MODE_ACTION_RESULT,ch.MODE_RANDOM],ch.DT_FORMAT_DATE="DT_FORMAT_DATE",ch.DT_FORMAT_DATE_LONG="DT_FORMAT_DATE_LONG",ch.DT_FORMAT_TIME="DT_FORMAT_TIME",ch.DT_FORMAT_TIME_LONG="DT_FORMAT_TIME_LONG",ch.DT_FORMAT_DATETIME="DT_FORMAT_DATETIME",ch.DT_FORMAT_WEEKDAY="DT_FORMAT_WEEKDAY",ch.DT_FORMAT_MONTH="DT_FORMAT_MONTH",ch.DT_FORMATS=[ch.DT_FORMAT_DATE,ch.DT_FORMAT_DATE_LONG,ch.DT_FORMAT_TIME,ch.DT_FORMAT_TIME_LONG,ch.DT_FORMAT_DATETIME,ch.DT_FORMAT_WEEKDAY,ch.DT_FORMAT_MONTH],ch.APP_STATE_VOLUME_GLOBAL="APP_STATE_VOLUME_GLOBAL",ch.APP_STATE_VOLUME_YT="APP_STATE_VOLUME_YT",ch.APP_STATE_VOLUME_RADIO="APP_STATE_VOLUME_RADIO",ch.APP_STATE_BATTERY_LEVEL="APP_STATE_BATTERY_LEVEL",ch.APP_STATES=[ch.APP_STATE_VOLUME_GLOBAL,ch.APP_STATE_VOLUME_RADIO,ch.APP_STATE_VOLUME_YT,ch.APP_STATE_BATTERY_LEVEL],ch.EXTRACT_JSON="EXTRACT_JSON",ch.EXTRACT_HTML_SELECTOR="EXTRACT_HTML_SELECTOR",ch.EXTRACT_MODES=[ch.EXTRACT_JSON,ch.EXTRACT_HTML_SELECTOR],ch.DEFAULTS={extractMode:ch.EXTRACT_JSON};let dh={fetchItems:async function(e){return fetch(e+"?recursive=false").then((e=>{if(!e.ok)throw new Error("Failed to fetch items from openHAB");return e.json()}))},sendAction:async function(e){let t;t="CUSTOM_VALUE"===e.actionType||"CUSTOM_COLOR"===e.actionType?"CUSTOM_COLOR"===e.actionType?function(e){let t=ee.Z.getRGB(e.actionValue),n=t[0]/255,r=t[1]/255,i=t[2]/255;const o=Math.max(n,Math.max(r,i)),a=Math.min(n,Math.min(r,i)),s=o-a;let l=-1,c=-1;return o===a?l=0:o===n?l=((r-i)/s*60+360)%360:o===r?l=((i-n)/s*60+120)%360:o===i&&(l=((n-r)/s*60+240)%360),c=0===o?0:s/o*100,l+","+c+","+100*o}(e):e.actionValue:e.actionType,await fetch(e.openHABUrl+e.itemName,{method:"POST",headers:{"Content-Type":"text/plain"},body:t}).catch((e=>console.error(e)))},getRestURL:function(e){e||(e=window.location.hostname.indexOf("grid.asterics.eu")>-1?"http://127.0.0.1:8080":"http://"+window.location.hostname+":8080"),-1===e.indexOf("http")&&(e="http://"+e);let t=document.createElement("a");return t.href=e,t.pathname="/rest/items/",t.port||(t.port=8080),t.href}};var uh=s(1288);let hh={},ph={},vh={};hh.doAction=async function(e){(e=JSON.parse(JSON.stringify(e))).id="";let t=JSON.stringify(e);return ph[t]&&(new Date).getTime()-vh[t]<500||(ph[t]=async function(e){try{log.debug(`url: ${e.restUrl}, body: ${e.body}, method: ${e.method}, contenttype: ${e.contentType}`);let t={method:e.method||uh.h.defaults.method,headers:{}};if(e.acceptHeader&&(t.headers.Accept=e.acceptHeader),e.contentType&&(t.headers["Content-Type"]=e.contentType),["GET","HEAD"].includes(t.method)||(t.body=e.body),e.authUser||e.authPw){let n=ee.Z.stringToBase64(`${e.authUser}:${e.authPw}`);t.headers.Authorization=`Basic ${n}`}t.mode=e.noCorsMode?"no-cors":void 0;let n=new URL(e.restUrl);e.useCorsProxy&&(n=new URL("https://proxy.asterics-foundation.org/proxy_nofilter.php"),n.searchParams.append("csurl",e.restUrl));const r=await fetch(n,t);if(r.ok||e.noCorsMode)return log.debug(`REST call ok, url: ${e.restUrl}, body ${e.body}`),e.noCorsMode?"":await r.text();fg.setTooltip(o.A.t("restActionFailed",`${r.statusText} (${r.status})`),{revertOnClose:!0,timeout:5e3})}catch(e){log.error(e),fg.setTooltip(o.A.t("restActionFailed",e),{revertOnClose:!0,timeout:5e3})}return""}(e),vh[t]=(new Date).getTime()),ph[t]};var mh=s(2681);let gh="WEBRADIO_LAST_PLAYED_ID_KEY",fh="https://de1.api.radio-browser.info/json/",yh=.15,_h=["name","country","state","language","tag","tagList","order"],Eh={},bh=document.getElementById("audioPlayer"),Sh=document.getElementById("videoPlayer"),Ch=n.w.get(gh),wh=parseFloat(n.w.get(C.A.WEBRADIO_LAST_VOLUME_KEY)||1),Ah=!1,Th=!1,Ih=n.w.getUserSettings();function kh(){fg.setTooltip(o.A.t("webradioVolume",Math.round(100*wh)),{revertOnClose:!0,timeout:5e3})}function Oh(e,n){return new Promise(((r,i)=>{if(e.radioUrl)return r(e);t.A.ajax({type:"GET",url:fh+"url/"+e.radioId,dataType:"json"}),t.A.ajax({type:"GET",url:fh+"stations/byuuid/"+e.radioId,dataType:"json"}).then((t=>{let i=t[0];e.radioUrl=i.url_resolved||i.url,e.radioUrl.lastIndexOf("/")===e.radioUrl.length-1&&(e.radioUrl=e.radioUrl+";");let o=e.radioUrl.lastIndexOf(":");if(o>-1){let t=e.radioUrl.substring(o+1);parseInt(t)+""===t&&(e.radioUrl=e.radioUrl+"/;")}n&&xg.getGrid(n).then((t=>{let n=(t.webRadios||[]).filter((t=>e.radioId===t.radioId))[0];n&&(n.radioUrl=e.radioUrl,xg.saveGrid(t))})),r(e)}))}))}function Rh(){Ih=n.w.getUserSettings(),Eh.setVolume()}Eh.doAction=function(e,t){switch(t.action){case mh.o.WEBRADIO_ACTION_VOLUP:return void Eh.volumeUp();case mh.o.WEBRADIO_ACTION_VOLDOWN:return void Eh.volumeDown()}xg.getGrid(e).then((n=>{let r=n.webRadios||[],i=t.radioId||Ch,o=r.filter((e=>i===e.radioId))[0]||r[0],a=0;if(o)switch(t.action){case mh.o.WEBRADIO_ACTION_START:Oh(o,e).then((e=>{Eh.play(e)}));break;case mh.o.WEBRADIO_ACTION_TOGGLE:Oh(o,e).then((e=>{Eh.toggle(e)}));break;case mh.o.WEBRADIO_ACTION_STOP:Eh.stop();break;case mh.o.WEBRADIO_ACTION_NEXT:if(a=r.map((e=>e.radioId)).indexOf(o.radioId),a<0||r.length<2)return;a=a+1<r.length?a+1:0,Oh(r[a],e).then((e=>{Eh.play(e)}));break;case mh.o.WEBRADIO_ACTION_PREV:if(a=r.map((e=>e.radioId)).indexOf(o.radioId),a<0||r.length<2)return;a=a-1>=0?a-1:r.length-1,Oh(r[a],e).then((e=>{Eh.play(e)}))}else log.info("no radio station to play found.")}))},Eh.play=function(e){e&&(bh.paused||Ch!==e.radioId)&&(bh.paused&&Sh.paused||Eh.stop(),Ch=e.radioId||Ch,n.w.save(gh,Ch),Oh(e).then((t=>{log.debug("playing: "+t.radioUrl);let n=Promise.resolve();-1!==e.radioUrl.indexOf(".m3u8")?(Th=!0,Sh.src=t.radioUrl,s.e(133).then(s.t.bind(s,9473,23)).then((e=>{if((e=e.default).isSupported()){let n=new e;n.loadSource(t.radioUrl),n.attachMedia(Sh),n.on(e.Events.MANIFEST_PARSED,(function(){Sh.play()}))}}))):(Th=!1,bh.src=t.radioUrl,Eh.setVolume(),n=bh.play());let r=o.A.t("playingWebradio",t.radioName);fg.setTooltip(r,{closeOnNavigate:!1,actionLink:o.A.t("stop"),actionLinkFn:Eh.stop,imageUrl:t.faviconUrl}),n&&n.then&&n.catch((t=>{(t+"").includes("NotAllowedError")?fg.setTooltip(o.A.t("couldntPlayWebradioBecauseTheBrowserDidntAllow"),{msgType:"warn",actionLink:o.A.t("allowPlayingRadio"),actionLinkFn:()=>{Eh.play(e)}}):Ch===e.radioId&&function(e){fg.setTooltip(o.A.t("errorPlayingWebradio",e.radioName),{msgType:"warn"})}(e)}))})))},Eh.stop=function(e){e&&e!==Ch||(bh.pause(),Sh.pause(),fg.clearTooltip())},Eh.toggle=function(e){!Th&&bh.paused||Th&&Sh.paused?Eh.play(e):Eh.stop()},Eh.volumeUp=function(){wh=wh+yh<=1?wh+yh:1,Eh.setVolume(wh),kh()},Eh.volumeDown=function(){wh=wh-yh>=0?wh-yh:0,Eh.setVolume(wh),kh()},Eh.setVolume=function(e){wh=void 0!==e?e:wh,wh=Math.round(100*wh)/100,n.w.save(C.A.WEBRADIO_LAST_VOLUME_KEY,wh);let t=wh*(Ih.systemVolume/100);Ih.systemVolumeMuted&&(t=0),bh.volume=t,Sh.volume=t,log.debug("radio volumes (system, radio, result)",Ih.systemVolume,100*wh,100*t)},Eh.search=function(e,n,r){if(!e)return Promise.resolve([]);let i={},o=[];_h.forEach((t=>{let n=e.indexOf(t+":");n>-1&&o.push({param:t,position:n})})),o.sort(((e,t)=>e.position-t.position)),o.forEach(((t,n,r)=>{let o=r[n+1],a=o?o.position-1:void 0,s=e.substring(t.position+t.param.length+1,a);s=s.replace(/(^")|("$)/g,""),i[t.param]=s})),0===Object.keys(i).length&&(i.name=e);let a=n||20;return a++,i.limit=a,r&&(i.offset=r),new Promise(((e,n)=>{t.A.ajax({type:"POST",url:fh+"stations/search",data:i,dataType:"json",contentType:"application/x-www-form-urlencoded"}).then((t=>{Ah=t.length===a;let n=t.filter((e=>"0"!==e.lastcheckok));n=n.slice(0,a-1),e(n.map((e=>({radioId:e.stationuuid,radioUUID:e.stationuuid,radioName:e.name,faviconUrl:e.favicon}))))}),(e=>{n(e)}))}))},Eh.hasMoreSearchResults=function(){return Ah},(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Rh),(0,t.A)(document).on(C.A.EVENT_USERSETTINGS_UPDATED,Rh);var xh=s(1140),Nh=s(5628);let Dh={},Lh=null,Ph=null;function Mh(e){fg.setTooltip(o.A.t(e),{revertOnClose:!0,timeout:5e3,msgType:"warn"})}function Uh(){Ph&&Ph.close(),Ph=null,Mh("uartConnectionClosed")}function Fh(){Lh&&Lh.close(),Lh=null,Mh("uartConnectionClosed")}async function Bh(e){return new Promise((t=>{e((e=>{e?t(e):Mh("uartActionFailedConnection")}))}))}Dh.doAction=function(e){s.e(819).then(s.t.bind(s,4819,23)).then((async t=>{let n=`${e.data}`;switch(n=n.replaceAll("\\n","\n"),n=n.replaceAll("\\r","\r"),n.endsWith("\n")||(n+="\n"),e.connectionType){case Nh.D.CONN_TYPE_BT:Lh=Lh||await Bh(t.connectBluetooth),Lh.on("data",(e=>console.log("received BT data:",e))),Lh.on("close",Fh),Lh.write(n);break;case Nh.D.CONN_TYPE_SERIAL:Ph=Ph||await Bh(t.connectSerial),Ph.on("data",(e=>console.log("received serial data:",e))),Ph.on("close",Uh),Ph.write(n)}}))};var Gh=s(7989);let $h={};function Vh(e){fg.setTooltip(o.A.t("systemVolume",e),{revertOnClose:!0,timeout:5e3})}$h.doAction=async function(e){let t=n.w.getUserSettings();switch(e.action){case Gh.u.actions.SYS_VOLUME_UP:t.systemVolume=Math.min(t.systemVolume+e.actionValue,100),Vh(t.systemVolume),n.w.saveUserSettings(t);break;case Gh.u.actions.SYS_VOLUME_DOWN:t.systemVolume=Math.max(t.systemVolume-e.actionValue,0),Vh(t.systemVolume),n.w.saveUserSettings(t);break;case Gh.u.actions.SYS_VOLUME_TOGGLE_MUTE:t.systemVolumeMuted=!t.systemVolumeMuted,Vh(t.systemVolumeMuted?0:t.systemVolume),n.w.saveUserSettings(t),t.systemVolumeMuted&&su.stopSpeaking();break;case Gh.u.actions.SYS_ENTER_FULLSCREEN:await $h.enterFullscreen();break;case Gh.u.actions.SYS_LEAVE_FULLSCREEN:await $h.exitFullscreen();break;case Gh.u.actions.SYS_UPDATE_LIVE_ELEMENTS:let r=e.actionValue||0;setTimeout((()=>{Tm.updateOnce({forceUpdate:!0})}),r)}},$h.enterFullscreen=async function(e){ee.Z.openFullscreen();let n=await xg.getMetadata();n.fullscreen=!0,e||await xg.saveMetadata(n),(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_CLOSE)},$h.exitFullscreen=async function(){if(!xg.getCurrentUser())return;ee.Z.closeFullscreen();let e=await xg.getMetadata();e.fullscreen&&(e.fullscreen=!1,await xg.saveMetadata(e)),setTimeout((()=>{(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE)}),200)};var jh=s(3921),Kh=s(7083),Wh=s(467),qh=s(4980),Hh=s(6122),Yh=s(3883),zh=s(6560);function Jh(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}class Xh{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,qh.A)(this,"rooms",{}),(0,qh.A)(this,"users",{}),(0,qh.A)(this,"syncToken",null),(0,qh.A)(this,"filters",new Yh.kG((()=>new Map))),(0,qh.A)(this,"accountData",new Map),(0,qh.A)(this,"localStorage",void 0),(0,qh.A)(this,"oobMembers",new Map),(0,qh.A)(this,"pendingEvents",{}),(0,qh.A)(this,"clientOptions",void 0),(0,qh.A)(this,"pendingToDeviceBatches",[]),(0,qh.A)(this,"nextToDeviceBatchId",0),(0,qh.A)(this,"createUser",void 0),(0,qh.A)(this,"onRoomMember",((e,t,n)=>{var r;if(n.membership!==zh.O.Invite){var i=this.users[n.userId]||(null===(r=this.createUser)||void 0===r?void 0:r.call(this,n.userId));n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[i.userId]=i}})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(Hh.f.Members,this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(Hh.f.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,n,r){}storeFilter(e){null!=e&&e.userId&&null!=e&&e.filterId&&this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,t){var n;return(null===(n=this.filters.get(e))||void 0===n?void 0:n.get(t))||null}getFilterIdByName(e){if(!this.localStorage)return null;var t="mxjssdk_memory_filter_"+e;try{var n=this.localStorage.getItem(t);if(Jh(n))return n}catch(e){}return null}setFilterIdByName(e,t){if(this.localStorage){var n="mxjssdk_memory_filter_"+e;try{Jh(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch(e){}}}storeAccountDataEvents(e){e.forEach((e=>{Object.keys(e.getContent()).length?this.accountData.set(e.getType(),e):this.accountData.delete(e.getType())}))}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new Yh.kG((()=>new Map)),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,t){return this.oobMembers.set(e,t),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var t=this;return(0,Wh.A)((function*(){var n;return null!==(n=t.pendingEvents[e])&&void 0!==n?n:[]}))()}setPendingEvents(e,t){var n=this;return(0,Wh.A)((function*(){n.pendingEvents[e]=t}))()}saveToDeviceBatches(e){for(var t of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:t.eventType,txnId:t.txnId,batch:t.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return(0,Wh.A)((function*(){return 0===e.pendingToDeviceBatches.length?null:e.pendingToDeviceBatches[0]}))()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter((t=>t.id!==e)),Promise.resolve()}destroy(){return(0,Wh.A)((function*(){}))()}}var Qh=s(15),Zh=s(4792),ep=s(2238),tp=s(9561),np=s(2986),rp=s(3840),ip=s(6459),op=s(4787),ap=s(3719),sp=s(8230);function lp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lp(Object(n),!0).forEach((function(t){(0,qh.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dp(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return dp=function(e){this.s=e,this.n=e.next},dp.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new dp(e)}var up=function(e){return e.PendingEventsChanged="PendingEvent.pendingEventsChanged",e}({});class hp extends Zh.pB{constructor(e,t,n,r,i){var o,a,s,l,c,d,u,h,p,v,m,g,f;super(r),o=this,this.widgetApi=e,this.capabilities=t,this.roomId=n,(0,qh.A)(this,"room",void 0),(0,qh.A)(this,"widgetApiReady",void 0),(0,qh.A)(this,"lifecycle",void 0),(0,qh.A)(this,"syncState",null),(0,qh.A)(this,"pendingSendingEventsTxId",[]),(0,qh.A)(this,"eventEmitter",new xp.X),(0,qh.A)(this,"updateTxId",function(){var e=(0,Wh.A)((function*(e){if(e.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some((t=>e.getType()===t.type))){for(var t,n=null===(t=o.pendingSendingEventsTxId.find((t=>t.id===e.getId())))||void 0===t?void 0:t.txId;!n&&o.pendingSendingEventsTxId.length>0;){var r;yield new Promise((e=>o.eventEmitter.once(up.PendingEventsChanged,(()=>e())))),n=null===(r=o.pendingSendingEventsTxId.find((t=>t.id===e.getId())))||void 0===r?void 0:r.txId}n&&(e.setTxnId(n),e.setUnsigned(cp(cp({},e.getUnsigned()),{},{transaction_id:n}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter((t=>t.id!==e.getId())),0===o.pendingSendingEventsTxId.length&&o.eventEmitter.emit(up.PendingEventsChanged)}}));return function(t){return e.apply(this,arguments)}}()),(0,qh.A)(this,"onEvent",function(){var e=(0,Wh.A)((function*(e){if(e.preventDefault(),e.detail.data.room_id===o.roomId){var t=new tp.kl(e.detail.data);yield o.updateTxId(t),o.syncApi instanceof ip.w_?yield o.syncApi.injectRoomEvents(o.room,[],void 0,[t]):yield o.syncApi.injectRoomEvents(o.room,[],[t]),o.emit(Zh.AU.Event,t),o.setSyncState(ip.Lm.Syncing),rp.v.info("Received event ".concat(t.getId()," ").concat(t.getType()," ").concat(t.getStateKey()))}else{var{event_id:n,room_id:r}=e.detail.data;rp.v.info("Received event ".concat(n," for a different room ").concat(r,"; discarding"))}yield o.ack(e)}));return function(t){return e.apply(this,arguments)}}()),(0,qh.A)(this,"onToDevice",function(){var e=(0,Wh.A)((function*(e){e.preventDefault();var t=new tp.kl({type:e.detail.data.type,sender:e.detail.data.sender,content:e.detail.data.content});e.detail.data.encrypted&&t.makeEncrypted(np.Bx.RoomMessageEncrypted,{},"",""),o.emit(Zh.AU.ToDeviceEvent,t),o.setSyncState(ip.Lm.Syncing),yield o.ack(e)}));return function(t){return e.apply(this,arguments)}}());var y=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=function(){var e=(0,Wh.A)((function*(e,t){try{return yield y(e,t)}catch(e){pp(e)}}));return function(t,n){return e.apply(this,arguments)}}();var _=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=function(){var e=(0,Wh.A)((function*(e,t){try{return yield _(e,t)}catch(e){pp(e)}}));return function(t,n){return e.apply(this,arguments)}}(),this.widgetApiReady=new Promise((e=>this.widgetApi.once("ready",e))),(null!==(a=t.sendEvent)&&void 0!==a&&a.length||null!==(s=t.receiveEvent)&&void 0!==s&&s.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||!0===t.receiveMessage||Array.isArray(t.receiveMessage)&&t.receiveMessage.length||null!==(l=t.sendState)&&void 0!==l&&l.length||null!==(c=t.receiveState)&&void 0!==c&&c.length)&&e.requestCapabilityForRoomTimeline(n),null===(d=t.sendEvent)||void 0===d||d.forEach((t=>e.requestCapabilityToSendEvent(t))),null===(u=t.receiveEvent)||void 0===u||u.forEach((t=>e.requestCapabilityToReceiveEvent(t))),!0===t.sendMessage?e.requestCapabilityToSendMessage():Array.isArray(t.sendMessage)&&t.sendMessage.forEach((t=>e.requestCapabilityToSendMessage(t))),!0===t.receiveMessage?e.requestCapabilityToReceiveMessage():Array.isArray(t.receiveMessage)&&t.receiveMessage.forEach((t=>e.requestCapabilityToReceiveMessage(t))),null===(h=t.sendState)||void 0===h||h.forEach((t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToSendState(n,r)})),null===(p=t.receiveState)||void 0===p||p.forEach((t=>{var{eventType:n,stateKey:r}=t;return e.requestCapabilityToReceiveState(n,r)})),null===(v=t.sendToDevice)||void 0===v||v.forEach((t=>e.requestCapabilityToSendToDevice(t))),null===(m=t.receiveToDevice)||void 0===m||m.forEach((t=>e.requestCapabilityToReceiveToDevice(t))),t.sendDelayedEvents&&(null!==(g=t.sendEvent)&&void 0!==g&&g.length||!0===t.sendMessage||Array.isArray(t.sendMessage)&&t.sendMessage.length||null!==(f=t.sendState)&&void 0!==f&&f.length)&&e.requestCapability(ep.MatrixCapabilities.MSC4157SendDelayedEvent),t.updateDelayedEvents&&e.requestCapability(ep.MatrixCapabilities.MSC4157UpdateDelayedEvent),t.turnServers&&e.requestCapability(ep.MatrixCapabilities.MSC3846TurnServers),e.on("action:".concat(ep.WidgetApiToWidgetAction.SendEvent),this.onEvent),e.on("action:".concat(ep.WidgetApiToWidgetAction.SendToDevice),this.onToDevice),e.start(),i&&e.sendContentLoaded()}startClient(){var e=arguments,t=this;return(0,Wh.A)((function*(){var n,r,i=e.length>0&&void 0!==e[0]?e[0]:{};t.lifecycle=new AbortController;var o=t.getUserId();o&&t.store.storeUser(new sp.K(o)),i.slidingSync?t.syncApi=new op.m(i.slidingSync,t,i,t.buildSyncApiOptions()):t.syncApi=new ip.w_(t,i,t.buildSyncApiOptions()),t.room=t.syncApi.createRoom(t.roomId),t.store.storeRoom(t.room),yield t.widgetApiReady,yield Promise.all(null!==(n=null===(r=t.capabilities.receiveState)||void 0===r?void 0:r.map(function(){var e=(0,Wh.A)((function*(e){var{eventType:n,stateKey:r}=e,i=(yield t.widgetApi.readStateEvents(n,void 0,r,[t.roomId])).map((e=>new tp.kl(e)));t.syncApi instanceof ip.w_?yield t.syncApi.injectRoomEvents(t.room,void 0,i):yield t.syncApi.injectRoomEvents(t.room,i),i.forEach((e=>{t.emit(Zh.AU.Event,e),rp.v.info("Backfilled event ".concat(e.getId()," ").concat(e.getType()," ").concat(e.getStateKey()))}))}));return function(t){return e.apply(this,arguments)}}()))&&void 0!==n?n:[]),void 0!==i.clientWellKnownPollPeriod&&(t.clientWellKnownIntervalID=setInterval((()=>{t.fetchClientWellKnown()}),1e3*i.clientWellKnownPollPeriod),t.fetchClientWellKnown()),t.setSyncState(ip.Lm.Syncing),rp.v.info("Finished backfilling events"),t.matrixRTC.start(),t.capabilities.turnServers&&t.watchTurnServers()}))()}stopClient(){this.widgetApi.off("action:".concat(ep.WidgetApiToWidgetAction.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(ep.WidgetApiToWidgetAction.SendToDevice),this.onToDevice),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var t=this;return(0,Wh.A)((function*(){if(e===t.roomId)return t.room;throw new Error("Unknown room: ".concat(e))}))()}encryptAndSendEvent(e,t,n){var r=this;return(0,Wh.A)((function*(){var i=t.event.redacts?cp(cp({},t.getContent()),{},{redacts:t.event.redacts}):t.getContent();if(n){var o=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0);return r.validateSendDelayedEventResponse(o)}var a,s=t.getTxnId();s&&r.pendingSendingEventsTxId.push({type:t.getType(),id:void 0,txId:s});try{a=yield r.widgetApi.sendRoomEvent(t.getType(),i,e.roomId)}catch(n){throw r.updatePendingEventStatus(e,t,tp.fb.NOT_SENT),n}return e.updatePendingEvent(t,tp.fb.SENT,a.event_id),r.pendingSendingEventsTxId.forEach((e=>{e.txId===s&&(e.id=a.event_id)})),r.eventEmitter.emit(up.PendingEventsChanged),{event_id:a.event_id}}))()}sendStateEvent(e,t,n){var r=arguments,i=this;return(0,Wh.A)((function*(){var o=r.length>3&&void 0!==r[3]?r[3]:"",a=yield i.widgetApi.sendStateEvent(t,o,n,e);if(void 0===a.event_id)throw new Error("'event_id' absent from response to an event request");return{event_id:a.event_id}}))()}_unstable_sendDelayedStateEvent(e,t,n,r){var i=arguments,o=this;return(0,Wh.A)((function*(){var a=i.length>4&&void 0!==i[4]?i[4]:"";if(!(yield o.doesServerSupportUnstableFeature(Zh.rG)))throw Error("Server does not support the delayed events API");var s=yield o.widgetApi.sendStateEvent(n,a,r,e,"delay"in t?t.delay:void 0,"parent_delay_id"in t?t.parent_delay_id:void 0);return o.validateSendDelayedEventResponse(s)}))()}validateSendDelayedEventResponse(e){if(void 0===e.delay_id)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,t){var n=this;return(0,Wh.A)((function*(){if(!(yield n.doesServerSupportUnstableFeature(Zh.rG)))throw Error("Server does not support the delayed events API");return yield n.widgetApi.updateDelayedEvent(e,t)}))()}sendToDevice(e,t){var n=this;return(0,Wh.A)((function*(){return yield n.widgetApi.sendToDevice(e,!1,(0,Yh.HF)(t)),{}}))()}getOpenIdToken(){var e=this;return(0,Wh.A)((function*(){var t=yield e.widgetApi.requestOpenIDConnectToken();return{access_token:t.access_token,expires_in:t.expires_in,matrix_server_name:t.matrix_server_name,token_type:t.token_type}}))()}queueToDevice(e){var t=this;return(0,Wh.A)((function*(){var{eventType:n,batch:r}=e,i=new Yh.kG((()=>new Map));for(var{userId:o,deviceId:a,payload:s}of r)i.getOrCreate(o).set(a,s);yield t.widgetApi.sendToDevice(n,!1,(0,Yh.HF)(i))}))()}encryptAndSendToDevices(e,t){var n=this;return(0,Wh.A)((function*(){var r=new Yh.kG((()=>new Map));for(var{userId:i,deviceInfo:{deviceId:o}}of e)r.getOrCreate(i).set(o,t);yield n.widgetApi.sendToDevice(t.type,!0,(0,Yh.HF)(r))}))()}sendToDeviceViaWidgetApi(e,t,n){var r=this;return(0,Wh.A)((function*(){yield r.widgetApi.sendToDevice(e,t,(0,Yh.HF)(n))}))()}checkTurnServers(){var e=this;return(0,Wh.A)((function*(){return e.turnServers.length>0}))()}getSyncState(){return this.syncState}setSyncState(e){var t=this.syncState;this.syncState=e,this.emit(Zh.AU.Sync,e,t)}ack(e){var t=this;return(0,Wh.A)((function*(){yield t.widgetApi.transport.reply(e.detail,{})}))()}watchTurnServers(){var e=this;return(0,Wh.A)((function*(){var t=e.widgetApi.getTurnServers(),n=()=>{t.return(void 0)};e.lifecycle.signal.addEventListener("abort",n);try{var r,i=!1,o=!1;try{for(var a,s=function(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new dp(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(t);i=!(a=yield s.next()).done;i=!1){var l=a.value;e.turnServers=[{urls:l.uris,username:l.username,credential:l.password}],e.emit(Zh.AU.TurnServers,e.turnServers),rp.v.log("Received TURN server: ".concat(l.uris))}}catch(e){o=!0,r=e}finally{try{i&&null!=s.return&&(yield s.return())}finally{if(o)throw r}}}catch(e){rp.v.warn("Error watching TURN servers",e)}finally{e.lifecycle.signal.removeEventListener("abort",n)}}))()}}function pp(e){throw e instanceof ep.WidgetApiResponseError&&e.data.matrix_api_error?ap.up.fromWidgetApiErrorData(e.data.matrix_api_error):e}var vp=s(7545),mp=s(9521),gp=s(5061),fp=s(5155);class yp{constructor(){(0,qh.A)(this,"unthreadedReadReceipts",new Map),(0,qh.A)(this,"threadedReadReceipts",new Yh.kG((()=>new Map)))}setUnthreaded(e,t){this.unthreadedReadReceipts.set(e,t)}setThreaded(e,t,n){this.threadedReadReceipts.getOrCreate(e).set(t,n)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var t of e.entries())yield t}consumeEphemeralEvents(e){null==e||e.forEach((e=>{e.type===np.Bx.Receipt&&e.content&&Object.keys(e.content).forEach((t=>{Object.entries(e.content[t]).forEach((n=>{var[r,i]=n;if((0,Yh.ll)(r))for(var o of Object.keys(i)){var a=e.content[t][r][o],s={data:e.content[t][r][o],type:r,eventId:t};a.thread_id?this.setThreaded(a.thread_id,o,s):this.setUnthreaded(o,s)}}))}))}))}buildAccumulatedReceiptEvent(e){var t={type:np.Bx.Receipt,room_id:e,content:{}},n=new Yh.kG((()=>new Yh.kG((()=>new Map))));for(var[r,i]of this.allUnthreaded())n.getOrCreate(i.eventId).getOrCreate(i.type).set(r,i.data);for(var[o,a]of this.allThreaded())n.getOrCreate(a.eventId).getOrCreate(a.type).set(o,a.data);return t.content=(0,Yh.HF)(n),n.size>0?t:null}}var _p=function(e){return e.Invite="invite",e.Leave="leave",e.Join="join",e.Knock="knock",e}({});class Ep{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts=e,(0,qh.A)(this,"accountData",{}),(0,qh.A)(this,"inviteRooms",{}),(0,qh.A)(this,"knockRooms",{}),(0,qh.A)(this,"joinRooms",{}),(0,qh.A)(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.accumulateRooms(e,t),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((n=>{this.accumulateRoom(n,_p.Invite,e.rooms.invite[n],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((n=>{this.accumulateRoom(n,_p.Join,e.rooms.join[n],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((n=>{this.accumulateRoom(n,_p.Leave,e.rooms.leave[n],t)})),e.rooms.knock&&Object.keys(e.rooms.knock).forEach((n=>{this.accumulateRoom(n,_p.Knock,e.rooms.knock[n],t)})))}accumulateRoom(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(t){case _p.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,n);break;case _p.Knock:this.accumulateKnockState(e,n);break;case _p.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,r);break;case _p.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:rp.v.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(t.invite_state&&t.invite_state.events)if(this.inviteRooms[e]){var n=this.inviteRooms[e];t.invite_state.events.forEach((e=>{for(var t=!1,r=0;r<n.invite_state.events.length;r++){var i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)}))}else this.inviteRooms[e]={invite_state:t.invite_state}}accumulateKnockState(e,t){if(t.knock_state&&t.knock_state.events)if(this.knockRooms[e]){var n=this.knockRooms[e];t.knock_state.events.forEach((e=>{for(var t=!1,r=0;r<n.knock_state.events.length;r++){var i=n.knock_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.knock_state.events[r]=e,t=!0)}t||n.knock_state.events.push(e)}))}else this.knockRooms[e]={knock_state:t.knock_state}}accumulateJoinState(e,t){var n,r,i,o,a,s,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new yp});var c=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{c._accountData[e.type]=e})),t.unread_notifications&&(c._unreadNotifications=t.unread_notifications),c._unreadThreadNotifications=null!==(n=null!==(r=t[fp.a.stable])&&void 0!==r?r:t[fp.a.unstable])&&void 0!==n?n:void 0,t.summary){var d,u,h,p="m.heroes",v="m.invited_member_count",m="m.joined_member_count",g=c._summary,f=t.summary;g[p]=null!==(d=f[p])&&void 0!==d?d:g[p],g[m]=null!==(u=f[m])&&void 0!==u?u:g[m],g[v]=null!==(h=f[v])&&void 0!==h?h:g[v]}if(c._receipts.consumeEphemeralEvents(null===(i=t.ephemeral)||void 0===i?void 0:i.events),t.timeline&&t.timeline.limited&&(c._timeline=[]),null===(o=t.state)||void 0===o||null===(o=o.events)||void 0===o||o.forEach((e=>{bp(c._currentState,e)})),null===(a=t["org.matrix.msc4222.state_after"])||void 0===a||null===(a=a.events)||void 0===a||a.forEach((e=>{bp(c._currentState,e)})),null===(s=t.timeline)||void 0===s||null===(s=s.events)||void 0===s||s.forEach(((e,n)=>{var r,i;if(t["org.matrix.msc4222.state_after"]||bp(c._currentState,e),l)i=e;else{var o;void 0!==(i=Object.assign({},e)).unsigned&&(i.unsigned=Object.assign({},i.unsigned));var a=null===(o=e.unsigned)||void 0===o?void 0:o.age;void 0!==a&&(i._localTs=Date.now()-a)}c._timeline.push({event:i,token:0===n&&null!==(r=t.timeline.prev_batch)&&void 0!==r?r:null})})),c._timeline.length>this.opts.maxTimelineEntries)for(var y=c._timeline.length-this.opts.maxTimelineEntries;y<c._timeline.length;y++)if(c._timeline[y].token){c._timeline=c._timeline.slice(y,c._timeline.length);break}}getJSON(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.knockRooms).forEach((e=>{t.knock[e]=this.knockRooms[e]})),Object.keys(this.joinRooms).forEach((n=>{var r=this.joinRooms[n],i={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:r._unreadNotifications,unread_thread_notifications:r._unreadThreadNotifications,summary:r._summary};Object.keys(r._accountData).forEach((e=>{i.account_data.events.push(r._accountData[e])}));var o=r._receipts.buildAccumulatedReceiptEvent(n);o&&i.ephemeral.events.push(o),r._timeline.forEach((t=>{if(!i.timeline.prev_batch){if(!t.token)return;i.timeline.prev_batch=t.token}var n,r;!e&&"_localTs"in(r=t.event)&&void 0!==r._localTs?(void 0!==(n=Object.assign({},t.event)).unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,i.timeline.events.push(n)}));for(var a=Object.create(null),s=i.timeline.events.length-1;s>=0;s--){var l=i.timeline.events[s];if(null!==l.state_key&&void 0!==l.state_key){var c=(0,Yh.A4)(l);c.unsigned&&(c.unsigned.prev_content&&(c.content=c.unsigned.prev_content),c.unsigned.prev_sender&&(c.sender=c.unsigned.prev_sender)),bp(a,c)}}Object.keys(r._currentState).forEach((e=>{Object.keys(r._currentState[e]).forEach((t=>{var n=r._currentState[e][t];i["org.matrix.msc4222.state_after"].events.push(n),a[e]&&a[e][t]&&(n=a[e][t]),i.state.events.push(n)}))})),t.join[n]=i}));var n=[];return Object.keys(this.accountData).forEach((e=>{n.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,accountData:n}}getNextBatchToken(){return this.nextBatch}}function bp(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}var Sp=s(4575),Cp=s(7723),wp=s(3337),Ap=s(4659),Tp=s(8221),Ip=s(1200),kp=s(1768),Op=s(6729),Rp=s(441),xp=s(6387),Np=s(7131),Dp=s(1128),Lp=s(4047),Pp=s(310);class Mp{constructor(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.client=e,this.timelineSet=t,(0,qh.A)(this,"windowLimit",void 0),(0,qh.A)(this,"start",void 0),(0,qh.A)(this,"end",void 0),(0,qh.A)(this,"eventCount",0),this.windowLimit=r.windowLimit||1e3,null===(n=t.room)||void 0===n||n.on(Ap.u9.Timeline,this.onTimelineEvent.bind(this))}load(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=n=>{if(!n)throw new Error("No timeline given to initFields");var r,i=n.getEvents();if(e){if((r=i.findIndex((t=>t.getId()===e)))<0)throw new Error("getEventTimeline result didn't include requested event")}else r=i.length;var o=Math.min(i.length,r+Math.ceil(t/2)),a=Math.max(0,o-t);this.start=new Up(n,a-n.getBaseIndex()),this.end=new Up(n,o-n.getBaseIndex()),this.eventCount=o-a};return this.timelineSet.getTimelineForEvent(e)?(n(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(n):(n(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){var t,n;if(e==Tp.q.BACKWARDS)return null!==(t=this.start)&&void 0!==t?t:null;if(e==Tp.q.FORWARDS)return null!==(n=this.end)&&void 0!==n?n:null;throw new Error("Invalid direction '"+e+"'")}extend(e,t){var n=this.getTimelineIndex(e);if(!n)return!1;var r=e==Tp.q.BACKWARDS?n.retreat(t):n.advance(t);if(r){this.eventCount+=r,this.eventCount;var i=this.eventCount-this.windowLimit;return i>0&&this.unpaginate(i,e!=Tp.q.BACKWARDS),!0}return!1}onTimelineEvent(e,t,n,r){r&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&void 0===e[e.length-1]&&this.end&&this.end.index--}canPaginate(e){var t=this.getTimelineIndex(e);if(!t)return!1;if(e==Tp.q.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;var n=t.timeline.getNeighbouringTimeline(e),r=t.timeline.getPaginationToken(e);return Boolean(n)||Boolean(r)}paginate(e,t){var n=arguments,r=this;return(0,Wh.A)((function*(){var i=!(n.length>2&&void 0!==n[2])||n[2],o=n.length>3&&void 0!==n[3]?n[3]:10,a=r.getTimelineIndex(e);if(!a)return!1;if(a.pendingPaginate)return a.pendingPaginate;if(r.extend(e,t))return!0;if(!i||0===o)return!1;if(!a.timeline.getPaginationToken(e))return!1;var s=r.client.paginateEventTimeline(a.timeline,{backwards:e==Tp.q.BACKWARDS,limit:t}).finally((function(){a.pendingPaginate=void 0})).then((n=>n?r.paginate(e,t,!0,o-1):r.paginate(e,t,!1,0)));return a.pendingPaginate=s,s}))()}unpaginate(e,t){var n=t?this.start:this.end;if(!n)throw new Error("Attempting to unpaginate startOfTimeline=".concat(t," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=r,this.eventCount-=r,this.eventCount}}getEvents(){if(!this.start)return[];for(var e=[],t=this.start.timeline;t;){var n,r,i=t.getEvents(),o=0,a=i.length;t===this.start.timeline&&(o=this.start.index+t.getBaseIndex()),t===(null===(n=this.end)||void 0===n?void 0:n.timeline)&&(a=this.end.index+t.getBaseIndex());for(var s=o;s<a;s++)e.push(i[s]);if(t===(null===(r=this.end)||void 0===r?void 0:r.timeline))break;t=t.getNeighbouringTimeline(Tp.q.FORWARDS)}return e}}class Up{constructor(e,t){this.timeline=e,this.index=t,(0,qh.A)(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var t;if(e<0){if((t=Math.max(e,this.minIndex()-this.index))<0)return this.index+=t,t}else if((t=Math.min(e,this.maxIndex()-this.index))>0)return this.index+=t,t;var n=this.timeline.getNeighbouringTimeline(e<0?Tp.q.BACKWARDS:Tp.q.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}var Fp="m.login.email.identity",Bp="m.login.msisdn",Gp=function(e){return e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy",e.RegistrationToken="m.login.registration_token",e.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",e}({});class $p extends Error{constructor(e,t,n){super(e),this.required_stages=t,this.flows=n,(0,qh.A)(this,"name","NoAuthFlowFoundError")}}class Vp{constructor(e){var t=this;(0,qh.A)(this,"matrixClient",void 0),(0,qh.A)(this,"inputs",void 0),(0,qh.A)(this,"clientSecret",void 0),(0,qh.A)(this,"requestCallback",void 0),(0,qh.A)(this,"busyChangedCallback",void 0),(0,qh.A)(this,"stateUpdatedCallback",void 0),(0,qh.A)(this,"requestEmailTokenCallback",void 0),(0,qh.A)(this,"supportedStages",void 0),(0,qh.A)(this,"data",void 0),(0,qh.A)(this,"emailSid",void 0),(0,qh.A)(this,"requestingEmailToken",!1),(0,qh.A)(this,"attemptAuthDeferred",null),(0,qh.A)(this,"chosenFlow",null),(0,qh.A)(this,"currentStage",null),(0,qh.A)(this,"emailAttempt",1),(0,qh.A)(this,"submitPromise",null),(0,qh.A)(this,"requestEmailToken",(0,Wh.A)((function*(){if(t.requestingEmailToken)rp.v.warn("Could not request email token: Already requesting");else{rp.v.trace("Requesting email token. Attempt: "+t.emailAttempt),t.requestingEmailToken=!0;try{var e=yield t.requestEmailTokenCallback(t.inputs.emailAddress,t.clientSecret,t.emailAttempt++,t.data.session);t.emailSid=e.sid,rp.v.trace("Email token request succeeded")}finally{t.requestingEmailToken=!1}}}))),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,void 0!==e.supportedStages&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return(0,Wh.A)((function*(){var t;e.attemptAuthDeferred=(0,Yh.v6)();var n=e.attemptAuthDeferred.promise;if(null!==(t=e.data)&&void 0!==t&&null!==(t=t.flows)&&void 0!==t&&t.length)e.startNextAuthStage();else{var r;null===(r=e.busyChangedCallback)||void 0===r||r.call(e,!0);var i=e.data.session?{session:e.data.session}:null;e.doRequest(i).finally((()=>{var t;null===(t=e.busyChangedCallback)||void 0===t||t.call(e,!1)}))}return n}))()}poll(){var e=this;return(0,Wh.A)((function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var t={};if(e.currentStage==Fp&&e.emailSid){var n={sid:e.emailSid,client_secret:e.clientSecret},r=e.matrixClient.getIdentityServerUrl();r&&(n.id_server=new URL(r).host),t={type:Fp,threepid_creds:n}}e.submitAuthDict(t,!0)}}))()}getSessionId(){var e;return null===(e=this.data)||void 0===e?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data)||void 0===t||null===(t=t.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var t=arguments,n=this;return(0,Wh.A)((function*(){var r,i,o,a=t.length>1&&void 0!==t[1]&&t[1];if(!n.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");for(a||null===(i=n.busyChangedCallback)||void 0===i||i.call(n,!0);n.submitPromise;)try{yield n.submitPromise}catch(e){}null!==(r=n.data)&&void 0!==r&&r.session?(o={session:n.data.session},Object.assign(o,e)):o=e;try{n.submitPromise=n.doRequest(o,a),yield n.submitPromise}finally{var s;n.submitPromise=null,a||null===(s=n.busyChangedCallback)||void 0===s||s.call(n,!1)}}))()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var t=arguments,n=this;return(0,Wh.A)((function*(){var r=t.length>1&&void 0!==t[1]&&t[1];try{var i=yield n.requestCallback(e,r);n.attemptAuthDeferred.resolve(i),n.attemptAuthDeferred=null}catch(e){var o,a,s,l,c,d=e instanceof mp.up?e:null,u=null!==(o=null==d||null===(a=d.data)||void 0===a?void 0:a.flows)&&void 0!==o?o:null,h=(null===(s=n.data)||void 0===s?void 0:s.flows)||Boolean(u);d&&401===d.httpStatus&&d.data&&h||(r?rp.v.log("Background poll request failed doing UI auth: ignoring",e):null===(c=n.attemptAuthDeferred)||void 0===c||c.reject(e)),d&&!d.data&&(d.data={}),!d||d.data.flows||d.data.completed||d.data.session||(d.data.flows=n.data.flows,d.data.completed=n.data.completed,d.data.session=n.data.session),d&&(n.data=d.data);try{n.startNextAuthStage()}catch(e){return n.attemptAuthDeferred.reject(e),void(n.attemptAuthDeferred=null)}if(!n.emailSid&&null!==(l=n.chosenFlow)&&void 0!==l&&l.stages.includes(Gp.Email))try{yield n.requestEmailToken()}catch(e){n.attemptAuthDeferred.reject(e),n.attemptAuthDeferred=null}}}))()}startNextAuthStage(){var e,t,n,r,i=this.chooseStage();if(!i)throw new Error("No incomplete flows from the server");this.currentStage=i,i!==Gp.Dummy?null!==(e=this.data)&&void 0!==e&&e.errcode||null!==(t=this.data)&&void 0!==t&&t.error?this.stateUpdatedCallback(i,{errcode:(null===(n=this.data)||void 0===n?void 0:n.errcode)||"",error:(null===(r=this.data)||void 0===r?void 0:r.error)||""}):this.stateUpdatedCallback(i,i===Fp?{emailSid:this.emailSid}:{}):this.submitAuthDict({type:"m.login.dummy"})}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),rp.v.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return rp.v.log("Next stage: %s",e),e}scoreFlow(e){var t=e.stages.length;return void 0!==this.supportedStages&&(t+=10*e.stages.filter((e=>!this.supportedStages.has(e))).length),t}chooseFlow(){var e,t=(null===(e=this.data)||void 0===e?void 0:e.flows)||[],n=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),r=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber);for(var i of(t.sort(((e,t)=>this.scoreFlow(e)-this.scoreFlow(t))),t)){var o=!1,a=!1;for(var s of i.stages)s===Fp?o=!0:s==Bp&&(a=!0);if(o==n&&a==r)return i}var l=[];throw n&&l.push(Fp),r&&l.push(Bp),new $p("No appropriate authentication flow found",l,t)}firstUncompletedStage(e){var t,n=(null===(t=this.data)||void 0===t?void 0:t.completed)||[];return e.stages.find((e=>!n.includes(e)))}}var jp=s(2228),Kp=s(8425),Wp=s(7501),qp=[e=>{e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})},e=>{e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},e=>{e.createObjectStore("client_options",{keyPath:["clobber"]})},e=>{e.createObjectStore("to_device_queue",{autoIncrement:!0})}],Hp=qp.length;function Yp(e,t,n){var r=e.openCursor(t);return new Promise(((e,t)=>{var i=[];r.onerror=()=>{var e;t(new Error("Query failed: "+(null===(e=r.error)||void 0===e?void 0:e.name)))},r.onsuccess=()=>{var t=r.result;t?(i.push(n(t)),t.continue()):e(i)}}))}function zp(e){return new Promise(((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function Jp(e){return new Promise(((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function Xp(e){return Jp(e).then((t=>e.result))}class Qp{static exists(e,t){return t="matrix-js-sdk:"+(t||"default"),(0,Wp.t)(e,t)}constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this.indexedDB=e,(0,qh.A)(this,"dbName",void 0),(0,qh.A)(this,"syncAccumulator",void 0),(0,qh.A)(this,"db",void 0),(0,qh.A)(this,"disconnected",!0),(0,qh.A)(this,"_isNewlyCreated",!1),(0,qh.A)(this,"syncToDatabasePromise",void 0),(0,qh.A)(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+t,this.syncAccumulator=new Ep}connect(e){var t=this;if(!this.disconnected)return rp.v.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,rp.v.log("LocalIndexedDBStoreBackend.connect: connecting...");var n=this.indexedDB.open(this.dbName,Hp);return n.onupgradeneeded=e=>{var t=n.result,r=e.oldVersion;rp.v.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(r)),r<1&&(this._isNewlyCreated=!0),qp.forEach(((e,n)=>{r<=n&&e(t)}))},n.onblocked=()=>{rp.v.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},rp.v.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),Jp(n).then((0,Wh.A)((function*(){rp.v.log("LocalIndexedDBStoreBackend.connect: connected"),t.db=n.result,t.db.onversionchange=()=>{var e;null===(e=t.db)||void 0===e||e.close(),t.disconnected=!0,t.db=void 0},t.db.onclose=()=>{t.disconnected=!0,t.db=void 0,null==e||e()},yield t.init()})))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((e=>{var[t,n]=e;rp.v.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:n.nextBatch,rooms:n.roomsData,account_data:{events:t}},!0)}))}getOutOfBandMembers(e){return new Promise(((t,n)=>{var r=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),o=r.openCursor(i),a=[],s=!1;o.onsuccess=()=>{var e=o.result;if(!e)return a.length||s?t(a):t(null);var n=e.value;n.oob_written?s=!0:a.push(n),e.continue()},o.onerror=e=>{n(e)}})).then((t=>(rp.v.log("LL: got ".concat(null==t?void 0:t.length," membershipEvents from storage for room ").concat(e," ...")),t)))}setOutOfBandMembers(e,t){var n=this;return(0,Wh.A)((function*(){rp.v.log("LL: backend about to store ".concat(t.length)+" members for ".concat(e));var r=n.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");t.forEach((e=>{i.put(e)}));var o={room_id:e,oob_written:!0,state_key:0};i.put(o),yield zp(r),rp.v.log("LL: backend done storing for ".concat(e,"!"))}))()}clearOutOfBandMembers(e){var t=this;return(0,Wh.A)((function*(){var n,r=t.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),o=Xp(r.openKeyCursor(i,"next")).then((e=>(null==e?void 0:e.primaryKey)[1])),a=Xp(r.openKeyCursor(i,"prev")).then((e=>(null==e?void 0:e.primaryKey)[1])),[s,l]=yield Promise.all([o,a]),c=t.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),d=IDBKeyRange.bound([e,s],[e,l]);rp.v.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,s],[e,l]),yield(n=c.delete(d),new Promise(((e,t)=>{n.onsuccess=()=>e(n),n.onerror=e=>t(e)})))}))()}clearDatabase(){return new Promise((e=>{var t;rp.v.log("Removing indexeddb instance: ".concat(this.dbName)),null===(t=this.db)||void 0===t||t.close();var n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{rp.v.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},n.onerror=()=>{var t;rp.v.warn("unable to delete js-sdk store indexeddb: ".concat(null===(t=n.error)||void 0===t?void 0:t.name)),e()},n.onsuccess=()=>{rp.v.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}))}getSavedSync(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve((0,Yh.A4)(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then((()=>{this.syncAccumulator.accumulate(e)}))}syncToDatabase(e){var t=this;return(0,Wh.A)((function*(){return t.syncToDatabasePromise?(rp.v.warn("Skipping syncToDatabase() as persist already in flight"),t.pendingUserPresenceData.push(...e),t.syncToDatabasePromise):(e.unshift(...t.pendingUserPresenceData),t.syncToDatabasePromise=t.doSyncToDatabase(e),t.syncToDatabasePromise)}))()}doSyncToDatabase(e){var t=this;return(0,Wh.A)((function*(){try{var n=t.syncAccumulator.getJSON(!0);yield Promise.all([t.persistUserPresenceEvents(e),t.persistAccountData(n.accountData),t.persistSyncData(n.nextBatch,n.roomsData)])}finally{t.syncToDatabasePromise=void 0}}))()}persistSyncData(e,t){return rp.v.log("Persisting sync data up to",e),(0,Yh.j0)((()=>{var n=this.db.transaction(["sync"],"readwrite");return n.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t}),zp(n).then((()=>{rp.v.log("Persisted sync data up to",e)}))}))}persistAccountData(e){return(0,Yh.j0)((()=>{var t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(var r of e)n.put(r);return zp(t).then()}))}persistUserPresenceEvents(e){return(0,Yh.j0)((()=>{var t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(var r of e)n.put({userId:r[0],event:r[1]});return zp(t).then()}))}getUserPresenceEvents(){return(0,Yh.j0)((()=>Yp(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))}loadAccountData(){return rp.v.log("LocalIndexedDBStoreBackend: loading account data..."),(0,Yh.j0)((()=>Yp(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(rp.v.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))}loadSyncData(){return rp.v.log("LocalIndexedDBStoreBackend: loading sync data..."),(0,Yh.j0)((()=>Yp(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(rp.v.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&rp.v.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))}getClientOptions(){return Promise.resolve().then((()=>Yp(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{var t;return null===(t=e.value)||void 0===t?void 0:t.options})).then((e=>e[0]))))}storeClientOptions(e){var t=this;return(0,Wh.A)((function*(){var n=t.db.transaction(["client_options"],"readwrite");n.objectStore("client_options").put({clobber:"-",options:e}),yield zp(n)}))()}saveToDeviceBatches(e){var t=this;return(0,Wh.A)((function*(){var n=t.db.transaction(["to_device_queue"],"readwrite"),r=n.objectStore("to_device_queue");for(var i of e)r.add(i);yield zp(n)}))()}getOldestToDeviceBatch(){var e=this;return(0,Wh.A)((function*(){var t=e.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),n=yield Xp(t.openCursor());if(!n)return null;var r=n.value;return{id:n.key,txnId:r.txnId,eventType:r.eventType,batch:r.batch}}))()}removeToDeviceBatch(e){var t=this;return(0,Wh.A)((function*(){var n=t.db.transaction(["to_device_queue"],"readwrite");n.objectStore("to_device_queue").delete(e),yield zp(n)}))()}destroy(){var e=this;return(0,Wh.A)((function*(){var t;null===(t=e.db)||void 0===t||t.close()}))()}}class Zp{constructor(e,t){this.workerFactory=e,this.dbName=t,(0,qh.A)(this,"worker",void 0),(0,qh.A)(this,"nextSeq",0),(0,qh.A)(this,"inFlight",{}),(0,qh.A)(this,"startPromise",void 0),(0,qh.A)(this,"onWorkerMessage",(e=>{var t,n=e.data;if("closed"==n.command)null===(t=this.onClose)||void 0===t||t.call(this);else if("cmd_success"==n.command||"cmd_fail"==n.command){if(void 0===n.seq)return void rp.v.error("Got reply from worker with no seq");var r=this.inFlight[n.seq];if(void 0===r)return void rp.v.error("Got reply for unknown seq "+n.seq);if(delete this.inFlight[n.seq],"cmd_success"==n.command)r.resolve(n.result);else{var i=new Error(n.error.message);i.name=n.error.name,r.reject(i)}}else rp.v.warn("Unrecognised message from worker: ",n)}))}connect(e){return this.onClose=e,this.ensureStarted().then((()=>this.doCmd("connect")))}clearDatabase(){return this.ensureStarted().then((()=>this.doCmd("clearDatabase")))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var t=this;return(0,Wh.A)((function*(){return t.doCmd("saveToDeviceBatches",[e])}))()}getOldestToDeviceBatch(){var e=this;return(0,Wh.A)((function*(){return e.doCmd("getOldestToDeviceBatch")}))()}removeToDeviceBatch(e){var t=this;return(0,Wh.A)((function*(){return t.doCmd("removeToDeviceBatch",[e])}))()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then((()=>{rp.v.log("IndexedDB worker is ready")}))),this.startPromise}doCmd(e,t){return Promise.resolve().then((()=>{var n,r=this.nextSeq++,i=(0,Yh.v6)();return this.inFlight[r]=i,null===(n=this.worker)||void 0===n||n.postMessage({command:e,seq:r,args:t}),i.promise}))}destroy(){var e=this;return(0,Wh.A)((function*(){var t;null===(t=e.worker)||void 0===t||t.terminate()}))()}}class ev extends Xh{static exists(e,t){return Qp.exists(e,t)}constructor(e){if(super(e),(0,qh.A)(this,"backend",void 0),(0,qh.A)(this,"startedUp",!1),(0,qh.A)(this,"syncTs",0),(0,qh.A)(this,"userModifiedMap",{}),(0,qh.A)(this,"emitter",new xp.X),(0,qh.A)(this,"onClose",(()=>{this.emitter.emit("closed")})),(0,qh.A)(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),(0,qh.A)(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),(0,qh.A)(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),(0,qh.A)(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{rp.v.log("Deleted indexeddb data.")}),(e=>{throw rp.v.error("Failed to delete indexeddb data: ".concat(e)),e})))),null)),(0,qh.A)(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();var e=[];for(var t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}),null)),(0,qh.A)(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),(0,qh.A)(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),(0,qh.A)(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),(0,qh.A)(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),(0,qh.A)(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),(0,qh.A)(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new Zp(e.workerFactory,e.dbName):this.backend=new Qp(e.indexedDB,e.dbName)}on(e,t){this.emitter.on(e,t)}startup(){return this.startedUp?(rp.v.log("IndexedDBStore.startup: already started"),Promise.resolve()):(rp.v.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then((()=>(rp.v.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{rp.v.log("IndexedDBStore.startup: processing presence events"),e.forEach((e=>{var[t,n]=e;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var r=this.createUser(t);n&&r.setPresenceEvent(new tp.kl(n)),this.userModifiedMap[r.userId]=r.getLastModifiedTime(),this.storeUser(r)})),this.startedUp=!0})))}destroy(){return this.backend.destroy()}wantsSave(){return Date.now()-this.syncTs>3e5}save(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){var n=this,r=t?super[t]:null;return(0,Wh.A)((function*(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];try{return yield e.call(n,...i)}catch(e){rp.v.error("IndexedDBStore failure, degrading to MemoryStore",e),n.emitter.emit("degraded",e);try{rp.v.log("IndexedDBStore trying to delete degraded data"),yield n.backend.clearDatabase(),rp.v.log("IndexedDBStore delete after degrading succeeded")}catch(e){rp.v.warn("IndexedDBStore delete after degrading failed",e)}if(r)return r.call(n,...i)}}))}getPendingEvents(e){var t=()=>super.getPendingEvents,n=this;return(0,Wh.A)((function*(){if(!n.localStorage)return t().call(n,e);var r=n.localStorage.getItem(tv(e));if(r)try{return JSON.parse(r)}catch(e){rp.v.error("Could not parse persisted pending events",e)}return[]}))()}setPendingEvents(e,t){var n=()=>super.setPendingEvents,r=this;return(0,Wh.A)((function*(){if(!r.localStorage)return n().call(r,e,t);t.length>0?r.localStorage.setItem(tv(e),JSON.stringify(t)):r.localStorage.removeItem(tv(e))}))()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function tv(e){return"mx_pending_events_".concat(e)}var nv=s(2642),rv=s(5530),iv=s(6344),ov=s(5937),av=s(2114),sv=s(5566),lv=s(5928),cv=s(6412),dv=s(1265),uv=s(4867),hv=function(e){return e.Email="email",e.Phone="msisdn",e}({}),pv=new(s(2340).qr)("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility"),vv=function(e){return e.Gitlab="gitlab",e.Github="github",e.Apple="apple",e.Google="google",e.Facebook="facebook",e.Twitter="twitter",e}({}),mv=function(e){return e.LOGIN="login",e.REGISTER="register",e}({}),gv=s(4744),fv=s(6022),yv=s(6209),_v=s(4203),Ev=(s(9608),"us.cloke.msc4175.tz");class bv{constructor(e){(0,qh.A)(this,"relations",void 0),this.relations=e.filter((e=>!!e))}getRelations(){return this.relations.reduce(((e,t)=>[...e,...t.getRelations()]),[])}on(e,t){this.relations.forEach((n=>n.on(e,t)))}off(e,t){this.relations.forEach((n=>n.off(e,t)))}}var Sv=s(2027),Cv=s(6900),wv=s(2188),Av=s(2958),Tv=s(7780),Iv=s(6806),kv=s(9372),Ov=s(9456),Rv=s(6695),xv=s(9096),Nv=function(e){return e.Global="Global",e.SetItemError="setItem",e.GetItemError="getItem",e.RemoveItemError="removeItem",e.ClearError="clear",e.QuotaExceededError="QuotaExceededError",e}({});class Dv extends xp.X{}var Lv,Pv=new Dv,Mv=s(8417),Uv=()=>new Kh._;function Fv(e){Uv=e}function Bv(e){var t,n,r;return e.store=null!==(t=e.store)&&void 0!==t?t:new Xh({localStorage:globalThis.localStorage}),e.scheduler=null!==(n=e.scheduler)&&void 0!==n?n:new Qh.b,e.cryptoStore=null!==(r=e.cryptoStore)&&void 0!==r?r:Uv(),e}function Gv(e){return new Zh.pB(Bv(e))}function $v(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return new hp(e,t,n,Bv(r),i)}if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;try{Lv=globalThis.indexedDB}catch(e){}Lv&&Fv((()=>new rv.y(Lv,"matrix-js-sdk:crypto"))),globalThis.matrixcs=e;var Vv=s(7858),jv=s(8058);let Kv={};const Wv="matrix-js-sdk:";Kv.LOGIN_RESULTS={SUCCESS:"SUCCESS",MISSING_DATA:"MISSING_DATA",UNAUTHORIZED:"UNAUTHORIZED",NETWORK_ERROR:"NETWORK_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR"};let qv=null,Hv=null,Yv=null,zv=null,Jv=null,Xv=null,Qv=null;async function Zv(e){if(!(e&&e.accessToken&&e.deviceId&&e.user))return null;const t=new ev({indexedDB:window.indexedDB,dbName:rm(e)});return await t.startup(),Gv({baseUrl:e.homeserver,accessToken:e.accessToken,userId:nm(e),deviceId:e.deviceId,store:t})}function em(e){return log.info("matrix: deleting database...",e),new Promise((async t=>{const n=window.indexedDB.deleteDatabase(e);n.onerror=n=>{log.warn("matrix: error deleting IndexedDB database",e),t(!1)},n.onsuccess=n=>{log.info("matrix: deleted IndexedDB database",e),t(!0)},await ee.Z.sleep(1e3),t(!1)}))}function tm(){let e=n.w.getUserSettings();e.integrations.matrixConfig=Hv,n.w.saveUserSettings(e)}function nm(e){return e&&e.user&&e.homeserver?Kv.getFullUserByName(e.user,e.homeserver):""}function rm(e,t=!1){let n=`matrix-store-${nm(e)}-${e.deviceId}`;return t?Wv+n:n}Kv.getUsername=async function(e=!1){return zv&&await zv,Yv?e?Yv.getUserId():Yv.getUserIdLocalpart():null},Kv.isEncryptionEnabled=function(){return Hv.useCrypto},Kv.login=async function(e=null){return zv&&await zv,Hv=await async function(){let e=n.w.getUserSettings();return e&&e.integrations?e.integrations.matrixConfig:null}(),qv=e||await async function(){return(await xg.getMetadata()).integrations.matrixConfig}(),Yv&&Jv===Kv.getFullUserByName(Hv.user)&&Xv===Hv.deviceId?(log.info("matrix: already logged in"),Kv.LOGIN_RESULTS.SUCCESS):(await Kv.reset(),zv=Promise.resolve().then((async()=>{if(!qv||!qv.user||!qv.password)return log.debug("matrix: not logging in, no credentials configured!"),Kv.LOGIN_RESULTS.MISSING_DATA;if(Hv.homeserver&&Hv.user&&(Hv.homeserver!==qv.homeserver||Hv.user!==qv.user)&&await Kv.logout(Hv),rp.v.setLevel("silent"),rp.v.disableAll(!0),!Hv.accessToken||!Hv.deviceId){log.info("matrix: initial login using username and password");let e=Gv({baseUrl:qv.homeserver});try{let t=await e.loginRequest({type:"m.login.password",user:nm(qv),password:qv.password});await e.stopClient(),Hv.accessToken=t.access_token,Hv.deviceId=t.device_id,Hv.user=qv.user,Hv.homeserver=qv.homeserver,tm()}catch(e){return log.warn("login to matrix failed (user and password)",e),"ConnectionError"===e.name?Kv.LOGIN_RESULTS.NETWORK_ERROR:"M_FORBIDDEN"===e.name?Kv.LOGIN_RESULTS.UNAUTHORIZED:Kv.LOGIN_RESULTS.UNKNOWN_ERROR}}log.info("matrix: login using access token, deviceId:",Hv.deviceId);try{if(Yv=await Zv(Hv),!Yv)return log.warn("matrix: init with access token failed, missing some data.");try{!n.w.anyMatrixUserUsingCrypto()||Hv.useCrypto?(log.info(`init crypto for matrix user "${Hv.user}"...`),await Yv.initRustCrypto(),Yv.getCrypto().logger.disableAll(),Hv.useCrypto=!0,tm()):log.info(`Not using crypto for matrix user "${Hv.user}" because another user already uses crypto on this device. Multiple users using crypto is currently not supported by matrix-js-sdk.`)}catch(e){log.info("matrix: failed to init crypto, can be normal if not connected to internet",e);const t=async()=>{log.info("matrix: re-login after being online now."),window.removeEventListener("online",t),await Kv.reset(),await Kv.login()};window.addEventListener("online",t)}return Yv.startClient(),new Promise((e=>{Yv.once("sync",(async function(t){"PREPARED"===t&&(log.info("matrix: client ready for",nm(Hv)),Jv=Kv.getFullUserByName(Hv.user),Xv=Hv.deviceId,Yv.on("Room.timeline",(async(e,t,n)=>{Qv&&(e.getType()===np.Bx.RoomMessageEncrypted&&await Yv.decryptEventIfNeeded(e),Qv(e))})),Yv.on("Room.myMembership",(async e=>{"invite"===e.getMyMembership()&&await async function(e){console.log(`Accepting invite for room: ${e}`);try{await Yv.joinRoom(e),log.info(`Successfully joined room: ${e}`)}catch(t){log.warn(`Failed to join room ${e}:`,t)}}(e.roomId),"leave"===e.getMyMembership()&&(log.info("matrix: was removed from room",e.roomId),await Yv.forget(e.roomId))})),e(Kv.LOGIN_RESULTS.SUCCESS))}))}))}catch(e){log.warn("login to matrix failed (access token).",e)}return Kv.LOGIN_RESULTS.UNKNOWN_ERROR})),zv)},Kv.doWithClient=async function(e){if(zv&&await zv,Yv&&e)return e(Yv);log.warn("matrix: couldn't perform action with client, not initialized.")},Kv.reset=async function(){Yv&&(await Yv.stopClient(),Yv=null),zv=null,Jv=null,Xv=null},Kv.logout=async function(e=Hv,t=!1){if(!e||!e.user||!e.accessToken)return log.warn("matrix: couldn't logout, missing data.");let n=null,r=qv.user===e.user&&Yv;if(n=r?Yv:await Zv(e),log.info("matrix: logging out...",e.user),n)try{await n.stopClient(),await n.logout()}catch(e){log.warn("matrix: error while logout",e)}if(r&&!t&&(log.info("matrix: reset local config...","deviceId:",Hv.deviceId),Hv=new Vv.Z,tm(),await Kv.reset()),e.useCrypto){let e=Wv+":matrix-sdk-crypto";await em(e)}let i=rm(e,!0);await em(i)},Kv.setTimelineCallback=function(e){e&&(Qv=e)},Kv.getCurrentAccessToken=async function(){if(zv&&await zv,Yv&&Jv)return Hv.accessToken},Kv.existsUser=async function(e){if(zv&&await zv,!Yv)return!1;try{return await Yv.getProfileInfo(Kv.getFullUserByName(e)),!0}catch(e){}return!1},Kv.getFullUserByName=function(e,t=null){if(!e)return"";t=t||(new jv.P).homeserver;let n="";try{n=`:${new URL(t).host}`}catch(e){return log.warn("matrix: error parsing homeserver url"),""}return(e=e.startsWith("@")?e:"@"+e).includes(":")?e:e+n},(0,t.A)(document).on(C.A.EVENT_USER_DELETED,(async function(e,t,n){n&&n.integrations&&n.integrations.matrixConfig&&await Kv.logout(n.integrations.matrixConfig,!0)}));class im{constructor(e={}){this.msgType=e.msgType,this.textContent=e.textContent,this.sender=e.sender,this.senderId=e.senderId,this.isDeleted=e.isDeleted,this.imageUrl=e.imageUrl,this.roomId=e.roomId,this.imageName=e.imageName,this.timestamp=e.timestamp,this.dateTimeReadable=e.dateTimeReadable}}let om={};const am=["image/jpeg","image/gif","image/png","image/apng","image/webp","image/avif","video/mp4","video/webm","video/ogg","video/quicktime","audio/mp4","audio/webm","audio/aac","audio/mpeg","audio/ogg","audio/wave","audio/wav","audio/x-wav","audio/x-pn-wav","audio/flac","audio/x-flac"];om.imageMessageEventToBlobUrl=async function(e,t,n){let r=e.getContent().url||e.getContent().file.url;r=n.mxcUrlToHttp(r,void 0,void 0,void 0,!1,!0,!0);try{let n=await om.fetchUrl(r,t),i=n;const o=e.getContent();if(e.getContent().file){const e=await s.e(806).then(s.t.bind(s,806,23));i=await e.decryptAttachment(n,o.file)}let a=o.info.mimetype?o.info.mimetype.split(";")[0].trim():"";a=function(e){return am.includes(e)?e:"application/octet-stream"}(a);const l=new Blob([i],{type:a});return URL.createObjectURL(l)}catch(e){console.error("matrix: error getting blob image:",e)}},om.fetchUrl=async function(e,t){try{let n=await fetch(e,{headers:{Authorization:`Bearer ${t}`}});return n.ok?await n.arrayBuffer():void log.error("matrix: error fetching media data.",n.statusCode)}catch(e){log.error("matrix: error fetching media data.",e)}};let sm={};sm.LOGIN_RESULTS=Kv.LOGIN_RESULTS;let lm=null,cm=null;async function dm(e,t,n){switch(console.log(e.event),e.getType()){case np.Bx.RoomMessage:console.log(`📩 New message: ${e.getContent().body}`),lm&&lm(await um(e));break;case"m.reaction":console.log(`Reaction added: ${e.getContent().m_relates_to.key}`);break;case"m.room.member":console.log(`User membership changed: ${e.getSender()} is now ${e.getContent().membership}`),cm&&setTimeout((async()=>{let e=await sm.getRooms();cm(e)}),500);break;default:console.log(`Received event: ${e.getType()}`)}}async function um(e){return Kv.doWithClient((async t=>{let n,r=e.getTs(),i=new Date(r);n=ee.Z.isSameDate(i,new Date)?i.toLocaleTimeString(o.A.getContentLang(),{hour:"numeric",minute:"numeric"}):i.toLocaleTimeString(o.A.getContentLang(),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"});let a=new im({msgType:e.getContent().msgtype,sender:e.sender.name,senderId:e.getSender(),isDeleted:e.isRedacted(),textContent:e.getContent().body,roomId:e.getRoomId(),timestamp:r,dateTimeReadable:n});return"m.image"===e.getContent().msgtype&&(a.imageUrl=await om.imageMessageEventToBlobUrl(e,await Kv.getCurrentAccessToken(),t),a.imageName=a.textContent,a.textContent=a.textContent.replace(/\.(svg|jpe?g|png|gif|webp)$/i,"")),a}))}sm.getUsername=async function(e=!1){return Kv.getUsername(e)},sm.isEncryptionEnabled=function(){return Kv.isEncryptionEnabled()},sm.login=function(e=null){return Kv.setTimelineCallback(dm),Kv.login(e)},sm.logout=function(){return Kv.logout()},sm.onMessage=function(e){lm=e},sm.onRoomChange=function(e){cm=e},sm.sendMessage=async function(e,n){return(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SENDING_START),await Kv.doWithClient((async t=>{const r={body:n,msgtype:"m.text"};t.sendEvent(e,np.Bx.RoomMessage,r,"",((e,t)=>{console.log(e)}))}))},sm.sendImage=async function(e,n,r="image"){return(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SENDING_START),await Kv.doWithClient((async t=>{let i=await ue.M.canvasToBlob(n),o=await t.uploadContent(i,{name:r,type:i.type});const a={body:r+".png",msgtype:"m.image",url:o.content_uri,info:{mimetype:i.type,size:i.size,w:n.width,h:n.height}};t.sendEvent(e,np.Bx.RoomMessage,a,"",((e,t)=>{console.log(e)}))}))},sm.getRooms=async function(){return await Kv.doWithClient((e=>{let t=e.getRooms();return t.sort(((e,t)=>e.name.localeCompare(t.name))),t.filter((e=>["join","invite"].includes(e.getMyMembership())))}))},sm.createPrivateRoom=async function(e,t=!1,n=void 0){return Kv.doWithClient((async r=>{try{const i={visibility:"private",invite:[Kv.getFullUserByName(e)],name:n||void 0,room_version:"9",preset:"private_chat"};return t&&(i.initial_state=[{type:"m.room.encryption",state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]),(await r.createRoom(i)).room_id}catch(e){log.warn("matrix: error creating room or inviting user:",e)}return null}))},sm.leaveRoom=function(e){return Kv.doWithClient((async t=>{t.leave(e)}))},sm.getMessageEvents=async function(e,t=10){return await Kv.doWithClient((async n=>{let r=n.getRooms().find((t=>t.roomId===e));if(!r)return;let i=r.getLiveTimeline();t&&await n.paginateEventTimeline(i,{backwards:!0,limit:t});for(const e of i.getEvents())e.getType()===np.Bx.RoomMessageEncrypted&&await n.decryptEventIfNeeded(e);let o=i.getEvents().filter((e=>e.getType()===np.Bx.RoomMessage&&!e.isDecryptionFailure()));return await async function(e=[]){return await Promise.all(e.map((async e=>um(e))))}(o)}))},sm.existsUser=async function(e){return Kv.existsUser(e)},sm.getFullUsername=function(e){return Kv.getFullUserByName(e)},(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,(()=>{sm.login()}));let hm={},pm=null;async function vm(){return pm||(await sm.getRooms()||[])[0]}async function mm(e=1){let t,n=await sm.getRooms()||[];if(n.length){if(pm){let r=n.findIndex((e=>e.roomId===pm.roomId));t=-1!==r?r+e:0}else t=e;t=t<0?n.length-1:t,t%=n.length,pm=n[t]}else pm=null}hm.doAction=async function(e){let n,r;switch(e.action){case jh.M.actions.MATRIX_SEND_COLLECTED:if(await Pm.doARASAACGrammarCorrection(),n=Pm.getText(),r=await vm(),!Pm.hasCollectedImage())return void(n&&r&&await sm.sendMessage(r.roomId,n));(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SENDING_START);let i=await ue.M.getScreenshot(".collect-items-container",{scale:1,returnCanvas:!0});i&&r&&await sm.sendImage(r.roomId,i,n);break;case jh.M.actions.MATRIX_SEND_COLLECTED_TEXT:await Pm.doARASAACGrammarCorrection(),n=Pm.getText(),r=await vm(),n&&r&&await sm.sendMessage(r.roomId,n);break;case jh.M.actions.MATRIX_SEND_CUSTOM:let o=await vm();e.sendText&&o&&await sm.sendMessage(o.roomId,e.sendText);break;case jh.M.actions.MATRIX_NEXT_CONVERSATION:await mm(),(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SET_ROOM,[pm.roomId]);break;case jh.M.actions.MATRIX_PREV_CONVERSATION:await mm(-1),(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SET_ROOM,[pm.roomId]);break;case jh.M.actions.MATRIX_SET_CONVERSATION:let a=await sm.getRooms()||[];pm=a.find((t=>t.roomId===e.selectRoomId)),(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SET_ROOM,[e.selectRoomId]);break;case jh.M.actions.MATRIX_SCROLL_UP:(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SCROLL_UP,[e.scrollPx]);break;case jh.M.actions.MATRIX_SCROLL_DOWN:(0,t.A)(document).trigger(C.A.EVENT_MATRIX_SCROLL_DOWN,[e.scrollPx]);break;case jh.M.actions.MATRIX_SPEAK_LAST_MSG:if(r=await vm(),!r)return;let s=(await sm.getMessageEvents(r.roomId,0)).pop();s&&su.speak(s.textContent)}},hm.getCurrentRoom=function(){return pm};let gm={},fm=C.A.IS_ENVIRONMENT_PROD?C.A.BOARDS_REPO_BASE_URL+"live_predefined_actions.json":C.A.BOARDS_REPO_BASE_URL+"live_predefined_actions_beta.json",ym=C.A.IS_ENVIRONMENT_PROD?C.A.BOARDS_REPO_BASE_URL+"live_predefined_requests.json":C.A.BOARDS_REPO_BASE_URL+"live_predefined_requests_beta.json",_m={},Em=0,bm=null;async function Sm(e,t,r={}){switch((r=r||{}).actions=r.actions||[],t.modelName){case"GridActionSpeak":log.debug("action speak");let i=Md.getSpeakTextAllLangs(e.id),a=JSON.parse(JSON.stringify(e.label));Object.assign(a,i),e.type===O.V.ELEMENT_TYPE_PREDICTION&&(a[o.A.getContentLang()]=Ie.getLastAppliedPrediction()),e.type===O.V.ELEMENT_TYPE_LIVE&&(a[o.A.getContentLang()]=Tm.getLastValue(e.id)),su.speak(a,{lang:t.speakLanguage,speakSecondary:!0,minEqualPause:Em});break;case"GridActionSpeakCustom":if(log.debug("action speak custom"),t.speakText){let n=t.speakText;e.type===O.V.ELEMENT_TYPE_LIVE&&(n[o.A.getContentLang()]=Tm.replacePlaceholder(e,n[o.A.getContentLang()])),su.speak(n,{lang:t.speakLanguage,speakSecondary:!0,minEqualPause:Em})}break;case"GridActionAudio":t.dataBase64&&(Pc.stopAudio(),Pc.playAudio(t.dataBase64));break;case"GridActionWordForm":switch(t.type){case Pd.N.WORDFORM_MODE_CHANGE_ELEMENTS:Md.resetWordFormIds(e),Md.addWordFormTags(t.tags,t.toggle);break;case Pd.N.WORDFORM_MODE_CHANGE_BAR:Pm.addWordFormTagsToLast(t.tags);break;case Pd.N.WORDFORM_MODE_CHANGE_EVERYWHERE:Md.resetWordFormIds(e),Md.addWordFormTags(t.tags,t.toggle),Pm.addWordFormTagsToLast(t.tags);break;case Pd.N.WORDFORM_MODE_NEXT_FORM:let n=Md.nextWordForm(e.id);if(Pm.replaceLast(e,n),t.secondaryType){let i=Md.getWordFormObject(e,{wordFormId:n}).tags||[];if(i.length>0){Md.resetWordFormTags();let n=new Pd.N({type:t.secondaryType,tags:i});await Sm(e,n,r)}}break;case Pd.N.WORDFORM_MODE_RESET_FORMS:Md.resetWordForms(),Pm.fixateLastWordForm()}break;case"GridActionNavigate":t.navType===D.g.NAV_TYPES.TO_HOME?TA.toMain():t.navType===D.g.NAV_TYPES.TO_LAST?TA.toLastGrid():t.navType===D.g.NAV_TYPES.OPEN_SEARCH?fg.showSearchModal(t):TA.isOnEditPage()?TA.toEditGrid(t.toGridId):TA.toGrid(t.toGridId);break;case"GridActionARE":log.debug("action are"),r.gridData?Cm(t,r.gridData):xg.getGrid(r.gridId).then((e=>{Cm(t,e)}));break;case"GridActionOpenHAB":log.debug("action openHAB"),dh.sendAction(t);break;case"GridActionHTTP":return log.debug("action HTTP"),hh.doAction(t);case"GridActionPredict":log.debug("action predict"),Ie.predict(o.A.getTranslation(e.label),t.dictionaryKey);break;case"GridActionCollectElement":log.debug("action collect element"),Pm.doCollectElementActions(t.action);break;case"GridActionWebradio":Eh.doAction(r.gridId,t);break;case"GridActionYoutube":Pu.doAction(t);break;case"GridActionChangeLang":let s=t.language;t.language===xh.N.LAST_LANG&&(s=n.w.getUserSettings().lastContentLang||o.A.getContentLang()),await o.A.setContentLanguage(s);let l=n.w.getUserSettings().voiceConfig;l.preferredVoice=t.voice,n.w.saveUserSettings({voiceConfig:l});break;case"GridActionOpenWebpage":let c=window.open(t.openURL,"_blank");t.timeoutSeconds>0&&setTimeout((()=>{c.close()}),1e3*t.timeoutSeconds);break;case"GridActionUART":Dh.doAction(t);break;case"GridActionSystem":$h.doAction(t);break;case"GridActionPredefined":return function(e,t){t=JSON.parse(JSON.stringify(t));for(let e of Object.keys(t.actionInfo.presets||{}))for(let n of t.actionInfo.customValues||[])if(ee.Z.isString(t.actionInfo.presets[e])){let r=n.name,i=void 0!==t.customValues[r]?t.customValues[r]:"",o=new RegExp(`\\$\\{${r}\\}`,"g");t.actionInfo.presets[e]=t.actionInfo.presets[e].replace(o,i)}let n=O.V.getActionInstance(t.actionInfo.actionModelName);if(n)return Object.assign(n,t.actionInfo.presets),Sm(e,n)}(e,t);case"GridActionMatrix":await hm.doAction(t)}}function Cm(e,t){if(!e.componentId)return;let n=t.getAdditionalFile(e.areModelGridFileName).dataBase64;kc.uploadAndStartModel(n,e.areURL,e.areModelGridFileName).then((()=>{e.dataPortId&&e.dataPortSendData&&kc.sendDataToInputPort(e.componentId,e.dataPortId,e.dataPortSendData,e.areURL),e.eventPortId&&kc.triggerEvent(e.componentId,e.eventPortId,e.areURL)}))}async function wm(){bm=await xg.getMetadata(),Em=bm.inputConfig.globalMinPauseCollectSpeak||0}async function Am(e){if(_m[e])return _m[e];try{let t=await fetch(e);return _m[e]=await t.json(),_m[e].sort(((e,t)=>e.name.localeCompare(t.name))),_m[e]}catch(e){return log.warn("failed to fetch predefined action/request infos."),[]}}gm.doAction=async function(e,n){if(!e||!n)return;let r=e.gridElements?e:await xg.getGrid(e,!1,!0),i=JSON.parse(JSON.stringify(r.gridElements.find((e=>e.id===n))));log.debug("do actions for: "+o.A.getTranslation(i.label)+", "+n),i.type===O.V.ELEMENT_TYPE_PREDICTION&&Ie.doAction(i.id),async function(e,n){let r=e.actions;r.sort(((e,t)=>e.modelName===xh.N.getModelName()&&t.modelName===D.g.getModelName()?-1:t.modelName===xh.N.getModelName()&&e.modelName===D.g.getModelName()?1:e.modelName===Gh.u.getModelName()?-1:0)),r.some((e=>e.modelName===zu.T.getModelName()&&e.dataBase64))&&(r=r.filter((e=>e.modelName!==k.v.getModelName()&&e.modelName!==I.m.getModelName()))),(0,t.A)(window).trigger(C.A.ELEMENT_EVENT_ID,[e]);for(let t of r)await Sm(e,t,{gridId:n,actions:r});bm=bm||await xg.getMetadata();let i=r.map((e=>e.modelName)),o=[zu.T.getModelName(),xh.N.getModelName(),k.v.getModelName(),I.m.getModelName()],a=O.V.getActionTypeModelNames().filter((e=>!o.includes(e)));!bm.toHomeAfterSelect||Pm.isCurrentGridKeyboard()||Md.hasGlobalGridElement(e.id)||i.some((e=>a.includes(e)))||TA.toMain(),i.includes(Pd.N.getModelName())||Md.resetWordForms();let s=[Lu.a.getModelName(),mh.o.getModelName(),Gh.u.getModelName()];i.some((e=>s.includes(e)))&&Tm.updateOnce({updateModes:[ch.MODE_APP_STATE]})}(i,r.id)},gm.testAction=function(e,t,n={}){return Sm(e,t,{gridId:n.id,gridData:n})},gm.getPredefinedActionInfos=async function(){return Am(fm)},gm.getPredefinedRequestInfos=async function(){return Am(ym)},(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,wm),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,wm);let Tm={},Im=[],km=null,Om={},Rm={};function xm(e={}){e.once||clearTimeout(km);let t=(e.elements||Im).filter((t=>t.type===O.V.ELEMENT_TYPE_LIVE&&(!e.updateModes||e.updateModes.includes(t.mode))));for(let n of t)Tm.getCurrentValue(n,e).then((e=>{Lm(n,e)}));e.once||(km=setTimeout(xm,1e3))}function Nm(e,t){return(new Date).toLocaleDateString(o.A.getContentLang(),t)}function Dm(e,t){return(new Date).toLocaleTimeString(o.A.getContentLang(),t)}function Lm(e,n){n+="",Rm[e.id]!==n&&((0,t.A)(document).trigger(C.A.EVENT_ELEM_TEXT_CHANGED,[e.id,n]),Rm[e.id]=n)}Tm.initWithElements=function(e,t={}){Tm.stop(),e.forEach((e=>{e&&e.type===O.V.ELEMENT_TYPE_LIVE&&Im.push(JSON.parse(JSON.stringify(e)))})),Im.length>0&&xm(t)},Tm.updateOnce=function(e={}){e.once=void 0===e.once||e.once,xm(e)},Tm.stop=function(){clearTimeout(km),Im=[],Rm={},Om={}},Tm.getLastValue=function(e){return Rm[e]||""},Tm.getCurrentValue=async function(e,t={}){(t=JSON.parse(JSON.stringify(t))).forceUpdate=t.forceUpdate||[ch.MODE_DATETIME,ch.MODE_APP_STATE].includes(e.mode);let r=1e3*(e.updateSeconds||0),i=!t.forceUpdate&&Om[e.id]&&(new Date).getTime()-Om[e.id]<r,a=!t.forceUpdate&&!e.updateSeconds;if(void 0!==Rm[e.id]&&(i||a))return Rm[e.id];Om[e.id]=(new Date).getTime();let s="";switch(e.mode){case ch.MODE_DATETIME:s=function(e){switch(e.dateTimeFormat){case ch.DT_FORMAT_DATE:return Nm();case ch.DT_FORMAT_DATE_LONG:return Nm(0,{weekday:"long",month:"long",day:"numeric",year:"numeric"});case ch.DT_FORMAT_TIME:return Dm(0,{hour:"numeric",minute:"numeric"});case ch.DT_FORMAT_TIME_LONG:return Dm(0,{hour:"numeric",minute:"numeric",second:"numeric"});case ch.DT_FORMAT_DATETIME:return Nm(0,{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});case ch.DT_FORMAT_WEEKDAY:return Nm(0,{weekday:"long"});case ch.DT_FORMAT_MONTH:return Nm(0,{month:"long"})}return""}(e);break;case ch.MODE_APP_STATE:s=await async function(e){let t=n.w.getUserSettings();switch(e.appState){case ch.APP_STATE_VOLUME_GLOBAL:return t.systemVolumeMuted?o.A.t("mutedBracket"):t.systemVolume;case ch.APP_STATE_VOLUME_YT:return t.ytState.muted?o.A.t("mutedBracket"):t.ytState.volume;case ch.APP_STATE_VOLUME_RADIO:return Math.round(100*parseFloat(n.w.get(C.A.WEBRADIO_LAST_VOLUME_KEY)||1));case ch.APP_STATE_BATTERY_LEVEL:return navigator.getBattery?100*(await navigator.getBattery()).level:(log.warn("navigator.getBattery not supported!"),"?")}return""}(e);break;case ch.MODE_ACTION_RESULT:s=await async function(e){let t=await gm.testAction(e,e.liveAction);switch(e.extractMode){case ch.EXTRACT_JSON:return function(e,t){let n=(e.extractSelector||"").split("."),r=null;try{r=JSON.parse(t)}catch(e){return""}for(;n.length>0;){let e=n.shift();r=void 0!==r[e]?r[e]:r}let i=void 0===r?"":r;return i=i!==Object(i)?i:JSON.stringify(i),i+""}(e,t);case ch.EXTRACT_HTML_SELECTOR:return function(e,t){let n=e.extractSelector||"",r=isNaN(parseInt(e.extractIndex))?null:parseInt(e.extractIndex);const i=new DOMParser;try{const e=i.parseFromString(t,"text/html"),o=n?e.querySelectorAll(n):[e.documentElement];let a="";for(let e=0;e<o.length;e++)null!==r&&e!==r||(a+=o[e].textContent.replace(/\s+/g," ").trim()+"\n");return a}catch(e){log.warn("failed to parse HTML",e)}return""}(e,t)}return""}(e);break;case ch.MODE_RANDOM:s=function(e){let t=(e.chooseValues||"").split(";");return t[ee.Z.getRandomInt(0,t.length-1)]}(e)}e.extractMappings&&e.extractMappings[s]&&(s=e.extractMappings[s]),s=o.A.tPredefined(s);let l=o.A.getTranslation(e.label)||"";return Tm.replacePlaceholder(e,l,s)},Tm.replacePlaceholder=function(e,t="",n){return(n=void 0!==n?n:Tm.getLastValue(e.id))?(t.includes("{0}")?t=t.replace("{0}",n):t+=n,t):t};let Pm={},Mm=[],Um=[],Fm=null,Bm=0,Gm=null,$m=!0,Vm=R.$.MODE_AUTO,jm=!0,Km=null,Wm=!1,qm=0,Hm=null,Ym=0,zm=new V.X,Jm=null;function Xm(){Um=[],Zm()}function Qm(e,t){if(!e)return null;let n=e.actions.map((e=>e.modelName)).indexOf(t);return-1===n?null:e.actions[n]}async function Zm(e){$m=Um.some((e=>!!ig(e)));let n=Jm||new d.e;for(let r of Mm){n.colorConfig.gridBackgroundColor;let i=eg(r.mode),a=(0,t.A)(`#${r.id} .collect-outer-container`),s=n.colorConfig.elementBackgroundColor===C.A.DEFAULT_ELEMENT_BACKGROUND_COLOR_DARK,l=s?C.A.DEFAULT_COLLECT_ELEMENT_BACKGROUND_COLOR_DARK:C.A.DEFAULT_COLLECT_ELEMENT_BACKGROUND_COLOR,c=s?C.A.DEFAULT_ELEMENT_FONT_COLOR_DARK:C.A.DEFAULT_ELEMENT_FONT_COLOR;if(i){(0,t.A)(`#${r.id}`).attr("aria-label",`${ag()}, ${o.A.t("ELEMENT_TYPE_COLLECT")}`);let n="",i=(0,t.A)(`#${r.id} .collect-container`).prop("clientHeight")||a.prop("clientHeight"),d=a.width(),u=d<400?2:d<700?3:5,h=r.showLabels,p=.85,v=r.imageHeightPercentage/100,m=r.singleLine,g=Um.length,f=h?i*v:i,y=[];for(const e of Um){let t=ig(e);if(t)if(e.image.searchProviderName)y.push(1);else if(zm.has(t))y.push(zm.get(t));else{let e=await ue.M.getImageDimensionsFromDataUrl(t);y.push(e.ratio),zm.set(t,e.ratio)}}let _=Math.max(...y)||1,E=Math.floor(d/(f*_)),b=1;for(;E<g&&!m;)b++,E=Math.floor(d/(f*_/b))*b;f/=b;let S=f-2*u,C=i/b-f,w=C*p,A=0;for(const[e,t]of Um.entries()){let i=lg(t),o=ig(t),l=S*y[e]||S;if(r.showFullLabels){let e=xu.getTextWidth(i,a[0],`${w}px`);l=Math.max(l,e+2*u)}let d=Fm===e,p=null;if(o)p=`<img src="${o}" height="${S}" style="height: ${S}px"/>`,A+=l+2*u;else{let e=w*(r.textElemSizeFactor||1.5);l=xu.getTextWidth(i,a[0],`${e}px`)+2*u,A+=l+4*u,p=`<div style="padding: ${u}px; font-size: ${e}px; width: ${l}px; height: ${S}px; display: flex; justify-content: center; align-items: center; text-align: center;"><span>${i}</span></div>`}n+=`<div id="collect${e}" style="display: flex; flex:0; justify-content: center; flex-direction: column; padding: ${u}px; color: ${c}; ${d?`background-color: ${s?"darkgreen":"lightgreen"};`:""}" title="${i}">\n                                <div style="display:flex; justify-content: center">\n                                        ${p}\n                                </div>\n                                <div style="text-align: center; font-weight: bold; font-size: ${w}px; line-height: ${C}px; height: ${C}px; width: ${l}px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; ${h?"":"display: none"}">\n                                    ${o?i:""}\n                                </div>\n                             </div>`}if(n=`<div class="collect-container" dir="auto" style="height: 100%; flex: 1; display: flex; flex-direction: row; background-color: ${l}; text-align: justify; ${m?"overflow-x: auto; overflow-y: hidden;":"flex-wrap: wrap;"}">\n                        <div class="collect-items-container" style="display: flex; flex-direction: row; ">${n}</div>\n                    </div>`,a.html(n),m){let n=null!==Fm?_*S*Fm:_*S*g;(0,t.A)(`#${r.id} .collect-container`).scrollLeft(n),A>d&&!e&&Zm(!0)}}else{let e=ag();(0,t.A)(`#${r.id}`).attr("aria-label",`${e}, ${o.A.t("ELEMENT_TYPE_COLLECT")}`),Ie.learnFromInput(e,Gm);let n=`<span style="padding: 5px; display: flex; align-items: center; flex: 1; text-align: left; font-weight: bold;">\n                            ${e}\n                        </span>`;a.html(n=`<div class="collect-container" dir="auto" style="height: 100%; flex: 1; background-color: ${l}; text-align: justify;">${n}</div>`),xu.adaptFontSize((0,t.A)(`#${r.id}`))}}}function eg(e){switch(e){case R.$.MODE_COLLECT_SEPARATED:return!0;case R.$.MODE_COLLECT_TEXT:return!1}return $m}function tg(){return Um.slice(-1)[0]}function ng(e){return e&&o.A.getTranslation(e.label)||""}function rg(e,t){e&&e.label&&(e.label[o.A.getContentLang()]=t)}function ig(e){return e.image?e.image.data||e.image.url:null}function og(e,t){t=t||{};let n=e.actions.filter((e=>e.modelName===zu.T.getModelName()))[0];if(n&&!t.dontIncludeAudio&&n.dataBase64)return{base64Sound:n.dataBase64};let r=t.inlcudeCorrectedGrammar?e.fixedGrammarText:null,i=e.actions.filter((e=>e.modelName===I.m.getModelName()))[0];if(!r&&i){let e=i.speakLanguage||o.A.getContentLang();r=o.A.getTranslation(i.speakText,{lang:e})}if(!r){let n=Md.getWordFormObject(e,{searchTags:e.wordFormTags,wordFormId:e.wordFormId,searchSubTags:!0})||{};t.dontIncludePronunciation||(r=n.pronunciation),r=r||n.value}return r||(r=ng(e)),r=ee.Z.convertLowerUppercase(r,Km),{text:r}}function ag(e){(e=e||{}).trim=void 0===e.trim||e.trim,e.dontIncludeAudio=!0,e.dontIncludePronunciation=void 0===e.dontIncludePronunciation||e.dontIncludePronunciation,e.inlcudeCorrectedGrammar=void 0===e.inlcudeCorrectedGrammar||e.inlcudeCorrectedGrammar;let t=Um.map((t=>og(t,e).text));return(e.trim?t.join(" ").trim():t.join(" ")).replace(/\s+/g," ")}function sg(){return ag({trim:!1})}function lg(e){let t=og(e,{dontIncludePronunciation:!0,dontIncludeAudio:!0,inlcudeCorrectedGrammar:!0});return t&&t.text?t.text:""}function cg(e){let t=new O.V({label:o.A.getTranslationObject(e)});t.onlyText=!0,Um.push(t)}function dg(){Mm.forEach((e=>{let t=Qm(e,"GridActionPredict");t&&t.suggestOnChange&&Ie.predict(sg(),Gm)}))}async function ug(){Jm=await xg.getMetadata(),qm=Jm.inputConfig.globalMinPauseCollectSpeak||0,Km=Jm.textConfig.convertMode,Wm=Jm.activateARASAACGrammarAPI}Pm.getText=function(){return ag()},Pm.initWithGrid=function(e,t){Mm=[];let n=0,r=0;Gm=null,e.gridElements.forEach((e=>{if(e&&e.type===O.V.ELEMENT_TYPE_NORMAL){r++;let t=o.A.getTranslation(e.label);t&&1===t.length&&n++}if(e&&e.type===O.V.ELEMENT_TYPE_COLLECT){let t=JSON.parse(JSON.stringify(e));Gm=Gm||t.actions.reduce(((e,t)=>{let n=N.G.getModelName()?t.dictionaryKey:null;return e||n}),null),Vm=t.mode||Vm,jm=!1!==t.convertToLowercase,Mm.push(t)}})),Bm=e.keyboardMode?e.keyboardMode===c.D.KEYBOARD_DISABLED?0:1:n/r,Mm.length>0&&(Zm(),t||Ie.predict(sg(),Gm))},Pm.clearCollectElements=function(){(0,t.A)(".collect-container").empty()},Pm.doARASAACGrammarCorrection=async function(){if(Wm){let e=ag({inlcudeCorrectedGrammar:!1});e=await Ju.getCorrectGrammar(e),async function(e){let t=!1,n=ag({inlcudeCorrectedGrammar:!1});if(n===e)return!1;let r=n.split(" "),i=e.split(" ");if(r.length!==i.length)return!1;for(let e of Um){let n=lg(e).trim().replace(/\s+/g," "),r=n.split(" ").length,o=i.slice(0,r).join(" ");i=i.slice(r),o!==n&&(e.fixedGrammarText=o,t=!0)}return t}(e)&&await Zm()}},Pm.doCollectElementActions=async function(e){if(!e)return;x.z.isSpeakAction(e)&&await Pm.doARASAACGrammarCorrection();let t=ag({dontIncludePronunciation:!1}),n=function(e){return(e=e||{}).inlcudeCorrectedGrammar=void 0===e.inlcudeCorrectedGrammar||e.inlcudeCorrectedGrammar,Um.map((t=>og(t,e)))}();switch(e){case x.z.COLLECT_ACTION_SPEAK:eg(Vm)?su.speakArray(n,(e=>{Fm=e,Zm()})):su.speak(t);break;case x.z.COLLECT_ACTION_SPEAK_CONTINUOUS:su.speak(t);break;case x.z.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR:su.speak(t),await su.waitForFinishedSpeaking(),Xm();break;case x.z.COLLECT_ACTION_SPEAK_CLEAR:eg(Vm)?su.speakArray(n,((e,t)=>{Fm=e,Zm(),t&&Xm()})):(su.speak(t),su.doAfterFinishedSpeaking((()=>{Xm()})));break;case x.z.COLLECT_ACTION_CLEAR:Xm(),su.stopSpeaking();break;case x.z.COLLECT_ACTION_REMOVE_WORD:let e=tg(),r=!1;if(e&&e.onlyText){let t=(ng(e).trim()||"").split(" ");t.pop();let n=t.join(" ");n?(r=!0,rg(e,n+" ")):r=Um.pop()}else r=Um.pop();r&&Zm(),su.stopSpeaking();break;case x.z.COLLECT_ACTION_REMOVE_CHAR:let i=tg();if(i&&i.onlyText){let e=ng(i);e=e.slice(0,-1),e?rg(i,e):Um.pop()}else Um.pop();Zm();break;case x.z.COLLECT_ACTION_SHARE:{let e=await ee.Z.getCollectContentBlob();await ee.Z.shareImageBlob(e,Pm.getText());break}case x.z.COLLECT_ACTION_COPY_IMAGE_CLIPBOARD:await ee.Z.copyCollectContentToClipboard();break;case x.z.COLLECT_ACTION_COPY_CLIPBOARD:ee.Z.copyToClipboard(ag());break;case x.z.COLLECT_ACTION_APPEND_CLIPBOARD:ee.Z.appendToClipboard(ag());break;case x.z.COLLECT_ACTION_CLEAR_CLIPBOARD:ee.Z.copyToClipboard("");break;case x.z.COLLECT_ACTION_TO_YOUTUBE:Pu.setActionAfterNavigate(new Lu.a({action:Lu.a.actions.YT_PLAY,playType:Lu.a.playTypes.YT_PLAY_SEARCH,data:ag()}))}Ie.predict(sg(),Gm)},Pm.addWordFormTagsToLast=function(e,t){let n=Um[Um.length-1];if(n&&!n.wordFormFixated){let r=JSON.parse(JSON.stringify(n));r.wordFormTags=r.wordFormTags||[];let i=lg(r);r.wordFormTags=Md.mergeTags(r.wordFormTags,e,t);let o=Md.getWordForm(r,{searchTags:r.wordFormTags,searchSubTags:!0});o&&o!==i&&(Um[Um.length-1]=r,Zm())}},Pm.replaceLast=function(e,t){e=JSON.parse(JSON.stringify(e));let n=Um[Um.length-1];n&&n.id===e.id&&Um.pop(),e.wordFormId=t,Um.push(e),Zm()},Pm.fixateLastWordForm=function(){let e=Um[Um.length-1];e&&(e.wordFormFixated=!0)},Pm.isCurrentGridKeyboard=function(){return Bm>.4},Pm.hasCollectedImage=function(){return Um.some((e=>!!ig(e)))},(0,t.A)(window).on(C.A.ELEMENT_EVENT_ID,(function(e,t){if(Hm===t.id&&(new Date).getTime()-Ym<qm)return;if(Hm=t.id,Ym=(new Date).getTime(),t.type===O.V.ELEMENT_TYPE_COLLECT)return;let n=[k.v.getModelName(),I.m.getModelName(),D.g.getModelName(),zu.T.getModelName(),Pd.N.getModelName()],r=O.V.getActionTypeModelNames().filter((e=>!n.includes(e)));if((i=t,i.actions.map((e=>e.modelName))).some((e=>r.includes(e))))return;var i;let o=Qm(t,D.g.getModelName());if(o&&1!==ng(t).length&&!o.addToCollectElem)return;let a=function(e,t){return e?e.actions.filter((e=>e.modelName===t)):[]}(t,Pd.N.getModelName());if(!(a.length>0&&a.some((e=>e.type===Pd.N.WORDFORM_MODE_NEXT_FORM))||t.dontCollect)){if(t.toggleInBar){let e=tg();if(e&&e.id===t.id)return Um.pop(),void Zm()}if(t.type===O.V.ELEMENT_TYPE_NORMAL){t.wordFormTags=Md.getCurrentWordFormTags();let e=ng(t),n=lg(t),r=ig(t);if(e&&Pm.isCurrentGridKeyboard()){jm&&(e=e.toLowerCase());let t=tg();t&&t.onlyText?rg(t,ng(t)+e):cg(e)}else(e||r||n)&&Um.push(t);dg()}else if(t.type===O.V.ELEMENT_TYPE_PREDICTION){let e=Ie.getCurrentValue(t.id);if(e){Ie.applyPrediction(ag(),e,Gm);let t=tg(),n=ng(t),r=n?n.split(" ").pop():"";if(t&&t.onlyText&&e.toLowerCase().startsWith(r.toLowerCase())){let r=n.split(" ");r[r.length-1]=e,rg(t,r.join(" ")+" ")}else cg(e+" ");dg()}}else t.type===O.V.ELEMENT_TYPE_LIVE&&cg(Tm.getLastValue(t.id)+" ");Zm()}})),(0,t.A)(window).on(C.A.EVENT_GRID_RESIZE,(function(){setTimeout(Zm,500)})),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,Xm),(0,t.A)(document).on(C.A.EVENT_CONFIG_RESET,Xm),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,ug),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,ug),(0,t.A)(document).on(C.A.EVENT_USERSETTINGS_UPDATED,(()=>{Zm()}));const hg={props:["routeToEdit","options"],components:{},data:function(){return{grids:null,initPromise:null,searchTerm:"",results:void 0,graphList:[],homeGridId:null,i18nService:o.A,idPathMap:null,overflow:!1,MAX_RESULTS:10}},methods:{toResult(e,t){if(this.routeToEdit)TA.toEditGrid(e.grid.id,e.elem.id);else{let n=[e.elem.id],r=e.grid.id;t&&e.path.length>1&&(r=e.path[0].id,n=e.path.map((e=>e.toNextElementId)),n[n.length-1]=e.elem.id),TA.toGrid(r,{highlightIds:n})}this.close()},highlightSearch(e){let t=e.toLocaleLowerCase().indexOf(this.searchTerm.toLocaleLowerCase()),n=e.substring(t,t+this.searchTerm.length);return e.replace(n,`<b>${n}</b>`)},goToFirstResult(e){this.results&&this.results.length>0&&this.toResult(this.results[0],e)},async search(e){let t=this;ee.Z.debounce((async()=>{if(t.overflow=!1,!e&&t.searchTerm.length<2)return void(t.results=void 0);if(t.results=null,t.$forceUpdate(),await new Promise((e=>setTimeout(e,10))),await t.initPromise,!t.searchTerm)return void(t.results=[]);let n=[],r=t.homeGridId||t.graphList[0].grid.id,i=t.graphList.filter((e=>e.grid.id===r))[0];t.idPathMap||(t.idPathMap=Ge.b.getIdPathMap(i));for(let e of t.grids)for(let t of e.gridElements){let n=Object.entries(t.label).filter((([e,t])=>!!t)),r=!1;for(let[i,o]of n){let n=a(o);!r&&n>0&&(r=!0,s(e,t,o,i,n))}}function a(e){return(e=e.toLocaleLowerCase()).startsWith(t.searchTerm.toLocaleLowerCase())?1:e.includes(t.searchTerm.toLocaleLowerCase())?2:-1}function s(e,i,o,a,s){n.push({grid:e,elem:i,matchLabel:o,matchLang:a,priority:s,path:Ge.b.getGridPath(t.graphList,r,e.id,t.idPathMap)})}n.sort(((e,t)=>{if(e.matchLang!==t.matchLang){if(e.matchLang===o.A.getContentLang())return-1;if(t.matchLang===o.A.getContentLang())return 1}return e.path.length!==t.path.length?0===e.path.length?1:0===t.path.length?-1:e.path.length-t.path.length:e.priority-t.priority})),n.length>t.MAX_RESULTS&&(n=n.slice(0,t.MAX_RESULTS-1),t.overflow=!0),t.results=n}),300,"SEARCH_ELEMENTS")},close(){this.$emit("close")}},async mounted(){this.initPromise=new Promise((async e=>{this.grids=await xg.getGrids(!0,!0),this.graphList=Ge.b.getGraphList(this.grids);let t=await xg.getMetadata();this.homeGridId=t.homeGridId,e()})),this.options&&(this.searchTerm=this.options.searchCollectedText?Pm.getText():this.options.searchText||"",this.searchTerm&&this.search(!0)),$(".grid-item-content").removeClass("highlight")},beforeDestroy(){}},pg=hg;var vg=s(4690),mg={};mg.styleTagTransform=Ed(),mg.setAttributes=gd(),mg.insert=vd().bind(null,"head"),mg.domAPI=hd(),mg.insertStyleElement=yd(),dd()(vg.A,mg),vg.A&&vg.A.locals&&vg.A.locals;const gg=Cd(pg,Ld,[],!1,null,"7244f760",null).exports;let fg={},yg=null,_g={MODAL_SEARCH:"MODAL_SEARCH",MODAL_PROGRESSBAR:"MODAL_PROGRESSBAR"};fg.setViewComponent=function(e,t){yg&&yg.$refs.notificationBar.tooltipOptions.closeOnNavigate&&fg.clearTooltip(),yg.setComponent(e,t)},fg.isSidebarOpen=function(){return yg.showSidebar},fg.setTooltip=function(e,t){if(yg){if(!yg.uiLocked)return yg.$refs.notificationBar.setTooltip(e,t);yg.hiddenPopupData={html:e,options:t}}},fg.setTooltipI18n=function(e,t){fg.setTooltip(e,t)},fg.clearTooltip=function(){yg&&(yg.hiddenPopupData=null,yg.$refs.notificationBar.clearTooltip())},fg.showProgressBar=function(e,t){yg&&(yg.showModal=_g.MODAL_PROGRESSBAR,yg.$refs.progressBar.setProgress(e,t))},fg.showSearchModal=function(e){yg.showModal=_g.MODAL_SEARCH,yg.modalOptions=e||{}},fg.init=function(){return Mi.use(Tc.A),o.A.getVueI18n().then((e=>(yg=new Mi({i18n:e,el:"#app",components:{NotificationBar:wd,ProgressBarModal:Dd,SearchModal:gg},data:()=>({component:null,properties:null,componentKey:0,showSidebar:!1,currentUser:te.getCurrentUsedDatabase(),isLocalUser:n.w.isSavedLocalUser(te.getCurrentUsedDatabase()),syncState:xg.getSyncState(),constants:C.A,tooltipHTML:null,actionLink:null,Router:TA,uiLocked:!1,hiddenPopupData:null,modalTypes:_g,showModal:null,modalOptions:{}}),methods:{setComponent(e,t){this.component=e,this.properties=t,this.componentKey++},closeSidebar(){(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_CLOSE)},openSidebar(){(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPEN)},openHelp(){Qc.openHelp()},moreNavigation(){t.A.contextMenu("destroy"),function(){let e={CONTEXT_ADD_ONLINE:{name:o.A.t("addOnlineUser"),icon:"fas fa-user-plus"},CONTEXT_ADD_OFFLINE:{name:o.A.t("addOfflineUser"),icon:"fas fa-user-plus"},CONTEXT_ABOUT:{name:o.A.t("aboutAstericsGrid"),icon:"fas fa-info-circle"}};t.A.contextMenu({selector:"#moreNavigation",callback:function(e,t){!function(e){switch(e){case"CONTEXT_ADD_ONLINE":TA.toRegister();break;case"CONTEXT_ADD_OFFLINE":TA.toAddOffline();break;case"CONTEXT_ABOUT":TA.toAbout()}}(e)},items:e,trigger:"left",zIndex:10})}(),(0,t.A)("#moreNavigation").contextMenu()},toMain(){TA.toMain()}},mounted(){let e=this;async function r(){await $h.exitFullscreen(),e.openSidebar()}(0,t.A)(document).on(C.A.EVENT_SIDEBAR_OPEN,(()=>{if(!e.showSidebar)return te.getCurrentUsedDatabase()?void xg.getMetadata().then((n=>{n.locked||n.fullscreen||(e.showSidebar=!0,this.$nextTick((()=>{(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPENED),(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE)})))})):(e.showSidebar=!0,void this.$nextTick((()=>{(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPENED),(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE)})))})),(0,t.A)(document).on(C.A.EVENT_SIDEBAR_CLOSE,(()=>{e.showSidebar=!1,this.$nextTick((()=>{(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE)}))})),(0,t.A)(document).on(C.A.EVENT_DB_INITIALIZED,(()=>{e.currentUser=te.getCurrentUsedDatabase(),e.isLocalUser=n.w.isSavedLocalUser(e.currentUser)})),(0,t.A)(document).on(C.A.EVENT_DB_CLOSED,(()=>{e.currentUser=te.getCurrentUsedDatabase(),e.isLocalUser=n.w.isSavedLocalUser(e.currentUser)})),(0,t.A)(document).on(C.A.EVENT_DB_SYNC_STATE_CHANGE,((t,n)=>{e.syncState=n})),(0,t.A)(document).on(C.A.EVENT_GRID_IMAGES_CACHING,(()=>{e.syncState=C.A.DB_SYNC_STATE_SYNCINC})),(0,t.A)(document).on(C.A.EVENT_GRID_IMAGES_CACHED,(()=>{e.syncState=xg.getSyncState()})),(0,t.A)(document).on(C.A.EVENT_UI_UNLOCKED,(()=>{this.uiLocked=!1,this.hiddenPopupData&&(fg.setTooltip(this.hiddenPopupData.html,this.hiddenPopupData.options),this.hiddenPopupData=null)})),(0,t.A)(document).on(C.A.EVENT_UI_LOCKED,(()=>{this.uiLocked=!0,fg.clearTooltip()})),e.syncState=xg.getSyncState(),window.addEventListener("resize",(()=>{ee.Z.debounce((function(){(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE)}),300,C.A.EVENT_GRID_RESIZE)})),Hc.global.onSwipedDown(r).onEscape(r).onExitFullscreen(r),Hc.global.startListening(),e.openSidebar()}}),Promise.resolve())))};class Eg{constructor(e,t={baseUrl:"",githubEditable:!1,githubBaseUrl:""}){if(e.images=e.images||[],this.name=e.name,this.url=t.baseUrl+e.url,t.githubEditable){let n=t.githubBaseUrl+e.url;this.githubUrl=n.substring(0,n.lastIndexOf("/"))}this.filename=e.url.substring(e.url.lastIndexOf("/")+1),this.selfContained=e.selfContained,this.author=e.author,this.website=e.website,this.languages=e.languages||[],this.description=e.description,this.wordPrediction=e.wordPrediction,this.translate=e.translate,this.images=e.images.map((e=>t.baseUrl+e)),this.thumbnail=e.thumbnail?t.baseUrl+e.thumbnail:void 0,this.tags=e.tags||[],this.generateGlobalGrid=e.generateGlobalGrid||!1,this.pdf=e.pdf,this.priority=e.priority||0}}let bg={},Sg="https://asterics.github.io/AsTeRICS-Grid-Boards/",Cg=C.A.IS_ENVIRONMENT_PROD?Sg+"live_metadata.json":Sg+"live_metadata_beta.json",wg=[],Ag=new Map,Tg={},Ig=null,kg=new Promise((e=>{Ig=e}));function Og(e,t){return e.sort(((e,n)=>{let r=Number.isInteger(e.priority)?e.priority:e.priority[t.lang]||0,i=Number.isInteger(n.priority)?n.priority:n.priority[t.lang]||0;if(r!==i)return i-r;let a=ee.Z.isString(e.name)?e.name:o.A.getTranslation(e.name),s=ee.Z.isString(n.name)?n.name:o.A.getTranslation(n.name);return a.localeCompare(s)})),e}function Rg(e){if(Tg[e])return Tg[e];{let t=o.A.t(e).toLocaleLowerCase();return Tg[e]=t,t}}bg.query=async function(e="",t={}){await kg;let n=wg;if(t.lang&&(n=n.filter((e=>e.languages.includes(t.lang)||e.translate))),t.type===C.A.BOARD_TYPE_SELFCONTAINED&&(n=n.filter((e=>e.selfContained))),t.type===C.A.BOARD_TYPE_SINGLE&&(n=n.filter((e=>!e.selfContained))),!e)return Og(n,t);let r=(e=e.replace(/\s+/g," ")).toLocaleLowerCase().split(" ");for(let e of r)n=n.filter((t=>Ag.get(t).some((t=>t.includes(e)))));return Og(n,t)},bg.getPreview=function(e){return wg.find((t=>t.filename===e))},async function(){try{await async function(){let e=await fetch(Cg),t=await e.json();wg=t.map((e=>new Eg(e,{baseUrl:Sg,githubEditable:!0,githubBaseUrl:"https://github.com/asterics/AsTeRICS-Grid-Boards/tree/main/"}))),Ag=new Map;for(let e of wg){e.translate&&(e.name=o.A.t(e.name),e.description=o.A.t(e.description));let t=[];ee.Z.isString(e.name)?t.push(e.name.toLocaleLowerCase()):t.push(o.A.getTranslation(e.name).toLocaleLowerCase());for(let n of e.tags)t.push(Rg(`tag.${n}`));Ag.set(e,t)}}(),Ig()}catch(e){log.warn(e)}}();let xg={};function Ng(e){return xg.getMetadata().then((t=>(t.globalGridId=e,t.globalGridActive=!!e,xg.saveMetadata(t))))}xg.getGrid=async function(e,t=!1,n=!1){return e?te.getSingleObject(c.D,e,t).then((e=>(e=n?e?Ge.b.ensureDefaults(e):null:e?new c.D(e):null,Promise.resolve(e)))):Promise.resolve(null)},xg.getGlobalGrid=function(e){return xg.getMetadata().then((t=>t.globalGridId&&(e||t.globalGridActive)?xg.getGrid(t.globalGridId).then((e=>Promise.resolve(e))):Promise.resolve(null)))},xg.getGrids=function(e,t){return new Promise((n=>{te.getObject(c.D,null,!e).then((e=>{if(!e)return void n([]);let r=e instanceof Array?e:[e];t?xg.getMetadata().then((e=>{n(r.filter((t=>t&&t.id!==e.globalGridId)))})):n(r.filter((e=>!!e)))}))}))},xg.getLastGridUpdateTime=async function(){let e=await xg.getGrids(!1,!1);if(0===e.length)return;let t=e.map((e=>e.lastUpdateTime)).filter((e=>Number.isInteger(e)));return t.length>0?Math.max(...t):0},xg.saveGrid=function(e){return(e=JSON.parse(JSON.stringify(e))).gridElements=Ge.b.sortGridElements(e.gridElements),e.lastUpdateTime=(new Date).getTime(),te.saveObject(c.D,e)},xg.saveGrids=function(e){return e.forEach((e=>{e.gridElements=Ge.b.sortGridElements(e.gridElements),e.lastUpdateTime=(new Date).getTime()})),te.bulkSave(e)},xg.updateGrid=function(e,t){return t.id=e,t.gridElements=Ge.b.sortGridElements(t.gridElements),t.lastUpdateTime=(new Date).getTime(),te.saveObject(c.D,t,!0)},xg.deleteGrid=function(e){return te.removeObject(e)},xg.deleteAllGrids=function(){return(0,t.A)(document).trigger(C.A.EVENT_CONFIG_RESET),xg.getGrids().then((e=>e&&0!==e.length?te.bulkDelete(e):Promise.resolve())).then((()=>(n.w.saveUserSettings({originGridsetFilename:"",isEmpty:!0},n.w.getAutologinUser()),Ng(""))))},xg.deleteAllDictionaries=async function(){let e=await xg.getDictionaries();e&&e.length>0&&await te.bulkDelete(e)},xg.getGridElement=function(e,t){return new Promise((n=>{xg.getGrid(e).then((e=>{let r=e.gridElements.filter((e=>e.id===t))[0];r?n(r):xg.getGlobalGrid().then((e=>{n(e.gridElements.filter((e=>e.id===t))[0])}))}))}))},xg.addGridElements=function(e,t){return new Promise((n=>{xg.getGrid(e).then((r=>{(r=JSON.parse(JSON.stringify(r))).gridElements=r.gridElements.concat(t),xg.updateGrid(e,r).then((()=>{n()}))}))}))},xg.saveMetadata=async function(e){e=JSON.parse(JSON.stringify(e));let r=!1,i=await xg.getMetadata();if(i){let t=i instanceof Array?i[0].id:i.id;e.id=t}i.isEqual(e)||(n.w.saveUserSettings({metadata:e}),r=!0),n.w.getAppSettings().syncNavigation||(e.locked=i.locked,e.fullscreen=i.fullscreen,e.lastOpenedGridId=i.lastOpenedGridId),i.isEqual(e)||(await te.saveObject(d.e,e),r=!0),r&&(0,t.A)(document).trigger(C.A.EVENT_METADATA_UPDATED,e)},xg.markCurrentConfigAsBackedUp=async function(){let e=await xg.getMetadata();e.notificationConfig.lastBackup=(new Date).getTime(),await xg.saveMetadata(e)},xg.getMetadata=function(){return new Promise((e=>{te.getObject(d.e).then((t=>{let r=null;if(t?Array.isArray(t)?(t.sort(((e,t)=>e.id.localeCompare(t.id))),r=t[0]):r=t:r=new d.e,!n.w.getAppSettings().syncNavigation){let e=n.w.getUserSettings().metadata;e&&(r.locked=e.locked,r.fullscreen=e.fullscreen,r.lastOpenedGridId=e.lastOpenedGridId)}e(new d.e(r))}))}))},xg.getDictionary=function(e){return e?te.getSingleObject(le,e).then((e=>Promise.resolve(new le(e)))):Promise.resolve(null)},xg.getDictionaries=function(){return new Promise((e=>{te.getObject(le).then((t=>{if(!t)return void e([]);let n=t instanceof Array?t.map((e=>new le(e))):[new le(t)];e(n)}))}))},xg.saveDictionary=function(e){return e.isDefault=!1,te.saveObject(le,e)},xg.deleteObject=function(e){return te.removeObject(e)},xg.saveThumbnail=async function(e,t){let n=await xg.getGrid(e,!1,!0);return n.thumbnail=t,xg.saveGrid(n)},xg.downloadBackupToFile=async function(){let e=(await xg.getGrids()).map((e=>e.id)),t=n.w.getAutologinUser();await xg.downloadToFile(e,{exportGlobalGrid:!0,exportOnlyCurrentLang:!1,exportDictionaries:!0,exportUserSettings:!0,filename:`${t}_${ee.Z.getCurrentDateTimeString()}_asterics-grid-full-backup`})},xg.getBackupData=async function(e,t={}){if(!e||0===e.length)return null;t.progressFn=t.progressFn||(()=>{});let n={},r=null;if((t=t||{}).exportGlobalGrid){let e=await xg.getGlobalGrid();r=e?e.id:null}t.progressFn(10,o.A.t("retrievingGrids"));let i=await xg.getGrids(!0,!t.exportGlobalGrid);if(n.grids=i.filter((t=>e.includes(t.id)||r===t.id)),t.exportOnlyCurrentLang){let e=o.A.getContentLang(),t=o.A.getContentLangBase();for(let r of n.grids){r.label[e]=r.label[e]||r.label[t],Object.keys(r.label).forEach((t=>t===e||delete r.label[t]));for(let n of r.gridElements){n.label[e]=n.label[e]||n.label[t],Object.keys(n.label).forEach((t=>t===e||delete n.label[t]));for(let t of n.actions)t.speakText&&Object.keys(t.speakText).forEach((n=>n===e||delete t.speakText[n]))}}}t.exportDictionaries&&(n.dictionaries=await xg.getDictionaries());let a=await xg.getMetadata();return t.exportUserSettings?n.metadata=a:n.grids.map((e=>e.id)).includes(r)&&(n.metadata={},n.metadata.globalGridId=r,n.metadata.lastOpenedGridId=a.lastOpenedGridId),t.obzFormat&&(t.progressFn(10,o.A.t("convertingToOBZ")),n=await he.backupDataToOBZ(n,{progressFn:e=>{t.progressFn(10+ee.Z.mapRange(e,0,100,0,90))}})),t.progressFn(100),n},xg.downloadToFile=async function(e,t={}){let n=await xg.getBackupData(e,t);if(!n)return;let r=n,i=".obz";t.obzFormat||(r=new Blob([JSON.stringify(n)],{type:"text/plain;charset=utf-8"}),i=".grd");let a=(t.filename||(n.grids.length>1?"asterics-grid-backup":o.A.getTranslation(n.grids[0].label)))+i;l().saveAs(r,a)},xg.convertFileToImportData=async function(e,t={}){t.progressFn=t.progressFn||(()=>{});let n=await de.readFileContent(e),r=null;if(!n)return null;if(de.isGrdFile(e)){try{r=JSON.parse(n)}catch(e){return log.warn("couldn't parse import data"),null}if(!r||!r.grids&&!r.metadata&&!r.dictionaries)return log.warn("data doesn't contain AsTeRICS Grid config"),null}else if(de.isObfFile(e))r=await he.OBFToGridData(JSON.parse(n));else if(de.isObzFile(e)){let n=await de.readZip(e,{jsonFileExtensions:["json","obf"],defaultEncoding:"base64",progressFn:t.progressFn});r=await he.OBZToImportData(n)}return xg.normalizeImportData(r)},xg.normalizeImportData=function(e){if(!e||0===e.length)return{};let t={};return e instanceof Array?t.grids=e:!e.grids&&e.id?t.grids=[e]:t=e,t.grids=t.grids||[],t.dictionaries=t.dictionaries||[],t.grids=P.updateDataModel(t.grids),t.dictionaries=P.updateDataModel(t.dictionaries),t.metadata&&(t.metadata=P.updateDataModel(t.metadata)),t.metadata=t.metadata||{},t},xg.importBackupUploadedFile=async function(e,t){(t=t||(()=>{}))(10,o.A.t("extractingGridsFromFile"));let n=await xg.convertFileToImportData(e,{progressFn:e=>{t(10+ee.Z.mapRange(e,0,100,0,10))}});return n?xg.importBackupData(n,{progressFn:t,generateGlobalGrid:de.isObzFile(e)}):(t(100),void fg.setTooltip(o.A.t("backupFileDoesntContainData"),{msgType:"warn"}))},xg.importBackupFromPreview=async function(e,t={}){if(!e)return;t.progressFn=t.progressFn||(()=>{}),t.filename=t.filename||e.filename,t.skipDelete=!0,t.progressFn(10,o.A.t("downloadingConfig")),t.generateGlobalGrid=e.generateGlobalGrid||!1;let n=de.isObzFile(e.url),r=await de.downloadFile(e.url,{isBytes:n});if(t.progressFn(50,o.A.t("importingData")),n){let e=await de.readZip(r,{jsonFileExtensions:["json","obf"],defaultEncoding:"base64"});r=await he.OBZToImportData(e)}if(e.translate&&r.grids)for(let e of r.grids){e.label[o.A.getContentLang()]=o.A.t(o.A.getTranslation(e.label));for(let t of e.gridElements)t.label[o.A.getContentLang()]=o.A.t(o.A.getTranslation(t.label))}return xg.importBackupData(r,t)},xg.importBackupDefaultFile=async function(e,t={}){let n=bg.getPreview(e);return xg.importBackupFromPreview(n,t)},xg.importBackupData=async function(e,t){if((t=t||{}).progressFn=t.progressFn||(()=>{}),t.filename=t.filename||"",t.skipDelete||(t.progressFn(20,o.A.t("deletingGrids")),await xg.deleteAllGrids(),await xg.deleteAllDictionaries()),n.w.saveUserSettings({originGridsetFilename:t.filename,isEmpty:!1},n.w.getAutologinUser()),t.progressFn(30,o.A.t("encryptingAndSavingGrids")),await xg.importData(e,{generateGlobalGrid:t.generateGlobalGrid,importDictionaries:!0,importUserSettings:!0,progressFn:e=>{t.progressFn(30+e/100*70)}}),await xg.markCurrentConfigAsBackedUp(),e.grids&&e.grids.length){let t=Ge.b.getGridsContentLang(e.grids,o.A.getContentLang());await o.A.setContentLanguage(t)}t.progressFn(100)},xg.importData=async function(e,t){if(!e||0===e.length)return Promise.resolve();(t=t||{}).progressFn=t.progressFn||(()=>{}),t.progressFn(0);let n=xg.normalizeImportData(e);ae.j.removeDatabaseProperties(n.grids),ae.j.removeDatabaseProperties(n.dictionaries,!0),ae.j.removeDatabaseProperties(n.metadata,!0),t.progressFn(10);let r=(await xg.getGrids()).map((e=>o.A.getTranslation(e.label))),i=Ge.b.regenerateIDs(n.grids);if(n.grids=i.grids,n.metadata&&(n.metadata.lastOpenedGridId||n.metadata.globalGridId||n.metadata.homeGridId)&&(n.metadata.lastOpenedGridId=i.idMapping[n.metadata.lastOpenedGridId],n.metadata.globalGridId=i.idMapping[n.metadata.globalGridId],n.metadata.homeGridId=i.idMapping[n.metadata.homeGridId]||null),n.grids.forEach((e=>{let t=o.A.getTranslation(e.label);e.label[o.A.getContentLang()]=u.S.getNewName(t,r)})),t.progressFn(20),t.generateGlobalGrid&&!n.metadata.globalGridId){let e=Ge.b.generateGlobalGrid(o.A.getContentLang());n.grids.unshift(e),n.metadata.globalGridId=e.id}if(t.importUserSettings)n.metadata=Object.assign(await xg.getMetadata(),n.metadata);else if(t.resetBeforeImport&&n.metadata&&(n.metadata.globalGridId||n.metadata.lastOpenedGridId)){let e=await xg.getMetadata();e.globalGridId=n.metadata.globalGridId,e.lastOpenedGridId=n.metadata.lastOpenedGridId,n.metadata=e}if(await xg.saveGrids(JSON.parse(JSON.stringify(n.grids))),t.progressFn(70),n.metadata&&(n.metadata.globalGridActive=!!n.metadata.globalGridId,await xg.saveMetadata(n.metadata)),t.progressFn(80),t.importDictionaries&&n.dictionaries){let e=(await xg.getDictionaries()).map((e=>e.dictionaryKey));for(let t of n.dictionaries)t.dictionaryKey=u.S.getNewName(t.dictionaryKey,e);n.dictionaries=n.dictionaries.map((e=>new le(e))),await te.bulkSave(n.dictionaries),Ie.init()}log.debug("pre-caching all images of gridset ..."),$e.serviceWorkerService.cacheImagesOfGrids(n.grids),t.progressFn(100)},xg.getSyncState=function(){return j.getSyncState()},xg.getCurrentUser=function(){return te.getCurrentUsedDatabase()},xg.cacheAllImages=async function(){let e=await xg.getGrids();$e.serviceWorkerService.cacheImagesOfGrids(e)},window.setGlobalGridId=Ng,window.fillEmptyTranslations=async function(e="",t=""){if(2!==e.length||2!==t.length)return void console.log("invalid params");let n=await xg.getGrids(!0,!1),r=JSON.stringify(n);for(let r of n){r.label[e]=r.label[e]||r.label[t];for(let n of r.gridElements)n.label[e]=n.label[e]||n.label[t]}r!==JSON.stringify(n)?(await xg.saveGrids(n),console.log("updated all grids!")):console.log("nothing updated.")},(0,t.A)(document).on(C.A.EVENT_DB_INITIAL_SYNC_COMPLETE,(()=>{xg.cacheAllImages()}));var Dg=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"all-grids-view overflow-content box"},[t("div",{staticStyle:{display:"none"}},[t("input",{attrs:{type:"file",id:"inputFileBackup",accept:".grd, .obf, .obz, .txt, .json, .zip, application/json, application/zip, application/octet-stream, application/x-zip-compressed, multipart/x-zip"},on:{change:e.importBackupFromFile}})]),e._v(" "),t("header-icon",{directives:[{name:"show",rawName:"v-show",value:e.graphList&&0===e.graphList.length,expression:"graphList && graphList.length === 0"}],attrs:{"full-header":"true"}}),e._v(" "),t("header",{directives:[{name:"show",rawName:"v-show",value:e.graphList&&e.graphList.length>0,expression:"graphList && graphList.length > 0"}],staticClass:"srow header",attrs:{role:"toolbar"}},[t("header-icon"),e._v(" "),t("button",{staticClass:"small",attrs:{tabindex:"32",id:"moreButton","aria-label":e.$t("more")}},[t("i",{staticClass:"fas fa-ellipsis-v"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("more")))])]),e._v(" "),t("div",{attrs:{id:"moreButtonMenu"}}),e._v(" "),t("button",{staticClass:"spaced hide-mobile small",attrs:{tabindex:"31"},on:{click:function(t){return e.addGrid()}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",[e._v(e._s(e.$t("newGrid")))])])],1),e._v(" "),e.showLoading||null===e.grids?t("div",{staticClass:"srow content text-content"},[e._m(0)]):e._e(),e._v(" "),e.graphList&&e.graphList.length>0&&!e.showLoading?t("div",{staticClass:"srow content text-content"},[e.selectedGraphElement?t("div",[t("h1",[e._v(e._s(e.headerDetails))]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"five columns"},[t("img",{staticStyle:{height:"150px","max-width":"100%",border:"1px solid lightgray"},attrs:{src:e.selectedGraphElement.grid.thumbnail?e.selectedGraphElement.grid.thumbnail.data:e.imageUtil.getEmptyImage()}})]),e._v(" "),t("div",{staticClass:"five columns",staticStyle:{"margin-bottom":"1.5em"}},[t("label",{staticStyle:{display:"block"},attrs:{for:"gridName"}},[e._v(e._s(e.$t("nameOfGrid")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newLabel[e.currentLanguage],expression:"newLabel[currentLanguage]"}],staticStyle:{width:"77%"},attrs:{id:"gridName",type:"text",maxlength:"25"},domProps:{value:e.newLabel[e.currentLanguage]},on:{input:function(t){t.target.composing||e.$set(e.newLabel,e.currentLanguage,t.target.value)}}}),e._v(" "),t("button",{staticStyle:{width:"17%",padding:"0 1%"},attrs:{disabled:e.isLabelDuplicate(e.newLabel[e.currentLanguage]),title:e.$t("saveName")},on:{click:e.saveGridLabel}},[t("i",{staticClass:"fas fa-check"})])])]),e._v(" "),t("div",{staticClass:"srow",staticStyle:{"margin-bottom":"0.5em"}},[t("label",{attrs:{for:"actionGroup"}},[e._v(e._s(e.$t("actions")))])]),e._v(" "),t("div",{staticClass:"action-buttons",attrs:{id:"actionGroup"}},[t("div",{staticStyle:{display:"flex"}},[t("button",{attrs:{"aria-label":e.$t("show")},on:{click:function(t){return e.show(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"far fa-eye"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("show")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("edit")},on:{click:function(t){return e.edit(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"far fa-edit"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("edit")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("clone")},on:{click:function(t){return e.clone(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"far fa-clone"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("clone")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("delete")},on:{click:function(t){return e.deleteGrid(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"far fa-trash-alt"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("delete")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("export")},on:{click:function(t){return e.exportCustom(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"fas fa-file-export"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("export")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("saveAsPdf")},on:{click:function(t){return e.exportToPdf(e.selectedGraphElement.grid.id)}}},[t("i",{staticClass:"far fa-file-pdf"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("saveAsPdf")))])])])])]):e._e(),e._v(" "),t("div",[t("h1",[e._v(e._s(e.$t("gridList")))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.graphList.length>0,expression:"graphList.length > 0"}],staticClass:"srow",staticStyle:{"margin-bottom":"1em"}},[t("label",{staticClass:"three columns",attrs:{for:"selectMode"}},[e._v(e._s(e.$t("gridsToShow")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectValue,expression:"selectValue"}],staticClass:"four columns",attrs:{id:"selectMode"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectValue=t.target.multiple?n:n[0]},e.reinitContextMenu]}},[t("option",{domProps:{value:e.SELECT_VALUES.ALL_GRIDS}},[e._v(e._s(e.$t("allGrids")))]),e._v(" "),e.selectedGraphElement?t("option",{domProps:{value:e.SELECT_VALUES.CONNECTED_GRIDS}},[e._v(e._s(e.connectedGridsOptionLabel))]):e._e(),e._v(" "),t("option",{domProps:{value:e.SELECT_VALUES.NOT_REACHABLE_GRIDS}},[e._v(e._s(e.$t("notReachableGrids")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.graphList.length>0,expression:"graphList.length > 0"}],staticClass:"srow",staticStyle:{"margin-bottom":"1.5em"}},[t("label",{staticClass:"three columns",attrs:{for:"selectOrder"}},[e._v(e._s(e.$t("sortGridsBy")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.orderValue,expression:"orderValue"}],staticClass:"four columns",attrs:{id:"selectOrder"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.orderValue=t.target.multiple?n:n[0]},e.orderChanged]}},[t("option",{domProps:{value:e.ORDER_VALUES.ALPHABET}},[e._v(e._s(e.$t("labelAlphabetically")))]),e._v(" "),e.selectedGraphElement?t("option",{domProps:{value:e.ORDER_VALUES.CONNECTION_COUNT}},[e._v(e._s(e.$t("numberOfConnections")))]):e._e()]),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(e.graphElemsToShow.length)+" "),t("span",[e._v(e._s(e.$t("elements")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("ul",[e._l(e.graphElemsToShow,(function(n){return t("li",{staticStyle:{display:"inline-block","margin-right":"2em","margin-bottom":"1.5em",position:"relative","max-width":"290px"}},[t("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"javascript:;"},on:{click:function(t){return e.setSelectedGraphElement(n)}}},[t("div",{staticStyle:{width:"100%",border:"1px solid lightgray"},attrs:{title:e.i18nService.getTranslation(n.grid.label)}},[t("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","padding-left":"0.25em"}},[e._v(e._s(e._f("extractTranslation")(n.grid.label)))]),e._v(" "),t("img",{staticStyle:{height:"150px","max-width":"100%"},attrs:{src:n.grid.thumbnail?n.grid.thumbnail.data:e.imageUtil.getEmptyImage()}})])]),e._v(" "),t("button",{staticClass:"gridOptions",staticStyle:{position:"absolute",bottom:"3px",right:"0",padding:"0 20px",margin:"0"},attrs:{"data-grid-id":n.grid.id,title:e.$t("more")}},[t("i",{staticClass:"fas fa-ellipsis-v"})])])})),e._v(" "),t("li",{directives:[{name:"show",rawName:"v-show",value:0===e.graphElemsToShow.length,expression:"graphElemsToShow.length === 0"}]},[t("span",[e._v(e._s(e.$t("noGrids")))])])],2)]),e._v(" "),e.graphList&&e.graphList.length>0?t("div",{staticClass:"srow"},[t("button",{on:{click:e.updateAllThumbnails}},[t("span",{staticClass:"fas fa-images"}),e._v(" "+e._s(e.$t("updateAllGridThumbnails")))])]):e._e(),e._v(" "),t("h1",[e._v(e._s(e.$t("globalGrid")))]),e._v(" "),t("p",[e._v(e._s(e.$t("aGlobalGridIsShownWithinEachOtherGridAndCan")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"globalGridActions"}},[e._v(e._s(e.$t("actionsForGlobalGrid")))]),e._v(" "),e.metadata?t("div",{staticClass:"eight columns",attrs:{id:"globalGridActions"}},[t("button",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.globalGridActive||!e.hasGlobalGrid,expression:"!metadata.globalGridActive || !hasGlobalGrid"}],on:{click:function(t){return e.setGlobalGridActive(!0)}}},[t("i",{staticClass:"fas fa-globe"}),e._v(" "),t("span",[e._v(e._s(e.$t("activateGlobalGrid")))])]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.metadata.globalGridActive&&e.hasGlobalGrid,expression:"metadata.globalGridActive && hasGlobalGrid"}],on:{click:function(t){return e.setGlobalGridActive(!1)}}},[t("i",{staticClass:"fas fa-globe"}),e._v(" "),t("span",[e._v(e._s(e.$t("deactivateGlobalGrid")))])]),e._v(" "),t("button",{attrs:{disabled:!e.metadata.globalGridActive},on:{click:function(t){return e.edit(e.metadata.globalGridId)}}},[t("i",{staticClass:"fas fa-edit"}),e._v(" "),t("span",[e._v(e._s(e.$t("editGlobalGrid")))])]),e._v(" "),t("button",{attrs:{disabled:!e.metadata.globalGridActive},on:{click:function(t){return e.resetGlobalGrid({confirm:!0,reload:!0})}}},[t("i",{staticClass:"fas fa-undo"}),e._v(" "),t("span",[e._v(e._s(e.$t("resetGlobalGridToDefault")))])])]):e._e()]),e._v(" "),t("h1",[e._v(e._s(e.$t("homeGrid")))]),e._v(" "),t("div",{staticClass:"srow mb-4"},[t("label",{staticClass:"three columns",attrs:{for:"selectHomeGrid"}},[e._v(e._s(e.$t("selectHomeGrid")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.homeGridId,expression:"metadata.homeGridId"}],staticClass:"seven columns",attrs:{id:"selectHomeGrid"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata,"homeGridId",t.target.multiple?n:n[0])},e.homeGridChanged]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("noneAlwaysOpenLastOpenedGrid")))]),e._v(" "),e._l(e.graphList,(function(n){return t("option",{domProps:{value:n.grid.id}},[e._v(e._s(e._f("extractTranslation")(n.grid.label)))])}))],2)]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.toHomeAfterSelect,expression:"metadata.toHomeAfterSelect"}],attrs:{id:"toHomeAfterSelect",type:"checkbox"},domProps:{checked:Array.isArray(e.metadata.toHomeAfterSelect)?e._i(e.metadata.toHomeAfterSelect,null)>-1:e.metadata.toHomeAfterSelect},on:{change:[function(t){var n=e.metadata.toHomeAfterSelect,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.metadata,"toHomeAfterSelect",n.concat([null])):o>-1&&e.$set(e.metadata,"toHomeAfterSelect",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.metadata,"toHomeAfterSelect",i)},e.homeGridChanged]}}),e._v(" "),t("label",{attrs:{for:"toHomeAfterSelect"}},[e._v(e._s(e.$t("navigateToHomeGridAfterSelectingAnElement")))])])])]):e._e(),e._v(" "),e.graphList&&0===e.graphList.length&&!e.showLoading?t("no-grids-page",{attrs:{"restore-backup-handler":e.importBackup,"import-custom-handler":()=>e.importModal.show=!0,"reset-global-grid":this.resetGlobalGrid}}):e._e(),e._v(" "),e.linkModal.show?t("grid-link-modal",{attrs:{"grid-from-prop":e.linkModal.gridFrom,"grid-to-prop":e.linkModal.gridTo},on:{close:function(t){e.linkModal.show=!1},reload:function(t){return e.reload(e.linkModal.gridFrom.id)}}}):e._e(),e._v(" "),e.pdfModal.show?t("export-pdf-modal",{attrs:{"grids-data":e.grids,"print-grid-id":e.pdfModal.printGridId},on:{close:function(t){e.pdfModal.show=!1,e.pdfModal.printGridId=null}}}):e._e(),e._v(" "),e.backupModal.show?t("export-modal",{attrs:{"grids-data":e.grids,"export-options":e.backupModal.exportOptions},on:{close:function(t){e.backupModal.show=!1}}}):e._e(),e._v(" "),e.importModal.show?t("import-modal",{attrs:{"reload-fn":e.reload},on:{close:function(t){e.importModal.show=!1}}}):e._e(),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};Dg._withStripped=!0;var Lg=function(){var e=this,t=e._self._c;return!e.fullHeader||e.show?t(e.tag,{tag:"component"},[t("div",[e.show?t("div",[t("a",{staticStyle:{margin:"0.2em 1em 0 0.5em",color:"#266697"},attrs:{tabindex:"20",href:"javascript:void(0)","aria-label":e.$t("openSidebar")},on:{click:function(t){return e.openSidebar()}}},[t("i",{staticClass:"fas fa-2x fa-bars inline"})]),e._v(" "),t("a",{staticClass:"hide-mobile",attrs:{tabindex:"21","aria-hidden":"true",href:"#main"}},[t("h1",{staticClass:"inline"},[t("img",{attrs:{id:"astericsIcon",src:"app/img/asterics-grid-icon-raw.svg",height:"40",width:"121",alt:"AsTeRICS Grid"}})])])]):e._e(),e._v(" "),t("a",{staticClass:"show-mobile",attrs:{tabindex:"22","aria-hidden":"true",href:"#main"}},[t("h1",{staticClass:"inline"},[t("img",{staticStyle:{margin:"0"},attrs:{id:"astericsIcon",src:"app/img/asterics_icon.png",alt:"AsTeRICS Grid"}})])])])]):e._e()};Lg._withStripped=!0;const Pg=Cd({props:["fullHeader"],data:()=>({show:!fg.isSidebarOpen(),tag:"div"}),methods:{openSidebar(){(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPEN),this.show=!1},onOpenFn(){this.show=!1},onCloseFn(){this.show=!0}},mounted(){(0,t.A)(document).on(C.A.EVENT_SIDEBAR_CLOSE,this.onCloseFn),(0,t.A)(document).on(C.A.EVENT_SIDEBAR_OPENED,this.onOpenFn),this.fullHeader&&(this.tag="header")},beforeDestroy(){(0,t.A)(document).off(C.A.EVENT_SIDEBAR_CLOSE,document,this.onCloseFn)}},Lg,[],!1,null,"7704618b",null).exports;var Mg=function(){var e=this,t=e._self._c;return t("div",[t("button",{staticClass:"btn-accordion",staticStyle:{"margin-bottom":"0"},on:{click:e.toggleOpen}},[t("i",{directives:[{name:"show",rawName:"v-show",value:!e.isOpen,expression:"!isOpen"}],staticClass:"fas fa-chevron-down arrow"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}],staticClass:"fas fa-chevron-up arrow"}),e._v(" "),t(e.componentType,{tag:"component",style:`display: inline-block; margin: 0 0 0 2em;${e.accLabelStyle}`},[e._v(e._s(e.accLabel))])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}],staticClass:"accordion-content",style:"background-color:"+e.backgroundColor},[e._t("default")],2)])};Mg._withStripped=!0;const Ug={props:["accLabel","accOpen","accLabelType","accBackgroundColor","accLabelStyle"],data(){return{isOpen:"true"===this.accOpen||!0===this.accOpen,componentType:this.accLabelType||"span",backgroundColor:this.accBackgroundColor||"whitesmoke"}},methods:{toggleOpen(){this.isOpen=!this.isOpen,this.isOpen?this.$emit("open"):this.$emit("close")},open(){this.isOpen=!0}},mounted(){}};var Fg=s(6650),Bg={};Bg.styleTagTransform=Ed(),Bg.setAttributes=gd(),Bg.insert=vd().bind(null,"head"),Bg.domAPI=hd(),Bg.insertStyleElement=yd(),dd()(Fg.A,Bg),Fg.A&&Fg.A.locals&&Fg.A.locals;const Gg=Cd(Ug,Mg,[],!1,null,"23ef530e",null).exports;var $g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("linkGrids"))+"\n                    ")])]),e._v(" "),e.gridFrom?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("div",[t("div",[e._v(e._s(e._f("extractTranslation")(e.gridFrom.label)))]),e._v(" "),t("img",{staticStyle:{height:"150px",border:"1px solid lightgray"},attrs:{src:e.gridFrom.thumbnail?e.gridFrom.thumbnail.data:e.imageUtil.getEmptyImage()}})])]),e._v(" "),t("i",{staticClass:"fas fa-2x fa-arrow-right hide-mobile two columns",staticStyle:{"margin-top":"2em"}}),e._v(" "),t("i",{staticClass:"fas fa-2x fa-arrow-down show-mobile two columns",staticStyle:{margin:"0.5em 20%"}}),e._v(" "),t("div",{staticClass:"four columns"},[t("div",[e._v(e._s(e._f("extractTranslation")(e.gridTo.label)))]),e._v(" "),t("img",{staticStyle:{height:"150px",border:"1px solid lightgray"},attrs:{src:e.gridTo.thumbnail?e.gridTo.thumbnail.data:e.imageUtil.getEmptyImage()}})])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"elementName"}},[e._v(e._s(e.$t("connectWithElement")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedElement,expression:"selectedElement"}],staticClass:"four columns",attrs:{id:"elementName"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedElement=t.target.multiple?n:n[0]}}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("createNewElement")))]),e._v(" "),e._l(e.gridFrom.gridElements,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.i18nService.getTranslation(n.label)||e.i18nService.t("emptyElement")))])}))],2)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.selectedElement||!e.i18nService.getTranslation(e.selectedElement.label),expression:"!selectedElement || !i18nService.getTranslation(selectedElement.label)"}],staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"elementLabel"}},[e._v(e._s(e.$t("labelOfNewElement")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newElementLabel[e.i18nService.getContentLang()],expression:"newElementLabel[i18nService.getContentLang()]"}],staticClass:"four columns",attrs:{type:"text",id:"elementLabel",maxlength:"35"},domProps:{value:e.newElementLabel[e.i18nService.getContentLang()]},on:{input:function(t){t.target.composing||e.$set(e.newElementLabel,e.i18nService.getContentLang(),t.target.value)}}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedElement&&e.selectedElement.actions.filter((t=>t.modelName===e.GridActionNavigate.getModelName())).length>0,expression:"selectedElement && selectedElement.actions.filter(e => e.modelName === GridActionNavigate.getModelName()).length > 0"}],staticClass:"srow"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[t("b",[e._v(e._s(e.$t("hint"))+" ")]),e._v(" "+e._s(e.$t("thisElementAlreadyNavigatesToAnotherGrid"))+"\n                        ")])])]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};$g._withStripped=!0;const Vg={props:["gridFromProp","gridToProp"],data:function(){return{gridFrom:null,gridTo:JSON.parse(JSON.stringify(this.gridToProp)),inputText:"",selectedElement:null,newElementLabel:null,GridActionNavigate:D.g,imageUtil:ue.M,i18nService:o.A}},methods:{save(){this.saveInternal().then((()=>{this.$emit("reload"),this.$emit("close")}))},saveInternal(){let e=this.selectedElement;if(!e){let t=new c.D(this.gridFrom).getNewXYPos();e=new O.V({label:this.newElementLabel,x:t.x,y:t.y}),this.gridFrom.gridElements.push(e)}return e.label=e.label||this.newElementLabel,e.actions=e.actions.filter((e=>e.modelName!==D.g.getModelName())),e.actions.push(new D.g({toGridId:this.gridTo.id,navType:D.g.NAV_TYPES.TO_GRID})),xg.saveGrid(this.gridFrom)}},mounted(){this.newElementLabel=JSON.parse(JSON.stringify(this.gridTo.label)),xg.getGrid(this.gridFromProp.id).then((e=>{this.gridFrom=JSON.parse(JSON.stringify(e))}))}};var jg=s(6428),Kg={};Kg.styleTagTransform=Ed(),Kg.setAttributes=gd(),Kg.insert=vd().bind(null,"head"),Kg.domAPI=hd(),Kg.insertStyleElement=yd(),dd()(jg.A,Kg),jg.A&&jg.A.locals&&jg.A.locals;const Wg=Cd(Vg,$g,[],!1,null,"dfa50f10",null).exports;var qg=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("exportGridsToPdfGrids"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"selectGrid"}},[e._v(e._s(e.$t("selectGrid")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedGrid,expression:"selectedGrid"}],staticClass:"four columns",attrs:{id:"selectGrid"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedGrid=t.target.multiple?n:n[0]},e.selectedGridChanged]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("allGrids")))]),e._v(" "),e._l(e.graphList,(function(n){return t("option",{domProps:{value:n.grid}},[e._v(e._s(e._f("extractTranslation")(n.grid.label)))])}))],2),e._v(" "),t("div",{staticClass:"four columns"},[e.selectedGrid&&e.selectedGrid.thumbnail?t("img",{attrs:{src:e.selectedGrid.thumbnail.data}}):e._e()])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedGrid&&e.allChildren&&e.allChildren.length>0,expression:"selectedGrid && allChildren && allChildren.length > 0"}],staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportConnected,expression:"options.exportConnected"}],attrs:{id:"exportConnected",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportConnected)?e._i(e.options.exportConnected,null)>-1:e.options.exportConnected},on:{change:function(t){var n=e.options.exportConnected,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportConnected",n.concat([null])):o>-1&&e.$set(e.options,"exportConnected",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportConnected",i)}}}),e._v(" "),t("label",{attrs:{for:"exportConnected"}},[t("span",[e._v(e._s(e.$t("exportAllChildGrids")))]),e._v(" "),t("span",[e._v("("+e._s(e.allChildren?e.allChildren.length:0)+" "),t("span",[e._v(e._s(e.$t("grids")))]),e._v(")")])])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.showLinks,expression:"options.showLinks"}],attrs:{id:"showLinks",type:"checkbox"},domProps:{checked:Array.isArray(e.options.showLinks)?e._i(e.options.showLinks,null)>-1:e.options.showLinks},on:{change:function(t){var n=e.options.showLinks,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"showLinks",n.concat([null])):o>-1&&e.$set(e.options,"showLinks",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"showLinks",i)}}}),e._v(" "),t("label",{attrs:{for:"showLinks"}},[e._v(e._s(e.$t("insertLinksBetweenPages")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.printBackground,expression:"options.printBackground"}],attrs:{id:"printBackground",type:"checkbox"},domProps:{checked:Array.isArray(e.options.printBackground)?e._i(e.options.printBackground,null)>-1:e.options.printBackground},on:{change:function(t){var n=e.options.printBackground,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"printBackground",n.concat([null])):o>-1&&e.$set(e.options,"printBackground",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"printBackground",i)}}}),e._v(" "),t("label",{attrs:{for:"printBackground"}},[e._v(e._s(e.$t("printBackgroundColor")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.showRegister,expression:"options.showRegister"}],attrs:{id:"showRegister",type:"checkbox"},domProps:{checked:Array.isArray(e.options.showRegister)?e._i(e.options.showRegister,null)>-1:e.options.showRegister},on:{change:function(t){var n=e.options.showRegister,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"showRegister",n.concat([null])):o>-1&&e.$set(e.options,"showRegister",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"showRegister",i)}}}),e._v(" "),t("label",{attrs:{for:"showRegister"}},[e._v(e._s(e.$t("printIndexAtSideEdge")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.includeGlobalGrid,expression:"options.includeGlobalGrid"}],attrs:{id:"includeGlobalGrid",type:"checkbox"},domProps:{checked:Array.isArray(e.options.includeGlobalGrid)?e._i(e.options.includeGlobalGrid,null)>-1:e.options.includeGlobalGrid},on:{change:function(t){var n=e.options.includeGlobalGrid,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"includeGlobalGrid",n.concat([null])):o>-1&&e.$set(e.options,"includeGlobalGrid",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"includeGlobalGrid",i)}}}),e._v(" "),t("label",{attrs:{for:"includeGlobalGrid"}},[e._v(e._s(e.$t("includeGlobalGrid")))])])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("downloadPdf")))])])])])])])])])};qg._withStripped=!0;var Hg=s(4519);let Yg={},zg={docPadding:5,footerHeight:8,textPadding:3,elementMargin:1,imgMargin:1,imgHeightPercentage:.8},Jg=null,Xg=[{pattern:/^[\u0400-\u04FF]+$/,font:"/app/fonts/Arimo-Regular-Cyrillic.ttf"}];async function Qg(e,t,n,r,i){let a=297,s=210;t=new c.D(t);let l=(t=Ge.b.mergeGrids(t,i,r)).gridElements.reduce(((e,t)=>e||t.image&&t.image.searchProviderName===Ju.SEARCH_PROVIDER_NAME),!1),u=n.showRegister&&n.pages>1?10:0,h=l?2*zg.footerHeight:zg.footerHeight,p=(a-2*zg.docPadding)/Ge.b.getWidthWithBounds(t),v=(s-2*zg.docPadding-h-u)/Ge.b.getHeightWithBounds(t);if(h>0){let r=s-zg.docPadding-u,i=.4*zg.footerHeight/.352778;e.setTextColor(0),e.setFontSize(i);let c=o.A.t("printedByAstericsGrid"),d=o.A.t("copyrightARASAACPDF"),h=o.A.getTranslation(t.label),p=n.idParentsMap[t.id][0],v=l?r-zg.footerHeight:r;if(n.showLinks&&p){h=JSON.stringify(n.idParentsMap[t.id].slice(0,5))+" => "+h;let r=e.getTextWidth(h);e.link(148.5-r/2,v-.4*zg.footerHeight,r,.4*zg.footerHeight,{pageNumber:p})}let m=(n.idPageMap[t.id]||1)+" / "+(Object.keys(n.idPageMap).length||1);e.text(c,zg.docPadding+zg.elementMargin,v,{baseline:"bottom",align:"left"}),l&&e.text(d,zg.docPadding+zg.elementMargin,r,{baseline:"bottom",align:"left"}),e.text(h,148.5,v,{baseline:"bottom",align:"center"}),e.text(m,a-zg.docPadding-zg.elementMargin,v,{baseline:"bottom",align:"right"})}if(u>0){let t=30,r=1,i=n.pages;n.pages>t&&(r=Math.ceil(n.pages/t),i=Math.ceil(n.pages/r)),e.setFillColor(255,255,255),e.setDrawColor(0),e.roundedRect(0,s-u,a,u,0,0),e.setFontSize(13);let o=a/i;for(let t=0;t<i;t++){e.roundedRect(t*o,s-u,o,u,0,0);let i=t*r+1;i<=n.page&&e.text(i+"",t*o+o/2,s-u/2,{baseline:"middle",align:"center"})}}for(let i of t.gridElements){if(i.hidden)continue;let t=p*i.width-2*zg.elementMargin,a=v*i.height-2*zg.elementMargin,s=zg.docPadding+p*i.x+zg.elementMargin,l=zg.docPadding+v*i.y+zg.elementMargin,c=n.printBackground?ee.Z.getRGB(d.e.getElementColor(i,r)):[255,255,255];if(e.setDrawColor(0),e.setFillColor(c[0],c[1],c[2]),e.roundedRect(s,l,t,a,3,3,"FD"),o.A.getTranslation(i.label)&&Zg(e,i,t,a,s,l,c),await ef(e,i,t,a,s,l),i=new O.V(i),n.showLinks&&n.idPageMap[i.getNavigateGridId()]){let r=n.idPageMap[i.getNavigateGridId()],o=Math.max(t/10,7),c=t-o-1,d=1;if(e.setDrawColor(255),e.setFillColor(90,113,122),e.roundedRect(s+c,l+d,o,o,1,1,"FD"),e.link(s,l,t,a,{pageNumber:r}),r){let t=.6*o/.352778;e.setTextColor(255,255,255),e.setFontSize(t),e.text(r+"",s+c+o/2,l+d+o/2,{baseline:"middle",align:"center",maxWidth:o})}}}return Promise.all([])}function Zg(e,t,n,r,i,a,s){let l=o.A.getTranslation(t.label),c=t.image&&(t.image.data||t.image.url),d=(c?r*(1-zg.imgHeightPercentage):r/2)/.352778*.8,u=n-2*zg.textPadding;Jg===Hg.a.CONVERT_MODE_UPPERCASE?l=l.toLocaleUpperCase():Jg===Hg.a.CONVERT_MODE_LOWERCASE&&(l=l.toLocaleLowerCase());let h=function(e,t,n,r,i,o){let a=n,s=n/2;for(let n=0;n<10;n++){e.setFontSize(a);let n=e.getTextDimensions(t);if(o&&-1!==t.indexOf(" ")){let e=Math.floor(i/n.h),t=Math.ceil(n.w/r);n.w/e>.5*r||t>e?a-=s:a+=s}else n.w>r?a-=s:a+=s;s/=2}return Math.floor(Math.min(a,n))}(e,l,d,u,r-2*zg.textPadding,!c),p=xu.getHighContrastColorRgb(s);e.setTextColor(p[0],p[1],p[2]),e.setFontSize(h);let v=e.getTextDimensions(l),m=Math.ceil(v.w/u),g=c?r-2*zg.elementMargin:(r-v.h*m)/2;e.text(l,i+n/2,a+g,{baseline:c?"bottom":"top",align:"center",maxWidth:u})}async function ef(e,t,n,r,i,a){if(!t||!t.image||!t.image.data&&!t.image.url)return Promise.resolve();let s=new ce.q(t.image).getImageType(),l=t.image.data,c=null;if(!l){let e=await ue.M.urlToBase64WithDimensions(t.image.url,500,s);l=e.data,c=e.dim}if(!l)return Promise.resolve();c||(c=await ue.M.getImageDimensionsFromDataUrl(l));let d=o.A.getTranslation(t.label)?zg.imgHeightPercentage:1,u=n-2*zg.imgMargin,h=(r-2*zg.imgMargin)*d,p=u/h,v=u,m=h,g=0,f=0;c.ratio>=p?(isNaN(c.ratio)||(m=v/c.ratio),f=(h-m)/2):(isNaN(c.ratio)||(v=m*c.ratio),g=(u-v)/2);let y=i+zg.imgMargin+g,_=a+zg.imgMargin+f;if(s===ce.q.IMAGE_TYPES.PNG)e.addImage(l,"PNG",y,_,v,m);else if(s===ce.q.IMAGE_TYPES.JPEG)e.addImage(l,"JPEG",y,_,v,m);else if(s===ce.q.IMAGE_TYPES.SVG){let t=v/.084666667,n=await ue.M.base64SvgToBase64Png(l,t);e.addImage(n,s,y,_,v,m)}}async function tf(){let e=await xg.getMetadata();e.textConfig&&(Jg=e.textConfig.convertMode)}Yg.initPrintHandlers=function(){window.addEventListener("beforeprint",(()=>{(0,t.A)("#grid-container").width("27.7cm"),(0,t.A)("#grid-container").height("19cm")})),window.addEventListener("afterprint",(()=>{(0,t.A)("#grid-container").width(""),(0,t.A)("#grid-container").height("")}))},Yg.gridsToPdf=async function(e,t){let n=await s.e(384).then(s.bind(s,5463));t=t||{};let r=await xg.getMetadata(),i=null;t.includeGlobalGrid&&(i=await xg.getGlobalGrid()),t.idPageMap={},t.idParentsMap={},t.fontPath="",e.forEach(((e,n)=>{t.idPageMap[e.id]=n+1}));for(let n of e){t.idParentsMap[n.id]=t.idParentsMap[n.id]||[];for(let e of n.gridElements){e=new O.V(e);let r=e.getNavigateGridId();r&&(t.idParentsMap[r]=t.idParentsMap[r]||[],t.idParentsMap[r].push(t.idPageMap[n.id]));let i=o.A.getTranslation(e.label);for(let e of Xg)e.pattern&&e.pattern.test&&e.pattern.test(i)&&(t.fontPath=e.font)}}const a=new n.jsPDF({orientation:"landscape",compress:!0});t.fontPath&&await async function(e,t){let n=await fetch(e).catch((e=>console.error(e)));if(!n)return;let r=e.substring(e.lastIndexOf("/")+1);log.info("using font",r);let i=await n.arrayBuffer(),o=ee.Z.arrayBufferToBase64(i);o&&(t.addFileToVFS(r,o),t.addFont(r,r,"normal"),t.setFont(r))}(t.fontPath,a),t.pages=e.length;for(let n=0;n<e.length&&!t.abort;n++){t.progressFn&&t.progressFn(Math.round(100*n/e.length),o.A.t("creatingPageXOfY",n+1,e.length),(()=>{t.abort=!0}));let s=i;t.includeGlobalGrid&&e[n].showGlobalGrid&&e[n].globalGridId&&(s=await xg.getGrid(e[n].globalGridId,!1)),s=!1!==e[n].showGlobalGrid?s:null,t.page=n+1,await Qg(a,e[n],t,r,s),n<e.length-1&&a.addPage()}t.abort||(t.progressFn&&t.progressFn(100),a.save("grid-export.pdf"))},(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,tf),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,tf);const nf={props:["gridsData","printGridId"],data:function(){return{selectedGrid:null,globalGridId:null,graphList:[],allChildren:null,options:{exportConnected:!0,printBackground:!1,showLinks:!0,showRegister:!1,includeGlobalGrid:!0}}},methods:{save(){let e=null;e=this.selectedGrid?this.options.exportConnected?[this.selectedGrid].concat(this.allChildren):[this.selectedGrid]:this.graphList.map((e=>e.grid));let t=e.map((e=>e.id));Promise.resolve().then((async()=>{if(e.length>this.gridsData.length/2)return xg.getGrids(!0,!0);{let e=[];for(let n=0;n<t.length;n++){let r=await xg.getGrid(t[n]);e.push(r)}return Promise.resolve(e)}})).then((e=>{e=t.map((t=>e.filter((e=>e.id===t))[0])),Yg.gridsToPdf(e,{printBackground:this.options.printBackground,showLinks:this.options.showLinks,showRegister:this.options.showRegister,includeGlobalGrid:this.options.includeGlobalGrid,progressFn:(e,t,n)=>{fg.showProgressBar(e,{header:o.A.t("creatingPDFFile"),text:t,cancelFn:n,closable:!0})}}),this.$emit("close")}))},selectedGridChanged(){this.selectedGrid&&(this.allChildren=Ge.b.getAllChildrenRecursive(this.graphList,this.selectedGrid.id))}},mounted(){xg.getGlobalGrid().then((e=>{this.globalGridId=e?e.id:null,this.graphList=Ge.b.getGraphList(this.gridsData,this.globalGridId),this.printGridId&&(this.selectedGrid=this.gridsData.filter((e=>e.id===this.printGridId))[0],this.options.exportConnected=!1,this.options.showLinks=!1,this.selectedGridChanged())}))}};var rf=s(9704),of={};of.styleTagTransform=Ed(),of.setAttributes=gd(),of.insert=vd().bind(null,"head"),of.domAPI=hd(),of.insertStyleElement=yd(),dd()(rf.A,of),rf.A&&rf.A.locals&&rf.A.locals;const af=Cd(nf,qg,[],!1,null,"3c021fc0",null).exports;var sf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-container-flex",on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$emit("close")},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("div",{staticClass:"container-fluid px-0 mb-5"},[t("div",{staticClass:"row"},[t("div",{staticClass:"modal-header col-8 col-sm-10 col-md-10"},[t("h1",{staticClass:"inline"},[e._v(e._s(e.$t("exportToFile")))])]),e._v(" "),t("a",{staticClass:"col-2 col-sm-1 col-md black",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("a",{staticClass:"col-2 col-sm-1 col-md black",attrs:{href:"javascript:void(0);",title:e.$t("close")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})])])]),e._v(" "),t("div",{staticClass:"modal-body mt-2"},[t("div",{staticClass:"row mb-4"},[t("label",{staticClass:"col-12 col-md-2",attrs:{for:"selectGrid"}},[e._v(e._s(e.$t("selectGrid")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-4 mb-4"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedGrid,expression:"selectedGrid"}],staticClass:"col-12",attrs:{id:"selectGrid"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedGrid=t.target.multiple?n:n[0]},e.selectedGridChanged]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("allGrids")))]),e._v(" "),e._l(e.graphList,(function(n){return t("option",{domProps:{value:n.grid}},[e._v(e._s(e._f("extractTranslation")(n.grid.label)))])}))],2)]),e._v(" "),t("div",{staticClass:"col-12 col-md-4"},[e.selectedGrid&&e.selectedGrid.thumbnail?t("img",{attrs:{src:e.selectedGrid.thumbnail.data}}):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-2",attrs:{for:"selectExportLang"}},[e._v(e._s(e.$t("exportLanguages")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-4 mb-4"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.options.exportLang,expression:"options.exportLang"}],staticClass:"col-12",attrs:{id:"selectExportLang"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.options,"exportLang",t.target.multiple?n:n[0])}}},e._l(e.options.exportLangOptions,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)]),e._v(" "),t("div",{staticClass:"col-12 col-md-4"},[e.options.exportLang===e.constants.LANG_EXPORT_CURRENT?t("span",[e._v(e._s(e.$t("currentLanguage",{contentLangReadable:e.i18nService.getContentLangReadable(),contentLangCode:e.i18nService.getContentLang()})))]):e._e(),e._v(" "),e.options.exportLang===e.constants.LANG_EXPORT_ALL?t("span",[t("span",[e._v(e._s(e.$t("currentLanguages",{length:e.currentLanguages.length}))+" ")]),e._v(" "),e._l(e.currentLanguages,(function(n,r){return t("span",{attrs:{title:e.i18nService.getLangReadable(n)}},[e._v(e._s(n+(r<e.currentLanguages.length-1?", ":"")))])}))],2):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportDictionaries,expression:"options.exportDictionaries"}],attrs:{id:"exportDictionaries",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportDictionaries)?e._i(e.options.exportDictionaries,null)>-1:e.options.exportDictionaries},on:{change:function(t){var n=e.options.exportDictionaries,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportDictionaries",n.concat([null])):o>-1&&e.$set(e.options,"exportDictionaries",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportDictionaries",i)}}}),e._v(" "),t("label",{attrs:{for:"exportDictionaries"}},[e._v(e._s(e.$t("exportDictionaries")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportUserSettings,expression:"options.exportUserSettings"}],attrs:{id:"exportUserSettings",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportUserSettings)?e._i(e.options.exportUserSettings,null)>-1:e.options.exportUserSettings},on:{change:function(t){var n=e.options.exportUserSettings,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportUserSettings",n.concat([null])):o>-1&&e.$set(e.options,"exportUserSettings",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportUserSettings",i)}}}),e._v(" "),t("label",{attrs:{for:"exportUserSettings"}},[e._v(e._s(e.$t("exportUserSettingsAndInputConfig")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportGlobalGrid,expression:"options.exportGlobalGrid"}],attrs:{id:"exportGlobalGrid",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportGlobalGrid)?e._i(e.options.exportGlobalGrid,null)>-1:e.options.exportGlobalGrid},on:{change:function(t){var n=e.options.exportGlobalGrid,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportGlobalGrid",n.concat([null])):o>-1&&e.$set(e.options,"exportGlobalGrid",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportGlobalGrid",i)}}}),e._v(" "),t("label",{attrs:{for:"exportGlobalGrid"}},[e._v(e._s(e.$t("exportGlobalGrid")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportOBZ,expression:"options.exportOBZ"}],attrs:{id:"exportOBZ",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportOBZ)?e._i(e.options.exportOBZ,null)>-1:e.options.exportOBZ},on:{change:function(t){var n=e.options.exportOBZ,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportOBZ",n.concat([null])):o>-1&&e.$set(e.options,"exportOBZ",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportOBZ",i)}}}),e._v(" "),t("label",{attrs:{for:"exportOBZ"}},[e._v(e._s(e.$t("exportOBZ")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedGrid&&e.allChildren&&e.allChildren.length>0,expression:"selectedGrid && allChildren && allChildren.length > 0"}],staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.exportConnected,expression:"options.exportConnected"}],attrs:{id:"exportConnected",type:"checkbox"},domProps:{checked:Array.isArray(e.options.exportConnected)?e._i(e.options.exportConnected,null)>-1:e.options.exportConnected},on:{change:function(t){var n=e.options.exportConnected,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"exportConnected",n.concat([null])):o>-1&&e.$set(e.options,"exportConnected",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"exportConnected",i)}}}),e._v(" "),t("label",{attrs:{for:"exportConnected"}},[t("span",[e._v(e._s(e.$t("exportAllChildGrids")))]),e._v(" "),t("span",[e._v("("+e._s(e.allChildren?e.allChildren.length:0)+" "),t("span",[e._v(e._s(e.$t("grids")))]),e._v(")")])])])])]),e._v(" "),t("div",{staticClass:"modal-footer modal-footer-flex"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("downloadBackup")))])])])])])])])])};sf._withStripped=!0;let lf={LANG_EXPORT_CURRENT:"LANG_EXPORT_CURRENT",LANG_EXPORT_ALL:"LANG_EXPORT_ALL"};const cf={props:["gridsData","exportOptions"],data:function(){return{selectedGrid:null,globalGridId:null,graphList:[],allChildren:null,options:{exportConnected:!0,exportDictionaries:!0,exportUserSettings:!0,exportGlobalGrid:!0,exportOBZ:!1,exportLang:lf.LANG_EXPORT_ALL,exportLangOptions:[lf.LANG_EXPORT_ALL,lf.LANG_EXPORT_CURRENT]},constants:lf,i18nService:o.A}},computed:{currentLanguages:function(){let e=this.selectedGrid?[this.selectedGrid]:this.gridsData,t=[];for(let n of e)for(let e of n.gridElements)t=[...new Set(t.concat(Object.keys(e.label)))];return t}},methods:{selectedGridChanged(){this.selectedGrid&&(this.allChildren=Ge.b.getAllChildrenRecursive(this.graphList,this.selectedGrid.id))},save(){let e=this.selectedGrid?[this.selectedGrid.id]:this.gridsData.map((e=>e.id));this.selectedGrid&&this.options.exportConnected&&(e=e.concat(this.allChildren.map((e=>e.id))));let t=n.w.getAutologinUser(),r=null;r=1===e.length&&this.selectedGrid?`${t}_${ee.Z.getCurrentDateTimeString()}_${o.A.getTranslation(this.selectedGrid.label)}`:`${t}_${ee.Z.getCurrentDateTimeString()}_asterics-grid-custom-backup`,xg.downloadToFile(e,{exportGlobalGrid:this.options.exportGlobalGrid,exportOnlyCurrentLang:this.options.exportLang===lf.LANG_EXPORT_CURRENT,exportDictionaries:this.options.exportDictionaries,exportUserSettings:this.options.exportUserSettings,filename:r,obzFormat:this.options.exportOBZ,progressFn:(e,t)=>{fg.showProgressBar(e,{header:o.A.t("exportToFile"),text:t})}}),this.$emit("close")},openHelp(){Qc.openHelp()}},mounted(){xg.getGlobalGrid().then((e=>{if(this.globalGridId=e?e.id:null,this.graphList=Ge.b.getGraphList(this.gridsData,this.globalGridId,!0),this.exportOptions.gridId)for(let e of this.graphList)this.exportOptions.gridId===e.grid.id&&(this.selectedGrid=e.grid,this.selectedGridChanged());this.exportOptions&&(this.options=Object.assign(this.options,this.exportOptions))}))},beforeDestroy(){Qc.revertToLastLocation()}},df=cf;var uf=s(7065),hf={};hf.styleTagTransform=Ed(),hf.setAttributes=gd(),hf.insert=vd().bind(null,"head"),hf.domAPI=hd(),hf.insertStyleElement=yd(),dd()(uf.A,hf),uf.A&&uf.A.locals&&uf.A.locals;const pf=Cd(df,sf,[],!1,null,"0e17f0f0",null).exports;var vf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-container-flex",on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$emit("close")},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("div",{staticClass:"container-fluid px-0 mb-5"},[t("div",{staticClass:"row"},[t("div",{staticClass:"modal-header col-8 col-sm-10 col-md-10"},[t("h1",{staticClass:"inline"},[e._v(e._s(e.$t("importDataFromFile")))])]),e._v(" "),t("a",{staticClass:"col-2 col-sm-1 col-md black",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("a",{staticClass:"col-2 col-sm-1 col-md black",attrs:{href:"javascript:void(0);",title:e.$t("close")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})])])]),e._v(" "),t("div",{staticClass:"modal-body mt-2"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6 mb-2"},[t("label",{staticClass:"me-3",attrs:{for:"fileInput"}},[e._v(e._s(e.$t("selectFile")))]),e._v(" "),t("input",{attrs:{id:"fileInput",type:"file",accept:".grd, .txt"},on:{change:e.fileChanged}})]),e._v(" "),e.file&&!e.importData?t("div",{staticClass:"col-12 col-md-6"},[e._v(e._s(e.$t("backupFileDoesntContainData")))]):e._e(),e._v(" "),e.importData?t("div",{staticClass:"col-12 col-md-6"},[t("ul",[e.hasGrids?t("li",[t("span",{attrs:{title:e.importData.grids.map((t=>e.i18nService.getTranslation(t.label)))}},[e._v(e._s(e.importData.grids.length)+" grid(s)")])]):e._e(),e._v(" "),e.hasDictionaries?t("li",[t("span",{attrs:{title:e.importData.dictionaries.map((e=>e.dictionaryKey))}},[e._v(e._s(e.$t("numDictionaries",{length:e.importData.dictionaries.length})))])]):e._e(),e._v(" "),e.hasUserSettings?t("li",[e._v(e._s(e.$t("userSettings")))]):e._e()])]):e._e()]),e._v(" "),e.hasDictionaries?t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.importDictionaries,expression:"options.importDictionaries"}],attrs:{id:"importDictionaries",type:"checkbox"},domProps:{checked:Array.isArray(e.options.importDictionaries)?e._i(e.options.importDictionaries,null)>-1:e.options.importDictionaries},on:{change:function(t){var n=e.options.importDictionaries,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"importDictionaries",n.concat([null])):o>-1&&e.$set(e.options,"importDictionaries",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"importDictionaries",i)}}}),e._v(" "),t("label",{attrs:{for:"importDictionaries"}},[e._v(e._s(e.$t("importDictionaries")))])])]):e._e(),e._v(" "),e.hasUserSettings?t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.importUserSettings,expression:"options.importUserSettings"}],attrs:{id:"importUserSettings",type:"checkbox"},domProps:{checked:Array.isArray(e.options.importUserSettings)?e._i(e.options.importUserSettings,null)>-1:e.options.importUserSettings},on:{change:function(t){var n=e.options.importUserSettings,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"importUserSettings",n.concat([null])):o>-1&&e.$set(e.options,"importUserSettings",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"importUserSettings",i)}}}),e._v(" "),t("label",{attrs:{for:"importUserSettings"}},[e._v(e._s(e.$t("importUserSettings")))])])]):e._e(),e._v(" "),e.importData&&!e.hasGlobalGrid?t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.generateGlobalGrid,expression:"options.generateGlobalGrid"}],attrs:{id:"generateGlobalGrid",type:"checkbox"},domProps:{checked:Array.isArray(e.options.generateGlobalGrid)?e._i(e.options.generateGlobalGrid,null)>-1:e.options.generateGlobalGrid},on:{change:function(t){var n=e.options.generateGlobalGrid,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"generateGlobalGrid",n.concat([null])):o>-1&&e.$set(e.options,"generateGlobalGrid",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"generateGlobalGrid",i)}}}),e._v(" "),t("label",{attrs:{for:"generateGlobalGrid"}},[e._v(e._s(e.$t("generateGlobalGrid")))])])]):e._e(),e._v(" "),t("div",{staticClass:"row"},[t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.options.resetBeforeImport,expression:"options.resetBeforeImport"}],attrs:{id:"resetBeforeImport",type:"checkbox"},domProps:{checked:Array.isArray(e.options.resetBeforeImport)?e._i(e.options.resetBeforeImport,null)>-1:e.options.resetBeforeImport},on:{change:function(t){var n=e.options.resetBeforeImport,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.options,"resetBeforeImport",n.concat([null])):o>-1&&e.$set(e.options,"resetBeforeImport",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.options,"resetBeforeImport",i)}}}),e._v(" "),t("label",{attrs:{for:"resetBeforeImport"}},[e._v(e._s(e.$t("deleteExistingDataBeforeImporting")))])])])]),e._v(" "),t("div",{staticClass:"modal-footer modal-footer-flex"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{disabled:!this.importData,title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("importData")))])])])])])])])])};vf._withStripped=!0;const mf={props:["gridsData","reloadFn"],data:function(){return{data:null,file:null,importData:null,options:{importDictionaries:!0,importUserSettings:!0,generateGlobalGrid:!1,resetBeforeImport:!1},i18nService:o.A}},computed:{hasGrids(){return this.importData&&this.importData.grids&&this.importData.grids.length>0},hasDictionaries(){return this.importData&&this.importData.dictionaries&&this.importData.dictionaries.length>0},hasUserSettings(){return this.importData&&this.importData.metadata&&this.importData.metadata.inputConfig},hasGlobalGrid(){return this.hasGrids&&this.importData.metadata&&this.importData.metadata.globalGridId&&this.importData.grids.map((e=>e.id)).includes(this.importData.metadata.globalGridId)}},methods:{async fileChanged(e){this.file=e.target.files[0],this.importData=null,this.file&&(this.importData=await xg.convertFileToImportData(this.file))},async save(){!this.importData||this.options.resetBeforeImport&&!confirm(o.A.t("doYouWantToDeleteBeforeImporting"))||(this.$emit("close"),this.options.resetBeforeImport&&(fg.showProgressBar(0,{header:o.A.t("importDataFromFile"),text:o.A.t("deletingGrids")}),await xg.deleteAllGrids(),await xg.deleteAllDictionaries()),fg.showProgressBar(20,{header:o.A.t("importDataFromFile"),text:o.A.t("importingData")}),await xg.importData(this.importData,{importDictionaries:this.options.importDictionaries,importUserSettings:this.options.importUserSettings,generateGlobalGrid:this.options.generateGlobalGrid,resetBeforeImport:this.options.resetBeforeImport,progressFn:e=>{fg.showProgressBar(20+Math.round(e/100*80),{header:o.A.t("importDataFromFile"),text:o.A.t("importingData")})}}),this.options.resetBeforeImport&&await xg.markCurrentConfigAsBackedUp(),fg.showProgressBar(100),this.reloadFn&&this.reloadFn())},openHelp(){Qc.openHelp()}},mounted(){},beforeDestroy(){Qc.revertToLastLocation()}};var gf=s(6093),ff={};ff.styleTagTransform=Ed(),ff.setAttributes=gd(),ff.insert=vd().bind(null,"head"),ff.domAPI=hd(),ff.insertStyleElement=yd(),dd()(gf.A,ff),gf.A&&gf.A.locals&&gf.A.locals;const yf=Cd(mf,vf,[],!1,null,"322ab068",null).exports;var _f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"p-4"},[t("h2",{staticClass:"my-3"},[e._v(e._s(e.$t("chooseHowToStart")))]),e._v(" "),t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"mt-2 mb-5 row"},[t("a",{staticClass:"col-12 col-lg",attrs:{href:"javascript:;"},on:{click:function(t){return e.restoreBackupHandler()}}},[t("span",{staticClass:"fas fa-upload"}),e._v(" "+e._s(e.$t("restoreBackupFromFile")))]),e._v(" "),t("a",{staticClass:"col-12 col-lg",attrs:{href:"javascript:;"},on:{click:function(t){return e.importCustomHandler()}}},[t("span",{staticClass:"fas fa-file-import"}),e._v(" "+e._s(e.$t("importCustomDataFromFile")))])])]),e._v(" "),t("div",{staticClass:"my-3"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],staticClass:"col-12",attrs:{id:"searchBar",type:"text","aria-label":e.$t("search"),placeholder:e.$t("search")},domProps:{value:e.searchTerm},on:{input:[function(t){t.target.composing||(e.searchTerm=t.target.value)},e.search]}}),e._v(" "),t("accordion",{staticClass:"mt-3",attrs:{"acc-label":e.$t("moreSearchOptions")}},[t("div",{staticClass:"container-fluid p-0"},[t("div",{staticClass:"row mt-2"},[t("label",[e._v(e._s(e.$t("language")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.searchOptions.lang,expression:"searchOptions.lang"}],on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.searchOptions,"lang",t.target.multiple?n:n[0])},e.search]}},[t("option",{attrs:{value:""}},[e._v("(all)")]),e._v(" "),e._l(e.selectLanguages,(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")])}))],2)]),e._v(" "),t("div",{staticClass:"row"},[t("label",[e._v(e._s(e.$t("type")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.searchOptions.type,expression:"searchOptions.type"}],on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.searchOptions,"type",t.target.multiple?n:n[0])},e.search]}},[t("option",{attrs:{value:""}},[e._v("(all)")]),e._v(" "),t("option",{domProps:{value:e.constants.BOARD_TYPE_SELFCONTAINED}},[e._v(e._s(e.$t(e.constants.BOARD_TYPE_SELFCONTAINED)))]),e._v(" "),t("option",{domProps:{value:e.constants.BOARD_TYPE_SINGLE}},[e._v(e._s(e.$t(e.constants.BOARD_TYPE_SINGLE)))])])])])])],1),e._v(" "),e.gridPreviews?t("div",{staticClass:"mt-5"},[t("ul",{attrs:{id:"boardGrid"}},e._l(e.gridPreviews,(function(n){return t("li",[t("div",{staticClass:"preview-content"},[t("strong",{staticClass:"d-block mb-3"},[e._v(e._s(e._f("extractTranslation")(n.name)))]),e._v(" "),n.thumbnail?t("img",{staticStyle:{width:"100%","aspect-ratio":"16/9"},attrs:{"aria-hidden":"true",src:n.thumbnail}}):e._e(),e._v(" "),n.thumbnail?e._e():t("div",{staticClass:"img-placeholder mb-3",staticStyle:{"aspect-ratio":"16/9",width:"99%",border:"1px solid lightgray"}}),e._v(" "),t("div",{staticClass:"d-flex col-12",staticStyle:{"flex-wrap":"wrap"}},[t("span",{staticClass:"tag",staticStyle:{"background-color":"lightgreen"}},[e._v(e._s(1===n.languages.length?e.$t(`lang.${n.languages[0]}`):"multi-lang"))]),e._v(" "),e._l(n.tags,(function(n){return t("span",{staticClass:"tag",staticStyle:{"background-color":"lightgray"}},[e._v(e._s(n))])}))],2)]),e._v(" "),t("div",{staticClass:"preview-buttons d-flex justify-content-between"},[t("button",{on:{click:function(t){e.detailPreview=n}}},[t("span",{staticClass:"fa fa-info-circle"}),e._v(" "+e._s(e.$t("details")))]),e._v(" "),t("button",{staticClass:"btn-primary",on:{click:function(t){return e.importData(n)}}},[t("span",{staticClass:"fa fa-check"}),e._v(" "+e._s(e.$t("useIt")))])])])})),0)]):e._e(),e._v(" "),e.detailPreview?t("config-preview-detail",{attrs:{preview:e.detailPreview},on:{close:function(t){e.detailPreview=null},import:function(t){return e.importData(e.detailPreview)}}}):e._e()],1)};_f._withStripped=!0;var Ef=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",[e._v(e._s(e._f("extractTranslation")(e.preview.name)))])]),e._v(" "),t("div",{staticClass:"modal-body"},[e.preview.images.length>1?t("div",{staticClass:"mb-5",staticStyle:{"overflow-x":"auto"},attrs:{"aria-hidden":"true"}},[t("ul",{staticClass:"d-flex mb-0"},e._l(e.preview.images,(function(n){return t("li",{staticClass:"me-3 mb-0"},[t("img",{staticStyle:{cursor:"pointer"},attrs:{src:n,width:"200"},on:{click:function(t){e.selectedImage=n}}})])})),0)]):e._e(),e._v(" "),t("div",{staticClass:"container-fluid p-0"},[t("div",{staticClass:"row",attrs:{"aria-hidden":"true"}},[e.selectedImage?t("div",{staticClass:"col-12 col-md-7"},[t("img",{staticClass:"col-12",attrs:{src:e.selectedImage}})]):e._e(),e._v(" "),t("div",{staticClass:"col-12 col-md-5"},[e.preview.author?t("div",{staticClass:"mb-3"},[t("strong",[e._v(e._s(e.$t("author")))]),e._v(":\n                                    "),e.preview.website?e._e():t("span",[e._v(e._s(e.preview.author))]),e._v(" "),e.preview.website?t("a",{attrs:{href:e.preview.website,target:"_blank"}},[e._v(e._s(e.preview.author))]):e._e()]):e._e(),e._v(" "),e.preview.description?t("div",{staticClass:"mb-3"},[t("strong",[e._v(e._s(e.$t("description")))]),e._v(": "),t("span",{domProps:{innerHTML:e._s(e.i18nService.getTranslation(e.preview.description))}})]):e._e(),e._v(" "),1===e.preview.languages.length?t("div",[t("strong",[e._v(e._s(e.$t("language")))]),e._v(": "+e._s(e.$t("lang."+e.preview.languages[0])))]):e._e(),e._v(" "),e.preview.languages.length>1?t("div",[t("strong",[e._v(e._s(e.$t("languages")))]),e._v(": "+e._s(e.preview.languages.reduce(((t,n,r,i)=>{let o=r<i.length-1?", ":"";return t+e.$t("lang."+n)+o}),""))+"\n                                ")]):e._e(),e._v(" "),e.preview.tags.length>0?t("div",{staticClass:"mt-3"},[t("strong",[e._v(e._s(e.$t("tags")))]),e._v(":\n                                    "),e._l(e.preview.tags,(function(n){return t("span",{staticClass:"tag",staticStyle:{"background-color":"lightgray"}},[e._v(e._s(n))])}))],2):e._e(),e._v(" "),e.preview.githubUrl?t("div",{staticClass:"mt-5"},[t("a",{attrs:{href:e.preview.githubUrl,target:"_blank"}},[t("i",{staticClass:"fab fa-github"}),e._v(" "+e._s(e.$t("editOnGithub")))])]):e._e()])]),e._v(" "),t("div",{staticClass:"mt-3"},[t("a",{staticClass:"me-2",attrs:{href:"javascript:;"},on:{click:e.copyLink}},[e._v(e._s(e.$t("copyDirectLinkToConfigToClipboard")))]),e._v(" "),e.linkCopied?t("span",{staticClass:"fas fa-check"}):e._e()])])]),e._v(" "),t("div",{staticClass:"modal-footer container-fluid p-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6"},[t("button",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"col-12",attrs:{id:"cancelButton",title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])])]),e._v(" "),t("div",{staticClass:"col-12 col-md-6"},[t("button",{staticClass:"col-12 btn-primary",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("useIt")))])])])])])])])])])};Ef._withStripped=!0;const bf={props:["preview"],data:function(){return{selectedImage:this.preview.images[0],i18nService:o.A,linkCopied:!1}},methods:{save(){this.$emit("import"),this.$emit("close")},copyLink(){let e=location.origin+location.pathname+`?${h.params.PARAM_USE_GRIDSET_FILENAME}=${this.preview.filename}`;ee.Z.copyToClipboard(e),this.linkCopied=!0}},mounted(){}};var Sf=s(4932),Cf={};Cf.styleTagTransform=Ed(),Cf.setAttributes=gd(),Cf.insert=vd().bind(null,"head"),Cf.domAPI=hd(),Cf.insertStyleElement=yd(),dd()(Sf.A,Cf),Sf.A&&Sf.A.locals&&Sf.A.locals;const wf={components:{ConfigPreviewDetail:Cd(bf,Ef,[],!1,null,"4fd87d9d",null).exports,Accordion:Gg},props:["restoreBackupHandler","importCustomHandler","resetGlobalGrid"],data:()=>({gridPreviews:[],selectedGridset:null,loading:!1,i18nService:o.A,linkCopied:!1,searchTerm:"",searchOptions:{lang:"",type:C.A.BOARD_TYPE_SELFCONTAINED},allLanguages:o.A.getAllLanguages(),selectLanguages:[],constants:C.A,detailPreview:null}),methods:{search(){ee.Z.debounce((async()=>{this.gridPreviews=await bg.query(this.searchTerm,this.searchOptions)}),300,"SEARCH_BOARDS")},importData(e){let t=this;this.loading=!0,xg.importBackupFromPreview(e,{progressFn:(e,t)=>{fg.showProgressBar(e,{header:o.A.t("importingData"),text:t})}}).then((async()=>{t.loading=!1,e.translate?TA.toEditGrid():TA.toMain()}))}},async mounted(){let e=this;e.gridPreviews=await bg.query(),e.selectLanguages=this.allLanguages.filter((e=>this.gridPreviews.some((t=>t.languages.includes(e.code))))),e.searchOptions.lang=e.selectLanguages.map((e=>e.code)).includes(o.A.getAppLang())?o.A.getAppLang():"",e.gridPreviews=await bg.query("",e.searchOptions)},beforeDestroy(){}};var Af=s(8874),Tf={};Tf.styleTagTransform=Ed(),Tf.setAttributes=gd(),Tf.insert=vd().bind(null,"head"),Tf.domAPI=hd(),Tf.insertStyleElement=yd(),dd()(Af.A,Tf),Af.A&&Af.A.locals&&Af.A.locals;const If=Cd(wf,_f,[],!1,null,"70e4a517",null).exports;let kf="AG_ALLGRIDS_ORDER_MODE_KEY",Of={CONNECTED_GRIDS:"CONNECTED_GRIDS",NOT_REACHABLE_GRIDS:"NOT_REACHABLE_GRIDS",ALL_GRIDS:"ALL_GRIDS"},Rf={ALPHABET:"ALPHABET",CONNECTION_COUNT:"CONNECTION_COUNT"},xf=null,Nf={components:{NoGridsPage:If,ImportModal:yf,ExportModal:pf,ExportPdfModal:af,GridLinkModal:Wg,Accordion:Gg,HeaderIcon:Pg},data:()=>({metadata:null,grids:null,graphList:[],selectedGraphElement:null,newLabel:{},showLoading:!0,SELECT_VALUES:Of,ORDER_VALUES:Rf,selectValue:null,orderValue:n.w.get(kf)||Rf.CONNECTION_COUNT,linkModal:{show:!1,gridFrom:null,gridTo:null},pdfModal:{show:!1,printGridId:null},backupModal:{show:!1,exportOptions:{}},importModal:{show:!1},i18nService:o.A,currentLanguage:o.A.getContentLang(),imageUtil:ue.M}),methods:{importBackup(){document.getElementById("inputFileBackup").click()},setSelectedGraphElement(e,n){e&&(this.selectedGraphElement=e,this.newLabel=JSON.parse(JSON.stringify(this.selectedGraphElement.grid.label)),this.reinitContextMenu(),this.metadata.lastOpenedGridId=e.grid.id,xg.saveMetadata(this.metadata),n||(0,t.A)(".all-grids-view").animate({scrollTop:0},200))},reinitContextMenu(){!function(){t.A.contextMenu("destroy");let e=xf.selectedGraphElement?o.A.getTranslation(xf.selectedGraphElement.grid.label):"",n={CONTEXT_CONNECT:{name:o.A.t("connectXWithThisGrid",e),icon:"fas fa-external-link-alt",visible:()=>xf.selectValue!==xf.SELECT_VALUES.CONNECTED_GRIDS},CONTEXT_SHOW:{name:o.A.t("show"),icon:"far fa-eye"},CONTEXT_EDIT:{name:o.A.t("edit"),icon:"far fa-edit"},CONTEXT_DUPLICATE:{name:o.A.t("clone"),icon:"far fa-clone"},CONTEXT_DELETE:{name:o.A.t("delete"),icon:"far fa-trash-alt"},CONTEXT_EXPORT:{name:o.A.t("export"),icon:"fas fa-file-export"},CONTEXT_EXPORT_PDF:{name:o.A.t("saveAsPdf"),icon:"far fa-file-pdf"}};t.A.contextMenu({selector:".gridOptions",callback:function(e,t){!function(e,t){switch(e){case"CONTEXT_CONNECT":xf.linkModal.gridFrom=xf.selectedGraphElement.grid,xf.linkModal.gridTo=xf.grids.filter((e=>e.id===t))[0],xf.linkModal.show=!0;break;case"CONTEXT_SHOW":xf.show(t);break;case"CONTEXT_EDIT":xf.edit(t);break;case"CONTEXT_DUPLICATE":xf.clone(t);break;case"CONTEXT_DELETE":xf.deleteGrid(t);break;case"CONTEXT_EXPORT":xf.exportCustom(t);break;case"CONTEXT_EXPORT_PDF":xf.exportToPdf(t)}}(e,t.$trigger.attr("data-grid-id"))},trigger:"left",items:n,zIndex:10})}(),function(){let e=()=>0===xf.grids.length;var n={CONTEXT_NEW:{name:o.A.t("newGrid"),icon:"fas fa-plus"},SEP1:"---------",CONTEXT_EXPORT:{name:o.A.t("exportBackupToFile"),icon:"fas fa-download",disabled:e},CONTEXT_EXPORT_CUSTOM:{name:o.A.t("saveCustomDataToFile"),icon:"fas fa-file-export",disabled:e},CONTEXT_EXPORT_PDF_MODAL:{name:o.A.t("saveGridsToPdfGrids"),icon:"far fa-file-pdf",disabled:e},SEP2:"---------",CONTEXT_IMPORT_BACKUP:{name:o.A.t("restoreBackupFromFile"),icon:"fas fa-upload"},CONTEXT_IMPORT:{name:o.A.t("importCustomDataFromFile"),icon:"fas fa-file-import"},SEP3:"---------",CONTEXT_RESET:{name:o.A.t("resetToDefaultConfig"),icon:"fas fa-minus-circle",disabled:e}};t.A.contextMenu({selector:"#moreButton",appendTo:"#moreButtonMenu",callback:function(e,t){!function(e){switch(e){case"CONTEXT_NEW":xf.addGrid();break;case"CONTEXT_IMPORT":xf.importModal.show=!0;break;case"CONTEXT_IMPORT_BACKUP":xf.importBackup();break;case"CONTEXT_EXPORT_PDF_MODAL":xf.pdfModal.show=!0;break;case"CONTEXT_EXPORT":xf.exportBackup();break;case"CONTEXT_EXPORT_CUSTOM":xf.exportCustom();break;case"CONTEXT_RESET":xf.deleteAll()}}(e)},trigger:"left",items:n,zIndex:10})}()},orderChanged(){n.w.save(kf,this.orderValue),this.reinitContextMenu()},deleteGrid:function(e){log.debug("delete: "+e);let t=o.A.getTranslation(this.grids.filter((t=>t.id===e))[0].label);confirm(o.A.t("CONFIRM_DELETE_GRID",t))&&xg.deleteGrid(e).then((()=>{this.reload()}))},addGrid:function(){var e=this.grids.map((e=>o.A.getTranslation(e.label))),n=new c.D({label:o.A.getTranslationObject(u.S.getNewName("newGrid",e)),gridElements:[]});xg.saveGrid(n).then((()=>this.reload(n.id))).then((()=>{(0,t.A)("#gridName").focus()}))},isLabelDuplicate:function(e){return!e||this.grids.map((e=>o.A.getTranslation(e.label))).filter((t=>t===e)).length>0},saveGridLabel(){this.selectedGraphElement.grid.label=JSON.parse(JSON.stringify(this.newLabel)),xg.updateGrid(this.selectedGraphElement.grid.id,{label:this.newLabel})},show(e){TA.toGrid(e)},edit(e){TA.toEditGrid(e)},clone(e){var t=this;xg.getGrid(e).then((e=>{let n=e.clone();xg.saveGrid(n).then((()=>{t.reload(n.id)}))}))},exportBackup(){xg.downloadBackupToFile()},exportCustom(e){e?(this.backupModal.exportOptions.gridId=e,this.backupModal.exportOptions.exportDictionaries=!1,this.backupModal.exportOptions.exportUserSettings=!1,this.backupModal.exportOptions.exportGlobalGrid=!1):this.backupModal.exportOptions={},this.backupModal.show=!0},exportToPdf(e){this.pdfModal.printGridId=e,this.pdfModal.show=!0},importBackupFromFile:async function(e){let t=e&&e.target&&e.target.files[0]?e.target.files[0]:null,n=t?t.name:"";n&&(this.grids.length>0&&!confirm(o.A.t("CONFIRM_IMPORT_BACKUP",n))?this.resetFileInput(e):(await xg.importBackupUploadedFile(t,((e,t)=>{fg.showProgressBar(e,{text:t})})),this.resetFileInput(e),this.reload()))},reload:function(e){let t=this;return xg.getMetadata().then((e=>(t.metadata=JSON.parse(JSON.stringify(e)),xg.getGrids()))).then((n=>{t.selectedGraphElement=null,t.grids=JSON.parse(JSON.stringify(n)),t.showLoading=!1,t.graphList=Ge.b.getGraphList(t.grids,t.metadata.globalGridId);let r=e||t.metadata.lastOpenedGridId;return t.setSelectedGraphElement(t.graphList.filter((e=>e.grid.id===r))[0]||t.graphList[0],!0),Promise.resolve()}))},onPullUpdate(){let e=this.selectedGraphElement?this.selectedGraphElement.grid.id:null;this.reload(e)},deleteAll(){confirm(o.A.t("doYouReallyWantDeleteAllGrids"))&&(this.showLoading=!0,xg.deleteAllGrids().then((()=>{this.reload()})))},async deleteImages(){if(confirm(o.A.t("doYouReallyWantDeleteAllImages"))){fg.showProgressBar(10,{text:o.A.t("retrievingGrids")});let e=await xg.getGrids(!0,!0);fg.showProgressBar(50,{text:o.A.t("Deleting images and saving grids ...")});for(let t of e)for(let e of t.gridElements)e.image=new ce.q;await xg.saveGrids(e),fg.showProgressBar(100)}},setGlobalGridActive(e){if(!this.hasGlobalGrid)return this.resetGlobalGrid({reload:!0});this.metadata.globalGridActive=e,xg.saveMetadata(this.metadata)},async homeGridChanged(){if(xg.saveMetadata(this.metadata),this.metadata.homeGridId){let e=await xg.getGlobalGrid();if(e){let t=Ge.b.getActionsOfType(e.gridElements[0],D.g.getModelName());t.length>0&&(t[0].navType=D.g.NAV_TYPES.TO_HOME,await xg.saveGrid(e))}}},resetGlobalGrid(e){if(!(e=e||{}).confirm||confirm(o.A.t("doYouReallyWantResetGlobalGrid")))return xg.getGlobalGrid(!0).then((e=>e?xg.deleteGrid(e.id):Promise.resolve())).then((()=>{let t=Ge.b.generateGlobalGrid(null,{convertToLowercase:e.convertToLowercase});return this.metadata.globalGridId=t.id,this.metadata.globalGridActive=!0,this.metadata.globalGridHeightPercentage=(new d.e).globalGridHeightPercentage,xg.saveGrid(t)})).then((()=>xg.saveMetadata(this.metadata))).then((()=>(e.reload&&this.reload(),Promise.resolve())))},resetFileInput(e){var n=(0,t.A)(e.target);n.wrap("<form>").closest("form").get(0).reset(),n.unwrap()},async updateAllThumbnails(){if(!confirm(o.A.t("updateGridThumbnailsConfirm")))return;let e=0,n=!1;async function r(t){let n=await xg.getGrid(t);await ue.M.allImagesLoaded();let r=await ue.M.getScreenshot("#grid-container");log.info(`save screenshot for: ${o.A.getTranslation(n.label)}, size: ${r.length/1024}kB`),e+=r.length;let i={data:r,hash:Ge.b.getHash(n)};n.thumbnail=i,await xg.updateGrid(n.id,{thumbnail:i})}xg.getGrids(!1,!0).then((async i=>{let a=0;fg.showProgressBar(0,{header:o.A.t("updateGridThumbnails"),text:o.A.t("generatingThumbnails"),closable:!0,cancelFn:()=>{n=!0}});for(const e of i){if(n)return void TA.toManageGrids();let s=new Promise((e=>{(0,t.A)(document).on(C.A.EVENT_GRID_LOADED,e)}));if(TA.toGrid(e.id,{skipThumbnailCheck:!0}),await s,await ee.Z.sleep(100),await r(e.id),n)return void TA.toManageGrids();a++,fg.showProgressBar(Math.round(a/i.length*100),{header:o.A.t("updateGridThumbnails"),text:o.A.t("generatingThumbnails"),closable:!0,cancelFn:()=>{n=!0}})}h.removeParam("skipThumbnailCheck"),log.info(`saved all thumbnails with total size of ${e/1024}kB`),TA.toManageGrids(),setTimeout((()=>{fg.setTooltip(o.A.t("updatedAllThumbnails"),{timeout:2e4,msgType:"success"})}),500)}))}},computed:{headerDetails:function(){return this.selectedGraphElement?o.A.t("detailsForGridX",`"${o.A.getTranslation(this.selectedGraphElement.grid.label)}"`):""},connectedGridsOptionLabel:function(){return this.selectedGraphElement?o.A.t("gridsConnectedWithX",o.A.getTranslation(this.selectedGraphElement.grid.label)):""},hasGlobalGrid:function(){return!(!this.grids||!this.metadata)&&this.metadata.globalGridId&&!!this.grids.filter((e=>e.id===this.metadata.globalGridId))[0]},graphElemsToShow:function(){if(!this.graphList||!this.selectedGraphElement)return[];let e=[];switch(this.selectValue){case this.SELECT_VALUES.CONNECTED_GRIDS:e=this.selectedGraphElement.allRelatives;break;case this.SELECT_VALUES.NOT_REACHABLE_GRIDS:e=this.graphList.filter((e=>0===e.parents.length&&e.grid.id!==this.metadata.homeGridId));break;case this.SELECT_VALUES.ALL_GRIDS:e=this.graphList}switch(this.orderValue){case this.ORDER_VALUES.ALPHABET:e=e.sort(((e,t)=>o.A.getTranslation(e.grid.label).localeCompare(o.A.getTranslation(t.grid.label))));break;case this.ORDER_VALUES.CONNECTION_COUNT:e=e=e.sort(((e,t)=>t.allRelatives.length-e.allRelatives.length))}return e}},created(){(0,t.A)(document).on(C.A.EVENT_DB_PULL_UPDATED,this.onPullUpdate)},mounted:function(){let e=this;xf=e,e.selectValue=this.SELECT_VALUES.ALL_GRIDS,e.reload().then((()=>{this.reinitContextMenu()})),window.deleteImages=this.deleteImages},beforeDestroy(){(0,t.A)(document).off(C.A.EVENT_DB_PULL_UPDATED,this.onPullUpdate),t.A.contextMenu("destroy")}};const Df=Nf;var Lf=s(4266),Pf={};Pf.styleTagTransform=Ed(),Pf.setAttributes=gd(),Pf.insert=vd().bind(null,"head"),Pf.domAPI=hd(),Pf.insertStyleElement=yd(),dd()(Lf.A,Pf),Lf.A&&Lf.A.locals&&Lf.A.locals;const Mf=Cd(Df,Dg,[function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"grid-container grid-mask"},[e("i",{staticClass:"fas fa-4x fa-spinner fa-spin",staticStyle:{position:"relative"}})])}],!1,null,"500d6526",null).exports;var Uf=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"box"},[t("header",{directives:[{name:"show",rawName:"v-show",value:!e.propTransferObject,expression:"!propTransferObject"}],staticClass:"srow header",attrs:{role:"toolbar"}},[t("header-icon",{staticClass:"left"}),e._v(" "),t("button",{staticClass:"spaced small left",attrs:{tabindex:"30","aria-label":e.$t("editingOff")},on:{click:e.back}},[t("i",{staticClass:"fas fa-eye"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("editingOff")))])]),e._v(" "),t("button",{staticClass:"spaced",attrs:{tabindex:"33",id:"moreButton","aria-label":e.$t("more")}},[t("i",{staticClass:"fas fa-ellipsis-v"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("more")))])]),e._v(" "),t("div",{attrs:{id:"moreButtonMenu"}}),e._v(" "),t("div",{staticClass:"spaced btn-group"},[t("button",{staticClass:"small",attrs:{tabindex:"31","aria-label":e.$t("undo"),disabled:e.doingUndoRedo||!e.undoService.canUndo()},on:{click:e.undo}},[t("i",{staticClass:"fas fa-undo"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("undo")))])]),e._v(" "),t("button",{staticClass:"small spaced",attrs:{tabindex:"32","aria-label":e.$t("redo"),disabled:e.doingUndoRedo||!e.undoService.canRedo()},on:{click:e.redo}},[t("i",{staticClass:"fas fa-redo"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("redo")))])])])],1),e._v(" "),e.propTransferObject?t("header",{staticClass:"d-flex align-items-center transfer-props-header",attrs:{role:"toolbar"}},[t("div",{staticClass:"me-5"},[t("strong",{staticClass:"me-2"},[t("i",{staticClass:"fas fa-angle-double-right"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline-block"},[t("span",[e._v(e._s(e.$t("transferProperties")))]),e._v(":")])]),e._v(" "),t("span",[t("span",[e._v(e._s(e.$t("selectTargetElements")))]),e._v("...")])]),e._v(" "),t("button",{staticClass:"mb-0 me-2",attrs:{title:e.$t("cancel")},on:{click:e.stopPropTransfer}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",{staticClass:"d-none d-lg-inline-block"},[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"mb-0",attrs:{title:e.$t("ok")},on:{click:e.applyPropTransfer}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",{staticClass:"d-none d-lg-inline-block"},[e._v(e._s(e.$t("ok")))])])]):e._e(),e._v(" "),t("div",[e.showEditModal?t("edit-element",{attrs:{"edit-element-id-param":e.editElementId,"undo-service":e.undoService,"grid-data-id":e.gridData.id,"new-position":e.newPosition},on:{reload:e.reload,close:function(t){e.showEditModal=!1},mark:e.markElement,actions:t=>{e.editElementId=t,e.showActionsModal=!0}}}):e._e()],1),e._v(" "),t("div",[e.showMultipleModal?t("add-multiple-modal",{attrs:{"grid-data":e.gridData,"undo-service":e.undoService},on:{reload:e.reload,close:function(t){e.showMultipleModal=!1}}}):e._e()],1),e._v(" "),t("div",[e.showGridSettingsModal?t("grid-settings-modal",{attrs:{"grid-data-param":e.gridData,"is-global-grid":e.metadata.globalGridId===e.gridData.id,"undo-service":e.undoService},on:{reload:e.reload,close:function(t){e.showGridSettingsModal=!1}}}):e._e()],1),e._v(" "),t("div",[e.showTranslateModal?t("grid-translate-modal",{attrs:{"grid-data-id":e.gridData.id},on:{close:function(t){e.showTranslateModal=!1},reload:e.reload}}):e._e()],1),e._v(" "),t("div",[e.showNavigateModal?t("set-navigation-modal",{attrs:{"grid-id":e.gridData.id,"grid-element-id":e.editElementId},on:{close:function(t){e.showNavigateModal=!1},reload:e.reload}}):e._e()],1),e._v(" "),t("div",[e.showPropTransferModal?t("transfer-props-modal",{attrs:{"grid-id":e.gridData.id,"grid-element-id":e.editElementId},on:{start:t=>e.startPropTransfer(t),close:function(t){e.showPropTransferModal=!1}}}):e._e()],1),e._v(" "),e.metadata&&e.gridData?e._e():t("div",{staticClass:"srow content",attrs:{id:"contentContainer"}},[e.showGrid?e._e():t("div",{staticClass:"grid-container grid-mask"},[t("i",{staticClass:"fas fa-4x fa-spinner fa-spin"})])]),e._v(" "),e.metadata&&e.gridData?t("div",{staticClass:"srow content d-flex",staticStyle:{"min-height":"0"}},[t("app-grid-display",{attrs:{id:"grid-container","grid-data":e.gridData,metadata:e.metadata,editable:!0},on:{changed:e.handleChange,interacted:e.onInteracted,interactstart:e.onInteractStart,interactend:e.onInteractEnd}})],1):e._e()])};Uf._withStripped=!0;var Ff=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal",on:{dragenter:e.preventDefault,dragover:e.preventDefault,drop:e.preventDefault}},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-container-flex",on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$emit("close")},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"right",39,t.key,["Right","ArrowRight"])?null:t.ctrlKey?"button"in t&&2!==t.button?null:e.nextFromKeyboard():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])?null:t.ctrlKey?"button"in t&&0!==t.button?null:e.editNext(!0):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"y",void 0,t.key,void 0)?null:t.ctrlKey?e.save(!0):null}]}},[t("div",{staticClass:"modal-header"},[t("edit-element-header",{attrs:{"grid-element":e.originalGridElement,header:e.editElementId?e.$t("editGridItem"):e.$t("newGridItem"),"close-fn":e.close,"open-help-fn":e.openHelp}})],1),e._v(" "),t("nav-tabs",{staticClass:"mb-5",attrs:{"tab-labels":Object.keys(e.possibleTabs)},on:{input:function(t){e.imageSearch=""}},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}}),e._v(" "),e.gridElement?t("div",{staticClass:"modal-body mt-2"},[e.currentTab===e.TABS.TAB_GENERAL?t("div",[e.gridElement.type===e.GridElement.ELEMENT_TYPE_NORMAL||e.gridElement.type===e.GridElement.ELEMENT_TYPE_LIVE?t("edit-element-general",{attrs:{"grid-element":e.gridElement},on:{searchImage:e.toImageSearch}}):e._e(),e._v(" "),e.gridElement.type===e.GridElement.ELEMENT_TYPE_YT_PLAYER?t("edit-element-youtube",{attrs:{"grid-element":e.gridElement}}):e._e(),e._v(" "),e.gridElement.type===e.GridElement.ELEMENT_TYPE_COLLECT?t("edit-element-collect",{attrs:{"grid-element":e.gridElement}}):e._e(),e._v(" "),e.gridElement.type===e.GridElement.ELEMENT_TYPE_MATRIX_CONVERSATION?t("edit-element-matrix",{attrs:{"grid-element":e.gridElement}}):e._e()],1):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_LIVE_DATA?t("edit-element-live",{attrs:{"grid-element":e.gridElement}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_IMAGE?t("edit-element-image",{attrs:{"grid-element":e.gridElement,"grid-data":e.gridData,"image-search":e.imageSearch}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_WORDFORMS?t("edit-element-word-forms",{attrs:{"grid-element":e.gridElement,"grid-data":e.gridData},on:{reloadData:function(t){return e.initInternal(!0)}}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_ACTIONS?t("edit-element-actions",{attrs:{"grid-element":e.gridElement,"grid-data":e.gridData}}):e._e()],1):e._e(),e._v(" "),t("div",{staticClass:"modal-footer modal-footer-flex"},[e.gridElement?t("div",{staticClass:"button-container"},[t("div",{staticClass:"srow"},[t("button",{staticClass:"four columns offset-by-four",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])]),e._v(" "),t("div",{staticClass:"hide-mobile srow"},[e.editElementId?t("div",[t("button",{staticClass:"four columns offset-by-four",attrs:{title:e.$t("keyboardCtrlLeft")},on:{click:function(t){return e.editNext(!0)}}},[t("i",{staticClass:"fas fa-angle-double-left"}),e._v(" "),t("span",[e._v(e._s(e.$t("okEditPrevious")))])]),e._v(" "),t("button",{staticClass:"four columns",attrs:{title:e.$t("keyboardCtrlRight")},on:{click:function(t){return e.editNext()}}},[t("span",[e._v(e._s(e.$t("okEditNext")))]),e._v(" "),t("i",{staticClass:"fas fa-angle-double-right"})])]):e._e(),e._v(" "),e.editElementId?e._e():t("div",[t("button",{staticClass:"four columns offset-by-eight",attrs:{title:e.$t("keyboardCtrlRight")},on:{click:function(t){return e.addNext()}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",[e._v(e._s(e.$t("okAddAnother")))])])])])]):e._e()])],1)])])])};Ff._withStripped=!0;var Bf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("nav",[t("ul",{staticClass:"d-flex",attrs:{role:"tablist"}},e._l(e.tabLabels,(function(n){return t("li",{class:n===e.currentValue?"selected":"",on:{click:function(t){return e.selectTab(n)}}},[t("a",{attrs:{role:"tab","aria-selected":n===e.currentValue,href:"javascript:;"},on:{click:function(t){return e.selectTab(n)}}},[e._v(e._s(e._f("translate")(n)))])])})),0)])])};Bf._withStripped=!0;const Gf={props:["tabLabels","value"],data(){return{currentValue:this.value}},watch:{value:function(e,t){this.currentValue=e},tabLabels:function(e,t){1===e.length&&this.selectTab(e[0])}},methods:{selectTab(e){this.currentValue=e,this.$emit("input",e)}},mounted(){}};var $f=s(2394),Vf={};Vf.styleTagTransform=Ed(),Vf.setAttributes=gd(),Vf.insert=vd().bind(null,"head"),Vf.domAPI=hd(),Vf.insertStyleElement=yd(),dd()($f.A,Vf),$f.A&&$f.A.locals&&$f.A.locals;const jf=Cd(Gf,Bf,[],!1,null,"2218e1ec",null).exports;var Kf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-2",attrs:{for:"inputLabel"}},[e._v(e._s(e.$t("label")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[e.gridElement?t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.gridElement.label[e.currentLang],expression:"gridElement.label[currentLang]"}],staticClass:"col-12",attrs:{type:"text",id:"inputLabel",placeholder:e.gridElement.type===e.GridElement.ELEMENT_TYPE_LIVE?e.$t("canIncludePlaceholderLike"):""},domProps:{value:e.gridElement.label[e.currentLang]},on:{input:function(t){t.target.composing||e.$set(e.gridElement.label,e.currentLang,t.target.value)}}}):e._e()]),e._v(" "),t("div",{staticClass:"col-sm-3"},[t("button",{staticClass:"col-12 m-0",staticStyle:{"line-height":"1.5"},attrs:{title:e.$t("searchForImages")},on:{click:function(t){return e.$emit("searchImage")}}},[t("i",{staticClass:"fas fa-search"}),e._v(" "+e._s(e.$t("searchForImages")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-2",attrs:{for:"colorCategory"}},[e._v(e._s(e.$t("colorCategory")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.colorCategory,expression:"gridElement.colorCategory"}],staticClass:"col-12",attrs:{id:"colorCategory"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"colorCategory",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l(e.colorCategories,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])}))],2)])]),e._v(" "),t("div",{staticClass:"srow mb-5"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.hidden,expression:"gridElement.hidden"}],attrs:{type:"checkbox",id:"inputHidden"},domProps:{checked:Array.isArray(e.gridElement.hidden)?e._i(e.gridElement.hidden,null)>-1:e.gridElement.hidden},on:{change:function(t){var n=e.gridElement.hidden,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"hidden",n.concat([null])):o>-1&&e.$set(e.gridElement,"hidden",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"hidden",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"inputHidden"}},[e._v(e._s(e.$t("hideElement")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("accordion",{attrs:{"acc-label":e.$t("advancedOptions")}},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-2",attrs:{for:"vocabularyLevel"}},[e._v(e._s(e.$t("vocabularyLevel")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model.number",value:e.gridElement.vocabularyLevel,expression:"gridElement.vocabularyLevel",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"vocabularyLevel"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(t){var n="_value"in t?t._value:t.value;return e._n(n)}));e.$set(e.gridElement,"vocabularyLevel",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l([...Array(10).keys()].map((e=>e+1)),(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(n))])}))],2)])]),e._v(" "),t("div",{staticClass:"srow"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.dontCollect,expression:"gridElement.dontCollect"}],attrs:{type:"checkbox",id:"inputDontCollect"},domProps:{checked:Array.isArray(e.gridElement.dontCollect)?e._i(e.gridElement.dontCollect,null)>-1:e.gridElement.dontCollect},on:{change:function(t){var n=e.gridElement.dontCollect,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"dontCollect",n.concat([null])):o>-1&&e.$set(e.gridElement,"dontCollect",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"dontCollect",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"inputDontCollect"}},[e._v(e._s(e.$t("dontAddElementToCollectElement")))])]),e._v(" "),t("div",{staticClass:"srow mb-5"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.toggleInBar,expression:"gridElement.toggleInBar"}],attrs:{type:"checkbox",id:"toggleInBar"},domProps:{checked:Array.isArray(e.gridElement.toggleInBar)?e._i(e.gridElement.toggleInBar,null)>-1:e.gridElement.toggleInBar},on:{change:function(t){var n=e.gridElement.toggleInBar,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"toggleInBar",n.concat([null])):o>-1&&e.$set(e.gridElement,"toggleInBar",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"toggleInBar",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"toggleInBar"}},[e._v(e._s(e.$t("toggleInCollectionElementIfAddedMultipleTimes")))])]),e._v(" "),t("slider-input",{attrs:{label:"fontSize",unit:"%",id:"fontSize","show-clear-button":!0,min:"0",max:"70",step:"1"},on:{input:e.resetTestGrid},model:{value:e.gridElement.fontSizePct,callback:function(t){e.$set(e.gridElement,"fontSizePct",e._n(t))},expression:"gridElement.fontSizePct"}}),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"backgroundColor"}},[e._v(e._s(e.$t("customElementColor")))]),e._v(" "),e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.backgroundColor,expression:"gridElement.backgroundColor"}],staticClass:"five columns",attrs:{type:"color",id:"backgroundColor"},domProps:{value:e.gridElement.backgroundColor},on:{input:[function(t){t.target.composing||e.$set(e.gridElement,"backgroundColor",t.target.value)},function(t){e.gridElement.colorCategory=void 0,e.resetTestGrid()}]}}):e._e(),e._v(" "),t("button",{staticClass:"two columns",attrs:{disabled:!e.gridElement.backgroundColor},on:{click:function(t){e.gridElement.backgroundColor=null,e.resetTestGrid()}}},[e._v(e._s(e.$t("clear")))])]),e._v(" "),t("div",{staticClass:"srow mb-4"},[t("label",{staticClass:"four columns",attrs:{for:"fontColor"}},[t("span",[e._v(e._s(e.$t("fontColor")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.fontColor,expression:"gridElement.fontColor"}],staticClass:"five columns",attrs:{id:"fontColor",type:"color"},domProps:{value:e.gridElement.fontColor},on:{input:[function(t){t.target.composing||e.$set(e.gridElement,"fontColor",t.target.value)},e.resetTestGrid]}}),e._v(" "),t("button",{staticClass:"two columns",attrs:{disabled:!e.gridElement.fontColor},on:{click:function(t){e.gridElement.fontColor=null,e.resetTestGrid()}}},[e._v(e._s(e.$t("clear")))])]),e._v(" "),e.metadata?t("app-grid-display",{staticClass:"testGrid",staticStyle:{"max-width":"200px",height:"200px"},attrs:{"grid-data":e.testGridData,metadata:e.metadata,"watch-for-changes":!0}}):e._e()],1)],1)])};Kf._withStripped=!0;var Wf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"srow"},[t("label",{class:e.showClearButton?"two columns":"three columns",attrs:{for:e.id}},[t("span",[e._v(e._s(e._f("translate")(e.label)))])]),e._v(" "),t("input",{class:e.showClearButton?"four columns":"five columns",attrs:{id:e.id,type:"range",min:e.min,max:e.max,step:e.step},domProps:{value:e.value},on:{input:e.changed}}),e._v(" "),t("div",{staticClass:"three columns"},[t("span",[e._v(e._s(e.$t("currentValue")))]),e._v(":\n        "),t("span",[e._v(e._s(e.showValue)),e.value||0===e.value?t("span",[e._v(e._s(e.unit?" "+e.i18nService.t(e.unit):""))]):e._e()])]),e._v(" "),e.showClearButton?t("button",{staticClass:"two columns",attrs:{disabled:!e.value},on:{click:function(t){return e.emitChange(null)}}},[e._v(e._s(e.$t("clear")))]):e._e()])};Wf._withStripped=!0;const qf=Cd({props:["id","label","value","min","max","step","decimals","unit","displayFactor","default","showClearButton"],data:()=>({i18nService:o.A}),computed:{showValue(){if(!this.value&&0!==this.value)return o.A.t("noneSelected");let e=this.displayFactor?parseFloat(this.displayFactor):1,t=parseFloat(this.value)*e;return this.decimals?t.toFixed(parseInt(this.decimals)):t}},methods:{emitChange(e){this.$emit("input",e),this.$emit("change",e)},changed(e){this.emitChange(e.target.value)}},mounted(){void 0===this.value&&this.default&&this.emitChange(parseFloat(this.default))},updated(){}},Wf,[],!1,null,"74974482",null).exports;var Hf=function(){var e=this,t=e._self._c;return t("div",{ref:"mainContainer",style:`flex: 1 1 auto; max-width: 100%; min-height: 0; cursor: ${e.cursorType}`},[e.gridData&&e.oneElementSize?t("grid-layout",e._g(e._b({key:e.gridData.id,ref:"gridLayout",attrs:{elements:e.gridData.gridElements,"render-component":e.AppGridElement,"background-color":e.metadata.colorConfig.gridBackgroundColor,rows:e.gridData.rowCount,columns:e.gridData.minColumnCount,metadata:e.metadata,"one-element-size":e.oneElementSize,"show-resize-handle":e.editable,editable:e.editable,"background-lines":e.editable}},"grid-layout",e.$attrs,!1),e.$listeners)):e._e()],1)};Hf._withStripped=!0;var Yf=function(){var e=this,t=e._self._c;return t("div",{class:"grid-parent "+e.myId,style:e.cssProps},[e.backgroundLines?t("div",[t("div",{staticClass:"grid-bg-lines",style:`margin-left: ${e.getRasterX()}px; margin-right: 1px; background-size: ${e.getRasterX()}px ${e.getRasterX()}px; background-image: linear-gradient(to right, grey 1px, transparent 1px)`}),e._v(" "),t("div",{staticClass:"grid-bg-lines",style:`margin-top: ${e.getRasterY()}px; margin-bottom: 1px; background-size: ${e.getRasterY()}px ${e.getRasterY()}px; background-image: linear-gradient(to bottom, grey 1px, transparent 1px);`})]):e._e(),e._v(" "),t("transition-group",{ref:"gridComponent",staticClass:"grid-layout",style:`grid-template-columns: repeat(${e.columns}, minmax(0, 1fr)); grid-template-rows: repeat(${e.rows}, minmax(0, 1fr)); background-color: ${e.backgroundColor}`,attrs:{name:e.editable?"grid-transition":"",tag:e.baseTag}},e._l(e.elements,(function(n){return t("grid-element",{key:n.id,class:n.id+""===e.noMoveId?"nomove":"",attrs:{"data-id":n.id,x:n.x,y:n.y,width:n.width,height:n.height,tag:e.elementTag}},[t(e.renderComponent,e._b({tag:"component",attrs:{id:n.id,element:n,editable:e.editable}},"component",e.$attrs,!1))],1)})),1)],1)};Yf._withStripped=!0;var zf=function(){var e=this;return(0,e._self._c)(e.tag||e.defaultTag,{tag:"component",staticClass:"grid-layout-element",style:`display: flex; grid-column-start:${e.x+1}; grid-column-end:${e.x+1+e.width}; grid-row-start:${e.y+1}; grid-row-end:${e.y+1+e.height};`},[e._t("default")],2)};zf._withStripped=!0;const Jf={props:["x","y","width","height","tag"],data:()=>({defaultTag:"div"}),computed:{},methods:{},mounted(){}};var Xf=s(3466),Qf={};Qf.styleTagTransform=Ed(),Qf.setAttributes=gd(),Qf.insert=vd().bind(null,"head"),Qf.domAPI=hd(),Qf.insertStyleElement=yd(),dd()(Xf.A,Qf),Xf.A&&Xf.A.locals&&Xf.A.locals;const Zf=Cd(Jf,zf,[],!1,null,"46edb430",null).exports;var ey=s(518);const ty={components:{GridElement:Zf},props:{rows:Number,columns:Number,elements:Array,renderComponent:{type:[Object,String],default:null},backgroundColor:{type:String,default:"white"},baseTag:{type:String,default:"ol"},elementTag:{type:String,default:"li"},editable:{type:Boolean,default:!1},resizeHandleSelector:{type:String,default:".ui-resizable-handle"},backgroundLines:{type:Boolean,default:!1},animationDurationMs:{type:Number,default:200}},data:()=>({interact:null,timeoutHandler:null,noMoveId:null,myId:"grid-parent-"+(new Date).getTime(),elementClassSelector:".grid-layout-element"}),watch:{editable(){this.reinit()},rows(){this.reinit()},columns(){this.reinit()}},computed:{cssProps(){return{"--animation-duration":this.animationDurationMs+"ms"}},totalElementClassSelector(){return`.${this.myId} ${this.elementClassSelector}`}},methods:{getRasterX(){return this.getSizeFromStyle("grid-template-columns")},getRasterY(){return this.getSizeFromStyle("grid-template-rows")},getSizeFromStyle(e){if(!this.$refs.gridComponent)return 0;let t=getComputedStyle(this.$refs.gridComponent.$el).getPropertyValue(e).split(" ")[0];return parseFloat(t)},handleMove(e,t){if(0===t.x&&0===t.y)return;let n=e.children[0].id,r=this.getElement(n),i=ey.f.resolveCollisions(this.elements,r,{diff:t,gridWidth:this.columns,gridHeight:this.rows,calcNewPos:!0});this.$emit("changed",i),this.reinit()},handleResize(e,t){let n=e.children[0].id,r=this.getElement(n);if(!r||!t||t.width===e.width&&t.height===e.height)return;r.width=t.width,r.height=t.height;let i=ey.f.resolveCollisions(this.elements,r,{gridWidth:this.columns,gridHeight:this.rows});this.$emit("changed",i),this.reinit()},getElement(e){return this.elements.find((t=>t.id+""==e+""))},reinit(){this.$nextTick((()=>{this.initInteract(),this.$forceUpdate()}))},async initInteract(){if(this.destroyInteract(),!this.editable)return;let e=this;this.interact=this.interact||(await s.e(617).then(s.t.bind(s,2617,23))).default;let t={x:0,y:0};this.interact(this.totalElementClassSelector).draggable({listeners:{start(t){e.$emit("movestart"),e.$emit("interactstart")},move(e){t.x+=e.dx,t.y+=e.dy,e.target.style.transform=`translate(${t.x}px, ${t.y}px)`,e.target.style.zIndex=100},end(n){let r=n.target,i=t.x/e.getRasterX(),o=t.y/e.getRasterY(),a=Math.round(i),s=Math.abs(a-i)<.25,l={x:a,y:Math.round(o),exact:s,xExact:i,yExact:o};e.handleMove(r,l),n.target.style.transform="",e.noMoveId=n.target.getAttribute("data-id"),e.$emit("moveend"),e.$emit("interactend"),setTimeout((()=>{n.target.style.zIndex="unset",e.noMoveId=null}),e.animationDurationMs+100)}}}).resizable({edges:{left:!1,right:!0,bottom:this.resizeHandleSelector,top:!1},listeners:{start(t){e.$emit("resizestart"),e.$emit("interactstart")},move(e){e.target.style.width=e.rect.width+"px",e.target.style.height=e.rect.height+"px",e.target.style.zIndex=100},end(t){t.target.style.width="",t.target.style.height="",t.target.style.zIndex=0;let n=t.target;e.handleResize(n,{width:Math.round(t.rect.width/e.getRasterX()),height:Math.round(t.rect.height/e.getRasterY())}),e.$emit("resizeend"),e.$emit("interactend")}},modifiers:[this.interact.modifiers.restrictSize({min:{width:this.getRasterX(),height:this.getRasterY()}})]})},destroyInteract(){this.interact&&this.interact(this.totalElementClassSelector).unset()},onResize(){clearTimeout(this.timeoutHandler),this.timeoutHandler=setTimeout((()=>{this.$forceUpdate()}),50)},pointerEventListener(e){let t=e.target,n=!1;for(;t;){if(t.className.includes(this.myId)){n=!0;break}t=t.parentElement}if(n){let t=this.$refs.gridComponent.$el.getBoundingClientRect(),n=e.changedTouches?e.changedTouches[0]:null,r=n?n.clientX:e.clientX,i=n?n.clientY:e.clientY,o=r-t.x,a=i-t.y;this.$emit("interacted",Math.floor(o/this.getRasterX()),Math.floor(a/this.getRasterY()),e)}}},created(){window.addEventListener("resize",this.onResize),document.addEventListener("click",this.pointerEventListener),document.addEventListener("touchend",this.pointerEventListener),document.addEventListener("contextmenu",this.pointerEventListener),document.addEventListener("mousedown",this.pointerEventListener)},beforeDestroy(){this.destroyInteract(),window.removeEventListener("resize",this.onResize),document.removeEventListener("click",this.pointerEventListener),document.removeEventListener("touchend",this.pointerEventListener),document.removeEventListener("contextmenu",this.pointerEventListener),document.removeEventListener("mousedown",this.pointerEventListener)},async mounted(){this.initInteract(),this.$forceUpdate()}};var ny=s(1467),ry={};ry.styleTagTransform=Ed(),ry.setAttributes=gd(),ry.insert=vd().bind(null,"head"),ry.domAPI=hd(),ry.insertStyleElement=yd(),dd()(ny.A,ry),ny.A&&ny.A.locals&&ny.A.locals;const iy=Cd(ty,Yf,[],!1,null,"2008ad88",null).exports;var oy=function(){var e=this,t=e._self._c;return t("div",{ref:"container",staticClass:"element-container",style:`margin: ${e.elementMarginPx}px; border-radius: ${e.borderRadiusPx}px; cursor: ${e.cursorType};\n     border: ${e.borderWidthPx}px solid ${e.getBorderColor(e.element)}; background-color: ${e.backgroundColor}; font-family: ${e.metadata.textConfig.fontFamily};`,attrs:{tabindex:"40","aria-label":e.getAriaLabel(e.element),"data-empty":e.isEmpty(e.element)}},[e.element.type===e.GridElement.ELEMENT_TYPE_NORMAL?t("grid-element-normal",e._b({attrs:{"grid-element":e.element,metadata:e.metadata,"container-size":e.calculatedSize,"aria-hidden":"true"}},"grid-element-normal",e.$props,!1)):e._e(),e._v(" "),e.element.type===e.GridElement.ELEMENT_TYPE_COLLECT?t("grid-element-collect",{attrs:{"aria-hidden":"true"}}):e._e(),e._v(" "),e.element.type===e.GridElement.ELEMENT_TYPE_YT_PLAYER?t("grid-element-youtube",{attrs:{"grid-element":e.element,"aria-hidden":"true"}}):e._e(),e._v(" "),e.element.type===e.GridElement.ELEMENT_TYPE_PREDICTION?t("grid-element-predict",e._b({attrs:{"grid-element":e.element,metadata:e.metadata,"container-size":e.calculatedSize,"aria-hidden":"true"}},"grid-element-predict",e.$props,!1)):e._e(),e._v(" "),e.element.type===e.GridElement.ELEMENT_TYPE_LIVE?t("grid-element-live",e._b({attrs:{"grid-element":e.element,metadata:e.metadata,"container-size":e.calculatedSize,"aria-hidden":"true"}},"grid-element-live",e.$props,!1)):e._e(),e._v(" "),e.element.type===e.GridElement.ELEMENT_TYPE_MATRIX_CONVERSATION?t("grid-element-matrix-conversation",{attrs:{"grid-element":e.element,metadata:e.metadata,"container-size":e.calculatedSize,"aria-hidden":"true"}}):e._e(),e._v(" "),t("grid-element-hints",{attrs:{"grid-element":e.element,metadata:e.metadata,"background-color":e.backgroundColor}}),e._v(" "),e.showResizeHandle?t("div",{staticClass:"ui-resizable-handle ui-icon ui-icon-grip-diagonal-se",staticStyle:{position:"absolute","z-index":"2",bottom:"0",right:"0",cursor:"se-resize"}}):e._e()],1)};oy._withStripped=!0;var ay=function(){var e=this,t=e._self._c;return t("div",{ref:"container",staticClass:"grid-item-content",staticStyle:{"background-color":"rgb(255,228,178)"}},[t("grid-element-text-container",e._b({attrs:{"with-image":!1,metadata:e.metadata,"disable-auto-size-keyboard":!0}},"grid-element-text-container",e.$attrs,!1))],1)};ay._withStripped=!0;var sy=function(){var e=this,t=e._self._c;return t("div",{ref:"txtContainer",class:`text-container ${e.metadata.textConfig.fontFamily}`,style:`order: ${e.metadata.textConfig.textPosition===e.TextConfig.TEXT_POS_BELOW?1:0};\n              text-align: center; font-size: ${e.fontSizePx}px; line-height: ${e.lineHeight}; color: ${e.gridElement&&e.gridElement.fontColor?e.gridElement.fontColor:e.metadata.textConfig.fontColor};\n              flex-grow: ${e.withImage?"0":"1"};`},[t("span",{style:`max-height: ${e.maxTextContainerHeight}; text-overflow: ${e.textOverflow}; white-space: ${e.whiteSpaceWrap}; margin: 0 ${e.txtMargin}px;`},[t("span",{domProps:{innerHTML:e._s(e.displayLabel)}})])])};sy._withStripped=!0;const ly=Cd({props:["withImage","metadata","gridElement","containerSize","disableAutoSizeKeyboard","watchForChanges","editable"],data:()=>({ready:!1,fontSizePx:0,lineHeight:null,maxLines:null,maxTextContainerHeight:null,TextConfig:Hg.a,textOverflow:null,whiteSpaceWrap:null,txtMargin:5,externalSetLabel:""}),watch:{containerSize(){this.calcFontSize()}},computed:{calculateLabel(){let e="";return this.gridElement&&(e=Md.getDisplayText(this.gridElement.id)||o.A.getTranslation(this.gridElement.label)),e=(this.externalSetLabel+""||e||"")+"",ee.Z.convertLowerUppercase(e,this.metadata.textConfig.convertMode)},displayLabel(){let e=ee.Z.replaceAll(this.calculateLabel,"\n","<br>");return e=ee.Z.replaceAll(e,"\\\\n","<br>"),ee.Z.replaceAll(e,"\\\\N","<br>")}},methods:{calcFontSize(){if(!this.$refs.txtContainer||!this.$refs.txtContainer.parentElement)return;let e=this.containerSize;this.lineHeight=this.withImage?this.metadata.textConfig.lineHeight:this.metadata.textConfig.onlyTextLineHeight,this.maxLines=this.withImage?this.metadata.textConfig.maxLines:100,this.fontSizePx=this.getFontSizePx(e),this.maxTextContainerHeight=this.withImage?this.fontSizePx*this.lineHeight*this.metadata.textConfig.maxLines+"px":"100%",this.textOverflow=this.metadata.textConfig.fittingMode===Hg.a.TOO_LONG_ELLIPSIS?"ellipsis":"clip",this.whiteSpaceWrap=1===this.maxLines?"nowrap":"normal",this.ready=!0},getFontSizePx(e){let t=this.calculateLabel,n=this.getBaseFontSize(e),r=xu.getTextWidth(t,this.$refs.txtContainer.parentElement,n),i=80;if(this.txtMargin=5,document.documentElement.clientWidth<480&&(this.txtMargin=0,i=100),this.metadata.textConfig.fittingMode===Hg.a.TOO_LONG_AUTO&&r>e.width-2*this.txtMargin){let r=xu.getFittingFontSize(t,this.$refs.txtContainer.parentElement,{maxLines:this.maxLines,padding:this.txtMargin,maxSize:n,lineHeight:this.lineHeight,containerSize:e});if(this.withImage&&1===this.maxLines){let e=r/n;this.lineHeight/=e}n=r}return!this.disableAutoSizeKeyboard&&this.metadata.textConfig.autoSizeKeyboardLetters&&!this.withImage&&(1===t.length||2===t.length&&new RegExp(C.A.EMOJI_REGEX,"").test(t))&&(n=xu.getFittingFontSize(t,this.$refs.txtContainer.parentElement,{containerPct:i,lineHeight:this.lineHeight,padding:this.txtMargin,containerSize:e})),n},getBaseFontSize(e){let t=this.getBaseFontSizePct();return xu.pctToPx(t,e)},getBaseFontSizePct(){let e=this.withImage?this.metadata.textConfig.fontSizePct:this.metadata.textConfig.onlyTextFontSizePct;return this.gridElement&&(e=Number.isInteger(this.gridElement.fontSizePct)?this.gridElement.fontSizePct:e),e},externalUpdateFn(e,t,n){this.gridElement&&t===this.gridElement.id&&(this.externalSetLabel=n,this.calcFontSize())}},mounted(){this.calcFontSize(),(0,t.A)(document).on(C.A.EVENT_ELEM_TEXT_CHANGED,this.externalUpdateFn),(this.editable||this.watchForChanges)&&(this.$watch("metadata",(()=>{this.calcFontSize()}),{deep:!0}),this.$watch("gridElement",(()=>{this.calcFontSize()}),{deep:!0}))},beforeDestroy(){(0,t.A)(document).off(C.A.EVENT_ELEM_TEXT_CHANGED,this.externalUpdateFn)}},sy,[],!1,null,"3bd113e8",null).exports,cy=Cd({components:{GridElementTextContainer:ly},props:["metadata"],data:()=>({}),methods:{},mounted(){}},ay,[],!1,null,"2137e98e",null).exports;var dy=function(){var e=this,t=e._self._c;return t("div",{style:`position: absolute; right: 0; color: ${e.hintsColor}; top: ${e.topPx}; bottom: ${e.bottomPx}; line-height: 1`},[e.gridElement.hidden?t("i",{staticClass:"fas fa-eye-slash element-hint"}):e._e(),e._v(" "),e.hasNavigation?t("i",{staticClass:"fas fa-sticky-note fa-rotate-180 fa-flip-vertical element-hint"}):e._e(),e._v(" "),e.gridElement.vocabularyLevel&&e.isOnEdit?t("span",{staticClass:"element-hint d-inline-block",style:"outline: 1px solid; padding-left: 0.25em; padding-right: 0.25em; border-radius: 2px; font-weight: "+(e.elementLevelShown?"bold":"normal")},[e._v(e._s(e.gridElement.vocabularyLevel))]):e._e()])};dy._withStripped=!0;const uy=Cd({props:["gridElement","metadata","backgroundColor"],data:()=>({isOnEdit:TA.isOnEditPage()}),computed:{hasNavigation(){return!!this.gridElement.actions.find((e=>e.modelName===D.g.getModelName()))},topPx(){return this.metadata.textConfig.textPosition===Hg.a.TEXT_POS_BELOW?0:"unset"},bottomPx(){return this.metadata.textConfig.textPosition===Hg.a.TEXT_POS_ABOVE?0:"unset"},hintsColor(){return xu.getHighContrastColor(this.backgroundColor,"#e8e8e8","#686868")},elementLevelShown(){return!this.gridElement.vocabularyLevel||!this.metadata.vocabularyLevel||this.metadata.vocabularyLevel>=this.gridElement.vocabularyLevel}},methods:{},mounted(){}},dy,[],!1,null,"31e296bc",null).exports;var hy=function(){return this._self._c,this._m(0)};hy._withStripped=!0;const py=Cd({props:[],data:()=>({}),methods:{},mounted(){}},hy,[function(){var e=this._self._c;return e("div",{staticClass:"grid-item-content"},[e("div",{staticClass:"collect-outer-container text-container",staticStyle:{position:"absolute",display:"flex",top:"5px",right:"5px",bottom:"5px",left:"5px"}})])}],!1,null,"02c748a1",null).exports;var vy=function(){var e=this,t=e._self._c;return t("div",{staticClass:"grid-item-content"},[e.stopClicking?t("div",{staticStyle:{"z-index":"100",position:"absolute",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%"},attrs:{id:"youtubeClickPreventer",onclick:"event.stopPropagation()"}}):e._e(),e._v(" "),e._m(0)])};vy._withStripped=!0;const my=Cd({props:["gridElement"],data(){return{stopClicking:this.gridElement.additionalProps[O.V.PROP_YT_PREVENT_CLICK]}},methods:{},mounted(){}},vy,[function(){var e=this._self._c;return e("div",{staticClass:"yt-container",staticStyle:{position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},[e("div",{staticStyle:{height:"100%","background-color":"black",display:"flex","align-items":"center","justify-content":"center"},attrs:{id:"player"}},[e("i",{staticClass:"fab fa-youtube fa-5x",staticStyle:{color:"whitesmoke"}})])])}],!1,null,"fa0e62a6",null).exports;var gy=function(){var e=this,t=e._self._c;return t("div",{staticClass:"grid-item-content"},[e.imageData?t("div",{staticClass:"img-container",style:"order: "+(e.metadata.textConfig.textPosition===e.TextConfig.TEXT_POS_BELOW?0:1)},[t("img",{staticStyle:{"box-sizing":"border-box","max-width":"100%","max-height":"100%","object-fit":"contain",padding:"2%"},attrs:{src:e.imageData,draggable:"false",crossorigin:"anonymous"}})]):e._e(),e._v(" "),t("grid-element-text-container",e._b({attrs:{"with-image":!!e.imageData,metadata:e.metadata,"grid-element":e.gridElement}},"grid-element-text-container",e.$attrs,!1))],1)};gy._withStripped=!0;const fy=Cd({components:{GridElementTextContainer:ly},props:["gridElement","metadata"],data:()=>({TextConfig:Hg.a}),computed:{imageData(){return this.gridElement.image?this.gridElement.image.data||this.gridElement.image.url:null}},methods:{},mounted(){}},gy,[],!1,null,"d699f476",null).exports;var yy=s(6697),_y=function(){var e=this,t=e._self._c;return t("div",{ref:"container",staticClass:"grid-item-content",style:e.gridElement.backgroundColor||"background-color: rgb(198,236,253);"},[e.imageData?t("div",{staticClass:"img-container",style:"order: "+(e.metadata.textConfig.textPosition===e.TextConfig.TEXT_POS_BELOW?0:1)},[t("img",{staticStyle:{"box-sizing":"border-box","max-width":"100%","max-height":"100%","object-fit":"contain",padding:"2%"},attrs:{src:e.imageData,draggable:"false",crossorigin:"anonymous"}})]):e._e(),e._v(" "),t("grid-element-text-container",e._b({attrs:{"with-image":!!e.imageData,metadata:e.metadata,"disable-auto-size-keyboard":!0,"grid-element":e.gridElement}},"grid-element-text-container",e.$attrs,!1))],1)};_y._withStripped=!0;const Ey=Cd({components:{GridElementTextContainer:ly},props:["gridElement","metadata"],data:()=>({TextConfig:Hg.a}),computed:{imageData(){return this.gridElement.image?this.gridElement.image.data||this.gridElement.image.url:null}},methods:{},mounted(){}},_y,[],!1,null,"28c01fbf",null).exports;var by=function(){var e=this,t=e._self._c;return t("div",{staticClass:"grid-item-content p-3"},[t("matrix-conversation",e._b({attrs:{"grid-element":e.gridElement}},"matrix-conversation",e.$attrs,!1))],1)};by._withStripped=!0;var Sy=function(){var e=this,t=e._self._c;return t("div",{ref:"messenger",staticClass:"row",style:`max-height: 100%; overflow-y: scroll; font-size: ${e.fontSize}`},[e.loading?t("div",[t("span",{staticClass:"col"},[e._v(e._s(e.$t("loading"))+"...")]),e._v(" "),t("i",{staticClass:"fas fa-spinner fa-spin"})]):e._e(),e._v(" "),e.matrixRoom||e.loading?e._e():t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("matrixMessengerNotLoggedInOrNoRoom")))]),e._v(" "),t("div",{staticClass:"mt-5"},[e._v(e._s(e.$t("goToMatrixSettingsToConfigure")))])]),e._v(" "),e.matrixRoom&&!e.loading?t("div",{staticClass:"col"},[t("div",{staticClass:"mb-5"},[t("h2",{staticClass:"mb-2"},[e._v(e._s(e.matrixRoom.name))]),e._v(" "),t("matrix-room-description",{attrs:{room:e.matrixRoom,full:!0,"logged-in-user":e.currentUser}}),e._v(" "),e.matrixRoom.hasEncryptionStateEvent()?t("div",[t("i",{staticClass:"fas fa-lock",staticStyle:{color:"darkgreen"}}),e._v(" "),t("span",[e._v(e._s(e.$t("endToEndEncrypted")))])]):e._e(),e._v(" "),e.matrixRoom.hasEncryptionStateEvent()?e._e():t("div",[t("i",{staticClass:"fas fa-lock-open",staticStyle:{color:"darkred"}}),e._v(" "),t("span",[e._v(e._s(e.$t("notEndToEndEncrypted")))])])],1),e._v(" "),e.matrixMessages.length?e._e():t("div",{staticClass:"row"},[t("span",{staticClass:"col"},[e._v(e._s(e.$t("noMessagesInRoom"))+".")])]),e._v(" "),e._l(e.matrixMessages,(function(n){return t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("div",{class:"message "+(n.sender===e.currentUser?"message-own":"message-other")},[t("div",[t("strong",[e._v(e._s(n.sender))])]),e._v(" "),n.isDeleted?t("div",[e._v("... "+e._s(e.$t("messageWasDeleted"))+" ...")]):e._e(),e._v(" "),"m.text"===n.msgType&&e.isOnlyEmojis(n.textContent)?t("div",{staticStyle:{"font-size":"4em"}},[e._v(e._s(n.textContent))]):e._e(),e._v(" "),"m.text"!==n.msgType||e.isOnlyEmojis(n.textContent)?e._e():t("div",[e._v(e._s(n.textContent))]),e._v(" "),"m.image"===n.msgType?t("div",[t("img",{staticStyle:{"max-width":"100%"},attrs:{src:n.imageUrl},on:{load:function(t){return e.revokeBlob(n.imageUrl)}}}),e._v(" "),t("div",[e._v(e._s(n.textContent))])]):e._e(),e._v(" "),t("div",{staticClass:"d-flex",staticStyle:{"justify-content":"flex-end","font-size":"0.8em"}},[t("span",[e._v(e._s(n.dateTimeReadable))])])])])])})),e._v(" "),e.sending?t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("div",{staticClass:"message message-own"},[t("div",[t("strong",[e._v(e._s(e.currentUser))])]),e._v(" "),t("i",{staticClass:"fas fa-spinner fa-spin"})])])]):e._e()],2):e._e()])};Sy._withStripped=!0;var Cy=function(){var e=this,t=e._self._c;return t("div",[e.isPrivateRoom(e.room)?t("span",[e._v(e._s(e.$t("privateRoomWith",{user:e.getPrivateRoomPartner(e.room)})))]):e._e(),e._v(" "),!e.isPrivateRoom(e.room)&&e.room.getMembers().length<10?t("span",[t("strong",{class:e.full?"d-inline":"d-sm-none d-inline"},[e._v(e._s(e.$t("members"))+":")]),e._v(" "),t("span",[e._v(e._s(e.getAllMembersString(e.room)))])]):e._e(),e._v(" "),!e.isPrivateRoom(e.room)&&e.room.getMembers().length>=10?t("span",[t("span",[e._v(e._s(e.room.getMembers().length))]),e._v(" "),t("span",[e._v(e._s(e.$t("members")))])]):e._e()])};Cy._withStripped=!0;const wy={components:{},props:["room","full","loggedInUser"],data:function(){return{}},methods:{isPrivateRoom:e=>2===e.getMembers().length,getPrivateRoomPartner(e){return e.getMembers().map((e=>e.name)).filter((e=>e!==this.loggedInUser))[0]},getAllMembersString(e){let t=e.getMembers().map((e=>e.name));return t.sort(((e,t)=>e===this.loggedInUser?-1:t===this.loggedInUser?1:e.localeCompare(t))),t.join(", ")}},async mounted(){}},Ay=Cd(wy,Cy,[],!1,null,"f056b2d4",null).exports,Ty={components:{MatrixRoomDescription:Ay},props:["matrixRoomProp","gridElement","metadata","containerSize"],data:function(){return{matrixRooms:null,matrixRoom:null,matrixMessages:[],currentUser:void 0,matrixText:"",loading:!0,sending:!1,fontSize:"unset"}},watch:{matrixRoomProp(){this.matrixRooms=[],this.matrixRoom=this.matrixRoomProp,this.init()},containerSize(){this.calcFontSize()}},methods:{calcFontSize(){this.metadata||(this.fontSize="unset");let e=xu.pctToPx(this.metadata.textConfig.fontSizePct)/9;this.fontSize=e+"px"},addMessage(e){if(this.sending=!1,this.matrixMessages.push(e),this.matrixMessages.sort(((e,t)=>e.timestamp-t.timestamp)),this.scrollDown(),this.gridElement&&this.gridElement.autoSpeak&&e.sender!==this.currentUser){let t=e.textContent;"m.image"===e.msgType&&t.length,su.speak(e.textContent)}},onMessageHandler(e){e.roomId===this.matrixRoom.roomId&&this.addMessage(e)},isOnlyEmojis:e=>(e=ee.Z.replaceAll(e," ",""),ee.Z.isOnlyEmojis(e)),revokeBlob(e){e.startsWith("blob:")&&URL.revokeObjectURL(e)},scrollDown(){setTimeout((()=>{this.$nextTick((()=>{this.$refs.messenger.scrollTop=this.$refs.messenger.scrollHeight}))}),100)},async init(){this.matrixRoom&&(this.loading=!0,sm.onMessage(this.onMessageHandler),this.currentUser=await sm.getUsername(),this.matrixMessages=await sm.getMessageEvents(this.matrixRoom.roomId,0),this.loading=!1,this.scrollDown())},scroll(e){this.$nextTick((()=>{let t=this.$refs.messenger.scrollTop+e;t=Math.min(t,this.$refs.messenger.scrollHeight),t=Math.max(0,t),this.$refs.messenger.scrollTop=t}))},onScrollUpEvent(e,t=50){this.scroll(-1*t)},onScrollDownEvent(e,t=50){this.scroll(t)},async onRoomChangeEvent(e,t){this.matrixRoom=this.matrixRooms.find((e=>e.roomId===t)),await this.init()},onSendingStart(){this.sending=!0,this.scrollDown()}},async mounted(){this.loading=!0,this.matrixRooms=await sm.getRooms()||[],this.matrixRoom=hm.getCurrentRoom()||this.matrixRooms[0],await this.init(),this.loading=!1,(0,t.A)(document).on(C.A.EVENT_MATRIX_SCROLL_UP,this.onScrollUpEvent),(0,t.A)(document).on(C.A.EVENT_MATRIX_SCROLL_DOWN,this.onScrollDownEvent),(0,t.A)(document).on(C.A.EVENT_MATRIX_SET_ROOM,this.onRoomChangeEvent),(0,t.A)(document).on(C.A.EVENT_MATRIX_SENDING_START,this.onSendingStart)},beforeDestroy(){sm.onMessage(null),(0,t.A)(document).off(C.A.EVENT_MATRIX_SCROLL_UP,this.onScrollUpEvent),(0,t.A)(document).off(C.A.EVENT_MATRIX_SCROLL_DOWN,this.onScrollDownEvent),(0,t.A)(document).off(C.A.EVENT_MATRIX_SET_ROOM,this.onRoomChangeEvent),(0,t.A)(document).off(C.A.EVENT_MATRIX_SENDING_START,this.onSendingStart)}};var Iy=s(5553),ky={};ky.styleTagTransform=Ed(),ky.setAttributes=gd(),ky.insert=vd().bind(null,"head"),ky.domAPI=hd(),ky.insertStyleElement=yd(),dd()(Iy.A,ky),Iy.A&&Iy.A.locals&&Iy.A.locals;const Oy=Cd(Ty,Sy,[],!1,null,"53d27f64",null).exports,Ry={components:{GridElementMatrixConversation:Cd({components:{MatrixConversation:Oy},props:["gridElement"],data:()=>({}),methods:{},mounted(){}},by,[],!1,null,"314ac6ab",null).exports,GridElementLive:Ey,GridElementNormal:fy,GridElementYoutube:my,GridElementCollect:py,GridElementHints:uy,GridElementPredict:cy},props:["element","metadata","showResizeHandle","editable","oneElementSize","watchForChanges"],data(){return{GridElement:O.V,resizeObserver:null,elementMarginPx:xu.pctToPx(this.metadata.colorConfig.elementMargin),borderRadiusPx:xu.pctToPx(this.metadata.colorConfig.borderRadius),borderWidthPx:xu.pctToPx(this.metadata.colorConfig.borderWidth)}},computed:{calculatedSize(){return{width:this.oneElementSize.width*this.element.width-2*this.getElementMargin()-2*this.getBorderWidth(),height:this.oneElementSize.height*this.element.height-2*this.getElementMargin()-2*this.getBorderWidth()}},backgroundColor(){return this.metadata&&this.element?this.metadata.colorConfig.colorMode===yy.Y.COLOR_MODE_BACKGROUND?d.e.getElementColor(this.element,this.metadata):this.metadata.colorConfig.elementBackgroundColor:""},cursorType(){return Ge.b.getCursorType(this.metadata,"pointer")}},methods:{getBorderColor(e){if(!this.metadata||!this.metadata.colorConfig)return"gray";let t=this.metadata.colorConfig.elementBorderColor;if(this.metadata.colorConfig.elementBorderColor===C.A.DEFAULT_ELEMENT_BORDER_COLOR){let e=this.metadata.colorConfig.gridBackgroundColor||"#ffffff";t=xu.getHighContrastColor(e,"whitesmoke","gray")}return this.metadata.colorConfig.colorMode===yy.Y.COLOR_MODE_BORDER?d.e.getElementColor(e,this.metadata,t):t},isEmpty:e=>e.type===O.V.ELEMENT_TYPE_NORMAL&&!(Md.getDisplayText(e.id)||e.image&&(e.image.url||e.image.data)),getAriaLabel(e){let t=o.A.getTranslation(e.label),n=t?t+", ":"",r={":":"colon",".":"period",",":"comma","!":"exclamationMark","?":"questionMark",'"':"quotationMark","-":"hyphen"," ":"space"};Object.keys(r).includes(t)&&(n=o.A.t(r[t])+", ");let i=e.actions.filter((e=>e.modelName===I.m.getModelName()))[0];return!n&&i&&(n=o.A.getTranslation(i.speakText)+", "),n+=e.actions.filter((e=>e.modelName!==k.v.getModelName()&&e.modelName!==I.m.getModelName()&&e.modelName!==N.G.getModelName())).reduce(((e,t)=>{switch(t.modelName){case xh.N.getModelName():e+=o.A.t(xh.N.getModelName()),e+=" "+o.A.getLangReadable(t.language),e+=", ";break;case x.z.getModelName():e+=o.A.t(t.action),e+=", ";break;case D.g.getModelName():t.navType===D.g.NAV_TYPES.TO_LAST?e+=o.A.t("navigateToLastOpenedGrid"):t.navType===D.g.NAV_TYPES.TO_HOME?e+=o.A.t("navigateToHomeGrid"):e+=o.A.t("navigation"),e+=", ";break;case mh.o.getModelName():e+=o.A.t(mh.o.getModelName()),e+=" "+o.A.t(t.action),e+=", ";break;case Lu.a.getModelName():e+=o.A.t(Lu.a.getModelName()),e+=" "+o.A.t(t.action),e+=", ";break;default:e+=o.A.t(t.modelName),e+=", "}return e}),""),n.endsWith(", ")&&(n=n.slice(0,-2)),n},async recalculate(){this.$refs.container&&(this.elementMarginPx=this.getElementMargin(),this.borderWidthPx=this.getBorderWidth(),this.borderRadiusPx=xu.pctToPx(this.metadata.colorConfig.borderRadius))},getElementMargin(){return xu.pctToPx(this.metadata.colorConfig.elementMargin)},getBorderWidth(){return xu.pctToPx(this.metadata.colorConfig.borderWidth)}},async mounted(){(this.editable||this.watchForChanges)&&(this.$watch("metadata",(()=>{this.recalculate()}),{deep:!0}),this.$watch("element",(()=>{this.recalculate()}),{deep:!0}))}};var xy=s(8903),Ny={};Ny.styleTagTransform=Ed(),Ny.setAttributes=gd(),Ny.insert=vd().bind(null,"head"),Ny.domAPI=hd(),Ny.insertStyleElement=yd(),dd()(xy.A,Ny),xy.A&&xy.A.locals&&xy.A.locals;const Dy=Cd(Ry,oy,[],!1,null,"a1b1e190",null).exports,Ly=Cd({components:{GridElement:Zf,GridLayout:iy,AppGridElement:Dy},props:["gridData","metadata","editable"],data:()=>({AppGridElement:Dy,oneElementSize:null,resizeObserver:null}),watch:{gridData(){this.oneElementSize=null,this.recalculate()}},computed:{cursorType(){return Ge.b.getCursorType(this.metadata)}},methods:{recalculate(){let e=this.$refs.mainContainer.getBoundingClientRect(),t=Ge.b.getOneElementSize(e,this.gridData);this.oneElementSize&&this.oneElementSize.width===t.width&&this.oneElementSize.height===t.height||(this.oneElementSize=t)},resizeListener(){ee.Z.debounce((()=>{this.recalculate()}),100,"WINDOW_RESIZE"+this.gridData.id)}},mounted(){this.recalculate(),window.ResizeObserver?(this.resizeObserver=new ResizeObserver((()=>{this.resizeListener()})),this.resizeObserver.observe(this.$refs.mainContainer)):(this.recalculate(),window.addEventListener("resize",this.resizeListener))},beforeDestroy(){this.resizeObserver?this.resizeObserver.disconnect():window.removeEventListener("resize",this.resizeListener)}},Hf,[],!1,null,"3bab11ec",null).exports,Py={components:{AppGridDisplay:Ly,SliderInput:qf,Accordion:Gg},props:["gridElement"],data:function(){return{metadata:null,currentLang:o.A.getContentLang(),colorCategories:[],constants:C.A,testGridData:null,GridElement:O.V}},methods:{resetTestGrid(){let e=JSON.parse(JSON.stringify(this.gridElement));e.x=0,e.y=0,this.testGridData=new c.D({gridElements:[e]})}},mounted(){this.resetTestGrid(),Qc.setHelpLocation("03_appearance_layout","#edit-modal"),xg.getMetadata().then((e=>{this.metadata=e,this.colorCategories=d.e.getActiveColorScheme(e).categories,this.colorCategories.includes(this.gridElement.colorCategory)||(this.gridElement.colorCategory=void 0)}))},beforeDestroy(){Qc.revertToLastLocation()}},My=Py;var Uy=s(6634),Fy={};Fy.styleTagTransform=Ed(),Fy.setAttributes=gd(),Fy.insert=vd().bind(null,"head"),Fy.domAPI=hd(),Fy.insertStyleElement=yd(),dd()(Uy.A,Fy),Uy.A&&Uy.A.locals&&Uy.A.locals;const By=Cd(My,Kf,[],!1,null,"cda7f9de",null).exports;var Gy=function(){var e=this,t=e._self._c;return t("div",{on:{dragenter:e.preventDefault,dragover:e.preventDefault,drop:e.imageDropped}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputImg"}},[e._v(e._s(e.$t("image")))]),e._v(" "),t("button",{staticClass:"three columns file-input",attrs:{onclick:"document.getElementById('inputImg').click();"}},[t("input",{staticClass:"five columns",attrs:{type:"file",id:"inputImg",accept:"image/*"},on:{change:e.changedImg}}),e._v(" "),t("span",[t("i",{staticClass:"fas fa-file-upload"}),e._v(" "),t("span",[e._v(e._s(e.$t("chooseFile")))])])]),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.searchText=e.gridElement.label[e.i18nService.getContentLang()],e.searchInput(0)}}},[t("i",{staticClass:"fas fa-search"}),e._v(" "),t("span",[e._v(e._s(e.$t("searchByLabel")))])]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.hasImage,expression:"hasImage"}],staticClass:"three columns",on:{click:e.clearImage}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("clearImage")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"img-preview offset-by-two four columns"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.hasImage,expression:"!hasImage"}],staticClass:"show-mobile"},[t("i",{staticClass:"fas fa-image"}),e._v(" "),t("span",[e._v(e._s(e.$t("noImageChosen")))])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.hasImage,expression:"!hasImage"}],staticClass:"hide-mobile"},[t("i",{staticClass:"fas fa-arrow-down"}),e._v(" "),t("span",[e._v(e._s(e.$t("dropImageHere")))])]),e._v(" "),e.hasImage?t("img",{attrs:{id:"imgPreview",src:e.gridElement.image.data||e.gridElement.image.url}}):e._e(),e._v(" "),e.gridElement.image.author?t("div",[e._v("\n                "+e._s(e.$t("by"))+" "),t("a",{attrs:{href:e.gridElement.image.authorURL,target:"_blank"}},[e._v(e._s(e.gridElement.image.author))])]):e._e()]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.hasImage,expression:"hasImage"}],staticClass:"img-preview five columns hide-mobile",staticStyle:{"margin-top":"50px"}},[t("span",[t("i",{staticClass:"fas fa-arrow-down"}),e._v(" "),t("span",[e._v(e._s(e.$t("dropNewImageHere")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputSearch"}},[e._v(e._s(e.$t("imageSearch")))]),e._v(" "),t("div",{staticClass:"five columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],attrs:{id:"inputSearch",type:"text",placeholder:e._f("translate")("SEARCH_IMAGE_PLACEHOLDER")},domProps:{value:e.searchText},on:{input:[function(t){t.target.composing||(e.searchText=t.target.value)},function(t){return e.searchInput(500,t)}]}}),e._v(" "),t("button",{attrs:{"aria-label":e.$t("clear")},on:{click:e.clearSearch}},[t("i",{staticClass:"fas fa-times"})])]),e._v(" "),e.searchProvider?t("div",{staticClass:"four columns"},[t("label",{attrs:{for:"searchProvider"}},[e._v(e._s(e.$t("searchProvider")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.searchProvider,expression:"searchProvider"}],attrs:{id:"searchProvider"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.searchProvider=t.target.multiple?n:n[0]},function(t){e.searchInput(0),e.localStorageService.save(e.EDIT_ELEM_SELECTED_SEARCH_PROVIDER,e.searchProvider.name)}]}},e._l(e.searchProviders,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(n.name))])})),0),e._v(" "),t("a",{attrs:{href:e.searchProvider.url,target:"_blank"}},[e._v(e._s(e.$t("moreInfo")))])]):e._e()]),e._v(" "),e.searchProvider&&(e.searchProvider.options||e.searchProvider.searchLangs)?t("div",{staticClass:"srow"},[t("accordion",{staticClass:"offset-by-two ten columns",attrs:{"acc-label":e.$t("settingsForImageSearch"),"acc-label-type":"span","acc-background-color":"white"}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"searchLang"}},[e._v(e._s(e.$t("searchLang")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.searchLang,expression:"searchLang"}],staticClass:"five columns",attrs:{id:"searchLang"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.searchLang=t.target.multiple?n:n[0]},function(t){e.searchInput(0),e.localStorageService.saveJSON(e.EDIT_ELEM_SEARCH_LANG_PREFIX+e.searchProvider.name,e.searchLang)}]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("automaticCurrentLanguage")))]),e._v(" "),e._l(e.searchProvider.searchLangs,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t("lang."+n)))])}))],2)]),e._v(" "),e._l(e.searchProvider.options,(function(n){return t("div",[n.type===e.constants.OPTION_TYPES.BOOLEAN?t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:n.value,expression:"option.value"}],attrs:{id:e.searchProvider.name+n.name,type:"checkbox"},domProps:{checked:Array.isArray(n.value)?e._i(n.value,null)>-1:n.value},on:{input:function(t){return e.searchInput(0)},change:function(t){var r=n.value,i=t.target,o=!!i.checked;if(Array.isArray(r)){var a=e._i(r,null);i.checked?a<0&&e.$set(n,"value",r.concat([null])):a>-1&&e.$set(n,"value",r.slice(0,a).concat(r.slice(a+1)))}else e.$set(n,"value",o)}}}),e._v(" "),t("label",{attrs:{for:e.searchProvider.name+n.name}},[e._v(e._s(e.$t(e.searchProvider.name+n.name)))])]):e._e(),e._v(" "),n.type===e.constants.OPTION_TYPES.COLOR?t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:e.searchProvider.name+n.name}},[e._v(e._s(e.$t(e.searchProvider.name+n.name)))]),e._v(" "),n.value?e._e():t("span",{staticClass:"two columns"},[e._v("(transparent)")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.value,expression:"option.value"}],ref:"colorInput",refInFor:!0,class:n.value?"two columns":"",style:n.value?"":"height: 1px; width: 1px; opacity: 0",attrs:{id:e.searchProvider.name+n.name,type:"color"},domProps:{value:n.value},on:{input:[function(t){t.target.composing||e.$set(n,"value",t.target.value)},function(t){return e.searchInput(0)}]}}),e._v(" "),n.value?t("input",{style:"height: 1px; width: 1px; opacity: 0",attrs:{"aria-hidden":"true",disabled:"true"}}):e._e(),e._v(" "),t("button",{staticClass:"mx-2",on:{click:function(t){return e.$refs.colorInput[0].click()}}},[e._v(e._s(e.$t("chooseColor")))]),e._v(" "),t("button",{staticClass:"mx-2",attrs:{disabled:!n.value},on:{click:function(t){n.value=void 0,e.searchInput(0)}}},[e._v(e._s(e.$t("clear")))])]):e._e(),e._v(" "),n.type===e.constants.OPTION_TYPES.SELECT?t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:e.searchProvider.name+n.name}},[e._v(e._s(e.$t(e.searchProvider.name+n.name)))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:n.value,expression:"option.value"}],staticClass:"three columns",attrs:{id:e.searchProvider.name+n.name},on:{change:[function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(n,"value",t.target.multiple?r:r[0])},function(t){return e.searchInput(0)}]}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l(n.options,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t(n)))])}))],2)]):e._e(),e._v(" "),n.type===e.constants.OPTION_TYPES.SELECT_COLORS?t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:e.searchProvider.name+n.name}},[e._v(e._s(e.$t(e.searchProvider.name+n.name)))]),e._v(" "),t("div",{staticClass:"nine columns colorSelector"},[t("div",{staticClass:"inline"},[t("button",{attrs:{"aria-label":e.$t("noneSelected"),"aria-selected":void 0===n.value},on:{click:function(t){n.value=void 0,e.afterColorChange(),e.searchInput(0)}}},[e._v(e._s(e.$t("noneSelected")))])]),e._v(" "),e._l(n.colors,(function(r,i){return t("div",{staticClass:"inline"},[t("button",{style:`background-color: ${r};`,attrs:{"aria-label":n.options[i],title:n.colors[i],"aria-selected":n.options[i]===n.value},on:{click:function(t){n.value=n.options[i],e.afterColorChange(),e.searchInput(0)}}})])}))],2)]):e._e()])}))],2)],1):e._e(),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"offset-by-two ten columns"},[e._l(e.searchResults,(function(n){return t("div",{staticClass:"inline"},[n.url?t("img",{staticClass:"inline img-result",attrs:{src:n.url,title:e.$t("byAuthor",[n.author]),width:"60",height:"60",role:"button"},on:{click:function(t){e.gridElement.image=n}}}):e._e()])})),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.searchResults&&e.searchResults.length>0&&e.hasNextChunk,expression:"searchResults && searchResults.length > 0 && hasNextChunk"}],staticClass:"inline"},[t("button",{staticStyle:{height:"60px",margin:"0 0 0 0.5em",padding:"0.7em",float:"left"},on:{click:e.searchMore}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",[e._v(e._s(e.$t("more")))])])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.searchLoading,expression:"searchLoading"}]},[t("i",{staticClass:"fas fa-spinner fa-spin"}),e._v(" "),t("span",[e._v(e._s(e.$t("searching")))])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.searchError,expression:"searchError"}]},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("searchFailedMaybeNotConnectedToInternet")))])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.searchError&&!e.searchLoading&&e.searchResults&&0===e.searchResults.length,expression:"!searchError && !searchLoading && searchResults && searchResults.length === 0"}]},[t("span",[t("b",[e._v(e._s(e.$t("noSearchResults")))])])])],2)])])};Gy._withStripped=!0;let $y={PROP_IMAGE_URL:"image_url",PROP_AUTHOR:"author",PROP_AUTHOR_URL:"author_url",SEARCH_PROVIDER_NAME:"OPENSYMBOLS"},Vy=1,jy=null,Ky=null,Wy=!1,qy={name:$y.SEARCH_PROVIDER_NAME,url:"https://www.opensymbols.org/",service:$y};function Hy(e,n,r){r=r||20,n=n||1;let i=[];return new Promise(((o,a)=>{if(!e)return o([]);function s(t){t&&t.length&&0!==t.length||(t=[]);let a=n*r-r,s=a+r-1;Wy=t.length>s+1;for(let e=a;e<=s;e++)if(t[e]){let n={},r=JSON.parse(JSON.stringify(t[e]));n.url=r[$y.PROP_IMAGE_URL],n.author=r[$y.PROP_AUTHOR],n.authorURL=r[$y.PROP_AUTHOR_URL],n.searchProviderName=$y.SEARCH_PROVIDER_NAME,i.push(n)}jy=e,o(i)}jy!==e?t.A.get("https://www.opensymbols.org/api/v1/symbols/search?q="+e,null,(function(e){Ky=e,s(e)})).fail((()=>{a("no internet")})):s(Ky)}))}$y.getSearchProviderInfo=function(){let e=JSON.parse(JSON.stringify(qy));return e.service=$y,e},$y.query=function(e){return Vy=1,Wy=!1,Hy(e)},$y.nextChunk=function(){return Vy++,Hy(jy,Vy,20)},$y.hasNextChunk=function(){return Wy};const Yy="AG_EDIT_ELEM_SELECTED_SEARCH_PROVIDER",zy="EDIT_ELEM_SEARCH_LANG_",Jy={props:["gridElement","gridData","imageSearch"],components:{Accordion:Gg},computed:{hasImage:function(){return this.gridElement&&this.gridElement.image&&(this.gridElement.image.data||this.gridElement.image.url)}},data:function(){return{searchText:null,searchProviders:[Ju.getSearchProviderInfo(),$y.getSearchProviderInfo()],searchProvider:null,searchResults:null,searchLoading:!1,searchLang:null,searchError:!1,hasNextChunk:!0,constants:C.A,i18nService:o.A,localStorageService:n.w,EDIT_ELEM_SELECTED_SEARCH_PROVIDER:Yy,EDIT_ELEM_SEARCH_LANG_PREFIX:zy}},watch:{searchProvider:{handler(e,t){if(e&&e.options&&this.gridElement.image&&this.gridElement.image.url&&this.gridElement.image.searchProviderName===Ju.SEARCH_PROVIDER_NAME){let t=Ju.getUpdatedUrl(this.gridElement.image.url,e.options);t!==this.gridElement.image.url&&(this.gridElement.image.url=t,this.gridElement.image.searchProviderOptions=e.options)}},deep:!0}},methods:{changedImg(){let e=this;e.clearImage(),ue.M.getBase64FromInput($("#inputImg")[0]).then((t=>{e.setBase64(t)}))},imageDropped(e){let t=this;if(e.preventDefault(),this.clearImage(),e.dataTransfer.files&&e.dataTransfer.files.length>0)$("#inputImg")[0].files=e.dataTransfer.files,this.changedImg();else{let n=e.dataTransfer.getData("URL");ue.M.urlToBase64(n).then((e=>{t.setBase64(e)}))}},setBase64(e){if(!e)return;let t=this;e.length>51200?ue.M.convertBase64(e,2*t.elementW).then((n=>{n.length<e.length?(log.info(`converted image from ${Math.round(e.length/1024)}kB to ${Math.round(n.length/1024)}kB`),t.gridElement.image.data=n):(log.info(`converting resulted in bigger image (${Math.round(n.length/1024)}kB), using old image with ${Math.round(e.length/1024)}kB`),t.gridElement.image.data=e)})):(log.debug(`image size is ${Math.round(e.length/1024)}kB`),t.gridElement.image.data=e)},clearImage(){this.gridElement.image=JSON.parse(JSON.stringify(new ce.q))},preventDefault(e){e.preventDefault()},openHelp(){Qc.openHelp()},search(e){this.searchText=e,this.searchInput(0)},afterColorChange(){this.$forceUpdate(),this.$set(this.searchProvider,"options",JSON.parse(JSON.stringify(this.searchProvider.options)))},searchInput(e,t){let n=this;n.searchError=!1,n.searchText=t?t.target.value:n.searchText,n.searchText&&(e=void 0===e?500:e,n.searchResults=[],n.searchLoading=!0,ee.Z.debounce((function(){n.searchProvider.service.query(n.searchText,n.searchProvider.options,n.searchLang).then((e=>{n.processSearchResults(e)})).catch((()=>{n.searchError=!0,n.searchLoading=!1}))}),e))},searchMore(){let e=this;e.searchProvider.service.nextChunk().then((t=>{e.processSearchResults(t)}))},clearSearch(){this.searchLoading=!1,this.searchResults=null,this.searchText=""},processSearchResults(e){let t=this;t.hasNextChunk=t.searchProvider.service.hasNextChunk(),t.searchResults=t.searchResults.concat(e),t.searchLoading=!1}},mounted(){let e=this.gridElement.image&&this.gridElement.image.searchProviderName,t=e?this.gridElement.image.searchProviderName:n.w.get(Yy),r=e?this.gridElement.image.searchProviderOptions:null;if(this.searchProvider=this.searchProviders.filter((e=>e.name===t))[0]||this.searchProviders[0],r){let e=r.map((e=>e.name));for(let t=0;t<this.searchProvider.options.length;t++){let n=e.indexOf(this.searchProvider.options[t].name);n>-1&&r[n].value&&(this.searchProvider.options[t].value=r[n].value)}}this.searchLang=n.w.getJSON(zy+this.searchProvider.name),Qc.setHelpLocation("03_appearance_layout","#edit-modal");let i=Math.max(...this.gridData.gridElements.map((e=>e.x+1)));this.elementW=Math.round($("#grid-container")[0].getBoundingClientRect().width/i)*(this.gridElement.width||1),this.imageSearch&&this.search(this.imageSearch)},beforeDestroy(){Qc.revertToLastLocation()}},Xy=Jy;var Qy=s(7721),Zy={};Zy.styleTagTransform=Ed(),Zy.setAttributes=gd(),Zy.insert=vd().bind(null,"head"),Zy.domAPI=hd(),Zy.insertStyleElement=yd(),dd()(Qy.A,Zy),Qy.A&&Qy.A.locals&&Qy.A.locals;const e_=Cd(Xy,Gy,[],!1,null,"66f7b61c",null).exports;var t_=function(){var e=this,t=e._self._c;return e.gridElement?t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns"},[e._v(e._s(e.$t("newAction")))]),e._v(" "),t("select",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.selectedNewAction,expression:"selectedNewAction"}],staticClass:"four columns",staticStyle:{"margin-bottom":"0.5em"},attrs:{id:"selectActionType"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedNewAction=t.target.multiple?n:n[0]}}},e._l(e.actionTypes,(function(n){return t("option",{domProps:{value:n.getModelName()}},[e._v(e._s(e._f("translate")(n.getModelName())))])})),0),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.addAction()}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",[e._v(e._s(e.$t("addAction")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("h2",{staticClass:"twelve columns",staticStyle:{"margin-top":"1em","font-size":"1.2em"},attrs:{for:"actionList"}},[e._v(e._s(e.$t("currentActions")))])]),e._v(" "),t("ul",{attrs:{id:"actionList"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:0==e.gridElement.actions.length,expression:"gridElement.actions.length == 0"}],staticClass:"srow"},[t("i18n",{attrs:{path:"noActionsDefinedClickOnAdd",tag:"span"},scopedSlots:e._u([{key:"addAction",fn:function(){return[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("addAction")))])]},proxy:!0}],null,!1,1141122863)})],1),e._v(" "),e._l(e.gridElement.actions,(function(n){return t("li",{staticClass:"srow"},[t("div",{staticClass:"row mt-0"},[t("div",{staticClass:"col-12 col-md-4 mb-3"},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.editActionId!==n.id,expression:"editActionId !== action.id"}]},[e._v(e._s(e._f("translate")(n.modelName)))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.editActionId===n.id,expression:"editActionId === action.id"}]},[t("b",[e._v(e._s(e._f("translate")(n.modelName)))]),e._v(" "),t("a",{staticClass:"black",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})])])]),e._v(" "),t("div",{staticClass:"col-12 col-md-8 actionbtns"},[t("button",{on:{click:function(t){return e.editAction(n)}}},[t("i",{staticClass:"far fa-edit"}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.editActionId!==n.id,expression:"editActionId !== action.id"}],staticClass:"hide-mobile"},[e._v(e._s(e.$t("edit")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.editActionId===n.id,expression:"editActionId === action.id"}],staticClass:"hide-mobile"},[e._v(e._s(e.$t("endEdit")))])]),e._v(" "),t("button",{on:{click:function(t){return e.deleteAction(n)}}},[t("i",{staticClass:"far fa-trash-alt"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("delete")))])]),e._v(" "),e.GridElement.canActionClassBeTested(n.modelName)?t("button",{on:{click:function(t){return e.testAction(n)}}},[t("i",{staticClass:"fas fa-bolt"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("test")))])]):e._e()])]),e._v(" "),e.editActionId===n.id?t("div",{staticStyle:{"margin-top":"1.5em","margin-bottom":"1em"}},[t("edit-action",{attrs:{action:n,grids:e.grids,"grid-data":e.gridData,"grid-element":e.gridElement}})],1):e._e()])}))],2)]):e._e()};t_._withStripped=!0;var n_=function(){var e=this,t=e._self._c;return t("div",[t("test-are-connection",{model:{value:e.action.areURL,callback:function(t){e.$set(e.action,"areURL",t)},expression:"action.areURL"}}),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text"},[e._v(e._s(e.$t("areModel")))])]),e._v(" "),t("div",{staticClass:"eight columns"},[t("div",{staticClass:"srow nomargin"},[t("div",{staticClass:"twelve columns"},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}]},[e._v(e._s(e.$t("loadingModelFromAre")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.areModelSync&&e.areModelFile&&!e.areModelFile.dataBase64,expression:"!loading && areModelSync && areModelFile && !areModelFile.dataBase64"}]},[e._v(e._s(e.$t("couldNotLoadModelFromAre")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&!e.areModelSync&&e.areModelFile&&!e.areModelFile.dataBase64,expression:"!loading && !areModelSync && areModelFile && !areModelFile.dataBase64"}]},[e._v(e._s(e.$t("noAreModel")))]),e._v(" "),!e.loading&&e.areModelFile&&e.areModelFile.dataBase64?t("span",[t("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.downloadModelFile(e.areModelFile)}}},[e._v(e._s(e.areModelFile.fileName))])]):e._e()])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns",on:{click:function(t){return e.reloadAREModel(e.action)}}},[t("i",{staticClass:"fas fa-download"}),e._v(" "),t("span",[e._v(e._s(e.$t("downloadFromAre")))])]),e._v(" "),e.areModelFile&&e.areModelFile.dataBase64?t("button",{staticClass:"six columns",on:{click:function(t){return e.uploadAREModel(e.action)}}},[t("i",{staticClass:"fas fa-upload"}),e._v(" "),t("span",[e._v(e._s(e.$t("uploadToAre")))])]):e._e()])])]),e._v(" "),e.areModelSync?e._e():t("div",{staticClass:"srow"},[t("div",{staticClass:"eight columns offset-by-four"},[t("i",{staticClass:"fas fa-info-circle"}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.areModelFile&&e.areModelFile.dataBase64,expression:"areModelFile && areModelFile.dataBase64"}]},[e._v(e._s(e.$t("uploadTheSavedModelOrDownloadCurrent")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.areModelFile&&!e.areModelFile.dataBase64,expression:"areModelFile && !areModelFile.dataBase64"}]},[e._v(e._s(e.$t("downloadTheCurrentAreModelInOrderToDefine")))])])]),e._v(" "),e.areModelSync?t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"inputComponentId"}},[e._v(e._s(e.$t("component")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.componentId,expression:"action.componentId"}],staticClass:"eight columns",attrs:{id:"inputComponentId"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"componentId",t.target.multiple?n:n[0])},function(t){return e.reloadPorts(e.action)}]}},e._l(e.areComponentIds,(function(n){return t("option",{domProps:{value:n}},[e._v("\n                "+e._s(n)+"\n            ")])})),0)]):e._e(),e._v(" "),e.areModelSync&&0!=e.areComponentPorts.length?t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns offset-by-four"},[t("label",{staticClass:"normal-text",attrs:{for:"inputDataPortId"}},[e._v(e._s(e.$t("sendDataToPort")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.dataPortId,expression:"action.dataPortId"}],staticClass:"full-width",attrs:{id:"inputDataPortId"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"dataPortId",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:""}},[e._v(e._s(e.$t("empty")))]),e._v(" "),e._l(e.areComponentPorts,(function(n){return t("option",{domProps:{value:n}},[e._v("\n                    "+e._s(n)+"\n                ")])}))],2)]),e._v(" "),t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"inputDataPortData"}},[e._v(e._s(e.$t("dataToSend")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.dataPortSendData,expression:"action.dataPortSendData"}],staticClass:"full-width",attrs:{id:"inputDataPortData",type:"text"},domProps:{value:e.action.dataPortSendData},on:{input:function(t){t.target.composing||e.$set(e.action,"dataPortSendData",t.target.value)}}})])]):e._e(),e._v(" "),e.areModelSync&&0!=e.areComponentEventPorts.length?t("div",{staticClass:"srow"},[t("div",{staticClass:"eight columns offset-by-four"},[t("label",{staticClass:"normal-text",attrs:{for:"inputeventPortId"}},[e._v("Event-Port")]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.eventPortId,expression:"action.eventPortId"}],staticClass:"full-width",attrs:{id:"inputeventPortId"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"eventPortId",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:""}},[e._v(e._s(e.$t("empty")))]),e._v(" "),e._l(e.areComponentEventPorts,(function(n){return t("option",{domProps:{value:n}},[e._v("\n                    "+e._s(n)+"\n                ")])}))],2)])]):e._e()],1)};n_._withStripped=!0;var r_=s(7645),i_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"inputAREURI"}},[e._v(e._s(e.$t("areUrl")))])]),e._v(" "),t("div",{staticClass:"eight columns"},[t("div",{staticClass:"srow nomargin"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.areURL,expression:"areURL"}],staticClass:"six columns",attrs:{id:"inputAREURI",type:"text"},domProps:{value:e.areURL},on:{change:function(t){return e.fixAreUrl()},input:function(t){t.target.composing||(e.areURL=t.target.value)}}}),e._v(" "),t("div",{staticClass:"six columns"},[t("button",{staticStyle:{width:"70%"},on:{click:function(t){return e.testAREUrl()}}},[t("i",{staticClass:"fas fa-bolt"}),e._v(" "),t("span",[e._v(e._s(e.$t("testUrl")))])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:void 0===e.areConnected,expression:"areConnected === undefined"}],staticClass:"spaced"},[t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.areConnected,expression:"areConnected"}],staticClass:"spaced",staticStyle:{color:"green"},attrs:{title:e.$t("urlIsValid")}},[t("i",{staticClass:"fas fa-check"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!1===e.areConnected,expression:"areConnected === false"}],staticClass:"spaced",staticStyle:{color:"red"},attrs:{title:e.$t("urlIsInvalid")}},[t("i",{staticClass:"fas fa-times"})])])])])])};i_._withStripped=!0;const o_={props:["value"],data:function(){return{areConnected:null,areURL:null}},methods:{testAREUrl(){let e=this;this.areURL=kc.getRestURL(this.areURL),this.updateValue(),this.areConnected=void 0,kc.getModelName(this.areURL).then((()=>{e.areConnected=!0})).catch((()=>{e.areConnected=!1}))},fixAreUrl(){this.areURL=kc.getRestURL(this.areURL),this.updateValue()},updateValue(){this.$emit("input",this.areURL)}},mounted(){this.areURL=this.value||kc.getRestURL(),this.updateValue()}};var a_=s(3341),s_={};s_.styleTagTransform=Ed(),s_.setAttributes=gd(),s_.insert=vd().bind(null,"head"),s_.domAPI=hd(),s_.insertStyleElement=yd(),dd()(a_.A,s_),a_.A&&a_.A.locals&&a_.A.locals;const l_={props:["action","gridData"],data:function(){return{loading:!1,areComponentIds:[],areComponentPorts:[],areComponentEventPorts:[],areModelFile:null,areModelSync:!1}},components:{TestAreConnection:Cd(o_,i_,[],!1,null,"cdcf59d2",null).exports},methods:{reloadAREModel(e){var t=this;t.loading=!0,kc.downloadDeployedModelBase64(e.areURL).then((n=>{kc.getModelName(e.areURL).then((r=>{t.areModelFile.dataBase64=n,t.areModelFile.fileName=r,e.areModelGridFileName=r,t.updateGridModelFile(),t.loading=!1,t.areModelSync=!0,t.reloadComponentIds(e),t.reloadPorts(e)}))})).catch((()=>{t.areModelFile.dataBase64=null,t.updateGridModelFile(),t.loading=!1}))},updateGridModelFile(){let e=!1;this.gridData.additionalFiles=this.gridData.additionalFiles||[];for(let t=0;t<this.gridData.additionalFiles.length;t++)this.action.areModelGridFileName&&this.action.areModelGridFileName===this.gridData.additionalFiles[t].fileName&&(this.gridData.additionalFiles[t]=this.areModelFile,e=!0);e||this.gridData.additionalFiles.push(this.areModelFile)},uploadAREModel(e){var t=this;kc.uploadModelBase64(t.areModelFile.dataBase64,e.areURL).then((()=>{t.reloadComponentIds(e),t.reloadPorts(e),t.areModelSync=!0}))},reloadComponentIds(e){var t=this;kc.getRuntimeComponentIds(e.areURL).then((e=>{t.areComponentIds=e}))},reloadPorts(e){var t=this;kc.getPossibleEvents(e.componentId,this.areModelFile.dataBase64,e.areURL).then((e=>{t.areComponentEventPorts=e})),kc.getComponentInputPortIds(e.componentId,e.areURL).then((e=>{t.areComponentPorts=e}))},downloadModelFile(e){var t=new Blob([window.atob(e.dataBase64)],{type:"text/plain;charset=utf-8"}),n=-1!=e.fileName.indexOf(".acs")?e.fileName:e.fileName+".acs";l().saveAs(t,n)}},mounted(){this.action.areURL=this.action.areURL||kc.getRestURL(),this.areModelFile=new c.D(this.gridData).getAdditionalFile(this.action.areModelGridFileName),this.areModelFile||(this.areModelFile=new r_.E),Qc.setHelpLocation("05_actions","#asterics-action")},beforeDestroy(){Qc.revertToLastLocation()}};var c_=s(2351),d_={};d_.styleTagTransform=Ed(),d_.setAttributes=gd(),d_.insert=vd().bind(null,"head"),d_.domAPI=hd(),d_.insertStyleElement=yd(),dd()(c_.A,d_),c_.A&&c_.A.locals&&c_.A.locals;const u_=Cd(l_,n_,[],!1,null,"065d04c2",null).exports;var h_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-4"},[t("label",{staticClass:"normal-text",attrs:{for:"inputOpenHABUri"}},[e._v(e._s(e.$t("openHABUrl")))])]),e._v(" "),t("div",{staticClass:"col-12 col-md-4 mb-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.openHABUrl,expression:"action.openHABUrl"}],staticClass:"col-12",attrs:{id:"inputOpenHABUri",type:"text"},domProps:{value:e.action.openHABUrl},on:{change:function(t){return e.fixOpenHABUrl()},input:function(t){t.target.composing||e.$set(e.action,"openHABUrl",t.target.value)}}})]),e._v(" "),t("div",{staticClass:"col-12 col-md-4"},[t("div",{staticClass:"row mb-0"},[t("div",{staticClass:"col-10"},[t("button",{staticClass:"col-12",on:{click:function(t){return e.fetchItems()}}},[t("i",{staticClass:"fas fa-cloud-download-alt"}),e._v(" "),t("span",[e._v(e._s(e.$t("fetchItems")))])])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:void 0===e.fetchSuccessful,expression:"fetchSuccessful === undefined"}],staticClass:"col"},[t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.fetchSuccessful,expression:"fetchSuccessful"}],staticClass:"col",staticStyle:{color:"green"}},[t("i",{staticClass:"fas fa-check"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!1===e.fetchSuccessful,expression:"fetchSuccessful === false"}],staticClass:"col",staticStyle:{color:"red"}},[t("i",{staticClass:"fas fa-times"})])])])]),e._v(" "),e.fetchSuccessful?t("div",[t("fieldset",{staticClass:"p-0 row",staticStyle:{border:"none"},attrs:{role:"radiogroup"}},[t("legend",{staticClass:"col-12 col-md-4 d-inline",staticStyle:{float:"left"}},[e._v(e._s(e.$t("filterByType")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-8"},e._l(Object.values(e.OPENHAB_ITEM_TYPES),(function(n){return t("div",{staticClass:"d-inline"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedTypeFilter,expression:"selectedTypeFilter"}],staticClass:"custom-radio",attrs:{id:n,type:"radio"},domProps:{value:n,checked:e._q(e.selectedTypeFilter,n)},on:{change:[function(t){e.selectedTypeFilter=n},function(t){return e.setFirstItem()}]}}),e._v(" "),t("label",{staticClass:"button mr-3 mb-2 normal-text",attrs:{for:n}},[e._v(e._s(e.$t(n)))])])})),0)]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"searchItems"}},[e._v(e._s(e.$t("searchItem")))]),e._v(" "),t("div",{staticClass:"col-9 col-md-4"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"col-12",attrs:{id:"searchItems",placeholder:e.$t("placeholder-searchItem"),spellcheck:"false",autocomplete:"true",type:"text"},domProps:{value:e.searchText},on:{input:[function(t){t.target.composing||(e.searchText=t.target.value)},function(t){return e.setFirstItem()}]}})]),e._v(" "),t("div",{staticClass:"col-3"},[t("button",{staticClass:"py-0 px-3 mb-0",attrs:{title:e.$t("clearSearchText")},on:{click:function(t){e.searchText="",e.setFirstItem()}}},[t("i",{staticClass:"fas fa-trash"})])])]),e._v(" "),e.filteredItems.length>0?t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-4"},[t("label",{staticClass:"normal-text",attrs:{for:"selectItem"}},[e._v(e._s(e.$t("selectItem")))])]),e._v(" "),t("div",{staticClass:"col-12 col-md-4"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedItem,expression:"selectedItem"}],staticClass:"col-12",attrs:{id:"selectItem"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedItem=t.target.multiple?n:n[0]},function(t){return e.updateAction()}]}},e._l(e.filteredItems,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t(n.type))+": "+e._s(n.name))])})),0)])])]):e._e()]):e._e(),e._v(" "),e.fetchSuccessful&&0===e.filteredItems.length?t("div",{staticClass:"row"},[t("span",{staticClass:"col-12 col-md-6 offset-md-4"},[e._v("(no items)")])]):e._e(),e._v(" "),!e.fetchSuccessful&&e.action.itemName?t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-4"},[t("label",{staticClass:"normal-text",attrs:{for:e.action.itemName}},[e._v(e._s(e.$t("selectedItem")))])]),e._v(" "),t("div",{staticClass:"col-12 col-md-8",attrs:{id:e.action.itemName}},[e._v("\n                "+e._s(e.$t(e.action.itemType))+": "+e._s(e.action.itemName)+"\n            ")])])]):e._e(),e._v(" "),e.fetchSuccessful&&e.filteredItems.length>0||e.action.itemName?t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-4"},[t("label",{staticClass:"normal-text",attrs:{for:"selectAction"}},[e._v(e._s(e.$t("selectAction")))])]),e._v(" "),t("div",{staticClass:"col-12 col-md-4 mb-2"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.actionType,expression:"action.actionType"}],staticClass:"col-12",attrs:{id:"selectAction"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"actionType",t.target.multiple?n:n[0])},function(t){e.action.actionValue="0"}]}},e._l(e.OPENHAB_TYPES_TO_ACTIONS[e.action.itemType],(function(n){return t("option",{domProps:{value:n}},[e._v("\n                        "+e._s(e.$t(`openHAB.${n}`))+"\n                    ")])})),0)]),e._v(" "),t("div",{staticClass:"col-12 col-md-4"},[t("button",{staticClass:"col-12 col-md-10",on:{click:e.addAllActionElements}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "+e._s(e.$t("createGridElements")))])])])]):e._e(),e._v(" "),"CUSTOM_VALUE"===e.action.actionType?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"customValue"}},[e._v(e._s(e.$t("customValue")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-8"},[t("div",{staticClass:"row m-0"},[t("div",{staticClass:"col-10 col-sm-11"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.actionValue,expression:"action.actionValue"}],staticClass:"col-12",attrs:{id:"customValue",max:"100",min:"0",type:"range"},domProps:{value:e.action.actionValue},on:{__r:function(t){return e.$set(e.action,"actionValue",t.target.value)}}})]),e._v(" "),t("div",{staticClass:"col-2 col-sm-1"},[t("span",[e._v(e._s(e.action.actionValue))])])])])]):e._e(),e._v(" "),"CUSTOM_COLOR"===e.action.actionType?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"customColor"}},[e._v(e._s(e.$t("customColor")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-8"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.actionValue,expression:"action.actionValue"}],attrs:{id:"customColor",type:"color"},domProps:{value:e.action.actionValue},on:{input:function(t){t.target.composing||e.$set(e.action,"actionValue",t.target.value)}}})])]):e._e()])};h_._withStripped=!0;const p_={ALL:"All",SWITCH:"Switch",DIMMER:"Dimmer",ROLLERSHUTTER:"Rollershutter",COLOR:"Color",NUMBER:"Number",PLAYER:"Player",TEMPERATURE:"Number:Temperature"},v_={};v_[p_.SWITCH]=["ON","OFF","TOGGLE"],v_[p_.DIMMER]=["ON","OFF","DECREASE","INCREASE","CUSTOM_VALUE"],v_[p_.ROLLERSHUTTER]=["UP","DOWN","STOP","CUSTOM_VALUE"],v_[p_.COLOR]=["ON","OFF","CUSTOM_VALUE","CUSTOM_COLOR"],v_[p_.NUMBER]=["CUSTOM_VALUE"],v_[p_.TEMPERATURE]=["CUSTOM_VALUE"],v_[p_.PLAYER]=["PLAY","PAUSE","NEXT","PREVIOUS","REWIND","FASTFORWARD"];const m_=["ON","OFF","TOGGLE","INCREASE","DECREASE","UP","DOWN","STOP","PLAY","PAUSE","NEXT","PREVIOUS","REWIND","FASTFORWARD"],g_={};g_.ON=Ju.getGridImageById(21818),g_.OFF=Ju.getGridImageById(21365),g_.TOGGLE=Ju.getGridImageById(38753),g_.INCREASE=Ju.getGridImageById(5521),g_.DECREASE=Ju.getGridImageById(5546),g_.UP=Ju.getGridImageById(38755),g_.DOWN=Ju.getGridImageById(38754),g_.STOP=Ju.getGridImageById(38251),g_.PLAY=Ju.getGridImageById(38221),g_.PAUSE=Ju.getGridImageById(38213),g_.NEXT=Ju.getGridImageById(38223),g_.PREVIOUS=Ju.getGridImageById(38224),g_.REWIND=Ju.getGridImageById(38219),g_.FASTFORWARD=Ju.getGridImageById(38220);const f_={props:["action","gridData"],data:()=>({fetchedItems:[],selectedItem:null,selectedTypeFilter:p_.ALL,fetchSuccessful:null,searchText:"",OPENHAB_ITEM_TYPES:p_,OPENHAB_TYPES_TO_ACTIONS:v_}),computed:{filteredItems(){return this.fetchedItems,this.selectedTypeFilter,this.getFilteredItems()}},methods:{fetchItems(){this.fetchSuccessful=void 0,dh.fetchItems(this.action.openHABUrl).then((e=>{this.fetchSuccessful=!0;let t=e.filter((e=>Object.values(p_).some((t=>t.startsWith(e.type)))));t.sort(((e,t)=>e.type.localeCompare(t.type)||e.name.localeCompare(t.name))),JSON.stringify(this.fetchedItems)!==JSON.stringify(t)&&(this.fetchedItems=t,this.setFirstItem())})).catch((e=>{this.fetchSuccessful=!1,console.error(e)}))},getFilteredItems(){let e=this.fetchedItems.filter((e=>e.name.toLowerCase().match(this.searchText.toLowerCase())));return e=e.filter((e=>this.selectedTypeFilter===p_.ALL||e.type===this.selectedTypeFilter)),e},fixOpenHABUrl(){this.action.openHABUrl=dh.getRestURL(this.action.openHABUrl)},updateAction(){let e=this.selectedItem||{};this.action.itemName=e.name,this.action.itemType=e.type,this.action.actionType=this.action.itemType?v_[this.action.itemType][0]:null},setFirstItem(){let e=this.getFilteredItems();this.selectedItem=e[0],this.updateAction()},addAllActionElements(){let e=(v_[this.action.itemType]||[]).filter((e=>m_.includes(e)));if(confirm(o.A.t("thisActionAddsXNewElements",e.length))){this.gridData.rowCount++;for(let t of e){let e=JSON.parse(JSON.stringify(this.action));e.actionType=t;let n=new c.D(this.gridData).getNewGridElement({label:o.A.getTranslationObject(`${this.action.itemName} - ${o.A.t(`openHAB.${t}`)}`),actions:[e],image:g_[t]});this.gridData.gridElements.push(n)}}}},mounted(){this.action.openHABUrl=this.action.openHABUrl||dh.getRestURL(),this.selectedTypeFilter=this.action.itemType||"All"}};var y_=s(8228),__={};__.styleTagTransform=Ed(),__.setAttributes=gd(),__.insert=vd().bind(null,"head"),__.domAPI=hd(),__.insertStyleElement=yd(),dd()(y_.A,__),y_.A&&y_.A.locals&&y_.A.locals;const E_=Cd(f_,h_,[],!1,null,"535280e2",null).exports;var b_=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("h3",{staticClass:"six columns"},[e._v(e._s(e.$t("selectedRadioStations")))]),e._v(" "),t("button",{staticClass:"six columns",attrs:{disabled:0===e.gridData.webRadios.length},on:{click:e.addAllRadioElements}},[e._v(e._s(e.$t("createGridElementsForWebradios")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("ul",{staticClass:"webradioList"},e._l(e.gridData.webRadios,(function(n){return t("li",[t("div",{staticClass:"webRadioListItem"},[t("img",{attrs:{src:n.faviconUrl}}),e._v(" "),t("div",{staticClass:"webRadioLabel"},[e._v(e._s(n.radioName))]),e._v(" "),t("div",{staticClass:"webRadioButtons"},[t("button",{staticClass:"right",on:{click:function(t){return e.removeRadio(n)}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("remove")))]),e._v(" "),t("i",{staticClass:"fas fa-trash"})]),e._v(" "),e.webradioPlaying!==n?t("button",{staticClass:"right",on:{click:function(t){e.webradioPlaying=n,e.webradioService.play(n)}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("play"))+" ")]),t("i",{staticClass:"fas fa-play"})]):e._e(),e._v(" "),e.webradioPlaying===n?t("button",{staticClass:"right",on:{click:function(t){e.webradioPlaying=null,e.webradioService.stop()}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("stop")))]),e._v(" "),t("i",{staticClass:"fas fa-pause"})]):e._e(),e._v(" "),t("button",{staticClass:"right",on:{click:function(t){return e.moveWebradioUp(n)}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("up")))]),e._v(" "),t("i",{staticClass:"fas fa-arrow-up"})])])])])})),0),e._v(" "),0===e.gridData.webRadios.length?t("div",[e._v(e._s(e.$t("noSelectedRadioStationsUseSearchBar")))]):e._e()]),e._v(" "),t("div",{staticClass:"srow"},[t("h3",{staticClass:"four columns"},[e._v(e._s(e.$t("webradioSearch")))]),e._v(" "),t("span",{staticClass:"eight columns",attrs:{id:"poweredby"}},[t("i18n",{attrs:{path:"radioSearchPoweredBy",tag:"span"},scopedSlots:e._u([{key:"radioLink",fn:function(){return[t("a",{attrs:{href:"https://www.radio-browser.info/gui/#!/",target:"_blank"}},[e._v("radio-browser.info")])]},proxy:!0}])})],1)]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"searchwebradios"}},[e._v(e._s(e.$t("searchTerm")))]),e._v(" "),t("i",{staticClass:"fas fa-info-circle hide-mobile",attrs:{title:e.$t("byDefaultSearchesForRadioStationNameAdvanced")}})]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.webradioSearch,expression:"webradioSearch"}],staticClass:"eight columns",attrs:{id:"searchwebradios",type:"text"},domProps:{value:e.webradioSearch},on:{input:[function(t){t.target.composing||(e.webradioSearch=t.target.value)},function(t){return e.searchWebradios(t)}]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("ul",{staticClass:"webradioList"},e._l(e.webradioSearchResults,(function(n){return t("li",[t("div",{staticClass:"webRadioListItem"},[t("img",{attrs:{src:n.faviconUrl}}),e._v(" "),t("div",{staticClass:"webRadioLabel"},[e._v(e._s(n.radioName))]),e._v(" "),t("div",{staticClass:"webRadioButtons"},[t("button",{staticClass:"right",attrs:{disabled:e.gridData.webRadios.map((e=>e.radioId)).indexOf(n.radioId)>-1},on:{click:function(t){return e.gridData.webRadios.push(n)}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("select")))]),e._v(" "),t("i",{staticClass:"fas fa-plus"})]),e._v(" "),e.webradioPlaying!==n?t("button",{staticClass:"right",on:{click:function(t){e.webradioPlaying=n,e.webradioService.play(n)}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("play"))+" ")]),t("i",{staticClass:"fas fa-play"})]):e._e(),e._v(" "),e.webradioPlaying===n?t("button",{staticClass:"right",on:{click:function(t){e.webradioPlaying=null,e.webradioService.stop()}}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("stop"))+" ")]),t("i",{staticClass:"fas fa-pause"})]):e._e()])])])})),0),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.webradioSearchResults.length&&e.webradioSearch&&!e.webradioSearching&&!e.webradioSearchError,expression:"webradioSearchResults.length === 0 && webradioSearch && !webradioSearching && !webradioSearchError"}]},[e._v(e._s(e.$t("noRadioStationsFoundTryAnOtherSearchTerm")))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.webradioSearchError,expression:"webradioSearchError"}]},[t("span",[e._v(e._s(e.$t("searchingFailedNoConnectionToInternet")))]),e._v(" "),t("a",{attrs:{href:"javascript:;"},on:{click:e.searchWebradios}},[e._v(e._s(e.$t("retry")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.webradioSearchResults.length>0,expression:"webradioSearchResults.length > 0"}],staticStyle:{display:"flex","margin-top":"0.5em"}},[t("button",{staticStyle:{"flex-grow":"1"},attrs:{disabled:0===e.webradioStartIndex},on:{click:e.prevSearchResults}},[t("i",{staticClass:"fas fa-arrow-left"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("previousPage")))])]),e._v(" "),t("button",{staticStyle:{"flex-grow":"1"},attrs:{disabled:!e.hasMoreWebradios},on:{click:e.nextSearchResults}},[t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("nextPage")))]),e._v(" "),t("i",{staticClass:"fas fa-arrow-right"})])])])])};b_._withStripped=!0;const S_={props:{gridData:Object},data:()=>({webradioSearchResults:[],webradioSearch:null,webradioService:Eh,webradioPlaying:null,webradioStartIndex:0,webradioSearching:!1,webradioSearchError:!1,hasMoreWebradios:!1}),methods:{addAllRadioElements(){if(!confirm(o.A.t("thisActionAddsXNewElements",this.gridData.webRadios.length)))return;let e=this,t=Promise.resolve();e.gridData.webRadios.forEach(((n,r)=>{var i;t=t.then((i=n,()=>{let t=ue.M.urlToBase64(i.faviconUrl).then((t=>{let n=t?new ce.q({data:t}):void 0,r=new c.D(e.gridData).getNewGridElement({label:o.A.getTranslationObject(i.radioName),actions:[new mh.o({radioId:i.radioId,action:mh.o.WEBRADIO_ACTION_START})],image:n});return e.gridData.gridElements.push(r),Promise.resolve()}));return t}))}))},searchWebradios(e){this.webradioSearch=e.target.value,this.webradioStartIndex=0,this.searchWebradiosInternal()},nextSearchResults(){this.webradioStartIndex+=10,this.searchWebradiosInternal()},prevSearchResults(){this.webradioStartIndex-=10,this.searchWebradiosInternal()},searchWebradiosInternal(){let e=this;e.webradioSearching=!0,e.webradioSearchError=!1,ee.Z.debounce((()=>{Eh.search(e.webradioSearch,10,e.webradioStartIndex).then((t=>{e.hasMoreWebradios=Eh.hasMoreSearchResults(),e.webradioSearchResults=t,e.webradioSearching=!1})).catch((t=>{e.webradioSearchError=!0,e.webradioSearching=!1}))}),500)},moveWebradioUp(e){let t=this.gridData.webRadios.indexOf(e);t>0&&this.gridData.webRadios.splice(t-1,0,this.gridData.webRadios.splice(t,1)[0])},removeRadio(e){Eh.stop(e.radioId),this.gridData.webRadios=this.gridData.webRadios.filter((t=>t.radioId!==e.radioId))}},mounted(){}},C_=S_;var w_=s(2890),A_={};A_.styleTagTransform=Ed(),A_.setAttributes=gd(),A_.insert=vd().bind(null,"head"),A_.domAPI=hd(),A_.insertStyleElement=yd(),dd()(w_.A,A_),w_.A&&w_.A.locals&&w_.A.locals;const T_=Cd(C_,b_,[],!1,null,"050f21d5",null).exports;var I_=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-4"},[t("span",[e._v(e._s(e.$t("currentRecording")))]),e._v(":\n        ")]),e._v(" "),e.recording?t("div",{staticClass:"col-12 col-md-4"},[e._v("\n            "+e._s(e.i18nService.t("recordingSeconds",(e.recordTimeMs/1e3).toFixed(1)))+"\n        ")]):e._e(),e._v(" "),e.action.dataBase64||e.recording?e._e():t("div",{staticClass:"col-12 col-md-4"},[e._v("\n            (none)\n        ")]),e._v(" "),e.action.dataBase64&&e.action.durationMs?t("div",{staticClass:"col-12 col-md-4"},[e._v("\n            "+e._s(e.i18nService.t("audioWithLengthOfSeconds",(e.action.durationMs/1e3).toFixed(1)))+"\n        ")]):e._e(),e._v(" "),e.action.dataBase64&&e.action.filename?t("div",{staticClass:"col-12 col-md-4"},[e._v("\n            "+e._s(e.i18nService.t("audioFromFileWithName",e.action.filename))+"\n        ")]):e._e()]),e._v(" "),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col-12 col-md-8 offset-md-4"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md"},[t("button",{staticClass:"col-12",attrs:{disabled:e.playing},on:{click:function(t){return e.toggleRecord()}}},[e.recording?e._e():t("span",[t("span",{staticClass:"fas fa-microphone"}),e._v(" "),t("span",[e._v(e._s(e.$t("record")))])]),e._v(" "),e.recording?t("span",[t("span",{staticClass:"fas fa-microphone-slash"}),e._v(" "),t("span",[e._v(e._s(e.$t("stopRecording")))])]):e._e()])]),e._v(" "),t("div",{staticClass:"col-12 col-md"},[t("button",{staticClass:"file-input col-12",attrs:{onclick:"document.getElementById('inputFile').click();"}},[t("input",{staticClass:"five columns",attrs:{type:"file",id:"inputFile",accept:"audio/*"},on:{change:e.changedFile}}),e._v(" "),t("span",[t("i",{staticClass:"fas fa-file-upload"}),e._v(" "),t("span",[e._v(e._s(e.$t("chooseFile")))])])])]),e._v(" "),t("div",{staticClass:"col-12 col-md"},[t("button",{staticClass:"col-12",attrs:{disabled:e.recording||!e.action.dataBase64},on:{click:function(t){return e.togglePlaying()}}},[e.playing?e._e():t("span",[t("span",{staticClass:"fas fa-play"}),e._v(" "),t("span",[e._v(e._s(e.$t("play")))])]),e._v(" "),e.playing?t("span",[t("span",{staticClass:"fas fa-stop"}),e._v(" "),t("span",[e._v(e._s(e.$t("stop")))])]):e._e()])])])])]),e._v(" "),e.showError?t("div",{staticClass:"row mt-3"},[t("span",{staticClass:"col-12 col-md-8 offset-md-4"},[t("span",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("pleaseAllowAccessingMicrophoneInOrderToRecordAudio")))]),e._v(".\n        ")])]):e._e(),e._v(" "),e.showError2?t("div",{staticClass:"row mt-3"},[t("span",{staticClass:"col-12 col-md-8 offset-md-4"},[t("span",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("selectedAudioFileIsTooBig")))]),e._v(".\n        ")])]):e._e(),e._v(" "),e.globalHasContinuousSpeakAction?t("div",{staticClass:"row mt-3"},[t("span",{staticClass:"col-12 col-md-8 offset-md-4"},[t("span",{staticClass:"fas fa-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t("recordedAudioIsOnlyPlayedWithCollectElementActions")))]),e._v(". "),t("a",{attrs:{href:"javascript:;"},on:{click:e.setModePlaySeparately}},[e._v(e._s(e.$t("setActionsOfGlobalGridToModeSpeakSeparately")))])])]):e._e(),e._v(" "),e.updatedGlobalSpeakActions?t("div",{staticClass:"row mt-3"},[t("span",{staticClass:"col-12 col-md-8 offset-md-4"},[t("span",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("speakActionsOfGlobalGridWereSetToModeModeSpeak")))]),e._v(". "),t("a",{attrs:{href:"javascript:;"},on:{click:e.undoSetModePlaySeparately}},[e._v(e._s(e.$t("undo")))])])]):e._e()])};I_._withStripped=!0;const k_={props:["action","gridData"],data:function(){return{audioUtil:Pc,recordTimeMs:0,recording:!1,playing:!1,intervalHandler:null,showError:null,showError2:null,i18nService:o.A,globalGrid:null,originalGlobalGrid:null,updatedGlobalSpeakActions:!1}},computed:{globalHasContinuousSpeakAction(){if(!this.globalGrid)return!1;for(let e of this.globalGrid.gridElements)for(let t of e.actions)if(t.modelName===x.z.getModelName()&&[x.z.COLLECT_ACTION_SPEAK_CONTINUOUS,x.z.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR].includes(t.action))return!0;return!1}},methods:{changedFile(){let e=this;$("#inputFile")[0].files[0].size>204800?this.showError2=!0:ue.M.getBase64FromInput($("#inputFile")[0]).then((t=>{this.clearAll(),e.action.dataBase64=ue.M.dataStringToBase64(t),e.action.filename=$("#inputFile")[0].files[0].name,e.$forceUpdate()}))},toggleRecord(){this.recording?this.stopRecording():this.record()},togglePlaying(){this.playing?this.stopPlaying():this.play()},async record(){this.clearAll();try{await Pc.record((e=>{this.action.dataBase64=e.base64,this.action.mimeType=e.mimeType,this.action.durationMs=this.recordTimeMs,this.$forceUpdate()}))}catch(e){return void(this.showError=!0)}this.recording=!0,this.recordTimeMs=0,this.intervalHandler=setInterval((()=>{this.recordTimeMs+=100,1e4===this.recordTimeMs&&this.stopRecording()}),100)},setModePlaySeparately(){for(let e of this.globalGrid.gridElements)for(let t of e.actions)t.modelName===x.z.getModelName()&&(t.action===x.z.COLLECT_ACTION_SPEAK_CONTINUOUS&&(t.action=x.z.COLLECT_ACTION_SPEAK),t.action===x.z.COLLECT_ACTION_SPEAK_CONTINUOUS_CLEAR&&(t.action=x.z.COLLECT_ACTION_SPEAK_CLEAR));xg.saveGrid(this.globalGrid),this.updatedGlobalSpeakActions=!0},undoSetModePlaySeparately(){this.globalGrid=JSON.parse(JSON.stringify(this.originalGlobalGrid)),xg.saveGrid(this.globalGrid),this.updatedGlobalSpeakActions=!1},stopRecording(){this.recording=!1,clearInterval(this.intervalHandler),Pc.stopRecording()},play(){this.playing=!0,Pc.playAudio(this.action.dataBase64,{onended:()=>{this.playing=!1}})},stopPlaying(){this.playing=!1,Pc.stopAudio()},clearAll(){this.showError=!1,this.showError2=!1,this.action.dataBase64="",this.action.filename="",this.action.durationMs=null,this.action.mimeType=""}},async mounted(){this.globalGrid=JSON.parse(JSON.stringify(await xg.getGlobalGrid())),this.originalGlobalGrid=JSON.parse(JSON.stringify(this.globalGrid))},beforeDestroy(){}},O_=Cd(k_,I_,[],!1,null,"1578b8fa",null).exports;var R_=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"selectMode"}},[e._v(e._s(e.$t("actionType")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.type,expression:"action.type"}],staticClass:"eight columns",attrs:{id:"selectMode"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"type",t.target.multiple?n:n[0])}}},e._l(e.GridActionWordForm.MODES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)]),e._v(" "),e.action.type===e.GridActionWordForm.WORDFORM_MODE_NEXT_FORM?t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"selectMode2"}},[e._v(e._s(e.$t("secondaryActionType")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.secondaryType,expression:"action.secondaryType"}],staticClass:"eight columns",attrs:{id:"selectMode2"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"secondaryType",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l(e.GridActionWordForm.MODES_SECONDARY,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])}))],2)]):e._e(),e._v(" "),[e.GridActionWordForm.WORDFORM_MODE_NEXT_FORM,e.GridActionWordForm.WORDFORM_MODE_RESET_FORMS].includes(e.action.type)?e._e():t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns"},[e._v(e._s(e.$t("tags")))]),e._v(" "),t("multiselect",{staticClass:"eight columns",attrs:{options:e.TAGS,multiple:!0,"close-on-select":!1,"clear-on-select":!1,taggable:!0,placeholder:"Choose tags"},on:{tag:function(t){return e.addTag(t)}},model:{value:e.action.tags,callback:function(t){e.$set(e.action,"tags",t)},expression:"action.tags"}})],1),e._v(" "),t("div",{staticClass:"srow mt-4"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.toggle,expression:"action.toggle"}],attrs:{type:"checkbox",id:"chkToggle"},domProps:{checked:Array.isArray(e.action.toggle)?e._i(e.action.toggle,null)>-1:e.action.toggle},on:{change:function(t){var n=e.action.toggle,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"toggle",n.concat([null])):o>-1&&e.$set(e.action,"toggle",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"toggle",i)}}}),e._v(" "),t("label",{attrs:{for:"chkToggle"}},[e._v(e._s(e.$t("toggleTagOnSelectingItMultipleTimes")))])])])])};R_._withStripped=!0;var x_=s(5262),N_=s.n(x_);const D_=Cd({props:["action","gridData"],components:{Multiselect:N_()},data:function(){return{TAGS:JSON.parse(JSON.stringify(C.A.WORDFORM_TAGS)),GridActionWordForm:Pd.N}},methods:{addTag(e){this.TAGS.push(e),this.action.tags.push(e)}},mounted(){},beforeDestroy(){}},R_,[],!1,null,"a0030b06",null).exports;var L_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"inputRestUri"}},[e._v("HTTP URL")]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.restUrl,expression:"action.restUrl"}],staticClass:"col-12",attrs:{id:"inputRestUri",spellcheck:"false",autocomplete:"true",type:"text",placeholder:"http(s)://<hostname>:<port>/<path to rest function>"},domProps:{value:e.action.restUrl},on:{input:function(t){t.target.composing||e.$set(e.action,"restUrl",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"body"}},[e._v(e._s(e.$t("httpBodyData")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.action.body,expression:"action.body"}],staticClass:"col-12",attrs:{id:"body",rows:"1",placeholder:'ON | OFF | {"data": 123} | ...',spellcheck:"false",type:"text"},domProps:{value:e.action.body},on:{input:function(t){t.target.composing||e.$set(e.action,"body",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"method"}},[e._v(e._s(e.$t("httpMethod")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.method,expression:"action.method"}],staticClass:"col-12",attrs:{id:"method"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"method",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"GET"}},[e._v("GET")]),e._v(" "),t("option",{attrs:{value:"POST"}},[e._v("POST")]),e._v(" "),t("option",{attrs:{value:"PUT"}},[e._v("PUT")]),e._v(" "),t("option",{attrs:{value:"DELETE"}},[e._v("DELETE")]),e._v(" "),t("option",{attrs:{value:"HEAD"}},[e._v("HEAD")]),e._v(" "),t("option",{attrs:{value:"OPTIONS"}},[e._v("OPTIONS")]),e._v(" "),t("option",{attrs:{value:"PATCH"}},[e._v("PATCH")])])])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"content-type"}},[e._v("HTTP Content-Type")]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.contentType,expression:"action.contentType"}],staticClass:"col-12",attrs:{id:"content-type",placeholder:"text/plain | application/json | ...",spellcheck:"false",autocomplete:"true",type:"text"},domProps:{value:e.action.contentType},on:{input:function(t){t.target.composing||e.$set(e.action,"contentType",t.target.value)}}})])]),e._v(" "),e.action.isLiveAction?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"acceptHeader"}},[e._v("HTTP Accept Header")]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.acceptHeader,expression:"action.acceptHeader"}],staticClass:"col-12",attrs:{id:"acceptHeader",placeholder:"text/plain | application/json | ...",spellcheck:"false",autocomplete:"true",type:"text"},domProps:{value:e.action.acceptHeader},on:{input:function(t){t.target.composing||e.$set(e.action,"acceptHeader",t.target.value)}}})])]):e._e(),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"auth-user"}},[e._v(e._s(e.$t("httpAuthUser")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.authUser,expression:"action.authUser"}],staticClass:"col-12",attrs:{id:"auth-user",autocomplete:"true",type:"text",placeholder:e.$t("optionalBracket")},domProps:{value:e.action.authUser},on:{input:function(t){t.target.composing||e.$set(e.action,"authUser",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"auth-pw"}},[e._v(e._s(e.$t("httpAuthPw")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.authPw,expression:"action.authPw"}],staticClass:"col-12",attrs:{id:"auth-pw",type:"password",placeholder:e.$t("optionalBracket")},domProps:{value:e.action.authPw},on:{input:function(t){t.target.composing||e.$set(e.action,"authPw",t.target.value)}}})])]),e._v(" "),e.action.isLiveAction?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.useCorsProxy,expression:"action.useCorsProxy"}],attrs:{id:"useCorsProxy",type:"checkbox"},domProps:{checked:Array.isArray(e.action.useCorsProxy)?e._i(e.action.useCorsProxy,null)>-1:e.action.useCorsProxy},on:{change:function(t){var n=e.action.useCorsProxy,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"useCorsProxy",n.concat([null])):o>-1&&e.$set(e.action,"useCorsProxy",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"useCorsProxy",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"useCorsProxy"}},[e._v(e._s(e.$t("useCorsProxy")))])])]):e._e()])};L_._withStripped=!0;const P_={props:["action"],computed:{},methods:{},mounted(){}};var M_=s(4015),U_={};U_.styleTagTransform=Ed(),U_.setAttributes=gd(),U_.insert=vd().bind(null,"head"),U_.domAPI=hd(),U_.insertStyleElement=yd(),dd()(M_.A,U_),M_.A&&M_.A.locals&&M_.A.locals;const F_=Cd(P_,L_,[],!1,null,"05be9182",null).exports;var B_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[e.actionGroups?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"actionGroup-123"}},[e._v(e._s(e.$t("actionGroup")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.groupId,expression:"action.groupId"}],staticClass:"col-12",attrs:{id:"actionGroup-123"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"groupId",t.target.multiple?n:n[0])},e.groupChanged]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.actionGroups,(function(n){return t("option",{domProps:{value:n.id}},[e._v(e._s(e.i18nService.tPredefined(n.name)))])}))],2)])]):e._e(),e._v(" "),e.actionInfos.length>0?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"actionInfo-123"}},[e._v(e._s(e.$t("actionName")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.actionInfo,expression:"action.actionInfo"}],staticClass:"col-12",attrs:{id:"actionInfo-123"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"actionInfo",t.target.multiple?n:n[0])},e.actionInfoChanged]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:{}}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.actionInfos,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.i18nService.tPredefined(n.name)))])}))],2)])]):e._e(),e._v(" "),e.customValues.length?t("div",e._l(e.customValues,(function(n){return t("div",["text"===n.type?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:n.name}},[e._v(e._s(e.i18nService.tPredefined(n.name)))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.customValues[n.name],expression:"action.customValues[customValue.name]"}],staticClass:"col-12",attrs:{id:n.name,spellcheck:"false",type:"text",placeholder:e.i18nService.tPredefined(n.placeholder)},domProps:{value:e.action.customValues[n.name]},on:{input:[function(t){t.target.composing||e.$set(e.action.customValues,n.name,t.target.value)},function(t){return e.textChanged(n)}]}})])]):e._e(),e._v(" "),"number"===n.type?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:n.name}},[e._v(e._s(e.i18nService.tPredefined(n.name)))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.action.customValues[n.name],expression:"action.customValues[customValue.name]",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:n.name,type:"number",min:n.min,max:n.max,step:n.step,placeholder:e.i18nService.tPredefined(n.placeholder)},domProps:{value:e.action.customValues[n.name]},on:{input:function(t){t.target.composing||e.$set(e.action.customValues,n.name,e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),e._v(" "),"select"===n.type?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:n.name}},[e._v(e._s(e.i18nService.tPredefined(n.name)))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.customValues[n.name],expression:"action.customValues[customValue.name]"}],staticClass:"col-12",attrs:{id:n.name},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action.customValues,n.name,t.target.multiple?r:r[0])}}},e._l(n.values,(function(n){return t("option",{domProps:{value:n.value?n.value:n}},[e._v(e._s(e.i18nService.tPredefined(n.label?n.label:n)))])})),0)])]):e._e()])})),0):e._e()])};B_._withStripped=!0;const G_={props:["action","gridData"],data:function(){return{actionGroups:null,updateCounter1:0,updateCounter2:0,updateCounter3:0,i18nService:o.A}},computed:{customValues(){return this.updateCounter1--,this.action.groupId&&this.action.actionInfo&&this.actionGroups&&(((this.actionGroups.find((e=>e.id===this.action.groupId))||{}).actions||[]).find((e=>e.name===this.action.actionInfo.name))||{}).customValues||[]},actionInfos(){return this.updateCounter2--,this.action.groupId&&this.actionGroups&&(this.actionGroups.find((e=>e.id===this.action.groupId))||{}).actions||[]},currentGroup(){return this.updateCounter3--,this.action.groupId&&this.actionGroups?this.actionGroups.find((e=>e.id===this.action.groupId)):null}},watch:{customValues(){if(this.customValues)for(let e of this.customValues)if(!this.action.customValues[e.name]&&"select"===e.type){let t=e.values[0];this.action.customValues[e.name]=t.value?t.value:t}}},methods:{textChanged(e){ee.Z.debounce((()=>{let t=this.action.customValues[e.name];if(t){if(e.autoStartWith){let n=e.autoStartWith instanceof Array?e.autoStartWith:[e.autoStartWith];n.every((e=>!t.startsWith(e)))&&(t=n[0]+t)}e.mustMatch&&(new RegExp(e.mustMatch).test(t)||log.warn(t,"does not match",e.mustMatch)),this.action.customValues[e.name]=t}}),300,"PREDEF_ACTIONS_TXT_CHG")},groupChanged(){this.$set(this.action,"actionInfo",{}),this.$set(this.action,"customValues",{}),this.updateCounter1++,this.updateCounter2++,this.updateCounter3++,this.$nextTick((()=>{this.$emit("change"),this.currentGroup&&this.currentGroup.actions&&1===this.currentGroup.actions.length&&(this.action.actionInfo=this.currentGroup.actions[0],this.actionInfoChanged())}))},actionInfoChanged(){this.$set(this.action,"customValues",{}),this.updateCounter1++,this.$nextTick((()=>{this.$emit("change")}))}},async mounted(){this.action.isLiveAction?this.actionGroups=await gm.getPredefinedRequestInfos():this.actionGroups=await gm.getPredefinedActionInfos();let e=(this.actionGroups.find((e=>e.id===this.action.groupId))||{}).actions||[];this.action.actionInfo=e.find((e=>e.name===this.action.actionInfo.name))||this.action.actionInfo}};var $_=s(1594),V_={};V_.styleTagTransform=Ed(),V_.setAttributes=gd(),V_.insert=vd().bind(null,"head"),V_.domAPI=hd(),V_.insertStyleElement=yd(),dd()($_.A,V_),$_.A&&$_.A.locals&&$_.A.locals;const j_=Cd(G_,B_,[],!1,null,"18164924",null).exports;var K_=function(){var e=this,t=e._self._c;return t("div",["GridActionSpeak"==e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"selectLang"}},[e._v(e._s(e.$t("language")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.speakLanguage,expression:"action.speakLanguage"}],staticClass:"eight columns",attrs:{id:"selectLang"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"speakLanguage",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("automaticCurrentLanguage")))]),e._v(" "),e._l(e.voiceLangs.filter((t=>Object.keys(e.gridElement.label).includes(t.code))),(function(n){return t("option",{domProps:{value:n.code}},[e._v("\r\n                    "+e._s(e._f("extractTranslation")(n))+"\r\n                ")])}))],2)]),e._v(" "),e.action.speakLanguage?t("div",{staticClass:"srow"},[t("div",{staticClass:"eight columns offset-by-four"},[t("span",[e._v(e._s(e.$t("label")))]),t("span",[e._v(" ("+e._s(e.$t("lang."+e.action.speakLanguage))+")")]),e._v(": "+e._s(e.gridElement.label[e.action.speakLanguage])+"\r\n            ")])]):e._e()]):e._e(),e._v(" "),"GridActionSpeakCustom"==e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"selectLang2"}},[e._v(e._s(e.$t("language")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.speakLanguage,expression:"action.speakLanguage"}],staticClass:"eight columns",attrs:{id:"selectLang2"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"speakLanguage",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("automaticCurrentLanguage")))]),e._v(" "),e._l(e.voiceLangs,(function(n){return t("option",{domProps:{value:n.code}},[e._v("\r\n                    "+e._s(e._f("extractTranslation")(n))+"\r\n                ")])}))],2)]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"inCustomText"}},[e._v(e._s(e.$t("textToSpeak")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.speakText[e.getCurrentSpeakLang(e.action)],expression:"action.speakText[getCurrentSpeakLang(action)]"}],staticClass:"eight columns",attrs:{id:"inCustomText",type:"text",placeholder:e.gridElement.type===e.GridElement.ELEMENT_TYPE_LIVE?e.$t("canIncludePlaceholderLike"):""},domProps:{value:e.action.speakText[e.getCurrentSpeakLang(e.action)]},on:{input:function(t){t.target.composing||e.$set(e.action.speakText,e.getCurrentSpeakLang(e.action),t.target.value)}}})])]):e._e(),e._v(" "),"GridActionAudio"==e.action.modelName?t("div",[t("edit-audio-action",{attrs:{action:e.action,"grid-data":e.gridData}})],1):e._e(),e._v(" "),"GridActionWordForm"==e.action.modelName?t("div",[t("edit-word-form-action",{attrs:{action:e.action,"grid-data":e.gridData}})],1):e._e(),e._v(" "),"GridActionNavigate"==e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"selectNavType"}},[e._v(e._s(e.$t("navigationType")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.navType,expression:"action.navType"}],staticClass:"eight columns",attrs:{id:"selectNavType"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"navType",t.target.multiple?n:n[0])}}},e._l(Object.values(e.GridActionNavigate.NAV_TYPES),(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)]),e._v(" "),e.action.navType===e.GridActionNavigate.NAV_TYPES.TO_GRID?t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"selectGrid"}},[e._v(e._s(e.$t("navigateToGrid")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.toGridId,expression:"action.toGridId"}],staticClass:"eight columns",attrs:{id:"selectGrid"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"toGridId",t.target.multiple?n:n[0])}}},e._l(e.grids,(function(n){return t("option",{domProps:{value:n.id}},[e._v("\r\n                    "+e._s(e._f("extractTranslation")(n.label))+"\r\n                ")])})),0)]):e._e(),e._v(" "),e.action.navType===e.GridActionNavigate.NAV_TYPES.OPEN_SEARCH?t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"searchTextInput"}},[e._v(e._s(e.$t("searchForCustomText")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.searchText,expression:"action.searchText"}],staticClass:"eight columns",attrs:{id:"searchTextInput",type:"text",placeholder:e.$t("customText")},domProps:{value:e.action.searchText},on:{input:function(t){t.target.composing||e.$set(e.action,"searchText",t.target.value)}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.searchCollectedText,expression:"action.searchCollectedText"}],attrs:{id:"searchCollected",type:"checkbox"},domProps:{checked:Array.isArray(e.action.searchCollectedText)?e._i(e.action.searchCollectedText,null)>-1:e.action.searchCollectedText},on:{change:function(t){var n=e.action.searchCollectedText,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"searchCollectedText",n.concat([null])):o>-1&&e.$set(e.action,"searchCollectedText",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"searchCollectedText",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"searchCollected"}},[e._v(e._s(e.$t("searchForCollectedText")))])])]):e._e(),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.addToCollectElem,expression:"action.addToCollectElem"}],attrs:{id:"addToCollectChk",type:"checkbox"},domProps:{checked:Array.isArray(e.action.addToCollectElem)?e._i(e.action.addToCollectElem,null)>-1:e.action.addToCollectElem},on:{change:function(t){var n=e.action.addToCollectElem,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"addToCollectElem",n.concat([null])):o>-1&&e.$set(e.action,"addToCollectElem",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"addToCollectElem",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"addToCollectChk"}},[e._v(e._s(e.$t("addThisElementToCollectionElementsDespiteNav")))])])]):e._e(),e._v(" "),"GridActionARE"===e.action.modelName?t("div",[t("edit-are-action",{attrs:{action:e.action,"grid-data":e.gridData}})],1):e._e(),e._v(" "),"GridActionOpenHAB"===e.action.modelName?t("div",[t("edit-open-hab-action",{attrs:{action:e.action,"grid-data":e.gridData}})],1):e._e(),e._v(" "),"GridActionHTTP"===e.action.modelName?t("div",[t("edit-http-action",{attrs:{action:e.action}})],1):e._e(),e._v(" "),"GridActionPredefined"===e.action.modelName?t("div",[t("edit-predefined-action",e._g({attrs:{action:e.action,"grid-data":e.gridData}},e.$listeners))],1):e._e(),e._v(" "),"GridActionMatrix"===e.action.modelName?t("div",[t("edit-matrix-action",{attrs:{action:e.action}})],1):e._e(),e._v(" "),"GridActionPredict"==e.action.modelName?t("div",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.gridElement.type===e.GridElement.ELEMENT_TYPE_COLLECT,expression:"gridElement.type === GridElement.ELEMENT_TYPE_COLLECT"}],staticClass:"srow"},[t("div",{staticClass:"eight columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.suggestOnChange,expression:"action.suggestOnChange"}],attrs:{id:"chkSuggestOnChange",type:"checkbox"},domProps:{checked:Array.isArray(e.action.suggestOnChange)?e._i(e.action.suggestOnChange,null)>-1:e.action.suggestOnChange},on:{change:function(t){var n=e.action.suggestOnChange,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"suggestOnChange",n.concat([null])):o>-1&&e.$set(e.action,"suggestOnChange",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"suggestOnChange",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"chkSuggestOnChange"}},[e._v(e._s(e.$t("refreshSuggestionsOnChange")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[t("label",{staticClass:"normal-text",attrs:{for:"comboUseDict"}},[e._v(e._s(e.$t("dictionaryToUse")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.dictionaryKey,expression:"action.dictionaryKey"}],staticClass:"eight columns",attrs:{id:"comboUseDict"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"dictionaryKey",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("allDictionaries")))]),e._v(" "),t("option",{domProps:{value:e.GridActionPredict.USE_DICTIONARY_CURRENT_LANG}},[e._v(e._s(e.$t("useDictionaryOfCurrentContentLanguage")))]),e._v(" "),e._l(e.dictionaryKeys,(function(n){return t("option",{domProps:{value:n}},[e._v("\r\n                    "+e._s(n)+"\r\n                ")])}))],2)])]):e._e(),e._v(" "),"GridActionCollectElement"==e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"selectCollectElmAction"}},[e._v(e._s(e.$t("performActionOnCollectElement")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.action,expression:"action.action"}],staticClass:"eight columns",attrs:{id:"selectCollectElmAction"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"action",t.target.multiple?n:n[0])}}},e._l(e.collectActions,(function(n){return t("option",{domProps:{value:n}},[e._v("\r\n                        "+e._s(e._f("translate")(n))+"\r\n                    ")])})),0)])])]):e._e(),e._v(" "),"GridActionWebradio"==e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"selectRadioElmAction"}},[e._v(e._s(e.$t("webRadioAction")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.action,expression:"action.action"}],staticClass:"eight columns",attrs:{id:"selectRadioElmAction"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"action",t.target.multiple?n:n[0])}}},e._l(e.webradioActions,(function(n){return t("option",{domProps:{value:n}},[e._v("\r\n                        "+e._s(e._f("translate")(n))+"\r\n                    ")])})),0)])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"WEBRADIO_ACTION_START"===e.action.action||"WEBRADIO_ACTION_TOGGLE"===e.action.action,expression:"action.action === 'WEBRADIO_ACTION_START' || action.action === 'WEBRADIO_ACTION_TOGGLE'"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"selectRadio"}},[e._v(e._s(e.$t("webadioToPlay")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.radioId,expression:"action.radioId"}],staticClass:"eight columns",attrs:{id:"selectRadio"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"radioId",t.target.multiple?n:n[0])},function(t){return e.selectedRadioChanged(e.action.radioId)}]}},[t("option",{attrs:{value:"",selected:""}},[e._v(e._s(e.$t("automaticLastPlayed")))]),e._v(" "),e._l(e.gridData.webRadios,(function(n){return t("option",{domProps:{value:n.radioId}},[e._v("\r\n                        "+e._s(n.radioName)+"\r\n                    ")])}))],2)])]),e._v(" "),t("div",{staticClass:"srow"},[t("accordion",{staticClass:"twelve columns",attrs:{"acc-label":e.$t("manageWebradioList"),"acc-open":0===e.gridData.webRadios.length?"true":"false"}},[t("radio-list-selector",{attrs:{"grid-data":e.gridData}})],1)],1)]):e._e(),e._v(" "),"GridActionYoutube"===e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"ytActions"}},[e._v(e._s(e.$t("youtubeVideoAction")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.action,expression:"action.action"}],staticClass:"eight columns",attrs:{id:"ytActions"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"action",t.target.multiple?n:n[0])}}},e._l(e.GridActionYoutube.actions,(function(n){return t("option",{domProps:{value:n}},[e._v("\r\n                        "+e._s(e._f("translate")(n))+"\r\n                    ")])})),0)])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:-1!==[e.GridActionYoutube.actions.YT_PLAY,e.GridActionYoutube.actions.YT_TOGGLE,e.GridActionYoutube.actions.YT_RESTART].indexOf(e.action.action),expression:"[GridActionYoutube.actions.YT_PLAY, GridActionYoutube.actions.YT_TOGGLE, GridActionYoutube.actions.YT_RESTART].indexOf(action.action) !== -1"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"ytPlayType"}},[e._v(e._s(e.$t("playType")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.playType,expression:"action.playType"}],staticClass:"eight columns",attrs:{id:"ytPlayType"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"playType",t.target.multiple?n:n[0])}}},e._l(Object.keys(e.GridActionYoutube.playTypes).filter((t=>t!==e.GridActionYoutube.playTypes.YT_PLAY_RELATED)),(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.action.playType&&-1!==[e.GridActionYoutube.actions.YT_PLAY,e.GridActionYoutube.actions.YT_TOGGLE,e.GridActionYoutube.actions.YT_RESTART].indexOf(e.action.action),expression:"action.playType && [GridActionYoutube.actions.YT_PLAY, GridActionYoutube.actions.YT_TOGGLE, GridActionYoutube.actions.YT_RESTART].indexOf(action.action) !== -1"}]},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.action.playType!==e.GridActionYoutube.playTypes.YT_PLAY_RELATED,expression:"action.playType !== GridActionYoutube.playTypes.YT_PLAY_RELATED"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"ytList"}},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.action.playType===e.GridActionYoutube.playTypes.YT_PLAY_VIDEO,expression:"action.playType === GridActionYoutube.playTypes.YT_PLAY_VIDEO"}]},[e._v(e._s(e.$t("videoLink")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.action.playType===e.GridActionYoutube.playTypes.YT_PLAY_SEARCH,expression:"action.playType === GridActionYoutube.playTypes.YT_PLAY_SEARCH"}]},[e._v(e._s(e.$t("youtubeSearchQuery")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.action.playType===e.GridActionYoutube.playTypes.YT_PLAY_PLAYLIST,expression:"action.playType === GridActionYoutube.playTypes.YT_PLAY_PLAYLIST"}]},[e._v(e._s(e.$t("youtubePlaylistLink")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.action.playType===e.GridActionYoutube.playTypes.YT_PLAY_CHANNEL,expression:"action.playType === GridActionYoutube.playTypes.YT_PLAY_CHANNEL"}]},[e._v(e._s(e.$t("youtubeChannelLink")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.data,expression:"action.data"}],staticClass:"eight columns",attrs:{id:"ytList",type:"text"},domProps:{value:e.action.data},on:{input:function(t){t.target.composing||e.$set(e.action,"data",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.showCC,expression:"action.showCC"}],attrs:{id:"showCC",type:"checkbox"},domProps:{checked:Array.isArray(e.action.showCC)?e._i(e.action.showCC,null)>-1:e.action.showCC},on:{change:function(t){var n=e.action.showCC,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"showCC",n.concat([null])):o>-1&&e.$set(e.action,"showCC",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"showCC",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"showCC"}},[e._v(e._s(e.$t("showVideoSubtitlesIfAvailable")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.playMuted,expression:"action.playMuted"}],attrs:{id:"playMuted",type:"checkbox"},domProps:{checked:Array.isArray(e.action.playMuted)?e._i(e.action.playMuted,null)>-1:e.action.playMuted},on:{change:function(t){var n=e.action.playMuted,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"playMuted",n.concat([null])):o>-1&&e.$set(e.action,"playMuted",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"playMuted",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"playMuted"}},[e._v(e._s(e.$t("startVideoMuted")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.performAfterNav,expression:"action.performAfterNav"}],attrs:{id:"afterNav",type:"checkbox"},domProps:{checked:Array.isArray(e.action.performAfterNav)?e._i(e.action.performAfterNav,null)>-1:e.action.performAfterNav},on:{change:function(t){var n=e.action.performAfterNav,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.action,"performAfterNav",n.concat([null])):o>-1&&e.$set(e.action,"performAfterNav",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.action,"performAfterNav",i)}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"afterNav"}},[e._v(e._s(e.$t("performActionAfterNavigation")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:-1!==[e.GridActionYoutube.actions.YT_STEP_FORWARD,e.GridActionYoutube.actions.YT_STEP_BACKWARD].indexOf(e.action.action),expression:"[GridActionYoutube.actions.YT_STEP_FORWARD, GridActionYoutube.actions.YT_STEP_BACKWARD].indexOf(action.action) !== -1"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"stepSeconds"}},[e._v(e._s(e.$t(e.action.action))+" "+e._s(e.$t("secondsBracket")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.stepSeconds,expression:"action.stepSeconds"}],staticClass:"eight columns",attrs:{id:"stepSeconds",type:"number",min:"0"},domProps:{value:e.action.stepSeconds},on:{input:function(t){t.target.composing||e.$set(e.action,"stepSeconds",t.target.value)}}})])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:-1!==[e.GridActionYoutube.actions.YT_VOLUME_UP,e.GridActionYoutube.actions.YT_VOLUME_DOWN].indexOf(e.action.action),expression:"[GridActionYoutube.actions.YT_VOLUME_UP, GridActionYoutube.actions.YT_VOLUME_DOWN].indexOf(action.action) !== -1"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"stepVolume"}},[e._v(e._s(e.$t(e.action.action))+" "+e._s(e.$t("percentBracket")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.stepVolume,expression:"action.stepVolume"}],staticClass:"eight columns",attrs:{id:"stepVolume",type:"number",min:"0",max:"100"},domProps:{value:e.action.stepVolume},on:{input:function(t){t.target.composing||e.$set(e.action,"stepVolume",t.target.value)}}})])])]):e._e(),e._v(" "),"GridActionChangeLang"===e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"changeLang"}},[e._v(e._s(e.$t("changeLanguageTo")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.language,expression:"action.language"}],staticClass:"four columns mb-2",attrs:{id:"changeLang"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"language",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("systemLanguage")))]),e._v(" "),t("option",{domProps:{value:e.GridActionChangeLang.LAST_LANG}},[e._v(e._s(e.$t(e.GridActionChangeLang.LAST_LANG)))]),e._v(" "),e._l(e.allLanguages,(function(n){return t("option",{directives:[{name:"show",rawName:"v-show",value:e.selectFromAllLanguages||n.code===e.action.language||e.gridLanguageCodes.includes(n.code),expression:"selectFromAllLanguages || lang.code === action.language || gridLanguageCodes.includes(lang.code)"}],domProps:{value:n.code}},[e._v("\r\n                        "+e._s(e._f("extractTranslation")(n))+"\r\n                    ")])}))],2),e._v(" "),t("div",{staticClass:"four columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectFromAllLanguages,expression:"selectFromAllLanguages"}],attrs:{id:"selectFromAllLangs",type:"checkbox"},domProps:{checked:Array.isArray(e.selectFromAllLanguages)?e._i(e.selectFromAllLanguages,null)>-1:e.selectFromAllLanguages},on:{change:function(t){var n=e.selectFromAllLanguages,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.selectFromAllLanguages=n.concat([null])):o>-1&&(e.selectFromAllLanguages=n.slice(0,o).concat(n.slice(o+1)))}else e.selectFromAllLanguages=i}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"selectFromAllLangs"}},[e._v(e._s(e.$t("showAllLanguages")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"changeVoice"}},[e._v(e._s(e.$t("changeVoiceTo")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.voice,expression:"action.voice"}],staticClass:"four columns mb-2",attrs:{id:"changeVoice"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"voice",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("automatic")))]),e._v(" "),e._l(e.allVoices,(function(n){return t("option",{directives:[{name:"show",rawName:"v-show",value:e.selectFromAllVoices||!e.action.language||e.i18nService.getBaseLang(n.lang)===e.i18nService.getBaseLang(e.action.language),expression:"selectFromAllVoices || !action.language || i18nService.getBaseLang(voice.lang) === i18nService.getBaseLang(action.language)"}],domProps:{value:n.id}},[!e.selectFromAllVoices&&e.action.language?t("span",[e._v(e._s(n.name)+", "+e._s(n.local?e.$t("offline"):e.$t("online")))]):e._e(),e._v(" "),e.selectFromAllVoices||!e.action.language?t("span",[e._v(e._s(e.$t(`lang.${n.lang}`))+": "+e._s(n.name)+", "+e._s(n.local?e.$t("offline"):e.$t("online")))]):e._e()])}))],2),e._v(" "),t("div",{staticClass:"four columns mb-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectFromAllVoices,expression:"selectFromAllVoices"}],attrs:{id:"selectAllVoices",type:"checkbox"},domProps:{checked:Array.isArray(e.selectFromAllVoices)?e._i(e.selectFromAllVoices,null)>-1:e.selectFromAllVoices},on:{change:function(t){var n=e.selectFromAllVoices,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.selectFromAllVoices=n.concat([null])):o>-1&&(e.selectFromAllVoices=n.slice(0,o).concat(n.slice(o+1)))}else e.selectFromAllVoices=i}}}),e._v(" "),t("label",{staticClass:"normal-text",attrs:{for:"selectAllVoices"}},[e._v(e._s(e.$t("showAllVoices")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"four columns offset-by-four",attrs:{id:"testVoice2",disabled:!e.action.voice},on:{click:function(t){return e.speechService.testSpeak(e.action.voice,null,e.action.language)}}},[e._v(e._s(e.$t("testVoice")))])])]):e._e(),e._v(" "),"GridActionOpenWebpage"===e.action.modelName?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"openUrl"}},[e._v(e._s(e.$t("webpageUrl")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.openURL,expression:"action.openURL"}],staticClass:"eight columns",attrs:{id:"openUrl",type:"text"},domProps:{value:e.action.openURL},on:{input:function(t){t.target.composing||e.$set(e.action,"openURL",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"webpageCloseTimeout"}},[e._v(e._s(e.$t("automaticallyCloseTimeoutInSeconds")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.timeoutSeconds,expression:"action.timeoutSeconds"}],staticClass:"eight columns",attrs:{id:"webpageCloseTimeout",type:"number",min:"0"},domProps:{value:e.action.timeoutSeconds},on:{input:function(t){t.target.composing||e.$set(e.action,"timeoutSeconds",t.target.value)}}})])])]):e._e(),e._v(" "),e.action.modelName===e.GridActionUART.getModelName()?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"uartType"}},[e._v("UART Type")]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.connectionType,expression:"action.connectionType"}],staticClass:"eight columns",attrs:{id:"uartType"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"connectionType",t.target.multiple?n:n[0])}}},e._l(e.GridActionUART.CONN_TYPES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"uartCmd"}},[e._v(e._s(e.$t("dataToSend")))]),e._v(" "),t("div",{staticClass:"eight columns"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.action.data,expression:"action.data"}],staticClass:"col-12",attrs:{id:"uartCmd",rows:"1",placeholder:"LED1.set(); or AT MX 10",spellcheck:"false",type:"text"},domProps:{value:e.action.data},on:{input:function(t){t.target.composing||e.$set(e.action,"data",t.target.value)}}})])])])]):e._e(),e._v(" "),e.action.modelName===e.GridActionSystem.getModelName()?t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"systemActionType"}},[e._v(e._s(e.$t("actionType")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.action,expression:"action.action"}],staticClass:"eight columns",attrs:{id:"systemActionType"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"action",t.target.multiple?n:n[0])},function(t){e.action.actionValue=e.action.action===e.GridActionSystem.actions.SYS_UPDATE_LIVE_ELEMENTS?0:10}]}},e._l(e.GridActionSystem.actions,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)])]),e._v(" "),[e.GridActionSystem.actions.SYS_VOLUME_UP,e.GridActionSystem.actions.SYS_VOLUME_DOWN].includes(e.action.action)?t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"systemActionValue"}},[e._v(e._s(e.$t(e.action.action))+" "+e._s(e.$t("percentBracket")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.action.actionValue,expression:"action.actionValue",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"systemActionValue",type:"number",min:"0",max:"100"},domProps:{value:e.action.actionValue},on:{input:function(t){t.target.composing||e.$set(e.action,"actionValue",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),e._v(" "),[e.GridActionSystem.actions.SYS_UPDATE_LIVE_ELEMENTS].includes(e.action.action)?t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("label",{staticClass:"four columns normal-text",attrs:{for:"systemActionDelay"}},[e._v(e._s(e.$t("delayMs")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.action.actionValue,expression:"action.actionValue",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"systemActionDelay",type:"number",min:"0"},domProps:{value:e.action.actionValue},on:{input:function(t){t.target.composing||e.$set(e.action,"actionValue",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e()]):e._e()])};K_._withStripped=!0;var W_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"actionType"}},[e._v(e._s(e.$t("actionType")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.action,expression:"action.action"}],staticClass:"col-12",attrs:{id:"actionType"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"action",t.target.multiple?n:n[0])},e.actionTypeChanged]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.GridActionMatrix.getActions(),(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t(n)))])}))],2)])]),e._v(" "),e.action.action===e.GridActionMatrix.actions.MATRIX_SEND_CUSTOM?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"sendText"}},[e._v(e._s(e.$t("textToSend")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.action.sendText,expression:"action.sendText"}],staticClass:"col-12",attrs:{id:"sendText",spellcheck:"false",type:"text",placeholder:e.$t("textToSend")},domProps:{value:e.action.sendText},on:{input:function(t){t.target.composing||e.$set(e.action,"sendText",t.target.value)}}})])]):e._e(),e._v(" "),e.action.action===e.GridActionMatrix.actions.MATRIX_SCROLL_UP||e.action.action===e.GridActionMatrix.actions.MATRIX_SCROLL_DOWN?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"scrollPx"}},[e._v(e._s(e.$t("scrollPx")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.action.scrollPx,expression:"action.scrollPx",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"scrollPx",type:"number",min:"1"},domProps:{value:e.action.scrollPx},on:{input:function(t){t.target.composing||e.$set(e.action,"scrollPx",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),e._v(" "),e.action.action===e.GridActionMatrix.actions.MATRIX_SET_CONVERSATION?t("div",{staticClass:"row"},[t("label",{staticClass:"col-12 col-md-4 normal-text",attrs:{for:"changeToRoom"}},[e._v(e._s(e.$t("changeToMatrixRoom")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.action.selectRoomId,expression:"action.selectRoomId"}],staticClass:"col-12",attrs:{id:"changeToRoom"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.action,"selectRoomId",t.target.multiple?n:n[0])}}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.matrixRooms,(function(n){return t("option",{domProps:{value:n.roomId}},[e._v(e._s(n.name))])}))],2)])]):e._e()])};W_._withStripped=!0;const q_={props:["action"],data:function(){return{matrixRooms:[],GridActionMatrix:jh.M}},computed:{},methods:{actionTypeChanged(){this.action.action===jh.M.actions.MATRIX_SCROLL_UP||this.action.action===jh.M.actions.MATRIX_SCROLL_DOWN?this.action.scrollPx||(this.action.scrollPx=200):this.action.scrollPx=void 0}},async mounted(){this.matrixRooms=await sm.getRooms()}};var H_=s(2671),Y_={};Y_.styleTagTransform=Ed(),Y_.setAttributes=gd(),Y_.insert=vd().bind(null,"head"),Y_.domAPI=hd(),Y_.insertStyleElement=yd(),dd()(H_.A,Y_),H_.A&&H_.A.locals&&H_.A.locals;const z_={props:["action","grids","gridData","gridElement"],data:function(){return{allVoices:su.getVoices(),voiceLangs:su.getVoicesLangs(),dictionaryKeys:Ie.getDictionaryKeys(),collectActions:x.z.getActions(),webradioActions:mh.o.getActions(),allLanguages:o.A.getAllLanguages(),gridLanguageCodes:[],selectFromAllLanguages:!1,selectFromAllVoices:!1,GridActionYoutube:Lu.a,GridActionNavigate:D.g,GridActionUART:Nh.D,GridActionPredict:N.G,GridActionSystem:Gh.u,GridActionChangeLang:xh.N,GridElement:O.V,speechService:su,i18nService:o.A}},components:{EditMatrixAction:Cd(q_,W_,[],!1,null,"85596514",null).exports,EditPredefinedAction:j_,EditWordFormAction:D_,EditAudioAction:O_,RadioListSelector:T_,Accordion:Gg,EditAreAction:u_,EditOpenHabAction:E_,EditHttpAction:F_},methods:{getCurrentSpeakLang(e){let t=su.getPreferredVoiceLang()||o.A.getContentLang(),n=su.isVoiceLangLinkedToTextLang()?t:o.A.getContentLang();return e&&e.speakLanguage?e.speakLanguage:n},selectedRadioChanged(e){let t=this.gridData.webRadios.filter((t=>t.radioId===e))[0].faviconUrl;t&&ue.M.urlToBase64(t).then((e=>{e&&(this.gridElement.image=new ce.q({data:e}))}))}},mounted(){this.gridLanguageCodes=Ge.b.getGridLangs(this.gridData)}},J_=z_;var X_=s(2803),Q_={};Q_.styleTagTransform=Ed(),Q_.setAttributes=gd(),Q_.insert=vd().bind(null,"head"),Q_.domAPI=hd(),Q_.insertStyleElement=yd(),dd()(X_.A,Q_),X_.A&&X_.A.locals&&X_.A.locals;const Z_=Cd(J_,K_,[],!1,null,"194805e0",null).exports,eE={props:["gridElement","gridData"],data:function(){return{grids:null,editActionId:null,selectedNewAction:O.V.getActionTypes()[0].getModelName(),actionTypes:O.V.getActionTypes(),GridElement:O.V}},components:{EditAction:Z_,EditPredefinedAction:j_,EditWordFormAction:D_,EditAudioAction:O_,RadioListSelector:T_,Accordion:Gg,EditAreAction:u_,EditOpenHabAction:E_,EditHttpAction:F_},methods:{deleteAction(e){this.gridElement.actions=this.gridElement.actions.filter((t=>t.id!=e.id))},editAction(e){this.editActionId!==e.id?this.editActionId=e.id:this.editActionId=null},testAction(e){gm.testAction(this.gridElement,e,new c.D(this.gridData))},addAction(){let e=JSON.parse(JSON.stringify(O.V.getActionInstance(this.selectedNewAction)));e.modelName===D.g.getModelName()&&(e.toGridId=this.grids[0].id),this.gridElement.actions.push(e),this.editActionId=e.id},openHelp(){Qc.openHelp()}},mounted(){let e=this;xg.getGrids(!1,!0).then((t=>{e.grids=t,e.grids=e.grids.sort(((e,t)=>o.A.getTranslation(e.label).localeCompare(o.A.getTranslation(t.label))))})),Qc.setHelpLocation("05_actions","#edit-actions-modal")},beforeDestroy(){Qc.setHelpLocation("02_navigation","#edit-view")}};var tE=s(1079),nE={};nE.styleTagTransform=Ed(),nE.setAttributes=gd(),nE.insert=vd().bind(null,"head"),nE.domAPI=hd(),nE.insertStyleElement=yd(),dd()(tE.A,nE),tE.A&&tE.A.locals&&tE.A.locals;const rE=Cd(eE,t_,[],!1,null,"0c2fec68",null).exports;var iE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.additionalProps[e.GridElement.PROP_YT_PREVENT_CLICK],expression:"gridElement.additionalProps[GridElement.PROP_YT_PREVENT_CLICK]"}],attrs:{id:"preventClick",type:"checkbox"},domProps:{checked:Array.isArray(e.gridElement.additionalProps[e.GridElement.PROP_YT_PREVENT_CLICK])?e._i(e.gridElement.additionalProps[e.GridElement.PROP_YT_PREVENT_CLICK],null)>-1:e.gridElement.additionalProps[e.GridElement.PROP_YT_PREVENT_CLICK]},on:{change:function(t){var n=e.gridElement.additionalProps[e.GridElement.PROP_YT_PREVENT_CLICK],r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement.additionalProps,e.GridElement.PROP_YT_PREVENT_CLICK,n.concat([null])):o>-1&&e.$set(e.gridElement.additionalProps,e.GridElement.PROP_YT_PREVENT_CLICK,n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement.additionalProps,e.GridElement.PROP_YT_PREVENT_CLICK,i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"preventClick"}},[e._v(e._s(e.$t("preventMouseClickOnYoutubePlayer")))])])])])};iE._withStripped=!0;const oE=Cd({props:["gridElement"],data:function(){return{GridElement:O.V}},methods:{},mounted(){this.gridElement.additionalProps[O.V.PROP_YT_PREVENT_CLICK]=this.gridElement.additionalProps[O.V.PROP_YT_PREVENT_CLICK]||!1},beforeDestroy(){}},iE,[],!1,null,"17553eb4",null).exports;var aE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-md-5",attrs:{for:"selectMode"}},[e._v(e._s(e.$t("collectMode")))]),e._v(" "),t("div",{staticClass:"col-md-4"},[e.gridElement?t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.mode,expression:"gridElement.mode"}],staticClass:"col-12",attrs:{id:"selectMode",type:"checkbox"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"mode",t.target.multiple?n:n[0])}}},e._l(e.GridElementCollect.MODES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t(n)))])})),0):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-md-5",attrs:{for:"imageHeight"}},[e._v(e._s(e.$t("heightOfCollectedImages")))]),e._v(" "),t("div",{staticClass:"col-md-4"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridElement.imageHeightPercentage,expression:"gridElement.imageHeightPercentage",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"imageHeight",type:"number",min:"50",max:"100",disabled:!e.gridElement.showLabels||!e.autoOrSeparatedMode},domProps:{value:e.gridElement.imageHeightPercentage},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"imageHeightPercentage",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-md-5",attrs:{for:"singleTextElemFactor"}},[e._v(e._s(e.$t("factorForFontSizeOfOnlytextElements")))]),e._v(" "),t("div",{staticClass:"col-md-4"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridElement.textElemSizeFactor,expression:"gridElement.textElemSizeFactor",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"singleTextElemFactor",type:"number",min:"0",max:"5",step:"0.1",disabled:!e.autoOrSeparatedMode},domProps:{value:e.gridElement.textElemSizeFactor},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"textElemSizeFactor",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.showLabels,expression:"gridElement.showLabels"}],attrs:{id:"showLabel",type:"checkbox",disabled:!e.autoOrSeparatedMode},domProps:{checked:Array.isArray(e.gridElement.showLabels)?e._i(e.gridElement.showLabels,null)>-1:e.gridElement.showLabels},on:{change:function(t){var n=e.gridElement.showLabels,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"showLabels",n.concat([null])):o>-1&&e.$set(e.gridElement,"showLabels",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"showLabels",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"showLabel"}},[e._v(e._s(e.$t("showLabelsOfCollectedImages")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.showFullLabels,expression:"gridElement.showFullLabels"}],attrs:{id:"showLongLabels",type:"checkbox"},domProps:{checked:Array.isArray(e.gridElement.showFullLabels)?e._i(e.gridElement.showFullLabels,null)>-1:e.gridElement.showFullLabels},on:{change:function(t){var n=e.gridElement.showFullLabels,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"showFullLabels",n.concat([null])):o>-1&&e.$set(e.gridElement,"showFullLabels",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"showFullLabels",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"showLongLabels"}},[e._v(e._s(e.$t("fullyShowLongLabels")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.singleLine,expression:"gridElement.singleLine"}],attrs:{id:"useSingleLine",type:"checkbox",disabled:!e.autoOrSeparatedMode},domProps:{checked:Array.isArray(e.gridElement.singleLine)?e._i(e.gridElement.singleLine,null)>-1:e.gridElement.singleLine},on:{change:function(t){var n=e.gridElement.singleLine,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"singleLine",n.concat([null])):o>-1&&e.$set(e.gridElement,"singleLine",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"singleLine",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"useSingleLine"}},[e._v(e._s(e.$t("useHorizontalScrollbarIfElementsDontFit")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.convertToLowercase,expression:"gridElement.convertToLowercase"}],attrs:{id:"convertToLowercase",type:"checkbox"},domProps:{checked:Array.isArray(e.gridElement.convertToLowercase)?e._i(e.gridElement.convertToLowercase,null)>-1:e.gridElement.convertToLowercase},on:{change:function(t){var n=e.gridElement.convertToLowercase,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"convertToLowercase",n.concat([null])):o>-1&&e.$set(e.gridElement,"convertToLowercase",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"convertToLowercase",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"convertToLowercase"}},[e._v(e._s(e.$t("convertUppercaseKeyboardLettersToLowercase")))])])])])};aE._withStripped=!0;const sE={props:["gridElement"],data:function(){return{GridElementCollect:R.$}},computed:{autoOrSeparatedMode:function(){return[R.$.MODE_AUTO,R.$.MODE_COLLECT_SEPARATED].includes(this.gridElement.mode)}},methods:{},mounted(){},beforeDestroy(){}};var lE=s(9243),cE={};cE.styleTagTransform=Ed(),cE.setAttributes=gd(),cE.insert=vd().bind(null,"head"),cE.domAPI=hd(),cE.insertStyleElement=yd(),dd()(lE.A,cE),lE.A&&lE.A.locals&&lE.A.locals;const dE=Cd(sE,aE,[],!1,null,"0140c82b",null).exports;var uE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0 mb-5"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-8 col-sm-10 col-md-5 order-md-1"},[t("h1",{staticClass:"inline",attrs:{name:"header"}},[e._v("\n                "+e._s(e.header)+"\n            ")])]),e._v(" "),e.openHelpFn?t("a",{staticClass:"col-2 col-sm-1 col-md black order-md-3",attrs:{href:"javascript:;"},on:{click:e.openHelpFn}},[t("i",{staticClass:"fas fa-question-circle"})]):e._e(),e._v(" "),e.closeFn?t("a",{staticClass:"col-2 col-sm-1 col-md black order-md-4",attrs:{id:"closeLink",title:e.$t("close"),href:"javascript:;"},on:{click:e.closeFn}},[t("i",{staticClass:"fas fa-times"})]):e._e(),e._v(" "),e.gridElement?t("div",{staticClass:"col-12 col-md-5 d-flex align-items-center order-md-2 mt-2 mt-md-0"},[e.gridElement.type===e.GridElement.ELEMENT_TYPE_NORMAL?t("div",[e.gridElement.image&&(e.gridElement.image.data||e.gridElement.image.url)?t("img",{staticClass:"me-1",attrs:{height:"30",src:e.gridElement.image.data||e.gridElement.image.url}}):e._e(),e._v(" "),t("span",[e._v(e._s(e._f("extractTranslation")(e.gridElement.label)))])]):e._e(),e._v(" "),e.gridElement.type!==e.GridElement.ELEMENT_TYPE_NORMAL?t("div",[t("span",{staticClass:"mx-2"},[e._v(e._s(e._f("translate")(e.gridElement.type)))])]):e._e()]):e._e()])])};uE._withStripped=!0;const hE=Cd({props:["header","gridElement","openHelpFn","closeFn"],data:()=>({GridElement:O.V}),methods:{},mounted(){}},uE,[],!1,null,"d606f676",null).exports;var pE=function(){var e=this,t=e._self._c;return t("div",[t("accordion",{attrs:{"acc-label":e.$t("addWordForm"),"acc-label-type":"h2","acc-open":"true","acc-background-color":"white"}},[t("edit-word-form",{attrs:{"allow-empty":!0},model:{value:e.newWordForm,callback:function(t){e.newWordForm=t},expression:"newWordForm"}}),e._v(" "),t("div",{staticClass:"srow mb-4"},[t("button",{staticClass:"three columns offset-by-nine",attrs:{disabled:!e.newWordForm.value},on:{click:function(t){return e.addWordForm()}}},[e._v(e._s(e.$t("addWordForm")))])])],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("importExport"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.importExportGlobally,expression:"importExportGlobally"}],attrs:{id:"importExportGlobally",type:"checkbox"},domProps:{checked:Array.isArray(e.importExportGlobally)?e._i(e.importExportGlobally,null)>-1:e.importExportGlobally},on:{change:[function(t){var n=e.importExportGlobally,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.importExportGlobally=n.concat([null])):o>-1&&(e.importExportGlobally=n.slice(0,o).concat(n.slice(o+1)))}else e.importExportGlobally=i},function(t){e.overrideAtImport=!!e.importExportGlobally||e.overrideAtImport}]}}),e._v(" "),t("label",{attrs:{for:"importExportGlobally"}},[e._v(e._s(e.$t("importexportDataTofromAllGrids")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.overrideAtImport,expression:"overrideAtImport"}],attrs:{id:"overrideAtImport",type:"checkbox",disabled:e.importExportGlobally},domProps:{checked:Array.isArray(e.overrideAtImport)?e._i(e.overrideAtImport,null)>-1:e.overrideAtImport},on:{change:function(t){var n=e.overrideAtImport,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.overrideAtImport=n.concat([null])):o>-1&&(e.overrideAtImport=n.slice(0,o).concat(n.slice(o+1)))}else e.overrideAtImport=i}}}),e._v(" "),t("label",{attrs:{for:"overrideAtImport"}},[e._v(e._s(e.$t("overrideExistingWordForms")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"three columns six columns",on:{click:function(t){return e.importFromClipboard()}}},[t("i",{staticClass:"fas fa-file-import"}),e._v(" "+e._s(e.$t("importFromClipboard")))]),e._v(" "),t("button",{staticClass:"three columns six columns",on:{click:function(t){return e.copyToClipboard()}}},[t("i",{staticClass:"fas fa-file-export"}),e._v(" "+e._s(e.$t("copyToClipboard")))])]),e._v(" "),e.currentMsg===e.msgTypes.WAIT?t("div",{staticClass:"srow"},[t("i",{staticClass:"fas fa-spinner fa-spin"})]):e._e(),e._v(" "),e.currentMsg===e.msgTypes.ERROR_PASTE?t("div",{staticClass:"srow warn"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("clipboardContainsNoWordFormsPleaseCopyFrom")))])]):e._e(),e._v(" "),e.currentMsg===e.msgTypes.SUCCESS_PASTE?t("div",{staticClass:"srow success"},[t("i",{staticClass:"fas fa-check"}),e._v(" "),0===e.gridPasteCount?t("span",[e._v(e._s(e.$t("importedWordForms",{count:e.msgCount})))]):e._e(),e._v(" "),e.gridPasteCount>0?t("span",[e._v(e._s(e.$t("importedWordFormsGrids",{count:e.msgCount,gridCount:this.gridPasteCount})))]):e._e()]):e._e(),e._v(" "),e.currentMsg===e.msgTypes.SUCCESS_COPY?t("div",{staticClass:"srow success"},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("copiedWordForms",{count:e.msgCount})))])]):e._e()]),e._v(" "),t("div",{staticClass:"mb-3 mt-5 d-flex align-items-end"},[t("h2",{staticClass:"me-3"},[e._v(e._s(e.$t("currentWordForms")))]),e._v(" "),e.gridElement.wordForms.length>0?t("span",[e._v(e._s(e.gridElement.wordForms.length)+" "+e._s(e._f("translate")("elementsBracket")))]):e._e()]),e._v(" "),t("div",{staticClass:"row mb-3"},[t("label",{staticClass:"col-12 col-md-3",attrs:{for:"filterLang"}},[e._v(e._s(e.$t("language")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-3 mb-2"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.filterLang,expression:"filterLang"}],staticClass:"col-12",attrs:{id:"filterLang"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.filterLang=t.target.multiple?n:n[0]}}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("allSelected")))]),e._v(" "),e._l(e.langs,(function(n){return e.gridElement.wordForms.some((e=>e.lang===n.code))?t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")]):e._e()}))],2)]),e._v(" "),t("div",{staticClass:"col-12 col-md-3"}),e._v(" "),t("div",{staticClass:"col-12 col-md-3 d-flex justify-content-end"},[t("button",{staticClass:"flex-grow-1",on:{click:e.deleteAll}},[t("i",{staticClass:"fas fa-trash"}),e._v(" "+e._s(e.$t("deleteAll")))])])]),e._v(" "),e.gridElement.wordForms.length>0?t("ol",{staticStyle:{"list-style-type":"none"}},e._l(e.gridElement.wordForms,(function(n,r){return e.filterLang&&n.lang!==e.filterLang?e._e():t("li",{class:r%2==1&&r!==e.editId?"bg-gray":""},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-8 my-2 my-sm-0 d-flex"},[t("div",{staticClass:"row d-flex align-items-center flex-grow-1"},[n.lang?t("span",{staticClass:"col-3 col-md-2"},[t("span",{staticClass:"lang-tag p-2 m-1"},[e._v(e._s(n.lang))])]):e._e(),e._v(" "),t("span",{staticClass:"col-3 col-md-3 value"},[t("strong",[e._v(e._s(n.value))])]),e._v(" "),n.tags.length?t("div",{staticClass:"col-6 col-md-7"},[t("div",{staticClass:"row"},e._l(n.tags,(function(n){return t("span",{staticClass:"tag"},[e._v(e._s(n))])})),0)]):e._e(),e._v(" "),n.tags.length?e._e():t("span",{staticClass:"col-6 col-md-7"},[e._v("(no tags)")])])]),e._v(" "),t("div",{staticClass:"col-12 col-sm-4 mb-2 mb-sm-0 d-flex"},[t("button",{staticClass:"col",attrs:{title:e.editId!==r?"Edit":"End editing"},on:{click:function(t){return e.edit(r)}}},[t("i",{staticClass:"fas fa-pencil-alt"})]),e._v(" "),t("button",{staticClass:"col",attrs:{title:e.$t("delete")},on:{click:function(t){return e.remove(n)}}},[t("i",{staticClass:"fas fa-trash"})]),e._v(" "),t("button",{staticClass:"col",attrs:{title:e.$t("moveUp")},on:{click:function(t){return e.moveUp(n)}}},[t("i",{staticClass:"fas fa-arrow-up"})]),e._v(" "),t("button",{staticClass:"col",attrs:{title:e.$t("moveDown")},on:{click:function(t){return e.moveDown(n)}}},[t("i",{staticClass:"fas fa-arrow-down"})])])]),e._v(" "),e.editId===r?t("edit-word-form",{staticClass:"my-3 ps-4 pe-4",model:{value:e.gridElement.wordForms[r],callback:function(t){e.$set(e.gridElement.wordForms,r,t)},expression:"gridElement.wordForms[index]"}}):e._e()],1)})),0):e._e(),e._v(" "),0===e.gridElement.wordForms.length?t("span",[e._v(e._s(e.$t("noWordFormsDefined")))]):e._e()],1)};pE._withStripped=!0;class vE extends((0,se.K)({lang:[String],tags:[se.K.Array(String)],value:[String],pronunciation:[String]})){}vE.defaults({tags:[],value:""});var mE=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"selectLang"}},[e._v(e._s(e.$t("language")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.wordForm.lang,expression:"wordForm.lang"}],staticClass:"nine columns",attrs:{id:"selectLang"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.wordForm,"lang",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l(e.langs,(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")])}))],2)]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"selectTags"}},[e._v(e._s(e.$t("tags")))]),e._v(" "),t("multiselect",{staticClass:"nine columns",attrs:{id:"selectTags",options:e.TAGS,multiple:!0,"close-on-select":!1,"clear-on-select":!1,taggable:!0,placeholder:"Choose tags"},on:{tag:function(t){return e.addTag(e.wordForm,t)}},model:{value:e.wordForm.tags,callback:function(t){e.$set(e.wordForm,"tags",t)},expression:"wordForm.tags"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"wordValue"}},[e._v(e._s(e.$t("wordFormValue")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.wordForm.value,expression:"wordForm.value"}],staticClass:"three columns",attrs:{id:"wordValue",type:"text"},domProps:{value:e.wordForm.value},on:{change:function(t){e.lastValidValue=e.wordForm.value||e.lastValidValue},focusout:e.lostFocus,input:function(t){t.target.composing||e.$set(e.wordForm,"value",t.target.value)}}}),e._v(" "),t("label",{staticClass:"two columns",attrs:{for:"pronunciation"}},[e._v(e._s(e.$t("pronunciation")))]),e._v(" "),t("div",{staticClass:"four columns"},[t("div",{staticClass:"d-flex"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.wordForm.pronunciation,expression:"wordForm.pronunciation"}],staticClass:"flex-grow-1 align-self-baseline",attrs:{id:"pronunciation",placeholder:e.$t("optionalBracket"),type:"text"},domProps:{value:e.wordForm.pronunciation},on:{input:function(t){t.target.composing||e.$set(e.wordForm,"pronunciation",t.target.value)}}}),e._v(" "),t("button",{staticClass:"px-1 py-0",staticStyle:{"line-height":"inherit"},attrs:{disabled:!e.wordForm.pronunciation&&!e.wordForm.value},on:{click:function(t){return e.speechService.speak(e.wordForm.pronunciation||e.wordForm.value)}}},[t("i",{staticClass:"fas fa-play"})])])])])])};mE._withStripped=!0;const gE={props:["value","allowEmpty"],components:{Multiselect:N_()},data(){return{wordForm:this.value,langs:o.A.getAllLanguages(),TAGS:JSON.parse(JSON.stringify(C.A.WORDFORM_TAGS)),speechService:su,lastValidValue:this.value.value}},watch:{value:function(e,t){this.wordForm=e},wordForm:function(e,t){this.$emit("input",e)}},methods:{addTag(e,t){this.TAGS.push(t),e.tags.push(t)},lostFocus(){this.allowEmpty||(this.wordForm.value=this.wordForm.value||this.lastValidValue)}},mounted(){}};var fE=s(9313),yE={};yE.styleTagTransform=Ed(),yE.setAttributes=gd(),yE.insert=vd().bind(null,"head"),yE.domAPI=hd(),yE.insertStyleElement=yd(),dd()(fE.A,yE),fE.A&&fE.A.locals&&fE.A.locals;const _E={components:{Accordion:Gg,EditWordForm:Cd(gE,mE,[],!1,null,"70dfe798",null).exports},props:["gridElement","gridData"],data:function(){return{newWordForm:JSON.parse(JSON.stringify(new vE)),editId:void 0,importExportGlobally:!1,overrideAtImport:!1,allGrids:null,langs:o.A.getAllLanguages(),filterLang:null,msgTypes:{WAIT:"WAIT",SUCCESS_COPY:"SUCCESS_COPY",SUCCESS_PASTE:"SUCCESS_PASTE",ERROR_PASTE:"ERROR_PASTE"},currentMsg:null,msgCount:0,gridPasteCount:0}},methods:{addWordForm(){this.gridElement.wordForms.push(this.newWordForm),this.newWordForm=JSON.parse(JSON.stringify(new vE))},deleteAll(){confirm(o.A.t("doYouReallyWantDeleteAllWordForms"))&&(this.gridElement.wordForms=[])},remove(e){this.gridElement.wordForms=this.gridElement.wordForms.filter((t=>t!==e))},edit(e){this.editId=this.editId===e?void 0:e},moveUp(e){let t=this.gridElement.wordForms.indexOf(e);t>0&&this.exchange(t-1,t)},moveDown(e){let t=this.gridElement.wordForms.indexOf(e);t<this.gridElement.wordForms.length-1&&this.exchange(t+1,t)},exchange(e,t){let n=this.gridElement.wordForms[e];this.gridElement.wordForms[e]=this.gridElement.wordForms[t],this.gridElement.wordForms[t]=n,this.$forceUpdate()},async importFromClipboard(){this.currentMsg=null,this.msgCount=this.gridPasteCount=0;let e=(await ee.Z.getClipboardContent()).split("\n").filter((e=>!!e));e=e.map((e=>e.split("\t"))),e=e.map((e=>(e[2]=e[2]?e[2].split(",").map((e=>e.trim().toLocaleUpperCase())).filter((e=>!!e)):null,e[1]=e[1]?e[1].trim().toLocaleLowerCase():null,e[4]=e[4]?e[4].trim():null,e)));let t=o.A.getAllLangCodes();if(e=e.filter((e=>(!e[1]||t.includes(e[1]))&&e[0])),!e.length)return void(this.currentMsg=this.msgTypes.ERROR_PASTE);if(this.overrideAtImport&&(this.gridElement.wordForms.length>0||this.importExportGlobally)&&!confirm(o.A.t("doYouReallyWantDeleteExistingWordForms")))return;let n=e.map((e=>({lang:e[1]?e[1].toLocaleLowerCase():void 0,tags:e[2]?e[2]:[],value:e[0],pronunciation:e[4],base:this.importExportGlobally?e[3]:void 0})));if(this.importExportGlobally){this.allGrids=this.allGrids||await xg.getGrids(!0);let e={};for(let t of n){let n=(t.base||"").split(";");for(let r of n)r=r.trim(),e[r]=e[r]||[],e[r].push(t)}let t=!1;for(let n of this.allGrids){let r=!1;for(let t of n.gridElements){let n=new Set,i=this.getBaseStringsFromWordForms(t.wordForms);i.length||(i=[`${o.A.getTranslation(t.label)}:${o.A.getContentLangBase()}`]);for(let t of i)e[t]&&(n=new Set([...n,...e[t]]));let a=Array.from(n),s=t.wordForms||[],l=a.length>0&&(s.length!==a.length||JSON.stringify(s)!==JSON.stringify(a));r=r||l,l&&(t.wordForms=a,this.msgCount+=a.length)}r&&(this.gridPasteCount++,await xg.saveGrid(n),n.id===this.gridData.id&&(t=!0))}t&&this.$emit("reloadData")}else this.gridElement.wordForms=this.overrideAtImport?[]:this.gridElement.wordForms,this.gridElement.wordForms=this.gridElement.wordForms.concat(n),this.msgCount=e.length;this.currentMsg=this.msgTypes.SUCCESS_PASTE},async copyToClipboard(){this.currentMsg=null,this.msgCount=0;let e=[];if(this.importExportGlobally){this.allGrids=this.allGrids||await xg.getGrids(!0);for(let t of this.allGrids)e=e.concat(t.gridElements)}else e=[this.gridElement];let t="",n={};for(let r of e){let e=r.wordForms||[],i=this.getBaseStringsFromWordForms(e).join(";");for(let r of e){let e=JSON.stringify(r.tags).replaceAll('"',"").replaceAll("'","").replaceAll("[","").replaceAll("]","").replaceAll(",",", "),o=r.lang||"",a=r.pronunciation||"",s=i+e+o;n[s]=n[s]||[],(!this.importExportGlobally||i&&!n[s].includes(e))&&(n[s].push(e),t+=`${r.value}\t${o}\t${e}\t${i}\t${a}\n`,this.msgCount++)}}ee.Z.copyToClipboard(t),this.currentMsg=this.msgTypes.SUCCESS_COPY},getBaseStringsFromWordForms:e=>(e=e||[]).filter((e=>e.tags.includes(C.A.WORDFORM_TAG_BASE))).map((e=>`${e.value}:${e.lang}`))},mounted(){},beforeDestroy(){Qc.revertToLastLocation()}},EE=_E;var bE=s(6788),SE={};SE.styleTagTransform=Ed(),SE.setAttributes=gd(),SE.insert=vd().bind(null,"head"),SE.domAPI=hd(),SE.insertStyleElement=yd(),dd()(bE.A,SE),bE.A&&bE.A.locals&&bE.A.locals;const CE=Cd(EE,pE,[],!1,null,"70d70ab6",null).exports;var wE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"mode"}},[e._v(e._s(e.$t("displayMode")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.mode,expression:"gridElement.mode"}],staticClass:"col-12",attrs:{id:"mode"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"mode",t.target.multiple?n:n[0])}}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.GridElementLive.MODES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])}))],2)])]),e._v(" "),e.gridElement.mode===e.GridElementLive.MODE_DATETIME?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"dt_format"}},[e._v(e._s(e.$t("dateTimeFormat")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.dateTimeFormat,expression:"gridElement.dateTimeFormat"}],staticClass:"col-12",attrs:{id:"dt_format"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"dateTimeFormat",t.target.multiple?n:n[0])}}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.GridElementLive.DT_FORMATS,(function(n){return t("option",{domProps:{value:n}},[t("span",[e._v(e._s(e._f("translate")(n))+" - ")]),e._v(" "),t("span",[e._v("["+e._s(e.currentDtValues[n])+"]")])])}))],2)])]):e._e(),e._v(" "),e.gridElement.mode===e.GridElementLive.MODE_APP_STATE?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"appState"}},[e._v(e._s(e.$t("MODE_APP_STATE")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.appState,expression:"gridElement.appState"}],staticClass:"col-12",attrs:{id:"appState"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"appState",t.target.multiple?n:n[0])}}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.GridElementLive.APP_STATES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])}))],2)])]):e._e(),e._v(" "),e.gridElement.mode===e.GridElementLive.MODE_RANDOM?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"valuesToChooseFrom"}},[e._v(e._s(e.$t("valuesToChooseFrom")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.chooseValues,expression:"gridElement.chooseValues"}],staticClass:"col-12",attrs:{id:"valuesToChooseFrom",type:"text",placeholder:e.$t("egChooseValues")},domProps:{value:e.gridElement.chooseValues},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"chooseValues",t.target.value)}}})])]):e._e(),e._v(" "),[e.GridElementLive.MODE_ACTION_RESULT,e.GridElementLive.MODE_RANDOM].includes(e.gridElement.mode)?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"updateInterval"}},[e._v(e._s(e.$t("updateIntervalSeconds")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridElement.updateSeconds,expression:"gridElement.updateSeconds",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"updateInterval",type:"number",placeholder:e.$t("updateIntervalPlaceholder")},domProps:{value:e.gridElement.updateSeconds},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"updateSeconds",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),e._v(" "),e.gridElement.mode===e.GridElementLive.MODE_ACTION_RESULT?t("div",[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"actionType"}},[e._v(e._s(e.$t("actionType")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.actionType,expression:"actionType"}],staticClass:"col-12",attrs:{id:"actionType"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.actionType=t.target.multiple?n:n[0]},e.actionTypeChanged]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.possibleActionTypes,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])}))],2)])]),e._v(" "),e.gridElement.liveAction?t("div",[t("h2",[e._v(e._s(e.$t("edit"))+" "+e._s(e._f("translate")(e.gridElement.liveAction.modelName)))]),e._v(" "),t("edit-action",{attrs:{action:e.gridElement.liveAction},on:{change:e.liveActionChanged}})],1):e._e(),e._v(" "),e.gridElement.liveAction?t("div",[t("h2",[e._v(e._s(e.$t("extractData")))]),e._v(" "),e.gridElement.liveAction.modelName===e.GridActionHTTP.getModelName()?t("div",[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"extractMode"}},[e._v(e._s(e.$t("extractMode")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.extractMode,expression:"gridElement.extractMode"}],staticClass:"col-12",attrs:{id:"extractMode"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridElement,"extractMode",t.target.multiple?n:n[0])}}},e._l(e.GridElementLive.EXTRACT_MODES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))])})),0)])]),e._v(" "),e.gridElement.extractMode===e.GridElementLive.EXTRACT_JSON?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"extractMode"}},[e._v(e._s(e.$t("jsonPath")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.extractSelector,expression:"gridElement.extractSelector"}],staticClass:"col-12",attrs:{type:"text",placeholder:e.$t("egJsonPath")},domProps:{value:e.gridElement.extractSelector},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"extractSelector",t.target.value)}}})])]):e._e(),e._v(" "),e.gridElement.extractMode===e.GridElementLive.EXTRACT_HTML_SELECTOR?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"extractMode"}},[e._v(e._s(e.$t("cssSelector")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.extractSelector,expression:"gridElement.extractSelector"}],staticClass:"col-12",attrs:{type:"text",placeholder:e.$t("egCssSelector")},domProps:{value:e.gridElement.extractSelector},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"extractSelector",t.target.value)}}})])]):e._e(),e._v(" "),e.gridElement.extractMode===e.GridElementLive.EXTRACT_HTML_SELECTOR?t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"elementIndex"}},[e._v(e._s(e.$t("elementIndex")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridElement.extractIndex,expression:"gridElement.extractIndex",modifiers:{number:!0}}],staticClass:"col-12",attrs:{id:"elementIndex",type:"number",placeholder:e.$t("egElementIndex")},domProps:{value:e.gridElement.extractIndex},on:{input:function(t){t.target.composing||e.$set(e.gridElement,"extractIndex",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e()]):e._e(),e._v(" "),e.gridElement.liveAction.modelName===e.GridActionPredefined.getModelName()?t("div",[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-4",attrs:{for:"extractInfo"}},[e._v(e._s(e.$t("valueToDisplay")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.extractInfo,expression:"extractInfo"}],staticClass:"col-12",attrs:{id:"extractInfo"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.extractInfo=t.target.multiple?n:n[0]},e.extractInfoChanged]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:void 0}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.extractInfos,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.i18nService.tPredefined(n.name)))])}))],2)])])]):e._e(),e._v(" "),t("div",{staticClass:"row",staticStyle:{"margin-top":"3em"}},[t("button",{staticClass:"col-sm-4",on:{click:e.test}},[t("i",{staticClass:"fas fa-bolt"}),e._v(" "+e._s(e.$t("test")))])]),e._v(" "),t("div",{staticClass:"row"},[e._v("\n                "+e._s(e.result)+"\n            ")])]):e._e()]):e._e()])};wE._withStripped=!0;var AE=s(9186);const TE={components:{EditAction:Z_},props:["gridElement"],data:function(){return{GridElementLive:ch,liveElementService:Tm,possibleActionTypes:[AE.t.getModelName(),uh.h.getModelName()],actionType:void 0,result:"",extractInfo:void 0,GridActionHTTP:uh.h,GridActionPredefined:AE.t,updateCounter:0,i18nService:o.A,currentDtValues:{}}},computed:{extractInfos(){this.updateCounter--;let e=this.gridElement.liveAction;return e&&e.actionInfo&&e.actionInfo.extract&&e.actionInfo.extract.extractInfos||[]},extractMode(){let e=this.gridElement.liveAction;if(e&&e.actionInfo&&e.actionInfo.extract)return e.actionInfo.extract.mode||void 0},extractInfoBasedOnCurrent(){if(this.gridElement&&this.gridElement.liveAction&&this.gridElement.liveAction.actionInfo&&this.gridElement.liveAction.actionInfo.extract&&!this.gridElement.liveAction.modelName!==AE.t.getModelName())return this.gridElement.liveAction.actionInfo.extract.extractInfos.find((e=>e.selector===this.gridElement.extractSelector))||void 0}},methods:{actionTypeChanged(){this.gridElement.liveAction=O.V.getActionInstance(this.actionType),this.gridElement.liveAction.isLiveAction=!0},async test(){this.result=await Tm.getCurrentValue(this.gridElement,{forceUpdate:!0})},extractInfoChanged(){this.gridElement.extractMode=this.extractMode,this.gridElement.extractSelector=this.extractInfo.selector,this.gridElement.extractMappings=this.extractInfo.mappings},liveActionChanged(){this.updateCounter++,this.extractInfo=void 0,this.$nextTick((()=>{1===this.extractInfos.length&&(this.extractInfo=this.extractInfos[0],this.extractInfoChanged())}))}},async mounted(){this.gridElement.additionalProps[O.V.PROP_YT_PREVENT_CLICK]=this.gridElement.additionalProps[O.V.PROP_YT_PREVENT_CLICK]||!1,this.actionType=this.gridElement.liveAction?this.gridElement.liveAction.modelName:void 0,this.extractInfo=this.extractInfoBasedOnCurrent;for(let e of ch.DT_FORMATS)this.$set(this.currentDtValues,e,await Tm.getCurrentValue({mode:ch.MODE_DATETIME,dateTimeFormat:e}))},beforeDestroy(){}};var IE=s(2634),kE={};kE.styleTagTransform=Ed(),kE.setAttributes=gd(),kE.insert=vd().bind(null,"head"),kE.domAPI=hd(),kE.insertStyleElement=yd(),dd()(IE.A,kE),IE.A&&IE.A.locals&&IE.A.locals;const OE=Cd(TE,wE,[],!1,null,"4eec4ae4",null).exports;var RE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.gridElement?t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridElement.autoSpeak,expression:"gridElement.autoSpeak"}],attrs:{id:"autoSpeak",type:"checkbox"},domProps:{checked:Array.isArray(e.gridElement.autoSpeak)?e._i(e.gridElement.autoSpeak,null)>-1:e.gridElement.autoSpeak},on:{change:function(t){var n=e.gridElement.autoSpeak,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridElement,"autoSpeak",n.concat([null])):o>-1&&e.$set(e.gridElement,"autoSpeak",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridElement,"autoSpeak",i)}}}):e._e(),e._v(" "),t("label",{attrs:{for:"autoSpeak"}},[e._v(e._s(e.$t("autoSpeakIncomingMessages")))])])])])};RE._withStripped=!0;const xE={props:["gridElement"],data:function(){return{}},methods:{},mounted(){},beforeDestroy(){}};var NE=s(7580),DE={};DE.styleTagTransform=Ed(),DE.setAttributes=gd(),DE.insert=vd().bind(null,"head"),DE.domAPI=hd(),DE.insertStyleElement=yd(),dd()(NE.A,DE),NE.A&&NE.A.locals&&NE.A.locals;const LE=Cd(xE,RE,[],!1,null,"03df22e8",null).exports,PE="TAB_GENERAL",ME="TAB_IMAGE",UE="TAB_WORDFORMS",FE="TAB_ACTIONS",BE="TAB_LIVE_DATA",GE={TAB_GENERAL:PE,TAB_IMAGE:ME,TAB_WORDFORMS:UE,TAB_ACTIONS:FE,TAB_LIVE_DATA:BE},$E={props:["editElementIdParam","gridDataId","undoService","newPosition"],components:{EditElementMatrix:LE,EditElementLive:OE,EditElementWordForms:CE,EditElementHeader:hE,EditElementCollect:dE,NavTabs:jf,EditElementGeneral:By,EditElementImage:e_,EditElementActions:rE,EditElementYoutube:oE},data:function(){return{gridData:null,originalGridData:null,gridElement:null,originalGridElement:null,editElementId:null,TABS:GE,possibleTabs:{},currentTab:PE,imageSearch:null,GridElement:O.V}},methods:{toImageSearch(){this.imageSearch=o.A.getTranslation(this.gridElement.label),this.currentTab=GE.TAB_IMAGE},save(e){this.saveInternal().then((t=>{this.$emit("close"),t&&this.$emit("reload",this.gridData),t&&!this.editElementId&&this.$emit("mark",this.gridElement.id),e&&this.$emit("actions",this.gridElement.id)}))},addNext(){var e=this;e.saveInternal().then((()=>{e.initInternal(),$("#inputLabel").focus()}))},editNext(e){var t=this;t.editElementId&&t.saveInternal().then((()=>{t.editElementId=new c.D(t.gridData).getNextElementId(t.editElementId,e,t.gridElement.type),t.initInternal(),$("#inputLabel").focus()}))},nextFromKeyboard(){this.editElementId?this.editNext():this.addNext()},saveInternal(){let e=this;return new Promise((t=>{e.gridData&&JSON.stringify(e.originalGridData)!==JSON.stringify(e.gridData)?e.undoService.updateGrid(e.gridData).then((e=>{t(e)})):t(!1)}))},initInternal(e){let t=this;e||t.resetInternal(),xg.getGrid(t.gridDataId).then((e=>{if(t.gridData=JSON.parse(JSON.stringify(e)),t.originalGridData=JSON.parse(JSON.stringify(e)),t.editElementId)t.gridElement=t.gridData.gridElements.filter((e=>e.id===t.editElementId))[0],t.gridElement.image||(t.gridElement.image=JSON.parse(JSON.stringify(new ce.q))),t.gridElement.label=ee.Z.isString(t.gridElement.label)?{}:t.gridElement.label;else{let n=this.newPosition&&void 0!==this.newPosition.x?this.newPosition:e.getNewXYPos();log.debug("creating element: x "+n.x+" / y "+n.y),t.gridElement=JSON.parse(JSON.stringify(new O.V({x:n.x,y:n.y}))),t.gridData.gridElements.push(t.gridElement)}t.gridElement.type===O.V.ELEMENT_TYPE_NORMAL?this.possibleTabs={TAB_GENERAL:PE,TAB_IMAGE:ME,TAB_WORDFORMS:UE,TAB_ACTIONS:FE}:t.gridElement.type===O.V.ELEMENT_TYPE_YT_PLAYER||t.gridElement.type===O.V.ELEMENT_TYPE_COLLECT?this.possibleTabs={TAB_GENERAL:PE,TAB_ACTIONS:FE}:t.gridElement.type===O.V.ELEMENT_TYPE_PREDICTION?this.possibleTabs={TAB_ACTIONS:FE}:t.gridElement.type===O.V.ELEMENT_TYPE_LIVE?this.possibleTabs={TAB_GENERAL:PE,TAB_LIVE_DATA:BE,TAB_IMAGE:ME,TAB_ACTIONS:FE}:t.gridElement.type===O.V.ELEMENT_TYPE_MATRIX_CONVERSATION&&(this.possibleTabs={TAB_GENERAL:PE,TAB_ACTIONS:FE}),t.originalGridElement=JSON.parse(JSON.stringify(t.gridElement))}))},resetInternal(){this.gridElement=this.originalGridElement=null},preventDefault(e){e.preventDefault()},openHelp(){Qc.openHelp()},close(){this.$emit("close")}},mounted(){this.editElementId=this.editElementIdParam,this.initInternal(),Qc.setHelpLocation("03_appearance_layout","#edit-modal")},beforeDestroy(){Qc.revertToLastLocation()}};var VE=s(5587),jE={};jE.styleTagTransform=Ed(),jE.setAttributes=gd(),jE.insert=vd().bind(null,"head"),jE.domAPI=hd(),jE.insertStyleElement=yd(),dd()(VE.A,jE),VE.A&&VE.A.locals&&VE.A.locals;const KE=Cd($E,Ff,[],!1,null,"e00d3244",null).exports;var WE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("addMultipleGridItems"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"inputText"}},[e._v(e._s(e.$t("input")))]),e._v(" "),t("span",{staticClass:"nine columns"},[e._v(e._s(e.$t("insertLabelsForNewElements")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("textarea",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputText,expression:"inputText"}],staticClass:"twelve columns",staticStyle:{resize:"vertical","min-height":"70px"},attrs:{id:"inputText",placeholder:"Element1;Element2;Element3;..."},domProps:{value:e.inputText},on:{input:[function(t){t.target.composing||(e.inputText=t.target.value)},e.textChanged]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns"},[e._v(e._s(e.$t("recognizedElements")))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.parsedElems.length>0,expression:"parsedElems.length > 0"}],staticClass:"nine columns"},[t("span",[e._v(e._s(e.parsedElems.length))]),e._v(" "),t("span",[e._v(e._s(e.$t("elementsBracket")))]),e._v(" "),t("span",{staticClass:"break-word"},[e._v(e._s(JSON.stringify(e.parsedElems)))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0==e.parsedElems.length,expression:"parsedElems.length == 0"}],staticClass:"nine columns"},[t("span",[e._v(e._s(e.$t("noElements")))])])])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"four columns offset-by-four",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",attrs:{title:e.$t("keyboardCtrlEnter"),disabled:0==e.parsedElems.length},on:{click:function(t){return e.save()}}},[e.loading?e._e():t("i",{staticClass:"fas fa-check"}),e._v(" "),e.loading?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e(),e._v(" "),t("span",[e._v(e._s(e.$t("insertElements")))])])])])])])])])};WE._withStripped=!0;const qE={props:["gridData","undoService"],data:function(){return{inputText:"",parsedElems:[],loading:!1}},methods:{textChanged(){let e=this.inputText||"";ee.Z.isOnlyEmojis(e)?this.parsedElems=ee.Z.getEmojis(e):(e=e.replace(/\n/gi,";").replace(/;;/gi,";"),this.parsedElems=e.split(";").map((e=>e.trim())).filter((e=>e.length>0)))},async save(){var e=this;this.loading=!0,this.$nextTick((async()=>{if(0===e.parsedElems.length)return;let t=new c.D(this.gridData),n=Ge.b.getFreeCoordinates(this.gridData);this.parsedElems.forEach((e=>{0===n.length&&(n=Ge.b.getFreeCoordinates(t));let r=n.shift();r||(r={x:0,y:Ge.b.getHeightWithBounds(this.gridData)});var i=new O.V({label:o.A.getTranslationObject(e),x:r.x,y:r.y});t.gridElements.push(i)})),await this.undoService.updateGrid(t),this.loading=!1,this.$emit("reload",t),this.$emit("close")}))}},mounted(){Qc.setHelpLocation("03_appearance_layout","#adding-elements-and-layout-options")},beforeDestroy(){Qc.revertToLastLocation()}};var HE=s(6689),YE={};YE.styleTagTransform=Ed(),YE.setAttributes=gd(),YE.insert=vd().bind(null,"head"),YE.domAPI=hd(),YE.insertStyleElement=yd(),dd()(HE.A,YE),HE.A&&HE.A.locals&&HE.A.locals;const zE=Cd(qE,WE,[],!1,null,"3ebc3fd6",null).exports;var JE=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",staticStyle:{"max-width":"500px"},on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("gridSettings"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("h2",[e._v(e._s(e.$t("size")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"seven columns",attrs:{for:"gridRows"}},[e._v(e._s(e.$t("minimumNumberOfRows")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridData.rowCount,expression:"gridData.rowCount",modifiers:{number:!0}}],staticClass:"three columns",attrs:{id:"gridRows",type:"number",min:"1",max:e.gridLayoutUtil.MAX_GRID_SIZE},domProps:{value:e.gridData.rowCount},on:{input:function(t){t.target.composing||e.$set(e.gridData,"rowCount",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"seven columns",attrs:{for:"gridCols"}},[e._v(e._s(e.$t("minimumNumberOfColumns")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridData.minColumnCount,expression:"gridData.minColumnCount",modifiers:{number:!0}}],staticClass:"three columns",attrs:{id:"gridCols",type:"number",min:"1",max:e.gridLayoutUtil.MAX_GRID_SIZE},domProps:{value:e.gridData.minColumnCount},on:{input:function(t){t.target.composing||e.$set(e.gridData,"minColumnCount",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),e.isGlobalGrid&&e.metadata&&1===e.gridHeight?t("div",{staticClass:"srow"},[t("label",{staticClass:"seven columns",attrs:{for:"metadataHeight"}},[e._v(e._s(e.$t("heightOfFirstGlobalGridRow")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.metadata.globalGridHeightPercentage,expression:"metadata.globalGridHeightPercentage",modifiers:{number:!0}}],staticClass:"three columns",attrs:{id:"metadataHeight",type:"number",min:"5",max:"50"},domProps:{value:e.metadata.globalGridHeightPercentage},on:{input:function(t){t.target.composing||e.$set(e.metadata,"globalGridHeightPercentage",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]):e._e(),e._v(" "),e.isGlobalGrid?e._e():t("div",[t("h2",[e._v(e._s(e.$t("globalGrid")))]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.gridData.showGlobalGrid,expression:"gridData.showGlobalGrid"}],attrs:{id:"showGlobalGrid",type:"checkbox"},domProps:{checked:Array.isArray(e.gridData.showGlobalGrid)?e._i(e.gridData.showGlobalGrid,null)>-1:e.gridData.showGlobalGrid},on:{change:function(t){var n=e.gridData.showGlobalGrid,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.gridData,"showGlobalGrid",n.concat([null])):o>-1&&e.$set(e.gridData,"showGlobalGrid",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.gridData,"showGlobalGrid",i)}}}),e._v(" "),t("label",{attrs:{for:"showGlobalGrid"}},[e._v(e._s(e.$t("showGlobalGrid")))])]),e._v(" "),e._e()]),e._v(" "),t("h2",[e._v(e._s(e.$t("keyboard")))]),e._v(" "),t("div",{staticClass:"srow mb-5"},[t("label",{staticClass:"four columns",attrs:{for:"keyboardMode"}},[e._v(e._s(e.$t("keyboardMode")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridData.keyboardMode,expression:"gridData.keyboardMode"}],staticClass:"six columns",attrs:{id:"keyboardMode"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.gridData,"keyboardMode",t.target.multiple?n:n[0])}}},[t("option",{domProps:{value:null}},[e._v("("+e._s(e.$t("automatic"))+")")]),e._v(" "),e._l(e.GridData.KEYBOARD_MODES,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t(n)))])}))],2)])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};JE._withStripped=!0;const XE={props:["gridDataParam","isGlobalGrid","undoService"],data:function(){return{gridData:JSON.parse(JSON.stringify(this.gridDataParam)),gridHeight:Ge.b.getHeight(this.gridDataParam),metadata:null,allGrids:[],gridLayoutUtil:ey.f,GridData:c.D}},methods:{save(){this.gridData.rowCount=Math.min(this.gridData.rowCount,ey.f.MAX_GRID_SIZE),this.gridData.minColumnCount=Math.min(this.gridData.minColumnCount,ey.f.MAX_GRID_SIZE),n.w.saveLastGridDimensions({rowCount:this.gridData.rowCount,minColumnCount:this.gridData.minColumnCount});let e=[];this.metadata&&e.push(xg.saveMetadata(this.metadata)),e.push(this.undoService.updateGrid(this.gridData)),Promise.all(e).then((()=>{this.$emit("reload"),this.$emit("close")}))}},async mounted(){this.isGlobalGrid&&xg.getMetadata().then((e=>{this.metadata=JSON.parse(JSON.stringify(e))})),this.allGrids=(await xg.getGrids(!1)).sort(((e,t)=>o.A.getTranslation(e.label).localeCompare(o.A.getTranslation(t.label))))}},QE=XE;var ZE=s(3468),eb={};eb.styleTagTransform=Ed(),eb.setAttributes=gd(),eb.insert=vd().bind(null,"head"),eb.domAPI=hd(),eb.insertStyleElement=yd(),dd()(ZE.A,eb),ZE.A&&ZE.A.locals&&ZE.A.locals;const tb=Cd(QE,JE,[],!1,null,"15799f37",null).exports;var nb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("translateGrids"))+"\n                    ")])]),e._v(" "),void 0!==e.gridData?t("div",{staticClass:"modal-body"},[t("div",[t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"gridSelect"}},[e._v(e._s(e.$t("gridToTranslate")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.gridData,expression:"gridData"}],staticClass:"four columns",attrs:{id:"gridSelect"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.gridData=t.target.multiple?n:n[0]}}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("showAllGrids")))]),e._v(" "),e._l(e.allGrids,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("extractTranslation")(n.label)))])}))],2)]),e._v(" "),e.usedLocales.length>0?t("div",{staticClass:"srow mt-4"},[t("label",{staticClass:"four columns"},[e._v(e._s(e.$t("selectAlreadyUsedLanguages")))]),e._v(" "),t("span",{staticClass:"eight columns"},e._l(e.usedLocales,(function(n){return n!==e.currentLocale?t("button",{staticStyle:{"margin-right":"0.5em",padding:"0","line-height":"1"},on:{click:function(t){e.chosenLocale=n}}},[e._v(e._s(e.getLocaleTranslation(n)))]):e._e()})),0)]):e._e(),e._v(" "),t("div",{staticClass:"srow",staticStyle:{"margin-top":"2em"}},[t("div",{staticClass:"six columns"},[t("div",{staticClass:"srow",staticStyle:{height:"2em"}},[t("strong",[e._v(e._s(e.$t("textsIn")))]),e._v(" "),t("strong",[e._v(e._s(e.currentLangTranslated)+" ("+e._s(e.currentLocale)+")")])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("copyColumn")},on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.copy(e.currentLocale)},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.copy(e.currentLocale,!1,!0):null},function(t){return t.ctrlKey&&t.shiftKey?t.altKey||t.metaKey?null:e.copy(e.currentLocale,!0,!1):null}]}},[t("i",{staticClass:"far fa-copy"}),e._v(" "),t("span",{staticClass:"show-mobile"},[t("i18n",{attrs:{path:"copySomething",tag:"span"},scopedSlots:e._u([{key:"toCopy",fn:function(){return[e._v("\n                                                    "+e._s(e.currentLangTranslated)+"\n                                                ")]},proxy:!0}],null,!1,3961774785)})],1),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("copyColumn")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("pasteColumn")},on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.paste(e.currentLocale)},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.paste(e.currentLocale,!1,!0):null},function(t){return t.ctrlKey&&t.shiftKey?t.altKey||t.metaKey?null:e.paste(e.currentLocale,!0):null}]}},[t("i",{staticClass:"far fa-clipboard"}),e._v(" "),t("span",{staticClass:"show-mobile"},[t("i18n",{attrs:{path:"pasteSomething",tag:"span"},scopedSlots:e._u([{key:"toPaste",fn:function(){return[e._v("\n                                                    "+e._s(e.currentLangTranslated)+"\n                                                ")]},proxy:!0}],null,!1,3592390903)})],1),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("pasteColumn")))])])])]),e._v(" "),t("div",{staticClass:"six columns"},[t("div",{staticClass:"srow"},[t("strong",{staticClass:"three columns"},[e._v(e._s(e.$t("textsIn")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.chosenLocale,expression:"chosenLocale"}],staticClass:"nine columns",on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.chosenLocale=t.target.multiple?n:n[0]}}},e._l(e.allLanguages.filter((t=>t.code!==e.currentLocale)),(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")])})),0)]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("copyColumn")},on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.copy(e.chosenLocale)},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.copy(e.chosenLocale,!1,!0):null},function(t){return t.ctrlKey&&t.shiftKey?t.altKey||t.metaKey?null:e.copy(e.chosenLocale,!0,!1):null}]}},[t("i",{staticClass:"far fa-copy"}),e._v(" "),t("span",{staticClass:"show-mobile"},[t("i18n",{attrs:{path:"copySomething",tag:"span"},scopedSlots:e._u([{key:"toCopy",fn:function(){return[e._v("\n                                                    "+e._s(e.chosenLangTranslated)+"\n                                                ")]},proxy:!0}],null,!1,291522548)})],1),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("copyColumn")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("pasteColumn")},on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.paste(e.chosenLocale)},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.paste(e.chosenLocale,!1,!0):null},function(t){return t.ctrlKey&&t.shiftKey?t.altKey||t.metaKey?null:e.paste(e.chosenLocale,!0):null}]}},[t("i",{staticClass:"far fa-clipboard"}),e._v(" "),t("span",{staticClass:"show-mobile"},[t("i18n",{attrs:{path:"pasteSomething",tag:"span"},scopedSlots:e._u([{key:"toPaste",fn:function(){return[e._v("\n                                                    "+e._s(e.chosenLangTranslated)+"\n                                                ")]},proxy:!0}],null,!1,728563682)})],1),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("pasteColumn")))])])])])]),e._v(" "),t("div",{attrs:{id:"translationList"}},[t("h2",[e._v(e._s(e.$t("nameOfGrid")))]),e._v(" "),t("ul",e._l(e.selectedGrids,(function(n){return t("li",[t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:n.label[e.currentLocale],expression:"data.label[currentLocale]"}],staticClass:"six columns",attrs:{type:"text",placeholder:`(${e.currentLangTranslated})`,lang:e.currentLocale},domProps:{value:n.label[e.currentLocale]},on:{change:function(t){return e.changedGrid(n)},input:function(t){t.target.composing||e.$set(n.label,e.currentLocale,t.target.value)}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.label[e.chosenLocale],expression:"data.label[chosenLocale]"}],staticClass:"six columns",attrs:{type:"text",placeholder:`(${e.chosenLangTranslated})`,lang:e.chosenLocale},domProps:{value:n.label[e.chosenLocale]},on:{change:function(t){return e.changedGrid(n)},input:function(t){t.target.composing||e.$set(n.label,e.chosenLocale,t.target.value)}}})])])})),0),e._v(" "),t("h2",[e._v(e._s(e.$t("elementLabels")))]),e._v(" "),t("ul",e._l(e.allElements,(function(n){return t("li",[e.showGridElements(n.grid)&&e.shouldShowMap[n.element.id]?t("div",{staticClass:"srow"},[t("div",{staticClass:"one columns"},[t("img",{staticStyle:{"max-width":"100%"},attrs:{height:"25",src:n.element.image?n.element.image.url||n.element.image.data:""}})]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.element.label[e.currentLocale],expression:"item.element.label[currentLocale]"}],staticClass:"five columns",attrs:{type:"text",placeholder:`(${e.currentLangTranslated})`,lang:e.currentLocale,i18nid:e.getI18nId(n.grid,n.element)},domProps:{value:n.element.label[e.currentLocale]},on:{change:function(t){return e.changedGrid(n.grid)},input:function(t){t.target.composing||e.$set(n.element.label,e.currentLocale,t.target.value)}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.element.label[e.chosenLocale],expression:"item.element.label[chosenLocale]"}],staticClass:"six columns",attrs:{type:"text",placeholder:`(${e.chosenLangTranslated})`,lang:e.chosenLocale,i18nid:e.getI18nId(n.grid,n.element)},domProps:{value:n.element.label[e.chosenLocale]},on:{change:function(t){return e.changedGrid(n.grid)},input:function(t){t.target.composing||e.$set(n.element.label,e.chosenLocale,t.target.value)}}})]):e._e()])})),0),e._v(" "),e.anyHasCustomSpeakAction?t("h2",[e._v(e._s(`${e.$t("actions")} "${e.$t("GridActionSpeakCustom")}"`))]):e._e(),e._v(" "),e.anyHasCustomSpeakAction?t("ul",e._l(e.allElements,(function(n){return e.showGridElements(n.grid)?t("li",e._l(n.element.actions,(function(r){return r.modelName===e.GridActionSpeakCustom.getModelName()?t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:r.speakText[e.currentLocale],expression:"action.speakText[currentLocale]"}],staticClass:"six columns",attrs:{type:"text",placeholder:`(${e.currentLangTranslated})`,lang:e.currentLocale,i18nid:e.getI18nId(n.grid,n.element,e.GridActionSpeakCustom.getModelName())},domProps:{value:r.speakText[e.currentLocale]},on:{change:function(t){return e.changedGrid(n.grid)},input:function(t){t.target.composing||e.$set(r.speakText,e.currentLocale,t.target.value)}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:r.speakText[e.chosenLocale],expression:"action.speakText[chosenLocale]"}],staticClass:"six columns",attrs:{type:"text",placeholder:`(${e.chosenLangTranslated})`,lang:e.chosenLocale,i18nid:e.getI18nId(n.grid,n.element,e.GridActionSpeakCustom.getModelName())},domProps:{value:r.speakText[e.chosenLocale]},on:{change:function(t){return e.changedGrid(n.grid)},input:function(t){t.target.composing||e.$set(r.speakText,e.chosenLocale,t.target.value)}}})]):e._e()})),0):e._e()})),0):e._e()])])]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"three columns offset-by-six",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"three columns",attrs:{title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("save")))])])])])])])])])};nb._withStripped=!0,window.hideKeyboardTranslations=!0;const rb={props:["gridDataId"],data:function(){return{gridData:void 0,allGrids:void 0,currentLocale:o.A.getContentLang(),chosenLocale:o.A.isCurrentContentLangEN()?"de":"en",GridActionSpeakCustom:I.m,allLanguages:o.A.getAllLanguages(),usedLocales:[],changedGrids:[],shouldShowMap:{}}},computed:{currentLangTranslated:function(){return this.getLocaleTranslation(this.currentLocale)},chosenLangTranslated:function(){return this.getLocaleTranslation(this.chosenLocale)},selectedGrids(){return this.gridData||this.allGrids?this.gridData?[this.gridData]:this.allGrids:[]},allElements(){let e=[];for(let t of this.selectedGrids)e=e.concat(t.gridElements.map((e=>({element:e,grid:t}))));return e},anyHasCustomSpeakAction(){return this.allElements.some((e=>e.element.actions.some((e=>e.modelName===I.m.getModelName()))))}},methods:{save(){let e=this;xg.saveGrids(JSON.parse(JSON.stringify(e.changedGrids))).then((()=>{e.$emit("reload"),e.$emit("close")}))},changedGrid(e){e?-1===this.changedGrids.indexOf(e)&&this.changedGrids.push(e):this.changedGrids=this.allGrids},getLocaleTranslation(e){return o.A.getTranslationAppLang(this.allLanguages.filter((t=>t.code===e))[0])},copy(e,n,r){let i=(0,t.A)(`#translationList input[lang='${e}']`).toArray(),o=null;if(n){let e=i.map((e=>({key:e.getAttribute("i18nid"),value:e.value}))).filter((e=>!!e.key));o=JSON.stringify(e)}else{let n=e===this.currentLocale?this.chosenLocale:this.currentLocale,a=(0,t.A)(`#translationList input[lang='${n}']`).toArray();o="";for(let e=0;e<i.length;e++)(!r||i[e].value&&!a[e].value)&&(o+=i[e].value+"\n")}ee.Z.copyToClipboard(o)},paste(e,n,r){ee.Z.getClipboardContent().then((i=>{if(i)if(this.changedGrid(this.gridData),n){let n=JSON.parse(i),r=0;for(let i of n){let n=(0,t.A)(`#translationList input[i18nid='${i.key}'][lang='${e}']`).toArray()[0];n&&i.value&&((0,t.A)(n).val(i.value),(0,t.A)(n)[0].dispatchEvent(new Event("input")),r++)}log.info(`inserted ${r} (of ${n.length}) translations from json from clipboard.`)}else{let n=i.trim().split("\n"),o=(0,t.A)(`#translationList input[lang='${e}']`).toArray(),a=e===this.currentLocale?this.chosenLocale:this.currentLocale,s=(0,t.A)(`#translationList input[lang='${a}']`).toArray(),l=0;for(let e=0;e<o.length;e++)(!r||!o[e].value&&s[e].value)&&n[l]&&((0,t.A)(o[e]).val(n[l]),(0,t.A)(o[e])[0].dispatchEvent(new Event("input")),l++)}}))},showGridElements(e){let t=e.label[this.currentLocale]||e.label[Object.keys(e.label)[0]];return!(window.hideKeyboardTranslations&&null===this.gridData&&t&&(t=t.toLowerCase(),t.includes("keyboard")||t.includes("tastatur")||t.includes("zahlen")||t.includes("numbers")))},getI18nId(e,t,n){n=n||"";let r=t.image?t.image.url||t.image.data:"";return r=r||"",r=r.substring(0,100),btoa(""+e.gridElements.length+e.rowCount+e.minColumnCount+t.x+t.y+n+r)}},mounted(){xg.getGrids(!0).then((e=>{this.allGrids=JSON.parse(JSON.stringify(e)),this.allGrids.sort(((e,t)=>o.A.getTranslation(e.label).localeCompare(o.A.getTranslation(t.label)))),this.gridData=this.allGrids.filter((e=>e.id===this.gridDataId))[0];for(let e of this.allGrids)for(let t of e.gridElements){let e=Object.keys(t.label).some((e=>!!t.label[e])),n=t.image&&(t.image.url||t.image.data);this.shouldShowMap[t.id]=e||n;for(let e of Object.keys(t.label))!this.usedLocales.includes(e)&&t.label[e]&&this.usedLocales.push(e)}this.usedLocales.sort(((e,t)=>this.getLocaleTranslation(e).localeCompare(this.getLocaleTranslation(t))))}))}};var ib=s(5139),ob={};ob.styleTagTransform=Ed(),ob.setAttributes=gd(),ob.insert=vd().bind(null,"head"),ob.domAPI=hd(),ob.insertStyleElement=yd(),dd()(ib.A,ob),ib.A&&ib.A.locals&&ib.A.locals;const ab=Cd(rb,nb,[],!1,null,"9f5001ea",null).exports;var sb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",attrs:{"aria-label":e.$t("navigateToOtherGrid"),"aria-modal":"true",role:"dialog"},on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("div",{staticClass:"modal-header"},[t("edit-element-header",{attrs:{"grid-element":e.gridElement,header:e.$t("navigateToOtherGrid"),"close-fn":e.close,"open-help-fn":e.openHelp}})],1),e._v(" "),e.gridElement?t("div",{staticClass:"modal-body container-fluid px-0"},[t("grid-selector",{staticClass:"mt-4",attrs:{"exclude-id":e.gridId,"select-label":e.i18nService.t("navigateToGrid"),"additional-select-options":[e.NAV_CREATE_NEW_GRID]},model:{value:e.selectedGrid,callback:function(t){e.selectedGrid=t},expression:"selectedGrid"}}),e._v(" "),e.selectedGrid===e.NAV_CREATE_NEW_GRID?t("div",{staticClass:"row mt-3"},[t("label",{staticClass:"col-12",attrs:{for:"gridName"}},[e._v(e._s(e.$t("newGridName")))]),e._v(" "),t("div",{staticClass:"col-12 col-md-5"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newName,expression:"newName"},{name:"focus",rawName:"v-focus"}],staticClass:"col-12",attrs:{id:"gridName",autocomplete:"off",type:"text"},domProps:{value:e.newName},on:{change:function(t){e.newName=e.modelUtil.getNewName(e.newName,e.existingGridNames)},input:function(t){t.target.composing||(e.newName=t.target.value)}}})])]):e._e()],1):e._e(),e._v(" "),t("div",{staticClass:"modal-footer container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6"},[t("button",{staticClass:"col-12",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])])]),e._v(" "),t("div",{staticClass:"col-12 col-md-6"},[t("button",{staticClass:"col-12",attrs:{disabled:e.selectedGrid===e.NAV_CREATE_NEW_GRID&&!e.newName,title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])])};sb._withStripped=!0;var lb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-5"},[t("div",{staticClass:"row"},[t("label",{attrs:{for:"moveGrid"}},[e._v(e._s(e.selectLabel))])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedGrid,expression:"selectedGrid"}],staticClass:"col-12",staticStyle:{"margin-bottom":"1em"},attrs:{id:"moveGrid"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedGrid=t.target.multiple?n:n[0]},function(t){return e.selectGrid(e.selectedGrid)}]}},[e._l(e.additionalSelectOptions,(function(n){return e.additionalSelectOptions?t("option",{domProps:{value:n}},[e._v(e._s(e._f("translate")(n)))]):e._e()})),e._v(" "),e._l(e.grids,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e._f("extractTranslation")(n.label)))])}))],2)])]),e._v(" "),e.selectedGrid&&e.selectedGrid.thumbnail&&e.selectedGrid.thumbnail.data?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("img",{staticStyle:{"max-width":"100%",border:"1px solid lightgray"},attrs:{src:e.selectedGrid.thumbnail.data}})])]):e._e(),e._v(" "),e.selectedGrid&&e.selectedGrid.id?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("button",{staticStyle:{width:"49%"},on:{click:e.prev}},[t("i",{staticClass:"fas fa-arrow-left"}),e._v(" "),t("span",[e._v(e._s(e.$t("back")))])]),e._v(" "),t("button",{staticStyle:{width:"49%"},on:{click:e.next}},[t("span",[e._v(e._s(e.$t("next")))]),e._v(" "),t("i",{staticClass:"fas fa-arrow-right"})])])]):e._e()])])])};lb._withStripped=!0;const cb={components:{EditElementHeader:hE,GridSelector:Cd({props:["excludeId","value","selectLabel","additionalSelectOptions","includeGlobal"],data(){return{currentValue:this.value,grids:[],selectedGrid:{},imageUtil:ue.M,i18nService:o.A}},watch:{value:function(e,t){this.selectedGrid=e}},methods:{selectGrid(e){this.selectedGrid=e,this.$emit("input",e)},prev(){let e=this.grids.indexOf(this.selectedGrid),t=e-1<0?this.grids.length-1:e-1;this.selectGrid(this.grids[t])},next(){let e=this.grids.indexOf(this.selectedGrid),t=e+1<this.grids.length?e+1:0;this.selectGrid(this.grids[t])}},mounted(){let e=this.additionalSelectOptions||[];xg.getGrids(!1,!this.includeGlobal).then((t=>{this.grids=JSON.parse(JSON.stringify(t)).filter((e=>!this.excludeId||e.id!==this.excludeId)),this.grids.sort(((e,t)=>o.A.getTranslation(e.label).localeCompare(o.A.getTranslation(t.label)))),this.selectGrid(e[0]||this.grids[0])}))}},lb,[],!1,null,"567a2103",null).exports},props:["gridId","gridElementId"],data:function(){return{gridData:null,gridElement:null,selectedGrid:null,moveAllElements:!1,i18nService:o.A,imageUtil:ue.M,existingGridNames:[],newName:"",modelUtil:u.S,NAV_CREATE_NEW_GRID:"NAV_CREATE_NEW_GRID"}},methods:{addGrid(){},save(){(this.selectedGrid!==this.NAV_CREATE_NEW_GRID||this.newName)&&this.saveInternal().then((()=>{this.$emit("reload",this.gridData),this.$emit("close")}))},async saveInternal(){let e=null,t=null;if(this.selectedGrid===this.NAV_CREATE_NEW_GRID){let n=new c.D({label:o.A.getTranslationObject(this.newName),gridElements:[]});await xg.saveGrid(n),e=n.id,t=this.newName}else e=this.selectedGrid.id,t=o.A.getTranslation(this.selectedGrid.label);this.gridElement.actions=this.gridElement.actions.filter((e=>e.modelName!==D.g.getModelName()));let n=new D.g({toGridId:e,navType:D.g.NAV_TYPES.TO_GRID});o.A.getTranslation(this.gridElement.label)||(this.gridElement.label=this.gridElement.label||{},this.gridElement.label[o.A.getContentLang()]=t),this.gridElement.actions.push(n),await xg.saveGrid(this.gridData)},openHelp(){Qc.openHelp()},close(){this.$emit("close")}},async mounted(){xg.getGrid(this.gridId).then((e=>{this.gridData=JSON.parse(JSON.stringify(e)),this.gridElement=this.gridData.gridElements.filter((e=>e.id===this.gridElementId))[0]}));let e=await xg.getGrids(!1);this.existingGridNames=e.map((e=>o.A.getTranslation(e.label)))}};var db=s(6460),ub={};ub.styleTagTransform=Ed(),ub.setAttributes=gd(),ub.insert=vd().bind(null,"head"),ub.domAPI=hd(),ub.insertStyleElement=yd(),dd()(db.A,ub),db.A&&db.A.locals&&db.A.locals;const hb=Cd(cb,sb,[],!1,null,"107717fa",null).exports;function pb(){var e=this,t=[],n=[];e.canUndo=function(){return t.length>0},e.canRedo=function(){return n.length>0},e.updateGrid=function(e){return new Promise((r=>{xg.getGrid(e.id).then((i=>{i.isEqual(e)?(log.debug("grid not updated, do noting"),r(!1)):(t.push(JSON.parse(JSON.stringify(i))),n=[],Md.setCurrentGrid(e),xg.saveGrid(e).then((()=>{r(!0)})))}))}))},e.doUndo=async function(){if(this.canUndo()){let e=t.pop();Md.setCurrentGrid(e);let r=await xg.getGrid(e.id);return n.push(JSON.parse(JSON.stringify(r))),await xg.saveGrid(e),e}},e.doRedo=async function(){if(this.canRedo()){let e=n.pop();Md.setCurrentGrid(e);let r=await xg.getGrid(e.id);return t.push(JSON.parse(JSON.stringify(r))),await xg.saveGrid(e),e}}}var vb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",attrs:{"aria-label":e.$t("navigateToOtherGrid"),"aria-modal":"true",role:"dialog"},on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("div",{staticClass:"modal-header"},[t("edit-element-header",{attrs:{"grid-element":e.gridElement,header:e.$t("transferProperties"),"close-fn":e.close}})],1),e._v(" "),e.gridElement?t("div",{staticClass:"modal-body container-fluid px-0"},[t("span",[e._v(e._s(e.$t("selectPropsToTransfer"))+".")]),e._v(" "),t("h2",{staticClass:"mt-4 mb-2"},[e._v(e._s(e.$t("TAB_APPEARANCE")))]),e._v(" "),t("transfer-props-list-header"),e._v(" "),t("ul",e._l(Object.keys(e.PROPS).filter((t=>e.PROPS[t].category===e.CATEGORIES.APPEARANCE)),(function(n){return t("transfer-props-elem",{key:n,staticClass:"mb-5 mb-sm-3",attrs:{"prop-object":e.PROPS[n],"grid-element":e.gridElement},on:{change:t=>e.selectProp(t,e.PROPS[n])}})})),1),e._v(" "),t("h2",{staticClass:"mt-4 mb-2"},[e._v(e._s(e.$t("othersHeading")))]),e._v(" "),t("transfer-props-list-header"),e._v(" "),t("ul",e._l(Object.keys(e.PROPS).filter((t=>e.PROPS[t].category===e.CATEGORIES.OTHERS)),(function(n){return t("transfer-props-elem",{key:n,staticClass:"mb-5 mb-sm-3",attrs:{"prop-object":e.PROPS[n],"grid-element":e.gridElement},on:{change:t=>e.selectProp(t,e.PROPS[n])}})})),1)],1):e._e(),e._v(" "),t("div",{staticClass:"modal-footer container-fluid px-0"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-md-6"},[t("button",{staticClass:"col-12",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])])]),e._v(" "),t("div",{staticClass:"col-12 col-md-6"},[t("button",{staticClass:"col-12",attrs:{disabled:!e.anySelected,title:e.$t("keyboardCtrlEnter")},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])])};vb._withStripped=!0;var mb=function(){var e=this,t=e._self._c;return t("li",{staticClass:"row"},[t("div",{staticClass:"d-none d-sm-flex col-sm-2"},[t("input",{attrs:{id:"transfer1"+e.propObject.path,type:"checkbox"},on:{change:function(t){return e.changed(t)}}})]),e._v(" "),t("div",{staticClass:"col-sm-5"},[t("input",{staticClass:"d-inline-block d-sm-none",attrs:{id:"transfer2"+e.propObject.path,type:"checkbox"},on:{change:function(t){return e.changed(t)}}}),e._v(" "),t("label",{staticClass:"d-none d-sm-flex",staticStyle:{"font-weight":"normal"},attrs:{for:"transfer1"+e.propObject.path}},[e._v(e._s(e.$t(e.propObject.label)))]),e._v(" "),t("label",{staticClass:"d-inline-block d-sm-none",attrs:{for:"transfer2"+e.propObject.path}},[e._v(e._s(e.$t(e.propObject.label)))])]),e._v(" "),t("div",{staticClass:"col-sm-3"},[t("span",{staticClass:"d-inline-block d-sm-none"},[e._v(e._s(e.$t("currentValue"))+":")]),e._v(" "),t("div",{staticClass:"d-inline-block"},[[void 0,null].includes(e.gridElement[e.propObject.path])&&e.propObject.type!==e.TYPES.BOOLEAN?t("span",[e._v(e._s(e.$t("noneSelected")))]):e._e(),e._v(" "),[void 0,null].includes(e.gridElement[e.propObject.path])&&e.propObject.type!==e.TYPES.BOOLEAN?e._e():t("div",[e.propObject.type===e.TYPES.BOOLEAN?t("div",[e.gridElement[e.propObject.path]?t("span",[t("i",{staticClass:"far fa-check-square"}),e._v(" "+e._s(e.$t("checked")))]):e._e(),e._v(" "),e.gridElement[e.propObject.path]?e._e():t("span",[t("i",{staticClass:"far fa-square"}),e._v(" "+e._s(e.$t("unchecked")))])]):e._e(),e._v(" "),e.propObject.type===e.TYPES.PERCENTAGE?t("span",[e._v(e._s(e.gridElement[e.propObject.path])+"%")]):e._e(),e._v(" "),e.propObject.type===e.TYPES.NUMBER?t("span",[e._v(e._s(e.gridElement[e.propObject.path]))]):e._e(),e._v(" "),e.propObject.type===e.TYPES.TEXT?t("span",[e._v(e._s(e.$t(e.gridElement[e.propObject.path])))]):e._e(),e._v(" "),e.propObject.type===e.TYPES.COLOR?t("div",{staticClass:"p-1",style:`background-color: ${e.gridElement[e.propObject.path]}; color: ${e.fontUtil.getHighContrastColor(e.gridElement[e.propObject.path])}; text-align: center`},[e._v(e._s(e.gridElement[e.propObject.path]))]):e._e()])])])])};mb._withStripped=!0;const gb={components:{},props:["propObject","gridElement"],data:function(){return{TYPES:C.A.PROP_TRANSFER_TYPES,fontUtil:xu}},methods:{changed(e){this.$emit("change",e.target.checked)}},async mounted(){}};var fb=s(8649),yb={};yb.styleTagTransform=Ed(),yb.setAttributes=gd(),yb.insert=vd().bind(null,"head"),yb.domAPI=hd(),yb.insertStyleElement=yd(),dd()(fb.A,yb),fb.A&&fb.A.locals&&fb.A.locals;const _b=Cd(gb,mb,[],!1,null,"20bf73f4",null).exports;var Eb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-none d-sm-flex row mb-2",attrs:{"aria-hidden":"true"}},[t("strong",{staticClass:"col-sm-2"},[e._v(e._s(e.$t("transferQuestionmark")))]),e._v(" "),t("strong",{staticClass:"col-sm-5"},[e._v(e._s(e.$t("propertyName")))]),e._v(" "),t("strong",{staticClass:"col-sm-3"},[e._v(e._s(e.$t("currentValue")))])])};Eb._withStripped=!0;const bb={components:{TransferPropsListHeader:Cd({},Eb,[],!1,null,"470a21f8",null).exports,TransferPropsElem:_b,EditElementHeader:hE},props:["gridId","gridElementId"],data:function(){return{gridData:null,gridElement:null,transferObject:Ge.b.getPropTransferObjectBase(),PROPS:C.A.TRANSFER_PROPS,CATEGORIES:C.A.PROP_TRANSFER_CATEGORIES}},computed:{anySelected(){return!Ge.b.getAllPropTransferPaths().every((e=>this.transferObject[e]===C.A.PROP_TRANSFER_DONT_CHANGE))}},methods:{selectProp(e,t){e?this.$set(this.transferObject,t.path,this.gridElement[t.path]):this.$set(this.transferObject,t.path,C.A.PROP_TRANSFER_DONT_CHANGE)},save(){this.anySelected&&this.$emit("start",this.transferObject),this.$emit("close")},close(){this.$emit("close")}},async mounted(){xg.getGrid(this.gridId).then((e=>{this.gridData=JSON.parse(JSON.stringify(e)),this.gridElement=this.gridData.gridElements.find((e=>e.id===this.gridElementId))}))}};var Sb=s(6234),Cb={};Cb.styleTagTransform=Ed(),Cb.setAttributes=gd(),Cb.insert=vd().bind(null,"head"),Cb.domAPI=hd(),Cb.insertStyleElement=yd(),dd()(Sb.A,Cb),Sb.A&&Sb.A.locals&&Sb.A.locals;const wb=Cd(bb,vb,[],!1,null,"455ee238",null).exports;class Ab extends(O.V.extend({autoSpeak:[Boolean]})){constructor(e){(e=e||{}).type=O.V.ELEMENT_TYPE_MATRIX_CONVERSATION;let t=JSON.parse(JSON.stringify(Ab.DEFAULTS));super(Object.assign(t,e))}}Ab.DEFAULTS={};let Tb=null,Ib={props:["gridId","highlightId"],data:()=>({gridData:null,metadata:null,canUndo:!1,canRedo:!1,undoService:new pb,doingUndoRedo:!1,showMultipleModal:!1,showGridSettingsModal:!1,showNavigateModal:!1,showTranslateModal:!1,showPropTransferModal:!1,showEditModal:!1,editElementId:null,showGrid:!1,constants:C.A,markedElementIds:[],lastInteraction:{},newPosition:null,touchstartTimeoutHandler:null,isInteracting:!1,unmarkTimeoutHandler:null,shiftKeyHold:!1,ctrlKeyHold:!1,usingTouchscreen:!1,propTransferObject:null}),components:{TransferPropsModal:wb,AppGridDisplay:Ly,SetNavigationModal:hb,GridTranslateModal:ab,GridSettingsModal:tb,EditElement:KE,AddMultipleModal:zE,HeaderIcon:Pg},methods:{configPropTransfer(e){(e||1===this.markedElementIds.length)&&(this.editElementId=e||this.markedElementIds[0],this.showPropTransferModal=!0)},configPropTransferAll(e){if(!e&&1!==this.markedElementIds.length)return;this.editElementId=e||this.markedElementIds[0];let t=Ge.b.getPropTransferObjectAll(this.getElement(this.editElementId));this.startPropTransfer(t)},configPropTransferAppearance(e){if(!e&&1!==this.markedElementIds.length)return;this.editElementId=e||this.markedElementIds[0];let t=Ge.b.getPropTransferObjectAppearance(this.getElement(this.editElementId));this.startPropTransfer(t)},startPropTransfer(e){this.unmarkAll(),(0,t.A)(".element-container").removeClass("transfer-prop-source"),(0,t.A)("#"+this.editElementId).addClass("transfer-prop-source"),this.propTransferObject=e,this.$nextTick((()=>{t.A.contextMenu("destroy")}))},async applyPropTransfer(){let e=this.getElementsForAction();for(let t of e)for(let e of Ge.b.getAllPropTransferPaths())this.propTransferObject[e]!==C.A.PROP_TRANSFER_DONT_CHANGE&&this.$set(t,e,this.propTransferObject[e]);await this.updateGridWithUndo(),this.stopPropTransfer()},stopPropTransfer(){this.propTransferObject=null,(0,t.A)("#"+this.editElementId).removeClass("transfer-prop-source"),this.unmarkAll(),kb()},moveAll:function(e){this.gridData.gridElements=ey.f.moveAsPossible(this.gridData.gridElements,this.gridData.gridElements,e,{outOfBounds:!1,gridWidth:Ge.b.getWidthWithBounds(this.gridData),gridHeight:Ge.b.getHeightWithBounds(this.gridData)}),this.updateGridWithUndo()},normalizeGrid:function(){Ge.b.ensureUniqueIds(this.gridData.gridElements),this.gridData.gridElements=ey.f.normalizeGrid(this.gridData.gridElements),this.updateGridWithUndo()},async handleChange(e){this.gridData.gridElements=e,await this.updateGridWithUndo()},undo:async function(){this.undoService.canUndo()&&(this.doingUndoRedo=!0,this.gridData=await this.undoService.doUndo(),this.doingUndoRedo=!1,this.$forceUpdate())},redo:async function(){this.undoService.canRedo()&&(this.doingUndoRedo=!0,this.gridData=await this.undoService.doRedo(),this.doingUndoRedo=!1,this.$forceUpdate())},async updateGridWithUndo(){await this.undoService.updateGrid(this.gridData),this.$forceUpdate()},async reload(e){e=e||await xg.getGrid(this.gridData.id),this.gridData=e,Tm.updateOnce({elements:this.gridData.gridElements,forceUpdate:!0})},back(){this.metadata&&this.metadata.globalGridId===this.gridData.id?TA.toMain():TA.toGrid(this.gridData.id)},editElement(e=null){(e||1===this.markedElementIds.length)&&(this.editElementId=e||this.markedElementIds[0],this.gridData.gridElements.filter((e=>e.id===this.editElementId))[0]&&(this.showEditModal=!0),this.unmarkAll())},removeElements(e=null){let t=this.getElementIdsForAction(e);t.length&&(this.gridData.gridElements=this.gridData.gridElements.filter((e=>!t.includes(e.id))),this.updateGridWithUndo(),this.unmarkAll())},copyElements(e=null){let t=this.getElementsForAction(e);ee.Z.gridElementsToClipboard(t),this.unmarkAll()},copyAllElements(){ee.Z.gridElementsToClipboard(this.gridData.gridElements)},cutElements(e=null){let t=this.getElementsForAction(e);t.length&&(ee.Z.gridElementsToClipboard(t),this.removeElements(e),this.unmarkAll())},async duplicateElements(e=null){let t=this.getElementsForAction(e);if(!t.length)return;let n=Ge.b.duplicateElements(t);return this.unmarkAll(),1===n.length?(this.gridData.gridElements=ey.f.insertDuplicate(this.gridData.gridElements,t[0],n[0],{gridWidth:this.gridData.minColumnCount,gridHeight:this.gridData.rowCount}),this.updateGridWithUndo()):this.pasteElements(n)},hideUnhideElements(e=null){let t=this.getElementsForAction(e);if(!t.length)return;let n=t.every((e=>e.hidden));for(let e of t)e.hidden=!n;this.updateGridWithUndo(),this.unmarkAll()},async newElement(e,t){if(e===O.V.ELEMENT_TYPE_NORMAL)this.editElementId=null,this.newPosition=t&&void 0!==this.lastInteraction.x?this.lastInteraction:null,this.showEditModal=!0;else{let t=!1,n=new c.D(this.gridData).getNewXYPos(),r={type:e,x:n.x,y:n.y},i=new O.V(r);if(e===O.V.ELEMENT_TYPE_YT_PLAYER){let e=new Lu.a({action:Lu.a.actions.YT_TOGGLE});i.actions=[e]}else if(e===O.V.ELEMENT_TYPE_COLLECT){i=new R.$(r);let e=new x.z({action:x.z.COLLECT_ACTION_SPEAK});i.actions=[e]}else e===O.V.ELEMENT_TYPE_LIVE?(i=new ch(r),t=!0):e===O.V.ELEMENT_TYPE_MATRIX_CONVERSATION&&(i=new Ab(r));this.gridData.gridElements.push(i),await this.updateGridWithUndo(),t&&(this.editElementId=i.id,this.showEditModal=!0)}},newElements(){this.showMultipleModal=!0},clearElements(){confirm(o.A.t("CONFIRM_DELETE_ALL_ELEMS"))&&(this.gridData.gridElements=[],this.updateGridWithUndo())},fillElements(){let e=Ge.b.getFillElements(this.gridData);this.gridData.gridElements=this.gridData.gridElements.concat(e),this.updateGridWithUndo()},reloadFn(e,t,n,r){if(Tb&&r.includes(Tb.gridId))TA.toManageGrids();else if(Tb&&t.includes(Tb.gridData.id)){let e=new c.D(n.filter((e=>e.id===Tb.gridData.id))[0]);e.isEqual(Tb.gridData)||(log.debug("reloading on remote update..."),Tb.reload(e))}else if(t.includes(Tb.metadata.id)){let e=n.filter((e=>e.id===Tb.metadata.id))[0];e&&JSON.stringify(e.colorConfig)!==JSON.stringify(Tb.metadata.colorConfig)&&Tb.reload()}},unmarkAll(){(0,t.A)(".element-container").removeClass("marked"),this.markedElementIds=[]},markAll(){(0,t.A)(".element-container").addClass("marked"),this.markedElementIds=this.gridData.gridElements.map((e=>e.id))},markElement(e){e&&ee.Z.throttle((()=>{if(this.shiftKeyHold&&this.markedElementIds.length){let t=this.gridData.gridElements,n=t.find((t=>t.id===e)),r=this.markedElementIds.map((e=>t.find((t=>t.id===e))))[0],i=t.filter((e=>Ge.b.isWithinElements(n,r,e)));this.unmarkAll(),this.addToMarkedInternal(r.id);for(let e of i)this.addToMarkedInternal(e.id)}else 1===this.markedElementIds.length&&this.markedElementIds.includes(e)?this.unmarkAll():(this.usingTouchscreen||this.ctrlKeyHold||this.unmarkAll(),this.markedElementIds.includes(e)?(this.markedElementIds=this.markedElementIds.filter((t=>t!==e)),(0,t.A)("#"+e).removeClass("marked")):this.addToMarkedInternal(e))}),null,200,"MARK_ELEMENT")},addToMarkedInternal(e){e&&!this.markedElementIds.includes(e)&&(this.markedElementIds.push(e),(0,t.A)("#"+e).addClass("marked"))},highlightElement(){this.highlightId&&((0,t.A)(`#${this.highlightId}`).addClass("highlight"),setTimeout((()=>{(0,t.A)(`#${this.highlightId}`).removeClass("highlight")}),4e3))},async pasteElements(e=null){if(this.unmarkAll(),(e=e||await ee.Z.getGridElementsFromClipboard()).length){if(1===e.length){let t=e[0];t.width=1,t.height=1,t.x=void 0!==this.lastInteraction.x?this.lastInteraction.x:Ge.b.getHeightWithBounds(this.gridData),t.y=void 0!==this.lastInteraction.y?this.lastInteraction.y:0,this.gridData.gridElements.push(t),this.gridData.gridElements=ey.f.resolveCollisions(this.gridData.gridElements,t)}else if(ey.f.elementsCanBeInsertedAt(this.gridData,e,this.lastInteraction)){let t=ey.f.normalizePositions(e);for(let e of t)e.x+=this.lastInteraction.x,e.y+=this.lastInteraction.y;this.gridData.gridElements=this.gridData.gridElements.concat(t)}else{let t=Ge.b.getHeight(this.gridData),n=Math.min(...e.map((e=>e.y)));e=e.map((e=>(e.y+=t-n,e))),this.gridData.gridElements=this.gridData.gridElements.concat(e)}this.updateGridWithUndo()}},getElements(e=[]){return this.gridData.gridElements.filter((t=>e.includes(t.id)))},getElement(e){return this.gridData.gridElements.find((t=>t.id===e))},getElementIdsForAction(e=null){let t=this.markedElementIds;return e&&!this.markedElementIds.includes(e)&&(this.unmarkAll(),t=[e]),t},getElementsForAction(e=null){return this.getElements(this.getElementIdsForAction(e))},onInteracted(e,t){this.lastInteraction.x=e,this.lastInteraction.y=t},onClick(e){if(Tb&&!this.isInteracting){let n=(0,t.A)(e.target).closest(".element-container").attr("id");n?Tb.markElement(n):this.unmarkAll()}},onTouchstart(e){this.usingTouchscreen=!0,C.A.IS_SAFARI&&(this.touchstartTimeoutHandler=setTimeout((()=>{const n=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,screenX:e.touches[0].screenX,screenY:e.touches[0].screenY});let r=(0,t.A)(e.target).closest(".element-container")[0],i=(0,t.A)(e.target).closest("#grid-container")[0],o=r||i;o&&o.dispatchEvent(n)}),600))},onTouchEnd(){clearTimeout(this.touchstartTimeoutHandler)},onInteractStart(){this.isInteracting=!0,this.unmarkTimeoutHandler=setTimeout((()=>{this.unmarkAll()}),100)},onInteractEnd(){setTimeout((()=>{this.isInteracting=!1}),100),clearTimeout(this.unmarkTimeoutHandler)},onContextMenu(e){if(this.propTransferObject)return void e.preventDefault();let n=(0,t.A)(e.target).closest(".element-container").attr("id");n&&this.markedElementIds.includes(n)||this.unmarkAll(),this.addToMarkedInternal(n)},onKeyUp(){this.shiftKeyHold=!1,this.ctrlKeyHold=!1},onKeyDown(e){if(this.showMultipleModal||this.showGridSettingsModal||this.showNavigateModal||this.showTranslateModal||this.showPropTransferModal||this.showEditModal)return;const t=C.A.IS_MAC?e.metaKey:e.ctrlKey;this.ctrlKeyHold=t;const n="Z"===e.key.toLocaleUpperCase()||"KeyZ"===e.code;if(!e.repeat&&("Delete"===e.code&&(e.preventDefault(),this.removeElements()),"Enter"===e.key&&this.propTransferObject&&this.applyPropTransfer(),"Escape"===e.code&&(this.unmarkAll(),this.propTransferObject&&this.stopPropTransfer()),e.shiftKey&&(this.shiftKeyHold=!0),t)){if(e.shiftKey&&"KeyA"===e.code)return e.preventDefault(),void this.configPropTransferAll();if(e.shiftKey&&"KeyC"===e.code)return e.preventDefault(),void this.configPropTransferAppearance();if(e.shiftKey&&"KeyP"===e.code)return e.preventDefault(),void this.configPropTransfer();"KeyA"===e.code&&(e.preventDefault(),this.markAll()),"KeyB"===e.code&&(e.preventDefault(),this.configPropTransfer()),"KeyD"===e.code&&(e.preventDefault(),this.duplicateElements()),"KeyE"===e.code&&(e.preventDefault(),this.editElement()),"KeyC"===e.code&&(e.preventDefault(),this.copyElements()),"KeyX"===e.code&&(e.preventDefault(),this.cutElements()),"KeyV"===e.code&&(e.preventDefault(),this.pasteElements()),"KeyH"===e.code&&(e.preventDefault(),this.hideUnhideElements()),n&&!e.shiftKey&&(e.preventDefault(),this.undo()),n&&e.shiftKey&&(e.preventDefault(),this.redo()),"ArrowUp"===e.code&&(e.preventDefault(),this.moveAll(ey.f.DIR_UP)),"ArrowRight"===e.code&&(e.preventDefault(),this.moveAll(ey.f.DIR_RIGHT)),"ArrowDown"===e.code&&(e.preventDefault(),this.moveAll(ey.f.DIR_DOWN)),"ArrowLeft"===e.code&&(e.preventDefault(),this.moveAll(ey.f.DIR_LEFT))}}},created(){(0,t.A)(document).on(C.A.EVENT_DB_PULL_UPDATED,this.reloadFn),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)},mounted:async function(){j.pauseSync();let e=this;Tb=e;let t=await xg.getGrid(this.gridId);if(!t)return log.warn("grid not found! gridId: "+this.gridId),TA.toMain(),TA.toMain();e.gridData=JSON.parse(JSON.stringify(t)),Md.setCurrentGrid(e.gridData);let n=await xg.getMetadata();e.metadata=JSON.parse(JSON.stringify(n)),e.metadata.globalGridId!==e.gridData.id&&(e.metadata.lastOpenedGridId=e.gridData.id,await xg.saveMetadata(e.metadata)),kb(),e.showGrid=!0,e.highlightElement(),this.$nextTick((()=>{let e=document.getElementById("grid-container");e.addEventListener("click",this.onClick),e.addEventListener("touchstart",this.onTouchstart),e.addEventListener("touchmove",this.onTouchEnd),e.addEventListener("touchcancel",this.onTouchEnd),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("contextmenu",this.onContextMenu),Pm.initWithGrid(this.gridData),Tm.updateOnce({elements:this.gridData.gridElements})}))},beforeDestroy(){j.resumeSync(),(0,t.A)(document).off(C.A.EVENT_DB_PULL_UPDATED,this.reloadFn),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp);let e=document.getElementById("grid-container");e&&(e.removeEventListener("click",this.onClick),e.removeEventListener("touchstart",this.onTouchstart),e.removeEventListener("touchmove",this.onTouchEnd),e.removeEventListener("touchcancel",this.onTouchEnd),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("contextmenu",this.onContextMenu)),Tb=null,t.A.contextMenu("destroy")}};function kb(){var e={CONTEXT_NEW_GROUP:{name:o.A.t("new"),icon:"fas fa-plus-circle",items:{CONTEXT_NEW_SINGLE:{name:o.A.t("newElement"),icon:"fas fa-plus"},CONTEXT_NEW_MASS:{name:o.A.t("manyNewElements"),icon:"fas fa-clone"},CONTEXT_NEW_COLLECT:{name:o.A.t("newCollectElement"),icon:"fas fa-ellipsis-h"},CONTEXT_NEW_PREDICT:{name:o.A.t("newPredictionElement"),icon:"fas fa-magic"},CONTEXT_NEW_YT_PLAYER:{name:o.A.t("newYouTubePlayer"),icon:"fab fa-youtube"},CONTEXT_NEW_LIVE:{name:o.A.t("newLiveElement"),icon:"fas fa-star-of-life"},CONTEXT_NEW_MATRIX_CONVERSATION:{name:o.A.t("newMatrixConversation"),icon:"fas fa-comments"}}},CONTEXT_ACTION_PASTE:{name:o.A.t("paste"),icon:"far fa-clipboard"}};let n={CONTEXT_PROPERTY_TRANSFER_ALL:{name:o.A.t("transferAll"),icon:"fas fa-angle-double-right"},CONTEXT_PROPERTY_TRANSFER_APPEARANCE:{name:o.A.t("transferAppearance"),icon:"fas fa-angle-double-right"},CONTEXT_PROPERTY_TRANSFER:{name:o.A.t("transferCustom"),icon:"fas fa-angle-double-right"}},r=()=>Tb&&Tb.markedElementIds.length<=1,i={CONTEXT_ACTION_EDIT:{name:o.A.t("edit"),icon:"fas fa-edit",visible:r},CONTEXT_ACTION_DELETE:{name:o.A.t("delete"),icon:"far fa-trash-alt"},CONTEXT_ACTION_DUPLICATE:{name:o.A.t("clone"),icon:"far fa-clone"},CONTEXT_QUICK_HIDE:{name:o.A.t("hideUnhide"),icon:"fas fa-eye-slash"},TRANSFER_PROPS:{name:o.A.t("transferProperties"),icon:"fas fa-angle-double-right",items:n,visible:()=>Tb&&1===Tb.markedElementIds.length},SEP1:"---------",CONTEXT_ACTION_COPY:{name:o.A.t("copy"),icon:"far fa-copy"},CONTEXT_ACTION_CUT:{name:o.A.t("cut"),icon:"fas fa-cut"},CONTEXT_ACTION_PASTE:{name:o.A.t("paste"),icon:"far fa-clipboard"},separator:{type:"cm_separator",visible:r},CONTEXT_GRID_NAVIGATION:{name:o.A.t("navigateToOtherGrid"),icon:"fas fa-arrow-right",visible:r},CONTEXT_ACTION_DO_ACTION:{name:o.A.t("doElementAction"),icon:"fas fa-bolt",visible:r}},a={name:o.A.t("layout"),icon:"fas fa-th-large",items:{CONTEXT_LAYOUT_ALL_UP:{name:o.A.t("moveAllUp"),icon:"fas fa-angle-double-up"},CONTEXT_LAYOUT_ALL_RIGHT:{name:o.A.t("moveAllRight"),icon:"fas fa-angle-double-right"},CONTEXT_LAYOUT_ALL_DOWN:{name:o.A.t("moveAllDown"),icon:"fas fa-angle-double-down"},CONTEXT_LAYOUT_ALL_LEFT:{name:o.A.t("moveAllLeft"),icon:"fas fa-angle-double-left"},SEP1:"---------",CONTEXT_FILL_EMPTY:{name:o.A.t("fillWithEmptyElements"),icon:"fas fa-fill",disabled:()=>new c.D({},Tb.gridData).isFull()},CONTEXT_DELETE_ALL:{name:o.A.t("deleteAllElements"),icon:"fas fa-minus-circle"},CONTEXT_LAYOUT_NORMALIZE:{name:o.A.t("normalizeGridLayout"),icon:"fas fa-th"}}},s=()=>Tb.markedElementIds.length>=1;var l={SELECTED_ELEM_ACTIONS:{name:o.A.t("selectedElementsContextMenu"),icon:"far fa-square",visible:s,items:i},separator:{type:"cm_separator",visible:s},CONTEXT_NEW_GROUP:e.CONTEXT_NEW_GROUP,SEP0:"---------",CONTEXT_COPY_ALL:{name:o.A.t("copyAllElements"),icon:"fas fa-copy"},CONTEXT_ACTION_PASTE:{name:o.A.t("paste"),icon:"far fa-clipboard"},SEP1:"---------",CONTEXT_GROUP_LAYOUT:a,CONTEXT_GRID_SETTINGS:{name:o.A.t("gridSettings"),icon:"fas fa-expand-arrows-alt"},CONTEXT_GRID_TRANSLATION:{name:o.A.t("translateGrid"),icon:"fas fa-language"},CONTEXT_EDIT_GLOBAL_GRID:{name:o.A.t("editGlobalGrid"),icon:"fas fa-globe",visible:!!Tb.metadata.globalGridId&&Tb.metadata.globalGridActive&&Tb.metadata.globalGridId!==Tb.gridData.id},CONTEXT_END_EDIT_GLOBAL_GRID:{name:o.A.t("endEditGlobalGrid"),icon:"fas fa-globe",visible:Tb.metadata.globalGridId===Tb.gridData.id},SEP2:"---------",CONTEXT_SEARCH:{name:o.A.t("searchBtnTitle"),icon:"fas fa-search"}};let d="ORIGIN_MORE_BTN";function u(e,t,n){switch(e){case"CONTEXT_NEW_SINGLE":Tb.newElement(O.V.ELEMENT_TYPE_NORMAL,n!==d);break;case"CONTEXT_NEW_MASS":Tb.newElements();break;case"CONTEXT_NEW_COLLECT":Tb.newElement(O.V.ELEMENT_TYPE_COLLECT);break;case"CONTEXT_NEW_PREDICT":Tb.newElement(O.V.ELEMENT_TYPE_PREDICTION);break;case"CONTEXT_NEW_YT_PLAYER":Tb.newElement(O.V.ELEMENT_TYPE_YT_PLAYER);break;case"CONTEXT_NEW_LIVE":Tb.newElement(O.V.ELEMENT_TYPE_LIVE);break;case"CONTEXT_NEW_MATRIX_CONVERSATION":Tb.newElement(O.V.ELEMENT_TYPE_MATRIX_CONVERSATION);break;case"CONTEXT_COPY_ALL":Tb.copyAllElements();break;case"CONTEXT_DELETE_ALL":Tb.clearElements();break;case"CONTEXT_FILL_EMPTY":Tb.fillElements();break;case"CONTEXT_LAYOUT_ALL_UP":Tb.moveAll(ey.f.DIR_UP);break;case"CONTEXT_LAYOUT_ALL_RIGHT":Tb.moveAll(ey.f.DIR_RIGHT);break;case"CONTEXT_LAYOUT_ALL_DOWN":Tb.moveAll(ey.f.DIR_DOWN);break;case"CONTEXT_LAYOUT_ALL_LEFT":Tb.moveAll(ey.f.DIR_LEFT);break;case"CONTEXT_LAYOUT_NORMALIZE":Tb.normalizeGrid();break;case"CONTEXT_GRID_SETTINGS":Tb.showGridSettingsModal=!0;break;case"CONTEXT_GRID_TRANSLATION":Tb.showTranslateModal=!0;break;case"CONTEXT_PROPERTY_TRANSFER":Tb.configPropTransfer(t);break;case"CONTEXT_PROPERTY_TRANSFER_APPEARANCE":Tb.configPropTransferAppearance(t);break;case"CONTEXT_PROPERTY_TRANSFER_ALL":Tb.configPropTransferAll(t);break;case"CONTEXT_GRID_NAVIGATION":Tb.editElementId=t,Tb.unmarkAll(),Tb.showNavigateModal=!0;break;case"CONTEXT_ACTION_EDIT":Tb.editElement(t);break;case"CONTEXT_ACTION_DELETE":Tb.removeElements(t);break;case"CONTEXT_ACTION_DUPLICATE":Tb.duplicateElements(t);break;case"CONTEXT_QUICK_HIDE":Tb.hideUnhideElements(t);break;case"CONTEXT_ACTION_COPY":Tb.copyElements(t);break;case"CONTEXT_ACTION_CUT":Tb.cutElements(t);break;case"CONTEXT_ACTION_PASTE":Tb.pasteElements();break;case"CONTEXT_ACTION_DO_ACTION":gm.doAction(Tb.gridData.id,t),Tb.unmarkAll();break;case"CONTEXT_EDIT_GLOBAL_GRID":TA.toEditGrid(Tb.gridData.globalGridId||Tb.metadata.globalGridId);break;case"CONTEXT_END_EDIT_GLOBAL_GRID":TA.toEditGrid(Tb.metadata.lastOpenedGridId);break;case"CONTEXT_SEARCH":fg.showSearchModal()}}t.A.contextMenu({selector:".element-container",callback:function(e,n){u(e,(0,t.A)(this).attr("id"))},items:i,zIndex:100}),t.A.contextMenu({selector:"#grid-container",callback:function(e,t){u(e)},items:e,zIndex:100}),t.A.contextMenu({selector:"#moreButton",appendTo:"#moreButtonMenu",callback:function(e,t){u(e,null,d)},trigger:"left",items:l,zIndex:100})}const Ob=Ib;var Rb=s(8770),xb={};xb.styleTagTransform=Ed(),xb.setAttributes=gd(),xb.insert=vd().bind(null,"head"),xb.domAPI=hd(),xb.insertStyleElement=yd(),dd()(Rb.A,xb),Rb.A&&Rb.A.locals&&Rb.A.locals;const Nb=Cd(Ob,Uf,[],!1,null,"0beb9b93",null).exports;var Db=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"box",attrs:{id:"gridView"}},[e.metadata?t("header",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.fullscreen,expression:"!metadata.fullscreen"}],staticClass:"srow header",attrs:{role:"toolbar"}},[t("header-icon",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.locked,expression:"!metadata.locked"}],staticClass:"left"}),e._v(" "),t("div",{staticClass:"btn-group left"},[t("button",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.locked,expression:"!metadata.locked"}],staticClass:"spaced small",attrs:{tabindex:"30","aria-label":e.$t("editingOn")},on:{click:function(t){return e.toEditGrid()}}},[t("i",{staticClass:"fas fa-pencil-alt"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("editingOn")))])]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.locked,expression:"!metadata.locked"}],staticClass:"small",attrs:{tabindex:"31",id:"inputConfigButton","aria-label":e.$t("inputOptions")}},[t("i",{staticClass:"fas fa-cog"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("inputOptions")))])]),e._v(" "),t("div",{attrs:{id:"inputConfigMenu"}})]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.metadata.locked,expression:"metadata.locked"}],staticClass:"small",attrs:{tabindex:"34","aria-label":e.$t("unlock")},on:{click:function(t){return e.unlock()}}},[t("i",{staticClass:"fas fa-unlock"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("unlock")))]),e._v(" "),e.unlockCounter!==e.unlockCount?t("span",[e._v(e._s(e.unlockCounter))]):e._e()]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.locked,expression:"!metadata.locked"}],staticClass:"spaced small",attrs:{tabindex:"34","aria-label":e.$t("fullscreen"),title:e.$t("searchBtnTitle")},on:{click:function(t){return e.MainVue.showSearchModal()}}},[t("i",{staticClass:"fas fa-search"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("search")))])]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:!e.metadata.locked,expression:"!metadata.locked"}],staticClass:"small",attrs:{tabindex:"33","aria-label":e.$t("lock")},on:{click:function(t){return e.lock()}}},[t("i",{staticClass:"fas fa-lock"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("lock")))])]),e._v(" "),t("button",{staticClass:"spaced small",attrs:{tabindex:"32","aria-label":e.$t("fullscreen")},on:{click:function(t){return e.systemActionService.enterFullscreen()}}},[t("i",{staticClass:"fas fa-expand"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("fullscreen")))])])],1):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.renderGridData,expression:"!renderGridData"}],staticClass:"srow content text-content"},[e._m(0)]),e._v(" "),e.showModal===e.modalTypes.MODAL_HUFFMAN?t("huffman-input-modal",{on:{close:function(t){e.showModal=null,e.reloadInputMethods()}}}):e._e(),e._v(" "),e.showModal===e.modalTypes.MODAL_DIRECTION?t("direction-input-modal",{on:{close:function(t){e.showModal=null,e.reloadInputMethods()}}}):e._e(),e._v(" "),e.showModal===e.modalTypes.MODAL_MOUSE?t("mouse-modal",{on:{close:function(t){e.showModal=null,e.reloadInputMethods()}}}):e._e(),e._v(" "),e.showModal===e.modalTypes.MODAL_SCANNING?t("scanning-modal",{on:{close:function(t){e.showModal=null,e.reloadInputMethods()}}}):e._e(),e._v(" "),e.showModal===e.modalTypes.MODAL_SEQUENTIAL?t("sequential-input-modal",{on:{close:function(t){e.showModal=null,e.reloadInputMethods()}}}):e._e(),e._v(" "),e.showModal===e.modalTypes.MODAL_UNLOCK?t("unlock-modal",{on:{unlock:function(t){return e.unlock(!0)},close:function(t){e.showModal=null}}}):e._e(),e._v(" "),e.renderGridData&&0===e.renderGridData.gridElements.length?t("div",{staticClass:"srow content spaced"},[t("div",{staticStyle:{"margin-top":"2em"}},[t("i18n",{attrs:{path:"noElementsClickToEnterEdit",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[t("a",{attrs:{href:"#grid/edit/"+e.renderGridData.id}},[e._v(e._s(e.$t("editingOn")))])]},proxy:!0}],null,!1,2711095634)})],1)]):e._e(),e._v(" "),e.renderGridData&&e.renderGridData.gridElements.length>0?t("div",{staticClass:"srow content d-flex",staticStyle:{"min-height":"0"}},[t("app-grid-display",{attrs:{id:"grid-container","grid-data":e.renderGridData,metadata:e.metadata}})],1):e._e()],1)};Db._withStripped=!0;var Lb=function(e){if(e instanceof Node||e instanceof NodeList||e instanceof Array)return e;var t="querySelectorAll";return 0===e.indexOf("#")&&(t="getElementById",e=e.substr(1,e.length)),document[t](e)};function Pb(e){var t=e[0];if(e&&!(e.length<2))for(var n=1;n<e.length;n++){var r=e[n];Lb.selectAsList(r).forEach((function(e){e.style&&"none"===e.style.display?e.style.display=t:e.style.display="none"}))}}Lb.toggle=function(){var e=Array.prototype.slice.call(arguments);e.unshift("block"),Pb(e)},Lb.toggleInline=function(){var e=Array.prototype.slice.call(arguments);e.unshift("inline"),Pb(e)},Lb.isVisible=function(e){var t=Lb(e);return!(t.style&&"none"===t.style.display)},Lb.setVisible=function(e,t,n){Lb.selectAsList(e).forEach((function(e){e.style.display=0==t?"none":n||"block"}))},Lb.selectAsList=function(e){var t=Lb(e);return t instanceof Array?Lb.flattenArrayDeep(t):t instanceof NodeList?Array.prototype.slice.call(t):[t]},Lb.addClass=function(e,t){Lb.selectAsList(e).forEach((function(e){e.classList.contains(t)||e.classList.add(t)}))},Lb.removeClass=function(e,t){Lb.selectAsList(e).forEach((function(e){e.classList.remove(t)}))},Lb.removeAddClass=function(e,t){var n=Lb.selectAsList(e);Lb.removeClass(e,t),n.forEach((function(e){e.offsetWidth})),Lb.addClass(e,t)},Lb.toggleClass=function(e,t){Lb.selectAsList(e).forEach((function(e){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}))},Lb.setSelected=function(e,t){null==t&&(t=!0),Lb.selectAsList(e).forEach((function(e){t?Lb.addClass(e,"selected"):Lb.removeClass(e,"selected"),e.setAttribute("aria-selected",t)}))},Lb.setValue=function(e,t){Lb.selectAsList(e).forEach((function(e){e.value&&(e.value=t)}))},Lb.hasFocus=function(e){return Lb(e)==document.activeElement},Lb.val2key=function(e,t){for(var n in t)if(t[n]==e)return n;return!1},Lb.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},Lb.getIDSelector=function(e){return"#"+e},Lb.getPercentage=function(e,t,n){return Math.round((e-t)/(n-t)*100*1e3)/1e3},Lb.getMs=function(){return(new Date).getTime()},Lb.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},Lb.removeAllChildren=function(e){var t=Lb(e);(t=t instanceof NodeList?t:[t]).forEach((function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}))},Lb.createElement=function(e,t,n){var r=document.createElement(e);return r.className=t,n&&(n=n instanceof Array?n:[n]).forEach((function(e){"string"==typeof e?r.innerHTML+=e:r.appendChild(e)})),r},Lb.createSelectItems=function(e,t,n){for(var r="",i=t&&t.length==e.length,o=Lb.isFunction(t),a=0;a<e.length;a++){var s=o?t(e[a]):i?t[a]:Lb.translate(e[a]),l=Lb.createElement("option","",s);l.value=e[a],r+=l.outerHTML+"\n"}return n&&(r='<option value="-1" disabled selected hidden>'+Lb.translate("SELECT_SPECIAL_KEY")+"</option>\n"+r),r},Lb.isLang=function(e){return(navigator.userLanguage||navigator.language).indexOf(e)>-1},Lb.getLang=function(){return(navigator.userLanguage||navigator.language).substring(0,2)},Lb.translate=function(e){for(var t=i18n[e]?i18n[e]:e,n=1;n<arguments.length;n++)t=t.replace("{?}",arguments[n]);return t},Lb.getLastElement=function(e){return e.slice(-1)[0]},Lb.replaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},Lb.equalIgnoreCase=function(e,t){return e.toUpperCase()===t.toUpperCase()},Lb.loadScript=function(e,t){console.log("loading script: "+e);var n=document.createElement("script");return new Promise((function(r){n.onload=function(){console.log("loaded: "+e),r(!0)},n.onerror=function(){console.log("error loading: "+e),t?Lb.loadScript(t).then(r):r(!1)},n.src=e,document.head.appendChild(n)}))},Lb.flattenArray=function(e){return[].concat.apply([],e)},Lb.flattenArrayDeep=function(e){return e.reduce(((e,t)=>Array.isArray(t)?e.concat(Lb.flattenArrayDeep(t)):e.concat(t)),[])},Lb.convertToKeyCode=function(e){return/^[a-zA-Z0-9]$/.test(e)?e.toUpperCase().charCodeAt(0):null},Lb.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},window.L=Lb;let Mb={};function Ub(e,t,n){var r=this,i="",o=1e3,a=!1,s=3,l=3,c=!1,d=!0,u=1,h=!0,p=null;let v=function(){};var m=!1,g=null,f=null,y=null,_=!1,E=null,b=null;let S=Hc.instance(),C=Hc.instance(),w=null,A=0;function I(e){e&&(o=e.scanTimeoutMs||o,s=e.subScanRepeat||s,l=e.minBinarySplitThreshold||l,i=e.scanInactiveClass||i,a=null!=e.scanVertical?e.scanVertical:a,c=null!=e.scanBinary?e.scanBinary:c,d=null!=e.touchScanning?e.touchScanning:d,u=null!=e.scanTimeoutFirstElementFactor?e.scanTimeoutFirstElementFactor:u,h=void 0===e.autoScan||e.autoScan),d&&r.enableTouchScanning()}function k(e,t,n){var r=n?D:x,i=n?L:N,o=e[0],a=r(o),s=i(o);return e.filter((e=>a>r(e)&&a<i(e)||r(e)<s&&i(e)>s||r(e)>=a&&i(e)<=s))}function O(e){return function(t,n){return e(t)-e(n)}}function R(){var e=arguments;return function(t,n){for(var r=0;r<e.length;r++)if(Lb.isFunction(e[r])){var i=e[r](t,n);if(0!==i)return i}return 0}}function x(e){return e.getBoundingClientRect().top}function N(e){return e.getBoundingClientRect().bottom}function D(e){return e.getBoundingClientRect().left}function L(e){return e.getBoundingClientRect().right}function P(a,l){l=l||{},S.startListening(),a=a||[];let c=l.count||0,d=l.index||0,p=0===d;if(p=p||d>a.length-1,d=p?0:d,c>=s*a.length&&0!==A)r.restartScanning();else{if(n.scanStartWithAction&&c>=s*a.length&&0===A)return r.stopScanning(),void r.startScanning();if(v(Lb.flattenArray(a[d]),p,l.restarted),Lb.removeClass(e,t),Lb.addClass(e,i),m&&(Lb.addClass(a[d],t),Lb.removeClass(a,i),g=a[d],w=()=>{P(a,{index:d+1,count:c+1})},h)){let e=0===d&&a.length>2?o*u:o;f=setTimeout((function(){w()}),e)}}}function M(e){var t=[];e=e||[];var n=1;c&&e.length>l&&(n=Math.ceil(e.length/2));for(var r=0,i=e.length;r<i;r+=n){var o=e.slice(r,r+n);t.push(o)}return t}function U(t){if(!m){A=0;var n=Lb.selectAsList(e);if(0===n.length)return;var r=function(e,t){for(var n=t?D:x,r=t?L:N,i=t?x:D,o=R(O(n),function(e,t){return function(n,r){var i=Math.abs(t(n)-e(n));return Math.abs(t(r)-e(r))-i}}(n,r),(function(e,t){return e.id?e.id.localeCompare(t.id):t.id?-1*t.id.localeCompare(e.id):0})),a=R(O(i),O(n)),s=(e=e.sort(o)).slice(),l=[],d=0;s.length>0&&d<1e3;){d++;var u=k(s,0,t);l.push(u),s=s.filter((e=>!u.includes(e)))}return c&&(l=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=null,o=null;if(n-1>=0&&(i=e[n-1]),n+1<e.length&&(o=e[n+1]),1==r.length){var a=!o||i&&o&&i.length<o.length?i:o;a&&(r.forEach((function(e){a.push(e)})),t.push(r))}}return e.filter((e=>!t.includes(e)))}(l)),l.forEach((e=>e.sort(a))),l}(n,a);m=!0,1===r.length?P(M(Lb.flattenArray(r)),{restarted:t}):P(M(r),{restarted:t}),S.startListening()}}function F(){S.destroy(),S=Hc.instance(),n.inputEventSelect?S.onInputEvent(n.inputEventSelect,r.select):S.onInputEvent(new T.O({keyCode:32}),r.select),n.inputEventNext&&S.onInputEvent(n.inputEventNext,r.next)}r.startScanning=function(e){if(!e&&n.scanStartWithAction){function t(){C.destroy(),C=Hc.instance(),F(),U()}C.onInputEvent(n.inputEventSelect,t),C.onInputEvent(n.inputEventNext,t),C.startListening()}else F(),U()},r.stopScanning=function(){m=!1,f&&clearTimeout(f),Lb.removeClass(e,t),Lb.removeClass(e,i),S.stopListening(),C.stopListening()},r.destroy=function(){r.stopScanning(),r.disableTouchScanning(),S.destroy(),C.destroy()},r.restartScanning=function(){r.stopScanning(),U(!0)},r.pauseScanning=function(){m&&(r.stopScanning(),_=!0)},r.resumeScanning=function(){_&&(U(),_=!1)},r.updateOptions=function(e,t){t&&r.pauseScanning(),I(e),t&&r.resumeScanning()},r.setSelectionListener=function(e){Lb.isFunction(e)&&(p=e)},r.setActiveListener=function(e){Lb.isFunction(e)&&(v=e)},r.layoutChanged=function(e){e=e||1e3,m?(r.stopScanning(),y=setTimeout((function(){y=null,r.restartScanning()}),e)):y&&(clearTimeout(y),y=setTimeout((function(){y=null,r.restartScanning()}),e))},r.select=function(){m&&(r.stopScanning(),m=!0,A++,g.length>1?P(M(g)):Lb.flattenArray(g).length>1?P(M(Lb.flattenArray(g))):(p&&p(Lb.flattenArray(g)[0]),r.restartScanning()))},r.next=function(){w&&(clearTimeout(f),w())},r.enableTouchScanning=function(){E||(E=function(){r.select()},(b=Lb(".area")[0]?Lb(".area")[0]:Lb("#grid-container")).addEventListener("click",E))},r.disableTouchScanning=function(){E&&(b.removeEventListener("click",E),E=null)},I(n)}Mb.getInstanceFromConfig=function(e,t,n,r){return new Ub(t,n,{autoScan:e.scanAuto,scanVertical:e.scanVertical,subScanRepeat:e.scanRoundsUntilBack,scanBinary:e.scanBinary,scanInactiveClass:r,minBinarySplitThreshold:3,scanTimeoutMs:e.scanTimeoutMs,scanTimeoutFirstElementFactor:e.scanTimeoutFirstElementFactor,touchScanning:!1,inputEventSelect:e.scanInputs.filter((e=>e.label===A.R.SELECT))[0],inputEventNext:e.scanInputs.filter((e=>e.label===A.R.NEXT))[0],scanStartWithAction:e.scanStartWithAction})};let Fb={};function Bb(e,n){var r=this,i=e,a=void 0!==n.timeoutMs?n.timeoutMs:1e3;let s=n.demoMode,l=n.selectionListener,c=n.activeListener;var d={};let u=[],h=null,p=null,v=!1,m=null;function g(e,t){var n=t||this;e.preventDefault(),A(n),h=n,p=e}function f(e,t){if(v){var n=t||this;e.preventDefault(),T(n)}}function y(e){v||k(!1),ee.Z.debounce((()=>{k(!0)}),a+300,"hovering-mouseMove")}function _(){T(h)}function E(e){let t=I(e);A(t),h=t}function b(e){T(h)}function S(e){s||e.preventDefault(),ee.Z.throttle((()=>{let t=I(e);A(t),h=t,p=e}),[],50,"hovering-touchmove")}function w(e){su.speak(o.A.t("speechOutputActivated")),fg.clearTooltip(),Md.setState(C.A.STATE_ACTIVATED_TTS,!0),k(!0),u.forEach((function(e){e.removeEventListener("click",w)}))}function A(e){h&&h!==e&&T(h),e&&!d[e]&&(Lb.addClass(e,"mouseentered"),c&&e!==h&&c(e),0!==a&&(d[e]=setTimeout((function(){l&&l(e)}),a)))}function T(e){e&&(Lb.removeClass(e,"mouseentered"),clearTimeout(d[e]),d[e]=null,h=null)}function I(e){if(e.touches&&0===e.touches.length&&(e=p),!e)return void log.warn("no event");let t=e.touches?e.touches[0].pageX:e.pageX||e.clientX,n=e.touches?e.touches[0].pageY:e.pageY||e.clientY;return ee.Z.getElement(u,t,n)}function k(e){v=!e,s||(e?(0,t.A)("#touchElement").show():(0,t.A)("#touchElement").hide())}r.startHovering=function(){n.hideCursor&&(0,t.A)("#touchElement").css("cursor","none"),u=Lb.selectAsList(i);let e=Md.getState(C.A.STATE_ACTIVATED_TTS);!su.nativeSpeechSupported()||e||s?k(!0):(fg.setTooltip(o.A.t("tapOnAnyElementToActivateSpeech")),Md.onStateChanged(C.A.STATE_ACTIVATED_TTS,(e=>{e&&fg.clearTooltip()})),u.forEach((function(e){e.addEventListener("click",w)}))),u.forEach((function(e){e.addEventListener("mouseenter",g),e.addEventListener("mouseleave",f),e.addEventListener("mouseup",_)})),m=Hc.instance(),m.onTouchStart(E),m.onTouchEnd(b),m.onTouchMove(S),m.startListening(),document.addEventListener("mousemove",y)},r.destroy=function(){n.hideCursor&&(0,t.A)("#touchElement").css("cursor","default"),ee.Z.clearDebounce("hovering-mouseMove"),u.forEach((function(e){e.removeEventListener("mouseenter",g),e.removeEventListener("mouseleave",f),e.removeEventListener("mouseup",_),e.removeEventListener("click",w)})),m.destroy(),document.removeEventListener("mousemove",y),Object.keys(d).forEach((e=>{clearTimeout(d[e])})),Md.clearListeners(C.A.STATE_ACTIVATED_TTS)},r.setHoverTimeout=function(e){a=e},r.setSelectionListener=function(e){l=e}}Fb.getInstanceFromConfig=function(e,t,n){return new Bb(t,{selectionListener:(n=n||{}).selectionListener,activeListener:n.activeListener,containerClass:n.containerClass,inputEventSelect:e.seqInputs.filter((e=>e.label===A.R.SELECT))[0],inputEventNext:e.seqInputs.filter((e=>e.label===A.R.NEXT))[0],timeoutMs:e.hoverTimeoutMs,demoMode:n.demoMode||e.hoverDisableHoverpane,hideCursor:e.hoverHideCursor})};let Gb={};function $b(e,t){t=t||{};let n=this,r=e,i=null,o=[],a=0;function s(e){(new Date).getTime()-a<100||(a=(new Date).getTime(),i&&i(e.currentTarget))}function l(e){su.hasSpoken()||"mousedown"!==e.type?(su.hasSpoken()&&e.preventDefault(),"mousedown"===e.type&&0===e.buttons||s(e)):s(e)}function c(e){i&&i(e.currentTarget)}function d(e){let t=e.which||e.keyCode;13!==t&&32!==t||i&&i(e.currentTarget)}n.startClickcontrol=function(){o=Lb.selectAsList(r),o.forEach((function(e){t.useSingleClick&&t.useMousedownEvent?(e.addEventListener("mousedown",l),e.addEventListener("touchstart",l)):t.useSingleClick&&e.addEventListener("click",s),t.useDoubleclick&&e.addEventListener("dblclick",c),e.addEventListener("keydown",d)}))},n.destroy=function(){o.forEach((function(e){e.removeEventListener("mousedown",l),e.removeEventListener("touchstart",l),e.removeEventListener("click",s),e.removeEventListener("dblclick",c),e.removeEventListener("keydown",d)}))},n.setSelectionListener=function(e){i=e}}Gb.getInstanceFromConfig=function(e,t){return new $b(t,{useMousedownEvent:e.mouseDownInsteadClick,useDoubleclick:e.mouseDoubleClickEnabled,useSingleClick:e.mouseclickEnabled})};var Vb=s(1906),jb=s.n(Vb);let Kb={},Wb=null;function qb(e,n,r,i){let o=this,a=e,s=n,l=r,c=!1,d=!0,u=!1,h=0,p=1e3,v=!0,m=[],g=null,f=null,y=null,_=null,E="",b=null,S="",C=!1,w=null,A=[];function T(){if(b=Hc.instance(),S="",function(e){e&&e.inputEvents&&e.inputEvents.length&&!(e.inputEvents.length<2)?(t.A.isFunction(e.selectionListener)&&(g=e.selectionListener),c=void 0!==e.printCodes&&e.printCodes,d=void 0===e.printColors||e.printColors,u=void 0!==e.colorWholeElement&&e.colorWholeElement,v=void 0===e.markInactive||e.markInactive,m=e.colors||m,h=e.elementCount||0,p=e.timeout||1e3,e.inputEvents.forEach(((e,t)=>{S+=t+1,b.onInputEvent(e,(()=>{o.input(t+1)}))}))):log.warn("huffman input: invalid options")}(i),f=(0,t.A)(a),0===f.length)return;let e=f.toArray().map((e=>e.id));if(e.length<h){let t=h-e.length;for(let n=0;n<t;n++)e.push(null)}_=e.map((function(e,t){return{name:e,weight:1e4-t,codeWord:null}}));let n=jb().createTree(_,S.length),r=0;n.assignCodeWords(S,(function(e,t){r=t.length>r?t.length:r})),n.assignCodeWords(S,(function(e,n){if(e.name&&(e.codeWord=n,e.element=document.getElementById(e.name),d||c)){let n="";e.codeWord.split("").forEach((e=>{let t=d?O(e):"",i=xu.getHighContrastColor(t);n+=`<span style="background-color: ${t}; color: ${i}; width: ${(100-5*r)/r+"%"}; display: inline-block; margin: 0 1%; border-radius: 5px; border: 1px solid whitesmoke; text-align: center">${c?e:"&nbsp;"}</span>`}));let i=function(e){let t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}(`<div class="huffman-code-visualization" style="font-size:${c?"10px":"3px"}; display:flex; align-items: center; justify-content: center; position: absolute; bottom: 0; width: ${(0,t.A)(e.element).width()+"px"}">${n}</div>`);(0,t.A)(e.element).append(i),A.push(i)}})),_=_.filter((e=>e.name)),I()}function I(){u&&_.forEach((e=>{if(0===e.codeWord.indexOf(E)){let t=e.codeWord.substring(E.length)[0];e.element.style.background=O(t)}}))}function k(e){f.removeClass(l);let n=e.map((e=>e.id)),r=f.toArray().filter((e=>-1===n.indexOf(e.id)));(0,t.A)(r).addClass(l)}function O(e){let t=parseInt(e)-1;return m[t]}o.start=function(){C=!0,u&&(0,t.A)(f).addClass("noanimation"),b.startListening()},o.stop=function(){C=!1,(0,t.A)(f).find(".huffman-code-visualization").remove(),u&&((0,t.A)(f).removeClass("noanimation"),(0,t.A)(f).css("background","")),f.removeClass(s),b.stopListening()},o.onDestroy=function(e){Wb=e},o.destroy=function(){o.stop(),A.forEach((e=>e.remove())),Wb&&(Wb(),Wb=null),b.destroy()},o.reinit=function(){C&&(o.stop(),T(),o.start())},o.input=function(e){if(e+="",clearTimeout(w),1!==e.length)return;E+=e,I();let n=_.filter((e=>e.codeWord===E)).map((e=>e.element)),r=_.filter((e=>0===e.codeWord.indexOf(E))).map((e=>e.element));var i;f.removeClass(s),n[0]?(i=n[0],y=i||y,f.removeClass(s),(0,t.A)(y).addClass(s),k(f.toArray()),g&&g(n[0])):v&&k(r),(n[0]||0===r.length)&&(k(f.toArray()),E="",I()),p>0&&(w=setTimeout((()=>{k(f.toArray()),E="",I()}),p))},o.getCurrentInput=function(){return E},T()}Kb.getInstanceFromConfig=function(e,t,n,r,i){return new qb(t,n,r,{printCodes:e.huffShowNumbers,printColors:e.huffShowColors,colorWholeElement:e.huffColorWholeElement,colors:e.huffColors,inputEvents:e.huffInputs,elementCount:e.huffElementCount,timeout:e.huffTimeout,markInactive:e.huffMarkInactive,selectionListener:i})};let Hb={};function Yb(e,n,r){let i=this,o=e,a=n,s=!0,l=!1,c=null,d=null,u=null,h={},p=Hc.instance();function v(e){h[u.id]&&m(h[u.id][e])}function m(e){u=e||u,d.removeClass(a),(0,t.A)(u).addClass(a)}i.start=function(){m(d[0]),p.startListening()},i.destroy=function(){d.removeClass(a),p.destroy()},i.left=function(){v("left")},i.right=function(){v("right")},i.up=function(){v("up")},i.down=function(){v("down")},i.select=function(){c&&c(u),l&&m(d[0])},d=(0,t.A)(o),0!==d.length&&(setTimeout((()=>{d.toArray().forEach((e=>{let t=d.toArray().filter((t=>t.id!==e.id)),n=e.getBoundingClientRect(),r=(e,t,n,r)=>e>0&&t>0&&n>0&&r>0,i=(e,t,n,r)=>e<0&&t<0&&n<0&&r<0,o=t.map((e=>{let t=e.getBoundingClientRect(),o=n.left-t.right,a=n.right-t.left,s=n.right-t.right,l=n.left-t.left,c=n.top-t.bottom,d=n.bottom-t.top,u=n.top-t.top,h=n.bottom-t.bottom,p=Math.min(Math.abs(o),Math.abs(a),Math.abs(s),Math.abs(l)),v=Math.min(Math.abs(c),Math.abs(d),Math.abs(u),Math.abs(h));return{element:e,left:r(o,a,s,l),right:i(o,a,s,l),up:r(c,d,u,h),down:i(c,d,u,h),absDiffX:p,absDiffY:v,absDiff:p+v}}));function a(e,t,n,r,i){let o=e.filter((e=>e[t]));if(o.length>0)return o[0].element;if(s){let t=Math.min(...e.map((e=>e[i]))),o=e.filter((e=>e[i]===t&&e[n])),a=Math.max(...o.map((e=>e[r]))),s=o.filter((e=>e[r]===a))[0];return s?s.element:null}return null}o=o.sort(((e,t)=>e.absDiff-t.absDiff));let l=a(o,"left","right","absDiffX","absDiffY"),c=a(o,"right","left","absDiffX","absDiffY"),u=a(o,"up","down","absDiffY","absDiffX"),p=a(o,"down","up","absDiffY","absDiffX");h[e.id]={element:e,left:l,right:c,up:u,down:p}}))}),200),function(e){e&&(t.A.isFunction(e.selectionListener)&&(c=e.selectionListener),s=void 0!==e.wrapAround&&e.wrapAround,l=void 0!==e.resetToStart&&e.resetToStart,p.onInputEvent(e.inputEventLeft,i.left),p.onInputEvent(e.inputEventRight,i.right),p.onInputEvent(e.inputEventUp,i.up),p.onInputEvent(e.inputEventDown,i.down),p.onInputEvent(e.inputEventSelect,i.select))}(r))}Hb.getInstanceFromConfig=function(e,t,n,r){return new Yb(t,n,{inputEventLeft:e.dirInputs.filter((e=>e.label===A.R.LEFT))[0],inputEventRight:e.dirInputs.filter((e=>e.label===A.R.RIGHT))[0],inputEventUp:e.dirInputs.filter((e=>e.label===A.R.UP))[0],inputEventDown:e.dirInputs.filter((e=>e.label===A.R.DOWN))[0],inputEventSelect:e.dirInputs.filter((e=>e.label===A.R.SELECT))[0],wrapAround:e.dirWrapAround,resetToStart:e.dirResetToStart,selectionListener:r})};let zb={};function Jb(e){let n=this;if(!e||!e.inputEventSelect||!e.inputEventNext)return void log.warn("missing parameters for instantiating sequential input");e.firstElementFactor=e.firstElementFactor||1,e.activeClass=e.activeClass||"scanFocus";let r=(0,t.A)(e.itemSelector),i=Hc.instance(),o=Hc.instance(),a=0,s=0,l=null;function c(){i.startListening(),u(r[0],!0),a=0,d()}function d(){if(e.enableAuto){let t=e.autoTimeout||1e3,i=0===a?e.firstElementFactor:1;0===a&&s++,clearTimeout(l),l=setTimeout((()=>{if(e.startWithAction&&e.roundsUntilStop&&s===e.roundsUntilStop&&a===r.length-1)return s=0,n.stop(),void n.start();n.next()}),t*i)}}function u(n,i){r.removeClass(e.activeClass),(0,t.A)(n).addClass(e.activeClass),e.activeListener&&e.activeListener(n,i)}function h(){i.destroy(),i=Hc.instance(),i.onInputEvent(e.inputEventSelect,n.select),i.onInputEvent(e.inputEventNext,n.next),i.onInputEvent(e.inputEventPrev,n.prev)}n.start=function(t){if(e.startWithAction&&!t){function n(){o.destroy(),o=Hc.instance(),h(),c()}o.onInputEvent(e.inputEventSelect,n),o.onInputEvent(e.inputEventNext,n),o.onInputEvent(e.inputEventPrev,n),o.startListening()}else h(),c()},n.stop=function(){clearTimeout(l),r.removeClass(e.activeClass),i.stopListening(),o.stopListening()},n.destroy=function(){n.stop(),i.destroy(),o.destroy(),r.removeClass(e.activeClass)},n.next=function(){a++;let e=!1;a>r.length-1&&(a=0,e=!0),u(r[a],e),d()},n.prev=function(){a--;let e=!1;a<0&&(a=r.length-1,e=!0),u(r[a],e)},n.select=function(){e.selectionListener&&e.selectionListener(r[a]),e.resetAfterSelect&&(n.stop(),c())}}zb.getInstanceFromConfig=function(e,t){return new Jb({itemSelector:t.itemSelector,selectionListener:t.selectionListener,activeListener:t.activeListener,activeClass:t.activeClass,inputEventSelect:e.seqInputs.filter((e=>e.label===A.R.SELECT))[0],inputEventNext:e.seqInputs.filter((e=>e.label===A.R.NEXT_ELEMENT))[0],inputEventPrev:e.seqInputs.filter((e=>e.label===A.R.PREVIOUS_ELEMENT))[0],enableAuto:e.seqAuto,autoTimeout:e.seqTimeoutMs,firstElementFactor:e.seqTimeoutFirstElementFactor,resetAfterSelect:e.seqResetToStart,startWithAction:e.seqStartWithAction,roundsUntilStop:e.seqRoundsUntilStop})};var Xb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.cancel():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("scanning"))+"\n                    ")])]),e._v(" "),e.inputConfig?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("span",[e._v(e._s(e.$t("scanningInputMethod12InputEvents")))]),e._v(" "),t("a",{attrs:{"aria-label":e.$t("help"),href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas blue fa-question-circle"})])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.scanEnabled,expression:"inputConfig.scanEnabled"}],attrs:{type:"checkbox",id:"enableScanning"},domProps:{checked:Array.isArray(e.inputConfig.scanEnabled)?e._i(e.inputConfig.scanEnabled,null)>-1:e.inputConfig.scanEnabled},on:{change:function(t){var n=e.inputConfig.scanEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"scanEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"scanEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"scanEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableScanning"}},[e._v(e._s(e.$t("enableScanning")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.scanEnabled,expression:"inputConfig.scanEnabled"}]},[t("accordion",{staticClass:"srow",attrs:{"acc-label":e.$t("input"),"acc-open":"true","acc-label-type":"h2","acc-background-color":"white"}},[t("input-event-list",{attrs:{"input-labels":[e.InputConfig.SELECT,e.InputConfig.NEXT],"error-inputs":e.errorInputs},on:{input:e.inputChanged},model:{value:e.inputConfig.scanInputs,callback:function(t){e.$set(e.inputConfig,"scanInputs",t)},expression:"inputConfig.scanInputs"}}),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"twelve columns",on:{click:e.resetInput}},[e._v(e._s(e.$t("resetToDefaultInputConfiguration")))])])],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("ADVANCED_SETTINGS"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow",staticStyle:{"margin-top":"0"}},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.scanVertical,expression:"inputConfig.scanVertical"}],attrs:{type:"checkbox",id:"chkVerticalScanning"},domProps:{checked:Array.isArray(e.inputConfig.scanVertical)?e._i(e.inputConfig.scanVertical,null)>-1:e.inputConfig.scanVertical},on:{change:function(t){var n=e.inputConfig.scanVertical,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"scanVertical",n.concat([null])):o>-1&&e.$set(e.inputConfig,"scanVertical",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"scanVertical",i)}}}),e._v(" "),t("label",{attrs:{for:"chkVerticalScanning"}},[e._v(e._s(e.$t("verticalScanning")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.scanBinary,expression:"inputConfig.scanBinary"}],attrs:{type:"checkbox",id:"chkBinaryScanning"},domProps:{checked:Array.isArray(e.inputConfig.scanBinary)?e._i(e.inputConfig.scanBinary,null)>-1:e.inputConfig.scanBinary},on:{change:function(t){var n=e.inputConfig.scanBinary,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"scanBinary",n.concat([null])):o>-1&&e.$set(e.inputConfig,"scanBinary",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"scanBinary",i)}}}),e._v(" "),t("label",{attrs:{for:"chkBinaryScanning"}},[e._v(e._s(e.$t("binaryScanning")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.scanStartWithAction,expression:"inputConfig.scanStartWithAction"}],attrs:{type:"checkbox",id:"chkStartWithAction"},domProps:{checked:Array.isArray(e.inputConfig.scanStartWithAction)?e._i(e.inputConfig.scanStartWithAction,null)>-1:e.inputConfig.scanStartWithAction},on:{change:function(t){var n=e.inputConfig.scanStartWithAction,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"scanStartWithAction",n.concat([null])):o>-1&&e.$set(e.inputConfig,"scanStartWithAction",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"scanStartWithAction",i)}}}),e._v(" "),t("label",{attrs:{for:"chkStartWithAction"}},[e._v(e._s(e.$t("startManuallyByUserInputEvent")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("roundsUntilGoingBack"),id:"roundsUntilBack",min:"1",max:"10",step:"1",decimals:"0",default:"3"},model:{value:e.inputConfig.scanRoundsUntilBack,callback:function(t){e.$set(e.inputConfig,"scanRoundsUntilBack",e._n(t))},expression:"inputConfig.scanRoundsUntilBack"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.scanAuto,expression:"inputConfig.scanAuto"}],attrs:{type:"checkbox",id:"chkAutoScanning"},domProps:{checked:Array.isArray(e.inputConfig.scanAuto)?e._i(e.inputConfig.scanAuto,null)>-1:e.inputConfig.scanAuto},on:{change:function(t){var n=e.inputConfig.scanAuto,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"scanAuto",n.concat([null])):o>-1&&e.$set(e.inputConfig,"scanAuto",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"scanAuto",i)}}}),e._v(" "),t("label",{attrs:{for:"chkAutoScanning"}},[e._v(e._s(e.$t("automaticTimedScanning")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.scanAuto,expression:"inputConfig.scanAuto"}],staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("scanningTimeMs"),id:"inScanTime",min:"100",max:"10000",step:"100",decimals:"0"},model:{value:e.inputConfig.scanTimeoutMs,callback:function(t){e.$set(e.inputConfig,"scanTimeoutMs",e._n(t))},expression:"inputConfig.scanTimeoutMs"}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.scanAuto,expression:"inputConfig.scanAuto"}],staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("timeFactorFirstElement"),id:"inFirstElement",min:"1",max:"5",step:"0.1",decimals:"1"},model:{value:e.inputConfig.scanTimeoutFirstElementFactor,callback:function(t){e.$set(e.inputConfig,"scanTimeoutFirstElementFactor",e._n(t))},expression:"inputConfig.scanTimeoutFirstElementFactor"}})],1)]),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("generalInputSettings"),"acc-label-type":"h2","acc-background-color":"white"}},[t("global-input-options",{attrs:{"input-config":e.inputConfig}})],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("TEST_CONFIGURATION"),"acc-label-type":"h2","acc-background-color":"white"},on:{open:function(t){e.testOpen=!0,e.initTest()},close:function(t){e.testOpen=!1,e.stopTest()}}},[t("test-area",{attrs:{"selected-element":e.selectedTestElement}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"warn"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+"\n                        ")])],1)]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container row"},[t("button",{staticClass:"four columns offset-by-four",on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};Xb._withStripped=!0;var Qb=function(){var e=this,t=e._self._c;return t("div",[t("ul",e._l(e.inputs,(function(n,r){return t("li",[t("div",{staticClass:"srow nomargin"},[t("label",{staticClass:"three columns input-label",attrs:{for:n.label+r}},[t("span",[e._v(e._s(e._f("translate")(n.label)))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.label===e.InputConfig.GENERAL_INPUT,expression:"input.label === InputConfig.GENERAL_INPUT"}]},[e._v(e._s(r+1))])]),e._v(" "),t("select",{staticClass:"five columns",attrs:{id:n.label+r},on:{change:function(t){return e.typeChange(r,t.target.value)}}},[t("option",{attrs:{value:""}},[t("span",[e._v(e._s(e.$t("notDefined")))])]),e._v(" "),e._l(e.inputEventTypes,(function(r){return t("option",{domProps:{value:r.getModelName(),selected:r.getModelName()===n.modelName}},[e._v("\n                        "+e._s(e._f("translate")(r.getModelName()))+"\n                    ")])}))],2),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.errorInputs.indexOf(n.label)>-1,expression:"errorInputs.indexOf(input.label) > -1"}],staticClass:"two columns"},[t("i",{staticClass:"warn fas fa-exclamation-triangle"})])]),e._v(" "),n.modelName===e.InputEventKey.getModelName()?t("div",[t("div",{staticClass:"srow"},[t("button",{staticClass:"five columns offset-by-three",on:{click:function(t){return e.recordKey(n,r)}}},[t("i",{staticClass:"fas fa-keyboard"}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.keyRecording[n.label+r],expression:"!keyRecording[input.label+index]"}]},[e._v(e._s(e.$t("recordKey")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.keyRecording[n.label+r],expression:"keyRecording[input.label+index]"}]},[e._v(e._s(e.$t("pressKey")))])]),e._v(" "),t("span",{staticClass:"four columns"},[t("b",[e._v(e._s(e.$t("currentKey")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!n.keyCode,expression:"!input.keyCode"}]},[e._v(e._s(e.$t("noKey")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.keyCode&&e.InputEventKey.SPECIAL_KEYS.includes(n.keyCode),expression:"input.keyCode && InputEventKey.SPECIAL_KEYS.includes(input.keyCode)"}]},[e._v(e._s(e._f("translate")(n.keyCode)))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.keyCode&&!e.InputEventKey.SPECIAL_KEYS.includes(n.keyCode),expression:"input.keyCode && !InputEventKey.SPECIAL_KEYS.includes(input.keyCode)"}]},[e._v(e._s(n.keyName+" ("+n.keyCode+")"))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("accordion",{staticClass:"nine columns offset-by-three",attrs:{"acc-label":e.$t("more")}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"one-third column",attrs:{for:"inTimeout"+r}},[e._v(e._s(e.$t("timeoutMs")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:n.timeout,expression:"input.timeout",modifiers:{number:!0}}],staticClass:"two-thirds column",attrs:{id:"inTimeout"+r,type:"number",min:"0",max:"5000",step:"100"},domProps:{value:n.timeout},on:{input:[function(t){t.target.composing||e.$set(n,"timeout",e._n(t.target.value))},e.modelChanged],blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"one-third column",attrs:{for:"inRepeat"+r}},[e._v(e._s(e.$t("repetitions")))]),e._v(" "),t("input",{directives:[{name:"show",rawName:"v-show",value:0===n.holdDuration,expression:"input.holdDuration === 0"},{name:"model",rawName:"v-model.number",value:n.repeat,expression:"input.repeat",modifiers:{number:!0}}],staticClass:"two-thirds column",attrs:{id:"inRepeat"+r,type:"number",min:"1",max:"9"},domProps:{value:n.repeat},on:{input:[function(t){t.target.composing||e.$set(n,"repeat",e._n(t.target.value))},e.modelChanged],blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.holdDuration>0,expression:"input.holdDuration > 0"}],staticClass:"two-thirds column"},[t("span",[e._v(e._s(e.$t("disabledIfHoldDurationIsSet")))]),e._v(" "),t("a",{attrs:{href:"javascript:;"},on:{click:function(t){n.holdDuration=0,e.modelChanged()}}},[e._v(e._s(e.$t("enable")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"one-third column",attrs:{for:"inRepeat"+r}},[e._v(e._s(e.$t("holdDurationMs")))]),e._v(" "),t("input",{directives:[{name:"show",rawName:"v-show",value:1===n.repeat,expression:"input.repeat === 1"},{name:"model",rawName:"v-model.number",value:n.holdDuration,expression:"input.holdDuration",modifiers:{number:!0}}],staticClass:"two-thirds column",attrs:{id:"inRepeat"+r,type:"number",min:"0",max:"5000",step:"100",disabled:n.repeat>1},domProps:{value:n.holdDuration},on:{input:[function(t){t.target.composing||e.$set(n,"holdDuration",e._n(t.target.value))},e.modelChanged],blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.repeat>1,expression:"input.repeat > 1"}],staticClass:"two-thirds column"},[t("span",[e._v(e._s(e.$t("disabledIfRepetitionsAreSet")))]),e._v(" "),t("a",{attrs:{href:"javascript:;"},on:{click:function(t){n.repeat=1,e.modelChanged()}}},[e._v(e._s(e.$t("enable")))])])])])],1)]):e._e(),e._v(" "),n.modelName===e.InputEventAudio.getModelName()?t("div",[t("div",{staticClass:"srow"},[t("button",{staticClass:"five columns offset-by-three",on:{click:e.toggleMicRecording}},[e.micRecording?e._e():t("span",[t("span",{staticClass:"fas fa-microphone"}),e._v(" "),t("span",[e._v(e._s(e.$t("startListeningToMicrophone")))])]),e._v(" "),e.micRecording?t("span",[t("span",{staticClass:"fas fa-microphone-slash"}),e._v(" "),t("span",[e._v(e._s(e.$t("stopListening")))])]):e._e()])]),e._v(" "),e.micRecordError?t("div",{staticClass:"srow"},[t("span",{staticClass:"five columns offset-by-three"},[t("span",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("pleaseAllowAccessingMicrophoneInOrderToRecordAudio")))]),e._v(".\n                    ")])]):e._e(),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"nine columns offset-by-three"},[t("h3",{staticClass:"mt-0"},[e._v(e._s(e.$t("volume")))]),e._v(" "),t("div",[t("label",{attrs:{for:"volThresholdHigh"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("volume")))]),e._v(e._s(e.$t("thresholdHigh")))])]),e._v(" "),t("div",{staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:n.volThresholdHigh,expression:"input.volThresholdHigh",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"volThresholdHigh"+r,type:"range",min:"0.1",max:e.getMicVolMaxRange(n),step:"0.1"},domProps:{value:n.volThresholdHigh},on:{input:function(t){e.validateChange(n,!0),e.modelChanged()},__r:function(t){e.$set(n,"volThresholdHigh",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(n.volThresholdHigh.toFixed(1))+" %")])]),e._v(" "),t("div",[t("label",{attrs:{for:"currentValue"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("volume")))]),e._v(e._s(e.$t("currentValue")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.micRecording,expression:"micRecording"}],staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.micValues.volLive,expression:"micValues.volLive",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"currentValue"+r,type:"range",min:"0.1",max:e.getMicVolMaxRange(n),step:"0.1",disabled:""},domProps:{value:e.micValues.volLive},on:{__r:function(t){e.$set(e.micValues,"volLive",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s((Math.round(100*e.micValues.volLive)/100).toFixed(1))+" %")])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.micRecording,expression:"!micRecording"}],staticClass:"srow mb-4 mt-0"},[e._v(e._s(e.$t("currentlyNotListeningToMicrophone")))]),e._v(" "),t("div",[t("label",{attrs:{for:"volThresholdLow"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("volume")))]),e._v(e._s(e.$t("thresholdLow")))])]),e._v(" "),t("div",{staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:n.volThresholdLow,expression:"input.volThresholdLow",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"volThresholdLow"+r,type:"range",min:"0.1",max:e.getMicVolMaxRange(n),step:"0.1"},domProps:{value:n.volThresholdLow},on:{input:function(t){e.validateChange(n,!1),e.modelChanged()},__r:function(t){e.$set(n,"volThresholdLow",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(n.volThresholdLow.toFixed(1))+" %")])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"nine columns offset-by-three"},[t("h3",{staticClass:"mt-0"},[e._v(e._s(e.$t("frequency")))]),e._v(" "),t("div",[t("label",{attrs:{for:"freqThresholdHigh"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("frequency")))]),e._v(e._s(e.$t("thresholdHigh")))])]),e._v(" "),t("div",{staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:n.freqThresholdHigh,expression:"input.freqThresholdHigh",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"freqThresholdHigh"+r,type:"range",min:"0",max:e.getMicFreqMaxRange(n),step:"100"},domProps:{value:n.freqThresholdHigh},on:{input:function(t){e.validateChange(n,!0),e.modelChanged()},__r:function(t){e.$set(n,"freqThresholdHigh",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(n.freqThresholdHigh)+" Hz")])]),e._v(" "),t("div",[t("label",{attrs:{for:"currentValue"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("frequency")))]),e._v(e._s(e.$t("currentValue")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.micRecording,expression:"micRecording"}],staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.micValues.inputMaxFreqMap[n],expression:"micValues.inputMaxFreqMap[input]",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"currentValue"+r,type:"range",min:"0",max:e.getMicFreqMaxRange(n),step:"100",disabled:""},domProps:{value:e.micValues.inputMaxFreqMap[n]},on:{__r:function(t){e.$set(e.micValues.inputMaxFreqMap,n,e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(Math.round(e.micValues.inputMaxFreqMap[n]))+" Hz")])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.micRecording,expression:"!micRecording"}],staticClass:"srow mb-4 mt-0"},[e._v(e._s(e.$t("currentlyNotListeningToMicrophone")))]),e._v(" "),t("div",[t("label",{attrs:{for:"freqThresholdLow"+r}},[t("span",{staticClass:"sr-only"},[e._v(e._s(e.$t("frequency")))]),e._v(e._s(e.$t("thresholdLow")))])]),e._v(" "),t("div",{staticClass:"srow mb-4 mt-0"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:n.freqThresholdLow,expression:"input.freqThresholdLow",modifiers:{number:!0}}],staticClass:"eight columns",attrs:{id:"freqThresholdLow"+r,type:"range",min:"0",max:e.getMicFreqMaxRange(n),step:"100"},domProps:{value:n.freqThresholdLow},on:{input:function(t){e.validateChange(n,!1),e.modelChanged()},__r:function(t){e.$set(n,"freqThresholdLow",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("span",{staticClass:"three columns"},[e._v(e._s(n.freqThresholdLow)+" Hz")])])])])]):e._e(),e._v(" "),n.modelName===e.InputEventARE.getModelName()?t("div",[t("div",{staticClass:"srow"},[t("button",{staticClass:"five columns offset-by-three",on:{click:function(t){return e.recordAREEvent(n,r)}}},[t("i",{staticClass:"fas fa-bolt"}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!e.keyRecording[n.label+r],expression:"!keyRecording[input.label+index]"}]},[e._v(e._s(e.$t("recordAreEvent")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.keyRecording[n.label+r],expression:"keyRecording[input.label+index]"}]},[e._v(e._s(e.$t("waitingForEvent")))])]),e._v(" "),t("label",{staticClass:"four columns",attrs:{for:"inputAreUrl"}},[e._v(e._s(e.$t("areUrl")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.areURL,expression:"input.areURL"}],staticClass:"four columns",attrs:{id:"inputAreUrl",type:"text",placeholder:e.$t("emptyIsAutomatic")},domProps:{value:n.areURL},on:{change:function(t){return e.changedAreURL(n)},input:[function(t){t.target.composing||e.$set(n,"areURL",t.target.value)},function(t){e.areError[n.label+r]=!1}]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("span",{directives:[{name:"show",rawName:"v-show",value:e.areError[n.label+r],expression:"areError[input.label+index]"}],staticClass:"nine columns offset-by-three"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v("\n                        "+e._s(e.$t("errorConnectingToARE"))+" "+e._s("("+e.areService.getRestURL(n.areURL)+")")+"\n                    ")])]),e._v(" "),t("div",{staticClass:"srow"},e._l(n.eventNames,(function(r,i){return t("span",{staticClass:"nine columns offset-by-three"},[t("b",[e._v(e._s(e.$t("event")))]),e._v(" "+e._s(e.formatAreEvent(r))+" "),t("button",{staticStyle:{"margin-left":"1em",padding:"0 0.5em"},attrs:{title:e.$t("delete")},on:{click:function(t){return e.removeAREEvent(n,i)}}},[t("i",{staticClass:"fas fa-trash"})])])})),0)]):e._e()])})),0)])};Qb._withStripped=!0;const Zb={components:{Accordion:Gg},props:{value:Array,inputLabels:Array,canAdd:Boolean,maxElements:Number,errorInputs:Array,minInputs:Number,maxInputs:Number},watch:{value:{handler:function(e){this.initWithValue(e)},deep:!0}},data:()=>({inputs:[],inputEventTypes:A.R.getInputEventTypes(),InputEventKey:T.O,InputEventAudio:Lc.n,InputEventARE:Ic.L,InputConfig:A.R,keyRecording:{},areRecording:{},areError:{},micRecording:!1,micRecordError:!1,micValues:{volLive:0,volMax:0,inputMaxFreqMap:{}},lastEmitValue:null,localEventHandler:Hc.instance(),lastInitTime:null,areService:kc}),methods:{typeChange(e,t){let n=this.inputs[e],r=this.inputs.filter((e=>!e.modelName));if(!t)return n.modelName="",this.minInputs&&this.inputs.length>this.minInputs&&r.length>=1&&this.inputs.splice(e,1),void this.modelChanged();let i=A.R.getInputEventInstance(t,{label:n.label});Mi.set(this.inputs,e,JSON.parse(JSON.stringify(i))),this.maxInputs&&this.inputs.length<this.maxInputs&&r.length<=1&&this.addInput(),this.modelChanged()},recordKey(e,t){let n=this,r=e.label+t;if(n.keyRecording[r])return Mi.set(n.keyRecording,r,!1),void n.localEventHandler.destroy();Mi.set(n.keyRecording,r,!0),n.localEventHandler.destroy(),n.localEventHandler=Hc.instance(),n.localEventHandler.onAnyKey(((t,i,o)=>{o.preventDefault(),n.localEventHandler.destroy(),e.keyCode=t,e.keyName=i,Object.assign(e,{repeat:1,timeout:0,holdDuration:0}),Mi.set(n.keyRecording,r,!1),n.modelChanged()})),n.localEventHandler.startListening()},recordAREEvent(e,t){let n=this,r=e.label+t;if(n.areError[r]=!1,n.keyRecording[r])return void o();Mi.set(n.keyRecording,r,!0),kc.unsubscribeEvents();let i=null;function o(){Mi.set(n.keyRecording,r,!1),kc.unsubscribeEvents()}kc.subscribeEvents(e.areURL,(t=>{i||(i=setTimeout((()=>{Mi.set(n.keyRecording,r,!1),kc.unsubscribeEvents(),n.modelChanged()}),1e3)),e.eventNames.push(t)}),(()=>{n.areError[r]=!0,o()}))},removeAREEvent(e,t){e.eventNames.splice(t,1),this.modelChanged()},formatAreEvent(e){let t=JSON.parse(e);return t.channelId+" -> "+t.targetComponentId},changedAreURL(e){e.areURL&&(e.areURL=kc.getRestURL(e.areURL))},validateChange(e,t){e.volThresholdHigh<e.volThresholdLow&&(t?e.volThresholdHigh=e.volThresholdLow:e.volThresholdLow=e.volThresholdHigh),e.freqThresholdHigh<e.freqThresholdLow&&(t?e.freqThresholdHigh=e.freqThresholdLow:e.freqThresholdLow=e.freqThresholdHigh)},modelChanged(){let e=this.inputs.filter((e=>!!e.modelName&&A.R.getInputEventInstance(e.modelName,e).isValid())),t=JSON.parse(JSON.stringify(e));JSON.stringify(t)!==JSON.stringify(this.lastEmitValue)&&(this.lastInitTime=(new Date).getTime(),this.$emit("input",t),this.lastEmitValue=t)},addInput(e){e=e||1;for(let t=0;t<e;t++){let e=JSON.parse(JSON.stringify(new T.O({label:A.R.GENERAL_INPUT})));e.modelName=null,this.inputs.push(e)}},initWithValue(e){if(this.lastInitTime&&(new Date).getTime()-this.lastInitTime<500)return;this.lastInitTime=(new Date).getTime();let t=JSON.parse(JSON.stringify(e))||[];if(this.lastEmitValue=JSON.parse(JSON.stringify(t)),this.inputLabels){let e=t.map((e=>e.label));this.inputLabels.filter((t=>-1===e.indexOf(t))).forEach((e=>{let n=new Ic.L({label:e});n.modelName="",t.push(n)})),t.sort(((e,t)=>this.inputLabels.indexOf(e.label)-this.inputLabels.indexOf(t.label)))}this.inputs=JSON.parse(JSON.stringify(t));let n=this.inputs.filter((e=>!e.modelName));this.maxInputs&&this.inputs.length<this.maxInputs&&n.length<=1&&this.addInput(),this.minInputs&&this.inputs.length<this.minInputs&&this.addInput(this.minInputs-this.inputs.length)},micVolumeCallback(e,t){this.micValues.volLive=e,this.micValues.volMax=Math.max(e,this.micValues.volMax);for(let n of this.inputs)e>n.volThresholdHigh&&(this.micValues.inputMaxFreqMap[n]=t)},async toggleMicRecording(){this.micRecordError=!1;try{this.micRecording?(await Pc.removeMicVolumeCallback(this.micVolumeCallback),this.micRecording=!1):(await Pc.addMicVolumeCallback(this.micVolumeCallback),this.micRecording=!0)}catch(e){this.micRecordError=!0}},getMicVolMaxRange(e){let t=Math.max(e.volThresholdLow+5,e.volThresholdHigh+5);return Math.min(t,100)},getMicFreqMaxRange(e){let t=this.micValues.inputMaxFreqMap[e]||0,n=Math.max(t+1e3,e.freqThresholdLow+1e3,e.freqThresholdHigh+1e3);return Math.min(n,2e4)}},mounted(){this.initWithValue(this.value)}},eS=Zb;var tS=s(3567),nS={};nS.styleTagTransform=Ed(),nS.setAttributes=gd(),nS.insert=vd().bind(null,"head"),nS.domAPI=hd(),nS.insertStyleElement=yd(),dd()(tS.A,nS),tS.A&&tS.A.locals&&tS.A.locals;const rS=Cd(eS,Qb,[],!1,null,"713ffc86",null).exports;var iS=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"area"},e._l(e.rows,(function(n){return t("div",{staticClass:"area-row"},e._l(e.columns,(function(r){return t("div",{staticClass:"area-column"},[t("div",{staticClass:"area-element",style:`top: ${(n-1)*e.height}%; left: ${(r-1)*e.width}%; width: ${e.width}%; height: ${e.height}%;`},[t("div",{staticClass:"area-element-inner",attrs:{id:n+" "+r}})])])})),0)})),0)])};iS._withStripped=!0;const oS={props:{selectedElement:HTMLElement},watch:{selectedElement:{handler:function(e){(0,t.A)(".area-element-inner").removeClass("selected"),(0,t.A)(e).addClass("selected")},deep:!0}},data:()=>({rows:10,columns:10,width:0,height:0}),methods:{calcWidthHeight(){this.width=100/this.columns,this.height=100/this.rows}},mounted(){this.calcWidthHeight()},updated(){}};var aS=s(8376),sS={};sS.styleTagTransform=Ed(),sS.setAttributes=gd(),sS.insert=vd().bind(null,"head"),sS.domAPI=hd(),sS.insertStyleElement=yd(),dd()(aS.A,sS),aS.A&&aS.A.locals&&aS.A.locals;const lS=Cd(oS,iS,[],!1,null,"64127c7e",null).exports;var cS=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mt-0"},[t("div",{staticClass:"srow mt-0"},[t("slider-input",{attrs:{label:"minimumPauseForCollectingAndSpeakingTheSameCellSev",id:"minPauseSeCollectSpeak",min:"0",max:"10000",step:"200",unit:"s",decimals:"1","display-factor":"0.001"},on:{change:e.changed},model:{value:e.inputConfig.globalMinPauseCollectSpeak,callback:function(t){e.$set(e.inputConfig,"globalMinPauseCollectSpeak",e._n(t))},expression:"inputConfig.globalMinPauseCollectSpeak"}})],1),e._v(" "),e.hideAcousticFeedback?e._e():t("div",[t(e.headingTagInternal,{tag:"component",staticClass:"mb-3 mt-4"},[e._v(e._s(e.$t("acousticFeedbackOptions")))]),e._v(" "),t("div",{staticClass:"srow mt-0"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.globalReadActive,expression:"inputConfig.globalReadActive"}],attrs:{type:"checkbox",id:"chkReadActive"},domProps:{checked:Array.isArray(e.inputConfig.globalReadActive)?e._i(e.inputConfig.globalReadActive,null)>-1:e.inputConfig.globalReadActive},on:{change:[function(t){var n=e.inputConfig.globalReadActive,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"globalReadActive",n.concat([null])):o>-1&&e.$set(e.inputConfig,"globalReadActive",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"globalReadActive",i)},e.changed]}}),e._v(" "),t("label",{attrs:{for:"chkReadActive"}},[e._v(e._s(e.$t("readOutActiveElement")))])])]),e._v(" "),t("div",{staticClass:"srow my-2"},[t("slider-input",{attrs:{label:e.$t("speedForReadingActiveElement"),id:"readActiveRate",min:"0.1",max:"10",step:"0.1",decimals:"1"},on:{change:e.changed},model:{value:e.inputConfig.globalReadActiveRate,callback:function(t){e.$set(e.inputConfig,"globalReadActiveRate",e._n(t))},expression:"inputConfig.globalReadActiveRate"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.globalBeepFeedback,expression:"inputConfig.globalBeepFeedback"}],attrs:{type:"checkbox",id:"beepFeedback"},domProps:{checked:Array.isArray(e.inputConfig.globalBeepFeedback)?e._i(e.inputConfig.globalBeepFeedback,null)>-1:e.inputConfig.globalBeepFeedback},on:{change:[function(t){var n=e.inputConfig.globalBeepFeedback,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"globalBeepFeedback",n.concat([null])):o>-1&&e.$set(e.inputConfig,"globalBeepFeedback",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"globalBeepFeedback",i)},e.changed]}}),e._v(" "),t("label",{attrs:{for:"beepFeedback"}},[e._v(e._s(e.$t("enableAcousticFeedbackUsingBeepingSounds")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.globalReadAdditionalActions,expression:"inputConfig.globalReadAdditionalActions"}],attrs:{type:"checkbox",id:"readAdditional"},domProps:{checked:Array.isArray(e.inputConfig.globalReadAdditionalActions)?e._i(e.inputConfig.globalReadAdditionalActions,null)>-1:e.inputConfig.globalReadAdditionalActions},on:{change:[function(t){var n=e.inputConfig.globalReadAdditionalActions,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"globalReadAdditionalActions",n.concat([null])):o>-1&&e.$set(e.inputConfig,"globalReadAdditionalActions",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"globalReadAdditionalActions",i)},e.changed]}}),e._v(" "),t("label",{attrs:{for:"readAdditional"}},[e._v(e._s(e.$t("readElementActionsInAdditionToLabel")))])])])],1)])};cS._withStripped=!0;const dS=Cd({components:{SliderInput:qf},props:["inputConfig","headingTag","hideAcousticFeedback"],data:()=>({headingTagInternal:"h3"}),methods:{changed(e){this.$emit("input",this.inputConfig),this.$emit("change",this.inputConfig)}},mounted(){this.headingTag&&(this.headingTagInternal=this.headingTag)},updated(){}},cS,[],!1,null,"74f5203a",null).exports,uS={props:[],components:{GlobalInputOptions:dS,Accordion:Gg,InputEventList:rS,TestArea:lS,SliderInput:qf},data:function(){return{inputConfig:null,touchScanning:null,metadata:null,InputConfig:A.R,error:"",errorInputs:[],scanner:null,testOpen:!1,selectedTestElement:null}},watch:{inputConfig:{handler:function(e){this.testOpen&&this.initTest(e)},deep:!0}},methods:{save(){this.validateInputs()&&(this.metadata.inputConfig=this.inputConfig,xg.saveMetadata(this.metadata).then((()=>{this.$emit("close")})))},cancel(){this.$emit("close")},openHelp(){Qc.openHelp()},validateInputs(){return this.errorInputs=[],this.error="",!(this.inputConfig.scanEnabled&&(0===this.inputConfig.scanInputs.filter((e=>e.label===A.R.SELECT)).length&&this.errorInputs.push(A.R.SELECT),0!==this.inputConfig.scanInputs.filter((e=>e.label===A.R.NEXT)).length||this.inputConfig.scanAuto||this.errorInputs.push(A.R.NEXT),this.errorInputs.length>0&&(this.error=o.A.t("pleaseSpecifyInputModalities"),1)))},inputChanged(){this.error&&this.validateInputs()},resetInput(){this.$set(this.inputConfig,"scanInputs",JSON.parse(JSON.stringify(A.R.DEFAULT_SCAN_INPUTS))),this.inputChanged()},initTest(){setTimeout((()=>{this.stopTest(),this.inputConfig.scanEnabled&&(this.scanner=Mb.getInstanceFromConfig(this.inputConfig,".area-element-inner","active","inactive"),this.scanner.setSelectionListener((e=>{this.selectedTestElement=e})),this.scanner.startScanning())}),100)},stopTest(){this.scanner&&this.scanner.destroy()}},mounted(){let e=this;Hc.pauseAll(),xg.getMetadata().then((t=>{e.metadata=JSON.parse(JSON.stringify(t)),e.inputConfig=JSON.parse(JSON.stringify(t.inputConfig)),e.touchScanning=!e.inputConfig.mouseclickEnabled})),Qc.setHelpLocation("04_input_options","#scanning")},beforeDestroy(){Qc.revertToLastLocation(),this.stopTest(),Hc.resumeAll()}},hS=uS;var pS=s(2599),vS={};vS.styleTagTransform=Ed(),vS.setAttributes=gd(),vS.insert=vd().bind(null,"head"),vS.domAPI=hd(),vS.insertStyleElement=yd(),dd()(pS.A,vS),pS.A&&pS.A.locals&&pS.A.locals;const mS=Cd(hS,Xb,[],!1,null,"9517896a",null).exports;var gS=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.cancel():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v(e._s(e.$t("mousetouchInput")))])]),e._v(" "),e.inputConfig?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.mouseclickEnabled,expression:"inputConfig.mouseclickEnabled"}],attrs:{type:"checkbox",id:"enableClick"},domProps:{checked:Array.isArray(e.inputConfig.mouseclickEnabled)?e._i(e.inputConfig.mouseclickEnabled,null)>-1:e.inputConfig.mouseclickEnabled},on:{change:function(t){var n=e.inputConfig.mouseclickEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"mouseclickEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"mouseclickEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"mouseclickEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableClick"}},[e._v(e._s(e.$t("selectWithMouseClickOrTap")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.mouseDoubleClickEnabled,expression:"inputConfig.mouseDoubleClickEnabled"}],attrs:{type:"checkbox",id:"enableDoubleClick"},domProps:{checked:Array.isArray(e.inputConfig.mouseDoubleClickEnabled)?e._i(e.inputConfig.mouseDoubleClickEnabled,null)>-1:e.inputConfig.mouseDoubleClickEnabled},on:{change:function(t){var n=e.inputConfig.mouseDoubleClickEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"mouseDoubleClickEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"mouseDoubleClickEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"mouseDoubleClickEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableDoubleClick"}},[e._v(e._s(e.$t("selectWithDoubleClickOrDoubleTap")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.hoverEnabled,expression:"inputConfig.hoverEnabled"}],attrs:{type:"checkbox",id:"enableHover"},domProps:{checked:Array.isArray(e.inputConfig.hoverEnabled)?e._i(e.inputConfig.hoverEnabled,null)>-1:e.inputConfig.hoverEnabled},on:{change:function(t){var n=e.inputConfig.hoverEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"hoverEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"hoverEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"hoverEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableHover"}},[e._v(e._s(e.$t("enableHovering")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.hoverEnabled,expression:"inputConfig.hoverEnabled"}],staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"inHoverTime"}},[e._v(e._s(e.$t("hoverTimeMs")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.hoverTimeoutMs,expression:"inputConfig.hoverTimeoutMs",modifiers:{number:!0}}],attrs:{type:"range",id:"inHoverTime",min:"0",max:"5000",step:"100"},domProps:{value:e.inputConfig.hoverTimeoutMs},on:{__r:function(t){e.$set(e.inputConfig,"hoverTimeoutMs",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.hoverTimeoutMs,expression:"inputConfig.hoverTimeoutMs",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"5000",step:"100"},domProps:{value:e.inputConfig.hoverTimeoutMs},on:{input:function(t){t.target.composing||e.$set(e.inputConfig,"hoverTimeoutMs",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.hoverEnabled,expression:"inputConfig.hoverEnabled"}],staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.hoverHideCursor,expression:"inputConfig.hoverHideCursor"}],attrs:{type:"checkbox",id:"hoverHideCursor"},domProps:{checked:Array.isArray(e.inputConfig.hoverHideCursor)?e._i(e.inputConfig.hoverHideCursor,null)>-1:e.inputConfig.hoverHideCursor},on:{change:function(t){var n=e.inputConfig.hoverHideCursor,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"hoverHideCursor",n.concat([null])):o>-1&&e.$set(e.inputConfig,"hoverHideCursor",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"hoverHideCursor",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"hoverHideCursor"}},[e._v(e._s(e.$t("hideCursor")))])]),e._v(" "),t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.hoverDisableHoverpane,expression:"inputConfig.hoverDisableHoverpane"}],attrs:{type:"checkbox",id:"chkDisableHoverpane"},domProps:{checked:Array.isArray(e.inputConfig.hoverDisableHoverpane)?e._i(e.inputConfig.hoverDisableHoverpane,null)>-1:e.inputConfig.hoverDisableHoverpane},on:{change:function(t){var n=e.inputConfig.hoverDisableHoverpane,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"hoverDisableHoverpane",n.concat([null])):o>-1&&e.$set(e.inputConfig,"hoverDisableHoverpane",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"hoverDisableHoverpane",i)}}}),e._v(" "),t("label",{attrs:{for:"chkDisableHoverpane"}},[e._v(e._s(e.$t("disableHoverPane")))])])]),e._v(" "),t("div",{staticClass:"mb-4"}),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("ADVANCED_SETTINGS"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.mouseDownInsteadClick,expression:"inputConfig.mouseDownInsteadClick"}],attrs:{type:"checkbox",id:"mousedown"},domProps:{checked:Array.isArray(e.inputConfig.mouseDownInsteadClick)?e._i(e.inputConfig.mouseDownInsteadClick,null)>-1:e.inputConfig.mouseDownInsteadClick},on:{change:function(t){var n=e.inputConfig.mouseDownInsteadClick,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"mouseDownInsteadClick",n.concat([null])):o>-1&&e.$set(e.inputConfig,"mouseDownInsteadClick",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"mouseDownInsteadClick",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"mousedown"}},[e._v(e._s(e.$t("directlySelectElementOnPressingMouseButton")))])])])]),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("generalInputSettings"),"acc-label-type":"h2","acc-background-color":"white"}},[t("global-input-options",{attrs:{"input-config":e.inputConfig}})],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("TEST_CONFIGURATION"),"acc-label-type":"h2","acc-background-color":"white"},on:{open:function(t){e.testOpen=!0,e.initTest()},close:function(t){e.testOpen=!1,e.stopTest()}}},[t("test-area",{attrs:{"selected-element":e.selectedTestElement}})],1)],1):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"four columns offset-by-four",on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};gS._withStripped=!0;const fS={props:[],components:{GlobalInputOptions:dS,Accordion:Gg,InputEventList:rS,TestArea:lS},data:function(){return{inputConfig:null,metadata:null,InputConfig:A.R,clicker:null,hover:null,testOpen:!1,selectedTestElement:null}},watch:{inputConfig:{handler:function(e){this.testOpen&&this.initTest(e)},deep:!0}},methods:{save(){this.metadata.inputConfig=this.inputConfig,xg.saveMetadata(this.metadata).then((()=>{this.$emit("close")}))},cancel(){this.$emit("close")},openHelp(){Qc.openHelp()},initTest(){setTimeout((()=>{let e=this;this.stopTest(),e.inputConfig.hoverEnabled&&(e.hover=Fb.getInstanceFromConfig(e.inputConfig,".area-element-inner",{demoMode:!0,containerClass:".area .area-row"}),e.hover.setSelectionListener((function(t){e.selectedTestElement=t})),e.hover.startHovering()),(e.inputConfig.mouseclickEnabled||e.inputConfig.mouseDoubleClickEnabled)&&(e.clicker=Gb.getInstanceFromConfig(e.inputConfig,".area-element-inner"),e.clicker.setSelectionListener((function(t){e.selectedTestElement=t})),e.clicker.startClickcontrol())}),100)},stopTest(){this.clicker&&this.clicker.destroy(),this.hover&&this.hover.destroy()}},mounted(){let e=this;Hc.pauseAll(),xg.getMetadata().then((t=>{e.metadata=JSON.parse(JSON.stringify(t)),e.inputConfig=JSON.parse(JSON.stringify(t.inputConfig))})),Qc.setHelpLocation("04_input_options","#mousetouch-input")},beforeDestroy(){Qc.revertToLastLocation(),this.stopTest(),Hc.resumeAll()}},yS=Cd(fS,gS,[],!1,null,"7c9ad549",null).exports;var _S=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.cancel():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v(e._s(e.$t("directionInput")))])]),e._v(" "),e.inputConfig?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("span",[e._v(e._s(e.$t("directionInputMethod25InputEvents")))]),e._v(" "),t("a",{attrs:{"aria-label":e.$t("help"),href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas blue fa-question-circle"})])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.dirEnabled,expression:"inputConfig.dirEnabled"}],attrs:{type:"checkbox",id:"enableDirinput"},domProps:{checked:Array.isArray(e.inputConfig.dirEnabled)?e._i(e.inputConfig.dirEnabled,null)>-1:e.inputConfig.dirEnabled},on:{change:function(t){var n=e.inputConfig.dirEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"dirEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"dirEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"dirEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableDirinput"}},[e._v(e._s(e.$t("enableDirectionInput")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.dirEnabled,expression:"inputConfig.dirEnabled"}]},[t("accordion",{staticClass:"srow",attrs:{"acc-label":e.$t("input"),"acc-open":"true","acc-label-type":"h2","acc-background-color":"white"}},[t("input-event-list",{attrs:{"input-labels":[e.InputConfig.SELECT,e.InputConfig.RIGHT,e.InputConfig.DOWN,e.InputConfig.LEFT,e.InputConfig.UP],"error-inputs":e.errorInputs},on:{input:e.inputChanged},model:{value:e.inputConfig.dirInputs,callback:function(t){e.$set(e.inputConfig,"dirInputs",t)},expression:"inputConfig.dirInputs"}}),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"twelve columns",on:{click:e.resetInput}},[e._v(e._s(e.$t("resetToDefaultInputConfiguration")))])])],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("ADVANCED_SETTINGS"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow",staticStyle:{"margin-top":"0"}},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.dirWrapAround,expression:"inputConfig.dirWrapAround"}],attrs:{type:"checkbox",id:"chkWrapAround"},domProps:{checked:Array.isArray(e.inputConfig.dirWrapAround)?e._i(e.inputConfig.dirWrapAround,null)>-1:e.inputConfig.dirWrapAround},on:{change:function(t){var n=e.inputConfig.dirWrapAround,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"dirWrapAround",n.concat([null])):o>-1&&e.$set(e.inputConfig,"dirWrapAround",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"dirWrapAround",i)}}}),e._v(" "),t("label",{attrs:{for:"chkWrapAround"}},[e._v(e._s(e.$t("wrapAroundJumpToFirstElementAfterLastElem")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.dirResetToStart,expression:"inputConfig.dirResetToStart"}],attrs:{type:"checkbox",id:"chkReset"},domProps:{checked:Array.isArray(e.inputConfig.dirResetToStart)?e._i(e.inputConfig.dirResetToStart,null)>-1:e.inputConfig.dirResetToStart},on:{change:function(t){var n=e.inputConfig.dirResetToStart,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"dirResetToStart",n.concat([null])):o>-1&&e.$set(e.inputConfig,"dirResetToStart",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"dirResetToStart",i)}}}),e._v(" "),t("label",{attrs:{for:"chkReset"}},[e._v(e._s(e.$t("goToStartPositionAfterSelect")))])])])]),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("generalInputSettings"),"acc-label-type":"h2","acc-background-color":"white"}},[t("global-input-options",{attrs:{"input-config":e.inputConfig}})],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("TEST_CONFIGURATION"),"acc-label-type":"h2","acc-background-color":"white"},on:{open:function(t){e.testOpen=!0,e.initTest()},close:function(t){e.testOpen=!1,e.stopTest()}}},[t("test-area",{attrs:{"selected-element":e.selectedTestElement}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"warn"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+"\n                        ")])],1)]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"four columns offset-by-four",on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};_S._withStripped=!0;const ES={props:[],components:{GlobalInputOptions:dS,Accordion:Gg,InputEventList:rS,TestArea:lS},data:function(){return{inputConfig:null,metadata:null,InputConfig:A.R,error:"",errorInputs:[],dirInput:null,testOpen:!1,selectedTestElement:null}},watch:{inputConfig:{handler:function(e){this.testOpen&&this.initTest(e)},deep:!0}},methods:{save(){this.validateInputs()&&(this.metadata.inputConfig=this.inputConfig,xg.saveMetadata(this.metadata).then((()=>{this.$emit("close")})))},cancel(){this.$emit("close")},openHelp(){Qc.openHelp()},validateInputs(){return this.errorInputs=[],this.error="",!(this.inputConfig.dirEnabled&&(0===this.inputConfig.dirInputs.filter((e=>e.label===A.R.SELECT)).length&&this.errorInputs.push(A.R.SELECT),this.inputConfig.dirInputs.length<2&&this.errorInputs.push(A.R.RIGHT),this.errorInputs.length>0&&(this.error=o.A.t("pleaseSpecifyInputModalities"),1)))},inputChanged(){this.error&&this.validateInputs()},resetInput(){this.$set(this.inputConfig,"dirInputs",JSON.parse(JSON.stringify(A.R.DEFAULT_DIR_INPUTS))),this.inputChanged()},initTest(){setTimeout((()=>{let e=this;e.stopTest(),e.inputConfig.dirEnabled&&(e.dirInput=Hb.getInstanceFromConfig(e.inputConfig,".area-element-inner","active",(t=>{e.selectedTestElement=t})),e.dirInput.start())}),100)},stopTest(){this.dirInput&&this.dirInput.destroy()}},mounted(){let e=this;Hc.pauseAll(),xg.getMetadata().then((t=>{e.metadata=JSON.parse(JSON.stringify(t)),e.inputConfig=JSON.parse(JSON.stringify(t.inputConfig))})),Qc.setHelpLocation("04_input_options","#direction-input")},beforeDestroy(){Qc.revertToLastLocation(),this.stopTest(),Hc.resumeAll()}},bS=ES;var SS=s(4248),CS={};CS.styleTagTransform=Ed(),CS.setAttributes=gd(),CS.insert=vd().bind(null,"head"),CS.domAPI=hd(),CS.insertStyleElement=yd(),dd()(SS.A,CS),SS.A&&SS.A.locals&&SS.A.locals;const wS=Cd(bS,_S,[],!1,null,"1a571368",null).exports;var AS=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.cancel():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v(e._s(e.$t("huffmanInput")))])]),e._v(" "),e.inputConfig?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("span",[e._v(e._s(e.$t("huffmanInputMethod2OrMoreInputEvents")))]),e._v(" "),t("a",{attrs:{"aria-label":e.$t("help"),href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas blue fa-question-circle"})])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.huffEnabled,expression:"inputConfig.huffEnabled"}],attrs:{type:"checkbox",id:"enableHuffinput"},domProps:{checked:Array.isArray(e.inputConfig.huffEnabled)?e._i(e.inputConfig.huffEnabled,null)>-1:e.inputConfig.huffEnabled},on:{change:function(t){var n=e.inputConfig.huffEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"huffEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"huffEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"huffEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableHuffinput"}},[e._v(e._s(e.$t("enableHuffmanInput")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.huffEnabled,expression:"inputConfig.huffEnabled"}]},[t("accordion",{staticClass:"srow",attrs:{"acc-label":e.$t("input"),"acc-open":"true","acc-label-type":"h2","acc-background-color":"white"}},[t("input-event-list",{attrs:{"min-inputs":2,"max-inputs":9,"error-inputs":e.errorInputs},on:{input:e.inputChanged},model:{value:e.inputConfig.huffInputs,callback:function(t){e.$set(e.inputConfig,"huffInputs",t)},expression:"inputConfig.huffInputs"}}),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"twelve columns",on:{click:e.resetInput}},[e._v(e._s(e.$t("resetToDefaultInputConfiguration")))])])],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("ADVANCED_SETTINGS"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow",staticStyle:{"margin-top":"0"}},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.huffShowNumbers,expression:"inputConfig.huffShowNumbers"}],attrs:{type:"checkbox",id:"chkNumbers"},domProps:{checked:Array.isArray(e.inputConfig.huffShowNumbers)?e._i(e.inputConfig.huffShowNumbers,null)>-1:e.inputConfig.huffShowNumbers},on:{change:function(t){var n=e.inputConfig.huffShowNumbers,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"huffShowNumbers",n.concat([null])):o>-1&&e.$set(e.inputConfig,"huffShowNumbers",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"huffShowNumbers",i)}}}),e._v(" "),t("label",{attrs:{for:"chkNumbers"}},[e._v(e._s(e.$t("showNumbers")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.huffShowColors,expression:"inputConfig.huffShowColors"}],attrs:{type:"checkbox",id:"chkColors"},domProps:{checked:Array.isArray(e.inputConfig.huffShowColors)?e._i(e.inputConfig.huffShowColors,null)>-1:e.inputConfig.huffShowColors},on:{change:function(t){var n=e.inputConfig.huffShowColors,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"huffShowColors",n.concat([null])):o>-1&&e.$set(e.inputConfig,"huffShowColors",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"huffShowColors",i)}}}),e._v(" "),t("label",{attrs:{for:"chkColors"}},[e._v(e._s(e.$t("showColors")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.huffColorWholeElement,expression:"inputConfig.huffColorWholeElement"}],attrs:{type:"checkbox",id:"chkColorWholeElement"},domProps:{checked:Array.isArray(e.inputConfig.huffColorWholeElement)?e._i(e.inputConfig.huffColorWholeElement,null)>-1:e.inputConfig.huffColorWholeElement},on:{change:function(t){var n=e.inputConfig.huffColorWholeElement,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"huffColorWholeElement",n.concat([null])):o>-1&&e.$set(e.inputConfig,"huffColorWholeElement",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"huffColorWholeElement",i)}}}),e._v(" "),t("label",{attrs:{for:"chkColorWholeElement"}},[e._v(e._s(e.$t("colorWholeElement")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.huffMarkInactive,expression:"inputConfig.huffMarkInactive"}],attrs:{type:"checkbox",id:"chkMarkInactive"},domProps:{checked:Array.isArray(e.inputConfig.huffMarkInactive)?e._i(e.inputConfig.huffMarkInactive,null)>-1:e.inputConfig.huffMarkInactive},on:{change:function(t){var n=e.inputConfig.huffMarkInactive,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"huffMarkInactive",n.concat([null])):o>-1&&e.$set(e.inputConfig,"huffMarkInactive",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"huffMarkInactive",i)}}}),e._v(" "),t("label",{attrs:{for:"chkMarkInactive"}},[e._v(e._s(e.$t("markInactiveElements")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"inTimeout"}},[e._v(e._s(e.$t("timeoutInMs0MeansDisabled")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.huffTimeout,expression:"inputConfig.huffTimeout",modifiers:{number:!0}}],attrs:{type:"range",id:"inTimeout",min:"0",max:"10000",step:"100"},domProps:{value:e.inputConfig.huffTimeout},on:{__r:function(t){e.$set(e.inputConfig,"huffTimeout",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.huffTimeout,expression:"inputConfig.huffTimeout",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"10000",step:"200"},domProps:{value:e.inputConfig.huffTimeout},on:{input:function(t){t.target.composing||e.$set(e.inputConfig,"huffTimeout",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"four columns",attrs:{for:"inElementCount"}},[e._v(e._s(e.$t("numberOfElements0MeansAutomatic")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.huffElementCount,expression:"inputConfig.huffElementCount",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"300",id:"inElementCount"},domProps:{value:e.inputConfig.huffElementCount},on:{__r:function(t){e.$set(e.inputConfig,"huffElementCount",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.inputConfig.huffElementCount,expression:"inputConfig.huffElementCount",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"300",id:"inElementCount2"},domProps:{value:e.inputConfig.huffElementCount},on:{input:function(t){t.target.composing||e.$set(e.inputConfig,"huffElementCount",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},e._l(e.inputConfig.huffInputs.length,(function(n){return t("div",[t("label",{staticStyle:{"margin-right":"1em"},attrs:{for:"colorInput"+n}},[t("span",[e._v(e._s(e.$t("color")))]),e._v(" "+e._s(n))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.huffColors[n-1],expression:"inputConfig.huffColors[i-1]"}],attrs:{id:"colorInput"+n,type:"color"},domProps:{value:e.inputConfig.huffColors[n-1]},on:{input:function(t){t.target.composing||e.$set(e.inputConfig.huffColors,n-1,t.target.value)}}})])})),0),e._v(" "),t("button",{staticClass:"four columns",staticStyle:{"margin-top":"1em"},on:{click:function(t){e.inputConfig.huffColors=JSON.parse(JSON.stringify(e.InputConfig.DEFAULT_HUFF_COLORS))}}},[e._v(e._s(e.$t("resetColors")))])])]),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("TEST_CONFIGURATION"),"acc-label-type":"h2","acc-background-color":"white"},on:{open:function(t){e.testOpen=!0,e.initTest()},close:function(t){e.testOpen=!1,e.stopTest()}}},[t("test-area",{attrs:{"selected-element":e.selectedTestElement}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"warn"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+"\n                        ")])],1)]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"four columns offset-by-four",on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};AS._withStripped=!0;const TS={props:[],components:{Accordion:Gg,InputEventList:rS,TestArea:lS},data:function(){return{inputConfig:null,metadata:null,InputConfig:A.R,error:"",errorInputs:[],huffInput:null,testOpen:!1,selectedTestElement:null}},watch:{inputConfig:{handler:function(e){this.testOpen&&this.initTest(e)},deep:!0}},methods:{save(){this.validateInputs()&&(this.inputConfig.huffElementCount=this.inputConfig.huffElementCount||0,this.metadata.inputConfig=this.inputConfig,xg.saveMetadata(this.metadata).then((()=>{this.$emit("close")})))},cancel(){this.$emit("close")},openHelp(){Qc.openHelp()},validateInputs(){return this.errorInputs=[],this.error="",!(this.inputConfig.huffEnabled&&(this.inputConfig.huffInputs.length<2&&this.errorInputs.push(A.R.GENERAL_INPUT),this.errorInputs.length>0&&(this.error=o.A.t("pleaseSpecifyInputModalities"),1)))},inputChanged(){this.error&&this.validateInputs()},resetInput(){this.$set(this.inputConfig,"huffInputs",JSON.parse(JSON.stringify(A.R.DEFAULT_HUFF_INPUTS))),this.inputChanged()},initTest(){setTimeout((()=>{this.stopTest(),this.inputConfig.huffEnabled&&(this.huffInput=Kb.getInstanceFromConfig(this.inputConfig,".area-element-inner","active","inactive",(e=>{this.selectedTestElement=e})),this.huffInput.start())}),100)},stopTest(){this.huffInput&&this.huffInput.destroy()}},mounted(){let e=this;Hc.pauseAll(),xg.getMetadata().then((t=>{e.metadata=JSON.parse(JSON.stringify(t)),e.inputConfig=JSON.parse(JSON.stringify(t.inputConfig))})),Qc.setHelpLocation("04_input_options","#huffman-input")},beforeDestroy(){Qc.revertToLastLocation(),this.stopTest(),Hc.resumeAll()}},IS=TS;var kS=s(8949),OS={};OS.styleTagTransform=Ed(),OS.setAttributes=gd(),OS.insert=vd().bind(null,"head"),OS.domAPI=hd(),OS.insertStyleElement=yd(),dd()(kS.A,OS),kS.A&&kS.A.locals&&kS.A.locals;const RS=Cd(IS,AS,[],!1,null,"a950d5c8",null).exports;var xS=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keydown:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.cancel():null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v(e._s(e.$t("sequentialInput")))])]),e._v(" "),e.inputConfig?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow"},[t("span",[e._v(e._s(e.$t("sequentialInputMethod2InputEvents")))]),e._v(" "),t("a",{attrs:{"aria-label":e.$t("help"),href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas blue fa-question-circle"})])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputConfig.seqEnabled,expression:"inputConfig.seqEnabled"}],attrs:{type:"checkbox",id:"enableSeqinput"},domProps:{checked:Array.isArray(e.inputConfig.seqEnabled)?e._i(e.inputConfig.seqEnabled,null)>-1:e.inputConfig.seqEnabled},on:{change:function(t){var n=e.inputConfig.seqEnabled,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"seqEnabled",n.concat([null])):o>-1&&e.$set(e.inputConfig,"seqEnabled",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"seqEnabled",i)}}}),e._v(" "),t("label",{staticClass:"inline",attrs:{for:"enableSeqinput"}},[e._v(e._s(e.$t("enableSequentialInput")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.seqEnabled,expression:"inputConfig.seqEnabled"}]},[t("accordion",{staticClass:"srow",attrs:{"acc-label":e.$t("input"),"acc-open":"true","acc-label-type":"h2","acc-background-color":"white"}},[t("input-event-list",{attrs:{"input-labels":[e.InputConfig.NEXT_ELEMENT,e.InputConfig.PREVIOUS_ELEMENT,e.InputConfig.SELECT],"error-inputs":e.errorInputs},on:{input:e.inputChanged},model:{value:e.inputConfig.seqInputs,callback:function(t){e.$set(e.inputConfig,"seqInputs",t)},expression:"inputConfig.seqInputs"}}),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"twelve columns",on:{click:e.resetInput}},[e._v(e._s(e.$t("resetToDefaultInputConfiguration")))])])],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("ADVANCED_SETTINGS"),"acc-label-type":"h2","acc-background-color":"white"}},[t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.seqResetToStart,expression:"inputConfig.seqResetToStart"}],attrs:{type:"checkbox",id:"chkResetToStart"},domProps:{checked:Array.isArray(e.inputConfig.seqResetToStart)?e._i(e.inputConfig.seqResetToStart,null)>-1:e.inputConfig.seqResetToStart},on:{change:function(t){var n=e.inputConfig.seqResetToStart,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"seqResetToStart",n.concat([null])):o>-1&&e.$set(e.inputConfig,"seqResetToStart",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"seqResetToStart",i)}}}),e._v(" "),t("label",{attrs:{for:"chkResetToStart"}},[e._v(e._s(e.$t("goToStartPositionAfterSelect")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.seqStartWithAction,expression:"inputConfig.seqStartWithAction"}],attrs:{type:"checkbox",id:"chkStartWithAction"},domProps:{checked:Array.isArray(e.inputConfig.seqStartWithAction)?e._i(e.inputConfig.seqStartWithAction,null)>-1:e.inputConfig.seqStartWithAction},on:{change:function(t){var n=e.inputConfig.seqStartWithAction,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"seqStartWithAction",n.concat([null])):o>-1&&e.$set(e.inputConfig,"seqStartWithAction",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"seqStartWithAction",i)}}}),e._v(" "),t("label",{attrs:{for:"chkStartWithAction"}},[e._v(e._s(e.$t("startManuallyByUserInputEvent")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("roundsUntilStop"),id:"roundsUntilStop",min:"1",max:"10",step:"1",decimals:"0",default:"3"},model:{value:e.inputConfig.seqRoundsUntilStop,callback:function(t){e.$set(e.inputConfig,"seqRoundsUntilStop",e._n(t))},expression:"inputConfig.seqRoundsUntilStop"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.inputConfig.seqAuto,expression:"inputConfig.seqAuto"}],attrs:{type:"checkbox",id:"chkAutoScanning"},domProps:{checked:Array.isArray(e.inputConfig.seqAuto)?e._i(e.inputConfig.seqAuto,null)>-1:e.inputConfig.seqAuto},on:{change:function(t){var n=e.inputConfig.seqAuto,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.inputConfig,"seqAuto",n.concat([null])):o>-1&&e.$set(e.inputConfig,"seqAuto",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.inputConfig,"seqAuto",i)}}}),e._v(" "),t("label",{attrs:{for:"chkAutoScanning"}},[e._v(e._s(e.$t("automaticTimedSequentialInput")))])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.seqAuto,expression:"inputConfig.seqAuto"}],staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("scanningTimeMs"),id:"inScanTime",min:"100",max:"10000",step:"100",decimals:"0"},model:{value:e.inputConfig.seqTimeoutMs,callback:function(t){e.$set(e.inputConfig,"seqTimeoutMs",e._n(t))},expression:"inputConfig.seqTimeoutMs"}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.inputConfig.seqAuto,expression:"inputConfig.seqAuto"}],staticClass:"srow"},[t("slider-input",{attrs:{label:e.$t("timeFactorFirstElement"),id:"inFirstElement",min:"1",max:"5",step:"0.1",decimals:"1"},model:{value:e.inputConfig.seqTimeoutFirstElementFactor,callback:function(t){e.$set(e.inputConfig,"seqTimeoutFirstElementFactor",e._n(t))},expression:"inputConfig.seqTimeoutFirstElementFactor"}})],1)]),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("generalInputSettings"),"acc-label-type":"h2","acc-background-color":"white"}},[t("global-input-options",{attrs:{"input-config":e.inputConfig}})],1),e._v(" "),t("accordion",{attrs:{"acc-label":e.$t("TEST_CONFIGURATION"),"acc-label-type":"h2","acc-background-color":"white"},on:{open:function(t){e.testOpen=!0,e.initTest()},close:function(t){e.testOpen=!1,e.stopTest()}}},[t("test-area",{attrs:{"selected-element":e.selectedTestElement}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"warn"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "+e._s(e.error)+"\n                        ")])],1)]):e._e(),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container row"},[t("button",{staticClass:"four columns offset-by-four",on:{click:function(t){return e.cancel()}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"four columns",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("ok")))])])])])])])])])};xS._withStripped=!0;const NS={props:[],components:{GlobalInputOptions:dS,Accordion:Gg,InputEventList:rS,TestArea:lS,SliderInput:qf},data:function(){return{inputConfig:null,metadata:null,InputConfig:A.R,error:"",errorInputs:[],seqInput:null,testOpen:!1,selectedTestElement:null}},watch:{inputConfig:{handler:function(e){this.testOpen&&this.initTest(e)},deep:!0}},methods:{save(){this.validateInputs()&&(this.metadata.inputConfig=this.inputConfig,xg.saveMetadata(this.metadata).then((()=>{this.$emit("close")})))},cancel(){this.$emit("close")},openHelp(){Qc.openHelp()},validateInputs(){return this.errorInputs=[],this.error="",!(this.inputConfig.seqEnabled&&(0===this.inputConfig.seqInputs.filter((e=>e.label===A.R.NEXT_ELEMENT)).length&&this.errorInputs.push(A.R.NEXT_ELEMENT),0===this.inputConfig.seqInputs.filter((e=>e.label===A.R.SELECT)).length&&this.errorInputs.push(A.R.SELECT),this.errorInputs.length>0&&(this.error=o.A.t("pleaseSpecifyInputModalities"),1)))},inputChanged(){this.error&&this.validateInputs()},resetInput(){this.$set(this.inputConfig,"seqInputs",JSON.parse(JSON.stringify(A.R.DEFAULT_SEQ_INPUTS))),this.inputChanged()},initTest(){setTimeout((()=>{let e=this;e.stopTest(),e.inputConfig.seqEnabled&&(e.seqInput=zb.getInstanceFromConfig(e.inputConfig,{itemSelector:".area-element-inner",selectionListener:t=>{e.selectedTestElement=t},activeClass:"active"}),e.seqInput.start())}),100)},stopTest(){this.seqInput&&this.seqInput.destroy()}},mounted(){let e=this;Hc.pauseAll(),xg.getMetadata().then((t=>{e.metadata=JSON.parse(JSON.stringify(t)),e.inputConfig=JSON.parse(JSON.stringify(t.inputConfig))})),Qc.setHelpLocation("04_input_options","#sequential-input")},beforeDestroy(){Qc.revertToLastLocation(),this.stopTest(),Hc.resumeAll()}},DS=NS;var LS=s(6686),PS={};PS.styleTagTransform=Ed(),PS.setAttributes=gd(),PS.insert=vd().bind(null,"head"),PS.domAPI=hd(),PS.insertStyleElement=yd(),dd()(LS.A,PS),LS.A&&LS.A.locals&&LS.A.locals;const MS=Cd(DS,xS,[],!1,null,"09b28fd3",null).exports;var US=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("unlockApplication"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"number-row",staticStyle:{"text-align":"center","margin-bottom":"1em"}},[t("span",[e._v(e._s(e.$t("inputPasscode")))]),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("useButtonsOrKeyboard")))]),t("br"),e._v(" "),t("span",{staticStyle:{"font-size":"3em"},attrs:{"aria-hidden":"true"}},[e._l(e.inputPasscode.length,(function(n){return t("span",[e._v("●")])})),e._v(" "),e._l(Math.max(0,e.passcode.length-e.inputPasscode.length),(function(n){return t("span",[e._v("_")])}))],2)]),e._v(" "),t("div",{staticClass:"number-row"},e._l([1,2,3],(function(n){return t("button",{on:{click:function(t){return e.inputDigit(n)}}},[e._v(e._s(n))])})),0),e._v(" "),t("div",{staticClass:"number-row"},e._l([4,5,6],(function(n){return t("button",{on:{click:function(t){return e.inputDigit(n)}}},[e._v(e._s(n))])})),0),e._v(" "),t("div",{staticClass:"number-row"},e._l([7,8,9],(function(n){return t("button",{on:{click:function(t){return e.inputDigit(n)}}},[e._v(e._s(n))])})),0),e._v(" "),t("div",{staticClass:"number-row"},[t("button",{staticStyle:{"margin-left":"33%"},on:{click:function(t){return e.inputDigit(0)}}},[e._v("0")])])]),e._v(" "),t("div",{staticClass:"modal-footer"})])])])])};US._withStripped=!0;const FS={props:[],data:function(){return{passcode:n.w.getAppSettings().unlockPasscode,inputPasscode:"",timeoutHandler:null,masterkeyPossible:!0,timeoutMasterkeyHandler:null,keyHandler:null}},methods:{inputDigit(e){this.resetTimeout(),this.inputPasscode=this.inputPasscode+e,this.inputPasscode===this.passcode?(this.$emit("unlock"),this.$emit("close")):!this.masterkeyPossible&&this.inputPasscode.length>=this.passcode.length?this.$emit("close"):this.masterkeyPossible&&10===this.inputPasscode.length&&(this.$emit("unlock"),this.$emit("close"))},resetTimeout(){clearTimeout(this.timeoutHandler),clearTimeout(this.timeoutMasterkeyHandler),this.timeoutHandler=setTimeout((()=>{this.$emit("close")}),5e3),this.timeoutMasterkeyHandler=setTimeout((()=>{this.masterkeyPossible=!1}),500)}},mounted(){this.keyHandler=Hc.instance(),this.keyHandler.onAnyKey((e=>{let t=e-48;t>=0&&t<=9&&this.inputDigit(t)})),this.keyHandler.startListening(),this.resetTimeout()},beforeDestroy(){this.keyHandler.destroy()}};var BS=s(9972),GS={};GS.styleTagTransform=Ed(),GS.setAttributes=gd(),GS.insert=vd().bind(null,"head"),GS.domAPI=hd(),GS.insertStyleElement=yd(),dd()(BS.A,GS),BS.A&&BS.A.locals&&BS.A.locals;const $S=Cd(FS,US,[],!1,null,"ef27eb6a",null).exports;let VS=null,jS={MODAL_SCANNING:"MODAL_SCANNING",MODAL_MOUSE:"MODAL_MOUSE",MODAL_DIRECTION:"MODAL_DIRECTION",MODAL_HUFFMAN:"MODAL_HUFFMAN",MODAL_SEQUENTIAL:"MODAL_SEQUENTIAL",MODAL_UNLOCK:"MODAL_UNLOCK"},KS={props:{gridId:String,skipThumbnailCheck:Boolean},data:()=>({globalGridData:null,renderGridData:null,metadata:null,updatedMetadataDoc:null,scanner:null,hover:null,clicker:null,directionInput:null,seqInput:null,huffmanInput:null,inputMethodsInitialized:!1,showModal:null,modalTypes:jS,unlockCount:8,unlockCounter:8,MainVue:fg,highlightTimeoutHandler:null,highlightedElementId:null,systemActionService:$h}),components:{AppGridDisplay:Ly,UnlockModal:$S,SequentialInputModal:MS,HuffmanInputModal:RS,DirectionInputModal:wS,MouseModal:yS,ScanningModal:mS,HeaderIcon:Pg},methods:{openModal(e){this.showModal=e,WS()},lock(){let e=this;e.metadata.locked=!0,e.unlockCounter=8,xg.saveMetadata(e.metadata).then((()=>{this.setViewPropsLocked()}))},unlock(e){let t=this;e||!n.w.getAppSettings().unlockPasscode?(t.unlockCounter--,ee.Z.debounce((function(){t.unlockCounter=8}),3e3),(0===t.unlockCounter||e)&&(t.metadata.locked=!1,xg.saveMetadata(t.metadata).then((()=>{this.setViewPropsUnlocked()})))):t.showModal=jS.MODAL_UNLOCK},setViewPropsLocked(){(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_CLOSE),(0,t.A)(document).trigger(C.A.EVENT_UI_LOCKED),(0,t.A)("#viewPortMeta").attr("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),(0,t.A)("#gridView").on("touchmove",this.preventZoomHandler)},setViewPropsUnlocked(){(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPEN),(0,t.A)(document).trigger(C.A.EVENT_UI_UNLOCKED),(0,t.A)("#viewPortMeta").attr("content","width=device-width, initial-scale=1"),(0,t.A)("body").attr("touch-action",""),(0,t.A)("#gridView").off("touchmove",this.preventZoomHandler)},preventZoomHandler(e){e.preventDefault()},reloadInputMethods(){this.initInputMethods({reload:!0})},async initInputMethods(e={}){if(e.continueInputMethods=e.continueInputMethods||!1,e.reload=e.reload||!1,this.inputMethodsInitialized&&WS(),e.reload){let e=await xg.getMetadata();this.metadata=JSON.parse(JSON.stringify(e)),qS()}let n=this,r=n.metadata.inputConfig,i=e=>{this.stopHighlightElements(),Lb.removeAddClass(e,"selected"),gm.doAction(n.renderGridData,e.id)},o=(e,t,n)=>{if(Array.isArray(e)||(e=[e]),r.globalReadActive&&e&&1===e.length&&e[0]){let t=e[0].ariaLabel||"",n=t.indexOf(", ");r.globalReadAdditionalActions||-1===n||0===n||(t=t.substring(0,n)),su.speak(t,{rate:r.globalReadActiveRate||1})}r.globalBeepFeedback&&(n?Pc.beepHighDouble():t?Pc.beepHigh():Pc.beep())};r.seqEnabled&&(n.seqInput=zb.getInstanceFromConfig(r,{itemSelector:'.element-container:not([data-empty="true"])',selectionListener:i,activeListener:o}),n.seqInput.start(e.continueInputMethods)),r.dirEnabled&&(n.directionInput=Hb.getInstanceFromConfig(r,'.element-container:not([data-empty="true"])',"scanFocus",i),n.directionInput.start()),r.huffEnabled&&(this.huffmanInput=Kb.getInstanceFromConfig(r,".element-container","scanFocus","scanInactive",i),this.huffmanInput.start()),r.scanEnabled&&(n.scanner=Mb.getInstanceFromConfig(r,'.element-container:not([data-empty="true"])',"scanFocus","scanInactive"),n.scanner.setSelectionListener(i),n.scanner.setActiveListener(o),n.scanner.startScanning(e.continueInputMethods)),r.hoverEnabled?(n.hover=Fb.getInstanceFromConfig(r,".element-container",{activeListener:o,containerClass:".grid-container li"}),n.hover.setSelectionListener(i),n.hover.startHovering()):(0,t.A)("#touchElement").hide(),(r.mouseclickEnabled||r.mouseDoubleClickEnabled)&&(n.clicker=Gb.getInstanceFromConfig(r,".element-container"),n.clicker.setSelectionListener(i),n.clicker.startClickcontrol()),this.inputMethodsInitialized=!0},async onNavigateEvent(e,t,n){await this.loadGrid(t,{continueInputMethods:!0})},async loadGrid(e,n={}){if(n.continueInputMethods=n.continueInputMethods||!1,n.forceReload=n.forceReload||!1,Pm.clearCollectElements(),e&&(n.forceReload||!this.renderGridData||this.renderGridData.id!==e.id)){if(Ge.b.hasAREModel(e)){let t=Ge.b.getAREModel(e);kc.uploadAndStartModel(t.dataBase64,Ge.b.getAREURL(e),t.fileName)}let t=Ge.b.hasOutdatedThumbnail(e)&&!this.skipThumbnailCheck,n=t?Ge.b.getHash(e):null;await this.recalculateRenderGrid(e),TA.addToGridHistory(this.renderGridData.id),t&&ue.M.allImagesLoaded().then((async()=>{let e={data:await ue.M.getScreenshot("#grid-container"),hash:n};xg.saveThumbnail(this.renderGridData.id,e)})),this.metadata.lastOpenedGridId!==e.id&&(this.metadata.lastOpenedGridId=e.id,await xg.saveMetadata(this.metadata))}await this.$nextTick(),qS(),this.initInputMethods(n),this.highlightElements(),await Ie.initWithElements(this.renderGridData.gridElements),Pm.initWithGrid(this.renderGridData),Tm.initWithElements(this.renderGridData.gridElements),(0,t.A)(document).trigger(C.A.EVENT_GRID_LOADED)},highlightElements(){clearTimeout(this.highlightTimeoutHandler);let e=h.getSearchQueryParams();e.highlightIds&&((0,t.A)(`#${e.highlightIds[0]}`).addClass("highlight"),this.highlightTimeoutHandler=setTimeout((()=>{this.stopHighlightElements()}),15e3),this.highlightedElementId=e.highlightIds[0],e.highlightIds.shift(),e.highlightIds=e.highlightIds.length>0?e.highlightIds:null,h.setParamsToSearchQuery(e))},stopHighlightElements(){this.highlightedElementId&&((0,t.A)(`#${this.highlightedElementId}`).removeClass("highlight"),this.highlightedElementId=null)},toEditGrid(){TA.toEditGrid(this.renderGridData.id)},toLogin(){TA.toLogin()},async onExternalUpdate(e,r,i,o){let a=this;if(!VS)return void setTimeout((()=>{a.onExternalUpdate(e,r,i)}),500);if(o.includes(VS.gridId))return void TA.toManageGrids();log.debug("got update event, ids updated:"+r);let s=i.filter((e=>VS.renderGridData&&e.id===VS.renderGridData.id))[0],l=i.filter((e=>this.metadata&&e.id===this.metadata.globalGridId)).length>0;if(this.updatedMetadataDoc=i.filter((e=>VS.metadata&&e.id===VS.metadata.id))[0]||this.updatedMetadataDoc,s)VS.loadGrid(s,{continueInputMethods:!0,forceReload:!0});else if(l){let e=await xg.getGrid(VS.renderGridData.id,!1,!0);this.globalGridData=await xg.getGlobalGrid(),VS.loadGrid(e,{continueInputMethods:!0,forceReload:!0})}if(n.w.getAppSettings().syncNavigation){if(this.updatedMetadataDoc&&this.updatedMetadataDoc.lastOpenedGridId!==VS.renderGridData.id)return void xg.getGrid(this.updatedMetadataDoc.lastOpenedGridId).then((e=>{Ge.b.hasOutdatedThumbnail(e)||TA.toLastOpenedGrid()}));this.updatedMetadataDoc&&this.updatedMetadataDoc.fullscreen!==VS.metadata.fullscreen&&(this.updatedMetadataDoc.fullscreen?$h.enterFullscreen(!0):(0,t.A)(document).trigger(C.A.EVENT_SIDEBAR_OPEN)),this.updatedMetadataDoc&&this.updatedMetadataDoc.locked!==VS.metadata.locked&&(this.updatedMetadataDoc.locked?VS.lock():VS.unlock(!0))}this.metadata=this.updatedMetadataDoc||this.metadata},async recalculateRenderGrid(e){if(e.showGlobalGrid){let t=this.globalGridData;e.globalGridId&&(t=await xg.getGrid(e.globalGridId,!1,!0)),this.renderGridData=Ge.b.mergeGrids(e,t,{globalGridHeightPercentage:this.metadata.globalGridHeightPercentage,noDeepCopy:!0})}else this.renderGridData=e;this.renderGridData.gridElements=this.renderGridData.gridElements.filter((e=>!e.hidden)),this.metadata.vocabularyLevel&&(this.renderGridData.gridElements=this.renderGridData.gridElements.filter((e=>!e.vocabularyLevel||e.vocabularyLevel<=this.metadata.vocabularyLevel))),Md.setCurrentGrid(this.renderGridData)},onSidebarOpen(){VS&&VS.metadata&&(VS.metadata.fullscreen=!1,(0,t.A)(document).trigger(C.A.EVENT_GRID_RESIZE))},resizeListener(){let e=this;ee.Z.debounce((function(){e.huffmanInput&&e.huffmanInput.reinit()}),500)},contextMenuListener(e){e.preventDefault()},async metadataUpdated(){this.metadata=await xg.getMetadata()}},created(){(0,t.A)(document).on(C.A.EVENT_DB_PULL_UPDATED,this.onExternalUpdate),(0,t.A)(document).on(C.A.EVENT_SIDEBAR_OPEN,this.onSidebarOpen),(0,t.A)(document).on(C.A.EVENT_NAVIGATE_GRID_IN_VIEWMODE,this.onNavigateEvent),document.addEventListener("contextmenu",this.contextMenuListener),window.addEventListener("resize",this.resizeListener,!0),(0,t.A)(document).on(C.A.EVENT_GRID_RESIZE,this.resizeListener),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,this.metadataUpdated)},beforeDestroy(){(0,t.A)(document).off(C.A.EVENT_DB_PULL_UPDATED,this.onExternalUpdate),(0,t.A)(document).off(C.A.EVENT_SIDEBAR_OPEN,this.onSidebarOpen),(0,t.A)(document).off(C.A.EVENT_NAVIGATE_GRID_IN_VIEWMODE,this.onNavigateEvent),document.removeEventListener("contextmenu",this.contextMenuListener),window.removeEventListener("resize",this.resizeListener,!0),(0,t.A)(document).off(C.A.EVENT_GRID_RESIZE,this.resizeListener),(0,t.A)(document).off(C.A.EVENT_METADATA_UPDATED,this.metadataUpdated),WS(),this.setViewPropsUnlocked(),t.A.contextMenu("destroy"),Tm.stop(),VS=null},mounted:async function(){VS=this;let e=await xg.getMetadata(),n=JSON.parse(JSON.stringify(e||new d.e));n.lastOpenedGridId=this.gridId,n.locked=void 0===n.locked?h.isDemoMode()&&xg.getCurrentUser()===C.A.LOCAL_DEMO_USERNAME:n.locked,n.locked&&(0,t.A)(document).trigger(C.A.EVENT_UI_LOCKED),n.fullscreen=void 0===n.fullscreen?h.isDemoMode()&&xg.getCurrentUser()===C.A.LOCAL_DEMO_USERNAME:n.fullscreen,n.fullscreen=!!h.isFullscreen(!0)||n.fullscreen,n.locked=!!h.isLocked(!0)||n.locked,n.inputConfig.scanEnabled=!!h.isScanningEnabled()||n.inputConfig.scanEnabled,n.inputConfig.dirEnabled=!!h.isDirectionEnabled()||n.inputConfig.dirEnabled,n.inputConfig.huffEnabled=!!h.isHuffmanEnabled()||n.inputConfig.huffEnabled,xg.saveMetadata(n).then((()=>{n.locked&&this.setViewPropsLocked()})),this.metadata=n,this.globalGridData=await xg.getGlobalGrid();let r=await xg.getGrid(this.gridId,!1,!0);if(!r){log.warn("grid not found! gridId: "+this.gridId);let e=await xg.getGrids(!1,!0);if(!e||!e[0])return TA.toManageGrids();r=await xg.getGrid(e[0].id)}this.loadGrid(r)}};function WS(){VS&&(VS.scanner&&VS.scanner.destroy(),VS.hover&&VS.hover.destroy(),VS.clicker&&VS.clicker.destroy(),VS.directionInput&&VS.directionInput.destroy(),VS.huffmanInput&&VS.huffmanInput.destroy(),VS.seqInput&&VS.seqInput.destroy(),VS.inputMethodsInitialized=!1)}function qS(){t.A.contextMenu("destroy");function e(e,t){return`${o.A.t(e)}${t?" "+o.A.t("activeBracket"):""}`}let n=VS.metadata.inputConfig,r=n.mouseclickEnabled||n.hoverEnabled,i={CONTEXT_MOUSE:{name:e("mousetouchInput",r),icon:"fas fa-mouse-pointer",className:r?"boldFont":""},CONTEXT_SCANNING:{name:e("scanning",n.scanEnabled),icon:"fas fa-sort-amount-down",className:n.scanEnabled?"boldFont":""},CONTEXT_DIRECTION:{name:e("directionInput",n.dirEnabled),icon:"fas fa-arrows-alt",className:n.dirEnabled?"boldFont":""},CONTEXT_HUFFMAN:{name:e("huffmanInput",n.huffEnabled),icon:"fas fa-ellipsis-h",className:n.huffEnabled?"boldFont":""},CONTEXT_SEQUENTIAL:{name:e("sequentialInput",n.seqEnabled),icon:"fas fa-arrow-right",className:n.seqEnabled?"boldFont":""}};t.A.contextMenu({selector:"#inputConfigButton",appendTo:"#inputConfigMenu",callback:function(e,t){!function(e){switch(e){case"CONTEXT_MOUSE":VS.openModal(jS.MODAL_MOUSE);break;case"CONTEXT_SCANNING":VS.openModal(jS.MODAL_SCANNING);break;case"CONTEXT_DIRECTION":VS.openModal(jS.MODAL_DIRECTION);break;case"CONTEXT_HUFFMAN":VS.openModal(jS.MODAL_HUFFMAN);break;case"CONTEXT_SEQUENTIAL":VS.openModal(jS.MODAL_SEQUENTIAL)}}(e)},trigger:"left",items:i,zIndex:10})}const HS=Cd(KS,Db,[function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"grid-container grid-mask"},[e("i",{staticClass:"fas fa-4x fa-spinner fa-spin",staticStyle:{position:"relative"}})])}],!1,null,"50550678",null).exports;var YS=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"srow content spaced",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loginPlain(e.user,e.password)}}},[t("h2",[t("span",{staticClass:"show-mobile"},[e._v("AsTeRICS Grid - ")]),t("span",[e._v(e._s(e.$t("login")))])]),e._v(" "),t("div",{staticClass:"eleven columns offset-by-one"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.allUsersList.length>0,expression:"allUsersList.length > 0"}]},[t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},e._l(e.allUsersList,(function(n){return t("div",{staticClass:"srow saved-user",staticStyle:{"margin-bottom":"0"}},[t("div",{class:n===e.activeUser?"loggedIn":""},[t("div",{staticClass:"four columns",staticStyle:{"margin-bottom":"0.5em"}},[t("span",{staticStyle:{"margin-right":"0.6em"}},[e.savedLocalUsers.includes(n)?t("span",{staticClass:"fa-stack",attrs:{title:e._f("translate")("LABEL_USER_LOCAL")}},[t("i",{staticClass:"fas fa-user fa-2x"})]):e._e(),e._v(" "),e.savedOnlineUsers.includes(n)?t("span",{staticClass:"fa-stack",attrs:{title:e._f("translate")("LABEL_USER_CLOUD")}},[t("i",{staticClass:"fas fa-user fa-stack-2x"}),e._v(" "),t("i",{staticClass:"fas fa-cloud fa-1x",staticStyle:{position:"absolute",top:"20px",left:"20px",color:"dodgerblue"}})]):e._e(),e._v(" "),e.savedOnlineUsers.includes(n)||e.savedLocalUsers.includes(n)?e._e():t("span",{staticClass:"fa-stack",attrs:{title:e._f("translate")("LABEL_USER_ONLINE")}},[t("i",{staticClass:"fas fa-user fa-stack-2x"}),e._v(" "),t("i",{staticClass:"fas fa-globe fa-1x",staticStyle:{position:"absolute",top:"20px",left:"20px",color:"dodgerblue"}})])]),e._v(" "),t("strong",[e._v(e._s(n))]),e._v(" "),t("em",{directives:[{name:"show",rawName:"v-show",value:n===e.activeUser,expression:"username === activeUser"}]},[e._v(e._s(e.$t("activeBracket")))])]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.hasValidMajorModelVersion(n),expression:"hasValidMajorModelVersion(username)"}],staticClass:"four columns",on:{click:function(t){return e.loginStored(n)}}},[t("span",[e._v(e._s(e.$t("open")))]),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.loginTryUser!==n,expression:"loginTryUser !== username"}],staticClass:"fas fa-sign-in-alt"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:null==e.loginSuccess&&e.loginTryUser===n,expression:"loginSuccess == undefined && loginTryUser === username"}],staticClass:"fas fa-spinner fa-spin"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:0==e.loginSuccess&&e.loginTryUser===n,expression:"loginSuccess == false && loginTryUser === username"}],staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:1==e.loginSuccess&&e.loginTryUser===n,expression:"loginSuccess == true && loginTryUser === username"}],staticClass:"fas fa-check",staticStyle:{color:"green"}})]),e._v(" "),t("button",{directives:[{name:"show",rawName:"v-show",value:e.hasValidMajorModelVersion(n),expression:"hasValidMajorModelVersion(username)"}],staticClass:"four columns",on:{click:function(t){return e.removeStoredUser(n)}}},[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.savedLocalUsers.includes(n),expression:"!savedLocalUsers.includes(username)"}]},[t("span",[e._v(e._s(e.$t("logout")))]),e._v(" "),t("i",{staticClass:"fas fa-user-times"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.savedLocalUsers.includes(n),expression:"savedLocalUsers.includes(username)"}]},[t("span",[e._v(e._s(e.$t("delete")))]),e._v(" "),t("i",{staticClass:"fas fa-trash"})])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.hasValidMajorModelVersion(n),expression:"!hasValidMajorModelVersion(username)"}],staticClass:"eight columns"},[t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e.$t("incompatibleDataModelVersion")))])]),e._v(" "),t("div",[t("i18n",{attrs:{path:"changeToLatestToOpen",tag:"span"},scopedSlots:e._u([{key:"latestLink",fn:function(){return[t("a",{attrs:{href:"https://grid.asterics.eu/latest/#login"}},[e._v("grid.asterics.eu/latest")])]},proxy:!0}],null,!0)})],1)])])])})),0)]),e._v(" "),t("div",{staticClass:"srow"},[t("form",{staticClass:"eleven columns saved-user",attrs:{autocomplete:"on",onsubmit:"event.preventDefault()"}},[t("div",{staticClass:"srow"},[t("strong",[e._v(e._s(e.$t("loginWithOtherUser")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputUser"}},[t("span",[e._v(e._s(e.$t("username")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"four columns",attrs:{type:"text",name:"username",id:"inputUser",autocomplete:"username"},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}}),e._v(" "),e.savedUsers.includes(e.user)&&e.hasValidMajorModelVersion(e.user)?t("button",{staticClass:"four columns",attrs:{type:"button"},on:{click:function(t){return e.loginStored(e.user)}}},[t("span",[e._v(e._s(e.$t("open")))]),e._v(" "),t("i",{staticClass:"fas fa-sign-in-alt"})]):e._e()]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.savedUsers.includes(e.user),expression:"!savedUsers.includes(user)"}],staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputPassword"}},[t("span",[e._v(e._s(e.$t("password")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"four columns",attrs:{type:"password",id:"inputPassword",autocomplete:"current-password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.savedUsers.includes(e.user),expression:"!savedUsers.includes(user)"}],staticClass:"srow"},[t("div",{staticClass:"four columns offset-by-two",staticStyle:{"margin-bottom":"1.0em"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.remember,expression:"remember"}],attrs:{type:"checkbox",checked:"",id:"inputRemember"},domProps:{checked:Array.isArray(e.remember)?e._i(e.remember,null)>-1:e.remember},on:{change:function(t){var n=e.remember,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.remember=n.concat([null])):o>-1&&(e.remember=n.slice(0,o).concat(n.slice(o+1)))}else e.remember=i}}}),e._v(" "),t("label",{attrs:{for:"inputRemember"}},[t("span",[e._v(e._s(e.$t("rememberThisUserAndMakeItAvailableForOfflineUse")))])])]),e._v(" "),t("button",{staticClass:"five columns offset-by-one",attrs:{type:"button",disabled:!e.user||!e.password},on:{click:function(t){return e.loginPlain(e.user,e.password)}}},[t("span",[e._v(e._s(e.$t("login")))]),e._v(" "),t("span",[t("i",{directives:[{name:"show",rawName:"v-show",value:void 0===e.loginSuccess&&e.loginTryUser===e.user,expression:"loginSuccess === undefined && loginTryUser === user"}],staticClass:"fas fa-spinner fa-spin"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:0==e.loginSuccess&&e.loginTryUser===e.user,expression:"loginSuccess == false && loginTryUser === user"}],staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:1==e.loginSuccess&&e.loginTryUser===e.user,expression:"loginSuccess == true && loginTryUser === user"}],staticClass:"fas fa-check",staticStyle:{color:"green"}})])])])])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0==e.allUsersList.length,expression:"allUsersList.length == 0"}]},[t("form",{attrs:{autocomplete:"on",onsubmit:"event.preventDefault()"}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"one column",attrs:{for:"inputUser2"}},[t("span",{staticClass:"desktop-right"},[e._v(e._s(e.$t("username")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"four columns",attrs:{type:"text",name:"username",id:"inputUser2",autocomplete:"username"},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"one column",attrs:{for:"inputPassword2"}},[t("span",{staticClass:"desktop-right"},[e._v(e._s(e.$t("password")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"four columns",attrs:{type:"password",id:"inputPassword2",autocomplete:"current-password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns offset-by-one"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.remember,expression:"remember"}],attrs:{type:"checkbox",checked:"",id:"inputRemember2"},domProps:{checked:Array.isArray(e.remember)?e._i(e.remember,null)>-1:e.remember},on:{change:function(t){var n=e.remember,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.remember=n.concat([null])):o>-1&&(e.remember=n.slice(0,o).concat(n.slice(o+1)))}else e.remember=i}}}),e._v(" "),t("label",{attrs:{for:"inputRemember2"}},[t("span",[e._v(e._s(e.$t("rememberThisUserAndMakeItAvailableForOfflineUse")))])]),e._v(" "),t("br"),e._v(" "),t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t("doNotCheckForAOnetimeLoginOnForeign")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"four columns offset-by-one",attrs:{disabled:!e.user||!e.password},on:{click:function(t){return e.loginPlain(e.user,e.password)}}},[e._v(e._s(e.$t("login")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns offset-by-one"},[t("div",{directives:[{name:"show",rawName:"v-show",value:void 0===e.loginSuccess,expression:"loginSuccess === undefined"}]},[t("span",[e._v(e._s(e.$t("loggingIn")))]),e._v(" "),t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!1===e.loginSuccess,expression:"loginSuccess === false"}]},[t("i",{staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("span",[e._v(e._s(e._f("translate")(e.loginErrorCode)))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.loginSuccess,expression:"loginSuccess === true"}]},[t("span",[e._v(e._s(e.$t("loginSuccessful")))]),e._v(" "),t("i",{staticClass:"fas fa-check",staticStyle:{color:"green"}})])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("span",{directives:[{name:"show",rawName:"v-show",value:0===e.allUsersList.length,expression:"allUsersList.length === 0"}]},[e._v(e._s(e.$t("noAccount")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.allUsersList.length>0,expression:"allUsersList.length > 0"}]},[e._v(e._s(e.$t("addNewAccount")))]),e._v(" "),t("a",{attrs:{href:"#register"}},[e._v(e._s(e.$t("registernow")))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.allUsersList.length,expression:"allUsersList.length === 0"}]},[t("span",[e._v(e._s(e.$t("astericsGridIsFreeAndAllYouNeedToRegister")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"twelve columns"},[t("span",[e._v(e._s(e.$t("wantToCreateAnOfflineonlyUser")))]),e._v(" "),t("a",{attrs:{href:"#add"}},[e._v(e._s(e.$t("addOfflineUser")))])])])])]),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};YS._withStripped=!0;var zS=s(1487);let JS,XS={},QS=null,ZS=null,eC=null,tC=0,nC=null,rC=!1,iC=null,oC=null,aC=C.A.IS_ENVIRONMENT_PROD?"https://login1.couchdb.asterics-foundation.org":`http://${location.hostname}:3000`;function sC(e,t,r){return eC!==e?Promise.reject():(nC=e,iC=t,oC=r,e=e.trim(),zS.A.login({username:e,password:t}).then((i=>(log.info("login success!"),XS.stopAutoRetryLogin(),QS=i,ZS=e,n.w.setLastActiveUser(e),n.w.setAutologinUser(r?e:""),r&&n.w.saveUserPassword(e,t),Promise.resolve()))))}function lC(e,t,r){return sC(e,t,r).then((()=>(tC=0,te.initForUser(e,t,XS.getLoggedInUserDatabase(),!r).then((()=>Promise.resolve(!0))))),(i=>eC!==e?Promise.reject():(log.info("online login failed!"),log.debug(i),n.w.isDatabaseSynced(e)?(log.info("using offline local database..."),n.w.setLastActiveUser(e),n.w.setAutologinUser(r?e:""),cC(i)!==XS.ERROR_CODE_UNAUTHORIZED&&dC(e,t,r),te.initForUser(e,t).then((()=>Promise.resolve(!1)))):Promise.reject(cC(i)))))}function cC(e){return e&&e.error&&"unauthorized"===e.error.toLowerCase()&&e.message&&e.message.includes("locked")||e&&e.error&&"unauthorized"===e.error.toLowerCase()?XS.ERROR_CODE_UNAUTHORIZED:e&&e.message&&"network error"===e.message.toLowerCase()?XS.ERROR_CODE_NETWORK_ERROR:void 0}function dC(e,t,n){XS.stopAutoRetryLogin(),tC++;let r=Math.min(5+2*tC*tC,1800);r=Math.round(r*ee.Z.getRandom(1,1.5)),JS=setTimeout((function(){log.info(`auto-retry for online login user ${e} (attempt ${tC}, waited for ${r}s)`),lC(e,t,n)}),1e3*r)}XS.ERROR_CODE_UNAUTHORIZED="ERROR_CODE_UNAUTHORIZED",XS.ERROR_CODE_LOCKED="ERROR_CODE_LOCKED",XS.ERROR_CODE_NETWORK_ERROR="ERROR_CODE_NETWORK_ERROR",zS.A.configure({serverUrl:aC,baseUrl:"/auth",noDefaultEndpoint:!1,storage:"local",checkExpired:!1,refreshThreshold:.5,timeout:0}),XS.getLoggedInUsername=function(){return ZS||te.getCurrentUsedDatabase()},XS.getLoggedInUserDatabase=function(){if(!QS||!QS.userDBs)return null;let e=Object.keys(QS.userDBs);return QS.userDBs[e[0]]},XS.loginPlainPassword=function(e,t,n){eC=e;let r=E.H.getUserPasswordHash(t);return XS.loginHashedPassword(e,r,n)},XS.loginHashedPassword=function(e,t,n){return eC=e,lC(e,t,n)},XS.loginStoredUser=function(e,t){if(!e)return Promise.resolve();if(rC)return log.warn("login currently in progress - aborting..."),Promise.reject();eC=e,rC=!0;let r=n.w.getSavedOnlineUsers(),i=n.w.getSavedLocalUsers(),o=new Promise(((t,o)=>{if(XS.getLoggedInUsername()===e)return t();if(XS.logout(),r.includes(e)&&n.w.isDatabaseSynced(e)){let r=n.w.getUserSettings(e).password;n.w.setAutologinUser(e),te.initForUser(e,r).then((()=>{XS.loginHashedPassword(e,r,!0),t()}))}else if(r.includes(e)){log.info("waiting for successful login because user wasn't completely synced before...");let r=n.w.getUserSettings(e).password;XS.loginHashedPassword(e,r,!0).then((()=>{t()})).catch((e=>{log.warn("online login failed!",e),o(e)}))}else i.includes(e)&&(n.w.setAutologinUser(e),te.initForUser(e,e).then((()=>{t()})))}));return o.then((()=>{t||TA.toMain()})),o.finally((()=>{rC=!1})),o},XS.logout=function(){log.debug("logging out user: "+ZS),(0,t.A)(document).trigger(C.A.EVENT_USER_CHANGING),XS.stopAutoRetryLogin(),Eh.stop(),fg.clearTooltip(),te.closeCurrentDatabase(),ZS&&zS.A.logout(ZS),ZS=null,QS=null},XS.register=function(e,t,n){eC=e,XS.stopAutoRetryLogin(),e=e.trim();let r=E.H.getUserPasswordHash(t);return log.debug("password hash: "+r),zS.A.register({username:e,email:(new Date).getTime()+"."+Math.random()+"@norealmail.org",password:r,confirmPassword:r}).then((async()=>(await ee.Z.sleep(500),sC(e,r,n)))).then((()=>(log.info("registration successful!"),te.registerForUser(ZS,r,XS.getLoggedInUserDatabase(),!n)))).catch((e=>(log.info("registration failed!"),log.info(e),Promise.reject(e))))},XS.registerOffline=function(e,t){return XS.logout(),n.w.saveUserPassword(e,""),n.w.setAutologinUser(e),te.registerForUser(e,t)},XS.validateUsername=function(e){return new Promise(((t,r)=>{e&&C.A.USERNAME_REGEX.test(e)?n.w.isSavedLocalUser(e)||e===C.A.LOCAL_DEMO_USERNAME?t(C.A.VALIDATION_ERROR_EXISTING):fetch(`${aC}/user/validate-username/${e}`).then((async e=>{let n=await e.json();t(n?C.A.VALIDATION_VALID:C.A.VALIDATION_ERROR_EXISTING)})).catch((e=>{log.warn("couldn't check username"),t(C.A.VALIDATION_ERROR_FAILED)})):t(C.A.VALIDATION_ERROR_REGEX)}))},XS.stopAutoRetryLogin=function(){JS&&(clearTimeout(JS),JS=null)},(0,t.A)(document).on(C.A.EVENT_DB_CONNECTION_LOST,(function(e){log.info("connection lost! auto-retrying login after 10 seconds..."),nC&&iC&&dC(nC,iC,oC)})),(0,t.A)(document).on(C.A.EVENT_DB_DATAMODEL_UPDATE,(function(){XS.logout(),n.w.setAutologinUser(""),TA.toLogin()}));const uC={components:{HeaderIcon:Pg},props:[],data:()=>({user:null,password:null,remember:!0,loginTryUser:null,loginSuccess:null,loginErrorCode:null,savedUsers:[],savedOnlineUsers:[],savedLocalUsers:[],allUsersList:[],activeUser:null}),methods:{toMain(){TA.toMain()},loginPlain(e,t){let n=this;this.savedUsers.includes(e)?n.loginStored(e):e&&t&&(n.loginTryUser=e,n.loginSuccess=void 0,n.loginErrorCode="",XS.loginPlainPassword(e,t,this.remember).then((()=>{n.loginSuccess=!0,TA.toMain()})).catch((e=>{n.loginSuccess=!1,n.loginErrorCode=e})))},loginStored(e){let t=this;e&&(t.savedUsers.includes(e)||XS.getLoggedInUsername()===e)&&(t.loginSuccess=void 0,t.loginTryUser=e,t.loginErrorCode="",XS.loginStoredUser(e).then((()=>{t.loginSuccess=!0})).catch((e=>{t.loginSuccess=!1,t.loginErrorCode=e})))},removeStoredUser(e){let r=n.w.getUserSettings(e);if(this.savedOnlineUsers.includes(e)||this.savedLocalUsers.includes(e)){let t=this.savedOnlineUsers.includes(e)?"CONFIRM_REMOVE_USER":"CONFIRM_REMOVE_USER_LOCAL";if(!confirm(o.A.t(t,e)))return;n.w.removeLocalUser(e),XS.getLoggedInUsername()===e&&XS.logout(),te.deleteDatabase(e)}else XS.logout();this.allUsersList=n.w.getSavedUsers(this.activeUser),this.savedUsers=n.w.getSavedUsers(this.activeUser),this.savedOnlineUsers=n.w.getSavedOnlineUsers(),this.savedLocalUsers=n.w.getSavedLocalUsers(),(0,t.A)(document).trigger(C.A.EVENT_USER_DELETED,[e,r])},hasValidMajorModelVersion:e=>n.w.getUserMajorModelVersion(e)<=u.S.getLatestModelVersion().major},mounted(){let e=XS.getLoggedInUsername();this.activeUser=n.w.getAutologinUser()||e,this.savedUsers=n.w.getSavedUsers(this.activeUser),this.allUsersList=n.w.getSavedUsers(this.activeUser),this.savedOnlineUsers=n.w.getSavedOnlineUsers(),this.savedLocalUsers=n.w.getSavedLocalUsers(),e&&!this.allUsersList.includes(e)&&this.allUsersList.unshift(e),this.user=this.allUsersList&&this.allUsersList.length>0?null:n.w.getLastActiveUser(),this.user&&document.getElementById("inputPassword2").focus()}},hC=uC;var pC=s(4205),vC={};vC.styleTagTransform=Ed(),vC.setAttributes=gd(),vC.insert=vd().bind(null,"head"),vC.domAPI=hd(),vC.insertStyleElement=yd(),dd()(pC.A,vC),pC.A&&pC.A.locals&&pC.A.locals;const mC=Cd(hC,YS,[],!1,null,"0fa7429a",null).exports;var gC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"srow content spaced"},[t("h2",[t("span",{staticClass:"show-mobile"},[e._v("AsTeRICS Grid - ")]),t("span",[e._v(e._s(e.$t("registerOnlineUser")))])]),e._v(" "),t("form",{staticStyle:{"margin-bottom":"0.5em"},attrs:{autocomplete:"off",onsubmit:"event.preventDefault()"}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputUser"}},[t("span",{staticClass:"desktop-right inputlabel"},[e._v(e._s(e.$t("username")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"},{name:"focus",rawName:"v-focus"}],staticClass:"six columns",attrs:{type:"text",name:"username",autocapitalize:"none",id:"inputUser",maxlength:"16"},domProps:{value:e.user},on:{input:[function(t){t.target.composing||(e.user=t.target.value)},e.validateUsername]}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.user&&void 0===e.usernameValid,expression:"user != null && usernameValid === undefined"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.user&&0==e.usernameValid,expression:"user != null && usernameValid == false"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("span",[e._v(e._s(e._f("translate")(e.usernameValidationCode)))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.user&&1==e.usernameValid,expression:"user != null && usernameValid == true"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-check",staticStyle:{color:"green"}}),e._v(" "),t("span",[e._v(e._s(e.$t("validUsername")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns inputlabel",attrs:{for:"inputPassword"}},[t("span",{staticClass:"desktop-right"},[e._v(e._s(e.$t("password")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"six columns",attrs:{type:"password",id:"inputPassword"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns inputlabel",attrs:{for:"inputConfirmPassword"}},[t("span",{staticClass:"desktop-right"},[e._v(e._s(e.$t("confirmPassword")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password2,expression:"password2"}],staticClass:"six columns",attrs:{type:"password",id:"inputConfirmPassword"},domProps:{value:e.password2},on:{input:function(t){t.target.composing||(e.password2=t.target.value)}}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.password&&null!==e.password2&&e.password!==e.password2,expression:"!!password && password2 !== null && password !== password2"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("span",[e._v(e._s(e.$t("passwordsDoNotMatch")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.password&&null!==e.password2&&e.password===e.password2,expression:"!!password && password2 !== null && password === password2"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-check",staticStyle:{color:"green"}}),e._v(" "),t("span",[e._v(e._s(e.$t("passwordsMatch")))])])])]),e._v(" "),t("div",{staticClass:"srow more-space"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.password&&null!==e.password2&&e.password===e.password2,expression:"!!password && password2 !== null && password === password2"}],staticClass:"six columns offset-by-two"},[t("i",{staticClass:"fas fa-info-circle",staticStyle:{color:"blue"}}),e._v(" "),t("b",[e._v(e._s(e.$t("importantInformation")))]),e._v(" "),t("ul",{staticStyle:{"list-style-type":"none","margin-bottom":"0"}},[t("li",[e._v(e._s(e.$t("yourPasswordWillBeUsedInOrderToEncrypt")))]),e._v(" "),t("li",[e._v(e._s(e.$t("usersWillBeDeletedAfterNotLoggingInFor365Days")))])])])]),e._v(" "),t("div",{staticClass:"srow more-space"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.password&&null!==e.password2&&e.password===e.password2,expression:"!!password && password2 !== null && password === password2"}],staticClass:"six columns offset-by-two"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.remember,expression:"remember"}],attrs:{type:"checkbox",checked:"",id:"inputRemember"},domProps:{checked:Array.isArray(e.remember)?e._i(e.remember,null)>-1:e.remember},on:{change:function(t){var n=e.remember,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.remember=n.concat([null])):o>-1&&(e.remember=n.slice(0,o).concat(n.slice(o+1)))}else e.remember=i}}}),e._v(" "),t("label",{attrs:{for:"inputRemember"}},[t("span",[e._v(e._s(e.$t("rememberThisUserAndMakeItAvailableForOffline")))])]),e._v(" "),t("br"),e._v(" "),t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t("doNotCheckIfYouAreUsingAForeignDevice")))])])]),e._v(" "),t("div",{staticClass:"srow more-space"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.password&&null!==e.password2&&e.password===e.password2,expression:"!!password && password2 !== null && password === password2"}],staticClass:"six columns offset-by-two"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.privacyConsent,expression:"privacyConsent"}],attrs:{type:"checkbox",id:"checkPrivacy"},domProps:{checked:Array.isArray(e.privacyConsent)?e._i(e.privacyConsent,null)>-1:e.privacyConsent},on:{change:function(t){var n=e.privacyConsent,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.privacyConsent=n.concat([null])):o>-1&&(e.privacyConsent=n.slice(0,o).concat(n.slice(o+1)))}else e.privacyConsent=i}}}),e._v(" "),t("label",{attrs:{for:"checkPrivacy"}},[t("i18n",{attrs:{path:"iAcceptPrivacyPolicy",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[t("a",{attrs:{href:"app/privacy_en.html?back=register"}},[e._v(e._s(e.$t("privacyPolicy")))])]},proxy:!0},{key:"linkDe",fn:function(){return[t("a",{attrs:{href:"app/privacy_de.html?back=register"}},[e._v(e._s(e.$t("privacyPolicy")))])]},proxy:!0}])})],1),e._v(" "),t("br"),e._v(" "),t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span",[t("i18n",{attrs:{path:"theOnlyPersonalDataSavedIs",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[t("a",{attrs:{href:"mailto:office@asterics-foundation.org"}},[e._v("office@asterics-foundation.org")])]},proxy:!0}])})],1)])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns offset-by-two",attrs:{disabled:!(e.user&&e.password&&e.password2&&e.password===e.password2&&e.usernameValid&&e.privacyConsent)},on:{click:e.register}},[e._v(e._s(e.$t("register")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("span",[e._v(e._s(e.$t("alreadyHaveAnAccount")))]),e._v(" "),t("a",{attrs:{href:"#login"}},[e._v(e._s(e.$t("toLogin")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("span",[e._v(e._s(e.$t("wantToCreateAnOfflineonlyUser")))]),e._v(" "),t("a",{attrs:{href:"#add"}},[e._v(e._s(e.$t("addOfflineUser")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("div",{directives:[{name:"show",rawName:"v-show",value:void 0===e.registerSuccess,expression:"registerSuccess === undefined"}]},[t("span",[e._v(e._s(e.$t("registering")))]),e._v(" "),t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0==e.registerSuccess,expression:"registerSuccess == false"}]},[t("span",[e._v(e._s(e.$t("registeringFailed")))]),e._v(" "),t("i",{staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("ul",e._l(e.validationErrors,(function(n){return t("li",[e._v(e._s(n))])})),0)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:1==e.registerSuccess,expression:"registerSuccess == true"}]},[t("span",[e._v(e._s(e.$t("successfullyRegistered")))]),e._v(" "),t("i",{staticClass:"fas fa-check",staticStyle:{color:"green"}})])])]),e._v(" "),t("comparison-component")],1),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};gC._withStripped=!0;var fC=function(){var e=this,t=e._self._c;return t("div",[t("accordion",{staticClass:"six columns offset-by-two",attrs:{"acc-label":e.$t("HEADER_COMPARE_ONLINE_OFFLINE")}},[t("div",[t("h3",[e._v(e._s(e.$t("offlineUser")))]),e._v(" "),t("ul",{staticClass:"fa-ul"},[t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("allGridsAreSavedOffline")))])]),e._v(" "),t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("allFunctionsAvailable")))])]),e._v(" "),t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("idealForUsingOnASingleDevice")))])])])]),e._v(" "),t("div",[t("h3",[e._v(e._s(e.$t("onlineUser")))]),e._v(" "),t("ul",{staticClass:"fa-ul"},[t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("allGridsAreSavedOfflineAndOnline")))])]),e._v(" "),t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("automaticSynchronizationAcrossMultipleDevices")))])]),e._v(" "),t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("allDataIsEndtoendEncryptedAndOnlyYouAreAble")))])]),e._v(" "),t("li",[t("span",{staticClass:"fa-li"},[t("i",{staticClass:"fas fa-check"})]),t("span",[e._v(e._s(e.$t("forRegistrationOnlyAUsernameAndAPasswordIsNeeded")))])])])])])],1)};fC._withStripped=!0;const yC={props:[],components:{Accordion:Gg},data:()=>({showInfo:!1}),methods:{},mounted(){}};var _C=s(7303),EC={};EC.styleTagTransform=Ed(),EC.setAttributes=gd(),EC.insert=vd().bind(null,"head"),EC.domAPI=hd(),EC.insertStyleElement=yd(),dd()(_C.A,EC),_C.A&&_C.A.locals&&_C.A.locals;const bC=Cd(yC,fC,[],!1,null,"23d128d4",null).exports,SC={components:{ComparisonComponent:bC,HeaderIcon:Pg},props:[],data:()=>({user:null,usernameValid:null,usernameValidationCode:null,password:null,password2:null,remember:!0,privacyConsent:!1,registerSuccess:null,creationTime:(new Date).getTime(),spamTime:1e4,validationErrors:[]}),methods:{toMain(){TA.toMain()},register(){let e=this,t=(new Date).getTime()-e.creationTime;if(t<e.spamTime)return e.validationErrors=["you were too fast (spambot protection) - please try again in "+(e.spamTime-t)+"ms."],void(e.registerSuccess=!1);e.registerSuccess=void 0,XS.register(this.user,this.password,this.remember).then((()=>{log.info("successfully registered!"),e.registerSuccess=!0,TA.toMain()})).catch((t=>{e.registerSuccess=!1,log.warn(t),t.validationErrors&&(e.validationErrors=[],Object.keys(t.validationErrors).forEach((n=>{e.validationErrors=e.validationErrors.concat(t.validationErrors[n])})))}))},validateUsername(){var e=this;e.usernameValid=void 0,e.usernameValidationCode=null,ee.Z.debounce((()=>{XS.validateUsername(e.user).then((t=>{e.usernameValid=t===C.A.VALIDATION_VALID,e.usernameValidationCode=t}))}),300,"CHECK_USERNAME")}},mounted(){}};var CC=s(6987),wC={};wC.styleTagTransform=Ed(),wC.setAttributes=gd(),wC.insert=vd().bind(null,"head"),wC.domAPI=hd(),wC.insertStyleElement=yd(),dd()(CC.A,wC),CC.A&&CC.A.locals&&CC.A.locals;const AC=Cd(SC,gC,[],!1,null,"2f812c7c",null).exports;var TC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"srow content spaced"},[t("h2",[t("span",{staticClass:"show-mobile"},[e._v("AsTeRICS Grid - ")]),t("span",[e._v(e._s(e.$t("addOfflineUser")))])]),e._v(" "),t("form",{attrs:{autocomplete:"off",onsubmit:"event.preventDefault()"}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"two columns",attrs:{for:"inputUser"}},[t("span",{staticClass:"desktop-right"},[e._v(e._s(e.$t("username")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"},{name:"debounce",rawName:"v-debounce",value:300,expression:"300"},{name:"focus",rawName:"v-focus"}],staticClass:"six columns",attrs:{type:"text",name:"username",autocapitalize:"none",id:"inputUser"},domProps:{value:e.user},on:{input:[function(t){t.target.composing||(e.user=t.target.value)},function(t){e.validationError=void 0}],change:e.validateUsername}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:""!=e.user&&e.validationError,expression:"user != '' && validationError"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-times",staticStyle:{color:"red"}}),e._v(" "),t("span",[e._v(e._s(e._f("translate")(e.validationError)))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.user&&void 0!==e.validationError&&!e.validationError,expression:"user && validationError !== undefined && !validationError"}],staticClass:"three columns"},[t("i",{staticClass:"fas fa-check",staticStyle:{color:"green"}}),e._v(" "),t("span",[e._v(e._s(e.$t("validUsername")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("i",{staticClass:"fas fa-2x fa-info-circle",staticStyle:{color:"blue"}}),e._v(" "),t("span",[e._v("\n                    "+e._s(e.$t("aLocalUserIsStoredOnlyOnThisDevice"))+"\n                ")])])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns offset-by-two",attrs:{disabled:!e.user||void 0===e.validationError||e.validationError},on:{click:e.addUser}},[t("span",[e._v(e._s(e.$t("addUser")))]),e._v("  "),e.loading?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e()])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("span",[e._v(e._s(e.$t("wantToRegisterAnOnlineUser")))]),e._v(" "),t("a",{attrs:{href:"#register"}},[e._v(e._s(e.$t("toRegister")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"six columns offset-by-two"},[t("span",[e._v(e._s(e.$t("alreadyHaveAnAccount")))]),e._v(" "),t("a",{attrs:{href:"#login"}},[e._v(e._s(e.$t("toLogin")))])])]),e._v(" "),t("comparison-component")],1),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};TC._withStripped=!0;const IC={components:{ComparisonComponent:bC,HeaderIcon:Pg},props:[],data:()=>({user:null,validationError:void 0,showInfo:!1,savedUsers:n.w.getSavedUsers(),loading:!1}),methods:{toMain(){TA.toMain()},addUser(){let e=this;e.loading=!0,null==e.validationError&&XS.registerOffline(e.user,e.user).then((()=>{TA.toManageGrids()}))},validateUsername(){this.validationError=void 0,C.A.USERNAME_REGEX.test(this.user)?this.savedUsers.includes(this.user)||XS.getLoggedInUsername()===this.user?this.validationError=C.A.VALIDATION_ERROR_EXISTING:this.validationError=null:this.validationError=C.A.VALIDATION_ERROR_REGEX}},mounted(){}};var kC=s(1772),OC={};OC.styleTagTransform=Ed(),OC.setAttributes=gd(),OC.insert=vd().bind(null,"head"),OC.domAPI=hd(),OC.insertStyleElement=yd(),dd()(kC.A,OC),kC.A&&kC.A.locals&&kC.A.locals;const RC=Cd(IC,TC,[],!1,null,"74556b0e",null).exports;var xC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"container ms-0"},[t("div",{staticClass:"row ps-2 ps-sm-3 ps-md-4 col-12 col-md-10 col-xl-8"},[t("h2",[t("span",{staticClass:"show-mobile"},[e._v("AsTeRICS Grid - ")]),t("span",[e._v(e._s(e.$t("welcome")))])]),e._v(" "),t("div",[t("h3",[t("i18n",{attrs:{path:"useAstericsGridWithoutRegistrationBold",tag:"span"},scopedSlots:e._u([{key:"withoutReg",fn:function(){return[t("strong",[e._v(e._s(e.$t("withoutRegistration")))])]},proxy:!0}])})],1),e._v(" "),t("ul",{staticClass:"fa-ul"},[t("li",[e._m(0),t("span",[e._v(e._s(e.$t("allGridsAreSavedOffline")))])]),e._v(" "),t("li",[e._m(1),t("span",[e._v(e._s(e.$t("allFunctionsAvailable")))])]),e._v(" "),t("li",[e._m(2),t("span",[e._v(e._s(e.$t("idealForUsingOnASingleDevice")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("button",{staticClass:"big-button col-12",on:{click:function(t){return e.useDefaultUser()}}},[t("i",{staticClass:"fas fa-user-secret me-2"}),e._v(" "),t("span",[e._v(e._s(e.$t("useAstericsGridWithoutRegistration")))]),e._v("  "),e.loading?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e()])])]),e._v(" "),t("div",[t("span",{staticClass:"fa fa-info-circle"}),t("span",{staticClass:"break-word"},[e._v(e._s(e.$t("itsAlwaysPossibleToRegisterLater")))])])]),e._v(" "),t("div",{staticClass:"mt-4"},[t("h3",[t("i18n",{attrs:{path:"useAstericsGridWithRegistration",tag:"span"},scopedSlots:e._u([{key:"withReg",fn:function(){return[t("strong",[e._v(e._s(e.$t("withRegistration")))])]},proxy:!0}])})],1),e._v(" "),t("ul",{staticClass:"fa-ul"},[t("li",[e._m(3),t("span",[e._v(e._s(e.$t("allGridsAreSavedOfflineAndOnline")))])]),e._v(" "),t("li",[e._m(4),t("span",[e._v(e._s(e.$t("automaticSynchronizationAcrossMultipleDevices")))])]),e._v(" "),t("li",[e._m(5),t("span",[e._v(e._s(e.$t("allDataIsEndtoendEncryptedAndOnlyYouAreAble")))])]),e._v(" "),t("li",[e._m(6),t("span",[e._v(e._s(e.$t("forRegistrationOnlyAUsernameAndAPasswordIsNeeded")))])])]),e._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("button",{staticClass:"big-button col-12",on:{click:function(t){return e.toRegister()}}},[t("i",{staticClass:"fas fa-user-plus me-2"}),e._v(" "+e._s(e.$t("registerNow")))])])])]),e._v(" "),t("div",{staticClass:"my-5"},[t("span",[e._v(e._s(e.$t("alreadyHaveAnAccount")))]),e._v(" "),t("a",{attrs:{href:"#login"}},[e._v(e._s(e.$t("toLogin")))])]),e._v(" "),t("div",[t("b",[e._v(e._s(e.$t("hint")))]),e._v(" "),t("i18n",{attrs:{path:"ifYouNeedHelpWithinAstericsGrid",tag:"span"},scopedSlots:e._u([{key:"openHelpIcon",fn:function(){return[t("a",{attrs:{href:"javascript:;"},on:{click:e.openHelp}},[t("i",{staticClass:"fas fa-question-circle"})])]},proxy:!0}])})],1)])])],1)};xC._withStripped=!0;const NC={components:{HeaderIcon:Pg},props:[],data:()=>({loading:!1}),methods:{toMain(){TA.toMain()},toRegister(){TA.toRegister()},useDefaultUser(){this.loading=!0,XS.registerOffline(C.A.LOCAL_NOLOGIN_USERNAME,C.A.LOCAL_NOLOGIN_USERNAME).then((()=>{TA.toManageGrids()}))},openHelp(){Qc.openHelp()}},mounted(){}};var DC=s(9858),LC={};LC.styleTagTransform=Ed(),LC.setAttributes=gd(),LC.insert=vd().bind(null,"head"),LC.domAPI=hd(),LC.insertStyleElement=yd(),dd()(DC.A,LC),DC.A&&DC.A.locals&&DC.A.locals;const PC=Cd(NC,xC,[function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])},function(){var e=this._self._c;return e("span",{staticClass:"fa-li"},[e("i",{staticClass:"fas fa-check"})])}],!1,null,"9f5c7004",null).exports;var MC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"srow content spaced",staticStyle:{"max-width":"900px"}},[t("h2",{staticClass:"twelve columns"},[e._v(e._s(e.$t("aboutAstericsGrid")))]),e._v(" "),t("div",[t("div",{staticClass:"srow"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("generalInformation")))]),e._v(" "),t("div",[e._v("\n                    "+e._s(e.$t("astericsGridIsFreeAndOpenSource"))),t("br"),e._v(" "),t("a",{attrs:{target:"_blank",href:"https://github.com/asterics/AsTeRICS-Grid"}},[e._v(e._s(e.$t("astericsGridOnGithub")))]),t("br"),t("br")]),e._v(" "),t("div",[t("span",[e._v(e._s(e.$t("astericsGridWasFundedWithinProjects")))]),e._v(":\n                    "),t("ul",{staticClass:"mt-3 mb-2",staticStyle:{"list-style-type":"none"}},[t("project-acknowledgement",{attrs:{"name-link":"https://embsys.technikum-wien.at/projects/torades/index.php","name-label":"Toolbox for Rapid Design of Smart Homes and Assistive Technologies (ToRaDes)","host-link":"https://www.technikum-wien.at/","host-label":"UAS Technikum Wien // FH Technikum Wien","fund-link":"https://www.wien.gv.at/kontakte/ma23/index.html","fund-label":"City of Vienna // Stadt Wien",timespan:"2018-2019","additional-info":"Project 18-04 // Projekt 18-04"}}),e._v(" "),t("project-acknowledgement",{attrs:{"name-link":"https://embsys.technikum-wien.at/projects/khat/index.php","name-label":"Knowledge Hub for Accessible Technologies (WBT) // Wissensdrehscheibe für Barrierefreie Technologien (WBT)","host-link":"https://www.technikum-wien.at/","host-label":"UAS Technikum Wien // FH Technikum Wien","fund-link":"https://www.wien.gv.at/kontakte/ma23/index.html","fund-label":"City of Vienna // Stadt Wien",timespan:"2019-2023","additional-info":"Project 26-02 // Projekt 26-02"}}),e._v(" "),t("project-acknowledgement",{attrs:{"name-link":"https://www.technikum-wien.at/forschungsprojekte/inclusion-international/","name-label":"Inclusion International (In2)","host-link":"https://www.technikum-wien.at/","host-label":"UAS Technikum Wien // FH Technikum Wien","fund-link":"https://www.wien.gv.at/kontakte/ma23/index.html","fund-label":"City of Vienna // Stadt Wien",timespan:"2022-2025","additional-info":"Project 33-02 // Projekt 33-02"}}),e._v(" "),t("project-acknowledgement",{attrs:{"name-link":"https://www.netidee.at/asterics-grid","name-label":"netidee project funding // netidee Projektförderung","fund-link":"https://www.internetstiftung.at/","fund-label":"Internet Foundation Austria // Internet Privatstiftung Austria",timespan:"2024-2025","additional-info":"Call 18"}}),e._v(" "),t("project-acknowledgement",{attrs:{"name-link":"https://www.technikum-wien.at/forschungsprojekte/indiko/","name-label":"Inclusion via digital augmentative and alternative communication (InDiKo) // Inklusion durch Digital Unterstützte Kommunikation (InDiKo)","host-link":"https://www.technikum-wien.at/","host-label":"UAS Technikum Wien // FH Technikum Wien","fund-link":"https://www.wien.gv.at/kontakte/ma23/index.html","fund-label":"City of Vienna // Stadt Wien",timespan:"2024-2028","additional-info":"Project 38-09 // Projekt 38-09"}})],1)]),e._v(" "),t("div",[t("div",{staticClass:"d-block d-lg-flex justify-content-between align-items-center"},[e._m(0),e._v(" "),t("div",{staticClass:"mt-3"},[t("a",{attrs:{href:"https://www.wien.gv.at/kontakte/ma23/",target:"_blank",title:e.$t("ma23CityOfVienna")}},[t("img",{attrs:{src:"app/img/ma23_logo_neu.jpg",height:"90"}})])]),e._v(" "),e._m(1)]),e._v(" "),t("i18n",{staticClass:"mb-3 mt-5",attrs:{path:"arasaacCollaboration",tag:"div"},scopedSlots:e._u([{key:"arasaacLink",fn:function(){return[t("a",{attrs:{href:"https://arasaac.org/",target:"_blank"}},[e._v(e._s(e.$t("aragoneseCenterOfAAC")))])]},proxy:!0}])}),e._v(" "),e._m(2)],1)]),e._v(" "),t("div",{staticClass:"srow"},[t("h3",[e._v(e._s(e.$t("termsOfServiceAndPrivacyPolicy")))]),e._v(" "),t("div",[t("i18n",{attrs:{path:"astericsGridLicenseInfo",tag:"p"},scopedSlots:e._u([{key:"agplLink",fn:function(){return[t("a",{attrs:{href:"https://github.com/asterics/AsTeRICS-Grid/blob/master/LICENSE",target:"_blank"}},[e._v("AGPLv3")])]},proxy:!0}])}),e._v(" "),t("i18n",{attrs:{path:"ytTermsInfo",tag:"p"},scopedSlots:e._u([{key:"ytTerms",fn:function(){return[t("a",{attrs:{href:"https://www.youtube.com/t/terms",target:"_blank"}},[e._v(e._s(e.$t("youtubeTermsOfService")))])]},proxy:!0},{key:"googleTerms",fn:function(){return[t("a",{attrs:{href:"https://policies.google.com/privacy",target:"_blank"}},[e._v(e._s(e.$t("googlePrivacyPolicy")))])]},proxy:!0},{key:"ytAPI",fn:function(){return[t("a",{attrs:{href:"https://developers.google.com/youtube/v3",target:"_blank"}},[e._v(e._s(e.$t("youtubeDataApi")))])]},proxy:!0}])}),e._v(" "),t("i18n",{attrs:{path:"privacyPolicyInfo",tag:"span"},scopedSlots:e._u([{key:"privacyPolicy",fn:function(){return[t("a",{attrs:{href:"app/privacy_en.html?back=about"}},[e._v(e._s(e.$t("privacyPolicy")))])]},proxy:!0},{key:"privacyPolicyDe",fn:function(){return[t("a",{attrs:{href:"app/privacy_de.html?back=about"}},[e._v(e._s(e.$t("privacyPolicy")))])]},proxy:!0}])})],1)]),e._v(" "),t("div",{staticClass:"srow"},[t("h3",[e._v(e._s(e.$t("supportUs")))]),e._v(" "),t("span",[e._v(e._s(e.$t("ifYouWantToSupportAstericsGrid")))]),e._v(":\n                "),t("div",[t("a",{staticClass:"me-3",attrs:{title:e.$t("donateWithPaypal"),target:"_blank",href:"https://www.paypal.com/donate/?hosted_button_id=38AJJNS427MJ2"}},[t("img",{staticClass:"mt-4",staticStyle:{border:"0px","max-width":"75vw"},attrs:{alt:"",src:"app/img/donate-paypal.png",width:"250"}})]),e._v(" "),t("a",{attrs:{title:e.$t("donateAtOpencollective"),target:"_blank",href:"https://opencollective.com/asterics-foundation/projects/asterics-grid"}},[t("img",{staticClass:"mt-4",staticStyle:{border:"0px","max-width":"75vw"},attrs:{alt:"",src:"app/img/donate-open-collective.png",width:"250"}})])])]),e._v(" "),t("div",{staticClass:"srow"},[t("h3",[e._v(e._s(e.$t("acknowledgements")))]),e._v(" "),t("i18n",{staticClass:"mb-3",attrs:{path:"thankBrowserstack",tag:"div"},scopedSlots:e._u([{key:"browserstackUrl",fn:function(){return[t("a",{attrs:{target:"_blank",href:"https://www.browserstack.com//"}},[e._v("browserstack.com")])]},proxy:!0}])}),e._v(" "),t("i18n",{attrs:{path:"thankResponsiveVoice",tag:"div"},scopedSlots:e._u([{key:"responsiveVoiceUrl",fn:function(){return[t("a",{attrs:{target:"_blank",href:"https://responsivevoice.org"}},[e._v("ResponsiveVoice.org")])]},proxy:!0}])}),e._v(" "),t("div",{staticClass:"mb-3"},[t("a",{attrs:{href:"https://responsivevoice.org"}},[e._v("ResponsiveVoice-NonCommercial")]),e._v(" "+e._s(e.$t("licensedUnder"))+" "),e._m(3)]),e._v(" "),t("div",[e._v("\n                    "+e._s(e.$t("thanksToEduardoLleidaSolanoProfessorAtDepartment"))+"\n                ")])],1),e._v(" "),t("div",{staticClass:"srow",staticStyle:{"margin-top":"3em"}},[t("i18n",{attrs:{path:"youreUsingAstericsGridVersion",tag:"div"},scopedSlots:e._u([{key:"gridVersion",fn:function(){return[t("a",{attrs:{target:"_blank",href:"https://github.com/asterics/AsTeRICS-Grid/releases/tag/release-2025-05-06-11.21/+0200"}},[e._v("release-2025-05-06-11.21/+0200")])]},proxy:!0}])})],1)])]),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};MC._withStripped=!0;var UC=function(){var e=this,t=e._self._c;return t("li",[t("strong",[e._v(e._s(e.timespan)+":")]),e._v(" "),t("span",[t("a",{attrs:{href:e.nameLink,target:"_blank"}},[e._v(e._s(e.getLabel(e.nameLabel)))]),e._v(", ")]),e._v(" "),e.hostLabel?t("span",[t("a",{attrs:{href:e.hostLink,target:"_blank"}},[e._v(e._s(e.getLabel(e.hostLabel)))]),e._v(", ")]):e._e(),e._v(" "),t("span",[e._v(e._s(e.$t("fundedBy")))]),e._v(" "),e.fundLabel?t("span",[t("a",{attrs:{href:e.fundLink,target:"_blank"}},[e._v(e._s(e.getLabel(e.fundLabel)))])]):e._e(),e.additionalInfo?t("span",[e._v(", "+e._s(e.getLabel(e.additionalInfo)))]):e._e()])};UC._withStripped=!0;const FC={components:{ProjectAcknowledgement:Cd({props:["timespan","nameLink","nameLabel","hostLink","hostLabel","fundLink","fundLabel","additionalInfo"],data:()=>({}),methods:{getLabel(e=""){if(!e.includes(" // "))return e;let t=e.split(" // ");return o.A.isCurrentAppLangDE()?t[1]:t[0]}},mounted(){}},UC,[],!1,null,"10eab97d",null).exports,HeaderIcon:Pg},props:[],data:()=>({}),methods:{toMain(){TA.toMain()},toRegister(){TA.toRegister()}},mounted(){}};var BC=s(8201),GC={};GC.styleTagTransform=Ed(),GC.setAttributes=gd(),GC.insert=vd().bind(null,"head"),GC.domAPI=hd(),GC.insertStyleElement=yd(),dd()(BC.A,GC),BC.A&&BC.A.locals&&BC.A.locals;const $C=Cd(FC,MC,[function(){var e=this._self._c;return e("div",{staticClass:"mt-3"},[e("a",{attrs:{href:"https://www.technikum-wien.at/",target:"_blank",title:"UAS Technikum Wien"}},[e("img",{attrs:{src:"app/img/fhtw.svg",height:"90"}})])])},function(){var e=this._self._c;return e("div",{staticClass:"mt-3"},[e("a",{attrs:{href:"https://www.netidee.at/asterics-grid",target:"_blank",title:"netidee"}},[e("img",{attrs:{src:"app/img/netidee.svg",height:"50"}})])])},function(){var e=this._self._c;return e("a",{attrs:{href:"https://arasaac.org/",title:"ARASAAC","aria-hidden":"true",target:"_blank"}},[e("img",{attrs:{src:"app/img/arasaac.png",width:"250px"}})])},function(){var e=this._self._c;return e("a",{attrs:{href:"https://creativecommons.org/licenses/by-nc-nd/4.0/"}},[e("img",{attrs:{title:"ResponsiveVoice Text To Speech",src:"app/img/responsive-voice-license.png",alt:"95x15",width:"95",height:"15"}})])}],!1,null,"19da73e0",null).exports;var VC=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"overflow-content box"},[t("div",{attrs:{"aria-hidden":e.showWordsModal||e.showImportModal}},[t("div",{staticClass:"all-dicts-view"},[t("header",{staticClass:"srow header",attrs:{role:"toolbar"}},[t("header-icon"),e._v(" "),t("button",{staticClass:"small spaced",attrs:{tabindex:"32","aria-label":e.$t("newEmptyDictionary")},on:{click:function(t){return e.addDictionary()}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("newEmptyDictionary")))])]),e._v(" "),t("button",{staticClass:"small spaced",attrs:{tabindex:"31","aria-label":e.$t("importDictionary")},on:{click:function(t){e.showImportModal=!0}}},[t("i",{staticClass:"fas fa-file-import"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("importDictionary")))])])],1),e._v(" "),t("div",{staticClass:"srow content text-content"},[e.dicts?e._e():t("div",{staticClass:"grid-container grid-mask"},[t("i",{staticClass:"fas fa-4x fa-spinner fa-spin"})]),e._v(" "),t("h2",[e._v(e._s(e.$t("savedDictionaries")))]),e._v(" "),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.dicts&&e.dicts.length>0,expression:"dicts && dicts.length > 0"}],attrs:{id:"dictList"}},[t("li",{staticClass:"hide-mobile table-headers"},[t("span",{staticClass:"four columns"},[e._v(e._s(e.$t("dictionaryName")))]),e._v(" "),t("span",{staticClass:"four columns"},[e._v(e._s(e.$t("actions")))]),t("br")]),e._v(" "),e._l(e.dicts,(function(n){return t("li",{staticClass:"dict-table-elem"},[t("div",{staticClass:"srow"},[t("div",{staticClass:"four columns"},[e.editModeId!==n.id?t("div",[e._v("\n                                    "+e._s(n.dictionaryKey)+"\n                                    "),t("button",{staticClass:"small-button",attrs:{title:e.$t("editName")},on:{click:function(t){return e.enableEditName(n)}}},[t("i",{staticClass:"far fa-edit"})])]):e._e(),e._v(" "),e.editModeId===n.id?t("div",[t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:n.dictionaryKey,expression:"dict.dictionaryKey"}],attrs:{type:"text"},domProps:{value:n.dictionaryKey},on:{input:function(t){t.target.composing||e.$set(n,"dictionaryKey",t.target.value)}}}),e._v(" "),t("div",{staticClass:"inline"},[e.originalLabel?t("button",{staticClass:"small-button",attrs:{title:e.$t("cancelEditName")},on:{click:function(t){return e.cancelEditName()}}},[t("i",{staticClass:"fas fa-times"})]):e._e(),e._v(" "),t("button",{staticClass:"small-button",attrs:{title:e.$t("saveName"),disabled:e.isLabelDuplicate(n.dictionaryKey)},on:{click:function(t){return e.finishEditName(n)}}},[t("i",{staticClass:"fas fa-check"})])])]):e._e()]),e._v(" "),t("div",{staticClass:"eight columns actionbuttons",staticStyle:{display:"flex","padding-right":"1em"}},[t("div",{staticClass:"four columns show-mobile",staticStyle:{margin:"0.5em 0 0 0.2em"}},[e._v(e._s(e.$t("actions"))+"\n                                ")]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("edit")},on:{click:function(t){return e.edit(n)}}},[t("i",{staticClass:"far fa-edit"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("edit")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("clone")},on:{click:function(t){return e.clone(n.id)}}},[t("i",{staticClass:"far fa-clone"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("clone")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("delete")},on:{click:function(t){return e.deleteDict(n.id,n.dictionaryKey)}}},[t("i",{staticClass:"far fa-trash-alt"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("delete")))])]),e._v(" "),t("button",{attrs:{"aria-label":e.$t("save")},on:{click:function(t){return e.downloadDict(n.id,n.dictionaryKey)}}},[t("i",{staticClass:"fas fa-download"}),e._v(" "),t("span",{staticClass:"hide-mobile"},[e._v(e._s(e.$t("save")))])])])]),e._v(" "),e.editId===n.id?t("div",{staticClass:"edit-container"},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns"},[e._v(e._s(e.$t("language")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:n.lang,expression:"dict.lang"}],staticClass:"four columns",on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(n,"lang",t.target.multiple?r:r[0])}}},e._l(e.languages,(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslation")(n)))])})),0),e._v(" "),t("button",{staticClass:"five columns",on:{click:function(t){e.showWordsModal=!0,e.modalDict=n}}},[t("i",{staticClass:"fas fa-file-import"}),e._v(" "),t("span",[e._v(e._s(e.$t("importWords")))])])]),e._v(" "),t("div",{staticClass:"srow mt-3 mb-4"},[t("search-bar",{attrs:{placeholder:"searchWord"},on:{input:function(t){return e.inputSearchWord()}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("span",[e._v(e._s(e.$t("words")))]),e._v(" "),t("ul",{staticStyle:{"margin-left":"0"}},e._l(e.wordlist,(function(r){return t("li",[t("button",{staticClass:"small-button",staticStyle:{"margin-right":"0.5em"},attrs:{title:e.$t("deleteWordParam",[r])},on:{click:function(t){return e.deleteWord(r,n)}}},[t("i",{staticClass:"far fa-trash-alt"})]),e._v(" "),t("span",[e._v(e._s(r))])])})),0),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.totalWords>e.wordlist.length&&""===e.searchWord,expression:"totalWords > wordlist.length && searchWord === ''"}]},[e._v("\n                                "+e._s(e.totalWords-e.wordlist.length)+"\n                                "),t("span",[e._v(e._s(e.$t("moreWordsAvailableTypeInSearchFieldToFilter")))])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.filterWords>e.wordlist.length&&""!==e.searchWord,expression:"filterWords > wordlist.length && searchWord !== ''"}]},[e._v("\n                                "+e._s(e.filterWords-e.wordlist.length)+"\n                                "),t("span",[e._v(e._s(e.$t("moreWordsForThisFilterRefineSearchToShowMore")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.searchWord&&e.totalWords>0&&0===e.wordlist.length,expression:"searchWord && totalWords > 0 && wordlist.length === 0"}]},[t("span",[e._v(e._s(e.$t("noWordsForThisFilterClearSearchField")))]),e._v(" "),t("button",{on:{click:function(t){return e.inputSearchWord("")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("clear")))])])]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:0===e.totalWords,expression:"totalWords === 0"}]},[e._v(e._s(e.$t("thisDictionaryContainsNoWords")))])])]):e._e()])}))],2),e._v(" "),e.dicts&&0!==e.dicts.length?e._e():t("p",[e._v("\n                    "+e._s(e.$t("noDictionariesFound"))+"\n                ")])]),e._v(" "),t("div",{staticClass:"bottom-spacer"})])]),e._v(" "),e.showWordsModal?t("import-words-modal",{attrs:{"dict-data":e.modalDict},on:{close:function(t){e.showWordsModal=!1},reload:e.reload}}):e._e(),e._v(" "),e.showImportModal?t("import-dictionary-modal",{attrs:{dicts:e.dicts},on:{close:function(t){e.showImportModal=!1},reload:e.reload}}):e._e()],1)};VC._withStripped=!0;var jC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:[function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.save():null}]}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("a",{staticClass:"close-button",attrs:{href:"javascript:;"},on:{click:function(t){return e.openHelp()}}},[t("i",{staticClass:"fas fa-question-circle"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("importWordsToDictionary"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body container"},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"inputText"}},[e._v(e._s(e.$t("input")))]),e._v(" "),t("span",{staticClass:"nine columns"},[e._v(e._s(e.$t("insertWordsSeparatedBySpaceEnter")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{staticClass:"nine columns offset-by-three btn-accordion",staticStyle:{"margin-bottom":"0"},on:{click:()=>{e.showAdvanced=!e.showAdvanced}}},[t("i",{directives:[{name:"show",rawName:"v-show",value:!e.showAdvanced,expression:"!showAdvanced"}],staticClass:"fas fa-chevron-down"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.showAdvanced,expression:"showAdvanced"}],staticClass:"fas fa-chevron-up"}),e._v(" "),t("span",[e._v(e._s(e.$t("advancedOptions")))])])]),e._v(" "),e.showAdvanced?t("div",{staticClass:"srow"},[t("div",{staticClass:"nine columns offset-by-three",staticStyle:{"background-color":"whitesmoke"}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"five columns",attrs:{for:"inputElementSeparator"}},[e._v(e._s(e.$t("elementSeparator")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.elementSeparator,expression:"elementSeparator"}],attrs:{id:"inputElementSeparator",type:"text"},domProps:{value:e.elementSeparator},on:{input:[function(t){t.target.composing||(e.elementSeparator=t.target.value)},e.textChanged]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"five columns",attrs:{for:"inputRankSeparator"}},[e._v(e._s(e.$t("inelementSeparator")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.rankSeparator,expression:"rankSeparator"}],attrs:{id:"inputRankSeparator",type:"text"},domProps:{value:e.rankSeparator},on:{input:[function(t){t.target.composing||(e.rankSeparator=t.target.value)},e.textChanged]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"five columns",attrs:{for:"inputElIndex"}},[e._v(e._s(e.$t("wordIndex0based")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.wordPosition,expression:"wordPosition"}],attrs:{id:"inputElIndex",type:"number"},domProps:{value:e.wordPosition},on:{input:[function(t){t.target.composing||(e.wordPosition=t.target.value)},e.textChanged]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"five columns",attrs:{for:"inputRankIndex"}},[e._v(e._s(e.$t("rankIndex0based")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.rankPosition,expression:"rankPosition"}],attrs:{id:"inputRankIndex",type:"number"},domProps:{value:e.rankPosition},on:{input:[function(t){t.target.composing||(e.rankPosition=t.target.value)},e.textChanged]}})])])]):e._e(),e._v(" "),t("div",{staticClass:"srow"},[t("textarea",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.inputText,expression:"inputText"}],staticClass:"twelve columns",staticStyle:{resize:"vertical","min-height":"70px"},attrs:{id:"inputText",placeholder:e.$t("word1Word2Word3")},domProps:{value:e.inputText},on:{input:[function(t){t.target.composing||(e.inputText=t.target.value)},e.textChanged]}})]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns"},[e._v(e._s(e.$t("recognizedWords")))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.parsedElems.length>0,expression:"parsedElems.length > 0"}],staticClass:"nine columns"},[t("span",[e._v(e._s(e.elementCount))]),e._v(" "),t("span",[e._v(e._s(e.$t("wordsBracket")))]),e._v(" "),t("span",{staticClass:"break-word"},[e._v(e._s(JSON.stringify(e.parsedElems)))]),e._v(" "),e.parsedElems.length<e.elementCount?t("span",[e._v("...")]):e._e()]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.parsedElems.length,expression:"parsedElems.length === 0"}],staticClass:"nine columns"},[t("span",[e._v(e._s(e.$t("noWords")))])])])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container"},[t("button",{attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{attrs:{title:e.$t("keyboardCtrlEnter"),disabled:0==e.parsedElems.length},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("insertWords")))])])])])])])])])};jC._withStripped=!0;let KC=Te.instance();const WC={props:["dictData"],data:function(){return{inputText:"",parsedElems:[],elementCount:0,elementSeparator:"[\\n; ]",rankSeparator:null,wordPosition:null,rankPosition:null,showAdvanced:!1,originalPredictionary:null}},methods:{textChanged(){KC=Te.instance(),this.parseInternal(KC),this.parsedElems=KC.predict("",{maxPredicitons:20}),this.elementCount=KC.getWords().length},save(){var e=this;e.parseInternal(this.originalPredictionary),e.dictData.data=this.originalPredictionary.dictionaryToJSON(this.dictData.dictionaryKey),xg.saveDictionary(e.dictData).then((()=>{e.$emit("reload",e.dictData),e.$emit("close")}))},parseInternal(e){try{e.parseWords(this.inputText,{elementSeparator:new RegExp(this.elementSeparator),rankSeparator:new RegExp(this.rankSeparator),wordPosition:this.wordPosition,rankPosition:this.rankPosition,addToDictionary:this.dictData.dictionaryKey})}catch(e){log.warn("error parsing words: "+e)}},openHelp(){Qc.openHelp()}},mounted(){this.originalPredictionary=Te.instance(),this.originalPredictionary.loadDictionary(this.dictData.data,this.dictData.dictionaryKey),Qc.setHelpLocation("07_dictionaries","#add-words")},beforeDestroy(){Qc.revertToLastLocation()}};var qC=s(532),HC={};HC.styleTagTransform=Ed(),HC.setAttributes=gd(),HC.insert=vd().bind(null,"head"),HC.domAPI=hd(),HC.insertStyleElement=yd(),dd()(qC.A,HC),qC.A&&qC.A.locals&&qC.A.locals;const YC=Cd(WC,jC,[],!1,null,"4a48b089",null).exports;var zC=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container",on:{keyup:function(t){return t.type.indexOf("key")||27===t.keyCode?e.$emit("close"):null}}},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("div",{staticClass:"modal-header"},[t("h1",{attrs:{name:"header"}},[e._v("\n                        "+e._s(e.$t("importDictionary"))+"\n                    ")])]),e._v(" "),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"srow",staticStyle:{"margin-bottom":"3em"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.importType,expression:"importType"}],attrs:{type:"radio",id:"radiopredef",name:"importType"},domProps:{value:e.c.SELECT_ONLINE,checked:e._q(e.importType,e.c.SELECT_ONLINE)},on:{change:function(t){e.importType=e.c.SELECT_ONLINE}}}),e._v(" "),t("label",{attrs:{for:"radiopredef"}},[e._v(e._s(e.$t("importFromOnlineDictionaries")))]),t("br"),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.importType,expression:"importType"}],attrs:{type:"radio",id:"radiofile",name:"importType"},domProps:{value:e.c.SELECT_FILE,checked:e._q(e.importType,e.c.SELECT_FILE)},on:{change:function(t){e.importType=e.c.SELECT_FILE}}}),e._v(" "),t("label",{attrs:{for:"radiofile"}},[e._v(e._s(e.$t("importFromFile")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.importType===e.c.SELECT_ONLINE,expression:"importType === c.SELECT_ONLINE"}]},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"selectDict"}},[e._v(e._s(e.$t("selectDictionary")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedOption,expression:"selectedOption"}],staticClass:"nine columns",attrs:{id:"selectDict",type:"file"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedOption=t.target.multiple?n:n[0]},function(t){return e.console.log(e.selectedOption.lang)}]}},[t("option",{attrs:{disabled:"",selected:"",hidden:""},domProps:{value:null}},[e._v(e._s(e.$t("pleaseSelect")))]),e._v(" "),e._l(e.options,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(n.name))])}))],2)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedOption&&e.selectedOption.type===e.c.OPTION_TYPE_GITHUB_FREQUENCYWORDS,expression:"selectedOption && selectedOption.type === c.OPTION_TYPE_GITHUB_FREQUENCYWORDS"}],staticClass:"srow"},[t("div",{staticClass:"nine columns offset-by-three"},[t("span",[e._v(e._s(e.$t("thanksToHermitDaveForSupplyingDataForThis"))+" ")]),e._v(" "),t("a",{attrs:{href:"https://github.com/hermitdave/FrequencyWords",target:"_blank"}},[e._v("Github.com")])])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.importType===e.c.SELECT_FILE,expression:"importType === c.SELECT_FILE"}]},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"fileInput"}},[e._v(e._s(e.$t("selectFile")))]),e._v(" "),t("input",{staticClass:"nine columns",attrs:{id:"fileInput",type:"file",accept:".json"},on:{change:e.onFileSelect}})])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.error,expression:"!!error"}],staticClass:"srow",staticStyle:{color:"darkred","margin-top":"2.5em"}},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" "),t("span",[e._v(e._s(e._f("translate")(e.error)))])])]),e._v(" "),t("div",{staticClass:"modal-footer"},[t("div",{staticClass:"button-container srow"},[t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardEsc")},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" "),t("span",[e._v(e._s(e.$t("cancel")))])]),e._v(" "),t("button",{staticClass:"six columns",attrs:{title:e.$t("keyboardCtrlEnter"),disabled:e.importType===e.c.SELECT_ONLINE&&!e.selectedOption||e.importType===e.c.SELECT_FILE&&!e.selectedFile},on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("importDictionary")))]),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"fas fa-spinner fa-spin"})])])])])])])])};zC._withStripped=!0;let JC={OPTION_TYPE_PREDEFINED:"OPTION_TYPE_PREDEFINED",OPTION_TYPE_GITHUB_FREQUENCYWORDS:"OPTION_TYPE_GITHUB_FREQUENCYWORDS",SELECT_FILE:"SELECT_FILE",SELECT_ONLINE:"SELECT_ONLINE"};const XC={props:["dicts"],data:function(){return{importType:JC.SELECT_ONLINE,options:[{name:o.A.t("astericsGridGermanDefault"),downloadUrl:"https://raw.githubusercontent.com/asterics/AsTeRICS-Grid/master/app/dictionaries/default_de.json",type:JC.OPTION_TYPE_PREDEFINED,lang:"de"},{name:o.A.t("astericsGridEnglishDefault"),downloadUrl:"https://raw.githubusercontent.com/asterics/AsTeRICS-Grid/master/app/dictionaries/default_en.json",type:JC.OPTION_TYPE_PREDEFINED,lang:"en"}],selectedOption:null,selectedFile:null,c:JC,error:null,loading:!1,console}},methods:{save(){let e=this;this.error="",this.loading=!0;let t=this.dicts.map((e=>e.dictionaryKey));if(this.importType===JC.SELECT_ONLINE){let e,t=Te.instance();this.requestDict(this.selectedOption.downloadUrl,this.selectedOption.downloadUrl2).then((r=>{this.selectedOption.type===JC.OPTION_TYPE_GITHUB_FREQUENCYWORDS?(t.parseWords(r,{elementSeparator:"\n",rankIsIndex:!0}),e=t.dictionaryToJSON()):this.selectedOption.type===JC.OPTION_TYPE_PREDEFINED&&(e=r),n(e)})).catch((e=>{this.error=e,this.loading=!1}))}else if(this.importType===JC.SELECT_FILE){let t=new FileReader;t.onload=function(t){try{let e=JSON.parse(t.target.result),r=Object.keys(e)[0];if(void 0===e[r].f||void 0===e[r].t)throw new Error;n(t.target.result)}catch(t){e.error=o.A.t("theSelectedFileDoesNotContainDict"),e.loading=!1}},t.readAsText(this.selectedFile)}function n(n){let r=e.importType===JC.SELECT_ONLINE?e.selectedOption.name:e.selectedFile.name.replace("dictionary-","").replace(".json",""),i=new le({dictionaryKey:u.S.getNewName(r,t),data:n,isDefault:!0,lang:e.selectedOption.lang});return xg.saveDictionary(i).then((()=>{e.$emit("reload",i),e.$emit("close")}))}},onFileSelect(e){this.selectedFile=e.target.files[0],this.error=""},requestDict(e,t){return new Promise(((n,r)=>{$.ajax({url:e,dataType:"text",accepts:{text:"application/vnd.github.v3.raw"}}).then((e=>n(e))).fail((()=>{if(!t)return r(o.A.t("couldNotDownloadDictCheckInternet"));log.warn("first try to download dict failed. second try..."),this.requestDict(t).then(n).catch(r)}))}))}},mounted(){let e=JSON.parse('[{"langCode":"af","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/af/af_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/af/af_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ar","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ar/ar_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ar/ar_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"bg","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bg/bg_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bg/bg_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"bn","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bn/bn_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bn/bn_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"br","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/br/br_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/br/br_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"bs","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bs/bs_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/bs/bs_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ca","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ca/ca_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ca/ca_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"cs","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/cs/cs_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/cs/cs_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"da","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/da/da_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/da/da_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"de","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/de/de_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/de/de_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"el","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/el/el_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/el/el_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"en","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/en/en_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/en/en_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"eo","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/eo/eo_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/eo/eo_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"es","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/es/es_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/es/es_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"et","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/et/et_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/et/et_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"eu","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/eu/eu_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/eu/eu_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"fa","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fa/fa_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fa/fa_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"fi","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fi/fi_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fi/fi_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"fr","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fr/fr_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/fr/fr_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"gl","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/gl/gl_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/gl/gl_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"he","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/he/he_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/he/he_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"hi","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hi/hi_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hi/hi_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"hr","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hr/hr_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hr/hr_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"hu","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hu/hu_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hu/hu_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"hy","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hy/hy_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/hy/hy_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"id","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/id/id_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/id/id_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"is","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/is/is_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/is/is_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"it","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/it/it_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/it/it_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ja","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ja/ja_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ja/ja_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ka","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ka/ka_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ka/ka_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"kk","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/kk/kk_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/kk/kk_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ko","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ko/ko_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ko/ko_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"lt","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/lt/lt_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/lt/lt_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"lv","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/lv/lv_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/lv/lv_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"mk","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/mk/mk_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/mk/mk_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ml","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ml/ml_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ml/ml_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ms","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ms/ms_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ms/ms_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"nl","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/nl/nl_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/nl/nl_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"no","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/no/no_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/no/no_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"pl","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pl/pl_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pl/pl_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"pt","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pt/pt_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pt/pt_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"pt_br","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pt_br/pt_br_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/pt_br/pt_br_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ro","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ro/ro_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ro/ro_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ru","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ru/ru_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ru/ru_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"si","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/si/si_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/si/si_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"sk","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sk/sk_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sk/sk_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"sl","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sl/sl_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sl/sl_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"sq","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sq/sq_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sq/sq_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"sr","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sr/sr_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sr/sr_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"sv","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sv/sv_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/sv/sv_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"ta","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ta/ta_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/ta/ta_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"te","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/te/te_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/te/te_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"th","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/th/th_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/th/th_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"tl","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/tl/tl_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/tl/tl_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"tr","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/tr/tr_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/tr/tr_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"uk","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/uk/uk_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/uk/uk_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"vi","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/vi/vi_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/vi/vi_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"zh","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/zh/zh_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/zh/zh_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"},{"langCode":"zh_tw","downloadUrl":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/zh_tw/zh_tw_50k.txt","downloadUrl2":"https://raw.githubusercontent.com/klues/FrequencyWords/master/content/2016/zh_tw/zh_tw_full.txt","type":"OPTION_TYPE_GITHUB_FREQUENCYWORDS"}]');e=e.map((e=>{let t=o.A.t(`lang.${e.langCode}`);return e.name=`${t} (hermitdave@github.com)`,e.lang=e.langCode,e})),e.sort(((e,t)=>e.name.localeCompare(t.name))),this.options=this.options.concat(e)}},QC=XC;var ZC=s(1660),ew={};ew.styleTagTransform=Ed(),ew.setAttributes=gd(),ew.insert=vd().bind(null,"head"),ew.domAPI=hd(),ew.insertStyleElement=yd(),dd()(ZC.A,ew),ZC.A&&ZC.A.locals&&ZC.A.locals;const tw=Cd(QC,zC,[],!1,null,"a50779f2",null).exports;var nw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"searchContainer p-0",staticStyle:{position:"relative",width:"100%"}},[t("label",{staticClass:"sr-only",attrs:{for:"searchBar"}},[e._v(e._s(e.$t(e.label||"search")))]),e._v(" "),t("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticStyle:{width:"100%"},attrs:{id:"searchBar",type:"search",autocomplete:"off",placeholder:e.$t(e.placeholder||"search")+"...",disabled:e.disabled},domProps:{value:e.currentValue},on:{input:[function(t){t.target.composing||(e.currentValue=t.target.value)},e.changed],change:e.changed,keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.keydownEnter.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.keydownCtrlEnter.apply(null,arguments):null}]}}),e._v(" "),t("div",{staticClass:"barButtons"},[t("button",{staticStyle:{"background-color":"transparent",outline:"none"},attrs:{title:e.$t("clear"),disabled:e.disabled},on:{click:e.clear}},[t("i",{staticClass:"fas fa-times"})]),e._v(" "),t("button",{attrs:{title:e.$t(e.label||"search"),disabled:e.disabled},on:{click:e.search}},[t("i",{class:e.faSymbol?`fas ${e.faSymbol}`:"fas fa-search"})])])])};nw._withStripped=!0;const rw={props:["value","placeholder","keydownEnterFn","keydownCtrlEnterFn","faSymbol","disabled","label"],data(){return{currentValue:this.value}},watch:{value:function(e,t){this.currentValue=e}},methods:{changed(){this.$emit("input",this.currentValue),this.$emit("change",this.currentValue)},search(){this.changed(),this.$emit("search",this.currentValue),this.$emit("submit",this.currentValue)},clear(){this.currentValue="",this.changed()},keydownEnter(){this.search(),this.keydownEnterFn&&this.keydownEnterFn()},keydownCtrlEnter(){this.keydownCtrlEnterFn&&this.keydownCtrlEnterFn()}},mounted(){}};var iw=s(6684),ow={};ow.styleTagTransform=Ed(),ow.setAttributes=gd(),ow.insert=vd().bind(null,"head"),ow.domAPI=hd(),ow.insertStyleElement=yd(),dd()(iw.A,ow),iw.A&&iw.A.locals&&iw.A.locals;const aw=Cd(rw,nw,[],!1,null,"77f08c40",null).exports;let sw=null;const lw={data:()=>({dicts:null,modalDict:null,editModeId:"",editId:null,originalLabel:"",showLoading:!0,predictionary:null,wordlist:[],searchWord:"",showWordsModal:!1,showImportModal:!1,totalWords:0,filterWords:0,languages:o.A.getAllLanguages()}),components:{SearchBar:aw,ImportDictionaryModal:tw,ImportWordsModal:YC,HeaderIcon:Pg},methods:{deleteDict:function(e,t){let n=this;confirm(o.A.t("CONFIRM_DELETE_DICT",t))&&xg.deleteObject(e).then((()=>{n.reload()}))},downloadDict:function(e,t){let n=new Blob([this.dicts.filter((t=>t.id===e))[0].data],{type:"application/json;charset=utf-8"});l().saveAs(n,`dictionary-${t}.json`)},addDictionary:function(){log.debug("add dictionary!");let e=this.dicts.map((e=>e.dictionaryKey)),t=new le({dictionaryKey:u.S.getNewName("newDictionary",e),lang:o.A.getContentLang()});xg.saveDictionary(t).then((()=>{this.editModeId=t.id,this.reload()}))},finishEditName:function(e){xg.saveDictionary(e),this.editModeId="",this.originalLabel=""},enableEditName:function(e){this.cancelEditName(),this.editModeId=e.id,this.originalLabel=e.dictionaryKey},cancelEditName:function(){if(this.editModeId){let e=this.dicts.filter((e=>e.id===this.editModeId))[0];e.dictionaryKey=this.originalLabel||e.dictionaryKey}this.editModeId="",this.originalLabel=""},isLabelDuplicate:function(e){return this.dicts.map((e=>e.dictionaryKey)).filter((t=>t===e)).length>1},show(e){},edit(e){this.cancelEditName(),this.editId!==e.id?(this.editId=e.id,this.predictionary=Te.instance(),this.predictionary.loadDictionary(e.data),this.totalWords=this.predictionary.getWords().length,this.inputSearchWord(""),Qc.setHelpLocation("07_dictionaries","#edit-dictionaries")):this.editFinished()},editFinished(){this.editId=null,this.searchWord="",Qc.setHelpLocation("02_navigation","#manage-dictionaries-view")},inputSearchWord(e){let t=this,n=void 0===e?200:0;ee.Z.debounce((function(){t.searchWord=void 0===e?t.searchWord:e;let n=t.predictionary.predict(t.searchWord,{maxPredicitons:1e4});t.filterWords=n.length,t.wordlist=n.slice(0,9)}),n,ee.Z.DEFAULT_KEY2)},clone(e){let t=this;xg.getDictionary(e).then((e=>{xg.saveDictionary(e.clone()).then((()=>{t.reload()}))}))},deleteWord(e,t){let n=this;n.predictionary.delete(e),this.totalWords=this.predictionary.getWords().length,ee.Z.debounce((function(){t.data=n.predictionary.dictionaryToJSON(),xg.saveDictionary(t)}),2e3,ee.Z.DEFAULT_KEY),n.inputSearchWord()},reload:function(e){let t=this;xg.getDictionaries().then((n=>{this.dicts=JSON.parse(JSON.stringify(n)),t.editId&&e&&e.data&&(t.editFinished(),t.edit(e))}))},updatedHandler(e,t,n){n[0].modelName===le.getModelName()&&this.reload(n[0])}},created(){let e=this;(0,t.A)(document).on(C.A.EVENT_DB_PULL_UPDATED,e.updatedHandler),xg.getDictionaries().then((t=>{log.debug(t),e.dicts=JSON.parse(JSON.stringify(t)),e.showLoading=!1}))},mounted(){sw=this},beforeDestroy(){Ie.init(),(0,t.A)(document).off(C.A.EVENT_DB_PULL_UPDATED,this.updatedHandler)}};var cw=s(9152),dw={};dw.styleTagTransform=Ed(),dw.setAttributes=gd(),dw.insert=vd().bind(null,"head"),dw.domAPI=hd(),dw.insertStyleElement=yd(),dd()(cw.A,dw),cw.A&&cw.A.locals&&cw.A.locals;const uw=Cd(lw,VC,[],!1,null,"fcc894a4",null).exports;var hw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("nav-tabs",{attrs:{"tab-labels":Object.keys(e.TABS)},on:{input:function(t){e.saveState=e.SAVE_STATES.STATE_INITIAL}},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}}),e._v(" "),t("div",{staticStyle:{position:"relative"}},[t("span",{staticStyle:{position:"absolute",right:"1em",top:"1em"}},[e.saveState===e.SAVE_STATES.STATE_SAVING?t("span",{staticClass:"fas fa-spin fa-spinner"}):e._e(),e._v(" "),e.saveState===e.SAVE_STATES.STATE_SAVED?t("span",{staticClass:"fas fa-check"}):e._e()])]),e._v(" "),e.metadata?t("div",{staticClass:"srow content spaced mt-4"},[e.currentTab===e.TABS.TAB_GENERAL?t("settings-general",{attrs:{metadata:e.metadata,"user-settings-local":e.userSettingsLocal,"app-settings":e.appSettings},on:{changing:e.onChanging,changed:e.onChanged}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_LANGUAGE?t("settings-language",{attrs:{metadata:e.metadata,"user-settings-local":e.userSettingsLocal},on:{changing:e.onChanging,changed:e.onChanged}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_APPEARANCE?t("settings-appearance",{attrs:{metadata:e.metadata,"user-settings-local":e.userSettingsLocal},on:{changing:e.onChanging,changed:e.onChanged}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_INPUTMETHODS?t("settings-input-methods",{attrs:{metadata:e.metadata,"user-settings-local":e.userSettingsLocal},on:{changing:e.onChanging,changed:e.onChanged}}):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_INTEGRATIONS?t("settings-integrations",{attrs:{metadata:e.metadata,"user-settings-local":e.userSettingsLocal,"app-settings":e.appSettings},on:{changing:e.onChanging,changed:e.onChanged}}):e._e()],1):e._e(),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};hw._withStripped=!0;var pw=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("applicationLanguage")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"inLanguage"}},[e._v(e._s(e.$t("selectLanguage")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.appSettings.appLang,expression:"appSettings.appLang"}],staticClass:"five columns",attrs:{id:"inLanguage"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.appSettings,"appLang",t.target.multiple?n:n[0])},function(t){return e.saveAppSettings(e.appSettings)}]}},[t("option",{attrs:{value:""}},[e._v(e._s(e.$t("automatic")))]),e._v(" "),e._l(e.allLanguages.filter((t=>e.appLanguages.includes(t.code))),(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")])}))],2)]),e._v(" "),t("div",{staticClass:"srow",staticStyle:{"margin-bottom":"0.5em"}},[t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span",{staticClass:"break-word"},[t("i18n",{attrs:{path:"ifTheTranslationForYourLanguageIsNotAvailable",tag:"span"},scopedSlots:e._u([{key:"crowdin",fn:function(){return[t("a",{attrs:{href:"https://crowdin.com/project/asterics-grid",target:"_blank"}},[e._v("crowdin.com")])]},proxy:!0}])})],1)])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",[e._v(e._s(e.$t("lockUserInterface")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"unlockPass"}},[e._v(e._s(e.$t("passcodeForUnlockingUserInterface")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.appSettings.unlockPasscode,expression:"appSettings.unlockPasscode"}],staticClass:"five columns",attrs:{id:"unlockPass",type:"number",placeholder:e.$t("noPasscodeBracket")},domProps:{value:e.appSettings.unlockPasscode},on:{input:[function(t){t.target.composing||e.$set(e.appSettings,"unlockPasscode",t.target.value)},function(t){e.appSettings.unlockPasscode=e.appSettings.unlockPasscode.substring(0,6),e.saveAppSettings(e.appSettings)}]}}),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.appSettings.unlockPasscode=null,e.saveAppSettings(e.appSettings)}}},[e._v(e._s(e.$t("reset")))])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("notifications")))]),e._v(" "),t("div",[t("slider-input",{attrs:{label:"intervalForRemindingMakeBackups",unit:"days",id:"backupReminderInterval",min:"0",max:"100",step:"1"},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.notificationConfig.backupNotifyIntervalDays,callback:function(t){e.$set(e.metadata.notificationConfig,"backupNotifyIntervalDays",e._n(t))},expression:"metadata.notificationConfig.backupNotifyIntervalDays"}})],1)])]),e._v(" "),t("div",{staticClass:"srow"},[t("accordion",{staticClass:"eleven columns",attrs:{"acc-label":e.$t("advancedGeneralSettings")}},[t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.appSettings.syncNavigation,expression:"appSettings.syncNavigation"}],attrs:{id:"chkSyncNavigation",type:"checkbox"},domProps:{checked:Array.isArray(e.appSettings.syncNavigation)?e._i(e.appSettings.syncNavigation,null)>-1:e.appSettings.syncNavigation},on:{change:[function(t){var n=e.appSettings.syncNavigation,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.appSettings,"syncNavigation",n.concat([null])):o>-1&&e.$set(e.appSettings,"syncNavigation",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.appSettings,"syncNavigation",i)},function(t){return e.saveAppSettings(e.appSettings)}]}}),e._v(" "),t("label",{attrs:{for:"chkSyncNavigation"}},[e._v(e._s(e.$t("synchronizeNavigationAndLockedState")))])])])],1)])};pw._withStripped=!0;let vw={methods:{saveMetadata(e){this.$emit("changing"),ee.Z.debounce((async()=>{await xg.saveMetadata(e),this.$emit("changed")}),300,"SAVE_METADATA")},saveAppSettings(e){return this.$emit("changing"),new Promise((t=>{ee.Z.debounce((async()=>{await o.A.setAppLanguage(e.appLang,!0),n.w.saveAppSettings(e),this.$emit("changed"),t(!0)}),300,"SAVE_APP_SETTINGS"),setTimeout((()=>{t(!1)}),400)}))},async saveUserSettingsLocal(e,t){t=void 0===t?300:t,this.$emit("changing"),await o.A.setContentLanguage(e.contentLang,!0),n.w.saveUserSettings(e),setTimeout((()=>{this.$emit("changed")}),t)}}};const mw={components:{SliderInput:qf,Accordion:Gg},props:["metadata","appSettings","userSettingsLocal"],mixins:[vw],data:()=>({appLanguages:o.A.getAppLanguages(),allLanguages:o.A.getAllLanguages()}),methods:{},async mounted(){}};var gw=s(8138),fw={};fw.styleTagTransform=Ed(),fw.setAttributes=gd(),fw.insert=vd().bind(null,"head"),fw.domAPI=hd(),fw.insertStyleElement=yd(),dd()(gw.A,fw),gw.A&&gw.A.locals&&gw.A.locals;const yw=Cd(mw,pw,[],!1,null,"769e9f59",null).exports;var _w=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("gridContentLanguage")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"contentLang"}},[e._v(e._s(e.$t("selectLanguage")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.userSettingsLocal.contentLang,expression:"userSettingsLocal.contentLang"}],staticClass:"five columns mb-2",attrs:{id:"contentLang"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.userSettingsLocal,"contentLang",t.target.multiple?n:n[0])},function(t){return e.saveUserSettings()}]}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("automatic")))]),e._v(" "),e._l(e.selectLanguages,(function(n){return t("option",{domProps:{value:n.code}},[e._v(e._s(e._f("extractTranslationAppLang")(n))+" ("+e._s(n.code)+")")])}))],2),e._v(" "),t("div",{staticClass:"four columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAllLanguages,expression:"selectAllLanguages"}],attrs:{id:"selectAllLanguages",type:"checkbox"},domProps:{checked:Array.isArray(e.selectAllLanguages)?e._i(e.selectAllLanguages,null)>-1:e.selectAllLanguages},on:{change:[function(t){var n=e.selectAllLanguages,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.selectAllLanguages=n.concat([null])):o>-1&&(e.selectAllLanguages=n.slice(0,o).concat(n.slice(o+1)))}else e.selectAllLanguages=i},function(t){return e.showAllLangsChanged()}]}}),e._v(" "),t("label",{attrs:{for:"selectAllLanguages"}},[e._v(e._s(e.$t("showAllLanguages")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span",{staticClass:"break-word"},[e._v("\n                    "+e._s(e.$t("gridsCanBeTranslatedToEveryLanguage"))+"\n                ")])])])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("voice")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"inVoice"}},[t("span",[e._v(e._s(e.$t("preferredVoice")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.userSettingsLocal.voiceConfig.preferredVoice,expression:"userSettingsLocal.voiceConfig.preferredVoice"}],staticClass:"five columns mb-2",attrs:{id:"inVoice"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.userSettingsLocal.voiceConfig,"preferredVoice",t.target.multiple?n:n[0])},function(t){e.resetVoiceProps(),e.saveUserSettings()}]}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("automatic")))]),e._v(" "),e._l(e.selectVoices,(function(n){return t("option",{domProps:{value:n.id}},[t("span",[e._v(e._s(e.getVoiceDisplayText(n,e.selectAllVoices)))])])}))],2),e._v(" "),t("div",{staticClass:"four columns"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAllVoices,expression:"selectAllVoices"}],attrs:{id:"selectAllVoices",type:"checkbox"},domProps:{checked:Array.isArray(e.selectAllVoices)?e._i(e.selectAllVoices,null)>-1:e.selectAllVoices},on:{change:[function(t){var n=e.selectAllVoices,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.selectAllVoices=n.concat([null])):o>-1&&(e.selectAllVoices=n.slice(0,o).concat(n.slice(o+1)))}else e.selectAllVoices=i},function(t){return e.showAllVoicesChanged()}]}}),e._v(" "),t("label",{attrs:{for:"selectAllVoices"}},[e._v(e._s(e.$t("showAllVoices")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"testText"}},[t("span",[e._v(e._s(e.$t("testText")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.testText,expression:"testText"}],staticClass:"five columns",attrs:{id:"testText",type:"text"},domProps:{value:e.testText},on:{input:function(t){t.target.composing||(e.testText=t.target.value)}}}),e._v(" "),t("button",{staticClass:"three columns",attrs:{id:"testVoice"},on:{click:e.testSpeak}},[e._v(e._s(e.$t("test")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("accordion",{staticClass:"eleven columns",attrs:{"acc-label":e.$t("advancedVoiceSettings")}},[e.userSettingsLocal.voiceConfig.preferredVoice?t("div",[t("slider-input",{attrs:{label:e.$t("voicePitch"),id:"voicePitch",min:"0.1",max:"2",step:"0.1",decimals:"1"},on:{change:function(t){return e.saveUserSettings()}},model:{value:e.userSettingsLocal.voiceConfig.voicePitch,callback:function(t){e.$set(e.userSettingsLocal.voiceConfig,"voicePitch",e._n(t))},expression:"userSettingsLocal.voiceConfig.voicePitch"}}),e._v(" "),t("slider-input",{attrs:{label:e.$t("voiceRate"),id:"voiceRate",min:"0.1",max:"10",step:"0.1",decimals:"1"},on:{change:function(t){return e.saveUserSettings()}},model:{value:e.userSettingsLocal.voiceConfig.voiceRate,callback:function(t){e.$set(e.userSettingsLocal.voiceConfig,"voiceRate",e._n(t))},expression:"userSettingsLocal.voiceConfig.voiceRate"}})],1):e._e(),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"inVoice2"}},[t("span",[e._v(e._s(e.$t("secondVoice")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.userSettingsLocal.voiceConfig.secondVoice,expression:"userSettingsLocal.voiceConfig.secondVoice"}],staticClass:"five columns mb-2",attrs:{id:"inVoice2"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.userSettingsLocal.voiceConfig,"secondVoice",t.target.multiple?n:n[0])},function(t){return e.saveUserSettings()}]}},[t("option",{domProps:{value:void 0}},[e._v(e._s(e.$t("noneSelected")))]),e._v(" "),e._l(e.voices,(function(n){return t("option",{domProps:{value:n.id}},[t("span",[e._v(e._s(e.getVoiceDisplayText(n,!0)))])])}))],2),e._v(" "),t("button",{staticClass:"three columns",attrs:{id:"testVoice2",disabled:!e.userSettingsLocal.voiceConfig.secondVoice},on:{click:function(t){return e.speechService.testSpeak(e.userSettingsLocal.voiceConfig.secondVoice)}}},[e._v(e._s(e.$t("test")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.userSettingsLocal.voiceConfig.voiceLangIsTextLang,expression:"userSettingsLocal.voiceConfig.voiceLangIsTextLang"}],attrs:{id:"voiceLangIsTextLang",type:"checkbox"},domProps:{checked:Array.isArray(e.userSettingsLocal.voiceConfig.voiceLangIsTextLang)?e._i(e.userSettingsLocal.voiceConfig.voiceLangIsTextLang,null)>-1:e.userSettingsLocal.voiceConfig.voiceLangIsTextLang},on:{change:[function(t){var n=e.userSettingsLocal.voiceConfig.voiceLangIsTextLang,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.userSettingsLocal.voiceConfig,"voiceLangIsTextLang",n.concat([null])):o>-1&&e.$set(e.userSettingsLocal.voiceConfig,"voiceLangIsTextLang",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.userSettingsLocal.voiceConfig,"voiceLangIsTextLang",i)},function(t){return e.saveUserSettings()}]}}),e._v(" "),t("label",{attrs:{for:"voiceLangIsTextLang"}},[e._v(e._s(e.$t("linkVoiceLanguageToTranslationLanguageOfSpokenText")))])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.speechService.getExternalVoice(e.userSettingsLocal.voiceConfig.preferredVoice),expression:"!!speechService.getExternalVoice(userSettingsLocal.voiceConfig.preferredVoice)"}],staticClass:"srow"},[t("button",{attrs:{disabled:void 0!==e.externalVoiceCacheProgress&&100!==e.externalVoiceCacheProgress},on:{click:function(t){return e.cacheAll()}}},[e._v(e._s(e.$t("cacheAllTextsOfCurrentConfigurationExternalVoice")))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:void 0!==e.externalVoiceCacheProgress,expression:"externalVoiceCacheProgress !== undefined"}]},[e._v(" ... "+e._s(e.externalVoiceCacheProgress)+"%")])])])],1)])]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("progressiveLanguage")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"langLevel"}},[t("span",[e._v(e._s(e.$t("shownVocabularyLevel")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.vocabularyLevel,expression:"metadata.vocabularyLevel"}],staticClass:"five columns mb-2",attrs:{id:"langLevel"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata,"vocabularyLevel",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("allSelected")))]),e._v(" "),e._l([...Array(10).keys()].map((e=>e+1)),(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(e.$t("untilLevel",{level:n})))])}))],2)])])])])};_w._withStripped=!0;let Ew="KEY_SETTINGS_SHOW_ALL_VOICES",bw="KEY_SETTINGS_SHOW_ALL_CONTENTLANGS";const Sw={components:{SliderInput:qf,Accordion:Gg},props:["userSettingsLocal","metadata"],mixins:[vw],data(){return{show:!1,selectAllLanguages:JSON.parse(n.w.get(bw))||!1,selectAllVoices:JSON.parse(n.w.get(Ew))||!1,gridLanguages:[],appLanguages:o.A.getAppLanguages(),allLanguages:o.A.getAllLanguages(),currentLang:o.A.getAppLang(),saveSuccess:null,speechService:su,voices:[],selectVoices:[],validSpeechServiceUrl:null,externalVoiceCacheProgress:void 0,testText:o.A.t("thisIsAnEnglishSentence"),i18nService:o.A,localStorageService:n.w,constants:C.A,util:ee.Z,lastSavedSettingsString:JSON.stringify(this.userSettingsLocal)}},computed:{selectLanguages(){return this.allLanguages&&this.gridLanguages?this.selectAllLanguages?this.allLanguages:this.allLanguages.filter((e=>this.gridLanguages.includes(e.code))):[]}},methods:{saveUserSettings(){JSON.stringify(this.userSettingsLocal)!==this.lastSavedSettingsString&&(this.$emit("changing"),ee.Z.debounce((()=>{this.saveUserSettingsLocal(this.userSettingsLocal,0),this.lastSavedSettingsString=JSON.stringify(this.userSettingsLocal),this.selectVoices=this.getSelectVoices(),this.fixCurrentVoice(!0),this.setVoiceTestText()}),300,"SAVE_USERSETTINGS"))},fixCurrentVoice(e){this.selectVoices.map((e=>e.id)).includes(this.userSettingsLocal.voiceConfig.preferredVoice)||(this.userSettingsLocal.voiceConfig.preferredVoice=void 0,e||this.saveUserSettings())},showAllVoicesChanged(){this.selectVoices=this.getSelectVoices(),this.fixCurrentVoice(),n.w.save(Ew,this.selectAllVoices)},showAllLangsChanged(){n.w.save(bw,this.selectAllLanguages),this.selectLanguages.map((e=>e.code)).includes(this.userSettingsLocal.contentLang)||(this.userSettingsLocal.contentLang=void 0,this.saveUserSettings())},getSelectVoices(){return this.voices?(this.sortVoices(),this.selectAllVoices?this.voices:this.voices.filter((e=>o.A.getBaseLang(e.lang)===o.A.getContentLangBase()))):[]},sortVoices(){this.voices.sort(su.voiceSortFn)},resetVoiceProps(){this.userSettingsLocal.voiceConfig.voicePitch=1,this.userSettingsLocal.voiceConfig.voiceRate=1},setVoiceTestText(){let e=this.voices.filter((e=>e.id===this.userSettingsLocal.voiceConfig.preferredVoice))[0],t=e?e.lang:o.A.getContentLang();this.testText=o.A.tl("thisIsAnEnglishSentence",[],o.A.getBaseLang(t))},testSpeak(){su.speak(this.testText,{preferredVoice:this.userSettingsLocal.voiceConfig.preferredVoice})},getVoiceDisplayText:(e,t)=>t?`${o.A.te(`lang.${e.lang}`)?o.A.t(`lang.${e.lang}`):e.langFull}: ${e.name}, ${e.local?"offline":"online"}`:`${e.name}, ${e.local?"offline":"online"}`,async cacheAll(){let e=await xg.getGrids(),t=su.getExternalVoice(this.userSettingsLocal.voiceConfig.preferredVoice);Yd.cacheAll(e,t,(e=>{this.externalVoiceCacheProgress=e}))}},async mounted(){let e=this;e.setVoiceTestText();let t=await xg.getGrids(!1,!0);e.gridLanguages=Ge.b.getGridsLangs(t),e.voices=await su.getVoicesInitialized(),e.selectVoices=e.getSelectVoices()}};var Cw=s(1620),ww={};ww.styleTagTransform=Ed(),ww.setAttributes=gd(),ww.insert=vd().bind(null,"head"),ww.domAPI=hd(),ww.insertStyleElement=yd(),dd()(Cw.A,ww),Cw.A&&Cw.A.locals&&Cw.A.locals;const Aw=Cd(Sw,_w,[],!1,null,"57c27e70",null).exports;var Tw=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v("ARASAAC")]),e._v(" "),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.activateARASAACGrammarAPI,expression:"metadata.activateARASAACGrammarAPI"}],attrs:{id:"activateARASAACGrammarAPI",type:"checkbox"},domProps:{checked:Array.isArray(e.metadata.activateARASAACGrammarAPI)?e._i(e.metadata.activateARASAACGrammarAPI,null)>-1:e.metadata.activateARASAACGrammarAPI},on:{change:[function(t){var n=e.metadata.activateARASAACGrammarAPI,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.metadata,"activateARASAACGrammarAPI",n.concat([null])):o>-1&&e.$set(e.metadata,"activateARASAACGrammarAPI",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.metadata,"activateARASAACGrammarAPI",i)},function(t){return e.saveMetadata(e.metadata)}]}}),e._v(" "),t("label",{attrs:{for:"activateARASAACGrammarAPI"}},[t("i18n",{attrs:{path:"activateAutomaticGrammarCorrectionARASAACAPI",tag:"span"},scopedSlots:e._u([{key:"availableLangs",fn:function(){return[t("span",[e._v(e._s(e.util.arrayToPrintable(e.arasaacService.getSupportedGrammarLangs(!0))))])]},proxy:!0}])})],1)]),e._v(" "),t("div",{staticClass:"mt-3"},[t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span"),e._v(" "),t("i18n",{attrs:{path:"noteThatActivatingThisSendsSentencesToARASAACSeePrivacy",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[e.i18nService.isCurrentAppLangDE()?e._e():t("a",{attrs:{target:"_blank",href:"app/privacy_en.html?back=settings#data-transfer"}},[e._v(e._s(e.$t("privacyPolicy")))]),e.i18nService.isCurrentAppLangDE()?t("a",{attrs:{target:"_blank",href:"app/privacy_de.html?back=settings#data-transfer"}},[e._v(e._s(e.$t("privacyPolicy")))]):e._e()]},proxy:!0}])})],1)])]),e._v(" "),t("h3",[e._v(e._s(e.$t("externalSpeechService")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"externalSpeechUrl"}},[e._v(e._s(e.$t("externalSpeechUrl")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.appSettings.externalSpeechServiceUrl,expression:"appSettings.externalSpeechServiceUrl"}],staticClass:"seven columns",attrs:{type:"text",id:"externalSpeechUrl",placeholder:"http://localhost:5555"},domProps:{value:e.appSettings.externalSpeechServiceUrl},on:{input:[function(t){t.target.composing||e.$set(e.appSettings,"externalSpeechServiceUrl",t.target.value)},e.onSpeechUrlInput]}}),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:void 0===e.urlValid,expression:"urlValid === undefined"}],staticClass:"spaced"},[t("i",{staticClass:"fas fa-spinner fa-spin"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.urlValid,expression:"urlValid"}],staticClass:"spaced",staticStyle:{color:"green"},attrs:{title:e.$t("urlIsValid")}},[t("i",{staticClass:"fas fa-check"})]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!1===e.urlValid,expression:"urlValid === false"}],staticClass:"spaced",staticStyle:{color:"red"},attrs:{title:e.$t("urlIsInvalid")}},[t("i",{staticClass:"fas fa-times"})])]),e._v(" "),t("div",{staticClass:"mt-3"},[t("span",{staticClass:"fa fa-info-circle"}),e._v(" "),t("span"),e._v(" "),t("i18n",{attrs:{path:"findDetailsAt",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[t("a",{attrs:{target:"_blank",href:"https://github.com/asterics/AsTeRICS-Grid-Helper?tab=readme-ov-file#speech"}},[e._v(e._s(e.$t("infoAboutExternalSpeechService")))])]},proxy:!0}])})],1),e._v(" "),t("h3",[e._v(e._s(e.$t("Matrix messenger")))]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{on:{click:function(t){e.currentModal=e.MODALS.MODAL_MATRIX}}},[t("i",{staticClass:"fas fa-cog"}),e._v(" Configure matrix messenger")])]),e._v(" "),e.currentModal===e.MODALS.MODAL_MATRIX?t("configure-matrix",{on:{close:function(t){e.currentModal=null}}}):e._e()],1)};Tw._withStripped=!0;var Iw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-container-flex",on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.$emit("close")}}},[t("div",{staticClass:"modal-header"},[t("div",{staticClass:"row"},[t("h1",{staticClass:"col"},[e._v("Matrix messenger")]),e._v(" "),t("div",{staticClass:"col-auto d-flex"},[t("a",{staticClass:"inline close-button",attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("close")}}},[t("i",{staticClass:"fas fa-times"})])])])]),e._v(" "),t("nav-tabs",{staticClass:"mb-5",attrs:{"tab-labels":Object.keys(e.TABS)},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}}),e._v(" "),t("div",{staticClass:"modal-body mt-2"},[e.initialLoading?t("div",[e._v(e._s(e.$t("loading"))+" ... "),t("i",{staticClass:"fas fa-spinner fa-spin"})]):e._e(),e._v(" "),e.initialLoading||e.loggedInUser||e.currentTab===e.TABS.TAB_GENERAL?e._e():t("div",[t("i18n",{attrs:{path:"pleaseLoginInTab",tag:"span"},scopedSlots:e._u([{key:"tab",fn:function(){return[t("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.currentTab=e.TABS.TAB_GENERAL}}},[e._v(e._s(e.$t("TAB_GENERAL")))])]},proxy:!0}],null,!1,3236820390)})],1),e._v(" "),e.initialLoading||e.currentTab!==e.TABS.TAB_GENERAL?e._e():t("configure-matrix-general",{attrs:{"logged-in-user":e.loggedInUser},on:{user:e.loggedInUserChanged}}),e._v(" "),!e.initialLoading&&e.loggedInUser?t("div",[e.currentTab===e.TABS.TAB_MESSAGES?t("configure-matrix-messages"):e._e(),e._v(" "),e.currentTab===e.TABS.TAB_ROOMS?t("configure-matrix-rooms"):e._e()],1):e._e()],1),e._v(" "),t("div",{staticClass:"modal-footer modal-footer-flex"},[t("div",{staticClass:"button-container"},[t("div",{staticClass:"srow"},[t("button",{staticClass:"six columns offset-by-six",on:{click:function(t){return e.save()}}},[t("i",{staticClass:"fas fa-check"}),e._v(" "),t("span",[e._v(e._s(e.$t("closeModal")))])])])])])],1)])])])};Iw._withStripped=!0;var kw=function(){var e=this,t=e._self._c;return e.metadata?t("div",{staticClass:"container-fluid px-0"},[e.loggedInUser?t("div",[t("div",{staticClass:"mb-3"},[t("i18n",{attrs:{path:"LoggedInAsSentence",tag:"span"},scopedSlots:e._u([{key:"user",fn:function(){return[e._v('"'),t("strong",[e._v(e._s(e.loggedInUser))]),e._v('"')]},proxy:!0}],null,!1,64723249)})],1),e._v(" "),e.e2eeSupported?t("div",[t("i",{staticClass:"fas fa-lock"}),e._v(" "),t("span",[e._v(e._s(e.$t("matrixE2eeSupported"))+".")])]):e._e(),e._v(" "),e.e2eeSupported?e._e():t("div",[t("i",{staticClass:"fas fa-lock-open"}),e._v(" "),t("span",[e._v(e._s(e.$t("matrixE2eeNotSupported"))+".")])]),e._v(" "),t("div",{staticClass:"mt-4"},[t("button",{on:{click:e.logout}},[e.logoutLoading?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e(),e._v(" "),e.logoutLoading?e._e():t("i",{staticClass:"fas fa-sign-out-alt"}),e._v(" "),t("span",[e._v(e._s(e.$t("logout")))])])])]):e._e(),e._v(" "),e.loggedInUser?e._e():t("div",[t("div",{staticClass:"row mb-5"},[t("div",{staticClass:"col"},[t("i",{staticClass:"fas fa-info-circle me-2"}),e._v(" "),t("i18n",{attrs:{path:"ifNoUserCreateMatrixAccount",tag:"span"},scopedSlots:e._u([{key:"link",fn:function(){return[t("a",{attrs:{href:"https://app.element.io/#/register",target:"_blank"}},[e._v("app.element.io")])]},proxy:!0}],null,!1,1130617431)})],1)]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-3",attrs:{for:"matrixUser"}},[e._v(e._s(e.$t("username")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.syncConfig.user,expression:"syncConfig.user"}],staticClass:"col-12",attrs:{type:"text",id:"matrixUser"},domProps:{value:e.syncConfig.user},on:{input:function(t){t.target.composing||e.$set(e.syncConfig,"user",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-3",attrs:{for:"matrixPassword"}},[e._v(e._s(e.$t("password")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.syncConfig.password,expression:"syncConfig.password"}],staticClass:"col-12",attrs:{type:"password",id:"matrixPassword"},domProps:{value:e.syncConfig.password},on:{input:function(t){t.target.composing||e.$set(e.syncConfig,"password",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-3",attrs:{for:"homeserver"}},[e._v(e._s(e.$t("homeserver")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.syncConfig.homeserver,expression:"syncConfig.homeserver"}],staticClass:"col-12",attrs:{type:"text",id:"homeserver",placeholder:"https://matrix.org"},domProps:{value:e.syncConfig.homeserver},on:{input:function(t){t.target.composing||e.$set(e.syncConfig,"homeserver",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"mt-4"},[t("button",{staticClass:"me-4",attrs:{disabled:!e.loginEnabled},on:{click:e.login}},[e.loginLoading?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e(),e._v(" "),e.loginLoading?e._e():t("i",{staticClass:"fas fa-sign-in-alt"}),e._v(" "),t("span",[e._v(e._s(e.$t("login")))])]),e._v(" "),e.loginResult===e.LOGIN_RESULTS.UNAUTHORIZED?t("span",{staticStyle:{color:"red"}},[t("i",{staticClass:"fas fa-times"}),e._v(" "+e._s(e.$t("ERROR_CODE_UNAUTHORIZED")))]):e._e(),e._v(" "),e.loginResult===e.LOGIN_RESULTS.NETWORK_ERROR?t("span",{staticStyle:{color:"red"}},[t("i",{staticClass:"fas fa-times"}),e._v(" "+e._s(e.$t("ERROR_CODE_NETWORK_ERROR")))]):e._e()])])]):e._e()};kw._withStripped=!0;const Ow={components:{},props:["loggedInUser"],data:function(){return{metadata:null,logoutLoading:!1,loginLoading:!1,syncConfig:new jv.P,loginResult:null,LOGIN_RESULTS:sm.LOGIN_RESULTS,e2eeSupported:void 0}},computed:{loginEnabled(){return this.syncConfig.user&&this.syncConfig.password&&this.syncConfig.homeserver}},methods:{async logout(){this.loginResult=null,this.logoutLoading=!0,this.syncConfig=new jv.P,await sm.logout(),this.metadata.integrations.matrixConfig=new jv.P,await xg.saveMetadata(this.metadata),this.$emit("user",await sm.getUsername()),this.logoutLoading=!1},async login(){this.loginResult=null,this.loginLoading=!0,this.loginResult=await sm.login(this.syncConfig),this.loginResult===this.LOGIN_RESULTS.SUCCESS&&(this.metadata.integrations.matrixConfig=this.syncConfig,await xg.saveMetadata(this.metadata)),this.e2eeSupported=sm.isEncryptionEnabled(),this.$emit("user",await sm.getUsername()),this.loginLoading=!1}},async mounted(){this.metadata=await xg.getMetadata(),this.e2eeSupported=sm.isEncryptionEnabled()},beforeDestroy(){}};var Rw=s(5908),xw={};xw.styleTagTransform=Ed(),xw.setAttributes=gd(),xw.insert=vd().bind(null,"head"),xw.domAPI=hd(),xw.insertStyleElement=yd(),dd()(Rw.A,xw),Rw.A&&Rw.A.locals&&Rw.A.locals;const Nw=Cd(Ow,kw,[],!1,null,"02bd3c28",null).exports;var Dw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-3",attrs:{for:"matrixRoom"}},[e._v(e._s(e.$t("selectRoom")))]),e._v(" "),t("div",{staticClass:"col-sm-7"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.matrixRoom,expression:"matrixRoom"}],staticClass:"col-12",attrs:{id:"matrixRoom"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.matrixRoom=t.target.multiple?n:n[0]}}},e._l(e.matrixRooms,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(n.name))])})),0)])]),e._v(" "),t("div",{staticClass:"row mb-4"},[t("div",{staticClass:"col d-inline-block"},[t("h2",{staticClass:"d-inline-block me-3"},[e._v(e._s(e.$t("TAB_MESSAGES")))]),e._v(" "),t("span",[e.matrixRoom&&e.matrixRoom.hasEncryptionStateEvent()?t("i",{staticClass:"fas fa-lock",staticStyle:{color:"darkgreen"},attrs:{title:e.$t("endToEndEncrypted")}}):e._e()]),e._v(" "),t("span",[e.matrixRoom&&!e.matrixRoom.hasEncryptionStateEvent()?t("i",{staticClass:"fas fa-lock-open",staticStyle:{color:"darkred"},attrs:{title:e.$t("notEndToEndEncrypted")}}):e._e()])])]),e._v(" "),t("matrix-conversation",{staticStyle:{"max-height":"20em","overflow-y":"scroll"},attrs:{"matrix-room-prop":e.matrixRoom}}),e._v(" "),t("div",{staticClass:"row"},[t("search-bar",{attrs:{placeholder:e.$t("typeMessagePlaceholder"),"fa-symbol":"fa-paper-plane",disabled:e.sendDisabled,label:"sendMessage"},on:{submit:e.sendMatrixMessage},model:{value:e.matrixText,callback:function(t){e.matrixText=t},expression:"matrixText"}})],1),e._v(" "),e.sendDisabled?t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[e._m(0),e._v(" "),t("span",[e._v(e._s(e.$t("cannotSendToEncryptedRoom"))+".")])])]):e._e()],1)};Dw._withStripped=!0;const Lw={components:{MatrixConversation:Oy,SearchBar:aw},props:[],data:function(){return{matrixText:"",matrixRooms:[],matrixRoom:null,e2eeSupported:void 0}},computed:{sendDisabled(){return this.matrixRoom&&this.matrixRoom.hasEncryptionStateEvent()&&!this.e2eeSupported}},methods:{async sendMatrixMessage(){await sm.sendMessage(this.matrixRoom.roomId,this.matrixText),this.matrixText=""}},async mounted(){this.matrixRooms=await sm.getRooms()||[],this.matrixRoom=this.matrixRooms[0],this.e2eeSupported=sm.isEncryptionEnabled()},beforeDestroy(){sm.onMessage(null)}};var Pw=s(1517),Mw={};Mw.styleTagTransform=Ed(),Mw.setAttributes=gd(),Mw.insert=vd().bind(null,"head"),Mw.domAPI=hd(),Mw.insertStyleElement=yd(),dd()(Pw.A,Mw),Pw.A&&Pw.A.locals&&Pw.A.locals;const Uw=Cd(Lw,Dw,[function(){var e=this._self._c;return e("span",[e("i",{staticClass:"fas fa-info-circle"})])}],!1,null,"5e9d9014",null).exports;var Fw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid px-0"},[t("h2",{staticClass:"mb-4"},[e._v(e._s(e.$t("TAB_ROOMS")))]),e._v(" "),t("div",{staticClass:"row d-sm-flex d-none"},[t("strong",{staticClass:"col-4"},[e._v(e._s(e.$t("roomName")))]),e._v(" "),t("strong",{staticClass:"col-5"},[e._v(e._s(e.$t("members")))]),e._v(" "),t("strong",{staticClass:"col-3"},[e._v(e._s(e.$t("actions")))])]),e._v(" "),t("ul",e._l(e.rooms,(function(n){return t("li",{staticClass:"row mb-sm-2 mb-5"},[t("div",{staticClass:"col-sm-4"},[n.hasEncryptionStateEvent()?t("i",{staticClass:"fas fa-lock",staticStyle:{color:"darkgreen"},attrs:{title:e.$t("endToEndEncrypted")}}):e._e(),e._v(" "),n.hasEncryptionStateEvent()?e._e():t("i",{staticClass:"fas fa-lock-open",staticStyle:{color:"darkred"},attrs:{title:e.$t("notEndToEndEncrypted")}}),e._v(" "),t("span",{staticClass:"ms-2 d-sm-inline d-none"},[e._v(e._s(n.name))]),e._v(" "),t("strong",{staticClass:"ms-2 d-sm-none d-inline"},[e._v(e._s(n.name))])]),e._v(" "),t("div",{staticClass:"col-sm-5"},[t("matrix-room-description",{attrs:{room:n,"logged-in-user":e.loggedInUser}})],1),e._v(" "),t("div",{staticClass:"col-sm-3 mt-sm-0 mt-2"},[t("button",{staticClass:"actionBtn",on:{click:function(t){return e.leaveRoom(n)}}},[e.leavingRoom.roomId===n.roomId?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e(),e._v(" "),e.leavingRoom.roomId!==n.roomId?t("i",{staticClass:"fas fa-sign-out-alt"}):e._e(),e._v(" "),t("span",[e._v(e._s(e.$t("leave")))])])])])})),0),e._v(" "),t("h2",[e._v(e._s(e.$t("newRoom")))]),e._v(" "),t("div",{staticClass:"row my-4"},[t("label",{staticClass:"col-sm-3",attrs:{for:"newRoomUser"}},[e._v(e._s(e.$t("newRoomUser")))]),e._v(" "),t("div",{staticClass:"col-sm-4"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoomUser,expression:"newRoomUser"}],staticClass:"col-12",attrs:{type:"text",id:"newRoomUser"},domProps:{value:e.newRoomUser},on:{input:[function(t){t.target.composing||(e.newRoomUser=t.target.value)},e.checkUsername]}})]),e._v(" "),t("div",{staticClass:"col-sm-5"},[e.checking?t("div",[t("span",[e._v(e._s(e.$t("searching")))]),e._v(" "),t("i",{staticClass:"fas fa-spinner fa-spin"})]):e._e(),e._v(" "),void 0!==e.userExists?t("div",[e.userExists?t("i",{staticClass:"fas fa-check"}):e._e(),e._v(" "),e.userExists?e._e():t("i",{staticClass:"fas fa-times"}),e._v(" "),e.userExists?t("i18n",{attrs:{path:"valueExists",tag:"span"},scopedSlots:e._u([{key:"value",fn:function(){return[t("span",[e._v(e._s(e.$t("username")))]),e._v('\n                        "'),t("strong",[e._v(e._s(e.fullUsername))]),e._v('"\n                    ')]},proxy:!0}],null,!1,2182795407)}):e._e(),e._v(" "),e.userExists?e._e():t("i18n",{attrs:{path:"valueNotFound",tag:"span"},scopedSlots:e._u([{key:"value",fn:function(){return[t("span",[e._v(e._s(e.$t("username")))]),e._v('\n                        "'),t("strong",[e._v(e._s(e.fullUsername))]),e._v('"\n                    ')]},proxy:!0}],null,!1,2182795407)})],1):e._e()])]),e._v(" "),t("div",{staticClass:"row"},[t("label",{staticClass:"col-sm-3",attrs:{for:"roomName"}},[e._v(e._s(e.$t("roomName")))]),e._v(" "),t("div",{staticClass:"col-sm-4"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoomName,expression:"newRoomName"}],staticClass:"col-12",attrs:{type:"text",id:"roomName",placeholder:e.$t("optionalBracket")},domProps:{value:e.newRoomName},on:{input:function(t){t.target.composing||(e.newRoomName=t.target.value)}}})])]),e._v(" "),e.canUseEncryption?t("div",{staticClass:"row"},[t("div",{staticClass:"col-auto"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoomEncrypted,expression:"newRoomEncrypted"}],attrs:{type:"checkbox",id:"useEncryption"},domProps:{checked:Array.isArray(e.newRoomEncrypted)?e._i(e.newRoomEncrypted,null)>-1:e.newRoomEncrypted},on:{change:function(t){var n=e.newRoomEncrypted,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&(e.newRoomEncrypted=n.concat([null])):o>-1&&(e.newRoomEncrypted=n.slice(0,o).concat(n.slice(o+1)))}else e.newRoomEncrypted=i}}})]),e._v(" "),t("label",{staticClass:"col",attrs:{for:"useEncryption"}},[e._v(e._s(e.$t("useEndToEndEncryption")))])]):e._e(),e._v(" "),t("div",{staticClass:"mt-4"},[t("button",{staticClass:"me-4",attrs:{disabled:e.createRoomDisabled},on:{click:e.createRoom}},[e.createRoomState===e.CREATE_ROOM_STATES.LOADING?t("i",{staticClass:"fas fa-spinner fa-spin"}):e._e(),e._v(" "),e.createRoomState!==e.CREATE_ROOM_STATES.LOADING?t("i",{staticClass:"fas fa-plus"}):e._e(),e._v(" "),t("span",[e._v(e._s(e.$t("createRoom")))])]),e._v(" "),e.createRoomState===e.CREATE_ROOM_STATES.ERROR?t("span",{staticStyle:{color:"red"}},[t("i",{staticClass:"fas fa-times"}),e._v(" "+e._s(e.$t("couldNotCreateRoom"))+"!")]):e._e(),e._v(" "),e.createRoomState===e.CREATE_ROOM_STATES.SUCCESS?t("span",{staticStyle:{color:"green"}},[t("i",{staticClass:"fas fa-check"}),e._v(" "+e._s(e.$t("successfullyCreatedRoom"))+"!")]):e._e()])])};Fw._withStripped=!0;const Bw={INITIAL:"INITIAL",LOADING:"LOADING",SUCCESS:"SUCCESS",ERROR:"ERROR"},Gw={components:{MatrixRoomDescription:Ay},props:[],data:function(){return{rooms:[],loggedInUserFull:"",loggedInUser:"",userExists:void 0,checking:!1,fullUsername:"",newRoomUser:"",newRoomName:"",canUseEncryption:void 0,newRoomEncrypted:void 0,CREATE_ROOM_STATES:Bw,createRoomState:Bw.INITIAL,leavingRoom:{}}},computed:{createRoomDisabled(){return!this.userExists||this.fullUsername===this.loggedInUserFull||this.rooms.find((e=>e.name===this.newRoomName))}},methods:{async checkUsername(){if(this.userExists=void 0,this.createRoomState=Bw.INITIAL,!this.newRoomUser)return this.checking=!1,void ee.Z.clearDebounce("MATRIX_CHECK_USER");this.checking=!0,ee.Z.debounce((async()=>{this.fullUsername=sm.getFullUsername(this.newRoomUser),this.userExists=await sm.existsUser(this.newRoomUser),this.checking=!1}),700,"MATRIX_CHECK_USER")},async createRoom(){if(this.createRoomDisabled)return;this.createRoomState=Bw.LOADING;let e=await sm.createPrivateRoom(this.fullUsername,this.newRoomEncrypted,this.newRoomName);this.rooms=await sm.getRooms(),this.createRoomState=e?Bw.SUCCESS:Bw.ERROR},async leaveRoom(e){confirm(o.A.t("doYouReallyWantToLeaveRoom",e.name))&&(this.leavingRoom=e,this.$nextTick((async()=>{await sm.leaveRoom(e.roomId)})))},isPrivateRoom:e=>2===e.getMembers().length,getPrivateRoomPartner(e){return e.getMembers().map((e=>e.name)).filter((e=>e!==this.loggedInUser))[0]},getAllMembersString(e){let t=e.getMembers().map((e=>e.name));return t.sort(((e,t)=>e===this.loggedInUser?-1:t===this.loggedInUser?1:e.localeCompare(t))),t.join(", ")},onRoomChange(e){this.rooms=e}},async mounted(){this.rooms=await sm.getRooms()||[],this.canUseEncryption=sm.isEncryptionEnabled(),this.newRoomEncrypted=this.canUseEncryption,this.loggedInUserFull=await sm.getUsername(!0),this.loggedInUser=await sm.getUsername(),sm.onRoomChange(this.onRoomChange)},beforeDestroy(){sm.onRoomChange(null)}},$w=Gw;var Vw=s(4924),jw={};jw.styleTagTransform=Ed(),jw.setAttributes=gd(),jw.insert=vd().bind(null,"head"),jw.domAPI=hd(),jw.insertStyleElement=yd(),dd()(Vw.A,jw),Vw.A&&Vw.A.locals&&Vw.A.locals;const Kw=Cd($w,Fw,[],!1,null,"1a4a946f",null).exports,Ww="TAB_GENERAL",qw={TAB_GENERAL:Ww,TAB_ROOMS:"TAB_ROOMS",TAB_MESSAGES:"TAB_MESSAGES"},Hw={props:["editElementIdParam","gridDataId","undoService","newPosition"],components:{ConfigureMatrixRooms:Kw,ConfigureMatrixMessages:Uw,ConfigureMatrixGeneral:Nw,NavTabs:jf},data:function(){return{TABS:qw,currentTab:Ww,loggedInUser:void 0}},computed:{initialLoading(){return void 0===this.loggedInUser}},methods:{save(){this.close()},close(){this.$emit("close")},loggedInUserChanged(e){this.loggedInUser=e}},async mounted(){switch(await sm.login()){case sm.LOGIN_RESULTS.SUCCESS:this.loggedInUser=await sm.getUsername();break;case sm.LOGIN_RESULTS.MISSING_DATA:this.loggedInUser=null;break;default:log.warn("matrix: unknown error at login")}},beforeDestroy(){}},Yw=Hw;var zw=s(4730),Jw={};Jw.styleTagTransform=Ed(),Jw.setAttributes=gd(),Jw.insert=vd().bind(null,"head"),Jw.domAPI=hd(),Jw.insertStyleElement=yd(),dd()(zw.A,Jw),zw.A&&zw.A.locals&&zw.A.locals;const Xw=Cd(Yw,Iw,[],!1,null,"4f0f7305",null).exports,Qw={MODAL_MATRIX:"MODAL_MATRIX"},Zw={components:{ConfigureMatrix:Xw},props:["metadata","userSettingsLocal","appSettings"],mixins:[vw],data:()=>({i18nService:o.A,util:ee.Z,arasaacService:Ju,urlValid:null,MODALS:Qw,currentModal:null}),methods:{async onSpeechUrlInput(){if(await this.saveAppSettings(this.appSettings)){this.urlValid=void 0,this.urlValid=await Yd.validateUrl(this.appSettings.externalSpeechServiceUrl),this.urlValid=this.appSettings.externalSpeechServiceUrl?this.urlValid:null;let e=this.urlValid?0:3e3;ee.Z.debounce((async()=>{await su.reinit()}),e,"REINIT_SPEECH")}}},async mounted(){}};var eA=s(4142),tA={};tA.styleTagTransform=Ed(),tA.setAttributes=gd(),tA.insert=vd().bind(null,"head"),tA.domAPI=hd(),tA.insertStyleElement=yd(),dd()(eA.A,tA),eA.A&&eA.A.locals&&eA.A.locals;const nA=Cd(Zw,Tw,[],!1,null,"17d53b07",null).exports;var rA=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"nine columns settings-area"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("quickSettings")))]),e._v(" "),t("div",{staticClass:"srow"},[t("button",{on:{click:e.toDefault}},[t("span",{staticClass:"fas fa-undo"}),e._v(" "+e._s(e.$t("setToDefaultSettings")))]),e._v(" "),t("button",{on:{click:e.toDefaultBgColored}},[t("span",{staticClass:"fas fa-square"}),e._v(" "+e._s(e.$t("setToDefaultSettingsBgColored")))]),e._v(" "),t("button",{on:{click:e.toDefaultBorderColored}},[t("span",{staticClass:"far fa-square"}),e._v(" "+e._s(e.$t("setToDefaultSettingsBorderColored")))]),e._v(" "),t("button",{on:{click:e.toDarkMode}},[t("span",{staticClass:"fas fa-moon"}),e._v(" "+e._s(e.$t("setToDarkMode")))]),e._v(" "),t("button",{on:{click:e.toLightMode}},[t("span",{staticClass:"fas fa-sun"}),e._v(" "+e._s(e.$t("setToLightMode")))])]),e._v(" "),t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("textHeading")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"textPos"}},[e._v(e._s(e.$t("textPosition")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.textPosition,expression:"metadata.textConfig.textPosition"}],staticClass:"five columns",attrs:{id:"textPos"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.textConfig,"textPosition",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:e.TextConfig.TEXT_POS_ABOVE}},[e._v(e._s(e.$t("top")))]),e._v(" "),t("option",{domProps:{value:e.TextConfig.TEXT_POS_BELOW}},[e._v(e._s(e.$t("bottom")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"fontFamily"}},[e._v(e._s(e.$t("fontFamily")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.fontFamily,expression:"metadata.textConfig.fontFamily"}],staticClass:"five columns",attrs:{id:"fontFamily"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.textConfig,"fontFamily",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},e._l(e.TextConfig.FONTS,(function(n){return t("option",{domProps:{value:n}},[e._v(e._s(n))])})),0)]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"convertText"}},[e._v(e._s(e.$t("convertElementLabels")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.convertMode,expression:"metadata.textConfig.convertMode"}],staticClass:"five columns",attrs:{id:"convertText"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.textConfig,"convertMode",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("dontConvertLabels")))]),e._v(" "),t("option",{domProps:{value:e.TextConfig.CONVERT_MODE_UPPERCASE}},[e._v(e._s(e.$t("convertToUppercasse")))]),e._v(" "),t("option",{domProps:{value:e.TextConfig.CONVERT_MODE_LOWERCASE}},[e._v(e._s(e.$t("convertToLowercase")))])])]),e._v(" "),t("div",{staticClass:"srow mb-0"},[t("slider-input",{attrs:{label:"fontSizeTextAndImage",unit:"%",id:"fontSizeTextAndImage",min:"0",max:"100",step:"1"},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.textConfig.fontSizePct,callback:function(t){e.$set(e.metadata.textConfig,"fontSizePct",e._n(t))},expression:"metadata.textConfig.fontSizePct"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:"onlyTextFontSize",unit:"%",id:"onlyTextFontSize",min:"0",max:"100",step:"1"},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.textConfig.onlyTextFontSizePct,callback:function(t){e.$set(e.metadata.textConfig,"onlyTextFontSizePct",e._n(t))},expression:"metadata.textConfig.onlyTextFontSizePct"}})],1),e._v(" "),t("div",{staticClass:"srow mb-5"},[t("accordion",{staticClass:"eleven columns",attrs:{"acc-label":e.$t("advancedOptions")}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"fittingMode"}},[e._v(e._s(e.$t("modeForHandlingTooLongTexts")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.fittingMode,expression:"metadata.textConfig.fittingMode"}],staticClass:"five columns",attrs:{id:"fittingMode"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.textConfig,"fittingMode",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:e.TextConfig.TOO_LONG_AUTO}},[e._v(e._s(e.$t("adaptAutomatically")))]),e._v(" "),t("option",{domProps:{value:e.TextConfig.TOO_LONG_TRUNCATE}},[e._v(e._s(e.$t("truncate")))]),e._v(" "),t("option",{domProps:{value:e.TextConfig.TOO_LONG_ELLIPSIS}},[e._v(e._s(e.$t("ellipsisDotDotDot")))])])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"maxLines"}},[e._v(e._s(e.$t("maximumNumberOfLines")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.maxLines,expression:"metadata.textConfig.maxLines"}],staticClass:"five columns",attrs:{id:"maxLines"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.textConfig,"maxLines",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:1}},[e._v("1")]),e._v(" "),t("option",{domProps:{value:2}},[e._v("2")]),e._v(" "),t("option",{domProps:{value:3}},[e._v("3")])])]),e._v(" "),t("div",{staticClass:"srow mt-3"},[t("slider-input",{attrs:{label:"lineHeight",id:"lineHeight",min:"1",max:"3",step:"0.1"},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.textConfig.lineHeight,callback:function(t){e.$set(e.metadata.textConfig,"lineHeight",e._n(t))},expression:"metadata.textConfig.lineHeight"}})],1),e._v(" "),t("div",{staticClass:"srow mb-2"},[t("slider-input",{attrs:{label:"onlyTextLineHeight",id:"onlyTextLineHeight",min:"1",max:"3",step:"0.1"},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.textConfig.onlyTextLineHeight,callback:function(t){e.$set(e.metadata.textConfig,"onlyTextLineHeight",e._n(t))},expression:"metadata.textConfig.onlyTextLineHeight"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"fontColor"}},[t("span",[e._v(e._s(e.$t("fontColor")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.fontColor,expression:"metadata.textConfig.fontColor"}],staticClass:"five columns",attrs:{id:"fontColor",type:"color"},domProps:{value:e.metadata.textConfig.fontColor},on:{change:function(t){return e.saveMetadata(e.metadata)},input:function(t){t.target.composing||e.$set(e.metadata.textConfig,"fontColor",t.target.value)}}}),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.metadata.textConfig.fontColor=e.constants.DEFAULT_ELEMENT_FONT_COLOR,e.saveMetadata(e.metadata)}}},[e._v(e._s(e.$t("reset")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.textConfig.autoSizeKeyboardLetters,expression:"metadata.textConfig.autoSizeKeyboardLetters"}],attrs:{id:"autoSizeKeyboardLetters",type:"checkbox"},domProps:{checked:Array.isArray(e.metadata.textConfig.autoSizeKeyboardLetters)?e._i(e.metadata.textConfig.autoSizeKeyboardLetters,null)>-1:e.metadata.textConfig.autoSizeKeyboardLetters},on:{change:[function(t){var n=e.metadata.textConfig.autoSizeKeyboardLetters,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.metadata.textConfig,"autoSizeKeyboardLetters",n.concat([null])):o>-1&&e.$set(e.metadata.textConfig,"autoSizeKeyboardLetters",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.metadata.textConfig,"autoSizeKeyboardLetters",i)},function(t){return e.saveMetadata(e.metadata)}]}}),e._v(" "),t("label",{attrs:{for:"autoSizeKeyboardLetters"}},[e._v(e._s(e.$t("autoSizeKeyboardLetters")))])])])],1),e._v(" "),t("h3",{staticClass:"mt-5"},[e._v(e._s(e.$t("gridElement")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"elemColor"}},[t("span",[e._v(e._s(e.$t("defaultGridElementColor")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.elementBackgroundColor,expression:"metadata.colorConfig.elementBackgroundColor"}],staticClass:"five columns",attrs:{id:"elemColor",type:"color"},domProps:{value:e.metadata.colorConfig.elementBackgroundColor},on:{change:function(t){return e.saveMetadata(e.metadata)},input:function(t){t.target.composing||e.$set(e.metadata.colorConfig,"elementBackgroundColor",t.target.value)}}}),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.metadata.colorConfig.elementBackgroundColor=e.constants.DEFAULT_ELEMENT_BACKGROUND_COLOR,e.saveMetadata(e.metadata)}}},[e._v(e._s(e.$t("reset")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"appColor"}},[t("span",[e._v(e._s(e.$t("defaultGridBackgroundColor")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.gridBackgroundColor,expression:"metadata.colorConfig.gridBackgroundColor"}],staticClass:"five columns",attrs:{id:"appColor",type:"color"},domProps:{value:e.metadata.colorConfig.gridBackgroundColor},on:{change:function(t){return e.saveMetadata(e.metadata)},input:function(t){t.target.composing||e.$set(e.metadata.colorConfig,"gridBackgroundColor",t.target.value)}}}),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.metadata.colorConfig.gridBackgroundColor=e.constants.DEFAULT_GRID_BACKGROUND_COLOR,e.saveMetadata(e.metadata)}}},[e._v(e._s(e.$t("reset")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"colorMode"}},[e._v(e._s(e.$t("colorMode")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.colorMode,expression:"metadata.colorConfig.colorMode"}],staticClass:"five columns",attrs:{id:"colorMode"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.colorConfig,"colorMode",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},[t("option",{domProps:{value:e.ColorConfig.COLOR_MODE_BACKGROUND}},[e._v(e._s(e.$t("colorModeBackground")))]),e._v(" "),t("option",{domProps:{value:e.ColorConfig.COLOR_MODE_BORDER}},[e._v(e._s(e.$t("colorModeBorder")))])])]),e._v(" "),t("div",{staticClass:"srow mt-5"},[t("accordion",{staticClass:"eleven columns",attrs:{"acc-label":e.$t("advancedOptions")}},[t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"borderColor"}},[t("span",[e._v(e._s(e.$t("defaultGridElementBorderColor")))])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.elementBorderColor,expression:"metadata.colorConfig.elementBorderColor"}],staticClass:"five columns",attrs:{id:"borderColor",type:"color"},domProps:{value:e.metadata.colorConfig.elementBorderColor},on:{change:function(t){return e.saveMetadata(e.metadata)},input:function(t){t.target.composing||e.$set(e.metadata.colorConfig,"elementBorderColor",t.target.value)}}}),e._v(" "),t("button",{staticClass:"three columns",on:{click:function(t){e.metadata.colorConfig.elementBorderColor=e.constants.DEFAULT_ELEMENT_BORDER_COLOR,e.saveMetadata(e.metadata)}}},[e._v(e._s(e.$t("reset")))])]),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:"borderWidth",unit:"%",id:"borderWidth",min:"0",max:"2",step:"0.05",decimals:2,e:""},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.colorConfig.borderWidth,callback:function(t){e.$set(e.metadata.colorConfig,"borderWidth",e._n(t))},expression:"metadata.colorConfig.borderWidth"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:"elementMargin",unit:"%",id:"elementMargin",min:"0",max:"2",step:"0.05",decimals:2},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.colorConfig.elementMargin,callback:function(t){e.$set(e.metadata.colorConfig,"elementMargin",e._n(t))},expression:"metadata.colorConfig.elementMargin"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("slider-input",{attrs:{label:"borderRadius",unit:"%",id:"borderRadius",min:"0",max:"4",step:"0.05",decimals:2},on:{change:function(t){return e.saveMetadata(e.metadata)}},model:{value:e.metadata.colorConfig.borderRadius,callback:function(t){e.$set(e.metadata.colorConfig,"borderRadius",e._n(t))},expression:"metadata.colorConfig.borderRadius"}})],1),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"three columns",attrs:{for:"colorScheme"}},[t("span",[e._v(e._s(e.$t("colorSchemeForCategories")))])]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.activeColorScheme,expression:"metadata.colorConfig.activeColorScheme"}],staticClass:"five columns",attrs:{id:"colorScheme"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.metadata.colorConfig,"activeColorScheme",t.target.multiple?n:n[0])},function(t){return e.saveMetadata(e.metadata)}]}},e._l(e.constants.DEFAULT_COLOR_SCHEMES,(function(n){return t("option",{domProps:{value:n.name}},[e._v(e._s(e._f("translate")(n.name)))])})),0)]),e._v(" "),t("div",{staticClass:"srow"},[t("div",{staticClass:"five columns offset-by-three d-flex",staticStyle:{height:"1.5em"}},e._l(e.MetaData.getActiveColorScheme(e.metadata).colors,(function(n,r){return t("div",{staticClass:"flex-grow-1",style:`background-color: ${n};`,attrs:{title:e.$t(e.MetaData.getActiveColorScheme(e.metadata).categories[r])}})})),0)]),e._v(" "),t("div",{staticClass:"srow"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.metadata.colorConfig.colorSchemesActivated,expression:"metadata.colorConfig.colorSchemesActivated"}],attrs:{id:"colorSchemeActive",type:"checkbox"},domProps:{checked:Array.isArray(e.metadata.colorConfig.colorSchemesActivated)?e._i(e.metadata.colorConfig.colorSchemesActivated,null)>-1:e.metadata.colorConfig.colorSchemesActivated},on:{change:[function(t){var n=e.metadata.colorConfig.colorSchemesActivated,r=t.target,i=!!r.checked;if(Array.isArray(n)){var o=e._i(n,null);r.checked?o<0&&e.$set(e.metadata.colorConfig,"colorSchemesActivated",n.concat([null])):o>-1&&e.$set(e.metadata.colorConfig,"colorSchemesActivated",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.metadata.colorConfig,"colorSchemesActivated",i)},function(t){return e.saveMetadata(e.metadata)}]}}),e._v(" "),t("label",{attrs:{for:"colorSchemeActive"}},[t("span",[e._v(e._s(e.$t("activateColorCategoriesOfGridElements")))])])])])],1)]),e._v(" "),t("div",{staticClass:"three columns"},[t("h3",{staticClass:"mt-3"},[e._v(e._s(e.$t("appearanceDemo")))]),e._v(" "),t("div",{staticClass:"srow"},[t("label",{staticClass:"me-2 u-full-width",attrs:{for:"testElementLabel"}},[e._v(e._s(e.$t("testElementLabel")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.testElementLabel,expression:"testElementLabel"}],staticClass:"u-full-width",attrs:{id:"testElementLabel",type:"text"},domProps:{value:e.testElementLabel},on:{input:[function(t){t.target.composing||(e.testElementLabel=t.target.value)},e.resetTestGrid]}})]),e._v(" "),e.testGridData?t("app-grid-display",{staticStyle:{"max-width":"200px",height:"500px"},attrs:{"grid-data":e.testGridData,metadata:e.metadata,"watch-for-changes":!0}}):e._e()],1)])])};rA._withStripped=!0;const iA={components:{AppGridDisplay:Ly,Accordion:Gg,SliderInput:qf},props:["metadata","userSettingsLocal"],mixins:[vw],data:()=>({TextConfig:Hg.a,ColorConfig:yy.Y,MetaData:d.e,constants:C.A,testGridData:null,testElementLabel:o.A.t("testElement")}),methods:{toDefault(){this.metadata.textConfig=JSON.parse(JSON.stringify(new Hg.a)),this.metadata.colorConfig=JSON.parse(JSON.stringify(new yy.Y)),this.saveMetadata(this.metadata)},toDefaultBgColored(){this.metadata.colorConfig.colorMode=yy.Y.COLOR_MODE_BACKGROUND,this.metadata.colorConfig.borderWidth=yy.Y.BORDER_WIDTH_BG_COLORED,this.metadata.colorConfig.activeColorScheme=this.getColorScheme(),this.saveMetadata(this.metadata)},toDefaultBorderColored(){this.metadata.colorConfig.colorMode=yy.Y.COLOR_MODE_BORDER,this.metadata.colorConfig.borderWidth=yy.Y.BORDER_WIDTH_BORDER_COLORED,this.metadata.colorConfig.activeColorScheme=this.getColorScheme(),this.saveMetadata(this.metadata)},toDarkMode(){this.metadata.colorConfig.gridBackgroundColor=C.A.DEFAULT_GRID_BACKGROUND_COLOR_DARK,this.metadata.colorConfig.elementBackgroundColor=C.A.DEFAULT_ELEMENT_BACKGROUND_COLOR_DARK,this.metadata.textConfig.fontColor=C.A.DEFAULT_ELEMENT_FONT_COLOR_DARK,this.metadata.colorConfig.activeColorScheme=this.getColorScheme(),this.saveMetadata(this.metadata)},toLightMode(){this.metadata.colorConfig.gridBackgroundColor=C.A.DEFAULT_GRID_BACKGROUND_COLOR,this.metadata.colorConfig.elementBackgroundColor=C.A.DEFAULT_ELEMENT_BACKGROUND_COLOR,this.metadata.textConfig.fontColor=C.A.DEFAULT_ELEMENT_FONT_COLOR,this.metadata.colorConfig.activeColorScheme=this.getColorScheme(),this.saveMetadata(this.metadata)},getColorScheme(){let e=this.metadata.colorConfig.activeColorScheme,t=this.metadata.colorConfig.colorMode===yy.Y.COLOR_MODE_BACKGROUND,n=this.metadata.colorConfig.elementBackgroundColor===C.A.DEFAULT_ELEMENT_BACKGROUND_COLOR_DARK;return e.startsWith(C.A.COLOR_SCHEME_FITZGERALD_PREFIX)?t?n?C.A.COLOR_SCHEME_FITZGERALD_DARK:C.A.COLOR_SCHEME_FITZGERALD_LIGHT:C.A.COLOR_SCHEME_FITZGERALD_MEDIUM:t?n?C.A.COLOR_SCHEME_GOOSENS_DARK:C.A.COLOR_SCHEME_GOOSENS_LIGHT:C.A.COLOR_SCHEME_GOOSENS_MEDIUM},getElement:(e,t,n,r,i)=>new O.V({x:e,y:t,label:o.A.getTranslationObject(n),image:new ce.q({url:r}),colorCategory:i}),resetTestGrid(){ee.Z.debounce((()=>{this.testGridData=new c.D({gridElements:[this.getElement(0,0,this.testElementLabel,"https://api.arasaac.org/api/pictograms/2648?download=false&plural=false&color=true"),this.getElement(0,1,o.A.t("CC_VERB"),"https://api.arasaac.org/api/pictograms/4887?download=false&plural=false&color=true","CC_VERB"),this.getElement(0,2,o.A.t("CC_NOUN"),"https://api.arasaac.org/api/pictograms/2808?download=false&plural=false&color=true","CC_NOUN"),this.getElement(0,3,this.testElementLabel)]})}),200,"RESET_TEST_GRD")}},async mounted(){this.resetTestGrid()}};var oA=s(1377),aA={};aA.styleTagTransform=Ed(),aA.setAttributes=gd(),aA.insert=vd().bind(null,"head"),aA.domAPI=hd(),aA.insertStyleElement=yd(),dd()(oA.A,aA),oA.A&&oA.A.locals&&oA.A.locals;const sA=Cd(iA,rA,[],!1,null,"0a80ce99",null).exports;var lA=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"srow"},[t("div",{staticClass:"eleven columns"},[t("h3",{staticClass:"mt-2"},[e._v(e._s(e.$t("generalInputSettings")))]),e._v(" "),t("global-input-options",{attrs:{"input-config":e.metadata.inputConfig,"heading-tag":"h4","hide-acoustic-feedback":!1},on:{change:function(t){return e.saveMetadata(e.metadata)}}})],1)])])};lA._withStripped=!0;const cA={components:{GlobalInputOptions:dS},props:["metadata","userSettingsLocal"],mixins:[vw],data:()=>({i18nService:o.A,util:ee.Z,arasaacService:Ju}),methods:{},async mounted(){}};var dA=s(2792),uA={};uA.styleTagTransform=Ed(),uA.setAttributes=gd(),uA.insert=vd().bind(null,"head"),uA.domAPI=hd(),uA.insertStyleElement=yd(),dd()(dA.A,uA),dA.A&&dA.A.locals&&dA.A.locals;const hA=Cd(cA,lA,[],!1,null,"699a0ed2",null).exports,pA={TAB_GENERAL:"TAB_GENERAL",TAB_LANGUAGE:"TAB_LANGUAGE",TAB_APPEARANCE:"TAB_APPEARANCE",TAB_INPUTMETHODS:"TAB_INPUTMETHODS",TAB_INTEGRATIONS:"TAB_INTEGRATIONS"},vA={STATE_INITIAL:"STATE_INITIAL",STATE_SAVING:"STATE_SAVING",STATE_SAVED:"STATE_SAVED"},mA={components:{SettingsInputMethods:hA,SettingsAppearance:sA,SettingsIntegrations:nA,SettingsLanguage:Aw,SettingsGeneral:yw,NavTabs:jf,HeaderIcon:Pg},props:[],data:()=>({metadata:null,appSettings:n.w.getAppSettings(),userSettingsLocal:n.w.getUserSettings(),TABS:pA,currentTab:pA.TAB_GENERAL,SAVE_STATES:vA,saveState:vA.STATE_INITIAL}),methods:{onChanging(){this.saveState=vA.STATE_SAVING},onChanged(){this.saveState=vA.STATE_SAVED}},async mounted(){let e=await xg.getMetadata();this.metadata=JSON.parse(JSON.stringify(e))}},gA=mA;var fA=s(6752),yA={};yA.styleTagTransform=Ed(),yA.setAttributes=gd(),yA.insert=vd().bind(null,"head"),yA.domAPI=hd(),yA.insertStyleElement=yd(),dd()(fA.A,yA),fA.A&&fA.A.locals&&fA.A.locals;const _A=Cd(gA,hw,[],!1,null,"2baa5fd6",null).exports;var EA=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overflow-content"},[t("header-icon",{attrs:{"full-header":"true"}}),e._v(" "),t("div",{staticClass:"container px-3 px-md-5 ms-0 col-12 col-md-10 col-xl-9 pt-4 pt-lg-5"},[t("div",{staticClass:"row"},[t("h1",[e._v(e._s(e.$t("help")))]),e._v(" "),t("div",[t("span",[e._v(e._s(e.$t("theFollowingRessourcesForHelpOnAstericsGrid")))]),e._v(":\n            ")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.asterics.eu/manuals/asterics-grid/",target:"_blank"}},[e._v(e._s(e.$t("userManual"))+" "),t("span",[e._v("("+e._s(e._f("translate")("lang.en"))+")")])])]),e._v(" "),"es"!==e.currentLang?t("li",[t("a",{attrs:{href:"https://aulaabierta.arasaac.org/en/asterics-grid_home",target:"_blank"}},[e._v(e._s(e.$t("arasaacTutorial"))+" "),t("span",[e._v("("+e._s(e._f("translate")("lang.en"))+")")])])]):e._e(),e._v(" "),"es"===e.currentLang?t("li",[t("a",{attrs:{href:"https://aulaabierta.arasaac.org/asterics-grid_inicio",target:"_blank"}},[e._v(e._s(e.$t("arasaacTutorial"))+" "),t("span",[e._v("("+e._s(e._f("translate")("lang.es"))+")")])])]):e._e(),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.youtube.com/playlist?list=PL0UXHkT03dGrIHldlEKR0ZWfNMkShuTNz",target:"_blank"}},[t("span",[e._v(e._s(e.$t("tutorialVideosOnYoutube")))]),e._v(" "),t("span",[e._v("("+e._s(e._f("translate")("lang.de"))+")")])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.youtube.com/channel/UCVIQETg6tIMu3SdEHaIftIw/videos",target:"_blank"}},[t("span",[e._v(e._s(e.$t("tutorialVideosOnYoutube")))]),e._v(" "),t("span",[e._v("(Jim Luther, "+e._s(e._f("translate")("lang.en"))+")")])])])])]),e._v(" "),t("div",{staticClass:"row"},[t("h2",[e._v(e._s(e.$t("contactAndFeedback")))]),e._v(" "),t("span",[e._v(e._s(e.$t("ifYouEncounterAnErrorHaveSuggestions")))]),e._v(" "),t("ul",[t("li",[t("i18n",{attrs:{path:"arasaacSupportSocialMedia",tag:"span"},scopedSlots:e._u([{key:"instagramLink",fn:function(){return[t("a",{attrs:{href:"https://www.instagram.com/asterics_grid/",target:"_blank"}},[e._v(e._s(e.$t("instagramAstericsGridPage")))])]},proxy:!0},{key:"facebookLink",fn:function(){return[t("a",{attrs:{href:"https://www.facebook.com/asterics.grid.y.arasaac",target:"_blank"}},[e._v(e._s(e.$t("facebookAstericsGridPage")))])]},proxy:!0}])}),e._v(" "),t("span",[e._v("("+e._s(e.$t("lang.es"))+", "+e._s(e.$t("lang.en"))+", "+e._s(e.$t("lang.pt"))+")")])],1),e._v(" "),t("li",[t("i18n",{attrs:{path:"communityOnFacebookGroup",tag:"span"},scopedSlots:e._u([{key:"astericsGridFacebookGroup",fn:function(){return[t("a",{attrs:{href:"https://www.facebook.com/groups/1550700782223677/",target:"_blank"}},[e._v(e._s(e.$t("astericsGridFacebookGroup")))])]},proxy:!0}])}),e._v(" "),t("span",[e._v("("+e._s(e.$t("lang.en"))+")")])],1),e._v(" "),t("li",[t("i18n",{attrs:{path:"foundBugReportGithubIssue",tag:"span"},scopedSlots:e._u([{key:"githubLink",fn:function(){return[t("a",{attrs:{href:"https://github.com/asterics/AsTeRICS-Grid/issues/new",target:"_blank"}},[e._v(e._s(e.$t("createAnIssueOnGithub")))])]},proxy:!0}])}),e._v(" "),t("span",[e._v("("+e._s(e.$t("lang.en"))+")")])],1),e._v(" "),t("li",[t("i18n",{attrs:{path:"specialRequestsSendEmail",tag:"span"},scopedSlots:e._u([{key:"foundationEmail",fn:function(){return[t("a",{attrs:{href:"mailto:office@asterics-foundation.org"}},[e._v("office@asterics-foundation.org")])]},proxy:!0}])}),e._v(" "),t("span",[e._v("("+e._s(e.$t("lang.en"))+", "+e._s(e.$t("lang.de"))+")")])],1)])])]),e._v(" "),t("div",{staticClass:"bottom-spacer"})],1)};EA._withStripped=!0;const bA={components:{HeaderIcon:Pg},props:[],data:()=>({currentLang:o.A.getAppLang()}),methods:{},mounted(){}};var SA=s(6999),CA={};CA.styleTagTransform=Ed(),CA.setAttributes=gd(),CA.insert=vd().bind(null,"head"),CA.domAPI=hd(),CA.insertStyleElement=yd(),dd()(SA.A,CA),SA.A&&SA.A.locals&&SA.A.locals;const wA=Cd(bA,EA,[],!1,null,"6db3f962",null).exports;let AA=["#login","#register","#welcome","#add","#about","#help","#outdated"],TA={},IA=null,kA=null,OA=null,RA=!0,xA=!1,NA=null,DA=[],LA=!1;function PA(e){return location.origin+location.pathname+location.search+e}function MA(e,n,r){var i;RA&&(NA=e,e!==HS&&(0,t.A)("#touchElement").hide(),i=r||function(){let e=location.hash,t=e.lastIndexOf("/");return t=t>-1?t:e.length,e.substring(0,t)}(),(0,t.A)("nav button").removeClass("selected"),(0,t.A)(`nav a[href='${i}'] button`).addClass("selected"),log.debug("loading view: "+e.__file),fg.setViewComponent(e,n))}function UA(){RA&&xg.getMetadata().then((e=>{let t=e?e.homeGridId||e.lastOpenedGridId:null;if(t)return TA.toGrid(t);MA(HS)}))}TA.VIEWS={ManageGridsView:Mf,GridView:HS,GridEditView:Nb},TA.init=function(e,r){RA&&(xA=!0,kA=e,IA=new(i())(null,!0),IA.on({main:function(){Qc.setHelpLocation("02_navigation","#main-view"),UA()},"grids/":function(){Qc.setHelpLocation("02_navigation","#manage-grids-view"),MA(Mf)},"grid/:gridId":function(e,t){log.debug("route grid with ID: "+e.gridId);let n=h.getSearchQueryParams(e);Qc.setHelpLocation("02_navigation","#main-view"),MA(HS,n,"#main")},"grid/name/:gridName":function(e){log.debug("route grid with Name: "+e.gridName),Qc.setHelpLocation("02_navigation","#main-view"),xg.getGrids().then((t=>{let n=t.filter((t=>o.A.getTranslation(t.label)===e.gridName)),r=n[0]?n[0].id:null;r?MA(HS,{gridId:r},"#main"):(log.warn(`no grid with name ${e.gridName} found!`),UA())}))},"grid/edit/:gridId":function(e){Qc.setHelpLocation("02_navigation","#edit-view"),MA(Nb,e)},"grid/edit/:gridId/:highlightId":function(e){Qc.setHelpLocation("02_navigation","#edit-view"),MA(Nb,e)},login:function(){Qc.setHelpLocation("02_navigation","#change-user-view"),MA(mC)},register:function(){Qc.setHelpLocation("06_users","#online-users"),MA(AC)},add:function(){Qc.setHelpLocation("06_users","#offline-users"),MA(RC)},welcome:function(){Qc.setHelpLocationIndex(),MA(PC)},about:function(){Qc.setHelpLocationIndex(),MA($C)},dictionaries:function(){Qc.setHelpLocation("02_navigation","#manage-dictionaries-view"),MA(uw)},settings:function(){MA(_A)},help:function(){MA(wA)},"*":function(){Qc.setHelpLocation("02_navigation","#main-view"),TA.toMain()}}),IA.hooks({before:function(e,r){let i=location.hash;(0,t.A)(document).trigger(C.A.EVENT_NAVIGATE);let o=!i.startsWith("#grid/edit")&&(i.startsWith("#main")||i.startsWith("#grid/"));if(LA&&!o)return e(!!C.A.IS_SAFARI&&void 0),C.A.IS_SAFARI?setTimeout((()=>{TA.toMain()}),100):TA.toMain();NA&&NA.destroy&&(NA.destroy(),NA=null);let a=function(){let e=location.hash;if(!te.getCurrentUsedDatabase()){let t=n.w.getLastActiveUser()||n.w.getSavedUsers().length>0;e=AA.includes(e)?e:null,e=e||(t?"#login":"#welcome")}return e}();location.hash!==a?(e(!1),TA.to(a)):e()},after:function(e){},leave:function(e){}}),r&&TA.to(r),IA.resolve())},TA.isInitialized=function(){return xA},TA.to=function(e,t){OA=(t=t||{}).reset?null:location.hash;let n=PA(e);t.noHistory?location.replace(n):location.assign(n)},TA.toMain=function(){TA.to("#main?date="+(new Date).getTime())},TA.toRegister=function(){TA.to("#register")},TA.toAddOffline=function(){TA.to("#add")},TA.toAbout=function(){TA.to("#about")},TA.toLogin=function(){TA.to("#login")},TA.toLastOpenedGrid=function(){xg.getMetadata().then((e=>{TA.toGrid(e.lastOpenedGridId)}))},TA.toGrid=function(e,n){if(e){TA.addToGridHistory(e),n=n||{},h.setParamsToSearchQuery(n);let r=`#grid/${e}`;if(NA===HS)xg.getGrid(e,!1,!0).then((r=>{r&&(history&&history.replaceState&&history.replaceState(null,null,PA(`#grid/${e}`)),(0,t.A)(document).trigger(C.A.EVENT_NAVIGATE_GRID_IN_VIEWMODE,[r,n]))}));else{let e=location.hash.startsWith("#main");TA.to(r,{noHistory:e})}}},TA.toEditGrid=async function(e,t){if(!e){let t=await xg.getGrids(!1,!0);e=t.length>0?t[0].id:null}e&&TA.to(`#grid/edit/${e}/${t||""}`)},TA.toManageGrids=function(){TA.to("#grids")},TA.back=function(){OA&&OA!==location.hash?TA.to(OA,{reset:!0}):this.toMain()},TA.isOnEditPage=function(){return-1!==window.location.hash.indexOf("#grid/edit")},TA.isOnGridView=function(){return!TA.isOnEditPage()&&-1!==window.location.hash.indexOf("#grid/")},TA.getCurrentView=function(){return NA},TA.addToGridHistory=function(e){DA.length>0&&DA[DA.length-1]===e||(-1===DA.indexOf(e)?DA.push(e):DA=[e])},TA.toLastGrid=function(){if(1===DA.length)return;DA.pop();let e=DA.pop();TA.toGrid(e)},(0,t.A)(document).on(C.A.EVENT_UI_LOCKED,(()=>{LA=!0})),(0,t.A)(document).on(C.A.EVENT_UI_UNLOCKED,(()=>{LA=!1}));let FA={},BA=null;FA.init=function(){Mi.directive("focus",{inserted:function(e,t){(t.value||void 0===t.value)&&(e.focus&&e.focus(),e.select&&e.select())},updated:function(e,t){t.value&&(e.focus&&e.focus(),e.select&&e.select())}}),Mi.directive("debounce",{inserted:function(e,t){e.oninput=function(n){clearTimeout(BA),BA=setTimeout((function(){e.dispatchEvent(new Event("change"))}),parseInt(t.value)||500)}}}),Mi.filter("translate",(function(e){return o.A.t(e)})),Mi.filter("extractTranslation",(function(e){return o.A.getTranslation(e)})),Mi.filter("extractTranslationAppLang",(function(e){return o.A.getTranslationAppLang(e)}))};var GA=s(5335),$A={};$A.styleTagTransform=Ed(),$A.setAttributes=gd(),$A.insert=vd().bind(null,"head"),$A.domAPI=hd(),$A.insertStyleElement=yd(),dd()(GA.A,$A),GA.A&&GA.A.locals&&GA.A.locals;var VA=s(5351),jA={};jA.styleTagTransform=Ed(),jA.setAttributes=gd(),jA.insert=vd().bind(null,"head"),jA.domAPI=hd(),jA.insertStyleElement=yd(),dd()(VA.A,jA),VA.A&&VA.A.locals&&VA.A.locals;var KA=s(4497),WA={};WA.styleTagTransform=Ed(),WA.setAttributes=gd(),WA.insert=vd().bind(null,"head"),WA.domAPI=hd(),WA.insertStyleElement=yd(),dd()(KA.A,WA),KA.A&&KA.A.locals&&KA.A.locals;let qA=function(){Hc.global.onAnyKey((async(e,t,r)=>{const i=C.A.IS_MAC?r.metaKey:r.ctrlKey;if(i&&r.shiftKey&&39===e){let e=n.w.getSavedUsers(),t=xg.getCurrentUser(),r=e.indexOf(t);r=r+1<e.length?r+1:0;let i=e[r];log.info("changing user via keyboard shortcut to: "+i),XS.loginStoredUser(i)}i&&8===e&&TA.toLastGrid(),i&&36===e&&TA.toMain(),i&&70===e&&(r.preventDefault(),[TA.VIEWS.AllGridsView,TA.VIEWS.GridView,TA.VIEWS.GridEditView].includes(TA.getCurrentView())&&fg.showSearchModal()),TA.isOnGridView()&&i&&67===e&&await ee.Z.copyCollectContentToClipboard()}))},HA={},YA=null,zA=null,JA=null;function XA(){HA.checkNotifications(),JA=setTimeout(XA,36e5)}async function QA(){fg.clearTooltip(),xg.downloadBackupToFile(),await xg.markCurrentConfigAsBackedUp()}async function ZA(){fg.clearTooltip(),YA.backupNotifyIntervalDays=0,eT()}async function eT(){let e=await xg.getMetadata();e.notificationConfig=YA,await xg.saveMetadata(e)}async function tT(){let e=await xg.getMetadata();YA=e.notificationConfig}HA.init=function(){clearTimeout(zA),clearTimeout(JA),zA=setTimeout((()=>{XA()}),6e4)},HA.checkNotifications=async function(){if(!YA)return;let e=(new Date).getTime(),t=YA.lastBackup||0,n=YA.lastBackupNotification||0,r=24*YA.backupNotifyIntervalDays*60*60*1e3;if(0!==r&&e-t>r&&e-n>r){let e=await xg.getLastGridUpdateTime();if(void 0===e)return;(t<e||0===t&&0===e)&&(YA.lastBackupNotification=(new Date).getTime(),eT(),fg.setTooltip(o.A.t("pleaseConsiderToDownloadABackup"),{msgType:"info",closeOnNavigate:!1,actionLink:o.A.t("downloadNow"),actionLinkFn:QA,actionLink2:o.A.t("stopRemembering"),actionLinkFn2:ZA}))}},(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,tT),(0,t.A)(document).on(C.A.EVENT_USER_CHANGED,HA.init),(0,t.A)(document).on(C.A.EVENT_METADATA_UPDATED,tT);!async function(){let e=[];log.setLevel(log.levels.INFO),log.info("AsTeRICS Grid, release version: https://github.com/asterics/AsTeRICS-Grid/releases/tag/"+C.A.CURRENT_VERSION),function(){let e=n.w.getCurrentAppVersion();if(e&&e!==C.A.CURRENT_VERSION){let e=()=>{let n=o.A.t("youreNowUsingVersion",C.A.CURRENT_VERSION);fg.setTooltip(n,{closeOnNavigate:!0,timeout:3e4,actionLink:o.A.t("moreInformation"),actionLinkUrl:"https://github.com/asterics/AsTeRICS-Grid/releases/tag/"+C.A.CURRENT_VERSION,msgType:"info"}),(0,t.A)(document).off(C.A.EVENT_GRID_LOADED,e)};(0,t.A)(document).on(C.A.EVENT_GRID_LOADED,e)}n.w.setCurrentAppVersion(C.A.CURRENT_VERSION)}(),function(){function e(){navigator.serviceWorker?navigator.serviceWorker.register("./serviceWorker.js").then((e=>{let t=!1;setInterval((()=>{log.debug("Check for serviceworker update..."),e.update()}),9e5),e.addEventListener("updatefound",(function(){navigator.serviceWorker.controller&&(t=!0)})),navigator.serviceWorker.addEventListener("message",(e=>{t&&e.data&&e.data.activated&&fg.setTooltipI18n(o.A.t("newVersionAvailableTheNextTimeYoullUseUpdated"),{closeOnNavigate:!1,actionLink:o.A.t("updateNow"),actionLinkFn:()=>{window.location.reload()},msgType:"info"})}))})):log.warn("ServiceWorker not supported!")}C.A.IS_ENVIRONMENT_PROD?"serviceWorker"in navigator&&(window.loaded?e():window.addEventListener("load",(()=>{e()}))):log.warn("Not installing Service Worker because on development environment.")}(),function(){if(C.A.IS_ENVIRONMENT_PROD){var e=window._paq=window._paq||[];e.push(["setDoNotTrack",!0]),e.push(["disableCookies"]),e.push(["trackPageView"]),e.push(["enableLinkTracking"]),function(){var t="//analytics.wbt.wien/";e.push(["setTrackerUrl",t+"matomo.php"]),e.push(["setSiteId","5"]);var n=document,r=n.createElement("script"),i=n.getElementsByTagName("script")[0];r.type="text/javascript",r.async=!0,r.src=t+"matomo.js",i.parentNode.insertBefore(r,i)}()}else log.warn("Not doing analytics because on development environment.")}(),Yg.initPrintHandlers(),FA.init(),qA(),HA.init(),await fg.init();let r=n.w.getLastActiveUser(),i=n.w.getAutologinUser(),a=h.getParam(h.params.PARAM_USE_GRIDSET_FILENAME);if(a){h.removeParam(h.params.PARAM_USE_GRIDSET_FILENAME);let e=n.w.getAutoImportedUserSettings(),t=e.find((e=>e.originGridsetFilename===a));if(t)i=t.username;else{let t=e.find((e=>e.isEmpty))||{},r=t.username||n.w.getNextAutoUserName();t.username?await XS.loginStoredUser(r,!0):await XS.registerOffline(r,r),await xg.importBackupDefaultFile(a),i=r}}n.w.getUserMajorModelVersion(i)>u.S.getLatestModelVersion().major&&(log.info(`data model version of user "${i}" is newer than version of running AsTeRICS Grid -> prevent autologin.`),i=null,n.w.setAutologinUser("")),log.info("autologin user: "+i),h.isDemoMode()?(e.push(XS.registerOffline(C.A.LOCAL_DEMO_USERNAME,C.A.LOCAL_DEMO_USERNAME)),n.w.setAutologinUser("")):e.push(XS.loginStoredUser(i,!0)),Promise.all(e).finally((()=>{let e=i||h.isDemoMode(),t=r||n.w.getSavedUsers().length>0;n.w.setLastActiveUser(i||r||"");let o=location.hash||(e?"#main":t?"#login":"#welcome");TA.isInitialized()||TA.init("#injectView",o)}))}()})(),l=s.O(l)})();