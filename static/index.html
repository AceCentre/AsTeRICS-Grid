<!DOCTYPE html>
<html lang="en">
<head>
    <title>AsTeRICS Grid</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/muuri.css">

    <script src="lib/domi18n.js"></script>
    <script src="lib/web-animations.min.js"></script>
    <script src="lib/hammer.min.js"></script>
    <script src="lib/muuri.min.js"></script>
    <script src="lib/lquery.js"></script>

</head>
<body>
<div id="content">
    <header class="row" role="banner">
        <h1 id="mainHeading" tabindex="-1" class="nine columns">AsTeRICS Grid</h1>
    </header>
    <main role="main">
        <div class="grid">
            <div class="item">
                <div class="item-content">
                    <button>TEST</button>
                    1
                </div>
            </div>

            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST2</button>
                        2
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST3</button>
                        3
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        4
                        Text
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        5
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        6
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        7
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        8
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        9
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
            <div class="item">
                <div class="item-content">
                    <!-- Safe zone, enter your custom markup -->
                    <div class="my-custom-content">
                        <button>TEST4</button>
                        10
                    </div>
                    <!-- Safe zone ends -->
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    var grid = new Muuri('.grid', {
        dragEnabled: true,
    });

    function getRows(elemSelector, groupingFn) {
        groupingFn = groupingFn || getYPos;
        var keys = [];
        var rows = {};
        L.selectAsList(elemSelector).forEach(function (item) {
            var yPos = groupingFn(item);
            if (keys.indexOf(yPos) != -1) {
                rows[yPos].push(item);
            } else {
                keys.push(yPos);
                rows[yPos] = [item];
            }
        });
        keys = keys.sort((a, b) => a - b);
        return keys.map(key => rows[key]);
    }

    function getYPos(item) {
        return item.getBoundingClientRect().top;
    }

    function getXPos(item) {
        return item.getBoundingClientRect().left;
    }

    function startScanning(index) {
        index = index || 0;
        var rows = getRows('.item-content', getXPos);
        if (index > rows.length - 1) {
            index = 0;
        }
        L.removeClass('.item-content', 'scanFocus');
        L.addClass(rows[index], 'scanFocus');
        setTimeout(function () {
            startScanning(index + 1);
        }, 1000);
    }

    startScanning();
</script>
</body>
</html>
